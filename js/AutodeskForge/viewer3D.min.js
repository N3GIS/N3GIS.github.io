/*!
 * LMV v7.105.0
 *
 * Copyright 2025 Autodesk, Inc.
 * All rights reserved.
 *
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 *
 * Autodesk Viewer SDK Usage Limitations:
 *
 * The Autodesk Viewer SDK JavaScript must be delivered from an
 * Autodesk-hosted URL.
 */
var LMV;(()=>{var e,t,i={90002:e=>{e.exports="#if NUM_CUTPLANES > 0\n#ifdef LINE_CUTPLANE\nuniform vec4 cutplanes[NUM_CUTPLANES];\nuniform bool cutplanesHideInterior;\nbool checkHideInterior(vec3 worldPosition) {\n    int insideCount = 0;\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) < 0.0) {\n            insideCount++;\n        }\n    }\n    return insideCount != NUM_CUTPLANES;\n}\nbool checkInsideCutplanes(vec3 worldPosition) {\n    if (cutplanesHideInterior) {\n        return checkHideInterior(worldPosition);\n    }\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) > 0.0) {\n            return false;\n        }\n    }\n    return true;\n}\nbool checkCutPlanes(vec3 worldPosition) {\n    if (!checkInsideCutplanes(vWorldPosition)) {\n        #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n            gl_FragDepth = 1.0;\n            return true;\n        #else\n            discard;\n        #endif\n    }\n    return false;\n}\n#else\nuniform vec4 cutplanes[NUM_CUTPLANES];\nuniform bool cutplanesHideInterior;\nvoid checkHideInterior(vec3 worldPosition) {\n    int insideCount = 0;\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) < 0.0) {\n            insideCount++;\n        }\n    }\n    if (insideCount == NUM_CUTPLANES) {\n        discard;\n    }\n}\nvoid checkCutPlanes(vec3 worldPosition) {\n    if (cutplanesHideInterior) {\n        checkHideInterior(worldPosition);\n        return;\n    }\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) > 0.0) {\n            discard;\n        }\n    }\n}\n#endif\n#endif\n"},92070:e=>{e.exports="uniform float point_size;"},96900:e=>{e.exports="\nuniform sampler2D tDepth;\nuniform vec4 projInfo;\nuniform float isOrtho;\nuniform mat4 worldMatrix_mainPass;\nvec3 reconstructCSPosition(vec2 fragCoords, float z) {\n    return vec3((fragCoords * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructWorldPosition(vec2 fragCoords, vec2 screenUv) {\n    float zCam = texture(tDepth, screenUv).z;\n    vec3 csPos = reconstructCSPosition(fragCoords, zCam);\n    return (worldMatrix_mainPass * vec4(csPos, 1.0)).xyz;\n}\n"},1081:e=>{e.exports="\nuniform float envRotationSin;\nuniform float envRotationCos;\nvec3 adjustLookupVector(in vec3 lookup) {\n    return vec3(\n            envRotationCos * lookup.x - envRotationSin * lookup.z,\n            lookup.y,\n            envRotationSin * lookup.x + envRotationCos * lookup.z);\n}\nvec3 RGBMDecode(in vec4 vRGBM, in float exposure) {\n    vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\n    ret *= ret;\n    ret *= exposure;\n    return ret;\n}\nvec3 GammaDecode(in vec4 vRGBA, in float exposure) {\n    return vRGBA.xyz * vRGBA.xyz * exposure;\n}\nvec3 sampleIrradianceMap(vec3 dirWorld, samplerCube irrMap, float exposure) {\n    vec4 cubeColor4 = texture(irrMap, adjustLookupVector(dirWorld));\n#ifdef IRR_GAMMA\n    vec3 indirectDiffuse = GammaDecode(cubeColor4, exposure);\n#elif defined(IRR_RGBM)\n    vec3 indirectDiffuse = RGBMDecode(cubeColor4, exposure);\n#else\n    vec3 indirectDiffuse = cubeColor4.xyz;\n#ifdef GAMMA_INPUT\n    indirectDiffuse.xyz *= indirectDiffuse.xyz;\n#endif\n#endif\n    return indirectDiffuse;\n}\n"},26750:e=>{e.exports="#ifdef HATCH_PATTERN\noutFragColor = calculateHatchPattern(hatchParams, gl_FragCoord.xy, outFragColor, hatchTintColor, hatchTintIntensity);\n#endif\n#ifdef MRT_NORMALS\noutNormal = vec4(geomNormal.x, geomNormal.y, depth, outFragColor.a < 1.0 ? 0.0 : 1.0);\n#endif\n#include <id_frag>\n"},40304:e=>{e.exports="float averageOfFloat3(in vec3 value) {\n    const float oneThird = 1.0 / 3.0;\n    return dot(value, vec3(oneThird, oneThird, oneThird));\n}\n"},22826:e=>{e.exports="#ifdef HATCH_PATTERN\nuniform vec2 hatchParams;\nuniform vec3 hatchTintColor;\nuniform float hatchTintIntensity;\nfloat curveGaussian(float r, float invWidth) {\n    float amt = clamp(r * invWidth, 0.0, 1.0);\n    float exponent = amt * 3.5;\n    return exp(-exponent*exponent);\n}\nvec4 calculateHatchPattern(vec2 hatchParams, vec2 coord, vec4 fragColor, vec3 hatchTintColor, float hatchTintIntensity ) {\n    float hatchSlope = hatchParams.x;\n    float hatchPeriod = hatchParams.y;\n    if (abs(hatchSlope) <= 1.0) {\n        float hatchPhase = coord.y - hatchSlope * coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    } else {\n        float hatchPhase = - coord.y / hatchSlope + coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    }\n    return fragColor;\n}\n#endif\n"},17028:e=>{e.exports="vec3 rgb2hsv(vec3 color)\n{\n    float delta;\n    float colorMax, colorMin;\n    float h,s,v;\n    vec3 hsv;\n    colorMax = max(color.r,color.g);\n    colorMax = max(colorMax,color.b);\n    colorMin = min(color.r,color.g);\n    colorMin = min(colorMin,color.b);\n    v = colorMax;\n    if(colorMax != 0.0)\n    {\n        s = (colorMax - colorMin)/colorMax;\n    }\n    else\n    {\n        s = 0.0;\n    }\n    if(s != 0.0)\n    {\n        delta = colorMax-colorMin;\n        if (color.r == colorMax)\n        {\n            h = (color.g-color.b)/delta;\n        }\n        else if (color.g == colorMax)\n        {\n            h = 2.0 + (color.b-color.r) / delta;\n        }\n        else\n        {\n            h = 4.0 + (color.r-color.g)/delta;\n        }\n        h /= 6.0;\n        if( h < 0.0)\n        {\n            h +=1.0;\n        }\n    }\n    else\n    {\n        h = 0.0;\n    }\n    hsv = vec3(h,s,v);\n    return hsv;\n}\nvec3 hsv2rgb(vec3 hsv)\n{\n    vec3 color;\n    float f,p,q,t;\n    float h,s,v;\n    float i,hi;\n    {\n        h = hsv.x*6.0;\n        s = hsv.y;\n        v = hsv.z;\n        i = floor(h);\n        f = h-i;\n        p = v * (1.0 - s);\n        q = v * (1.0 - (s * f));\n        t = v * (1.0 - (s * (1.0 - f)));\n        float r,g,b;\n        if (i == 0.0)\n        {\n            r = v;\n            g = t;\n            b = p;\n        }\n        else if (i == 1.0)\n        {\n            r = q;\n            g = v;\n            b = p;\n        }\n        else if (i == 2.0)\n        {\n            r = p;\n            g = v;\n            b = t;\n        }\n        else if (i == 3.0)\n        {\n            r = p;\n            g = q;\n            b = v;\n        }\n        else if (i == 4.0)\n        {\n            r = t;\n            g = p;\n            b = v;\n        }\n        else\n        {\n            r = v;\n            g = p;\n            b = q;\n        }\n        color = vec3(r,g,b);\n    }\n    return color;\n}"},14804:e=>{e.exports="#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)\n    varying highp float depth;\n#endif\n#if defined(MRT_ID_BUFFER) || defined(ID_COLOR) || defined(USE_UNIFORM_BUFFER_OBJECTS)\n    #if defined(USE_VERTEX_ID) || defined(USE_UNIFORM_BUFFER_OBJECTS)\n        varying vec3 vId;\n    #elif defined(LINE_2D_SHADER)\n        varying vec4 dbId;\n    #else\n        uniform vec3 dbId;\n    #endif\n#endif\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\n    uniform vec3 modelId;\n#endif\n#if defined(MRT_NORMALS)\n    layout(location = 1) out vec4 outNormal;\n    #if defined(MRT_ID_BUFFER)\n        layout(location = 2) out vec4 outId;\n        #if defined(MODEL_COLOR)\n            layout(location = 3) out vec4 outModelId;\n        #endif\n    #endif\n#elif defined(MRT_ID_BUFFER)\n    layout(location = 1) out vec4 outId;\n    #if defined(MODEL_COLOR)\n        layout(location = 2) out vec4 outModelId;\n    #endif\n#endif"},31371:e=>{e.exports="#if defined(USE_VERTEX_ID) || defined(USE_UNIFORM_BUFFER_OBJECTS)\nin vec3 id;\nout vec3 vId;\n#endif\n"},11255:e=>{e.exports="\n#if defined(USE_VERTEX_ID) && (defined(MRT_ID_BUFFER) || defined(ID_COLOR))\n    #if defined (USE_UNIFORM_BUFFER_OBJECTS)\n        vec3 dbId = vec3(float(dbIdInt % 256) / 255.0,\n                         float((dbIdInt / 256) % 256) / 255.0,\n                         float(dbIdInt / 65536)  / 255.0);\n    #else\n        vec3 dbId = vId;\n    #endif\n#endif\n#ifdef MRT_ID_BUFFER\n    #ifndef ENABLE_ID_DISCARD\n        const float writeId = 1.0;\n    #endif\n    outId = vec4(dbId.rgb, writeId);\n    #ifdef MODEL_COLOR\n        outModelId = vec4(modelId.rgb, writeId);\n    #endif\n#elif defined(ID_COLOR)\n    #ifdef ENABLE_ID_DISCARD\n        if (writeId==0.0) {\n            discard;\n        }\n    #endif\n    outFragColor = vec4(dbId.rgb, 1.0);\n#elif defined(MODEL_COLOR)\n    #ifdef ENABLE_ID_DISCARD\n        if (writeId==0.0) {\n            discard;\n        }\n    #endif\n    outFragColor = vec4(modelId.rgb, 1.0);\n#endif\n"},91952:e=>{e.exports="\n#if defined(USE_VERTEX_ID) || defined(USE_UNIFORM_BUFFER_OBJECTS)\nvId = id;\n#endif\n"},45631:e=>{e.exports="#if defined( IMPORTANTSAMPLING )\n#define SAMPLECOUNT 32\nvec2 Hammersley(int index)\n{\n    float u = (float(index) + 0.5) / 32.0;\n    float v = 0.5;\n    float noise = texture(importantSamplingRandomMap, vec2(u, v), 0.0).r;\n   return vec2(2.0 * PI * float(index/SAMPLECOUNT), noise);\n}\nvec3 ImportanceSampleAnisotropicGGX(int index, vec2 alpha, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec2 uniformSample2D = Hammersley(index);\n    float coef = sqrt(uniformSample2D.y / (1.0 - uniformSample2D.y));\n    float sinSigma, cosSigma;\n    sinSigma = sin(uniformSample2D.x);\n    cosSigma = cos(uniformSample2D.x);\n    vec3 H = coef * ((alpha.x * cosSigma) * Tu + (alpha.y * sinSigma) * Tv) + N;\n    H = normalize(H);\n    return H;\n}\nfloat ComputePDF(vec2 alpha, float NdotH, float HdotTu, float HdotTv, float VdotH)\n{\n    float factor1 = HdotTu / alpha.x;\n    float factor2 = HdotTv / alpha.y;\n    float factor3 = factor1 * factor1 + factor2 * factor2 + NdotH * NdotH;\n    float factor = factor3 * factor3 * alpha.x * alpha.y * VdotH * 4.0 * PI;\n    if (factor > 0.0)\n    {\n        return (NdotH / factor);\n    }\n    else\n    {\n        return 0.0;\n    }\n}\n#define INVFACESIZE 0.0078125\nfloat DirectionToSolidAngle(vec3 dir)\n{\n    dir = abs(dir);\n    float first = min(dir.x, dir.y);\n    float temp = max(dir.x, dir.y);\n    float second = min(temp, dir.z);\n    float third = max(temp, dir.z);\n    first /= third;\n    second /= third;\n    float u = (first+1.0)/2.0;\n    float v = (second + 1.0) / 2.0;\n    float solidAngle = texture(importantSamplingSolidAngleMap, vec2(u, v), 0.0).r * 0.000255;\n    return solidAngle;\n}\nfloat Smith_GGX(float value)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + value));\n}\nvec2 RoughnessAnisotropyToAlpha(float roughness, float anisotropy)\n{\n    float aspect = sqrt(1.0 - 0.9 * anisotropy);\n    vec2 alpha = vec2(roughness * roughness / aspect, roughness * roughness * aspect);\n    return alpha;\n}\nvec3 ImportanceSamplingSpecular(float angle, vec3 reflectance, float roughness, float anisotropy, vec3 V, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec3 specular = vec3(0.0);\n    float radAngle;\n    if (anisotropy < 1e-10)\n    {\n        radAngle = 0.0;\n    }\n    else\n    {\n        radAngle = -PI * angle;\n    }\n    vec2 alpha = RoughnessAnisotropyToAlpha(roughness, anisotropy);\n    float alpha2 = max(alpha.x * alpha.x, alpha.y * alpha.y);\n    float NdotV = dot(N, V);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    vec2 sincosTheta;\n    sincosTheta.x = sin(radAngle);\n    sincosTheta.y = cos(radAngle);\n    vec3 Tu1, Tv1;\n    Tu1 = sincosTheta.y * Tu - sincosTheta.x * Tv;\n    Tv1 = sincosTheta.x * Tu + sincosTheta.y * Tv;\n    vec3 H;\n    vec3 sampleLightIntensity;\n    vec3 L;\n    float effectiveSample = 0.0;\n    for (int i = 0; i < SAMPLECOUNT; i++)\n    {\n        H = ImportanceSampleAnisotropicGGX(i, alpha, N, Tu1, Tv1);\n        float VdotH = dot(V, H);\n        L = 2.0 * VdotH * H - V;\n        float NdotH = dot(N, H);\n        float NdotL = dot(N, L);\n        if (NdotL >= 0.0 && NdotV > 0.0 && NdotH > 0.0)\n        {\n            float alpha2NL = aSqrd(alpha2, NdotL);\n            float HdotTu = dot(H, Tu1);\n            float HdotTv = dot(H, Tv1);\n            float pdf = ComputePDF(alpha, NdotH, HdotTu, HdotTv, VdotH);\n            float mipmapLevel = 0.0;\n            if (pdf > 0.0)\n            {\n                mipmapLevel = 0.3 * log2(1.0 / (float(SAMPLECOUNT) * pdf * DirectionToSolidAngle(L)));\n            }\n            mipmapLevel = clamp(mipmapLevel, 0.0, 4.0);\n            L = normalize(L);\n            sampleLightIntensity = sampleReflection(L, L, mipmapLevel).rgb;\n            float G = Smith_GGX(alpha2NL) * Smith_GGX(alpha2NV);\n            vec3 F = Fresnel_Schlick(reflectance, VdotH);\n            float factor = G * VdotH / (NdotH * NdotV);\n            if (factor >= 0.0)\n            {\n                specular += abs(sampleLightIntensity * F * factor);\n                effectiveSample += 1.0;\n            }\n        }\n    }\n    if (effectiveSample > 0.0)\n    {\n        specular /= effectiveSample;\n    }\n    return specular;\n}\n#endif"},74490:e=>{e.exports="\n#ifdef USE_INSTANCING\nin vec3 instOffset;\nin vec4 instRotation;\nin vec3 instScaling;\n#ifdef EVAL_THEMING_VIZFLAGS_IN_SHADER\nin vec4 instThemingColor;\nin uint instFlags;\n#endif\nvec3 applyQuaternion(vec3 p, vec4 q) {\n    return p + 2.0 * cross(q.xyz, cross(q.xyz, p) + q.w * p);\n}\nvec3 getInstancePos(vec3 pos) {\n    return instOffset + applyQuaternion(instScaling * pos, instRotation);\n}\nvec3 getInstanceNormal(vec3 normal) {\n    return applyQuaternion(normal/instScaling, instRotation);\n}\n#else\nvec3 getInstancePos(vec3 pos)       { return pos;    }\nvec3 getInstanceNormal(vec3 normal) { return normal; }\n#endif\n"},53634:e=>{e.exports="\n#define LINE_2D_SHADER 1\n#define TAU     6.28318530718\n#define PI      3.14159265358979\n#define HALF_PI 1.57079632679\n#define PI_0_5  HALF_PI\n#define PI_1_5  4.71238898038\n#define ENABLE_ID_DISCARD\n#define VBB_GT_TRIANGLE_INDEXED  0.0\n#define VBB_GT_LINE_SEGMENT      1.0\n#define VBB_GT_ARC_CIRCULAR      2.0\n#define VBB_GT_ARC_ELLIPTICAL    3.0\n#define VBB_GT_TEX_QUAD          4.0\n#define VBB_GT_ONE_TRIANGLE      5.0\n#define VBB_GT_MSDF_TRIANGLE_INDEXED 6.0\n#define VBB_GT_LINE_SEGMENT_CAPPED 8.0\n#define VBB_GT_LINE_SEGMENT_CAPPED_START 9.0\n#define VBB_GT_LINE_SEGMENT_CAPPED_END 10.0\n#define VBB_GT_LINE_SEGMENT_MITER 11.0\n#define VBB_INSTANCED_FLAG   0.0\n#define VBB_SEG_START_RIGHT  0.0\n#define VBB_SEG_START_LEFT   1.0\n#define VBB_SEG_END_RIGHT    2.0\n#define VBB_SEG_END_LEFT     3.0\n#define LTSCALE 0.25\nvarying vec4 fsColor;\nvarying vec2 fsOffsetDirection;\nvarying vec4 fsMultipurpose;\nvarying float fsHalfWidth;\nvarying vec2 fsVpTC;\nvarying float fsGhosting;\n#ifdef LOADING_ANIMATION\nvarying float loadingProgress;\n#endif\n"},1179:e=>{e.exports="\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n#ifdef POLYGON_OFFSET\n    uniform vec2 polygonOffset;\n    const float epsilon7 = 0.0000001;\n#endif\n    uniform float logDepthBufFC;\n    varying float vFragDepth;\n    varying float vIsPerspective;\n#endif"},40444:e=>{e.exports="\n#ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n        varying float vFragDepth;\n        varying float vIsPerspective;\n    #else\n        uniform float logDepthBufFC;\n    #endif\n    bool isPerspectiveMatrix( mat4 m ) {\n        return m[ 2 ][ 3 ] == - 1.0;\n    }\n#endif"},20990:e=>{e.exports="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n    float logz_depth = vFragDepth;\n#ifdef POLYGON_OFFSET\n    float factor = polygonOffset[0];\n    float units = polygonOffset[1];\n#if __VERSION__ == 300\n    if (factor != 0.0) {\n        float x = dFdx(logz_depth);\n        float y = dFdy(logz_depth);\n        float dz = sqrt(x * x + y * y);\n        logz_depth += dz * factor;\n    }\n#endif\n#endif\n    gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( logz_depth ) * logDepthBufFC * 0.5;\n#endif"},13353:e=>{e.exports="#ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n        vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n    #else\n        if ( isPerspectiveMatrix( projectionMatrix ) ) {\n            gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n            gl_Position.z *= gl_Position.w;\n        }\n    #endif\n#endif"},72373:e=>{e.exports="#if defined(USE_SURFACE_NORMAL_MAP) || defined( USE_LAYERED_NORMAL_MAP ) || defined( USE_TILING_NORMAL )\nvoid heightMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    mat3 mtxTangent = mat3(T, B, N);\n    T = normalize(mtxTangent * (transform * vec3(1.0, 0.0, 0.0)));\n    B = normalize(mtxTangent * (transform * vec3(0.0, 1.0, 0.0)));\n    const float oneThird = 1.0 / 3.0;\n    vec3 avg = vec3(oneThird, oneThird, oneThird);\n    vec2 offset = fwidth(st);\n    float h0 = dot(texture(bumpTexture, st).xyz, avg);\n    float hx = dot(texture(bumpTexture, st + vec2(offset.x, 0.0)).xyz, avg);\n    float hy = dot(texture(bumpTexture, st + vec2(0.0, offset.y)).xyz, avg);\n    vec2 diff = vec2(h0 - hx, h0 - hy) / offset;\n    N = normalize(\n        N + (\n            diff.x * T * bumpScale.x +\n            diff.y * B * bumpScale.y\n        )\n    );\n}\nvoid normalMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    vec3 mapN =  2.0 * texture(bumpTexture, st).xyz - 1.0;\n    mapN.xy *= bumpScale.x;\n    mapN.z *= bumpScale.y;\n    vec3 v = vec3(mapN.y, -mapN.x, 0.0);\n    float c = -mapN.z;\n    mat3 skewV = mat3(\n        0.0, v.z, -v.y,\n        -v.z, 0.0, v.x,\n        v.y, -v.x, 0.0\n    );\n    mat3 rot = mat3(1.0) + skewV + skewV*skewV * 1.0/(1.0-c);\n    N *= rot;\n    T *= rot;\n    B *= rot;\n}\n#endif\n"},1221:e=>{e.exports="vec3 orderedDithering(vec3 col) {\n    const vec4 m0 = vec4( 1.0, 13.0,  4.0, 16.0);\n    const vec4 m1 = vec4( 9.0,  5.0, 12.0,  8.0);\n    const vec4 m2 = vec4( 3.0, 15.0,  2.0, 14.0);\n    const vec4 m3 = vec4(11.0,  7.0, 10.0,  6.0);\n    int i = int(gl_FragCoord.x) & 3;\n    int j = int(gl_FragCoord.y) & 3;\n    vec4 biasRow;\n    if      (i==0) biasRow = m0;\n    else if (i==1) biasRow = m1;\n    else if (i==2) biasRow = m2;\n    else           biasRow = m3;\n    float bias;\n    if      (j==0) bias = biasRow.x;\n    else if (j==1) bias = biasRow.y;\n    else if (j==2) bias = biasRow.z;\n    else           bias = biasRow.w;\n    return col + bias * (1.0 / (17.0 * 256.0));\n}\n"},35496:e=>{e.exports="\nvec4 packDepth( const in float depth ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\nfloat unpackDepth( const in vec4 rgba_depth ) {\n    return dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\n"},9641:e=>{e.exports="\n#define kPI 3.14159265358979\nvec2 encodeNormal (vec3 n) {\n    return (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\nvec3 decodeNormal (vec2 enc) {\n    vec2 ang = enc * 2.0 - 1.0;\n    vec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));\n    vec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\n    return vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}\n"},50433:e=>{e.exports="gl_PointSize = point_size;"},6147:e=>{e.exports="\nvec3 TransmitAdjust(vec3 transmission, vec3 f0)\n{\n   vec3 limit = max(1.0 - f0, 0.00001);\n   return clamp(transmission, vec3(0.0, 0.0, 0.0), limit) / limit;\n}\nfloat ColorToIlluminance(in vec3 color)\n{\n   const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\n   float illuminance = dot(rgb2grey, color);\n   return illuminance;\n}\nvoid applyPrismGlazingOpacity(\n    inout vec4 color,\n    vec3 transmissionF,\n    float transmissionAlpha,\n    float NdotV,\n    float glazingIlluminace)\n{\n    const float third = 1.0/3.0;\n    float transSurface = exp(-(transmissionAlpha + (transmissionAlpha < 0.0025 ? 0.0 : 0.25)) * NdotV * PI);\n    float opacity = 1.0- dot((1.0 - transmissionF), vec3(third,third,third)) * transSurface * glazingIlluminace;\n    opacity = clamp(opacity, 0.01, 0.99);\n    color.a *= opacity;\n}\n"},77019:e=>{e.exports="void applyPrismTransparency(\n    inout vec4 color,\n    vec3 transparentColor,\n    float transparentIor\n) {\n    float fsLevel = max(max(color.r, color.g), color.b);\n    color = vec4(color.rgb/fsLevel, fsLevel);\n    float transLevel = min(min(transparentColor.r, transparentColor.g), transparentColor.b);\n    transLevel = min( (1.0 - surface_roughness), transLevel );\n    float transAlpha = (1.0 - transLevel) * 0.4 + surface_roughness * 0.55;\n    vec3 tr_g_color = sqrt(transparentColor);\n    vec4 transColor = vec4(0.5 * vec3(tr_g_color), transAlpha);\n    float strength = 1.0 - (1.0 - fsLevel) * (1.0 - fsLevel);\n    color = mix(transColor, color, strength);\n    color.a = max(color.a, 0.05);\n    if (transparentIor == 1.0 && tr_g_color == vec3(1.0)) {\n        color.a = 0.0;\n    }\n}"},76332:e=>{e.exports="#if defined( PRISMWOOD )\n#define ONE 0.00390625\nfloat GetIndexedValue(vec4 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else if (index == 2)\n        return array[2];\n    else if (index == 3)\n        return array[3];\n    else\n        return 0.0;\n}\nint GetIndexedValue(ivec2 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else\n        return 0;\n}\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nfloat SampleCurlyPattern(vec2 uv)\n{\n    vec2 uv_wood_curly_distortion_map = (wood_curly_distortion_map_texMatrix * vec3(uv, 1.0)).xy;\n    WOOD_CURLY_DISTORTION_CLAMP_TEST;\n    vec3 curlyDistortion = texture(wood_curly_distortion_map, uv_wood_curly_distortion_map).xyz;\n    if(wood_curly_distortion_map_invert) curlyDistortion = vec3(1.0) - curlyDistortion;\n    return curlyDistortion.r;\n}\nvec3 DistortCurly(vec3 p)\n{\n    if (!wood_curly_distortion_enable) return p;\n    float r = length(p.xy);\n    if (r < 0.00001) return p;\n    const float INV_ANGLE_INTERVAL = 1.27323954;\n    const float NUM_INTERVAL = 8.0;\n    float theta = atan(p.y, p.x);\n    if (theta < 0.0)\n        theta += PI2;\n    float intIdx = theta * INV_ANGLE_INTERVAL;\n    int idx0 = int(mod(floor(intIdx), NUM_INTERVAL));\n    int idx1 = int(mod(ceil(intIdx), NUM_INTERVAL));\n    const vec4 HASH_TABLE1 = vec4(0.450572,0.114598, 0.886043, 0.315119);\n    const vec4 HASH_TABLE2 = vec4(0.216133,0.306264, 0.685616, 0.317907);\n    float offset0 = idx0 < 4 ? GetIndexedValue(HASH_TABLE1, idx0) : GetIndexedValue(HASH_TABLE2, idx0-4);\n    float offset1 = idx1 < 4 ? GetIndexedValue(HASH_TABLE1, idx1) : GetIndexedValue(HASH_TABLE2, idx1-4);\n    const float maxOffset = 100.0;\n    offset0 = (offset0 - 0.5) * maxOffset;\n    offset1 = (offset1 - 0.5) * maxOffset;\n    vec2 uv0 = vec2(p.z + offset0, r);\n    float shiftWeight0 =  SampleCurlyPattern(uv0);\n    vec2 uv1 = vec2(p.z + offset1, r);\n    float shiftWeight1 =  SampleCurlyPattern(uv1);\n    float interpWeight = fract(intIdx);\n    float shiftWeight = mix(shiftWeight0, shiftWeight1, interpWeight);\n    const float INV_MIN_RADIUS = 2.0;\n    float shiftWeightAdjust = smoothstep(0.0, 1.0, r * INV_MIN_RADIUS);\n    r -= wood_curly_distortion_scale * (shiftWeight * shiftWeightAdjust);\n    float thetaNew = atan(p.y, p.x);\n    vec3 pNew = p;\n    pNew.x = r * cos(thetaNew);\n    pNew.y = r * sin(thetaNew);\n    return pNew;\n}\n#endif\nvec3 un2sn(vec3 range)\n{\n    return range * 2.0 - 1.0;\n}\nfloat inoise(vec3 p)\n{\n    vec3 modp = mod(floor(p), 256.0);\n    modp.xy = modp.xy * ONE;\n    vec4 AA = texture(perm2DMap, vec2(modp.x, modp.y), 0.0) * 255.0;\n    AA = AA + modp.z;\n    AA = mod(floor(AA), 256.0);\n    AA *= ONE;\n    vec3 gradx1 = un2sn(texture(permGradMap,vec2(AA.x,0.0),0.0).xyz);\n    vec3 grady1 = un2sn(texture(permGradMap,vec2(AA.y,0.0),0.0).xyz);\n    vec3 gradz1 = un2sn(texture(permGradMap,vec2(AA.z,0.0),0.0).xyz);\n    vec3 gradw1 = un2sn(texture(permGradMap,vec2(AA.w,0.0),0.0).xyz);\n    vec3 gradx2 = un2sn(texture(permGradMap,vec2(AA.x + ONE,0.0),0.0).xyz);\n    vec3 grady2 = un2sn(texture(permGradMap,vec2(AA.y + ONE,0.0),0.0).xyz);\n    vec3 gradz2 = un2sn(texture(permGradMap,vec2(AA.z + ONE,0.0),0.0).xyz);\n    vec3 gradw2 = un2sn(texture(permGradMap,vec2(AA.w + ONE,0.0),0.0).xyz);\n    p -= floor(p);\n    vec3 fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix( mix( mix( dot(gradx1, p ),\n                          dot(gradz1, p + vec3(-1.0, 0.0, 0.0)), fadep.x),\n                     mix( dot(grady1, p + vec3(0.0, -1.0, 0.0)),\n                          dot(gradw1, p + vec3(-1.0, -1.0, 0.0)), fadep.x), fadep.y),\n                mix( mix( dot(gradx2, p + vec3(0.0, 0.0, -1.0)),\n                          dot(gradz2, p + vec3(-1.0, 0.0, -1.0)), fadep.x),\n                     mix( dot(grady2, p + vec3(0.0, -1.0, -1.0)),\n                          dot(gradw2, p + vec3(-1.0, -1.0, -1.0)), fadep.x), fadep.y), fadep.z);\n}\nfloat inoise(float p)\n{\n    float modp = mod(floor(p), 256.0);\n    modp = (modp + 256.0) * ONE;\n    float permx = texture(permutationMap, vec2(modp, 0.0), 0.0).r;\n    float gradx = texture(gradientMap, vec2(permx, 0.0), 0.0).r*2.0-1.0;\n    float permy = texture(permutationMap, vec2(modp + ONE, 0.0), 0.0).r;\n    float grady = texture(gradientMap, vec2(permy, 0.0), 0.0).r*2.0-1.0;\n    p -= floor(p);\n    float fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix(gradx * p, grady * (p - 1.0), fadep);\n}\nfloat multiband_inoise(vec3 p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nfloat multiband_inoise(float p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nvec3 Distort3DCosineRadialDir(vec3 p)\n{\n    float radius = length(p.xy);\n    if (radius < 0.00001) return p;\n    vec2 theta = p.xy / radius;\n    float radiusShift = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= wood_fiber_cosine_bands) break;\n        radiusShift += GetIndexedValue(wood_fiber_cosine_weights, i) * cos(p.z * RECIPROCAL_PI2 * GetIndexedValue(wood_fiber_cosine_frequencies, i));\n    }\n    const float MIN_RADIUS = 1.5;\n    float weight = clamp(radius / MIN_RADIUS, 0.0, 1.0);\n    if(weight >= 0.5)\n        weight = weight * weight * (3.0 - (weight + weight));\n    p.xy += theta * radiusShift * weight;\n    return p;\n}\nvec3 Distort3DPerlin(vec3 p)\n{\n    vec3 pAniso = vec3(p.xy, p.z * wood_fiber_perlin_scale_z);\n    p.xy += multiband_inoise(pAniso, wood_fiber_perlin_bands, wood_fiber_perlin_weights, wood_fiber_perlin_frequencies);\n    return p;\n}\nvec3 Distort(vec3 p)\n{\n    if(wood_fiber_cosine_enable)\n        p = Distort3DCosineRadialDir(p);\n    if(wood_fiber_perlin_enable)\n        p = Distort3DPerlin(p);\n    return p;\n}\nfloat DistortRadiusLength(float radiusLength)\n{\n    radiusLength += multiband_inoise(radiusLength, wood_growth_perlin_bands, wood_growth_perlin_weights, wood_growth_perlin_frequencies);\n    if (radiusLength < 0.0) radiusLength = 0.0;\n    return radiusLength;\n}\nfloat ComputeEarlyWoodRatio(float radiusLength)\n{\n    float fraction = mod(radiusLength, wood_ring_thickness) / wood_ring_thickness;\n    if (fraction <= wood_ring_fraction.y)\n       return 1.0;\n    else if(fraction <= wood_ring_fraction.x)\n       return (1.0 - (fraction - wood_ring_fraction.y) / wood_fall_rise.x);\n    else if(fraction <= wood_ring_fraction.w)\n       return 0.0;\n    else\n       return ((fraction - wood_ring_fraction.w) / wood_fall_rise.y);\n}\nvec3 DistortEarlyColor(vec3 earlyColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_earlycolor_perlin_bands,wood_earlycolor_perlin_weights,wood_earlycolor_perlin_frequencies);\n    earlyColor = pow(abs(earlyColor), vec3(expValue));\n    return earlyColor;\n}\nvec3 DistortLateColor(vec3 lateColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_latecolor_perlin_bands,wood_latecolor_perlin_weights,wood_latecolor_perlin_frequencies);\n    lateColor = pow(abs(lateColor), vec3(expValue));\n    return lateColor;\n}\nvec3 DistortDiffuseColor(vec3 diffAlbedo, vec3 p)\n{\n    p.z *= wood_diffuse_perlin_scale_z;\n    float expValue = 1.0 + multiband_inoise(p, wood_diffuse_perlin_bands, wood_diffuse_perlin_weights, wood_diffuse_perlin_frequencies);\n    diffAlbedo = pow(abs(diffAlbedo), vec3(expValue));\n    return diffAlbedo;\n}\nfloat LayerRoughnessVar(float roughness, float earlyWoodRatio)\n{\n    return earlyWoodRatio * wood_groove_roughness + (1.0 - earlyWoodRatio) * roughness;\n}\nfloat hashword(vec2 k)\n{\n    k = mod(k, vec2(256.0)) * ONE;\n    float a = texture(permutationMap, vec2(k.x, 0.0)).x + k.y ;\n    a = texture(permutationMap, vec2(a, 0.0)).x ;\n    return a*255.0;\n}\nfloat wyvillsq(float rsq)\n{\n    if (rsq >= 1.0) return 0.0;\n    float tmp = 1.0 - rsq;\n    return tmp*tmp*tmp;\n}\nfloat Weight2DNeighborImpulses(vec3 p, float woodWeight)\n{\n    if(woodWeight <= 0.0) return 0.0;\n    float poreRadius = wood_pore_radius * woodWeight;\n    vec2 left = floor((p.xy - poreRadius) / wood_pore_cell_dim);\n    vec2 right = floor((p.xy + poreRadius) / wood_pore_cell_dim);\n    float weight = 0.0;\n    float invRsq = 1.0 / (poreRadius * poreRadius);\n    const float norm =  1.0 / 15.0;\n    for (int j = 0; j <= 4; j++)\n    {\n        if (j > int(right.y - left.y)) continue;\n        for (int i = 0; i <= 4; i++)\n        {\n            if (i > int(right.x - left.x)) continue;\n            vec2 pij = vec2(float(i) + left.x,float(j) + left.y);\n            float hRNum = hashword(pij);\n            float impPosX = mod(hRNum, 16.0) * norm;\n            float impPosY = floor(hRNum / 16.0) * norm;\n            impPosX = (pij.x + impPosX)* wood_pore_cell_dim;\n            impPosY = (pij.y + impPosY)* wood_pore_cell_dim;\n            float dsq = (p.x - impPosX) * (p.x - impPosX) + (p.y - impPosY) * (p.y - impPosY);\n            weight += wyvillsq(dsq * invRsq);\n        }\n    }\n    return weight;\n}\nfloat Weight3DRayImpulses(vec3 p)\n{\n    int segIdx = int(floor(p.z / wood_ray_seg_length_z));\n    float factor = p.z / wood_ray_seg_length_z - float(segIdx);\n    int segIdx1 = segIdx - 1;\n    if ( factor > 0.5 )\n        segIdx1 = segIdx + 1;\n    float theta = atan(p.y, p.x);\n    float sliceIdx = floor(((theta + PI) * RECIPROCAL_PI2) * wood_ray_num_slices);\n    if ( sliceIdx == wood_ray_num_slices)\n        sliceIdx-=1.0;\n    ivec2 arrSegs = ivec2(segIdx, segIdx1);\n    float weight = 0.0;\n    const float norm =  1.0 / 15.0;\n    float radialOffset = 5.0;\n    float radialLength = length(p.xy);\n    for (int seg = 0; seg < 2; seg++)\n    {\n        float hRNum = hashword(vec2(sliceIdx, GetIndexedValue(arrSegs, seg)));\n        float rn1 = mod(hRNum,16.0) * norm;\n        if (radialLength < radialOffset * rn1)\n            continue;\n        float rayTheta = rn1;\n        rayTheta = ( ( sliceIdx + rayTheta ) / wood_ray_num_slices ) * ( 2.0 * PI ) - PI;\n        float rayPosZ = (hRNum/16.0)* norm;\n        rayPosZ = ( float(GetIndexedValue(arrSegs, seg)) + rayPosZ ) * wood_ray_seg_length_z;\n        vec3 pt1 = vec3(0.0);\n        vec3 pt2 = vec3(cos(rayTheta), sin(rayTheta), 0.0);\n        vec3 p1 = p;\n        p1.z -= rayPosZ;\n        p1.z /=  wood_ray_ellipse_z2x;\n        vec3 v1 = pt2 - pt1;\n        vec3 v2 = pt1 - p1;\n        v2 = cross(v1, v2);\n        float dist = length(v2) / length(v1);\n        float invRsq = 1.0 / ( wood_ray_ellipse_radius_x * wood_ray_ellipse_radius_x);\n        weight += wyvillsq( (dist * dist) * invRsq );\n    }\n    return weight;\n}\nvec3 DarkenColorWithPores(vec3 p, vec3 diffColor, float woodWeight)\n{\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float a = wood_pore_color_power - 1.0;\n    float b = 1.0;\n    float y = a * poresWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nvec3 DarkenColorWithRays(vec3 p, vec3 diffColor)\n{\n    float raysWeight = Weight3DRayImpulses(p);\n    float a = wood_ray_color_power - 1.0;\n    float b = 1.0;\n    float y = a * raysWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nfloat ComputeWoodWeight(float earlyWoodRatio)\n{\n    float woodWeight = 0.0;\n    if (wood_pore_type == 0)\n        woodWeight = 1.0;\n    else if (wood_pore_type == 1)\n        woodWeight = earlyWoodRatio;\n    else if (wood_pore_type == 2)\n        woodWeight = 1.0 - earlyWoodRatio;\n    else\n        woodWeight = -1.0;\n    return woodWeight;\n}\n#if defined( PRISMWOODBUMP )\nfloat ComputeEarlyWoodRatioAA(float radiusLength, float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    float samplesf = clamp(4.0 / transPixels, 1.0, 4.0);\n    int samples = int(samplesf);\n    float inverseSamples = 1.0 / float(samples);\n    vec2 rdelta = vec2(dFdx(radiusLength), dFdy(radiusLength)) * inverseSamples;\n    float earlywoodRatio = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= samples) break;\n        for (int j = 0; j < 4; ++j)\n        {\n            if (j >= samples) break;\n            float r = radiusLength + dot(vec2(i, j), rdelta);\n            earlywoodRatio += ComputeEarlyWoodRatio(r);\n        }\n    }\n    return earlywoodRatio * (inverseSamples * inverseSamples);\n}\nfloat LatewoodDepthVariation(float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    return clamp(transPixels * 0.5, 0.0, 1.0);\n}\nfloat LatewoodHeightVariation(float earlyWoodRatio, float latewoodBumpDepth,\n                              float depthVar)\n{\n    return ( 1.0 - earlyWoodRatio ) * latewoodBumpDepth * depthVar;\n}\nfloat PoreDepthVariation(float woodWeight, float invUnitExt)\n{\n    float porePixels = woodWeight * wood_pore_radius * invUnitExt;\n    return clamp(porePixels, 0.0, 1.0);\n}\nfloat PoreHeightVariation(float earlyWoodRatio, float poresWeight, float poreDepth,\n                          float depthVar)\n{\n    return poresWeight * (-1.0 * poreDepth) * depthVar;\n}\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\nvec3 WoodBumpHeight(float heightLeft, float heightRight, float heightBack, float heightFront)\n{\n    const float epsilon = 0.001;\n    float heightDeltaX = heightRight - heightLeft;\n    vec3 Tu = vec3(2.0 * epsilon, 0.0, heightDeltaX);\n    float heightDeltaY = heightFront - heightBack;\n    vec3 Tv = vec3(0.0, 2.0 * epsilon, heightDeltaY);\n    return cross(Tu, Tv);\n}\nvec3 SelectNormal(vec3 N, vec3 bumpN, vec3 V)\n{\n    float bumpNdotV = dot(bumpN, V);\n    if(bumpNdotV > 0.0)\n        return bumpN;\n    else return N;\n}\nfloat MinInverseUnitExtent(vec3 p)\n{\n    return 1.0 / max(max(length(dFdx(p.xy)), length(dFdy(p.xy))), 0.000001);\n}\nfloat HeightVariation(vec3 pos)\n{\n    vec3 p = Distort(pos);\n    float radiusLength = length(p.xy);\n    if (wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n    float invUnitExt = MinInverseUnitExtent(p);\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n    float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float depthVar = PoreDepthVariation(woodWeight, invUnitExt);\n    float poreHeightVariation = -1.0 * poresWeight * wood_pore_depth * depthVar;\n    float latewoodHeightVariation = 0.0;\n    if (wood_use_latewood_bump)\n    {\n        float latewoodDepthVar = LatewoodDepthVariation(invUnitExt);\n        latewoodHeightVariation = (1.0 - earlyWoodRatio) * wood_latewood_bump_depth * latewoodDepthVar;\n    }\n    float sumHeightVariation = poreHeightVariation + latewoodHeightVariation;\n    return sumHeightVariation;\n}\n#endif\nvec3 NoiseWood(vec3 p, inout float roughness)\n{\n    p = Distort(p);\n    float radiusLength = length(p.xy);\n    if(wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n#if defined( PRISMWOODBUMP )\n    float invUnitExt = MinInverseUnitExtent( p );\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n#else\n    float earlyWoodRatio = ComputeEarlyWoodRatio(radiusLength);\n#endif\n    vec3 earlyColor = wood_early_color;\n    if (wood_earlycolor_perlin_enable)\n        earlyColor = DistortEarlyColor(earlyColor, radiusLength);\n    vec3 lateColor;\n    if (wood_use_manual_late_color)\n        lateColor = wood_manual_late_color;\n    else\n        lateColor = pow(abs(earlyColor), vec3(wood_late_color_power));\n    if(wood_latecolor_perlin_enable)\n        lateColor = DistortLateColor(lateColor, radiusLength);\n    vec3 diffAlbedo = earlyWoodRatio * earlyColor + (1.0 - earlyWoodRatio) * lateColor;\n    if(wood_diffuse_perlin_enable)\n        diffAlbedo = DistortDiffuseColor(diffAlbedo, p);\n    if (wood_use_pores)\n    {\n        float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n        diffAlbedo = DarkenColorWithPores(p, diffAlbedo, woodWeight);\n    }\n    if (wood_use_rays)\n        diffAlbedo = DarkenColorWithRays(p, diffAlbedo);\n    if(wood_use_groove_roughness)\n        roughness = LayerRoughnessVar(roughness, earlyWoodRatio);\n    return clamp(diffAlbedo, vec3(0.0), vec3(1.0));\n}\n#if defined(PRISMWOODBUMP)\nvoid getFinalWoodContext(\n    inout vec3 N, vec3 V, inout vec3 Tu, inout vec3 Tv, vec3 p,\n    vec3 geoNormal, vec3 tNormal, mat3 normalMatrix\n) {\n    vec3 offsetTuLeft = p - 0.001 * Tu;\n    vec3 offsetTuRight = p + 0.001 * Tu;\n    vec3 offsetTvLeft = p - 0.001 * Tv;\n    vec3 offsetTvRight = p + 0.001 * Tv;\n    float heightVariationTuLeft = HeightVariation(offsetTuLeft);\n    float heightVariationTuRight = HeightVariation(offsetTuRight);\n    float heightVariationTvLeft = HeightVariation(offsetTvLeft);\n    float heightVariationTvRight = HeightVariation(offsetTvRight);\n    vec3 bumpHeight = WoodBumpHeight(heightVariationTuLeft, heightVariationTuRight, heightVariationTvLeft, heightVariationTvRight);\n    vec3 newNormal = normalize(bumpHeight.x * Tu + bumpHeight.y * Tv + bumpHeight.z * vtNormal);\n    vec3 newNormalView = normalize(vNormalMatrix * newNormal);\n    vec3 selectedNormal = SelectNormal(geoNormal, newNormalView, V);\n    ComputeTangents(selectedNormal, Tu, Tv);\n    Tu = normalize(Tu);\n    Tv = normalize(Tv);\n    N = faceforward(selectedNormal, -V, selectedNormal);\n}\n#endif\n#endif\n"},25424:e=>{e.exports="\nuniform float shadowESMConstant;\nuniform float shadowMapRangeMin;\nuniform float shadowMapRangeSize;\n"},79317:e=>{e.exports="\n#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap;\nuniform vec2      shadowMapSize;\nuniform float     shadowDarkness;\nuniform float     shadowBias;\nuniform vec3      shadowLightDir;\nin vec4 vShadowCoord;\n#include <shadowmap_decl_common>\nfloat getShadowValue() {\n    float fDepth;\n    vec3 shadowColor = vec3( 1.0 );\n    vec3 shadowCoord = vShadowCoord.xyz / vShadowCoord.w;\n    shadowCoord.xyz = 0.5 * (shadowCoord.xyz + vec3(1.0, 1.0, 1.0));\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n    bool inFrustum = all( inFrustumVec );\n    float shadowValue = 1.0;\n    if (inFrustum) {\n        shadowCoord.z = min(0.999, shadowCoord.z);\n        shadowCoord.z -= shadowBias;\n#ifdef USE_HARD_SHADOWS\n        vec4 rgbaDepth = texture( shadowMap, shadowCoord.xy );\n        float fDepth = rgbaDepth.r;\n        if ( fDepth < shadowCoord.z ) {\n            shadowValue = 1.0 - shadowDarkness;\n        }\n#else\n        vec4 rgbaDepth = texture( shadowMap, shadowCoord.xy );\n        float shadowMapValue = rgbaDepth.r;\n        shadowValue = exp(-shadowESMConstant * shadowCoord.z) * shadowMapValue;\n        shadowValue = min(shadowValue, 1.0);\n        shadowValue = mix(1.0 - shadowDarkness, 1.0, shadowValue);\n#endif\n    }\n    return shadowValue;\n}\n#else\nfloat getShadowValue() { return 1.0; }\n#endif\nvec3 applyEnvShadow(vec3 colorWithoutShadow, vec3 worldNormal) {\n#if defined(USE_SHADOWMAP)\n    float dp  = dot(shadowLightDir, worldNormal);\n    float dpValue = (dp + 1.0) / 2.0;\n    dpValue = min(1.0, dpValue * 1.5);\n    float sv = getShadowValue();\n    vec3 result = colorWithoutShadow * min(sv, dpValue);\n    return result;\n#else\n    return colorWithoutShadow;\n#endif\n}\n"},30133:e=>{e.exports="\n#ifdef USE_SHADOWMAP\nout vec4 vShadowCoord;\nuniform mat4 shadowMatrix;\n#endif\n"},40947:e=>{e.exports="\n#ifdef USE_SHADOWMAP\n{\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vShadowCoord = shadowMatrix * worldPosition;\n}\n#endif\n"},15373:e=>{e.exports="#ifdef USE_THEMING\n#if defined(USE_UNIFORM_BUFFER_OBJECTS) || defined(USE_INSTANCING)\nin vec4 themingColor;\n#else\nuniform vec4 themingColor;\n#endif\n#endif"},95898:e=>{e.exports="#ifdef USE_THEMING\n#if defined(USE_UNIFORM_BUFFER_OBJECTS) || defined(USE_INSTANCING)\nout vec4 themingColor;\n#endif\n#endif\n"},78148:e=>{e.exports="#ifdef USE_THEMING\noutFragColor.rgb = mix(outFragColor.rgb, themingColor.rgb, themingColor.a);\n#endif\n"},21787:e=>{e.exports="#ifdef EVAL_THEMING_VIZFLAGS_IN_SHADER\n#ifdef USE_UNIFORM_BUFFER_OBJECTS\n    int idInt = int(id.r*255.0 + id.g*255.0 * 256.0 + id.b*255.0 * 256.0 * 256.0);\n    gl_Position.w *= float(fragMaterialAndDbID[idInt].b & 1);\n    if((fragMaterialAndDbID[idInt].b & 2) == 2)\n        themingColor = vec4(0.4, 0.6, 1.0, 0.8);\n    else\n        themingColor = fragsThemingColor[idInt];\n#endif\n#ifdef USE_INSTANCING\n    gl_Position.w *= float(instFlags & 1u);\n    if((instFlags & 2u) == 2u)\n        themingColor = vec4(0.4, 0.6, 1.0, 0.8);\n    else\n        themingColor = instThemingColor;\n#endif\n#endif"},99607:e=>{e.exports="\nfloat luminance_post(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat luminance_pre(vec3 rgb) {\n    return dot(rgb, vec3(0.212671, 0.715160, 0.072169));\n}\nvec3 xyz2rgb(vec3 xyz) {\n    vec3 R = vec3( 3.240479, -1.537150, -0.498535);\n    vec3 G = vec3(-0.969256,  1.875992,  0.041556);\n    vec3 B = vec3( 0.055648, -0.204043,  1.057311);\n    vec3 rgb;\n    rgb.b = dot(xyz, B);\n    rgb.g = dot(xyz, G);\n    rgb.r = dot(xyz, R);\n    return rgb;\n}\nvec3 rgb2xyz(vec3 rgb) {\n    vec3 X = vec3(0.412453, 0.35758, 0.180423);\n    vec3 Y = vec3(0.212671, 0.71516, 0.0721688);\n    vec3 Z = vec3(0.0193338, 0.119194, 0.950227);\n    vec3 xyz;\n    xyz.x = dot(rgb, X);\n    xyz.y = dot(rgb, Y);\n    xyz.z = dot(rgb, Z);\n    return xyz;\n}\nvec3 xyz2xyY(vec3 xyz) {\n    float sum = xyz.x + xyz.y + xyz.z;\n    sum = 1.0 / sum;\n    vec3 xyY;\n    xyY.z = xyz.y;\n    xyY.x = xyz.x * sum;\n    xyY.y = xyz.y * sum;\n    return xyY;\n}\nvec3 xyY2xyz(vec3 xyY) {\n    float x = xyY.x;\n    float y = xyY.y;\n    float Y = xyY.z;\n    vec3 xyz;\n    xyz.y = Y;\n    xyz.x = x * (Y / y);\n    xyz.z = (1.0 - x - y) * (Y / y);\n    return xyz;\n}\nfloat toneMapCanon_T(float x)\n{\n    float xpow = pow(x, 1.60525727);\n    float tmp = ((1.05542877*4.68037409)*xpow) / (4.68037409*xpow + 1.0);\n    return clamp(tmp, 0.0, 1.0);\n}\nconst float Shift = 1.0 / 0.18;\nfloat toneMapCanonFilmic_NoGamma(float x) {\n    x *= Shift;\n    const float A = 0.2;\n    const float B = 0.34;\n    const float C = 0.002;\n    const float D = 1.68;\n    const float E = 0.0005;\n    const float F = 0.252;\n    const float scale = 1.0/0.833837;\n    return (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;\n}\nvec3 toneMapCanonFilmic_WithGamma(vec3 x) {\n    x *= Shift;\n    const float A = 0.27;\n    const float B = 0.29;\n    const float C = 0.052;\n    const float D = 0.2;\n    const float F = 0.18;\n    const float scale = 1.0/0.897105;\n    return (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;\n}\nvec3 toneMapCanonOGS_WithGamma_WithColorPerserving(vec3 x) {\n    vec3 outColor = x.rgb;\n    outColor = min(outColor, vec3(3.0));\n    float inLum = luminance_pre(outColor);\n    if (inLum > 0.0) {\n        float outLum = toneMapCanon_T(inLum);\n        outColor = outColor * (outLum / inLum);\n        outColor = clamp(outColor, vec3(0.0), vec3(1.0));\n    }\n    float gamma = 1.0/2.2;\n    outColor = pow(outColor, vec3(gamma));\n    return outColor;\n}\n"},97713:e=>{e.exports="\n#ifdef WIDE_LINES\nin vec3 prev;\nin vec3 next;\nin float side;\nuniform vec2 view_size;\nvec2 to2d(vec4 i) {\n  return i.xy / i.w;\n}\n#endif\n"},80862:e=>{e.exports="\n#ifdef WIDE_LINES\nvec4 mvpPosition = projectionMatrix * mvPosition;\nmat3 vectorMatrix = mat3(modelViewMatrix);\nvec2 _pos = to2d(mvpPosition) * view_size;\nvec2 _prev = to2d(projectionMatrix * vec4(mvPosition.xyz + vectorMatrix * (prev * 0.01), 1.0)) * view_size;\nvec2 _next = to2d(projectionMatrix * vec4(mvPosition.xyz - vectorMatrix * (next * 0.01), 1.0)) * view_size;\nvec2 dir1 = _pos - _next;\nvec2 dir2 = _prev - _pos;\ndir2 = (length(dir2) > 0.0000001) ? normalize(dir2) : vec2(0.0, 0.0);\ndir1 = (length(dir1) > 0.0000001) ? normalize(dir1) : dir2;\nvec2 dir_sharp = normalize(dir1 + dir2);\nvec2 dir = normalize(dir1 + dir_sharp);\nvec2 offset = vec2(-dir.y, dir.x);\nfloat len = 1.0 / cross(vec3(offset, 0), vec3(dir1, 0)).z;\noffset *= len;\noffset /= view_size;\noffset *= side;\noffset *= mvpPosition.w;\nmvpPosition.xy += offset;\ngl_Position = mvpPosition;\n#endif\n"},70984:e=>{e.exports="in vec3 vColor;\nin vec2 vUv;\nuniform samplerCube envMap;\nuniform vec3 uCamDir;\nuniform vec3 uCamUp;\nuniform vec2 uResolution;\nuniform float uHalfFovTan;\nuniform float opacity;\nuniform bool envMapBackground;\n#ifdef USE_BACKGROUND_TEXTURE\nuniform sampler2D backgroundTexture;\n#endif\n#include <env_sample>\nconst int bloomRange = 4;\n#include <ordered_dither>\nuniform float envMapExposure;\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include <tonemap>\n#endif\nvec3 rayDir(in vec2 vUv) {\n    vec3 A = (uResolution.x/uResolution.y)*normalize(cross(uCamDir,uCamUp)) * (uHalfFovTan * 2.0);\n    vec3 B = normalize(uCamUp) * (uHalfFovTan * 2.0);\n    vec3 C = normalize(uCamDir);\n    vec3 ray = normalize( C + (2.0*vUv.x-1.0)*A + (2.0*vUv.y-1.0)*B );\n    return ray;\n}\nvec3 getColor(in vec3 rd) {\n    return RGBMDecode(texture(envMap, adjustLookupVector(rd)), envMapExposure);\n}\nvoid main() {\n    vec3 rd = rayDir(vUv);\n    vec3 outColor;\n    float alpha = opacity;\n#ifdef USE_BACKGROUND_TEXTURE\n    vec4 texel = texture(backgroundTexture, vUv);\n    outColor = texel.rgb;\n    alpha *= texel.a;\n#else\n    if (envMapBackground) {\n        outColor = getColor(rd);\n#if TONEMAP_OUTPUT == 1\n        outColor = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * outColor);\n#elif TONEMAP_OUTPUT == 2\n        outColor = toneMapCanonFilmic_WithGamma(exposureBias * outColor);\n#endif\n    }\n    else {\n        outColor = vColor;\n    }\n#endif\n    outFragColor = vec4(orderedDithering(outColor), alpha);\n}\n"},8071:e=>{e.exports="uniform vec3 color1;\nuniform vec3 color2;\nout vec2 vUv;\nout vec3 vColor;\nvoid main() {\n    if (uv.y == 0.0)\n        vColor = color2;\n    else\n        vColor = color1;\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},27608:e=>{e.exports="#ifdef USE_UNIFORM_BUFFER_OBJECTS\nuniform materials {\n    vec4 matsDiffuseAndOpacity[MAX_UBO_MATERIALS];\n};\nuniform fragments {\n    ivec3 fragMaterialAndDbID[MAX_UBO_FRAGMENTS];\n    vec4 fragsThemingColor[MAX_UBO_FRAGMENTS];\n};\n#else\nuniform vec3 diffuse;\nuniform float opacity;\n#endif\n#if defined(DEPTH_OCCLUSION) && DEPTH_OCCLUSION == 1\nuniform sampler2D tDepthTest;\nuniform vec2 tDepthResolution;\nin float vDepthPositionZ;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#if NUM_CUTPLANES > 0\nin highp vec3 vWorldPosition;\n#endif\n#if defined( PARTICLE_UV )\nin highp vec4 vUVp;\n#endif\n#include <cutplanes>\n#include <id_decl_frag>\n#include <theming_decl_frag>\n#include <logdepthbuf_decl_frag>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 outgoingLight = vec3( 0.0 );\n#ifdef USE_UNIFORM_BUFFER_OBJECTS\n    int id = int(vId.r*255.0 + vId.g*255.0 * 256.0 + vId.b*255.0 * 256.0 * 256.0);\n    int dbIdInt = fragMaterialAndDbID[id].g;\n    int matId = fragMaterialAndDbID[id].r;\n    vec4 diffuseColor = matsDiffuseAndOpacity[matId];\n#else\n    vec4 diffuseColor = vec4( diffuse, opacity );\n#endif\n#if defined( USE_MAP ) && defined ( PARTICLE_FRAGMENT )\n    #if defined( PARTICLE_UV )\n        vec2 uv3 = mix( vUVp.xy, vUVp.zw, gl_PointCoord );\n        diffuseColor = texture( map, uv3);\n    #else\n        diffuseColor = texture( map, gl_PointCoord );\n    #endif\n#else\n    #include <map_fragment>\n#endif\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <specularmap_fragment>\n    outgoingLight = diffuseColor.rgb;\n#if !defined ( PARTICLE_FRAGMENT )\n    #include <lightmap_fragment>\n    #include <envmap_fragment>\n#endif\n#include <linear_to_gamma_fragment>\n    outFragColor = vec4( outgoingLight, diffuseColor.a );\n    vec3 geomNormal = vec3(0.0,0.0,0.0);\n    float depth = 0.0;\n#include <theming_frag>\n#if defined(DEPTH_OCCLUSION) && DEPTH_OCCLUSION == 1\n    vec2 depthUV = gl_FragCoord.xy * tDepthResolution;\n    float depthVal = texture(tDepthTest, depthUV).z;\n    if(depthVal > vDepthPositionZ && depthVal != 0.) {\n        discard;\n    }\n#endif\n#include <final_frag>\n#include <logdepthbuf_frag>\n}\n"},21175:e=>{e.exports="#include <id_decl_vert>\n#include <decl_point_size>\n#include <common>\n#include <map_pars_vertex>\n#include <lightmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <wide_lines_decl>\n#include <pack_normals>\n#include <logdepthbuf_decl_vert>\n#ifdef USE_INSTANCING\n    #include <instancing_decl_vert>\n#endif\n#ifdef USE_UNIFORM_BUFFER_OBJECTS\n    uniform fragments {\n        ivec3 fragMaterialAndDbID[MAX_UBO_FRAGMENTS];\n        vec4 fragsThemingColor[MAX_UBO_FRAGMENTS];\n    };\n#endif\n#if defined( PARTICLE_UV )\nin vec4 uvp;\nout highp vec4 vUVp;\n#endif\n#if defined (PARTICLE_FLAGS)\nin float pointScale;\n#endif\n#if NUM_CUTPLANES > 0\nout vec3 vWorldPosition;\n#endif\n#if defined(DEPTH_OCCLUSION) && DEPTH_OCCLUSION == 1\nout float vDepthPositionZ;\n#endif\n#include <theming_decl_vert>\nvoid main() {\n#ifdef USE_INSTANCING\n    vec3 instancePosition = getInstancePos(position);\n    #define position instancePosition\n#endif\n#if defined(USE_ENVMAP) && (defined(UNPACK_NORMALS) || defined(USE_INSTANCE))\n    vec3 correctNormal;\n    #ifdef UNPACK_NORMALS\n        correctNormal = decodeNormal(normal);\n    #else\n        correctNormal = normal;\n    #endif\n    #ifdef USE_INSTANCING\n        correctNormal = getInstanceNormal(correctNormal);\n    #endif\n    #define normal correctNormal\n#endif\n#include <map_vertex>\n#include <lightmap_vertex>\n#include <color_vertex>\n#ifdef USE_ENVMAP\n#include <defaultnormal_vertex>\n#endif\n#include <default_vertex>\n#include <wide_lines_vert>\n#include <worldpos_vertex>\n#if NUM_CUTPLANES > 0\n    vec4 _worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = _worldPosition.xyz;\n#endif\n#if defined(DEPTH_OCCLUSION) && DEPTH_OCCLUSION == 1\n    vec4 _vDepthPosition = modelViewMatrix * vec4( position, 1.0 );\n    vDepthPositionZ = _vDepthPosition.z;\n#endif\n#if defined( PARTICLE_UV )\n    vUVp = uvp;\n#endif\n#include <envmap_vertex>\n#include <id_vert>\n#include <point_size>\n#if defined (PARTICLE_FLAGS)\n    gl_PointSize *= clamp(pointScale, 0.0, 2.0);\n#endif\n#include <logdepthbuf_vert>\n#include <theming_vizflag_vert>\n}\n"},66299:e=>{e.exports="uniform sampler2D tDiffuse;\nuniform sampler2D tAO;\nuniform int useAO;\nuniform float aoOpacity;\nuniform sampler2D tOverlay;\nuniform int useOverlay;\nuniform int useOverlayAlpha;\nuniform vec2 resolution;\nuniform vec4 objIDv4;\nuniform sampler2D tID;\nuniform vec4 edgeObjIDv4;\n#if defined(USE_MODEL_ID)\n#if defined(HIGHLIGHT_MODEL_ID_COUNT)\nuniform vec2 modelIDsv2v[HIGHLIGHT_MODEL_ID_COUNT];\n#else\nuniform vec2 modelIDv2;\n#endif\nuniform sampler2D tID2;\nuniform vec2 edgeModelIDv2;\n#endif\nuniform float highlightIntensity;\nuniform vec3 selectionColor;\nuniform float highlightFullModel;\nuniform vec3 highlightColor;\n#ifdef IS_2D\nuniform float expand2dSelection;\n#endif\nuniform sampler2D tCrossFadeTex0;\nuniform sampler2D tCrossFadeTex1;\nuniform float     crossFadeOpacity0;\nuniform float     crossFadeOpacity1;\nin vec2 vUv;\n#ifdef SPATIAL_FILTER\n#include <depth_texture>\n#endif\n#include <tonemap>\n#ifdef USE_IDBUFFER_SELECTION\nbool isSelection(vec2 vUv, float I, float J) {\n    vec4 idAtPixel = texture(tID, vUv+resolution*vec2(I,J));\n    if (idAtPixel.rgb == vec3(0.0))\n        return false;\n#if defined(USE_MODEL_ID)\n    vec4 modelAtPixel = texture(tID2, vUv+resolution*vec2(I,J));\n    idAtPixel.a = modelAtPixel.b;\n    vec4 idDelta = abs(idAtPixel.rgba - edgeObjIDv4.rgba);\n    vec2 modelDelta = abs(modelAtPixel.rg - edgeModelIDv2.rg);\n#else\n    vec4 idDelta = vec4(abs(idAtPixel.rgb - edgeObjIDv4.rgb), 0.0);\n    vec2 modelDelta = vec2(0.0, 0.0);\n#endif\n    if (max(max(modelDelta.r, modelDelta.g), max(max(idDelta.r, idDelta.g), max(idDelta.b, idDelta.a))) < 1e-3) {\n        return true;\n    } else {\n        return false;\n    }\n}\n#else\nbool isSelected(vec3 C) {\n    float minS = min(selectionColor.r, min(selectionColor.g, selectionColor.b));\n    float maxS = max(selectionColor.r, max(selectionColor.g, selectionColor.b));\n    float satS = maxS - minS;\n    float minC = min(C.r, min(C.g, C.b));\n    float maxC = max(C.r, max(C.g, C.b));\n    float satC = maxC - minC;\n    if (satC < .01 || satS < .01)\n        return false;\n    vec3 S = (selectionColor - minS) / satS;\n    vec3 H = (C - minC) / satC;\n    vec3 D = H - S;\n    float eps = .15;\n    return (abs(D.r) + abs(D.g) + abs(D.b) < eps)\n        || (maxC >= (1.0 - eps) && D.r >= -eps && D.g >= -eps && D.b >= -eps);\n}\n#define IS_SELECTION(C) isSelected((C).rgb)\n#endif\nvec4 overlayEdgeDetect(vec2 vUv) {\n#ifdef IS_2D\n#define MAX_ALPHA(c)\n#define SUM_ALPHA(c, w) sumAlpha += c.a * w; sumWeight += w;\n#else\n#define MAX_ALPHA(c) maxAlpha = max(maxAlpha, c.a);\n#define SUM_ALPHA(c, w)\n#endif\n#ifdef USE_IDBUFFER_SELECTION\n#define CHECK_EDGE_ALPHA(I, J, W)     { vec4 c = texture( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a > 0.0 && isSelection(vUv, I, J)) { hasEdge++; SUM_ALPHA(c, W) selectionPixel = c; } }\n#else\n#define CHECK_EDGE_ALPHA(I, J, W)     { vec4 c = texture( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a > 0.0 && IS_SELECTION(c)) { hasEdge++; SUM_ALPHA(c, W) selectionPixel = c; } }\n#endif\n#ifndef IS_2D\n#define CHECK_EDGE_SELECTION(I, J) { vec4 c = texture( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a <= 0.0) hasEdge++; }\n#endif\n    int hasEdge = 0;\n    vec4 center = texture(tOverlay, vUv);\n    vec4 selectionPixel = vec4(0.0);\n#ifdef IS_2D\n    float sumAlpha = 0.0, sumWeight = 0.0;\n#else\n    float maxAlpha = 0.0;\n    bool paintOutline = false;\n#endif\n    if (center.a <= 0.0) {\n        CHECK_EDGE_ALPHA(-1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0,-1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA(-1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA(-1.0, 1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0, 1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 1.0, 1.0);\n        if (hasEdge != 0) {\n#ifdef IS_2D\n            center.a = -clamp(expand2dSelection - 1.0 + sumAlpha / sumWeight, 0.0, 1.0);\n            center.rgb = center.a < 0.0 ? selectionPixel.rgb : center.rgb;\n#else\n            center = selectionPixel;\n            paintOutline = true;\n#endif\n        }\n    }\n#ifdef USE_IDBUFFER_SELECTION\n    else if (center.a > 0.0 && isSelection(vUv, 0.0, 0.0)) {\n#else\n    else if (center.a > 0.0 && IS_SELECTION(center)) {\n#endif\n#ifdef IS_2D\n        center.a = -clamp(center.a + expand2dSelection, 0.0, 1.0);\n#else\n        CHECK_EDGE_SELECTION(-1.0,-1.0);\n        CHECK_EDGE_SELECTION( 0.0,-1.0);\n        CHECK_EDGE_SELECTION( 1.0,-1.0);\n        CHECK_EDGE_SELECTION(-1.0, 0.0);\n        CHECK_EDGE_SELECTION( 1.0, 0.0);\n        CHECK_EDGE_SELECTION(-1.0, 1.0);\n        CHECK_EDGE_SELECTION( 0.0, 1.0);\n        CHECK_EDGE_SELECTION( 1.0, 1.0);\n        if (hasEdge != 0)\n            paintOutline = true;\n        else\n            center.a = -center.a;\n#endif\n    }\n#ifndef IS_2D\n    if (paintOutline) {\n        float maxComponent = max(center.r, max(center.g, center.b));\n        center.rgb /= maxComponent;\n        center.rgb = sqrt(center.rgb);\n        center.a = 0.5 + 0.5 * maxAlpha * 0.125 * float(hasEdge);\n    }\n#endif\n    return center;\n}\n#ifdef SPATIAL_FILTER\nSPATIAL_FILTER\n#endif\nvec4 sampleColor() {\n    return texture( tDiffuse, vUv );\n}\nfloat sampleAO() {\n    return (useAO != 0) ? sqrt(texture(tAO, vUv).r) : 1.0;\n}\nvec3 applyCrossFade(vec3 srcColor, sampler2D fadeTex, float opacity, vec2 vUv) {\n    vec4 blendCol = texture(fadeTex, vUv);\n    return mix(srcColor.rgb, blendCol.rgb, blendCol.a * opacity);\n}\nvoid applyHighlighting(inout vec3 rgb, float filterValue) {\n#ifdef IS_2D\n    rgb = mix(rgb, vec3(1.0,1.0,0.0), filterValue * highlightIntensity * 0.25);\n#else\n    rgb += highlightColor * filterValue * highlightIntensity * 0.20;\n#endif\n}\n#ifdef USE_MODEL_ID\nfloat getModelIdDelta(vec2 a, vec2 b) {\n    vec2 delta = abs(a-b);\n    return max(delta.r, delta.g);\n}\nfloat getModelIdDelta(vec2 modelAtPixel) {\n#ifdef HIGHLIGHT_MODEL_ID_COUNT\n    float delta = 1.0;\n    for (int i=0; i<HIGHLIGHT_MODEL_ID_COUNT; i++) {\n        delta = min(delta, getModelIdDelta(modelAtPixel, modelIDsv2v[i]));\n    }\n    return delta;\n#else\n    return getModelIdDelta(modelAtPixel, modelIDv2.rg);\n#endif\n}\n#endif\nvoid main() {\n    vec4 texel = sampleColor();\n    float ao = sampleAO();\n    #ifdef NUM_CROSSFADE_TARGETS\n        #if (NUM_CROSSFADE_TARGETS > 1)\n            #if (TARGET_FADE_MODE == 0)\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex0, crossFadeOpacity0, vUv);\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex1, crossFadeOpacity1, vUv);\n            #else\n                vec4 t0 = texture(tCrossFadeTex0, vUv);\n                vec4 t1 = texture(tCrossFadeTex1, vUv);\n                vec4 mixed = mix(t0, t1, crossFadeOpacity1);\n                texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n                float aoGamma = 1.0 + 3.0 * (1.0 - 2.0 * abs(crossFadeOpacity1 - 0.5));\n                if (aoGamma == 0.0)\n                    aoGamma = 1.0;\n                ao = pow(ao, 1.0 / aoGamma);\n            #endif\n        #else\n            vec4 mixed = texture(tCrossFadeTex0, vUv);\n            texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n        #endif\n    #else\n    #endif\n    ao = 1.0 - (1.0 - ao) * aoOpacity;\n    texel.rgb *= ao;\n    if (useOverlay != 0) {\n        vec4 overlay = overlayEdgeDetect(vUv);\n        if (overlay.a < 0.0) {\n            overlay.a = -overlay.a;\n#ifdef IS_2D\n            overlay.a *= 0.6;\n#else\n            if (overlay.a >= 0.99) {\n                overlay.a = 0.75;\n                texel.rgb = vec3(luminance_post(texel.rgb));\n            }\n#endif\n        }\n#ifdef IS_2D\n        texel.rgb = texel.rgb * (1.0 - overlay.a) + overlay.rgb;\n#else\n        texel.rgb = texel.rgb * (1.0 - overlay.a) + sqrt(overlay.rgb * overlay.a);\n#endif\n        if (useOverlayAlpha != 0) {\n            texel.a += overlay.a * (1.0 - texel.a);\n        }\n    }\n    if (objIDv4 != vec4(0.0)) {\n    vec4 idAtPixel = texture(tID, vUv);\n    #ifdef SPATIAL_FILTER\n        vec3 worldPos = reconstructWorldPosition(gl_FragCoord.xy, vUv);\n        float filterValue = (spatialFilter(worldPos) ? 1.0 : 0.0);\n        if (idAtPixel != vec4(1,1,1,1)) {\n            applyHighlighting(texel.rgb, filterValue);\n        }\n    #else\n        #if defined(USE_MODEL_ID)\n            vec4 modelAtPixel = texture(tID2, vUv);\n            idAtPixel.a = modelAtPixel.b;\n            vec4 idDelta = abs(idAtPixel.rgba - objIDv4.rgba) * (1.0 - highlightFullModel);\n            float modelDelta = getModelIdDelta(modelAtPixel.rg);\n        #else\n            vec4 idDelta = vec4(abs(idAtPixel.rgb - objIDv4.rgb), 0.0);\n            float modelDelta = 0.0;\n        #endif\n            if (max(modelDelta, max(max(idDelta.r, idDelta.g), max(idDelta.b, idDelta.a))) < 1e-3) {\n                applyHighlighting(texel.rgb, 1.0);\n            }\n    #endif\n    }\n    outFragColor = texel;\n}\n"},91342:e=>{e.exports="\n#include <depth_texture>\nuniform sampler2D tDiffuse;\nuniform sampler2D tID;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform sampler2D tFill;\nuniform sampler2D tPaper;\nuniform int style;\nuniform int idEdges;\nuniform int normalEdges;\nuniform int depthEdges;\nuniform float brightness;\nuniform float contrast;\nuniform int grayscale;\nuniform int preserveColor;\nuniform int outlineNoise;\nuniform float levels;\nuniform float repeats;\nuniform float rotation;\nuniform float outlineRadius;\nuniform sampler2D tGraphite1;\nuniform sampler2D tGraphite2;\nuniform sampler2D tGraphite3;\nuniform sampler2D tGraphite4;\nuniform sampler2D tGraphite5;\nuniform sampler2D tGraphite6;\nuniform sampler2D tGraphite7;\nuniform sampler2D tGraphite8;\nin vec2 vUv;\nvec4 recoverNZ(vec4 nrmz) {\n    float z = sqrt(1.0 - dot(nrmz.xy, nrmz.xy));\n    nrmz.w = -(nrmz.z + cameraNear) / (cameraFar - cameraNear);\n    nrmz.z = z;\n    return nrmz;\n}\n#include <tonemap>\n#include <hsv>\nvec3 quantize(vec3 c) {\n    float L = max(c.r, max(c.g, c.b));\n    c *= floor(L * (levels-1.0) + 0.5) / (L * (levels-1.0));\n    return c;\n}\nvec3 quantizeRGB(vec3 c) {\n    c *= c;\n    c *= floor(c * levels * 0.9999) / (levels-1.0);\n    return sqrt(c);\n}\nvec3 clampHue(vec3 c, float hues, float sats, float vals) {\n    vec3 hsv = rgb2hsv(c);\n    hsv.x = floor(hsv.x * hues + 0.5) / hues;\n    hsv.y = floor(hsv.y * sats + 0.5) / sats;\n    hsv.z = floor(hsv.z * vals + 0.5) / vals;\n    vec3 col = hsv2rgb(hsv);\n    return col;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nint isObjectEdge() {\n    vec2 uv = vUv;\n    if (outlineNoise == 1) {\n        vec4 noise = texture(tGraphite7, vUv);\n        uv = vUv + 0.02 * (noise.xy - vec2(0.25));\n    }\n    vec4 MM = texture(tID, uv);\n    vec4 LL = texture(tID, uv + vec2(-outlineRadius, -outlineRadius) * resolution);\n    if (MM != LL) return 1;\n    vec4 LM = texture(tID, uv + vec2( 0.0, -outlineRadius) * resolution);\n    if (MM != LM) return 1;\n    vec4 LR = texture(tID, uv + vec2( outlineRadius, -outlineRadius) * resolution);\n    if (MM != LR) return 1;\n    vec4 ML = texture(tID, uv + vec2(-outlineRadius,  0.0) * resolution);\n    if (MM != ML) return 1;\n    vec4 MR = texture(tID, uv + vec2( outlineRadius,  0.0) * resolution);\n    if (MM != MR) return 1;\n    vec4 UL = texture(tID, uv + vec2(-outlineRadius,  outlineRadius) * resolution);\n    if (MM != UL) return 1;\n    vec4 UM = texture(tID, uv + vec2( 0.0,  outlineRadius) * resolution);\n    if (MM != UM) return 1;\n    vec4 UR = texture(tID, uv + vec2( outlineRadius,  outlineRadius) * resolution);\n    if (MM != UR) return 1;\n    return (MM.x + MM.y + MM.z + MM.w) >= 4.0 ? 0 : -1;\n}\nfloat normalDiff(vec3 n1, vec3 n2) {\n    float d = dot(n1.xyz, n2.xyz);\n    return acos(clamp(d, -1.0, 1.0));\n}\nint isNormalDepthEdge() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec2 uv = vUv;\n    if (outlineNoise == 1) {\n        vec4 noise = texture(tGraphite7, vUv);\n        uv = vUv + 0.02 * (noise.xy - vec2(0.25));\n    }\n    vec4 MM = texture(tDepth, uv);\n    vec4 LL = texture(tDepth, uv + vec2(-outlineRadius, -outlineRadius) * resolution);\n    vec4 LM = texture(tDepth, uv + vec2( 0.0, -outlineRadius) * resolution);\n    vec4 LR = texture(tDepth, uv + vec2( outlineRadius, -outlineRadius) * resolution);\n    vec4 ML = texture(tDepth, uv + vec2(-outlineRadius,  0.0) * resolution);\n    vec4 MR = texture(tDepth, uv + vec2( outlineRadius,  0.0) * resolution);\n    vec4 UL = texture(tDepth, uv + vec2(-outlineRadius, outlineRadius) * resolution);\n    vec4 UM = texture(tDepth, uv + vec2( 0.0,  outlineRadius) * resolution);\n    vec4 UR = texture(tDepth, uv + vec2( outlineRadius,  outlineRadius) * resolution);\n    LL = recoverNZ(LL);\n    LM = recoverNZ(LM);\n    LR = recoverNZ(LR);\n    ML = recoverNZ(ML);\n    MM = recoverNZ(MM);\n    MR = recoverNZ(MR);\n    UL = recoverNZ(UL);\n    UM = recoverNZ(UM);\n    UR = recoverNZ(UR);\n    float dd = 0.0;\n    if ( depthEdges == 1 ) {\n        float G = (abs(UL.w - MM.w) + 2.0 * abs(UM.w - MM.w) + abs(UR.w - MM.w) + 2.0 * abs(ML.w - MM.w) + 2.0 * abs(MR.w - MM.w) + abs(LL.w - MM.w) + 2.0 * abs(LM.w - MM.w) + abs(LR.w - MM.w));\n        dd = abs(dFdx(G)) + abs(dFdy(G));\n    }\n    float Gn = 0.0;\n    if ( normalEdges == 1 ) {\n        float pLL = normalDiff(LL.xyz, MM.xyz);\n        float pLM = normalDiff(LM.xyz, MM.xyz);\n        float pLR = normalDiff(LR.xyz, MM.xyz);\n        float pML = normalDiff(ML.xyz, MM.xyz);\n        float pMM = normalDiff(MM.xyz, MM.xyz);\n        float pMR = normalDiff(MR.xyz, MM.xyz);\n        float pUL = normalDiff(UL.xyz, MM.xyz);\n        float pUM = normalDiff(UM.xyz, MM.xyz);\n        float pUR = normalDiff(UR.xyz, MM.xyz);\n        Gn = (abs(pUL - pMM) + 2.0 * abs(pUM - pMM) + abs(pUR - pMM) + 2.0 * abs(pML - pMM) + 2.0 * abs(pMR - pMM) + abs(pLL - pMM) + 2.0 * abs(pLM - pMM) + abs(pLR - pMM));\n    }\n    return (dd > 0.004 || Gn > 2.0) ? 1 : 0;\n}\nvec3 computeGraphite( vec3 color, vec2 loc ) {\n    float lum = 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;\n    float offset;\n    vec3 col1, col2;\n    if ( lum > 6.0/7.0 ) {\n        col1 = texture(tGraphite1, loc ).xyz;\n        col2 = texture(tGraphite2, loc ).xyz;\n        offset = 6.0/7.0;\n    } else if ( lum > 5.0/7.0 ) {\n        col1 = texture(tGraphite2, loc ).xyz;\n        col2 = texture(tGraphite3, loc ).xyz;\n        offset = 5.0/7.0;\n    } else if ( lum > 4.0/7.0 ) {\n        col1 = texture(tGraphite3, loc ).xyz;\n        col2 = texture(tGraphite4, loc ).xyz;\n        offset = 4.0/7.0;\n    } else if ( lum > 3.0/7.0 ) {\n        col1 = texture(tGraphite4, loc ).xyz;\n        col2 = texture(tGraphite5, loc ).xyz;\n        offset = 3.0/7.0;\n    } else if ( lum > 2.0/7.0 ) {\n        col1 = texture(tGraphite5, loc ).xyz;\n        col2 = texture(tGraphite6, loc ).xyz;\n        offset = 2.0/7.0;\n    } else if ( lum > 1.0/7.0 ) {\n        col1 = texture(tGraphite6, loc ).xyz;\n        col2 = texture(tGraphite7, loc ).xyz;\n        offset = 1.0/7.0;\n    } else {\n        col1 = texture(tGraphite7, loc ).xyz;\n        col2 = texture(tGraphite8, loc ).xyz;\n        offset = 0.0;\n    }\n    if ( col1.r == 0.0 && col2.r == 0.0 ) {\n        return vec3(lum,lum,lum);\n    }\n    float t = (lum-offset)*7.0;\n    return (col1 * t + col2 * (1.0 - t));\n}\nvec3 colorWithAdjustments() {\n    vec3 sceneRGB = texture(tDiffuse, vUv).xyz;\n    if ( brightness != 0.0 || contrast != 0.0) {\n        if ( brightness < 0.0 )\n        {\n            sceneRGB = sceneRGB * (1.0 + brightness);\n        }\n        else\n        {\n            sceneRGB = sceneRGB + ((1.0 - sceneRGB) * brightness);\n        }\n        float slant = tan(( clamp(contrast,-1.0,1.0) + 1.0) * 3.141592/4.001);\n        sceneRGB = (sceneRGB - 0.5) * slant + 0.5;\n        if ( preserveColor == 1 )\n        {\n            float maxval = max( sceneRGB.r, sceneRGB.g );\n            maxval = max( maxval, sceneRGB.b );\n            if ( maxval > 1.0 )\n            {\n                sceneRGB /= maxval;\n            }\n        }\n        sceneRGB = clamp(sceneRGB,0.0,1.0);\n    }\n    if ( grayscale == 1 ) {\n        sceneRGB.rgb = vec3(luminance_post(sceneRGB.rgb));\n    }\n    return sceneRGB;\n}\nvoid main() {\n    int foundEdge = 0;\n    foundEdge = ( idEdges == 1 && isObjectEdge() == 1 ) ? 1 : 0;\n    if ( foundEdge == 0 && (normalEdges == 1 || depthEdges == 1) ) {\n        foundEdge = isNormalDepthEdge();\n    }\n    vec2 loc = vec2((vUv.x-0.5)*(resolution.y/resolution.x),vUv.y-0.5)*repeats;\n    if ( style > 2 && rotation != 0.0 ) {\n        float rot = 3.14159*rotation;\n        float sinr = sin(rot);\n        float cosr = cos(rot);\n        loc = vec2(loc.x*cosr + -loc.y*sinr, loc.x*sinr + loc.y*cosr);\n    }\n    loc += vec2(0.5,0.5);\n    vec3 color;\n    if ( style == 2 ) {\n        if ( foundEdge == 1 ) {\n            outFragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            outFragColor = vec4(quantize(colorWithAdjustments()),1.0);\n        }\n    } else if ( style == 3 ) {\n        color = colorWithAdjustments();\n        vec3 graphColor = computeGraphite( color, loc );\n        if ( foundEdge == 1 ) {\n            outFragColor = vec4(0.16,0.16,0.16,1.0) + vec4(0.18 * graphColor,0.0);\n        } else {\n            outFragColor = vec4(graphColor,1.0);\n        }\n        return;\n    } else if ( style == 4 ) {\n        float fill = texture(tFill, loc ).r;\n        float paperStrength = 0.3;\n        vec3 paper = texture(tPaper, loc ).rgb;\n        paper = paperStrength * paper + (1.0-paperStrength)*vec3(1.0,1.0,1.0);\n        if ( foundEdge == 1 ) {\n            outFragColor = 0.75 * vec4(paper * fill, 1.0);\n        } else {\n            fill = pow(fill,1.6);\n            outFragColor = vec4(colorWithAdjustments() * (1.0 - fill) + paper * fill, 1.0);\n        }\n    } else {\n        if ( foundEdge == 1 ) {\n            outFragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            outFragColor = vec4(colorWithAdjustments(),1.0);\n        }\n        return;\n    }\n}\n"},78551:e=>{e.exports="uniform sampler2D tDiffuse;\nin vec2 vUv;\nvoid main() {\n    outFragColor = texture(tDiffuse, vUv);\n}\n"},94727:e=>{e.exports="\n#if NUM_CUTPLANES > 0\nin vec3 vWorldPosition;\n#endif\n#include <logdepthbuf_decl_frag>\n#define LINE_CUTPLANE\n#include <cutplanes>\nuniform vec4 color;\n#include <id_decl_frag>\nvoid main() {\n#include <logdepthbuf_frag>\n#if NUM_CUTPLANES > 0\n    if (checkCutPlanes(vWorldPosition)) return;\n#endif\n    outFragColor = color;\n#ifdef MRT_NORMALS\noutNormal = vec4(0.0);\n#endif\n#ifdef MRT_ID_BUFFER\n    outId = vec4(0.0);\n    #ifdef MODEL_COLOR\n        outModelId = vec4(0.0);\n    #endif\n#elif defined(ID_COLOR)\n    outFragColor = vec4(0.0);\n#elif defined(MODEL_COLOR)\n    outFragColor = vec4(0.0);\n#endif\n}\n"},9696:e=>{e.exports="\n#if NUM_CUTPLANES > 0\nout vec3 vWorldPosition;\n#endif\n#include <logdepthbuf_decl_vert>\n#include <instancing_decl_vert>\nvoid main() {\n    vec3 instPos = getInstancePos(position);\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n#include <logdepthbuf_vert>\n}"},49248:e=>{e.exports="#define FXAA_EDGE_SHARPNESS (8.0)\n#define FXAA_EDGE_THRESHOLD (0.125)\n#define FXAA_EDGE_THRESHOLD_MIN (0.05)\n#define FXAA_RCP_FRAME_OPT (0.50)\n#define FXAA_RCP_FRAME_OPT2 (2.0)\nuniform sampler2D tDiffuse;\nuniform highp vec2 uResolution;\nin vec2 vPos;\nin vec4 vPosPos;\nfloat FxaaLuma(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nvoid main() {\n    float lumaNw = FxaaLuma(texture(tDiffuse, vPosPos.xy).rgb);\n    float lumaSw = FxaaLuma(texture(tDiffuse, vPosPos.xw).rgb);\n    float lumaNe = FxaaLuma(texture(tDiffuse, vPosPos.zy).rgb) + 1.0/384.0;\n    float lumaSe = FxaaLuma(texture(tDiffuse, vPosPos.zw).rgb);\n    vec4 rgbaM = texture(tDiffuse, vPos.xy);\n    float lumaM = FxaaLuma(rgbaM.rgb);\n    float lumaMax = max(max(lumaNe, lumaSe), max(lumaNw, lumaSw));\n    float lumaMin = min(min(lumaNe, lumaSe), min(lumaNw, lumaSw));\n    float lumaMaxSubMinM = max(lumaMax, lumaM) - min(lumaMin, lumaM);\n    float lumaMaxScaledClamped = max(FXAA_EDGE_THRESHOLD_MIN, lumaMax * FXAA_EDGE_THRESHOLD);\n    if (lumaMaxSubMinM < lumaMaxScaledClamped) {\n        outFragColor = rgbaM;\n        return;\n    }\n    float dirSwMinusNe = lumaSw - lumaNe;\n    float dirSeMinusNw = lumaSe - lumaNw;\n    vec2 dir1 = normalize(vec2(dirSwMinusNe + dirSeMinusNw, dirSwMinusNe - dirSeMinusNw));\n    vec3 rgbN1 = texture(tDiffuse, vPos.xy - dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    vec3 rgbP1 = texture(tDiffuse, vPos.xy + dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    float dirAbsMinTimesC = min(abs(dir1.x), abs(dir1.y)) * FXAA_EDGE_SHARPNESS;\n    vec2 dir2 = clamp(dir1.xy / dirAbsMinTimesC, -2.0, 2.0);\n    vec3 rgbN2 = texture(tDiffuse, vPos.xy - dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbP2 = texture(tDiffuse, vPos.xy + dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbA = rgbN1 + rgbP1;\n    vec3 rgbB = ((rgbN2 + rgbP2) * 0.25) + (rgbA * 0.25);\n    float lumaB = FxaaLuma(rgbB);\n    float alpha = rgbaM.a;\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        outFragColor = vec4(rgbA * 0.5, rgbaM.a);\n    else\n        outFragColor = vec4(rgbB, rgbaM.a);\n}\n"},2303:e=>{e.exports="uniform vec2 uResolution;\nout vec2 vPos;\nout vec4 vPosPos;\nvoid main() {\n    vPos = uv;\n    vPosPos.xy = uv + vec2(-0.5, -0.5) * uResolution;\n    vPosPos.zw = uv + vec2( 0.5,  0.5) * uResolution;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},15201:e=>{e.exports="uniform sampler2D tDiffuse;\nuniform vec4 uColor;\nin vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE_H*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE_V*(Y))\n#endif\n#define PI 3.14159265358979\n#define SIGMA ((KERNEL_RADIUS+KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#define GAUSSIAN(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\nvoid main() {\n    vec4 texColSum = vec4(0.0);\n    float gaussSum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        float gauss = GAUSSIAN(x);\n        vec4 texCol = texture(tDiffuse, GET_UV(x));\n#ifdef HAS_ALPHA\n        texCol.rgb *= texCol.a;\n#endif\n        texColSum += texCol * gauss;\n        gaussSum += gauss;\n    }\n#ifdef HAS_ALPHA\n    texColSum.rgb /= (texColSum.a == 0.0 ? 0.0001 : texColSum.a);\n#endif\n#ifdef HORIZONTAL\n    outFragColor = texColSum/gaussSum;\n#else\n    outFragColor = texColSum/gaussSum * uColor;\n#endif\n}\n"},8102:e=>{e.exports="out vec2 vUv;\nvoid main() {\n#if defined(HORIZONTAL) && defined(FLIP_UV)\n    vUv = vec2(uv.x, 1.0-uv.y);\n#else\n    vUv = vec2(uv.x, uv.y);\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},99885:e=>{e.exports="uniform sampler2D tDiffuse;\nin vec2 vUv;\nvoid main() {\n    vec4 texel = texture( tDiffuse, vUv );\n    outFragColor = texel;\n}\n"},63694:e=>{e.exports="#define NUM_SAMPLES 29.0\n#define NUM_SPIRAL_TURNS 7.0\nuniform sampler2D tDepth;\nuniform vec3 worldSize;\nin vec2 vUv;\n#ifdef PRESET_2\n#define SAMPLE_RADIUS 0.3\n#define AO_GAMMA 1.0\n#define AO_INTENSITY 1.0\n#else\n#define SAMPLE_RADIUS 0.2\n#define AO_GAMMA 3.0\n#define AO_INTENSITY 0.8\n#endif\n#include <pack_depth>\n#define PI 3.14159265358979\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat getRandomAngle(vec2 pos) {\n    return rand(pos) * (2.0 * PI);\n}\nvec2 tapLocation(float sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(sampleNumber + 0.5) * (1.0 / NUM_SAMPLES);\n    float angle = alpha * (NUM_SPIRAL_TURNS * PI * 2.0) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nvec2 sampleAO(vec2 unitDirection, float radius) {\n    vec2 sampleOffset = unitDirection * radius;\n    float idepth = unpackDepth(texture(tDepth, vUv + sampleOffset));\n    float depth = 1.0 - idepth;\n    if (depth < 1e-6) {\n        if (radius == 0.0)\n            return vec2(1.0, 1.0);\n        else\n            return vec2(0.0, 1.0);\n    }\n    vec3 dir = vec3(sampleOffset.x, depth, sampleOffset.y) * worldSize;\n    float distance2 = dot(dir,dir);\n    float idistance = 1.0 / sqrt(distance2);\n    vec3 ndir = dir * idistance;\n#ifdef PRESET_2\n    float importance = ndir.y * idistance;\n#else\n    float importance = ndir.y / distance2;\n#endif\n    vec2 ret;\n    ret.x = (idepth == 0.0) ? 0.0 : importance;\n    ret.y = importance;\n    return ret;\n}\nvoid main() {\n    vec2 sum = vec2(0.0);\n    float angle = getRandomAngle(vUv);\n    for (float i = 0.0; i<NUM_SAMPLES; i+= 1.0) {\n        float ssR;\n        vec2 uv = tapLocation(i, angle, ssR);\n        sum += sampleAO(uv, ssR * SAMPLE_RADIUS);\n    }\n    float ao = sum.x / sum.y;\n    outFragColor = packDepth(AO_INTENSITY * clamp(pow(ao, AO_GAMMA), 0.0, 0.9999));\n}\n"},12065:e=>{e.exports="uniform sampler2D tDepth;\nin vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE*(Y))\n#endif\n#include <pack_depth>\n#define PI 3.14159265358979\n#define SIGMA ((2.0 * KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#ifdef BOX\n#define KERNEL_VAL(X) 1.0\n#else\n#define KERNEL_VAL(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\n#endif\nvoid main() {\n    float depthVal = 0.0;\n    float sum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        depthVal += unpackDepth(texture(tDepth, GET_UV(x))) * KERNEL_VAL(x);\n        sum += KERNEL_VAL(x);\n    }\n    outFragColor = packDepth(depthVal/sum);\n}\n"},17797:e=>{e.exports="uniform sampler2D tDepth;\nuniform vec4 uShadowColor;\nin vec2 vUv;\n#include <pack_depth>\nvoid main() {\n    float depthVal = unpackDepth(texture(tDepth, vUv));\n    outFragColor = vec4(uShadowColor.rgb, uShadowColor.a * depthVal);\n}\n"},2647:e=>{e.exports="#include <pack_depth>\n#if NUM_CUTPLANES > 0\nin vec3 vWorldPosition;\n#endif\n#include <cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    depth = 1.0 - depth;\n    outFragColor = packDepth(depth);\n}\n"},67312:e=>{e.exports="#if NUM_CUTPLANES > 0\nout vec3 vWorldPosition;\n#endif\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );;\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n}\n"},4965:e=>{e.exports="#include <common>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <id_decl_frag>\n#include <theming_decl_frag>\n#include <logdepthbuf_decl_frag>\n#define ENABLE_ID_DISCARD\nuniform float opacity;\nuniform vec4 selectionColor;\n#if NUM_CUTPLANES>0\nin highp vec3 vWorldPosition;\n#endif\n#ifdef VIEWPORT_CLIPPING\nuniform highp vec4 viewportBounds;\nin vec4 vPosition;\n#endif\n#include <cutplanes>\nvoid main(){\n    #if NUM_CUTPLANES>0\n        checkCutPlanes(vWorldPosition);\n    #endif\n    #ifdef VIEWPORT_CLIPPING\n    if (vPosition.x < viewportBounds.x || vPosition.x > viewportBounds.z || vPosition.y < viewportBounds.y || vPosition.y > viewportBounds.w) {\n        discard;\n    }\n    #endif\n    float depth = 0.;\n    vec3 geomNormal = vec3(0.);\n    vec3 outgoingLight = vec3(0.);\n    vec4 diffuseColor = vec4(opacity);\n    #include <map_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    outgoingLight = diffuseColor.rgb;\n    #include <linear_to_gamma_fragment>\n    outFragColor = vec4(outgoingLight, diffuseColor.a);\n    float writeId = 1.0;\n    #ifdef GHOSTED\n        writeId = 0.;\n        outFragColor.a *= 0.1;\n    #endif\n    #include <theming_frag>\n    outFragColor.rgb = mix(outFragColor.rgb, selectionColor.rgb, selectionColor.a);\n    #include <final_frag>\n    #include <logdepthbuf_frag>\n}\n"},86546:e=>{e.exports="#include <common>\n#include <logdepthbuf_decl_vert>\n#include <map_pars_vertex>\n#if NUM_CUTPLANES>0\nout vec3 vWorldPosition;\n#endif\n#ifdef VIEWPORT_CLIPPING\nuniform mat4 modelLocalMatrix;\nout vec4 vPosition;\n#endif\nvoid main(){\n    vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n    #if NUM_CUTPLANES>0\n        vWorldPosition = (modelMatrix * vec4(position,1.)).xyz;\n    #endif\n    #ifdef VIEWPORT_CLIPPING\n        vPosition = modelLocalMatrix * vec4(position.xy,0.,1.);\n    #endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy,0.,1.);\n#include <logdepthbuf_vert>\n}\n"},24314:e=>{e.exports="\n#define LINE\n#include <line_decl_common>\n#include <id_decl_frag>\n#include <logdepthbuf_decl_frag>\nuniform highp float pixelsPerUnit;\nuniform highp float aaRange;\nuniform float opacity;\nuniform highp float viewportId;\nuniform highp float swap;\nuniform highp float grayscale;\n#ifdef HAS_RASTER_QUADS\nuniform sampler2D tRaster;\n#endif\n#ifdef HAS_LINESTYLES\nuniform sampler2D tLineStyle;\nuniform vec2 vLineStyleTexSize;\n#endif\n#ifdef VIEWPORT_CLIPPING\nuniform highp vec4 viewportBounds;\nin highp vec2 vPosition;\n#endif\n#ifdef IMAGE_UV_TEXTURE\nin highp vec2 vuv;\nuniform sampler2D tRaster;\n#endif\nfloat curveGaussian(float r, float invWidth) {\n    float amt = clamp(r * invWidth, 0.0, 1.0);\n    float exponent = amt * 2.0;\n    return exp(-exponent*exponent);\n}\n#ifdef HAS_LINESTYLES\nfloat getLinePatternPixel(int i, int j) {\n    return texture(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\n}\nfloat getPatternLength(int whichPattern) {\n    float p1 = getLinePatternPixel(0, whichPattern);\n    float p2 = getLinePatternPixel(1, whichPattern);\n    return (p2 * 256.0 + p1);\n}\n#endif\nvoid fillLineSegment() {\n    float radius = abs(fsHalfWidth);\n    float parametricDistance = fsMultipurpose.x;\n    float segmentLength      = fsMultipurpose.y;\n    float totalDistance      = fsMultipurpose.z;\n#ifdef LOADING_ANIMATION\n    float distFromStart = parametricDistance / segmentLength;\n    if (loadingProgress < 1.0 && distFromStart > loadingProgress) {\n        discard;\n    }\n#endif\n#ifdef HAS_LINESTYLES\n    int whichPattern         = int(fsMultipurpose.w);\n    if (whichPattern > 0) {\n        const float TEX_TO_UNIT = 1.0 / 96.0;\n        float patternScale;\n        if (fsHalfWidth < 0.0) {\n            patternScale = LTSCALE;\n        } else {\n            patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;\n        }\n        float patLen = patternScale * getPatternLength(whichPattern);\n        float phase = mod((totalDistance + parametricDistance) * pixelsPerUnit, patLen);\n        bool onPixel = true;\n        float radiusPixels = radius * pixelsPerUnit;\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\n            float on = getLinePatternPixel(i, whichPattern);\n            if (on == 1.0) on = 0.0;\n            on *= patternScale;\n            onPixel = true;\n            phase -= on;\n            if (phase < 0.0) {\n                break;\n            }\n            else if (phase <= radiusPixels) {\n                onPixel = false;\n                break;\n            }\n            float off = getLinePatternPixel(i+1, whichPattern);\n            if (off <= 1.0) off = 0.0;\n            off *= patternScale;\n            onPixel = false;\n            phase -= off;\n            if (phase < -radiusPixels)\n                discard;\n            if (phase <= 0.0)\n                break;\n        }\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\n            segmentLength = 0.0;\n            parametricDistance = phase / pixelsPerUnit;\n        }\n    }\n#endif\n    float dist;\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\n    float ltz = max(0.0, sign(-parametricDistance));\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\n    float range =  dist - radius;\n    if (range > aaRange) {\n        discard;\n    }\n    outFragColor = fsColor;\n    outFragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n}\n#ifdef HAS_CIRCLES\nvoid fillCircularArc() {\n    float dist   = length(fsOffsetDirection);\n    vec2 angles  = fsMultipurpose.xz;\n    float radius = abs(fsMultipurpose.y);\n    float range  =  abs(dist - radius);\n    range -= fsHalfWidth;\n    if (range > aaRange) {\n        discard;\n    }\n    vec2 direction = fsOffsetDirection;\n    float angle = atan(direction.y, direction.x);\n    if (angles.x > angles.y) {\n        if (angle > angles.x && angle < PI) {\n                angle -= TAU;\n        }\n        angles.x -= TAU;\n        if (angle < angles.x ) {\n            angle += TAU;\n        }\n    }\n    else if (angle < 0.0)\n        angle += TAU;\n#ifdef LOADING_ANIMATION\n    if ((angle - angles.x) / (angles.y - angles.x) > loadingProgress) {\n        discard;\n    }\n#endif\n    if (angle > angles.x && angle < angles.y) {\n        outFragColor = fsColor;\n        outFragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n    }\n    else {\n        discard;\n    }\n}\n#endif\n#ifdef HAS_ELLIPTICALS\nfloat EllipticalApprox(\n        const int iters,\n        inout float t0, inout float t1,\n        const vec2 y,   out   vec2 x,\n        const vec2 e,   const vec2 ey, const vec2 esqr\n        ) {\n    vec2 r;\n    for (int i = 0; i < 10; ++i) {\n        if(i >= iters) break;\n        float t = mix(t0, t1, 0.5);\n        r = ey / (vec2(t) + esqr);\n        vec2 rsq = r * r;\n        float f = rsq.x + rsq.y - 1.0;\n        if(f > 0.0) { t0 = t; } else { t1 = t; }\n    }\n    x = e * r;\n    return distance(x, y);\n}\nfloat DistancePointEllipseSpecial (vec2 e, vec2 y, out vec2 x, float width, float aaRange) {\n    float dist;\n    vec2 esqr = e * e;\n    vec2 ey   = e * y;\n    float t0 = -esqr[1] + ey[1];\n    float t1 = -esqr[1] + length(ey);\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\n    if (dist > max(2.0 * (width + aaRange), e[0] * 0.05))\n        return dist;\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\n    float ecc = 1.0 +  0.1 * e[0] / e[1];\n    if (dist > max(ecc * (width + aaRange), e[0] * 0.001))\n        return dist;\n    if (dist < (width - aaRange) / ecc)\n        return dist;\n    dist = EllipticalApprox(10, t0, t1, y, x, e, ey, esqr);\n    return dist;\n}\nfloat DistancePointEllipse(vec2 e, vec2 y, out vec2 locX, float width, float aaRange) {\n    vec2 locE, locY;\n    float diff = sign(e[0] - e[1]);\n    vec2 swizzle = vec2(max(diff, 0.0), -min(diff, 0.0));\n    locE.x = dot(e, swizzle.xy);\n    locE.y = dot(e, swizzle.yx);\n    locY.x = dot(y, swizzle.xy);\n    locY.y = dot(y, swizzle.yx);\n    vec2 refl = sign(locY);\n    locY *= refl;\n    vec2 x;\n    float distance = DistancePointEllipseSpecial(locE, locY, x, width, aaRange);\n    x *= refl;\n    locX.x = dot(x, swizzle.xy);\n    locX.y = dot(x, swizzle.yx);\n    return distance;\n}\nvoid fillEllipticalArc() {\n    vec2 angles = fsMultipurpose.xz;\n    vec2 radii  = abs(fsMultipurpose.yw);\n    vec2 dir    = fsOffsetDirection;\n    vec2 pos;\n    float range = DistancePointEllipse(radii, dir, pos, fsHalfWidth, aaRange);\n    range -= fsHalfWidth;\n    if (range > aaRange)\n        discard;\n    float ar = radii[0] / radii[1];\n    float angle = atan(ar * pos.y, pos.x);\n    if (angles.x > angles.y) {\n        if (angle > angles.x && angle < PI) {\n            angle -= TAU;\n        }\n        angles.x -= TAU;\n        if (angle < angles.x ) {\n            angle += TAU;\n        }\n    }\n    else if (angle < 0.0)\n        angle += TAU;\n#ifdef LOADING_ANIMATION\n    if ((angle - angles.x) / (angles.y - angles.x) > loadingProgress) {\n        discard;\n    }\n#endif\n    if (angle > angles.x && angle < angles.y) {\n        outFragColor = fsColor;\n        outFragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n    }\n    else {\n        discard;\n    }\n}\n#endif\n#ifdef HAS_RASTER_QUADS\n    void fillTexQuad() {\n        outFragColor = texture(tRaster, fsMultipurpose.xy);\n        #ifdef LOADING_ANIMATION\n            outFragColor.a *= loadingProgress;\n        #endif\n    }\n#endif\nvoid fillTriangle() {\n#ifdef IMAGE_UV_TEXTURE\n    outFragColor = texture(tRaster, fract(vuv));\n#else\n    outFragColor = fsColor;\n#endif\n#ifdef LOADING_ANIMATION\n    outFragColor.a *= loadingProgress;\n#endif\n}\n#if NUM_CUTPLANES > 0\nin highp vec3 vWorldPosition;\n#endif\n#ifdef MSDF_TEXTURE_FONT\nin highp vec2 vuv;\nin float isMSDFQuards;\nuniform sampler2D tRaster;\nfloat median(float r, float g, float b) {\n  return max(min(r, g), min(max(r, g), b));\n}\n#endif\n#define LINE_CUTPLANE\n#include <cutplanes>\nvoid main() {\n    if (fsColor == vec4(0.0)) {\n        discard;\n    }\n#ifdef VIEWPORT_CLIPPING\n    if(vPosition.x < viewportBounds.x || vPosition.x > viewportBounds.z || vPosition.y < viewportBounds.y || vPosition.y > viewportBounds.w) {\n        discard;\n    }\n#endif\n#ifdef MSDF_TEXTURE_FONT\n    vec4 msdfColor = texture(tRaster, vuv);\n    float dist = median(msdfColor.r, msdfColor.g, msdfColor.b);\n    float delta = mix(0.25, 0.5, 1.0 - fwidth(dist));\n    float sigDist = dist - delta;\n    float msdfAlpha = clamp(sigDist/fwidth(sigDist) + delta, 0.0, 1.0);\n    msdfAlpha = smoothstep(0., 1., msdfAlpha);\n    outFragColor.a =  mix(msdfAlpha, 1., 1.-isMSDFQuards);\n    if (outFragColor.a < 0.0001) discard;\n#endif\n    if (fsHalfWidth == 0.0) {\n#ifdef HAS_RASTER_QUADS\n        if (fsMultipurpose.z != 0.0)\n            fillTexQuad();\n        else\n#endif\n            fillTriangle();\n    }\n    else if (fsMultipurpose.y < 0.0) {\n#ifdef HAS_CIRCLES\n#ifdef HAS_ELLIPTICALS\n        if (abs(fsMultipurpose.y) == fsMultipurpose.w)\n#endif\n            fillCircularArc();\n#endif\n#ifdef HAS_ELLIPTICALS\n#ifdef HAS_CIRCLES\n        else\n#endif\n            fillEllipticalArc();\n#endif\n    }\n    else\n        fillLineSegment();\n    float writeId = 1.0;\n    outFragColor.a *= opacity;\n    if (outFragColor.a == 0.0) {\n        discard;\n    }\n    if (fsGhosting != 0.0 ||\n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\n        writeId = 0.0;\n        outFragColor.a *= ((swap == 1.0) ? 0.21 : 0.1);\n    }\n#ifndef SELECTION_RENDERER\n    if (grayscale != 0.0) {\n        const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\n        float gray = dot(outFragColor.rgb, rgb2grey);\n        outFragColor.rgb = vec3(gray);\n    }\n#endif\n#if NUM_CUTPLANES > 0\n    if (checkCutPlanes(vWorldPosition)) return;\n#endif\n#ifdef MRT_NORMALS\n    outNormal = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\n#ifdef NO_ID_OUTPUT\n    writeId = 0.0;\n#endif\n#include <id_frag>\n#include <logdepthbuf_frag>\n}\n"},49965:e=>{e.exports="\n#include <line_decl_common>\n#include <logdepthbuf_decl_vert>\nin vec2 fields1;\nin vec4 fields2;\nin vec4 flags4b;\nin vec4 layerVp4b;\n#ifdef HAS_ELLIPTICALS\nin vec3 extraParams;\n#endif\n#ifdef USE_INSTANCING\nin vec4 instFlags4b;\n#endif\n#ifdef MSDF_TEXTURE_FONT\nout highp vec2 vuv;\nout float isMSDFQuards;\n#endif\n#ifdef IMAGE_UV_TEXTURE\nout highp vec2 vuv;\n#endif\n#ifdef VIEWPORT_CLIPPING\nout vec2 vPosition;\n#endif\nuniform mat4 mvpMatrix;\nuniform float pixelsPerUnit;\nuniform float aaRange;\nuniform float viewportId;\nuniform float swap;\n#ifdef HAS_LAYERS\nuniform sampler2D tLayerMask;\n#endif\n#ifdef SELECTION_RENDERER\nuniform sampler2D tSelectionTexture;\nuniform vec2 vSelTexSize;\n#endif\n#ifdef SELECTION_RENDERER\nuniform vec4 selectionColor;\n#endif\n#ifdef LOADING_ANIMATION\nuniform float meshAnimTime;\n#endif\n#if NUM_CUTPLANES > 0\nout vec3 vWorldPosition;\n#endif\nout vec4 dbId;\n#ifdef UNPACK_POSITIONS\nuniform sampler2D tIdColor;\nuniform vec2 vIdColorTexSize;\nuniform vec4 unpackXform;\nin vec2 uvIdColor;\nfloat unpackLineWeight(float w) {\n    if (w > 0.5) {\n        return - (w - 0.5) * 1024.0;\n    } else {\n        return w * max(unpackXform.x, unpackXform.y) * 2.0;\n    }\n}\nvec4 getVertexColor() {\n    float u = (uvIdColor.x + 0.5) / vIdColorTexSize.x;\n    return texture(tIdColor, vec2(u, 0.5));\n}\nvec4 getDbId() {\n    float u = (uvIdColor.y + 0.5) / vIdColorTexSize.x;\n    vec4 normDbId = texture(tIdColor, vec2(u, 0.5));\n    return normDbId * 255.0;\n}\n#else\nin vec4 color4b;\nin vec4 dbId4b;\nvec4 unpackXform;\nfloat unpackLineWeight(float w) {\n    return w;\n}\nvec4 getVertexColor() {\n    return color4b;\n}\nvec4 getDbId() {\n    return dbId4b;\n}\n#endif\nvec2 centralVertex;\nvec2 offsetPosition;\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\n    minPt = min(minPt, p);\n    maxPt = max(maxPt, p);\n}\n#if defined(USE_INSTANCING)\nfloat getVertexId() { return instFlags4b.x; }\n#else\nfloat getVertexId() { return flags4b.x; }\n#endif\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\nvoid decodeSegmentData(out SegmentData seg) {\n    seg.angle         = fields2.x * TAU - PI;\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\n    seg.distTotal     = fields2.w;\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\n    seg.lineType      = flags4b.z;\n}\nvoid strokeLineSegment() {\n    SegmentData seg; decodeSegmentData(seg);\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\n    float angleTransverse = seg.angle + isLeftSide * HALF_PI;\n    float lwAdjustment = fsHalfWidth + aaRange;\n    vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;\n    offsetPosition.xy += transverseOffset;\n    float distanceFromStart = max(isStartCapVertex, 0.0) * seg.distAlong;\n    vec2 along = distanceFromStart * cos_sin(seg.angle);\n    offsetPosition.xy += along;\n    centralVertex.xy  += along;\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\n    offsetPosition.xy -= moveOffset;\n    centralVertex.xy  -= moveOffset;\n    fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\n    fsMultipurpose.y = seg.distAlong;\n    fsMultipurpose.z = seg.distTotal;\n    fsMultipurpose.w = seg.lineType;\n    if (seg.lineWidthHalf < 0.0)\n        fsHalfWidth = -fsHalfWidth;\n}\n#ifdef HAS_TRIANGLE_GEOMS\nstruct TriangleData { vec2 p0, p1, p2; };\nvoid decodeTriangleData(out TriangleData tri) {\n    tri.p1 = vec2(fields2.x, fields2.y) * unpackXform.xy + unpackXform.zw;\n    tri.p2 = fields2.zw * unpackXform.xy + unpackXform.zw;\n}\nvoid strokeOneTriangle() {\n    TriangleData tri; decodeTriangleData(tri);\n    fsHalfWidth = 0.0;\n    fsMultipurpose.z = 0.0;\n    float vertexId = getVertexId();\n    if (vertexId == VBB_SEG_END_RIGHT)\n        offsetPosition.xy = tri.p1;\n    else if (vertexId == VBB_SEG_END_LEFT)\n        offsetPosition.xy = tri.p2;\n}\n#endif\n#ifdef HAS_RASTER_QUADS\nstruct TexQuadData { float angle; vec2 size; };\nvoid decodeTexQuadData(out TexQuadData quad) {\n    quad.angle     = fields2.x * TAU;\n    quad.size   = fields2.yz * max(unpackXform.x, unpackXform.y);\n}\nvoid strokeTexQuad() {\n    TexQuadData quad; decodeTexQuadData(quad);\n    vec2 corner = vec2(isLeftVertex() ? -1.0 : 1.0, isStartVertex() ? -1.0 : 1.0);\n    vec2 p      = 0.5 * corner * quad.size;\n    vec2 rot    = cos_sin(quad.angle);\n    vec2 offset = vec2(p.x * rot.x - p.y * rot.y, p.x * rot.y + p.y * rot.x);\n    offsetPosition.xy += offset;\n    fsMultipurpose.xy = max(vec2(0.0), corner);\n    fsMultipurpose.z = 1.0;\n    fsHalfWidth = 0.0;\n}\n#endif\n#if defined(HAS_CIRCLES) || defined(HAS_ELLIPTICALS)\nstruct ArcData { vec2 c; float start, end, major, minor, tilt; };\nvoid decodeArcData(out ArcData arc) {\n    arc.c     = fields1.xy * unpackXform.xy + unpackXform.zw;\n    arc.start = fields2.x * TAU;\n    arc.end   = fields2.y * TAU;\n    arc.major = fields2.w * max(unpackXform.x, unpackXform.y);\n#if defined(HAS_ELLIPTICALS)\n    arc.minor = extraParams.x;\n    arc.tilt  = extraParams.y * TAU;\n#endif\n}\nvoid strokeArc(const ArcData arc) {\n    float isStart = isStartVertex() ? -1.0 : 1.0;\n    float isLeft  = isLeftVertex()  ? -1.0 : 1.0;\n    vec2 minPt;\n    vec2 maxPt;\n    vec2 angles = vec2(arc.start, arc.end);\n    vec2 endsX = vec2(arc.c.x) + arc.major * cos(angles);\n    vec2 endsY = vec2(arc.c.y) + arc.minor * sin(angles);\n    minPt = maxPt = vec2(endsX.x, endsY.x);\n    min_max(minPt, maxPt, vec2(endsX.y, endsY.y));\n    if (arc.end > arc.start) {\n        if (arc.start < PI_0_5 && arc.end > PI_0_5) {\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\n        }\n        if (arc.start < PI && arc.end > PI) {\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\n        }\n        if (arc.start < PI_1_5 && arc.end > PI_1_5) {\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\n        }\n    } else {\n        min_max(minPt, maxPt, vec2(arc.c.x + arc.major, arc.c.y));\n        if (arc.start < PI_0_5 || arc.end > PI_0_5) {\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\n        }\n        if (arc.start < PI || arc.end > PI) {\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\n        }\n        if (arc.start < PI_1_5 || arc.end > PI_1_5) {\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\n        }\n    }\n    minPt -= fsHalfWidth + aaRange;\n    maxPt += fsHalfWidth + aaRange;\n    offsetPosition.x = (isStart < 0.0) ? minPt.x : maxPt.x;\n    offsetPosition.y = (isLeft < 0.0)  ? minPt.y : maxPt.y;\n    fsMultipurpose.x = arc.start;\n    fsMultipurpose.y = -arc.major;\n    fsMultipurpose.z = arc.end;\n    fsMultipurpose.w = arc.minor;\n}\n#endif\n#if defined(HAS_CIRCLES)\nvoid strokeCircularArc() {\n    ArcData arc; decodeArcData(arc);\n    float r = arc.major;\n    if (r * pixelsPerUnit < 0.125)\n        r = 0.25 * aaRange;\n    arc.major = arc.minor = r;\n    strokeArc(arc);\n}\n#endif\n#if defined(HAS_ELLIPTICALS)\nvoid strokeEllipticalArc() {\n    ArcData arc; decodeArcData(arc);\n    strokeArc(arc);\n}\n#endif\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\n    attribs.pos           = fields1.xy * unpackXform.xy + unpackXform.zw;\n    attribs.color         = getVertexColor();\n    attribs.geomType      = flags4b.y;\n    attribs.layerTC       = layerVp4b.xy / 255.0;\n    attribs.vpTC          = layerVp4b.zw / 255.0;\n    attribs.lineWidthHalf = unpackLineWeight(fields2.z);\n    attribs.ghosting      = flags4b.w;\n}\nvoid strokeIndexedTriangle() {\n    fsHalfWidth = 0.0;\n    fsMultipurpose.z = 0.0;\n}\n#ifdef SELECTION_RENDERER\nbool isSelected(const CommonAttribs attribs) {\n    vec3 oid = getDbId().rgb;\n    float id01 = oid.r + oid.g * 256.0;\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\n    float flrt = floor(t);\n    float texU = t - flrt;\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\n    t = (id23 + 0.5) / vSelTexSize.y;\n    float texV = fract(t);\n    vec4 selBit = texture(tSelectionTexture, vec2(texU, texV));\n    return selBit.r == 1.0;\n}\n#endif\nbool isLayerOff(const CommonAttribs attribs) {\n#ifdef HAS_LAYERS\n    vec4 layerBit = texture(tLayerMask, attribs.layerTC);\n    return (layerBit.r == 0.0);\n#else\n    return false;\n#endif\n}\nvec4 getColor(const CommonAttribs attribs) {\n    if (isLayerOff(attribs)) { return vec4(0.0); }\n#ifdef SELECTION_RENDERER\n    if (isSelected(attribs)) { return selectionColor; }\n    return vec4(0.0);\n#else\n    return attribs.color;\n#endif\n}\n#ifdef GAMMA_INPUT\nvec4 inputToLinear(vec4 c) {\n    return vec4(vec3(c*c), c.a);\n}\n#endif\nvoid main() {\n#ifndef UNPACK_POSITIONS\n    unpackXform = vec4(1.0, 1.0, 0.0, 0.0);\n#endif\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\n#ifdef MSDF_TEXTURE_FONT\n    vuv = fields2.xy;\n    isMSDFQuards = 1.0 - abs(sign(attribs.geomType - VBB_GT_MSDF_TRIANGLE_INDEXED));\n#endif\n#ifdef IMAGE_UV_TEXTURE\n    vuv = fields2.xy;\n#endif\n    fsColor = getColor(attribs);\n    #ifdef GAMMA_INPUT\n    fsColor = inputToLinear(fsColor);\n    #endif\n    if (swap != 0.0 ) {\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\n            fsColor.rgb = vec3(1.0,1.0,1.0);\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\n            fsColor.rgb = vec3(0.0,0.0,0.0);\n    }\n    centralVertex = offsetPosition = attribs.pos;\n    float lineWeight = attribs.lineWidthHalf;\n    if (lineWeight > 0.0) {\n        if(lineWeight < 0.5 / pixelsPerUnit) {\n            lineWeight = 0.5 / pixelsPerUnit;\n        }\n    }\n    else {\n        lineWeight = abs(lineWeight) / pixelsPerUnit;\n    }\n    fsHalfWidth = lineWeight;\n    dbId = getDbId() / 255.0;\n    fsVpTC     = attribs.vpTC;\n    fsGhosting = attribs.ghosting;\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_START || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_END || attribs.geomType == VBB_GT_LINE_SEGMENT_MITER)     strokeLineSegment();\n#ifdef HAS_CIRCLES\n    else if (attribs.geomType == VBB_GT_ARC_CIRCULAR)     strokeCircularArc();\n#endif\n#ifdef HAS_ELLIPTICALS\n    else if (attribs.geomType == VBB_GT_ARC_ELLIPTICAL)   strokeEllipticalArc();\n#endif\n#ifdef HAS_RASTER_QUADS\n    else if (attribs.geomType == VBB_GT_TEX_QUAD)         strokeTexQuad();\n#endif\n#ifdef HAS_TRIANGLE_GEOMS\n    else if (attribs.geomType == VBB_GT_ONE_TRIANGLE)     strokeOneTriangle();\n#endif\n    else if (attribs.geomType == VBB_GT_TRIANGLE_INDEXED) strokeIndexedTriangle();\n    fsOffsetDirection = offsetPosition - centralVertex;\n    gl_Position = mvpMatrix * modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n#include <logdepthbuf_vert>\n#ifdef LOADING_ANIMATION\n    if (dbId.rgb == vec3(1.0)) {\n        loadingProgress = 1.0;\n    } else {\n        loadingProgress = smoothstep(0.0, 1.0, meshAnimTime);\n    }\n#endif\n#ifdef IMAGE_UV_TEXTURE\n    fsHalfWidth = 0.0;\n#endif\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef VIEWPORT_CLIPPING\n    vPosition = offsetPosition.xy;\n#endif\n}\n"},65144:e=>{e.exports="\n#define LINE_SS\n#include <line_decl_common>\n#include <id_decl_frag>\n#include <logdepthbuf_decl_frag>\nuniform highp float aaRange;\nuniform float opacity;\nuniform highp float viewportId;\nuniform highp float swap;\nuniform highp float grayscale;\n#ifdef HAS_LINESTYLES\nuniform sampler2D tLineStyle;\nuniform vec2 vLineStyleTexSize;\nin highp float vPixelsPerUnit;\n#endif\n#ifdef VIEWPORT_CLIPPING\nuniform highp vec4 viewportBounds;\nin highp vec2 vPosition;\nuniform mat4 mvpMatrix;\nuniform mat4 modelMatrix;\n#endif\nfloat curveGaussian(float r, float width) {\n    float amt = clamp(abs(r / (width * 1.0)), 0.0, 1.0);\n    amt = max(amt - 0.0, 0.0);\n    float exponent = amt * 2.0;\n    return clamp(exp(-exponent*exponent), 0.0, 1.0);\n}\n#ifdef HAS_LINESTYLES\nfloat getLinePatternPixel(int i, int j) {\n    return texture(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\n}\nfloat getPatternLength(int whichPattern) {\n    float p1 = getLinePatternPixel(0, whichPattern);\n    float p2 = getLinePatternPixel(1, whichPattern);\n    return (p2 * 256.0 + p1);\n}\n#endif\nvoid fillLineSegment() {\n    float radius = abs(fsHalfWidth);\n    float parametricDistance = fsMultipurpose.x;\n    float segmentLength      = fsMultipurpose.y;\n    float totalDistance      = fsMultipurpose.z;\n#ifdef LOADING_ANIMATION\n    float distFromStart = parametricDistance / segmentLength;\n    if (loadingProgress < 1.0 && distFromStart > loadingProgress) {\n        discard;\n    }\n#endif\n#ifdef HAS_LINESTYLES\n    int whichPattern = int(fsMultipurpose.w);\n    float roundedEnd = fsMultipurpose.w;\n    if (whichPattern > 0) {\n        const float TEX_TO_UNIT = 1.0 / 96.0;\n        float patternScale;\n        if (fsHalfWidth < 0.0) {\n            patternScale = LTSCALE;\n        } else {\n            patternScale = LTSCALE * TEX_TO_UNIT * vPixelsPerUnit;\n        }\n        float patLen = patternScale * getPatternLength(whichPattern);\n        float phase = mod((totalDistance + parametricDistance), patLen);\n        bool onPixel = true;\n        float radiusPixels = radius + aaRange;\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\n            float on = getLinePatternPixel(i, whichPattern);\n            if (on == 1.0) on = 0.0;\n            on *= patternScale;\n            onPixel = true;\n            phase -= on;\n            if (phase < 0.0) {\n                break;\n            }\n            else if (phase <= radiusPixels) {\n                onPixel = false;\n                break;\n            }\n            float off = getLinePatternPixel(i+1, whichPattern);\n            if (off <= 1.0) off = 0.0;\n            off *= patternScale;\n            onPixel = false;\n            phase -= off;\n            if (phase < -radiusPixels)\n                discard;\n            if (phase <= 0.0)\n                break;\n        }\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\n            segmentLength = 0.0;\n            parametricDistance = phase;\n        }\n    }\n#else\n    float roundedEnd = fsMultipurpose.w;\n#endif\n    float dist;\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\n    float ltz = max(0.0, sign(-parametricDistance));\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\n    float range =  dist - radius;\n    if (roundedEnd<0.25) {\n        float buttRange = max(-parametricDistance, parametricDistance - segmentLength);\n        range = max(range, buttRange);\n    }\n    if (range > aaRange) {\n        discard;\n    }\n    outFragColor = fsColor;\n    if (range > -aaRange)\n        outFragColor.a *= curveGaussian(range+aaRange, aaRange * 2.0);\n}\n#ifdef LOADING_ANIMATION\n    void fillTriangle() { outFragColor = vec4(fsColor.rgb, fsColor.a * loadingProgress); }\n#else\n    void fillTriangle() { outFragColor = fsColor; }\n#endif\n#if NUM_CUTPLANES > 0\nin highp vec3 vWorldPosition;\n#endif\n#define LINE_CUTPLANE\n#include <cutplanes>\nfloat getSide(vec2 a, vec2 b, vec2 c) {\n    return sign((b.x - a.x) * (c.y - a.y) - (b.y - a.y) * (c.x - a.x));\n}\nvoid main() {\n    if (fsColor == vec4(0.0)) {\n        discard;\n    }\n#ifdef VIEWPORT_CLIPPING\n    vec2 bottomLeft = (mvpMatrix * modelMatrix * vec4(viewportBounds.xy, 0., 1.)).xy;\n    vec2 bottomRight = (mvpMatrix * modelMatrix * vec4(viewportBounds.zy, 0., 1.)).xy;\n    vec2 topRight = (mvpMatrix * modelMatrix * vec4(viewportBounds.zw, 0., 1.)).xy;\n    vec2 topLeft = (mvpMatrix * modelMatrix * vec4(viewportBounds.xw, 0., 1.)).xy;\n    float side = getSide(topLeft, topRight, bottomLeft);\n    if (side * getSide(topRight, bottomRight, vPosition) < 0.0 ||\n        side * getSide(bottomRight, bottomLeft, vPosition) < 0.0 ||\n        side * getSide(bottomLeft, topLeft, vPosition) < 0.0 ||\n        side * getSide(topLeft, topRight, vPosition) < 0.0) {\n        discard;\n    }\n#endif\n    if (fsHalfWidth == 0.0) {\n        fillTriangle();\n    }\n    else\n        fillLineSegment();\n    float writeId = 1.0;\n    outFragColor.a *= opacity;\n    if (outFragColor.a == 0.0) {\n        discard;\n    }\n    if (fsGhosting != 0.0 ||\n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\n        writeId = 0.0;\n        outFragColor.a *= ((swap == 1.0) ? 0.21 : 0.1);\n    }\n#ifndef SELECTION_RENDERER\n    if (grayscale != 0.0) {\n        const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\n        float gray = dot(outFragColor.rgb, rgb2grey);\n        outFragColor.rgb = vec3(gray);\n    }\n#endif\n#if NUM_CUTPLANES > 0\n    if (checkCutPlanes(vWorldPosition)) return;\n#endif\n#ifdef MRT_NORMALS\n    outNormal = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\n#ifdef NO_ID_OUTPUT\n    writeId = 0.0;\n#endif\n#include <id_frag>\n#include <logdepthbuf_frag>\n}\n"},97431:e=>{e.exports="\n#include <line_decl_common>\n#include <logdepthbuf_decl_vert>\nin vec2 fields1;\nin vec4 fields2;\nin vec4 flags4b;\nin vec4 layerVp4b;\n#ifdef HAS_MITER_LINES\nin vec3 extraParams;\nuniform float miterLimit;\nuniform float miterScaleFactor;\nuniform float miterCP;\n#endif\n#ifdef USE_INSTANCING\nin vec4 instFlags4b;\n#endif\n#ifdef VIEWPORT_CLIPPING\nout vec2 vPosition;\n#endif\nuniform mat4 mvpMatrix;\nuniform float pixelsPerUnit;\nuniform float aaRange;\nuniform vec2 size;\nuniform float viewportId;\nuniform float swap;\nuniform vec3 cameraPos;\nuniform float tanHalfFov;\n#ifdef HAS_LINESTYLES\nout float vPixelsPerUnit;\n#endif\n#ifdef HAS_LAYERS\nuniform sampler2D tLayerMask;\n#endif\n#ifdef SELECTION_RENDERER\nuniform sampler2D tSelectionTexture;\nuniform vec2 vSelTexSize;\n#endif\n#ifdef SELECTION_RENDERER\nuniform vec4 selectionColor;\n#endif\n#ifdef LOADING_ANIMATION\nuniform float meshAnimTime;\n#endif\n#if NUM_CUTPLANES > 0\nout vec3 vWorldPosition;\n#endif\nout vec4 dbId;\n#ifdef UNPACK_POSITIONS\nuniform sampler2D tIdColor;\nuniform vec2 vIdColorTexSize;\nuniform vec4 unpackXform;\nin vec2 uvIdColor;\nfloat unpackLineWeight(float w) {\n    if (w > 0.5) {\n        return - (w - 0.5) * 1024.0;\n    } else {\n        return w * max(unpackXform.x, unpackXform.y) * 2.0;\n    }\n}\nvec4 getVertexColor() {\n    float u = (uvIdColor.x + 0.5) / vIdColorTexSize.x;\n    return texture(tIdColor, vec2(u, 0.5));\n}\nvec4 getDbId() {\n    float u = (uvIdColor.y + 0.5) / vIdColorTexSize.x;\n    vec4 normDbId = texture(tIdColor, vec2(u, 0.5));\n    return normDbId * 255.0;\n}\n#else\nin vec4 color4b;\nin vec4 dbId4b;\nvec4 unpackXform;\nfloat unpackLineWeight(float w) {\n    return w;\n}\nvec4 getVertexColor() {\n    return color4b;\n}\nvec4 getDbId() {\n    return dbId4b;\n}\n#endif\nvec2 centralVertex;\nvec2 offsetPosition;\nvec2 offsetPosDepth;\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\n    minPt = min(minPt, p);\n    maxPt = max(maxPt, p);\n}\n#if defined(USE_INSTANCING)\nfloat getVertexId() { return instFlags4b.x; }\n#else\nfloat getVertexId() { return flags4b.x; }\n#endif\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\nvoid decodeSegmentData(out SegmentData seg) {\n    seg.angle         = fields2.x * TAU - PI;\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\n    seg.distTotal     = fields2.w;\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\n    seg.lineType      = flags4b.z;\n}\nvoid strokeLineSegment(float geomType) {\n    SegmentData seg; decodeSegmentData(seg);\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\n    vec4 startPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n    float distanceAlong = seg.distAlong;\n    vec2 along = distanceAlong * cos_sin(seg.angle);\n    vec4 endPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy + along, 0.0, 1.0));\n    vec2 screenStart = startPosition.xy * 0.5 * size / startPosition.w;\n    vec2 screenEnd = endPosition.xy * 0.5 * size / endPosition.w;\n    float roundedEnd = 0.0;\n    if (isStartCapVertex < 0.0) {\n        offsetPosition = centralVertex = screenStart;\n        offsetPosDepth = startPosition.zw;\n        roundedEnd = (geomType == VBB_GT_LINE_SEGMENT || geomType == VBB_GT_LINE_SEGMENT_CAPPED_END) ? 0.5 : 0.0;\n    } else {\n        offsetPosition = centralVertex = screenEnd;\n        offsetPosDepth = endPosition.zw;\n        roundedEnd = (geomType == VBB_GT_LINE_SEGMENT || geomType == VBB_GT_LINE_SEGMENT_CAPPED_START) ? 0.5 : 0.0;\n    }\n#ifdef HAS_LINESTYLES\n    roundedEnd += seg.lineType;\n#endif\n    vec2 screenDelta = screenEnd - screenStart;\n    float screenAngle = (distanceAlong == 0.0) ? 0.0 : atan(screenDelta.y, screenDelta.x);\n    float angleTransverse = screenAngle - isLeftSide * HALF_PI;\n    float lwAdjustment = fsHalfWidth + aaRange;\n    vec2 transverseDir = cos_sin(angleTransverse);\n    offsetPosition += transverseDir * lwAdjustment;\n    fsOffsetDirection = offsetPosition - centralVertex;\n    float distanceFromStart = max(0.0, isStartCapVertex) * length(screenDelta);\n    float segmentExtension = (roundedEnd > 0.0) ? lwAdjustment : aaRange;\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseDir.y, transverseDir.x) * segmentExtension;\n    offsetPosition += moveOffset;\n    fsMultipurpose.x = (isStartCapVertex * segmentExtension) + distanceFromStart;\n    fsMultipurpose.y = length(screenDelta);\n    fsMultipurpose.z = seg.distTotal;\n    fsMultipurpose.w = roundedEnd;\n    if (seg.lineWidthHalf < 0.0)\n        fsHalfWidth = -fsHalfWidth;\n    gl_Position = vec4(2.0 * offsetPosition / size * offsetPosDepth.y, offsetPosDepth.xy);\n#include <logdepthbuf_vert>\n}\n#ifdef HAS_MITER_LINES\nstruct MiterSegmentData { float angle, distAlong, distAlongPN, anglePrev, angleNext, lineWidthHalf, lineType; };\nvoid decodeMiterSegment(out MiterSegmentData seg) {\n    seg.angle         = fields2.x * TAU - PI;\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\n    seg.anglePrev     = fields2.w * TAU - PI;\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\n    seg.lineType      = flags4b.z;\n    seg.angleNext     = extraParams.x * TAU - PI;\n    seg.distAlongPN   = extraParams.y * max(unpackXform.x, unpackXform.y);\n}\nvoid strokeMiterLineSegment() {\n    MiterSegmentData seg; decodeMiterSegment(seg);\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\n    float next = floor(seg.distAlongPN / miterCP);\n    float prev = seg.distAlongPN - (next * miterCP);\n    float distanceAlongNext = floor(next) / miterScaleFactor;\n    float distanceAlongPrev = floor(prev) / miterScaleFactor;\n    float distanceAlong = seg.distAlong;\n    vec2 along  = cos_sin(seg.anglePrev) * distanceAlongPrev;\n    vec2 along2 = cos_sin(seg.angle) * distanceAlong;\n    vec2 along3 = along2 + cos_sin(seg.angleNext) * distanceAlongNext;\n    vec4 prevPosition  = (mvpMatrix * modelMatrix * vec4(centralVertex.xy - along , 0.0, 1.0));\n    vec4 startPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy         , 0.0, 1.0));\n    vec4 endPosition   = (mvpMatrix * modelMatrix * vec4(centralVertex.xy + along2, 0.0, 1.0));\n    vec4 nextPosition  = (mvpMatrix * modelMatrix * vec4(centralVertex.xy + along3, 0.0, 1.0));\n    vec2 screenPrev  = prevPosition.xy  * 0.5 * size / prevPosition.w;\n    vec2 screenStart = startPosition.xy * 0.5 * size / startPosition.w;\n    vec2 screenEnd   = endPosition.xy   * 0.5 * size / endPosition.w;\n    vec2 screenNext  = nextPosition.xy  * 0.5 * size / nextPosition.w;\n    if (isStartCapVertex < 0.0) {\n        offsetPosition = centralVertex = screenStart;\n        offsetPosDepth = startPosition.zw;\n    } else {\n        offsetPosition = centralVertex = screenEnd;\n        offsetPosDepth = endPosition.zw;\n    }\n    vec2 screenDelta = screenEnd - screenStart;\n    vec2 AB = normalize(screenStart.xy - screenPrev.xy);\n    vec2 BC = normalize(screenDelta);\n    vec2 CD = normalize(screenNext.xy - screenEnd.xy);\n    vec2 a = screenPrev;\n    vec2 b = screenStart;\n    vec2 c = screenEnd;\n    vec2 d = screenNext;\n    vec2 p = (isStartCapVertex < 0.0) ? a : d;\n    vec2 a2 = (isStartCapVertex < 0.0) ? a : c;\n    vec2 b2 = (isStartCapVertex < 0.0) ? b : d;\n    vec2 p2 = (isStartCapVertex < 0.0) ? c : b;\n    vec2 PP = (isStartCapVertex < 0.0) ? AB : CD;\n    vec2 normalBC = vec2(-BC.y, BC.x);\n    vec2 normalPP = vec2(-PP.y, PP.x);\n    float pIsLeftOfBC = ((c.x - b.x)*(p.y - b.y) - (c.y - b.y)*(p.x - b.x)) > 0.0 ? 1.0 : -1.0;\n    vec2 bN = b + normalBC * fsHalfWidth * pIsLeftOfBC;\n    vec2 cN = c + normalBC * fsHalfWidth * pIsLeftOfBC;\n    vec2 pN = p + normalPP * fsHalfWidth * pIsLeftOfBC;\n    float isPIntersecting = ((cN.x - bN.x)*(pN.y - bN.y) - (cN.y - bN.y)*(pN.x - bN.x)) * pIsLeftOfBC;\n    float p2IsLeftOfPP = ((b2.x - a2.x)*(p2.y - a2.y) - (b2.y - a2.y)*(p2.x - a2.x)) > 0.0 ? 1.0 : -1.0;\n    vec2 a2N = a2 + normalPP * fsHalfWidth * p2IsLeftOfPP;\n    vec2 b2N = b2 + normalPP * fsHalfWidth * p2IsLeftOfPP;\n    vec2 p2N = p2 + normalBC * fsHalfWidth * p2IsLeftOfPP;\n    float isP2Intersecting = ((b2N.x - a2N.x)*(p2N.y - a2N.y) - (b2N.y - a2N.y)*(p2N.x - a2N.x)) * p2IsLeftOfPP;\n    float tangentLength = (isStartCapVertex < 0.0) ? length(AB + BC) : length(BC + CD);\n    vec2 tangent = (isStartCapVertex < 0.0) ? normalize(AB + BC) : normalize(BC + CD);\n    vec2 miter = vec2(-tangent.y, tangent.x);\n    vec2 normal = (isStartCapVertex < 0.0) ? vec2(-AB.y, AB.x) : vec2(-BC.y, BC.x);\n    float miterLength = abs(1.0 / dot(miter, normal));\n    vec2 moveOffset;\n    float lwAdjustment = fsHalfWidth + aaRange;\n    if (miterLength > miterLimit || min(isPIntersecting, isP2Intersecting) < 0.0) {\n        moveOffset = isLeftSide * lwAdjustment * normalBC;\n    } else {\n        moveOffset = isLeftSide * miter * lwAdjustment * miterLength;\n    }\n    offsetPosition += moveOffset;\n    float distanceFromStart = max(0.0, isStartCapVertex) * (length(screenDelta) + dot(moveOffset, BC));\n    fsMultipurpose.x = distanceFromStart;\n    fsMultipurpose.y = length(screenDelta) + dot(moveOffset, BC);\n    fsMultipurpose.z = 0.0;\n#ifdef HAS_LINESTYLES\n    fsMultipurpose.w = seg.lineType + 0.5;\n#else\n    fsMultipurpose.w = 0.5;\n#endif\n    if (seg.lineWidthHalf < 0.0)\n        fsHalfWidth = -fsHalfWidth;\n    fsOffsetDirection = offsetPosition - BC * dot(moveOffset, BC) - centralVertex;\n    gl_Position = vec4(2.0 * offsetPosition / size * offsetPosDepth.y, offsetPosDepth.xy);\n#include <logdepthbuf_vert>\n}\n#endif\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\n    attribs.pos           = fields1.xy * unpackXform.xy + unpackXform.zw;\n    attribs.color         = getVertexColor();\n    attribs.geomType      = flags4b.y;\n    attribs.layerTC       = layerVp4b.xy / 255.0;\n    attribs.vpTC          = layerVp4b.zw / 255.0;\n    attribs.lineWidthHalf = unpackLineWeight(fields2.z);\n    attribs.ghosting      = flags4b.w;\n}\nvoid strokeIndexedTriangle() {\n    fsHalfWidth = 0.0;\n    fsMultipurpose.z = 0.0;\n    gl_Position = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n#include <logdepthbuf_vert>\n}\n#ifdef SELECTION_RENDERER\nbool isSelected(const CommonAttribs attribs) {\n    vec3 oid = getDbId().rgb;\n    float id01 = oid.r + oid.g * 256.0;\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\n    float flrt = floor(t);\n    float texU = t - flrt;\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\n    t = (id23 + 0.5) / vSelTexSize.y;\n    float texV = fract(t);\n    vec4 selBit = texture(tSelectionTexture, vec2(texU, texV));\n    return selBit.r == 1.0;\n}\n#endif\nbool isLayerOff(const CommonAttribs attribs) {\n#ifdef HAS_LAYERS\n    vec4 layerBit = texture(tLayerMask, attribs.layerTC);\n    return (layerBit.r == 0.0);\n#else\n    return false;\n#endif\n}\nvec4 getColor(const CommonAttribs attribs) {\n    if (isLayerOff(attribs)) { return vec4(0.0); }\n#ifdef SELECTION_RENDERER\n    if (isSelected(attribs)) { return selectionColor; }\n    return vec4(0.0);\n#else\n    return attribs.color;\n#endif\n}\n#ifdef GAMMA_INPUT\nvec4 inputToLinear(vec4 c) {\n    return vec4(vec3(c*c), c.a);\n}\n#endif\nvoid main() {\n#ifndef UNPACK_POSITIONS\n    unpackXform = vec4(1.0, 1.0, 0.0, 0.0);\n#endif\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\n    fsColor = getColor(attribs);\n    #ifdef GAMMA_INPUT\n    fsColor = inputToLinear(fsColor);\n    #endif\n    if (swap != 0.0 ) {\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\n            fsColor.rgb = vec3(1.0,1.0,1.0);\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\n            fsColor.rgb = vec3(0.0,0.0,0.0);\n    }\n    centralVertex = offsetPosition = attribs.pos;\n    float lineWeight = attribs.lineWidthHalf;\n    float ppu = pixelsPerUnit;\n    if (tanHalfFov > 0.0) {\n        vec4 worldPos = modelMatrix * vec4(offsetPosition.xy, 0.0, 1.0);\n        float distanceToCamera = length(cameraPos - worldPos.xyz);\n        ppu = size.y / (2.0 * distanceToCamera * tanHalfFov);\n    }\n#ifdef HAS_LINESTYLES\n    vPixelsPerUnit = ppu;\n#endif\n    if (lineWeight > 0.0) {\n        lineWeight = max(0.5, lineWeight * ppu);\n    }\n    else {\n        lineWeight = max(0.5, abs(lineWeight));\n    }\n    fsHalfWidth = lineWeight;\n    dbId = dbId4b / 255.0;\n    fsVpTC     = attribs.vpTC;\n    fsGhosting = attribs.ghosting;\n#ifdef LOADING_ANIMATION\n    if (dbId.rgb == vec3(1.0)) {\n        loadingProgress = 1.0;\n    } else {\n        loadingProgress = smoothstep(0.0, 1.0, meshAnimTime);\n    }\n#endif\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_START || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_END)     strokeLineSegment(attribs.geomType);\n#ifdef HAS_MITER_LINES\n    else if (attribs.geomType == VBB_GT_LINE_SEGMENT_MITER) strokeMiterLineSegment();\n#endif\n    else strokeIndexedTriangle();\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef VIEWPORT_CLIPPING\n    vPosition = gl_Position.xy;\n#endif\n}\n"},29126:e=>{e.exports="in highp vec3 vNormal;\nin highp float depth;\n#if NUM_CUTPLANES > 0\nin vec3 vWorldPosition;\n#endif\n#include <cutplanes>\n#include <logdepthbuf_decl_frag>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 n = vNormal;\n    n = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n    n = normalize( n );\n    outFragColor = vec4(n.x, n.y, depth, 1.0);\n#include <logdepthbuf_frag>\n}\n"},47697:e=>{e.exports="out vec3 vNormal;\nout float depth;\n#if NUM_CUTPLANES > 0\nout vec3 vWorldPosition;\n#endif\n#include <pack_normals>\n#include <instancing_decl_vert>\n#include <logdepthbuf_decl_vert>\nvoid main() {\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    depth = mvPosition.z;\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n#include <logdepthbuf_vert>\n}\n"},73560:e=>{e.exports="#ifdef USE_UNIFORM_BUFFER_OBJECTS\n    uniform materials {\n        vec4 matsDiffuseAndShininess[MAX_UBO_MATERIALS];\n        vec4 matsSpecularAndOpacity[MAX_UBO_MATERIALS];\n        vec4 matsEmissiveAndReflectivity[MAX_UBO_MATERIALS];\n    };\n    uniform fragments {\n        ivec3 fragMaterialAndDbID[MAX_UBO_FRAGMENTS];\n        vec4 fragsThemingColor[MAX_UBO_FRAGMENTS];\n    };\n#else\n    uniform vec3 diffuse;\n    uniform vec3 specular;\n    uniform vec3 emissive;\n    uniform float opacity;\n    uniform float shininess;\n    uniform float reflectivity;\n#endif\nuniform vec3 ambientLightColor;\n#include <logdepthbuf_decl_frag>\n#include <env_sample>\n#ifdef USE_COLOR\nin vec3 vColor;\n#endif\n#ifdef GAMMA_INPUT\nvec3 InputToLinear(vec3 c) {\n    return c * c;\n}\nfloat InputToLinear(float c) {\n    return c * c;\n}\n#else\nvec3 InputToLinear(vec3 c) {\n    return c;\n}\nfloat InputToLinear(float c) {\n    return c;\n}\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nin vec2 vUv;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nin vec2 vUvBump;\n#endif\n#if defined( USE_ALPHAMAP )\nin vec2 vUvAlpha;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include <tonemap>\n#endif\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\nuniform float envMapExposure;\n#endif\n#ifdef USE_FOG\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#include <id_decl_frag>\n#include <theming_decl_frag>\n#include <shadowmap_decl_frag>\n#ifdef USE_ENVMAP\n#ifndef USE_UNIFORM_BUFFER_OBJECTS\nuniform float reflMipIndex;\n#endif\nuniform samplerCube envMap;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\nvec3 sampleReflection(vec3 dir, float mipIndex) {\n    vec3 adjDir = adjustLookupVector(dir);\n#ifdef ENV_GAMMA\n    vec4 envTexColor = textureLod( envMap, adjDir, mipIndex );\n    return GammaDecode(envTexColor, envMapExposure);\n#elif defined(ENV_RGBM)\n    vec4 envTexColor = textureLod( envMap, adjDir, mipIndex );\n    return RGBMDecode(envTexColor, envMapExposure);\n#else\n    vec4 envTexColor = texture( envMap, adjDir );\n    vec3 cubeColor = envTexColor.xyz;\n#ifdef GAMMA_INPUT\n    cubeColor *= cubeColor;\n#endif\n    return cubeColor;\n#endif\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef USE_IRRADIANCEMAP\nuniform samplerCube irradianceMap;\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nin highp vec3 vWorldPosition;\n#endif\nin highp vec3 vViewPosition;\n#ifndef FLAT_SHADED\nin highp vec3 vNormal;\n#endif\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\n    vec2 dSTdx = dFdx( vUvBump );\n    vec2 dSTdy = dFdy( vUvBump );\n    float Hll = bumpScale * GET_BUMPMAP(vUvBump).x;\n    float dBx = bumpScale * GET_BUMPMAP(vUvBump + dSTdx).x - Hll;\n    float dBy = bumpScale * GET_BUMPMAP(vUvBump + dSTdy).x - Hll;\n    return vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n    vec3 vSigmaX = dFdx( surf_pos );\n    vec3 vSigmaY = dFdy( surf_pos );\n    vec3 vN = surf_norm;\n    vec3 R1 = cross( vSigmaY, vN );\n    vec3 R2 = cross( vN, vSigmaX );\n    float fDet = dot( vSigmaX, R1 );\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n    return normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif\n#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n    vec3 q0 = dFdx( eye_pos.xyz );\n    vec3 q1 = dFdy( eye_pos.xyz );\n    vec2 st0 = dFdx( vUvBump.st );\n    vec2 st1 = dFdy( vUvBump.st );\n    vec3 S = normalize(  q0 * st1.t - q1 * st0.t );\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n    vec3 N = normalize( surf_norm );\n    vec3 mapN = GET_NORMALMAP(vUvBump).xyz * 2.0 - 1.0;\n    mapN.xy = normalScale * mapN.xy;\n    mat3 tsn = mat3( S, T, N );\n    return normalize( tsn * mapN );\n}\n#endif\n#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif\n#ifdef USE_ALPHAMAP\nuniform sampler2D alphaMap;\n#endif\n#include <hatch_pattern>\nvec3 Schlick_v3(vec3 v, float cosHV) {\n    float facing = max(1.0 - cosHV, 0.0);\n    return v + (1.0 - v) * pow(facing, 5.0);\n}\nfloat Schlick_f(float v, float cosHV) {\n    float facing = max(1.0 - cosHV, 0.0);\n    return v + ( 1.0 - v ) * pow(facing, 5.0);\n}\n#include <cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n#ifdef USE_UNIFORM_BUFFER_OBJECTS\n    int id = int(vId.r*255.0 + vId.g*255.0 * 256.0 + vId.b*255.0 * 256.0 * 256.0);\n    int dbIdInt = fragMaterialAndDbID[id].g;\n    int matId = fragMaterialAndDbID[id].r;\n    vec3 diffuse = matsDiffuseAndShininess[matId].rgb;\n    float shininess = matsDiffuseAndShininess[matId].a;\n    vec3 specular = matsSpecularAndOpacity[matId].rgb;\n    float opacity = matsSpecularAndOpacity[matId].a;\n    vec3 emissive = matsEmissiveAndReflectivity[matId].rgb;\n    float reflectivity = matsEmissiveAndReflectivity[matId].a;\n    float logShiny = log2(max(1.0+1e-10, shininess));\n    float reflMipIndex = max(0.0, -0.5 * logShiny + 5.5);\n#endif\n    outFragColor = vec4( vec3 ( 1.0 ), opacity );\n#ifdef USE_MAP\n    vec4 texelColor = GET_MAP(vUv);\n#ifdef MAP_INVERT\n    texelColor.xyz = 1.0-texelColor.xyz;\n#endif\n#ifdef GAMMA_INPUT\n    texelColor.xyz *= texelColor.xyz;\n#endif\n    outFragColor = outFragColor * texelColor;\n#endif\n#ifdef USE_ALPHAMAP\n    vec4 texelAlpha = GET_ALPHAMAP(vUvAlpha);\n    outFragColor.a *= texelAlpha.r;\n#endif\n#ifdef ALPHATEST\n    if ( outFragColor.a < ALPHATEST ) discard;\n#endif\n    float specularStrength;\n#ifdef USE_SPECULARMAP\n    vec4 texelSpecular = GET_SPECULARMAP(vUv);\n    specularStrength = texelSpecular.r;\n#else\n    specularStrength = 1.0;\n#endif\n#ifndef FLAT_SHADED\n    vec3 normal = normalize( vNormal );\n#ifdef DOUBLE_SIDED\n#endif\n#else\n    vec3 fdx = dFdx( vViewPosition );\n    vec3 fdy = dFdy( vViewPosition );\n    vec3 normal = normalize( cross( fdx, fdy ) );\n#endif\n    vec3 viewDirection;\n    if (projectionMatrix[3][3] == 0.0) {\n        viewDirection = normalize( vViewPosition );\n    } else {\n        viewDirection = vec3(0.0, 0.0, 1.0);\n    }\n    normal = faceforward(normal, -viewDirection, normal);\n    vec3 geomNormal = normal;\n#ifdef USE_NORMALMAP\n    normal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n    normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n    vec3 totalDiffuse = vec3( 0.0 );\n    vec3 totalSpecular = vec3( 0.0 );\n    float shininessB = shininess * 4.0;\n#if MAX_POINT_LIGHTS > 0\n    vec3 pointDiffuse  = vec3( 0.0 );\n    vec3 pointSpecular = vec3( 0.0 );\n    for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        float lDistance = 1.0;\n        if ( pointLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n        lVector = normalize( lVector );\n        float dotProduct = dot( normal, lVector );\n        float pointDiffuseWeight = max( dotProduct, 0.0 );\n        pointDiffuse  += InputToLinear(diffuse) * InputToLinear(pointLightColor[ i ]) * pointDiffuseWeight * lDistance;\n        vec3 pointHalfVector = normalize( lVector + viewDirection );\n        float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n        float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininessB ), 0.0 );\n        float specularNormalization = shininessB * 0.125 + 0.25;\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, pointHalfVector ) );\n        pointSpecular += schlick * InputToLinear(pointLightColor[ i ]) * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization ;\n    }\n    totalDiffuse += pointDiffuse;\n    totalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\n    vec3 spotDiffuse  = vec3( 0.0 );\n    vec3 spotSpecular = vec3( 0.0 );\n    for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        float lDistance = 1.0;\n        if ( spotLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n        lVector = normalize( lVector );\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n        if ( spotEffect > spotLightAngleCos[ i ] ) {\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n            float dotProduct = dot( normal, lVector );\n            float spotDiffuseWeight = max( dotProduct, 0.0 );\n            spotDiffuse += InputToLinear(diffuse) * InputToLinear(spotLightColor[ i ]) * spotDiffuseWeight * lDistance * spotEffect;\n            vec3 spotHalfVector = normalize( lVector + viewDirection );\n            float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n            float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininessB ), 0.0 );\n            float specularNormalization = shininessB * 0.125 + 0.25;\n            vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, spotHalfVector ) );\n            spotSpecular += schlick * InputToLinear(spotLightColor[ i ]) * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n        }\n    }\n    totalDiffuse += spotDiffuse;\n    totalSpecular += spotSpecular;\n#endif\n#if MAX_DIR_LIGHTS > 0\n    vec3 dirDiffuse  = vec3( 0.0 );\n    vec3 dirSpecular = vec3( 0.0 );\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n        vec3 dirVector = normalize( lDirection.xyz );\n        float dotProduct = dot( normal, dirVector );\n        float dirDiffuseWeight = max( dotProduct, 0.0 );\n        dirDiffuse  += InputToLinear(diffuse) * InputToLinear(directionalLightColor[ i ]) * dirDiffuseWeight;\n        vec3 dirHalfVector = normalize( dirVector + viewDirection );\n        float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n        float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininessB ), 0.0 );\n        float specularNormalization = shininessB * 0.125 + 0.25;\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( dirVector, dirHalfVector ));\n        dirSpecular += schlick * InputToLinear(directionalLightColor[ i ]) * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n    }\n    totalDiffuse += dirDiffuse;\n    totalSpecular += dirSpecular;\n#endif\n#ifdef USE_IRRADIANCEMAP\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\n    vec3 indirectDiffuse = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\n    indirectDiffuse = applyEnvShadow(indirectDiffuse, worldNormal);\n    totalDiffuse += InputToLinear(diffuse) * indirectDiffuse;\n#endif\n#ifdef METAL\n    outFragColor.xyz = outFragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) + totalSpecular );\n#else\n    outFragColor.xyz = outFragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) ) + totalSpecular;\n#endif\n#ifdef USE_COLOR\n    outFragColor = outFragColor * vec4( vColor, 1.0 );\n#endif\n#if defined(USE_ENVMAP)\n    vec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n#ifdef ENVMAP_MODE_REFLECTION\n    reflectVec = reflect( -viewDirection, normal );\n#else\n    reflectVec = refract( -viewDirection, normal, refractionRatio );\n#endif\n#else\n    reflectVec = reflect( -viewDirection, normal );\n#endif\n    reflectVec = mat3(viewMatrixInverse) * reflectVec;\n    float reflectScale = 1.0;\n    vec3 cubeColor = sampleReflection(reflectVec, reflMipIndex);\n    cubeColor *= reflectScale;\n    float facing = dot( viewDirection, normal );\n    if (facing < -1e-2  || reflectivity == 0.0)\n        facing = 1.0;\n    else\n        facing = max(1e-6, facing);\n#ifdef USE_BUMPMAP\n    facing = min(1.0, facing + bumpScale * 7.0);\n#endif\n    vec3 schlickRefl;\n#ifdef METAL\n    schlickRefl = InputToLinear(specular);\n#else\n    schlickRefl = Schlick_v3(InputToLinear(specular), facing);\n    outFragColor.a = mix(outFragColor.a, Schlick_f(outFragColor.a, facing), reflectivity);\n    float invSchlick = pow(1.0 - facing * 0.5, 5.0);\n    float norm_factor = (28.0 / 23.0) * (1.0 - invSchlick) * (1.0 - invSchlick);\n    outFragColor.xyz *= norm_factor * (1.0 - InputToLinear(specular));\n#endif\n    outFragColor.xyz += cubeColor.xyz * specularStrength * schlickRefl.xyz;\n#ifdef CLEARCOAT\n    vec3 reflectVecClearcoat = reflect( -viewDirection, geomNormal );\n    reflectVecClearcoat = mat3(viewMatrixInverse) * reflectVecClearcoat;\n    vec3 cubeColorClearcoat = sampleReflection(reflectVecClearcoat, 0.0);\n    float schlickClearcoat = Schlick_f(InputToLinear(reflectivity), facing);\n    outFragColor.xyz = mix(outFragColor.xyz, cubeColorClearcoat * schlickClearcoat, 0.5);\n#endif\n#endif\n#if TONEMAP_OUTPUT == 1\n    outFragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * outFragColor.xyz);\n#elif TONEMAP_OUTPUT == 2\n    outFragColor.xyz = toneMapCanonFilmic_WithGamma( exposureBias * outFragColor.xyz );\n#endif\n#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\n    outFragColor = mix( outFragColor, vec4( fogColor, outFragColor.w ), fogFactor );\n#endif\n#include <theming_frag>\n#include <final_frag>\n#include <logdepthbuf_frag>\n}\n"},77431:e=>{e.exports="out vec3 vViewPosition;\n#ifndef FLAT_SHADED\nout vec3 vNormal;\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nout vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nout vec2 vUvBump;\nuniform mat3 texMatrixBump;\n#endif\n#if defined( USE_ALPHAMAP )\nout vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#if defined( USE_ENVMAP )\n#if ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\n#endif\n#include <theming_decl_vert>\n#ifdef USE_UNIFORM_BUFFER_OBJECTS\n    uniform fragments {\n        ivec3 fragMaterialAndDbID[MAX_UBO_FRAGMENTS];\n        vec4 fragsThemingColor[MAX_UBO_FRAGMENTS];\n    };\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nout vec3 vWorldPosition;\n#endif\n#ifdef USE_COLOR\nout vec3 vColor;\n#endif\n#ifdef MRT_NORMALS\nout float depth;\n#endif\n#include <logdepthbuf_decl_vert>\n#include <pack_normals>\n#include <instancing_decl_vert>\n#include <id_decl_vert>\n#include <wide_lines_decl>\n#include <shadowmap_decl_vert>\nvoid main() {\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n    vUvBump = (texMatrixBump * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_ALPHAMAP )\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\n    vColor = color * color;\n#else\n    vColor = color;\n#endif\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n#include <logdepthbuf_vert>\n#include <wide_lines_vert>\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include <shadowmap_vert>\n#include <id_vert>\n#include <theming_vizflag_vert>\n}\n"},9893:e=>{e.exports="\n#define EDGE_SHARPNESS     (3.0)\n#define SCALE               (2)\n#define R                   (4)\n#define VALUE_TYPE        float\n#define VALUE_COMPONENTS   r\n#define VALUE_IS_KEY       0\n#define KEY_COMPONENTS     gb\n#if __VERSION__ >= 330\nconst float gaussian[R + 1] =\nfloat[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);\n#endif\nuniform sampler2D   tDiffuse;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform vec2       axis;\nuniform float radius;\n#define  result         outFragColor.VALUE_COMPONENTS\n#define  keyPassThrough outFragColor.KEY_COMPONENTS\nfloat unpackKey(vec2 p) {\n    return p.x + p.y * (1.0 / 255.0);\n}\nin vec2 vUv;\nvoid main() {\n#   if __VERSION__ < 330\n    float gaussian[R + 1];\n#       if R == 3\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;\n#       elif R == 4\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;\n#       elif R == 6\n    gaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;\n#       endif\n#   endif\n    ivec2 axisi = ivec2(axis);\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 temp = texture(tDiffuse, vUv);\n    outFragColor.gb = temp.KEY_COMPONENTS;\n    outFragColor.a = temp.a;\n    VALUE_TYPE sum = temp.VALUE_COMPONENTS;\n    if (temp.a == 0.0) {\n        result = sum;\n        return;\n    }\n    float key = unpackKey(keyPassThrough);\n    float BASE = gaussian[0];\n    float totalWeight = BASE;\n    sum *= totalWeight;\n    float scale = 1.5 / radius;\n    int r = -4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r=-1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    const float epsilon = 0.0001;\n    result = sum / (totalWeight + epsilon);\n}\n"},78101:e=>{e.exports="\n#include <depth_texture>\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform float lumInfluence;\nin vec2 vUv;\n#define NUM_SAMPLES (17)\n#define LOG_MAX_OFFSET (3)\n#define NUM_SPIRAL_TURNS (5)\n#define MIN_RADIUS (3.0)\n#define TAU 6.28318530718\nuniform float           projScale;\n#ifdef USE_MIPMAP\nuniform sampler2D tDepth_mip1;\nuniform sampler2D tDepth_mip2;\nuniform sampler2D tDepth_mip3;\nuniform sampler2D tDepth_mip4;\nuniform sampler2D tDepth_mip5;\n#endif\nuniform float radius;\nuniform float bias;\nuniform float intensity;\nvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));\n    float angle = alpha * (float(NUM_SPIRAL_TURNS) * TAU) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nfloat CSZToKey(float z) {\n    return clamp( (z+cameraNear) / (cameraNear-cameraFar), 0.0, 1.0);\n}\nvoid packKey(float key, out vec2 p) {\n    float temp = floor(key * 255.0);\n    p.x = temp * (1.0 / 255.0);\n    p.y = key * 255.0 - temp;\n}\n#include <pack_depth>\nfloat unpackDepthNearFar( const in vec4 rgba_depth ) {\n    float depth = unpackDepth( rgba_depth );\n    if (depth == 0.0)\n        return -cameraFar * 1.0e10;\n    return depth * (cameraNear - cameraFar) - cameraNear;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 reconstructNonUnitCSFaceNormal(vec3 C) {\n    return cross(dFdy(C), dFdx(C));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nvec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {\n    ivec2 ssP = ivec2(ssR * unitOffset) + ssC;\n    vec3 P;\n#ifdef USE_MIPMAP\n    int mipLevel = clamp(int(floor(log2(ssR))) - LOG_MAX_OFFSET, 0, MAX_MIP_LEVEL);\n    if (mipLevel == 0) {\n        P.z = texelFetch(tDepth, ssP, 0).z;\n        if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n    }\n    else if (mipLevel == 1) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip1, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip1, mipP, 0));\n    } else if (mipLevel == 2) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip2, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip2, mipP, 0));\n    } else if (mipLevel == 3) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip3, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip3, mipP, 0));\n    } else if (mipLevel == 4) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip4, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip4, mipP, 0));\n    } else if (mipLevel == 5) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip5, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip5, mipP, 0));\n    }\n#else\n    P.z = texelFetch(tDepth, ssP, 0).z;\n    if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n#endif\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);\n    return P;\n}\nfloat sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {\n    float ssR;\n    vec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);\n    ssR = max(0.75, ssR * ssDiskRadius);\n    vec3 Q = getOffsetPosition(ssC, unitOffset, ssR);\n    vec3 v = Q - C;\n    float vv = dot(v, v);\n    float vn = dot(v, n_C);\n    const float epsilon = 0.001;\n    float angAdjust = mix(1.0, max(0.0, 1.5 * n_C.z), 0.35);\n#define HIGH_QUALITY\n#ifdef HIGH_QUALITY\n    float f = max(1.0 - vv / (radius * radius), 0.0); return angAdjust * f * max((vn - bias) / sqrt(epsilon + vv), 0.0);\n#else\n    float f = max(radius * radius - vv, 0.0); return angAdjust * f * f * f * max((vn - bias) / (epsilon + vv), 0.0);\n#endif\n}\nconst bool useNoise = true;\nfloat getRandomAngle(vec2 pos) {\n    float dt= dot(pos ,vec2(12.9898,78.233));\n    return TAU * fract(sin(mod(dt,3.14)) * 43758.5453);\n}\nvoid main() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 nrmz = texture(tDepth, vUv);\n    if (nrmz.z == 0.0) {\n        outFragColor.r = 1.0;\n        outFragColor.a = 0.0;\n        packKey(1.0, outFragColor.gb);\n        return;\n    }\n    vec3 C = getPosition(ssC, nrmz.z);\n    packKey(CSZToKey(C.z), outFragColor.gb);\n    float ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);\n    float A;\n    if (ssDiskRadius <= MIN_RADIUS) {\n        A = 1.0;\n    } else {\n        float sum = 0.0;\n        float randomPatternRotationAngle = getRandomAngle(vUv);\n        vec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);\n        float intensityDivR6 = intensity / pow(radius, 6.0);\n#ifdef HIGH_QUALITY\n        A = pow(max(0.0, 1.0 - sqrt(sum * (3.0 / float(NUM_SAMPLES)))), intensity);\n#else\n        A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\n        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n#endif\n        if (abs(dFdx(C.z)) < 0.02) {\n            A -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n        }\n        if (abs(dFdy(C.z)) < 0.02) {\n            A -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n        }\n        A = mix(1.0, A, clamp(ssDiskRadius - MIN_RADIUS,0.0,1.0));\n    }\n    outFragColor.r = A;\n    outFragColor.a = 1.0;\n}\n"},67020:e=>{e.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    outFragColor = texture(tDiffuse, ssP);\n}\n"},18952:e=>{e.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraInvNearFar;\n#include <pack_depth>\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    float depth = texture(tDiffuse, ssP).z;\n    if (depth != 0.0)\n        depth = (depth + cameraNear) * cameraInvNearFar;\n    outFragColor = packDepth(depth);\n}\n"},44203:e=>{e.exports="out vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},37787:e=>{e.exports="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},32968:e=>{e.exports="#include <shadowmap_decl_common>\nin float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#include <float3_average>\n#if defined( USE_SURFACE_CUTOUT_MAP )\n    uniform sampler2D surface_cutout_map;\n    uniform mat3 surface_cutout_map_texMatrix;\n    uniform bool surface_cutout_map_invert;\n#endif\nin vec2 vUv;\n#else\n#ifdef USE_MAP\nin vec2 vUv;\nuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\nin vec2 vUvAlpha;\nuniform sampler2D alphaMap;\n#endif\n#endif\nuniform float shadowMinOpacity;\nvoid applyCutoutMaps() {\n    float opacity = 1.0;\n#ifdef USE_SURFACE_CUTOUT_MAP\n    #if defined( USE_SURFACE_CUTOUT_MAP )\n        vec2 uv_surface_cutout_map = (surface_cutout_map_texMatrix * vec3(uv, 1.0)).xy;\n        SURFACE_CUTOUT_CLAMP_TEST;\n        vec3 opacity_v3 = texture(surface_cutout_map, uv_surface_cutout_map).xyz;\n        if(surface_cutout_map_invert) opacity_v3 = vec3(1.0) - opacity_v3;\n        opacity = average(opacity_v3);\n    #else\n        opacity = surface_cutout;\n    #endif\n#else\n#ifdef USE_MAP\n    opacity *= GET_MAP(vUv).a;\n#endif\n#ifdef USE_ALPHAMAP\n    opacity *= GET_ALPHAMAP(vUvAlpha).r;\n#endif\n#endif\n#if defined(USE_SURFACE_CUTOUT_MAP) || defined(USE_MAP) || defined(USE_ALPHAMAP)\n    if (opacity < shadowMinOpacity) discard;\n#endif\n}\nvoid main() {\n    float normalizedLinearDepth = (depth - shadowMapRangeMin) / shadowMapRangeSize;\n    float val = exp(shadowESMConstant * normalizedLinearDepth);\n#ifdef USE_HARD_SHADOWS\n    val = normalizedLinearDepth;\n#endif\n    applyCutoutMaps();\n    outFragColor = vec4(val, 0, 0, 1);\n}\n"},77500:e=>{e.exports="#include <shadowmap_decl_frag>\nvoid main() {\n    float shadowIntensity = 0.5 * (1.0 - getShadowValue());\n    outFragColor = vec4(0.0, 0.0, 0.0, shadowIntensity);\n}\n"},54707:e=>{e.exports="#include <shadowmap_decl_vert>\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n#include <shadowmap_vert>\n}\n"},9063:e=>{e.exports="#include <shadowmap_decl_common>\nout float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\nout vec2 vUv;\n#else\n#ifdef USE_MAP\nout vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#ifdef USE_ALPHAMAP\nout vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#endif\nvoid passCutoutUVCoords() {\n#ifdef USE_SURFACE_CUTOUT_MAP\n    vUv = uv;\n#else\n#ifdef USE_MAP\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_ALPHAMAP\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#endif\n}\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n    depth = -mvPosition.z;\n    passCutoutUVCoords();\n}\n"},88368:e=>{e.exports="#include <id_decl_frag>\n#include <logdepthbuf_decl_frag>\nuniform sampler2D sheetMap;\nuniform sampler2D idMap;\nuniform vec2 resolution;\nuniform vec3 modelIDv2;\nuniform float alphaTest;\nvoid main() {\n    vec2 uv = vec2(gl_FragCoord.x * resolution.x, gl_FragCoord.y * resolution.y);\n    vec4 c = texture(sheetMap, uv);\n    if (c.a <= alphaTest)\n        discard;\n    outFragColor = c;\n    vec4 dbId = texture(idMap, uv);\n#ifdef MRT_NORMALS\n    outNormal = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\n#ifdef MRT_ID_BUFFER\n    outId = vec4(dbId.rgb, 1.0);\n    #ifdef MODEL_COLOR\n    outModelId = vec4(modelIDv2.rgb, 1.0);\n    #endif\n#elif defined(ID_COLOR)\n    outFragColor = vec4(dbId.rgb, 1.0);\n#elif defined(MODEL_COLOR)\n    outFragColor = vec4(modelIDv2.rgb, 1.0);\n#endif\n#include <logdepthbuf_frag>\n}\n"},38383:e=>{e.exports="#include <logdepthbuf_decl_vert>\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    #include <logdepthbuf_vert>\n}"},15227:e=>{e.exports={externalExtensions:[{src:"./extensions/DeveloperTools/index.js",ids:["Autodesk.DeveloperTools.AABBoxAccuracyLogger","Autodesk.DeveloperTools.Benchmark","Autodesk.DeveloperTools.BoundingVolumeDebugger","Autodesk.DeveloperTools.CameraHelper","Autodesk.DeveloperTools.CameraOverride","Autodesk.DeveloperTools.CameraPathCapture","Autodesk.DeveloperTools.CameraPathRecorder","Autodesk.DeveloperTools.CameraPathGenerator","Autodesk.DeveloperTools.CanvasVideoRecorder","Autodesk.DeveloperTools.LocalStorageCamera","Autodesk.DeveloperTools.PixelDeviationTest","Autodesk.DeveloperTools.RenderBatchAnalyzer","Autodesk.DeveloperTools.RenderHierarchyControls","Autodesk.DeveloperTools.Shortcuts","Autodesk.DeveloperTools.StatisticsOverlay","Autodesk.DeveloperTools.TrackRenderTimings","Autodesk.DeveloperTools.WebGLDrawStatistics","Autodesk.DeveloperTools.WebGLFunctionIntrusion","Autodesk.DeveloperTools.WebGLObjectCounters","Autodesk.DeveloperTools.WebGLResourceSnapshot","Autodesk.DeveloperTools.WebGPUFramebufferInspector"]},{src:"./extensions/Wireframes/Wireframes.js",ids:["Autodesk.Viewing.Wireframes"]},{src:"./extensions/ZoomWindow/ZoomWindow.js",ids:["Autodesk.Viewing.ZoomWindow"]},{src:"./extensions/AEC/LibraryExports.js",ids:["Autodesk.AEC.LevelsExtension","Autodesk.AEC.HyperlinkExtension","Autodesk.AEC.DropMeExtension","Autodesk.AEC.CanvasBookmarkExtension","Autodesk.AEC.Minimap3DExtension","Autodesk.AEC.LocationsExtension","Autodesk.AEC.Hypermodeling","Autodesk.AEC.ViewportsExtension","Autodesk.AEC.DisciplinesExtension"]},{src:"./extensions/Pushpins/PushPinExtension.js",ids:["Autodesk.BIM360.Extension.PushPin"]},{src:"./extensions/Hyperlink/Hyperlink.js",ids:["Autodesk.Hyperlink"]},{src:"./extensions/Debug/Debug.js",ids:["Autodesk.Debug"]},{src:"./extensions/BimWalk/BimWalk.js",ids:["Autodesk.BimWalk"]},{src:"./extensions/Section/Section.js",ids:["Autodesk.Section"]},{src:"./extensions/SmartSection/index.js",ids:["Autodesk.SmartSection"]},{src:"./extensions/CompGeom/index.js",ids:["Autodesk.CompGeom"]},{src:"./extensions/Snapping/index.js",ids:["Autodesk.Snapping"]},{src:"./extensions/Beeline/Beeline.js",ids:["Autodesk.Beeline"]},{src:"./extensions/FirstPerson/FirstPerson.js",ids:["Autodesk.FirstPerson"]},{src:"./extensions/webVR/webVR.js",ids:["Autodesk.Viewing.WebVR"]},{src:"./extensions/CAM360/CAM360.js",ids:["Autodesk.CAM360"]},{src:"./extensions/FusionSim/FusionSim.js",ids:["Autodesk.Fusion360.Simulation"]},{src:"./extensions/OMV/OMV.js",ids:["Autodesk.OMV"]},{src:"./extensions/SplitScreen/SplitScreen.js",ids:["Autodesk.SplitScreen"]},{src:"./extensions/CrossFadeEffects/CrossFadeEffects.js",ids:["Autodesk.CrossFadeEffects"]},{src:"./extensions/Edit2D/Edit2D.js",ids:["Autodesk.Edit2D"]},{src:"./extensions/Edit3D/Edit3D.js",ids:["Autodesk.Edit3D"]},{src:"./extensions/VisualClusters/VisualClusters.js",ids:["Autodesk.VisualClusters"]},{src:"./extensions/Moldflow/Moldflow.js",ids:["Autodesk.Moldflow"]},{src:"./extensions/PixelCompare/PixelCompare.js",ids:["Autodesk.Viewing.PixelCompare"]},{src:"./extensions/ScalarisSimulation/ScalarisSimulation.js",ids:["Autodesk.Viewing.ScalarisSimulation"]},{src:"./extensions/Measure/Measure.js",ids:["Autodesk.Measure"]},{src:"./extensions/Markup/Markup.js",ids:["Autodesk.Viewing.MarkupsCore","Autodesk.Viewing.MarkupsGui"]},{src:"./extensions/PDF/index.js",ids:["Autodesk.PDF"]},{src:"./extensions/ReCap/index.js",ids:["Autodesk.ReCap"]},{src:"./extensions/Scalaris/index.js",ids:["Autodesk.Scalaris"]},{src:"./extensions/DocumentBrowser/index.js",ids:["Autodesk.DocumentBrowser"]},{src:"./extensions/Geolocation/index.js",ids:["Autodesk.Geolocation"]},{src:"./extensions/Fusion360/AnimationExtension.js",ids:["Autodesk.Fusion360.Animation"]},{src:"./extensions/NPR/index.js",ids:["Autodesk.NPR"]},{src:"./extensions/DOF/DOFExtension.js",ids:["Autodesk.DOF"]},{src:"./extensions/MSDF/index.js",ids:["Autodesk.MSDF"]},{src:"./extensions/MemoryLimited/MemoryLimited.js",ids:["Autodesk.MemoryLimited"]},{src:"./extensions/ViewCubeUi/ViewCubeUi.js",ids:["Autodesk.ViewCubeUi"]},{src:"./extensions/MemoryLimitedDebug/MemoryManager.js",ids:["Autodesk.Viewing.MemoryLimitedDebug"]},{src:"./extensions/BimMarkups/BimMarkups.js",ids:["Autodesk.BIM360.Markups"]},{src:"./extensions/Minimap2D/Minimap2D.js",ids:["Autodesk.BIM360.Minimap"]},{src:"./extensions/GestureDocumentNavigation/GestureDocumentNavigation.js",ids:["Autodesk.BIM360.GestureDocumentNavigation"]},{src:"./extensions/RollCamera/RollCamera.js",ids:["Autodesk.BIM360.RollCamera"]},{src:"./extensions/LayerManager/LayerManager.js",ids:["Autodesk.LayerManager"]},{src:"./extensions/SceneBuilder/sceneBuilder.js",ids:["Autodesk.Viewing.SceneBuilder"]},{src:"./extensions/Popout/index.js",ids:["Autodesk.Viewing.Popout"]},{src:"./extensions/ProfileUi/index.js",ids:["Autodesk.ProfileUi"]},{src:"./extensions/PropertySearch/PropertySearch.js",ids:["Autodesk.PropertySearch"]},{src:"./extensions/StandardSurface/index.js",ids:["Autodesk.StandardSurface"]},{src:"./extensions/MaterialConverterPrism/index.js",ids:["Autodesk.Viewing.MaterialConverterPrism"]},{src:"./extensions/DWF/index.js",ids:["Autodesk.DWF"]},{src:"./extensions/ModelsPanel/index.js",ids:["Autodesk.ModelsPanel"]},{src:"./extensions/ModelAlignment/index.js",ids:["Autodesk.ModelAlignment","Autodesk.SheetAlignment"],dependencies:["Autodesk.Edit3D"]},{src:"./extensions/ModelAlignmentService/ModelAlignmentService.js",ids:["Autodesk.ModelAlignmentService"]},{src:"./extensions/MixpanelProvider/index.js",ids:["Autodesk.Viewing.MixpanelExtension"]},{src:"./extensions/Crop/Crop.js",ids:["Autodesk.Crop"]},{src:"./extensions/DataVisualization/index.js",ids:["Autodesk.DataVisualization"]},{src:"./extensions/ExtensionsPanel/index.js",ids:["Autodesk.ExtensionsPanel"]},{src:"./extensions/StringExtractor/StringExtractor.js",ids:["Autodesk.StringExtractor"]},{src:"./extensions/ModelSheetTransition/ModelSheetTransition.js",ids:["Autodesk.ModelSheetTransition"]},{src:"./extensions/BoxSelection/BoxSelectionExtension.js",ids:["Autodesk.BoxSelection"]},{src:"./extensions/glTF/index.js",ids:["Autodesk.glTF"]},{src:"./extensions/PropertyQuery/index.js",ids:["Autodesk.PropertyQuery"]},{src:"./extensions/VaultPrintUI/index.js",ids:["Autodesk.Vault.Print"]},{src:"./extensions/VaultMarkupsUI/index.js",ids:["Autodesk.Vault.Markups"],dependencies:["Autodesk.BIM360.Markups"]},{src:"./extensions/DataExchange/DataExchange.js",ids:["Autodesk.DataExchange"]},{src:"./extensions/Multipage/Multipage.js",ids:["Autodesk.Multipage"]},{src:"./extensions/DynamicDimensions/DynamicDimensions.js",ids:["Autodesk.DynamicDimensions"]},{src:"./extensions/Filter/index.js",ids:["Autodesk.Filter"],buildConfig:"./extensions/Filter/webpack.config.js"},{src:"./extensions/CustomProperties/index.js",ids:["Autodesk.CustomProperties"]},{src:"./extensions/Grid/Grid.js",ids:["Autodesk.Grid"]},{src:"./extensions/DataPersistence/persistence.js",ids:["Autodesk.DataPersistence"]},{src:"./extensions/CADLabeling/index.js",ids:["Autodesk.CADLabeling"]}],restrictedExternalExtensions:[{src:"./extensions/AECC/index.js",ids:["Autodesk.AEC.CivilTools","Autodesk.AEC.StationTracker","Autodesk.AEC.StationLabels"]}],getExtensionEntryKey:function(e){return e.src.split("/")[2]}}},77427:e=>{"use strict";let t=new function(){this.names=[{symbol:"en",label:"English"},{symbol:"zh-Hans",label:"Chinese Simplified"},{symbol:"zh-Hant",label:"Chinese Traditional"},{symbol:"zh-HK",label:"Hong Kong Traditional"},{symbol:"ja",label:"Japanese"},{symbol:"cs",label:"Czech"},{symbol:"ko",label:"Korean"},{symbol:"pl",label:"Polish"},{symbol:"ru",label:"Russian"},{symbol:"fr",label:"French"},{symbol:"fr-CA",label:"Canadian French"},{symbol:"de",label:"German"},{symbol:"it",label:"Italian"},{symbol:"nl",label:"Dutch"},{symbol:"es",label:"Spanish"},{symbol:"pt-PT",label:"Portuguese Portugal"},{symbol:"pt-BR",label:"Portuguese Brazil"},{symbol:"tr",label:"Turkish"},{symbol:"sv",label:"Swedish"},{symbol:"da",label:"Danish"},{symbol:"no",label:"Norwegian"},{symbol:"en-GB",label:"British English"}],this.isSupported=function(e){for(var t=0;t<this.names.length;++t)if(this.names[t].symbol===e)return!0;return!1},this.getSupported=function(e){const t=e.split("-");if(e=t[0].toLowerCase(),t.length>1){let i=t[1].toUpperCase();i.length>2&&(i=i[0]+i.substring(1).toLowerCase()),e+="-"+i}return this.isSupported(e)||(e=e.indexOf("zh-CN")>-1?"zh-Hans":e.indexOf("zh-TW")>-1?"zh-Hant":t.length>1&&this.isSupported(t[0].toLowerCase())?t[0]:"en"),e},this.getLanguages=function(){return this.names.slice()}};e.exports={Lang:t}},41944:(e,t,i)=>{"use strict";i.d(t,{A:()=>n}),e=i.hmd(e),
/*! Hammer.JS - v2.0.8 - 2016-04-23
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
function(t,n,r,o){var s=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),l="function",c=Math.round,u=Math.abs,h=Date.now;function d(e,t,i){return setTimeout(x(e,i),t)}function f(e,t,i){return!!Array.isArray(e)&&(p(e,i[t],i),!0)}function p(e,t,i){var n;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==o)for(n=0;n<e.length;)t.call(i,e[n],n,e),n++;else for(n in e)e.hasOwnProperty(n)&&t.call(i,e[n],n,e)}function m(e,i,n){var r="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,r,n),e.apply(this,arguments)}}var g=function(e){if(e===o||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==o&&null!==n)for(var r in n)n.hasOwnProperty(r)&&(t[r]=Array.isArray(n[r])?n[r].slice(0):n[r])}return t},v=m((function(e,t,i){for(var n=Object.keys(t),r=0;r<n.length;)(!i||i&&e[n[r]]===o)&&(e[n[r]]=t[n[r]]),r++;return e}),"extend","Use `assign`."),y=m((function(e,t){return v(e,t,!0)}),"merge","Use `assign`.");function b(e,t,i){var n,r=t.prototype;(n=e.prototype=Object.create(r)).constructor=e,n._super=r,i&&g(n,i)}function x(e,t){return function(){return e.apply(t,arguments)}}function _(e,t){return typeof e==l?e.apply(t&&t[0]||o,t):e}function E(e,t){return e===o?t:e}function S(e,t,i){p(T(t),(function(t){e.addEventListener(t,i,!1)}))}function A(e,t,i){p(T(t),(function(t){e.removeEventListener(t,i,!1)}))}function w(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function C(e,t){return e.indexOf(t)>-1}function T(e){return e.trim().split(/\s+/g)}function M(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var n=0;n<e.length;){if(i&&e[n][i]==t||!i&&e[n]===t)return n;n++}return-1}function I(e){return Array.prototype.slice.call(e,0)}function P(e,t,i){for(var n=[],r=[],o=0;o<e.length;){var s=t?e[o][t]:e[o];M(r,s)<0&&n.push(e[o]),r[o]=s,o++}return i&&(n=t?n.sort((function(e,i){return e[t]>i[t]})):n.sort()),n}function L(e,t){for(var i,n,r=t[0].toUpperCase()+t.slice(1),a=0;a<s.length;){if((n=(i=s[a])?i+r:t)in e)return n;a++}return o}var R=1;function D(e){var i=e.ownerDocument||e;return i.defaultView||i.parentWindow||t}var O="ontouchstart"in t,B=L(t,"PointerEvent")!==o,N=O&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),U="touch",k="mouse",F=25,V=1,G=4,z=8,H=1,W=2,j=4,q=8,K=16,X=W|j,Y=q|K,Q=X|Y,Z=["x","y"],$=["clientX","clientY"];function J(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){_(e.options.enable,[e])&&i.handler(t)},this.init()}function ee(e,t,i){var n=i.pointers.length,r=i.changedPointers.length,s=t&V&&n-r==0,a=t&(G|z)&&n-r==0;i.isFirst=!!s,i.isFinal=!!a,s&&(e.session={}),i.eventType=t,function(e,t){var i=e.session,n=t.pointers,r=n.length;i.firstInput||(i.firstInput=te(t));r>1&&!i.firstMultiple?i.firstMultiple=te(t):1===r&&(i.firstMultiple=!1);var s=i.firstInput,a=i.firstMultiple,l=a?a.center:s.center,c=t.center=ie(n);t.timeStamp=h(),t.deltaTime=t.timeStamp-s.timeStamp,t.angle=se(l,c),t.distance=oe(l,c),function(e,t){var i=t.center,n=e.offsetDelta||{},r=e.prevDelta||{},o=e.prevInput||{};t.eventType!==V&&o.eventType!==G||(r=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y});t.deltaX=r.x+(i.x-n.x),t.deltaY=r.y+(i.y-n.y)}(i,t),t.offsetDirection=re(t.deltaX,t.deltaY);var d=ne(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=d.x,t.overallVelocityY=d.y,t.overallVelocity=u(d.x)>u(d.y)?d.x:d.y,t.scale=a?(f=a.pointers,p=n,oe(p[0],p[1],$)/oe(f[0],f[1],$)):1,t.rotation=a?function(e,t){return se(t[1],t[0],$)-se(e[1],e[0],$)}(a.pointers,n):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length,function(e,t){var i,n,r,s,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(t.eventType!=z&&(l>F||a.velocity===o)){var c=t.deltaX-a.deltaX,h=t.deltaY-a.deltaY,d=ne(l,c,h);n=d.x,r=d.y,i=u(d.x)>u(d.y)?d.x:d.y,s=re(c,h),e.lastInterval=t}else i=a.velocity,n=a.velocityX,r=a.velocityY,s=a.direction;t.velocity=i,t.velocityX=n,t.velocityY=r,t.direction=s}(i,t);var f,p;var m=e.element;w(t.srcEvent.target,m)&&(m=t.srcEvent.target);t.target=m}(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function te(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:c(e.pointers[i].clientX),clientY:c(e.pointers[i].clientY)},i++;return{timeStamp:h(),pointers:t,center:ie(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ie(e){var t=e.length;if(1===t)return{x:c(e[0].clientX),y:c(e[0].clientY)};for(var i=0,n=0,r=0;r<t;)i+=e[r].clientX,n+=e[r].clientY,r++;return{x:c(i/t),y:c(n/t)}}function ne(e,t,i){return{x:t/e||0,y:i/e||0}}function re(e,t){return e===t?H:u(e)>=u(t)?e<0?W:j:t<0?q:K}function oe(e,t,i){i||(i=Z);var n=t[i[0]]-e[i[0]],r=t[i[1]]-e[i[1]];return Math.sqrt(n*n+r*r)}function se(e,t,i){i||(i=Z);var n=t[i[0]]-e[i[0]],r=t[i[1]]-e[i[1]];return 180*Math.atan2(r,n)/Math.PI}J.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(D(this.element),this.evWin,this.domHandler)}};var ae={mousedown:V,mousemove:2,mouseup:G},le="mousedown",ce="mousemove mouseup";function ue(){this.evEl=le,this.evWin=ce,this.pressed=!1,J.apply(this,arguments)}b(ue,J,{handler:function(e){var t=ae[e.type];t&V&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=G),this.pressed&&(t&G&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:k,srcEvent:e}))}});var he={pointerdown:V,pointermove:2,pointerup:G,pointercancel:z,pointerout:z},de={2:U,3:"pen",4:k,5:"kinect"},fe="pointerdown",pe="pointermove pointerup pointercancel";function me(){this.evEl=fe,this.evWin=pe,J.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}t.MSPointerEvent&&!t.PointerEvent&&(fe="MSPointerDown",pe="MSPointerMove MSPointerUp MSPointerCancel"),b(me,J,{handler:function(e){var t=this.store,i=!1,n=e.type.toLowerCase().replace("ms",""),r=he[n],o=de[e.pointerType]||e.pointerType,s=o===U,a=o===k,l=M(t,e.pointerId,"pointerId");r&V&&(0===e.button||s)?l<0&&(t.push(e),l=t.length-1):r&(G|z)&&(i=!0),l<0||(t[l]=e,a&&!this.manager.options.handlePointerEventMouse||this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),i&&t.splice(l,1))}});var ge={touchstart:V,touchmove:2,touchend:G,touchcancel:z};function ve(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,J.apply(this,arguments)}function ye(e,t){var i=I(e.touches),n=I(e.changedTouches);return t&(G|z)&&(i=P(i.concat(n),"identifier",!0)),[i,n]}b(ve,J,{handler:function(e){var t=ge[e.type];if(t===V&&(this.started=!0),this.started){var i=ye.call(this,e,t);t&(G|z)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:U,srcEvent:e})}}});var be={touchstart:V,touchmove:2,touchend:G,touchcancel:z},xe="touchstart touchmove touchend touchcancel";function _e(){this.evTarget=xe,this.targetIds={},J.apply(this,arguments)}function Ee(e,t){var i=I(e.touches),n=this.targetIds;if(t&(2|V)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,o,s=I(e.changedTouches),a=[],l=this.target;if(o=i.filter((function(e){return w(e.target,l)})),t===V)for(r=0;r<o.length;)n[o[r].identifier]=!0,r++;for(r=0;r<s.length;)n[s[r].identifier]&&a.push(s[r]),t&(G|z)&&delete n[s[r].identifier],r++;return a.length?[P(o.concat(a),"identifier",!0),a]:void 0}b(_e,J,{handler:function(e){var t=be[e.type],i=Ee.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:U,srcEvent:e})}});var Se=2500;function Ae(){J.apply(this,arguments);var e=x(this.handler,this);this.touch=new _e(this.manager,e),this.mouse=new ue(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function we(e,t){e&V?(this.primaryTouch=t.changedPointers[0].identifier,Ce.call(this,t)):e&(G|z)&&Ce.call(this,t)}function Ce(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var i={x:t.clientX,y:t.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout((function(){var e=n.indexOf(i);e>-1&&n.splice(e,1)}),Se)}}function Te(e){for(var t=e.srcEvent.clientX,i=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],o=Math.abs(t-r.x),s=Math.abs(i-r.y);if(o<=25&&s<=25)return!0}return!1}b(Ae,J,{handler:function(e,t,i){var n=i.pointerType==U,r=i.pointerType==k;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)we.call(this,t,i);else if(r&&Te.call(this,i))return;this.callback(e,t,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Me=L(a.style,"touchAction"),Ie=Me!==o,Pe="compute",Le="auto",Re="manipulation",De="none",Oe="pan-x",Be="pan-y",Ne=function(){if(!Ie)return!1;var e={},i=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!i||t.CSS.supports("touch-action",n)})),e}();function Ue(e,t){this.manager=e,this.set(t)}Ue.prototype={set:function(e){e==Pe&&(e=this.compute()),Ie&&this.manager.element.style&&Ne[e]&&(this.manager.element.style[Me]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return p(this.manager.recognizers,(function(t){_(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(C(e,De))return De;var t=C(e,Oe),i=C(e,Be);if(t&&i)return De;if(t||i)return t?Oe:Be;if(C(e,Re))return Re;return Le}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var n=this.actions,r=C(n,De)&&!Ne[De],o=C(n,Be)&&!Ne[Be],s=C(n,Oe)&&!Ne[Oe];if(r){var a=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(a&&l&&c)return}if(!s||!o)return r||o&&i&X||s&&i&Y?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var ke=1,Fe=32;function Ve(e){this.options=g({},this.defaults,e||{}),this.id=R++,this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=ke,this.simultaneous={},this.requireFail=[]}function Ge(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function ze(e){return e==K?"down":e==q?"up":e==W?"left":e==j?"right":""}function He(e,t){var i=t.manager;return i?i.get(e):e}function We(){Ve.apply(this,arguments)}function je(){We.apply(this,arguments),this.pX=null,this.pY=null}function qe(){We.apply(this,arguments)}function Ke(){Ve.apply(this,arguments),this._timer=null,this._input=null}function Xe(){We.apply(this,arguments)}function Ye(){We.apply(this,arguments)}function Qe(){Ve.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ze(e,t){return(t=t||{}).recognizers=E(t.recognizers,Ze.defaults.preset),new $e(e,t)}Ve.prototype={defaults:{},set:function(e){return g(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(f(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=He(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return f(e,"dropRecognizeWith",this)||(e=He(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(f(e,"requireFailure",this))return this;var t=this.requireFail;return-1===M(t,e=He(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(f(e,"dropRequireFailure",this))return this;e=He(e,this);var t=M(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,i=this.state;function n(i){t.manager.emit(i,e)}i<8&&n(t.options.event+Ge(i)),n(t.options.event),e.additionalEvent&&n(e.additionalEvent),i>=8&&n(t.options.event+Ge(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Fe},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Fe|ke)))return!1;e++}return!0},recognize:function(e){var t=g({},e);if(!_(this.options.enable,[this,t]))return this.reset(),void(this.state=Fe);56&this.state&&(this.state=ke),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},b(We,Ve,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,n=6&t,r=this.attrTest(e);return n&&(i&z||!r)?16|t:n||r?i&G?8|t:2&t?4|t:2:Fe}}),b(je,We,{defaults:{event:"pan",threshold:10,pointers:1,direction:Q},getTouchAction:function(){var e=this.options.direction,t=[];return e&X&&t.push(Be),e&Y&&t.push(Oe),t},directionTest:function(e){var t=this.options,i=!0,n=e.distance,r=e.direction,o=e.deltaX,s=e.deltaY;return r&t.direction||(t.direction&X?(r=0===o?H:o<0?W:j,i=o!=this.pX,n=Math.abs(e.deltaX)):(r=0===s?H:s<0?q:K,i=s!=this.pY,n=Math.abs(e.deltaY))),e.direction=r,i&&n>t.threshold&&r&t.direction},attrTest:function(e){return We.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=ze(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),b(qe,We,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),b(Ke,Ve,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Le]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!n||!i||e.eventType&(G|z)&&!r)this.reset();else if(e.eventType&V)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),t.time,this);else if(e.eventType&G)return 8;return Fe},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&e.eventType&G?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=h(),this.manager.emit(this.options.event,this._input)))}}),b(Xe,We,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),b(Ye,We,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:X|Y,pointers:1},getTouchAction:function(){return je.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return i&(X|Y)?t=e.overallVelocity:i&X?t=e.overallVelocityX:i&Y&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&i&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&u(t)>this.options.velocity&&e.eventType&G},emit:function(e){var t=ze(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),b(Qe,Ve,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Re]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&V&&0===this.count)return this.failTimeout();if(n&&r&&i){if(e.eventType!=G)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||oe(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Fe},failTimeout:function(){return this._timer=d((function(){this.state=Fe}),this.options.interval,this),Fe},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ze.VERSION="2.0.8",Ze.defaults={domEvents:!1,touchAction:Pe,enable:!0,handlePointerEventMouse:!0,inputTarget:null,inputClass:null,preset:[[Xe,{enable:!1}],[qe,{enable:!1},["rotate"]],[Ye,{direction:X}],[je,{direction:X},["swipe"]],[Qe],[Qe,{event:"doubletap",taps:2},["tap"]],[Ke]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function $e(e,t){var i;this.options=g({},Ze.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((i=this).options.inputClass||(B?me:N?_e:O?Ae:ue))(i,ee),this.touchAction=new Ue(this,this.options.touchAction),Je(this,!0),p(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Je(e,t){var i,n=e.element;n.style&&(p(e.options.cssProps,(function(r,o){i=L(n.style,o),t?(e.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=e.oldCssProps[i]||""})),t||(e.oldCssProps={}))}$e.prototype={set:function(e){return g(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var i;this.touchAction.preventDefaults(e);var n=this.recognizers,r=t.curRecognizer;(!r||r&&8&r.state)&&(r=t.curRecognizer=null);for(var o=0;o<n.length;)i=n[o],2===t.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(e),!r&&14&i.state&&(r=t.curRecognizer=i),o++}},get:function(e){if(e instanceof Ve)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(f(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(f(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,i=M(t,e);-1!==i&&(t.splice(i,1),this.touchAction.update())}return this},on:function(e,t){if(e!==o&&t!==o){var i=this.handlers;return p(T(e),(function(e){i[e]=i[e]||[],i[e].push(t)})),this}},off:function(e,t){if(e!==o){var i=this.handlers;return p(T(e),(function(e){t?i[e]&&i[e].splice(M(i[e],t),1):delete i[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var i=n.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t,t.target.dispatchEvent(i)}(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()},t.stopPropagation=function(){t.srcEvent.stopPropagation()};for(var r=0;r<i.length;)i[r](t),r++}},destroy:function(){this.element&&Je(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},g(Ze,{INPUT_START:V,INPUT_MOVE:2,INPUT_END:G,INPUT_CANCEL:z,STATE_POSSIBLE:ke,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Fe,DIRECTION_NONE:H,DIRECTION_LEFT:W,DIRECTION_RIGHT:j,DIRECTION_UP:q,DIRECTION_DOWN:K,DIRECTION_HORIZONTAL:X,DIRECTION_VERTICAL:Y,DIRECTION_ALL:Q,Manager:$e,Input:J,TouchAction:Ue,TouchInput:_e,MouseInput:ue,PointerEventInput:me,TouchMouseInput:Ae,SingleTouchInput:ve,Recognizer:Ve,AttrRecognizer:We,Tap:Qe,Pan:je,Swipe:Ye,Pinch:qe,Rotate:Xe,Press:Ke,on:S,off:A,each:p,merge:y,extend:v,assign:g,inherit:b,bindFn:x,prefixed:L}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=Ze,"function"==typeof define&&i.amdO?define((function(){return Ze})):e.exports?e.exports=Ze:t.Hammer=Ze}(window,document);const n=window.Hammer},63004:(e,t,i)=>{"use strict";i.r(t),i.d(t,{polyfillTHREE:()=>d});const n=(e,t,i)=>{"object"!=typeof e&&"function"!=typeof e||Object.prototype.hasOwnProperty.call(e,t)||(e[t]=i)},r=(e,t,i)=>{"object"==typeof e&&Object.defineProperty(e,t,i)},o=e=>{n(e,"BoxBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:n,widthSegments:r,heightSegments:o,depthSegments:s};const a=this;r=Math.floor(r),o=Math.floor(o),s=Math.floor(s);const l=[],c=[],u=[],h=[];let d=0,f=0;function p(t,i,n,r,o,s,p,m,g,v,y){const b=s/g,x=p/v,_=s/2,E=p/2,S=m/2,A=g+1,w=v+1;let C=0,T=0;const M=new e.Vector3;for(let e=0;e<w;e++){const s=e*x-E;for(let a=0;a<A;a++){const l=a*b-_;M[t]=l*r,M[i]=s*o,M[n]=S,c.push(M.x,M.y,M.z),M[t]=0,M[i]=0,M[n]=m>0?1:-1,u.push(M.x,M.y,M.z),h.push(a/g),h.push(1-e/v),C+=1}}for(let e=0;e<v;e++)for(let t=0;t<g;t++){const i=d+t+A*e,n=d+t+A*(e+1),r=d+(t+1)+A*(e+1),o=d+(t+1)+A*e;l.push(i,n,o),l.push(n,r,o),T+=6}a.addGroup(f,T,0),f+=T,d+=C}p("z","y","x",-1,-1,n,i,t,s,o,0),p("z","y","x",1,-1,n,i,-t,s,o,1),p("x","z","y",1,1,t,n,i,r,s,2),p("x","z","y",1,-1,t,n,-i,r,s,3),p("x","y","z",1,-1,t,i,n,r,o,4),p("x","y","z",-1,-1,t,i,-n,r,o,5),this.setIndex(l),this.setAttribute("position",new e.Float32BufferAttribute(c,3)),this.setAttribute("normal",new e.Float32BufferAttribute(u,3)),this.setAttribute("uv",new e.Float32BufferAttribute(h,2))}})},s=e=>{n(e,"CircleBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:n,thetaLength:r},i=Math.max(3,i);const o=[],s=[],a=[],l=[],c=new e.Vector3,u=new e.Vector2;s.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let e=0,o=3;e<=i;e++,o+=3){const h=n+e/i*r;c.x=t*Math.cos(h),c.y=t*Math.sin(h),s.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(s[o]/t+1)/2,u.y=(s[o+1]/t+1)/2,l.push(u.x,u.y)}for(let e=1;e<=i;e++)o.push(e,e+1,0);this.setIndex(o),this.setAttribute("position",new e.Float32BufferAttribute(s,3)),this.setAttribute("normal",new e.Float32BufferAttribute(a,3)),this.setAttribute("uv",new e.Float32BufferAttribute(l,2))}})},a=e=>{n(e,"CylinderBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:n,radialSegments:r,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),o=Math.floor(o);const u=[],h=[],d=[],f=[];let p=0;const m=[],g=n/2;let v=0;function y(n){const o=p,s=new e.Vector2,m=new e.Vector3;let y=0;const b=!0===n?t:i,x=!0===n?1:-1;for(let e=1;e<=r;e++)h.push(0,g*x,0),d.push(0,x,0),f.push(.5,.5),p++;const _=p;for(let e=0;e<=r;e++){const t=e/r*l+a,i=Math.cos(t),n=Math.sin(t);m.x=b*n,m.y=g*x,m.z=b*i,h.push(m.x,m.y,m.z),d.push(0,x,0),s.x=.5*i+.5,s.y=.5*n*x+.5,f.push(s.x,s.y),p++}for(let e=0;e<r;e++){const t=o+e,i=_+e;!0===n?u.push(i,i+1,t):u.push(i+1,i,t),y+=3}c.addGroup(v,y,0),v+=y}!function(){const s=new e.Vector3,y=new e.Vector3;let b=0;const x=(i-t)/n;for(let e=0;e<=o;e++){const c=[],u=e/o,v=u*(i-t)+t;for(let e=0;e<=r;e++){const t=e/r,i=t*l+a,o=Math.sin(i),m=Math.cos(i);y.x=v*o,y.y=-u*n+g,y.z=v*m,h.push(y.x,y.y,y.z),s.set(o,x,m).normalize(),d.push(s.x,s.y,s.z),f.push(t,1-u),c.push(p++)}m.push(c)}for(let e=0;e<r;e++)for(let t=0;t<o;t++){const i=m[t][e],n=m[t+1][e],r=m[t+1][e+1],o=m[t][e+1];u.push(i,n,o),u.push(n,r,o),b+=6}c.addGroup(v,b,0),v+=b}(),!1===s&&(t>0&&y(!0),i>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new e.Float32BufferAttribute(h,3)),this.setAttribute("normal",new e.Float32BufferAttribute(d,3)),this.setAttribute("uv",new e.Float32BufferAttribute(f,2))}})},l=e=>{n(e,"PolyhedronBufferGeometry",class extends e.BufferGeometry{constructor(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:n,detail:r};const o=[],s=[];function a(e,t,i,n){const r=n+1,o=[];for(let n=0;n<=r;n++){o[n]=[];const s=e.clone().lerp(i,n/r),a=t.clone().lerp(i,n/r),l=r-n;for(let e=0;e<=l;e++)o[n][e]=0===e&&n===r?s:s.clone().lerp(a,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const i=Math.floor(t/2);t%2==0?(l(o[e][i+1]),l(o[e+1][i]),l(o[e][i])):(l(o[e][i+1]),l(o[e+1][i+1]),l(o[e+1][i]))}}function l(e){o.push(e.x,e.y,e.z)}function c(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function u(e,t,i,n){n<0&&1===e.x&&(s[t]=e.x-1),0===i.x&&0===i.z&&(s[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(t){const n=new e.Vector3,r=new e.Vector3,o=new e.Vector3;for(let e=0;e<i.length;e+=3)c(i[e+0],n),c(i[e+1],r),c(i[e+2],o),a(n,r,o,t)}(r),function(t){const i=new e.Vector3;for(let e=0;e<o.length;e+=3)i.x=o[e+0],i.y=o[e+1],i.z=o[e+2],i.normalize().multiplyScalar(t),o[e+0]=i.x,o[e+1]=i.y,o[e+2]=i.z}(n),function(){const t=new e.Vector3;for(let e=0;e<o.length;e+=3){t.x=o[e+0],t.y=o[e+1],t.z=o[e+2];const i=h(t)/2/Math.PI+.5,n=d(t)/Math.PI+.5;s.push(i,1-n)}(function(){const t=new e.Vector3,i=new e.Vector3,n=new e.Vector3,r=new e.Vector3,a=new e.Vector2,l=new e.Vector2,c=new e.Vector2;for(let e=0,d=0;e<o.length;e+=9,d+=6){t.set(o[e+0],o[e+1],o[e+2]),i.set(o[e+3],o[e+4],o[e+5]),n.set(o[e+6],o[e+7],o[e+8]),a.set(s[d+0],s[d+1]),l.set(s[d+2],s[d+3]),c.set(s[d+4],s[d+5]),r.copy(t).add(i).add(n).divideScalar(3);const f=h(r);u(a,d+0,t,f),u(l,d+2,i,f),u(c,d+4,n,f)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],i=s[e+2],n=s[e+4],r=Math.max(t,i,n),o=Math.min(t,i,n);r>.9&&o<.1&&(t<.2&&(s[e+0]+=1),i<.2&&(s[e+2]+=1),n<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new e.Float32BufferAttribute(o,3)),this.setAttribute("normal",new e.Float32BufferAttribute(o.slice(),3)),this.setAttribute("uv",new e.Float32BufferAttribute(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}})},c=e=>{n(e,"OctahedronBufferGeometry",class extends e.PolyhedronBufferGeometry{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}})},u=e=>{n(e,"SphereBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:n,phiStart:r,phiLength:o,thetaStart:s,thetaLength:a},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const l=Math.min(s+a,Math.PI);let c=0;const u=[],h=new e.Vector3,d=new e.Vector3,f=[],p=[],m=[],g=[];for(let e=0;e<=n;e++){const f=[],v=e/n;let y=0;0==e&&0==s?y=.5/i:e==n&&l==Math.PI&&(y=-.5/i);for(let e=0;e<=i;e++){const n=e/i;h.x=-t*Math.cos(r+n*o)*Math.sin(s+v*a),h.y=t*Math.cos(s+v*a),h.z=t*Math.sin(r+n*o)*Math.sin(s+v*a),p.push(h.x,h.y,h.z),d.copy(h).normalize(),m.push(d.x,d.y,d.z),g.push(n+y,1-v),f.push(c++)}u.push(f)}for(let e=0;e<n;e++)for(let t=0;t<i;t++){const i=u[e][t+1],r=u[e][t],o=u[e+1][t],a=u[e+1][t+1];(0!==e||s>0)&&f.push(i,r,a),(e!==n-1||l<Math.PI)&&f.push(r,o,a)}this.setIndex(f),this.setAttribute("position",new e.Float32BufferAttribute(p,3)),this.setAttribute("normal",new e.Float32BufferAttribute(m,3)),this.setAttribute("uv",new e.Float32BufferAttribute(g,2))}})},h=e=>{n(e,"TorusBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:n,tubularSegments:r,arc:o},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],l=[],c=[],u=new e.Vector3,h=new e.Vector3,d=new e.Vector3;for(let e=0;e<=n;e++)for(let s=0;s<=r;s++){const f=s/r*o,p=e/n*Math.PI*2;h.x=(t+i*Math.cos(p))*Math.cos(f),h.y=(t+i*Math.cos(p))*Math.sin(f),h.z=i*Math.sin(p),a.push(h.x,h.y,h.z),u.x=t*Math.cos(f),u.y=t*Math.sin(f),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(s/r),c.push(e/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const i=(r+1)*e+t-1,n=(r+1)*(e-1)+t-1,o=(r+1)*(e-1)+t,a=(r+1)*e+t;s.push(i,n,a),s.push(n,o,a)}this.setIndex(s),this.setAttribute("position",new e.Float32BufferAttribute(a,3)),this.setAttribute("normal",new e.Float32BufferAttribute(l,3)),this.setAttribute("uv",new e.Float32BufferAttribute(c,2))}})},d=e=>{var t,i,d,f,p,m,g,v,y,b,x,_,E,S,A,w,C,T,M,I,P,L,R,D,O,B,N,U,k,F,V;const G=new e.Vector3;n(null==e||null===(t=e.Camera)||void 0===t?void 0:t.prototype,"updateMatrixWorld",(function(t){e.Object3D.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()})),n(null==e||null===(i=e.Box2)||void 0===i?void 0:i.prototype,"getSize",(function(e){return this.isEmpty()?e.set(0,0):this.size(e)})),n(null==e||null===(d=e.Box3)||void 0===d?void 0:d.prototype,"getSize",(function(e){return this.isEmpty()?e.set(0,0,0):this.size(e)})),n(null==e||null===(f=e.Box2)||void 0===f?void 0:f.prototype,"intersectsBox",(function(e){return this.isIntersectionBox(e)})),n(null==e||null===(p=e.Box3)||void 0===p?void 0:p.prototype,"intersectsBox",(function(e){return this.isIntersectionBox(e)})),n(null==e||null===(m=e.Ray)||void 0===m?void 0:m.prototype,"intersectsBox",(function(e){return this.isIntersectionBox(e)})),n(null==e||null===(g=e.BufferAttribute)||void 0===g?void 0:g.prototype,"applyMatrix4",(function(e){for(let t=0,i=this.count;t<i;t++)G.x=this.getX(t),G.y=this.getY(t),G.z=this.getZ(t),G.applyMatrix4(e),this.setXYZ(t,G.x,G.y,G.z);return this})),n(null==e||null===(v=e.BufferAttribute)||void 0===v?void 0:v.prototype,"getX",(function(e){return this.array[e*this.itemSize]})),n(null==e||null===(y=e.BufferAttribute)||void 0===y?void 0:y.prototype,"getY",(function(e){return this.array[e*this.itemSize+1]})),n(null==e||null===(b=e.BufferAttribute)||void 0===b?void 0:b.prototype,"getZ",(function(e){return this.array[e*this.itemSize+2]})),r(null==e||null===(x=e.BufferAttribute)||void 0===x?void 0:x.prototype,"itemOffset",{get:function(){return this.offset},set:function(e){this.offset=e}}),"function"==typeof(null==e?void 0:e.BufferAttribute)&&(n(e,"Float32BufferAttribute",class extends e.BufferAttribute{constructor(e,t,i){super(new Float32Array(e),t,i)}}),n(e,"Uint16BufferAttribute",class extends e.BufferAttribute{constructor(e,t,i){super(new Uint16Array(e),t,i)}}),n(e,"Uint32BufferAttribute",class extends e.BufferAttribute{constructor(e,t,i){super(new Uint32Array(e),t,i)}})),n(null==e||null===(_=e.BufferGeometry)||void 0===_?void 0:_.prototype,"applyMatrix4",(function(e){return this.applyMatrix(e),this})),r(null==e||null===(E=e.BufferGeometry)||void 0===E?void 0:E.prototype,"groups",{get:function(){return this.offsets},set:function(e){this.offsets=e,this.drawcalls=e}}),n(null==e||null===(S=e.BufferGeometry)||void 0===S?void 0:S.prototype,"addGroup",(function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return void 0!==i&&0!==i&&console.warn("THREE.BufferGeometry: .addGroup() with `materialIndex !== 0` is not supported in this Three.js version. Ignoring the `materialIndex` parameter."),this.addDrawCall(e,t)})),r(null==e||null===(A=e.BufferGeometry)||void 0===A?void 0:A.prototype,"index",{get:function(){return this.attributes.index},set:function(e){this.attributes.index=e}}),n(null==e||null===(w=e.BufferGeometry)||void 0===w?void 0:w.prototype,"setFromPoints",(function(t){const i=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];i.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new e.Float32BufferAttribute(i,3)),this})),n(null==e||null===(C=e.BufferGeometry)||void 0===C?void 0:C.prototype,"setIndex",(function(t){return Array.isArray(t)?this.index=new((e=>{if(0===e.length)return-1/0;for(var t=e[0],i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t})(t)>65535?e.Uint32BufferAttribute:e.Uint16BufferAttribute)(t,1):this.index=t,this})),"function"==typeof(null==e?void 0:e.BufferGeometry)&&(o(e),s(e),a(e),l(e),c(e),u(e),h(e)),n(null==e||null===(T=e.Frustum)||void 0===T?void 0:T.prototype,"setFromProjectionMatrix",(function(e){return this.setFromMatrix(e)})),n(null==e||null===(M=e.Geometry)||void 0===M?void 0:M.prototype,"applyMatrix4",(function(e){return this.applyMatrix(e),this})),"function"==typeof e.Line&&n(e,"LineSegments",class extends e.Line{constructor(t,i){super(t,i,e.LinePieces),this.isLineSegments=!0,this.type="LineSegments"}}),n(null==e||null===(I=e.Line)||void 0===I?void 0:I.prototype,"computeLineDistances",(function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)_start.fromBufferAttribute(t,e-1),_end.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this})),n(null==e||null===(P=e.Matrix3)||void 0===P?void 0:P.prototype,"invert",(function(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=c*o-s*l,h=s*a-c*r,d=l*r-o*a,f=t*u+i*h+n*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=u*p,e[1]=(n*l-c*i)*p,e[2]=(s*i-n*o)*p,e[3]=h*p,e[4]=(c*t-n*a)*p,e[5]=(n*r-s*t)*p,e[6]=d*p,e[7]=(i*a-l*t)*p,e[8]=(o*t-i*r)*p,this})),n(null==e||null===(L=e.Matrix4)||void 0===L?void 0:L.prototype,"invert",(function(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=u*m*l-p*h*l+p*a*d-s*m*d-u*a*g+s*h*g,y=f*h*l-c*m*l-f*a*d+o*m*d+c*a*g-o*h*g,b=c*p*l-f*u*l+f*s*d-o*p*d-c*s*g+o*u*g,x=f*u*a-c*p*a-f*s*h+o*p*h+c*s*m-o*u*m,_=t*v+i*y+n*b+r*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/_;return e[0]=v*E,e[1]=(p*h*r-u*m*r-p*n*d+i*m*d+u*n*g-i*h*g)*E,e[2]=(s*m*r-p*a*r+p*n*l-i*m*l-s*n*g+i*a*g)*E,e[3]=(u*a*r-s*h*r-u*n*l+i*h*l+s*n*d-i*a*d)*E,e[4]=y*E,e[5]=(c*m*r-f*h*r+f*n*d-t*m*d-c*n*g+t*h*g)*E,e[6]=(f*a*r-o*m*r-f*n*l+t*m*l+o*n*g-t*a*g)*E,e[7]=(o*h*r-c*a*r+c*n*l-t*h*l-o*n*d+t*a*d)*E,e[8]=b*E,e[9]=(f*u*r-c*p*r-f*i*d+t*p*d+c*i*g-t*u*g)*E,e[10]=(o*p*r-f*s*r+f*i*l-t*p*l-o*i*g+t*s*g)*E,e[11]=(c*s*r-o*u*r-c*i*l+t*u*l+o*i*d-t*s*d)*E,e[12]=x*E,e[13]=(c*p*n-f*u*n+f*i*h-t*p*h-c*i*m+t*u*m)*E,e[14]=(f*s*n-o*p*n-f*i*a+t*p*a+o*i*m-t*s*m)*E,e[15]=(o*u*n-c*s*n+c*i*a-t*u*a-o*i*h+t*s*h)*E,this})),r(null==e||null===(R=e.MeshPhongMaterial)||void 0===R?void 0:R.prototype,"flatShading",{get:function(){return this.shading===e.FlatShading},set:function(t){this.shading=!0===t?e.FlatShading:e.SmoothShading}}),n(null==e||null===(D=e.Object3D)||void 0===D?void 0:D.prototype,"applyMatrix4",(function(e){return this.applyMatrix(e)})),n(e,"PointsMaterial",e.PointCloudMaterial),n(null==e||null===(O=e.Quaternion)||void 0===O?void 0:O.prototype,"invert",(function(){return this.inverse()})),n(null==e||null===(B=e.Quaternion)||void 0===B?void 0:B.prototype,"slerpQuaternions",(function(e,t,i){return this.copy(e).slerp(t,i)})),n(null==e?void 0:e.Triangle,"getNormal",(function(e,t,i,n){return this.normal(e,t,i,n)})),n(null==e||null===(N=e.Vector2)||void 0===N?void 0:N.prototype,"fromBufferAttribute",(function(e,t,i){return this.fromAttribute(e,t,i)})),n(null==e||null===(U=e.Vector3)||void 0===U?void 0:U.prototype,"fromBufferAttribute",(function(e,t,i){return this.fromAttribute(e,t,i)})),n(null==e||null===(k=e.Vector4)||void 0===k?void 0:k.prototype,"fromBufferAttribute",(function(e,t,i){return this.fromAttribute(e,t,i)})),r(null==e||null===(F=e.WebGLRenderTarget)||void 0===F?void 0:F.prototype,"texture",{get:function(){return this}}),n(null==e||null===(V=e.Material)||void 0===V?void 0:V.prototype,"onBeforeCompile",(function(){}))}},72091:(e,t,i)=>{var n,r,o,s,a,l,c,u,h,d,f,p,m,g,v,y,b,x,_,E,S,A,w,C,T,M,I,P,L,R,D,O,B,N,U,k,F,V,G,z,H,W,j,q,K,X,Y=e.exports={REVISION:"71"};void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),Y.log=function(){console.log.apply(console,arguments)},Y.warn=function(){console.warn.apply(console,arguments)},Y.error=function(){console.error.apply(console,arguments)},Y.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},Y.CullFaceNone=0,Y.CullFaceBack=1,Y.CullFaceFront=2,Y.CullFaceFrontBack=3,Y.FrontFaceDirectionCW=0,Y.FrontFaceDirectionCCW=1,Y.BasicShadowMap=0,Y.PCFShadowMap=1,Y.PCFSoftShadowMap=2,Y.FrontSide=0,Y.BackSide=1,Y.DoubleSide=2,Y.NoShading=0,Y.FlatShading=1,Y.SmoothShading=2,Y.NoColors=0,Y.FaceColors=1,Y.VertexColors=2,Y.NoBlending=0,Y.NormalBlending=1,Y.AdditiveBlending=2,Y.SubtractiveBlending=3,Y.MultiplyBlending=4,Y.CustomBlending=5,Y.AddEquation=100,Y.SubtractEquation=101,Y.ReverseSubtractEquation=102,Y.MinEquation=103,Y.MaxEquation=104,Y.ZeroFactor=200,Y.OneFactor=201,Y.SrcColorFactor=202,Y.OneMinusSrcColorFactor=203,Y.SrcAlphaFactor=204,Y.OneMinusSrcAlphaFactor=205,Y.DstAlphaFactor=206,Y.OneMinusDstAlphaFactor=207,Y.DstColorFactor=208,Y.OneMinusDstColorFactor=209,Y.SrcAlphaSaturateFactor=210,Y.MultiplyOperation=0,Y.MixOperation=1,Y.AddOperation=2,Y.UVMapping=300,Y.CubeReflectionMapping=301,Y.CubeRefractionMapping=302,Y.EquirectangularReflectionMapping=303,Y.EquirectangularRefractionMapping=304,Y.SphericalReflectionMapping=305,Y.RepeatWrapping=1e3,Y.ClampToEdgeWrapping=1001,Y.MirroredRepeatWrapping=1002,Y.NearestFilter=1003,Y.NearestMipMapNearestFilter=1004,Y.NearestMipMapLinearFilter=1005,Y.LinearFilter=1006,Y.LinearMipMapNearestFilter=1007,Y.LinearMipMapLinearFilter=1008,Y.UnsignedByteType=1009,Y.ByteType=1010,Y.ShortType=1011,Y.UnsignedShortType=1012,Y.IntType=1013,Y.UnsignedIntType=1014,Y.FloatType=1015,Y.HalfFloatType=1025,Y.UnsignedShort4444Type=1016,Y.UnsignedShort5551Type=1017,Y.UnsignedShort565Type=1018,Y.AlphaFormat=1019,Y.RGBFormat=1020,Y.RGBAFormat=1021,Y.LuminanceFormat=1022,Y.LuminanceAlphaFormat=1023,Y.RGBEFormat=Y.RGBAFormat,Y.RGB_S3TC_DXT1_Format=2001,Y.RGBA_S3TC_DXT1_Format=2002,Y.RGBA_S3TC_DXT3_Format=2003,Y.RGBA_S3TC_DXT5_Format=2004,Y.RGB_PVRTC_4BPPV1_Format=2100,Y.RGB_PVRTC_2BPPV1_Format=2101,Y.RGBA_PVRTC_4BPPV1_Format=2102,Y.RGBA_PVRTC_2BPPV1_Format=2103,Y.Projector=function(){Y.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){Y.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){Y.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){Y.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},Y.CanvasRenderer=function(){Y.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},Y.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},Y.Color.prototype={constructor:Y.Color,r:1,g:1,b:1,set:function(e){return e instanceof Y.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(0===t)this.r=this.g=this.b=i;else{var n=function(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e},r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=n(o,r,e+1/3),this.g=n(o,r,e),this.b=n(o,r,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(Y.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,i,n=e||{h:0,s:0,l:0},r=this.r,o=this.g,s=this.b,a=Math.max(r,o,s),l=Math.min(r,o,s),c=(l+a)/2;if(l===a)t=0,i=0;else{var u=a-l;switch(i=c<=.5?u/(a+l):u/(2-a-l),a){case r:t=(o-s)/u+(o<s?6:0);break;case o:t=(s-r)/u+2;break;case s:t=(r-o)/u+4}t/=6}return n.h=t,n.s=i,n.l=c,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},clone:function(){return(new Y.Color).setRGB(this.r,this.g,this.b)}},Y.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Y.Quaternion=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1},Y.Quaternion.prototype={constructor:Y.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof Y.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i=Math.cos(e._x/2),n=Math.cos(e._y/2),r=Math.cos(e._z/2),o=Math.sin(e._x/2),s=Math.sin(e._y/2),a=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*n*r+i*s*a,this._y=i*s*r-o*n*a,this._z=i*n*a+o*s*r,this._w=i*n*r-o*s*a):"YXZ"===e.order?(this._x=o*n*r+i*s*a,this._y=i*s*r-o*n*a,this._z=i*n*a-o*s*r,this._w=i*n*r+o*s*a):"ZXY"===e.order?(this._x=o*n*r-i*s*a,this._y=i*s*r+o*n*a,this._z=i*n*a+o*s*r,this._w=i*n*r-o*s*a):"ZYX"===e.order?(this._x=o*n*r-i*s*a,this._y=i*s*r+o*n*a,this._z=i*n*a-o*s*r,this._w=i*n*r+o*s*a):"YZX"===e.order?(this._x=o*n*r+i*s*a,this._y=i*s*r+o*n*a,this._z=i*n*a-o*s*r,this._w=i*n*r-o*s*a):"XZY"===e.order&&(this._x=o*n*r-i*s*a,this._y=i*s*r-o*n*a,this._z=i*n*a+o*s*r,this._w=i*n*r+o*s*a),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,n=i[0],r=i[4],o=i[8],s=i[1],a=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=n+a+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,this._z=(s-r)*t):n>a&&n>h?(t=2*Math.sqrt(1+n-a-h),this._w=(u-l)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(o+c)/t):a>h?(t=2*Math.sqrt(1+a-n-h),this._w=(o-c)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-n-a),this._w=(s-r)/t,this._x=(o+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(e,t){return void 0===n&&(n=new Y.Vector3),(r=e.dot(t)+1)<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?n.set(-e.y,e.x,0):n.set(0,-e.z,e.y)):n.crossVectors(e,t),this._x=n.x,this._y=n.y,this._z=n.z,this._w=r,this.normalize(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(Y.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e._x,n=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+o*s+n*l-r*a,this._y=n*c+o*a+r*s-i*l,this._z=r*c+o*l+i*a-n*s,this._w=o*c-i*s-n*a-r*l,this.onChangeCallback(),this},multiplyVector3:function(e){return Y.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,n=this._y,r=this._z,o=this._w,s=o*e._w+i*e._x+n*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var a=Math.acos(s),l=Math.sqrt(1-s*s);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var c=Math.sin((1-t)*a)/l,u=Math.sin(t*a)/l;return this._w=o*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=r*c+this._z*u,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new Y.Quaternion(this._x,this._y,this._z,this._w)}},Y.Quaternion.slerp=function(e,t,i,n){return i.copy(e).slerp(t,n)},Y.Vector2=function(e,t){this.x=e||0,this.y=t||0},Y.Vector2.prototype={constructor:Y.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(Y.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},sub:function(e,t){return void 0!==t?(Y.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(e,t){return void 0===o&&(o=new Y.Vector2,s=new Y.Vector2),o.set(e,e),s.set(t,t),this.clamp(o,s)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this},clone:function(){return new Y.Vector2(this.x,this.y)}},Y.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},Y.Vector3.prototype={constructor:Y.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(Y.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(Y.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(Y.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e instanceof Y.Euler==0&&Y.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===l&&(l=new Y.Quaternion),this.applyQuaternion(l.setFromEuler(e)),this},applyAxisAngle:function(){var e;return function(t,i){return void 0===e&&(e=new Y.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,i)),this}}(),applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12],this.y=r[1]*t+r[5]*i+r[9]*n+r[13],this.z=r[2]*t+r[6]*i+r[10]*n+r[14],this},applyProjection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*n-s*i,c=a*i+s*t-r*n,u=a*n+r*i-o*t,h=-r*t-o*i-s*n;return this.x=l*a+h*-r+c*-s-u*-o,this.y=c*a+h*-o+u*-r-l*-s,this.z=u*a+h*-s+l*-o-c*-r,this},project:function(e){return void 0===a&&(a=new Y.Matrix4),a.multiplyMatrices(e.projectionMatrix,a.getInverse(e.matrixWorld)),this.applyProjection(a)},unproject:function(){var e;return function(t){return void 0===e&&(e=new Y.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(i,n){return void 0===e&&(e=new Y.Vector3,t=new Y.Vector3),e.set(i,i,i),t.set(n,n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},cross:function(e,t){if(void 0!==t)return Y.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=n*a-r*s,this.y=r*o-i*a,this.z=i*s-n*o,this},projectOnVector:function(){var e,t;return function(i){return void 0===e&&(e=new Y.Vector3),e.copy(i).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new Y.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new Y.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(Y.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n},setEulerFromRotationMatrix:function(e,t){Y.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){Y.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return Y.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return Y.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return Y.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),n=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=n,this},setFromMatrixColumn:function(e,t){var i=4*e,n=t.elements;return this.x=n[i],this.y=n[i+1],this.z=n[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this},clone:function(){return new Y.Vector3(this.x,this.y,this.z)}},Y.Vector4=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},Y.Vector4.prototype={constructor:Y.Vector4,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(Y.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(Y.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,n,r,o=.01,s=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],f=a[9],p=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<o&&Math.abs(u-p)<o&&Math.abs(f-m)<o){if(Math.abs(c+h)<s&&Math.abs(u+p)<s&&Math.abs(f+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,y=(d+1)/2,b=(g+1)/2,x=(c+h)/4,_=(u+p)/4,E=(f+m)/4;return v>y&&v>b?v<o?(i=0,n=.707106781,r=.707106781):(n=x/(i=Math.sqrt(v)),r=_/i):y>b?y<o?(i=.707106781,n=0,r=.707106781):(i=x/(n=Math.sqrt(y)),r=E/n):b<o?(i=.707106781,n=.707106781,r=0):(i=_/(r=Math.sqrt(b)),n=E/r),this.set(i,n,r,t),this}var S=Math.sqrt((m-f)*(m-f)+(u-p)*(u-p)+(h-c)*(h-c));return Math.abs(S)<.001&&(S=1),this.x=(m-f)/S,this.y=(u-p)/S,this.z=(h-c)/S,this.w=Math.acos((l+d+g-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(i,n){return void 0===e&&(e=new Y.Vector4,t=new Y.Vector4),e.set(i,i,i,i),t.set(n,n,n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this},clone:function(){return new Y.Vector4(this.x,this.y,this.z,this.w)}},Y.Euler=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||Y.Euler.DefaultOrder},Y.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Y.Euler.DefaultOrder="XYZ",Y.Euler.prototype={constructor:Y.Euler,_x:0,_y:0,_z:0,_order:Y.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var n=Y.Math.clamp,r=e.elements,o=r[0],s=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],f=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===t?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,f),this._y=0)):Y.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,i,n){return void 0===e&&(e=new Y.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,n),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(c=new Y.Quaternion,function(e){c.setFromEuler(this),this.setFromQuaternion(c,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Y.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new Y.Euler(this._x,this._y,this._z,this._order)}},Y.Line3=function(e,t){this.start=void 0!==e?e:new Y.Vector3,this.end=void 0!==t?t:new Y.Vector3},Y.Line3.prototype={constructor:Y.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new Y.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new Y.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new Y.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(u=new Y.Vector3,h=new Y.Vector3,function(e,t){u.subVectors(e,this.start),h.subVectors(this.end,this.start);var i=h.dot(h),n=h.dot(u)/i;return t&&(n=Y.Math.clamp(n,0,1)),n}),closestPointToPoint:function(e,t,i){var n=this.closestPointToPointParameter(e,t),r=i||new Y.Vector3;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new Y.Line3).copy(this)}},Y.Box2=function(e,t){this.min=void 0!==e?e:new Y.Vector2(1/0,1/0),this.max=void 0!==t?t:new Y.Vector2(-1/0,-1/0)},Y.Box2.prototype={constructor:Y.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Y.Vector2;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return console.warn("Box2.empty has been deprecated. Use Box2.isEmpty instead"),this.isEmpty()},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return console.warn("Box2.center() is deprecated. Use Box2.getCenter() instead."),this.getCenter(e)},getCenter:function(e){return(e||new Y.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new Y.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new Y.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new Y.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Y.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new Y.Box2).copy(this)}},Y.Box3=function(e,t){this.min=void 0!==e?e:new Y.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Y.Vector3(-1/0,-1/0,-1/0)},Y.Box3.prototype={constructor:Y.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Y.Vector3;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(){var e=new Y.Vector3;return function(t){var i=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse((function(t){var n=t.geometry;if(void 0!==n)if(n instanceof Y.Geometry)for(var r=n.vertices,o=0,s=r.length;o<s;o++)e.copy(r[o]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e);else if(n instanceof Y.BufferGeometry&&void 0!==n.attributes.position){var a=n.attributes.position.array;for(o=0,s=a.length;o<s;o+=3)e.set(a[o],a[o+1],a[o+2]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e)}})),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return console.warn("Box3.empty has been deprecated. Use Box3.isEmpty instead"),this.isEmpty()},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return console.warn("Box3.center() is deprecated. Use Box3.getCenter() instead."),this.getCenter(e)},getCenter:function(e){return e=e||new Y.Vector3,this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new Y.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new Y.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new Y.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Y.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Y.Vector3;return function(t){var i=t||new Y.Sphere;return i.center=this.getCenter(),i.radius=.5*this.size(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(d=[new Y.Vector3,new Y.Vector3,new Y.Vector3,new Y.Vector3,new Y.Vector3,new Y.Vector3,new Y.Vector3,new Y.Vector3],function(e){return d[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),d[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),d[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),d[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),d[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),d[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),d[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),d[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(d),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new Y.Box3).copy(this)}},Y.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&Y.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},Y.Matrix3.prototype={constructor:Y.Matrix3,set:function(e,t,i,n,r,o,s,a,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=i,c[1]=n,c[4]=r,c[7]=o,c[2]=s,c[5]=a,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return Y.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return Y.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new Y.Vector3;return function(t,i,n){void 0===i&&(i=0),void 0===n&&(n=t.length);for(var r=0,o=i;r<n;r+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix3(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-i*r*c+i*s*a+n*r*l-n*o*a},getInverse:function(e,t){var i=e.elements,n=this.elements;n[0]=i[10]*i[5]-i[6]*i[9],n[1]=-i[10]*i[1]+i[2]*i[9],n[2]=i[6]*i[1]-i[2]*i[5],n[3]=-i[10]*i[4]+i[6]*i[8],n[4]=i[10]*i[0]-i[2]*i[8],n[5]=-i[6]*i[0]+i[2]*i[4],n[6]=i[9]*i[4]-i[5]*i[8],n[7]=-i[9]*i[0]+i[1]*i[8],n[8]=i[5]*i[0]-i[1]*i[4];var r=i[0]*n[0]+i[1]*n[3]+i[2]*n[6];if(0===r){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return Y.warn(o),this.identity(),this}return this.multiplyScalar(1/r),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new Y.Matrix3).fromArray(this.elements)}},Y.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&Y.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},Y.Matrix4.prototype={constructor:Y.Matrix4,set:function(e,t,i,n,r,o,s,a,l,c,u,h,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return Y.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){var n=this.elements;return e.set(n[0],n[1],n[2]),t.set(n[4],n[5],n[6]),i.set(n[8],n[9],n[10]),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new Y.Vector3;return function(t){var i=this.elements,n=t.elements,r=1/e.set(n[0],n[1],n[2]).length(),o=1/e.set(n[4],n[5],n[6]).length(),s=1/e.set(n[8],n[9],n[10]).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,this}}(),makeRotationFromEuler:function(e){e instanceof Y.Euler==!1&&Y.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){var h=o*c,d=o*u,f=s*c,p=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-s*a,t[2]=p-h*l,t[6]=f+d*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*c,g=a*u,v=l*c,y=l*u;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*c,g=a*u,v=l*c,y=l*u;t[0]=m-y*s,t[4]=-o*u,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*c,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){h=o*c,d=o*u,f=s*c,p=s*u;t[0]=a*c,t[4]=f*l-d,t[8]=h*l+p,t[1]=a*u,t[5]=p*l+h,t[9]=d*l-f,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var b=o*a,x=o*l,_=s*a,E=s*l;t[0]=a*c,t[4]=E-b*u,t[8]=_*u+x,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=x*u+_,t[10]=b-E*u}else if("XZY"===e.order){b=o*a,x=o*l,_=s*a,E=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=b*u+E,t[5]=o*c,t[9]=x*u-_,t[2]=_*u-x,t[6]=s*c,t[10]=E*u+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return Y.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,s=i+i,a=n+n,l=r+r,c=i*s,u=i*a,h=i*l,d=n*a,f=n*l,p=r*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(d+p),t[4]=u-v,t[8]=h+g,t[1]=u+v,t[5]=1-(c+p),t[9]=f-m,t[2]=h-g,t[6]=f+m,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new Y.Vector3,t=new Y.Vector3,i=new Y.Vector3;return function(n,r,o){var s=this.elements;return i.subVectors(n,r).normalize(),0===i.length()&&(i.z=1),e.crossVectors(o,i).normalize(),0===e.length()&&(i.x+=1e-4,e.crossVectors(o,i).normalize()),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(Y.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],f=i[2],p=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],x=i[15],_=n[0],E=n[4],S=n[8],A=n[12],w=n[1],C=n[5],T=n[9],M=n[13],I=n[2],P=n[6],L=n[10],R=n[14],D=n[3],O=n[7],B=n[11],N=n[15];return r[0]=o*_+s*w+a*I+l*D,r[4]=o*E+s*C+a*P+l*O,r[8]=o*S+s*T+a*L+l*B,r[12]=o*A+s*M+a*R+l*N,r[1]=c*_+u*w+h*I+d*D,r[5]=c*E+u*C+h*P+d*O,r[9]=c*S+u*T+h*L+d*B,r[13]=c*A+u*M+h*R+d*N,r[2]=f*_+p*w+m*I+g*D,r[6]=f*E+p*C+m*P+g*O,r[10]=f*S+p*T+m*L+g*B,r[14]=f*A+p*M+m*R+g*N,r[3]=v*_+y*w+b*I+x*D,r[7]=v*E+y*C+b*P+x*O,r[11]=v*S+y*T+b*L+x*B,r[15]=v*A+y*M+b*R+x*N,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return Y.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return Y.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return Y.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new Y.Vector3;return function(t,i,n){void 0===i&&(i=0),void 0===n&&(n=t.length);for(var r=0,o=i;r<n;r+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix4(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),rotateAxis:function(e){Y.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return Y.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-n*l*u-r*s*h+i*l*h+n*s*d-i*a*d)+e[7]*(+t*a*d-t*l*h+r*o*h-n*o*d+n*l*c-r*a*c)+e[11]*(+t*l*u-t*s*d-r*o*u+i*o*d+r*s*c-i*l*c)+e[15]*(-n*s*c-t*a*u+t*s*h+n*o*u-i*o*h+i*a*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=new Y.Vector3;return function(){Y.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,r=n[0],o=n[4],s=n[8],a=n[12],l=n[1],c=n[5],u=n[9],h=n[13],d=n[2],f=n[6],p=n[10],m=n[14],g=n[3],v=n[7],y=n[11],b=n[15];i[0]=u*m*v-h*p*v+h*f*y-c*m*y-u*f*b+c*p*b,i[4]=a*p*v-s*m*v-a*f*y+o*m*y+s*f*b-o*p*b,i[8]=s*h*v-a*u*v+a*c*y-o*h*y-s*c*b+o*u*b,i[12]=a*u*f-s*h*f-a*c*p+o*h*p+s*c*m-o*u*m,i[1]=h*p*g-u*m*g-h*d*y+l*m*y+u*d*b-l*p*b,i[5]=s*m*g-a*p*g+a*d*y-r*m*y-s*d*b+r*p*b,i[9]=a*u*g-s*h*g-a*l*y+r*h*y+s*l*b-r*u*b,i[13]=s*h*d-a*u*d+a*l*p-r*h*p-s*l*m+r*u*m,i[2]=c*m*g-h*f*g+h*d*v-l*m*v-c*d*b+l*f*b,i[6]=a*f*g-o*m*g-a*d*v+r*m*v+o*d*b-r*f*b,i[10]=o*h*g-a*c*g+a*l*v-r*h*v-o*l*b+r*c*b,i[14]=a*c*d-o*h*d-a*l*f+r*h*f+o*l*m-r*c*m,i[3]=u*f*g-c*p*g-u*d*v+l*p*v+c*d*y-l*f*y,i[7]=o*p*g-s*f*g+s*d*v-r*p*v-o*d*y+r*f*y,i[11]=s*c*g-o*u*g-s*l*v+r*u*v+o*l*y-r*c*y,i[15]=o*u*d-s*c*d+s*l*f-r*u*f-o*l*p+r*c*p;var x=r*i[0]+l*i[4]+d*i[8]+g*i[12];if(0==x){var _="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(_);return Y.warn(_),this.identity(),this}return this.multiplyScalar(1/x),this},translate:function(e){Y.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){Y.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){Y.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){Y.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){Y.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,n)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,s=e.y,a=e.z,l=r*o,c=r*s;return this.set(l*o+i,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+i,c*a-n*o,0,l*a-n*s,c*a+n*o,r*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new Y.Vector3,t=new Y.Matrix4;return function(i,n,r){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var c=1/s,u=1/a,h=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,n.setFromRotationMatrix(t),r.x=s,r.y=a,r.z=l,this}}(),makeFrustum:function(e,t,i,n,r,o){var s=this.elements,a=2*r/(t-e),l=2*r/(n-i),c=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),d=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(e,t,i,n){var r=i*Math.tan(Y.Math.degToRad(.5*e)),o=-r,s=o*t,a=r*t;return this.makeFrustum(s,a,o,r,i,n)},makeOrthographic:function(e,t,i,n,r,o){var s=this.elements,a=t-e,l=i-n,c=o-r,u=(t+e)/a,h=(i+n)/l,d=(o+r)/c;return s[0]=2/a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2/l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2/c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals(e){const t=this.elements,i=e.elements;for(var n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new Y.Matrix4).fromArray(this.elements)}},Y.Ray=function(e,t){this.origin=void 0!==e?e:new Y.Vector3,this.direction=void 0!==t?t:new Y.Vector3},Y.Ray.prototype={constructor:Y.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new Y.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new Y.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new Y.Vector3;i.subVectors(e,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(){var e=new Y.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:(p=new Y.Vector3,m=new Y.Vector3,g=new Y.Vector3,function(e,t,i,n){p.copy(e).add(t).multiplyScalar(.5),m.copy(t).sub(e).normalize(),g.copy(this.origin).sub(p);var r,o,s,a,l=.5*e.distanceTo(t),c=-this.direction.dot(m),u=g.dot(this.direction),h=-g.dot(m),d=g.lengthSq(),f=Math.abs(1-c*c);if(f>0)if(o=c*u-h,a=l*f,(r=c*h-u)>=0)if(o>=-a)if(o<=a){var v=1/f;s=(r*=v)*(r+c*(o*=v)+2*u)+o*(c*r+o+2*h)+d}else o=l,s=-(r=Math.max(0,-(c*o+u)))*r+o*(o+2*h)+d;else o=-l,s=-(r=Math.max(0,-(c*o+u)))*r+o*(o+2*h)+d;else o<=-a?s=-(r=Math.max(0,-(-c*l+u)))*r+(o=r>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+d:o<=a?(r=0,s=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+d):s=-(r=Math.max(0,-(c*l+u)))*r+(o=r>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+d;else o=c>0?-l:l,s=-(r=Math.max(0,-(c*o+u)))*r+o*(o+2*h)+d;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),n&&n.copy(m).multiplyScalar(o).add(p),s}),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new Y.Vector3;return function(t,i){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),r=e.dot(e)-n*n,o=t.radius*t.radius;if(r>o)return null;var s=Math.sqrt(o-r),a=n-s,l=n+s;return a<0&&l<0?null:a<0?this.at(l,i):this.at(a,i)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},isIntersectionBox:(f=new Y.Vector3,function(e){return null!==this.intersectBox(e,f)}),intersectBox:function(e,t){var i,n,r,o,s,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),i>o||r>n?null:((r>i||i!=i)&&(i=r),(o<n||n!=n)&&(n=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),i>a||s>n?null:((s>i||i!=i)&&(i=s),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))},intersectTriangle:function(){var e=new Y.Vector3,t=new Y.Vector3,i=new Y.Vector3,n=new Y.Vector3;return function(r,o,s,a,l){t.subVectors(o,r),i.subVectors(s,r),n.crossVectors(t,i);var c,u=this.direction.dot(n);if(u>0){if(a)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,r);var h=c*this.direction.dot(i.crossVectors(e,i));if(h<0)return null;var d=c*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>u)return null;var f=-c*e.dot(n);return f<0?null:this.at(f/u,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new Y.Ray).copy(this)}},Y.Sphere=function(e,t){this.center=void 0!==e?e:new Y.Vector3,this.radius=void 0!==t?t:0},Y.Sphere.prototype={constructor:Y.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(v=new Y.Box3,function(e,t){var i=this.center;void 0!==t?i.copy(t):v.setFromPoints(e).getCenter(i);for(var n=0,r=0,o=e.length;r<o;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),n=t||new Y.Vector3;return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){var t=e||new Y.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new Y.Sphere).copy(this)}},Y.Frustum=function(e,t,i,n,r,o){this.planes=[void 0!==e?e:new Y.Plane,void 0!==t?t:new Y.Plane,void 0!==i?i:new Y.Plane,void 0!==n?n:new Y.Plane,void 0!==r?r:new Y.Plane,void 0!==o?o:new Y.Plane]},Y.Frustum.prototype={constructor:Y.Frustum,set:function(e,t,i,n,r,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(o),this},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],f=i[10],p=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(s-n,u-a,p-h,y-m).normalize(),t[1].setComponents(s+n,u+a,p+h,y+m).normalize(),t[2].setComponents(s+r,u+l,p+d,y+g).normalize(),t[3].setComponents(s-r,u-l,p-d,y-g).normalize(),t[4].setComponents(s-o,u-c,p-f,y-v).normalize(),t[5].setComponents(s+o,u+c,p+f,y+v).normalize(),this},intersectsObject:(x=new Y.Sphere,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),x.copy(t.boundingSphere),x.applyMatrix4(e.matrixWorld),this.intersectsSphere(x)}),intersectsSphere:function(e){for(var t=this.planes,i=e.center,n=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(i)<n)return!1}return!0},intersectsBox:(y=new Y.Vector3,b=new Y.Vector3,function(e){for(var t=this.planes,i=0;i<6;i++){var n=t[i];y.x=n.normal.x>0?e.min.x:e.max.x,b.x=n.normal.x>0?e.max.x:e.min.x,y.y=n.normal.y>0?e.min.y:e.max.y,b.y=n.normal.y>0?e.max.y:e.min.y,y.z=n.normal.z>0?e.min.z:e.max.z,b.z=n.normal.z>0?e.max.z:e.min.z;var r=n.distanceToPoint(y),o=n.distanceToPoint(b);if(r<0&&o<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new Y.Frustum).copy(this)}},Y.Plane=function(e,t){this.normal=void 0!==e?e:new Y.Vector3(1,0,0),this.constant=void 0!==t?t:0},Y.Plane.prototype={constructor:Y.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Y.Vector3,t=new Y.Vector3;return function(i,n,r){var o=e.subVectors(r,n).cross(t.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);return(t||new Y.Vector3).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectLine:function(){var e=new Y.Vector3;return function(t,i){var n=i||new Y.Vector3,r=t.delta(e),o=this.normal.dot(r);if(0==o)return 0==this.distanceToPoint(t.start)?n.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/o;return s<0||s>1?void 0:n.copy(r).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){return(e||new Y.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Y.Vector3,t=new Y.Vector3,i=new Y.Matrix3;return function(n,r){var o=r||i.getNormalMatrix(n),s=e.copy(this.normal).applyMatrix3(o);s.normalize();var a=this.coplanarPoint(t);return a.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(s,a),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new Y.Plane).copy(this)}},Y.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8==r||13==r||18==r||23==r?i[r]="-":14==r?i[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,i[r]=t[19==r?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return e<t?t:e>i?i:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:(E=Math.PI/180,function(e){return e*E}),radToDeg:(_=180/Math.PI,function(e){return e*_}),isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},Y.Spline=function(e){this.points=e;var t,i,n,r,o,s,a,l,c,u=[],h={x:0,y:0,z:0};function d(e,t,i,n,r,o,s){var a=.5*(i-e),l=.5*(n-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*r+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,i=Math.floor(t),n=t-i,u[0]=0===i?i:i-1,u[1]=i,u[2]=i>this.points.length-2?this.points.length-1:i+1,u[3]=i>this.points.length-3?this.points.length-1:i+2,s=this.points[u[0]],a=this.points[u[1]],l=this.points[u[2]],c=this.points[u[3]],o=n*(r=n*n),h.x=d(s.x,a.x,l.x,c.x,n,r,o),h.y=d(s.y,a.y,l.y,c.y,n,r,o),h.z=d(s.z,a.z,l.z,c.z,n,r,o),h},this.getControlPointsArray=function(){var e,t,i=this.points.length,n=[];for(e=0;e<i;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,i,n,r,o=0,s=0,a=0,l=new Y.Vector3,c=new Y.Vector3,u=[],h=0;for(u[0]=0,e||(e=100),n=this.points.length*e,l.copy(this.points[0]),t=1;t<n;t++)i=t/n,r=this.getPoint(i),c.copy(r),h+=c.distanceTo(l),l.copy(r),o=(this.points.length-1)*i,(s=Math.floor(o))!=a&&(u[s]=h,a=s);return u[u.length]=h,{chunks:u,total:h}},this.reparametrizeByArcLength=function(e){var t,i,n,r,o,s,a,l,c=[],u=new Y.Vector3,h=this.getLength();for(c.push(u.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=h.chunks[t]-h.chunks[t-1],a=Math.ceil(e*s/h.total),r=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;i<a-1;i++)n=r+i*(1/a)*(o-r),l=this.getPoint(n),c.push(u.copy(l).clone());c.push(u.copy(this.points[t]).clone())}this.points=c}},Y.Triangle=function(e,t,i){this.a=void 0!==e?e:new Y.Vector3,this.b=void 0!==t?t:new Y.Vector3,this.c=void 0!==i?i:new Y.Vector3},Y.Triangle.normal=(S=new Y.Vector3,function(e,t,i,n){var r=n||new Y.Vector3;r.subVectors(i,t),S.subVectors(e,t),r.cross(S);var o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}),Y.Triangle.barycoordFromPoint=function(){var e=new Y.Vector3,t=new Y.Vector3,i=new Y.Vector3;return function(n,r,o,s,a){e.subVectors(s,r),t.subVectors(o,r),i.subVectors(n,r);var l=e.dot(e),c=e.dot(t),u=e.dot(i),h=t.dot(t),d=t.dot(i),f=l*h-c*c,p=a||new Y.Vector3;if(0==f)return p.set(-2,-1,-1);var m=1/f,g=(h*u-c*d)*m,v=(l*d-c*u)*m;return p.set(1-g-v,v,g)}}(),Y.Triangle.containsPoint=function(){var e=new Y.Vector3;return function(t,i,n,r){var o=Y.Triangle.barycoordFromPoint(t,i,n,r,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),Y.Triangle.prototype={constructor:Y.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new Y.Vector3,t=new Y.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new Y.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return Y.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new Y.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return Y.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Y.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new Y.Triangle).copy(this)}},Y.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},Y.Clock.prototype={constructor:Y.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},Y.EventDispatcher=function(){},Y.EventDispatcher.prototype={constructor:Y.EventDispatcher,apply:function(e){e.addEventListener=Y.EventDispatcher.prototype.addEventListener,e.hasEventListener=Y.EventDispatcher.prototype.hasEventListener,e.removeEventListener=Y.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=Y.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=[],n=t.length,r=0;r<n;r++)i[r]=t[r];for(r=0;r<n;r++)i[r].call(this,e)}}}},function(e){e.Raycaster=function(t,i,n,r){this.ray=new e.Ray(t,i),this.near=n||0,this.far=r||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{threshold:1}}};var t=function(e,t){return e.distance-t.distance},i=function(e,t,n,r){if(e.raycast(t,n),!0===r)for(var o=e.children,s=0,a=o.length;s<a;s++)i(o[s],t,n,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,i){i instanceof e.PerspectiveCamera?(this.ray.origin.copy(i.position),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(i.position).normalize()):i instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld)):e.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,n){var r=[];return i(e,this,r,n),r.sort(t),r},intersectObjects:function(n,r){var o=[];if(n instanceof Array==!1)return e.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var s=0,a=n.length;s<a;s++)i(n[s],this,o,r);return o.sort(t),o}},Object.defineProperty(e.Raycaster.prototype,"linePrecision",{get:function(){return console.warn("THREE.Raycaster: .linePrecision is now .params.Line.threshold."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision is now .params.Line.threshold."),this.params.Line.threshold=e}})}(Y),Y.Object3D=function(){Object.defineProperty(this,"id",{value:Y.Object3DIdCount++}),this.uuid=Y.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=Y.Object3D.DefaultUp.clone();var e=new Y.Vector3,t=new Y.Euler,i=new Y.Quaternion,n=new Y.Vector3(1,1,1);t.onChange((function(){i.setFromEuler(t,!1)})),i.onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:n}}),this.rotationAutoUpdate=!0,this.matrix=new Y.Matrix4,this.matrixWorld=new Y.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},Y.Object3D.DefaultUp=new Y.Vector3(0,1,0),Y.Object3D.prototype={constructor:Y.Object3D,get eulerOrder(){return Y.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){Y.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){Y.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){Y.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(T=new Y.Quaternion,function(e,t){return T.setFromAxisAngle(e,t),this.quaternion.multiply(T),this}),rotateX:function(){var e=new Y.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Y.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Y.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new Y.Vector3;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translate:function(e,t){return Y.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new Y.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Y.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Y.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(C=new Y.Matrix4,function(e){return e.applyMatrix4(C.getInverse(this.matrixWorld))}),lookAt:function(){var e=new Y.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Y.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof Y.Object3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):Y.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var i=this.children.indexOf(e);-1!==i&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(i,1))},getChildByName:function(e){return Y.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){var t=e||new Y.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(A=new Y.Vector3,w=new Y.Vector3,function(e){var t=e||new Y.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(A,t,w),t}),getWorldRotation:function(){var e=new Y.Quaternion;return function(t){var i=t||new Y.Euler;return this.getWorldQuaternion(e),i.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new Y.Vector3,t=new Y.Quaternion;return function(i){var n=i||new Y.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(){var e=new Y.Quaternion;return function(t){var i=t||new Y.Vector3;return this.getWorldQuaternion(e),i.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,i=this.children.length;t<i;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=0,i=this.children.length;t<i;t++)this.children[t].traverseVisible(e)}},traverseAncestors:function(e){this.parent&&(e(this.parent),this.parent.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},t={},i={},n=function(t){if(void 0===e.materials&&(e.materials=[]),void 0===i[t.uuid]){var n=t.toJSON();delete n.metadata,i[t.uuid]=n,e.materials.push(n)}return t.uuid},r=function(i){var o={};if(o.uuid=i.uuid,o.type=i.type,""!==i.name&&(o.name=i.name),"{}"!==JSON.stringify(i.userData)&&(o.userData=i.userData),!0!==i.visible&&(o.visible=i.visible),i instanceof Y.PerspectiveCamera?(o.fov=i.fov,o.aspect=i.aspect,o.near=i.near,o.far=i.far):i instanceof Y.OrthographicCamera?(o.left=i.left,o.right=i.right,o.top=i.top,o.bottom=i.bottom,o.near=i.near,o.far=i.far):i instanceof Y.AmbientLight?o.color=i.color.getHex():i instanceof Y.DirectionalLight?(o.color=i.color.getHex(),o.intensity=i.intensity):i instanceof Y.PointLight?(o.color=i.color.getHex(),o.intensity=i.intensity,o.distance=i.distance,o.decay=i.decay):i instanceof Y.SpotLight?(o.color=i.color.getHex(),o.intensity=i.intensity,o.distance=i.distance,o.angle=i.angle,o.exponent=i.exponent,o.decay=i.decay):i instanceof Y.HemisphereLight?(o.color=i.color.getHex(),o.groundColor=i.groundColor.getHex()):i instanceof Y.Mesh||i instanceof Y.Line||i instanceof Y.PointCloud?(o.geometry=function(i){if(void 0===e.geometries&&(e.geometries=[]),void 0===t[i.uuid]){var n=i.toJSON();delete n.metadata,t[i.uuid]=n,e.geometries.push(n)}return i.uuid}(i.geometry),o.material=n(i.material),i instanceof Y.Line&&(o.mode=i.mode)):i instanceof Y.Sprite&&(o.material=n(i.material)),o.matrix=i.matrix.toArray(),i.children.length>0){o.children=[];for(var s=0;s<i.children.length;s++)o.children.push(r(i.children[s]))}return o};return e.object=r(this),e},clone:function(e,t){if(void 0===e&&(e=new Y.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),!0===t)for(var i=0;i<this.children.length;i++){var n=this.children[i];e.add(n.clone())}return e}},Y.EventDispatcher.prototype.apply(Y.Object3D.prototype),Y.Object3DIdCount=0,Y.Face3=function(e,t,i,n,r,o){this.a=e,this.b=t,this.c=i,this.normal=n instanceof Y.Vector3?n:new Y.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=r instanceof Y.Color?r:new Y.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},Y.Face3.prototype={constructor:Y.Face3,clone:function(){var e=new Y.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,i=this.vertexNormals.length;t<i;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;t<i;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;t<i;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},Y.Face4=function(e,t,i,n,r,o,s){return Y.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Y.Face3(e,t,i,r,o,s)},Y.BufferAttribute=function(e,t){this.array=e,this.itemSize=t,this.count=null!=e?e.length/t:0,this.needsUpdate=!1},Y.BufferAttribute.prototype={constructor:Y.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=i,this.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this},clone:function(){return new Y.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},Y.Int8Attribute=function(e,t){return Y.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Y.BufferAttribute(e,t)},Y.Uint8Attribute=function(e,t){return Y.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Y.BufferAttribute(e,t)},Y.Uint8ClampedAttribute=function(e,t){return Y.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Y.BufferAttribute(e,t)},Y.Int16Attribute=function(e,t){return Y.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Y.BufferAttribute(e,t)},Y.Uint16Attribute=function(e,t){return Y.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Y.BufferAttribute(e,t)},Y.Int32Attribute=function(e,t){return Y.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Y.BufferAttribute(e,t)},Y.Uint32Attribute=function(e,t){return Y.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Y.BufferAttribute(e,t)},Y.Float32Attribute=function(e,t){return Y.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Y.BufferAttribute(e,t)},Y.Float64Attribute=function(e,t){return Y.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Y.BufferAttribute(e,t)},Y.DynamicBufferAttribute=function(e,t){Y.BufferAttribute.call(this,e,t),this.updateRange={offset:0,count:-1}},Y.DynamicBufferAttribute.prototype=Object.create(Y.BufferAttribute.prototype),Y.DynamicBufferAttribute.prototype.constructor=Y.DynamicBufferAttribute,Y.DynamicBufferAttribute.prototype.clone=function(){return new Y.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)},Y.BufferGeometry=function(){Object.defineProperty(this,"id",{value:Y.GeometryIdCount++}),this.uuid=Y.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},Y.BufferGeometry.prototype={constructor:Y.BufferGeometry,addAttribute:function(e,t){console.warn("BufferGeometry.addAttribute() is deprecated. Use BufferGeometry.setAttribute() instead."),this.setAttribute(e,t)},setAttribute:function(e,t){if(t instanceof Y.BufferAttribute==!1)return Y.warn("THREE.BufferGeometry: .setAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:arguments[1],itemSize:arguments[2]});this.attributes[e]=t,this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,i){this.drawcalls.push({start:e,count:t,index:void 0!==i?i:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new Y.Matrix3).getNormalMatrix(e).applyToVector3Array(i.array),i.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.applyMatrix((new Y.Matrix4).setPosition(e)),e},fromGeometry:function(e,t){t=t||{vertexColors:Y.NoColors};var i=e.vertices,n=e.faces,r=e.faceVertexUvs,o=t.vertexColors,s=r[0].length>0,a=3==n[0].vertexNormals.length,l=new Float32Array(3*n.length*3);this.setAttribute("position",new Y.BufferAttribute(l,3));var c=new Float32Array(3*n.length*3);if(this.setAttribute("normal",new Y.BufferAttribute(c,3)),o!==Y.NoColors){var u=new Float32Array(3*n.length*3);this.setAttribute("color",new Y.BufferAttribute(u,3))}if(!0===s){var h=new Float32Array(3*n.length*2);this.setAttribute("uv",new Y.BufferAttribute(h,2))}for(var d=0,f=0,p=0;d<n.length;d++,f+=6,p+=9){var m=n[d],g=i[m.a],v=i[m.b],y=i[m.c];if(l[p]=g.x,l[p+1]=g.y,l[p+2]=g.z,l[p+3]=v.x,l[p+4]=v.y,l[p+5]=v.z,l[p+6]=y.x,l[p+7]=y.y,l[p+8]=y.z,!0===a){var b=m.vertexNormals[0],x=m.vertexNormals[1],_=m.vertexNormals[2];c[p]=b.x,c[p+1]=b.y,c[p+2]=b.z,c[p+3]=x.x,c[p+4]=x.y,c[p+5]=x.z,c[p+6]=_.x,c[p+7]=_.y,c[p+8]=_.z}else{var E=m.normal;c[p]=E.x,c[p+1]=E.y,c[p+2]=E.z,c[p+3]=E.x,c[p+4]=E.y,c[p+5]=E.z,c[p+6]=E.x,c[p+7]=E.y,c[p+8]=E.z}if(o===Y.FaceColors){var S=m.color;u[p]=S.r,u[p+1]=S.g,u[p+2]=S.b,u[p+3]=S.r,u[p+4]=S.g,u[p+5]=S.b,u[p+6]=S.r,u[p+7]=S.g,u[p+8]=S.b}else if(o===Y.VertexColors){var A=m.vertexColors[0],w=m.vertexColors[1],C=m.vertexColors[2];u[p]=A.r,u[p+1]=A.g,u[p+2]=A.b,u[p+3]=w.r,u[p+4]=w.g,u[p+5]=w.b,u[p+6]=C.r,u[p+7]=C.g,u[p+8]=C.b}if(!0===s){var T=r[0][d][0],M=r[0][d][1],I=r[0][d][2];h[f]=T.x,h[f+1]=T.y,h[f+2]=M.x,h[f+3]=M.y,h[f+4]=I.x,h[f+5]=I.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){var e=new Y.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new Y.Box3);var t=this.attributes.position.array;if(t){var i=this.boundingBox;i.makeEmpty();for(var n=0,r=t.length;n<r;n+=3)e.set(t[n],t[n+1],t[n+2]),i.expandByPoint(e)}void 0!==t&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Y.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var e=new Y.Box3,t=new Y.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new Y.Sphere);var i=this.attributes.position.array;if(i){e.makeEmpty();for(var n=this.boundingSphere.center,r=0,o=i.length;r<o;r+=3)t.set(i[r],i[r+1],i[r+2]),e.expandByPoint(t);e.getCenter(n);var s=0;for(r=0,o=i.length;r<o;r+=3)t.set(i[r],i[r+1],i[r+2]),s=Math.max(s,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&Y.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new Y.BufferAttribute(new Float32Array(t.length),3));else for(var i=0,n=(a=e.normal.array).length;i<n;i++)a[i]=0;var r,o,s,a=e.normal.array,l=new Y.Vector3,c=new Y.Vector3,u=new Y.Vector3,h=new Y.Vector3,d=new Y.Vector3;if(e.index)for(var f=e.index.array,p=this.offsets.length>0?this.offsets:[{start:0,count:f.length,index:0}],m=0,g=p.length;m<g;++m){var v=p[m].start,y=p[m].count,b=p[m].index;for(i=v,n=v+y;i<n;i+=3)r=3*(b+f[i]),o=3*(b+f[i+1]),s=3*(b+f[i+2]),l.fromArray(t,r),c.fromArray(t,o),u.fromArray(t,s),h.subVectors(u,c),d.subVectors(l,c),h.cross(d),a[r]+=h.x,a[r+1]+=h.y,a[r+2]+=h.z,a[o]+=h.x,a[o+1]+=h.y,a[o+2]+=h.z,a[s]+=h.x,a[s+1]+=h.y,a[s+2]+=h.z}else for(i=0,n=t.length;i<n;i+=9)l.fromArray(t,i),c.fromArray(t,i+3),u.fromArray(t,i+6),h.subVectors(u,c),d.subVectors(l,c),h.cross(d),a[i]=h.x,a[i+1]=h.y,a[i+2]=h.z,a[i+3]=h.x,a[i+4]=h.y,a[i+5]=h.z,a[i+6]=h.x,a[i+7]=h.y,a[i+8]=h.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,i=this.attributes.normal.array,n=this.attributes.uv.array,r=t.length/3;void 0===this.attributes.tangent&&this.setAttribute("tangent",new Y.BufferAttribute(new Float32Array(4*r),4));for(var o=this.attributes.tangent.array,s=[],a=[],l=0;l<r;l++)s[l]=new Y.Vector3,a[l]=new Y.Vector3;var c,u,h,d,f,p,m,g,v,y,b,x,_,E,S,A,w,C,T=new Y.Vector3,M=new Y.Vector3,I=new Y.Vector3,P=new Y.Vector2,L=new Y.Vector2,R=new Y.Vector2,D=new Y.Vector3,O=new Y.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,e.length,0);var B,N,U,k=this.drawcalls;for(E=0,S=k.length;E<S;++E){var F=k[E].start,V=k[E].count,G=k[E].index;for(x=F,_=F+V;x<_;x+=3)A=G+e[x],w=G+e[x+1],C=G+e[x+2],B=A,N=w,U=C,T.fromArray(t,3*B),M.fromArray(t,3*N),I.fromArray(t,3*U),P.fromArray(n,2*B),L.fromArray(n,2*N),R.fromArray(n,2*U),c=M.x-T.x,u=I.x-T.x,h=M.y-T.y,d=I.y-T.y,f=M.z-T.z,p=I.z-T.z,m=L.x-P.x,g=R.x-P.x,v=L.y-P.y,y=R.y-P.y,b=1/(m*y-g*v),D.set((y*c-v*u)*b,(y*h-v*d)*b,(y*f-v*p)*b),O.set((m*u-g*c)*b,(m*d-g*h)*b,(m*p-g*f)*b),s[B].add(D),s[N].add(D),s[U].add(D),a[B].add(O),a[N].add(O),a[U].add(O)}var z,H,W,j=new Y.Vector3,q=new Y.Vector3,K=new Y.Vector3,X=new Y.Vector3;for(E=0,S=k.length;E<S;++E){F=k[E].start,V=k[E].count,G=k[E].index;for(x=F,_=F+V;x<_;x+=3)A=G+e[x],w=G+e[x+1],C=G+e[x+2],Q(A),Q(w),Q(C)}}else Y.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function Q(e){K.fromArray(i,3*e),X.copy(K),H=s[e],j.copy(H),j.sub(K.multiplyScalar(K.dot(H))).normalize(),q.crossVectors(X,H),W=q.dot(a[e]),z=W<0?-1:1,o[4*e]=j.x,o[4*e+1]=j.y,o[4*e+2]=j.z,o[4*e+3]=z}},computeOffsets:function(e){void 0===e&&(e=65535);for(var t=this.attributes.index.array,i=this.attributes.position.array,n=t.length/3,r=new Uint16Array(t.length),o=0,s=0,a=[{start:0,count:0,index:0}],l=a[0],c=0,u=new Int32Array(6),h=new Int32Array(i.length),d=new Int32Array(i.length),f=0;f<i.length;f++)h[f]=-1,d[f]=-1;for(var p=0;p<n;p++){c=0;for(var m=0;m<3;m++){-1==h[b=t[3*p+m]]?(u[2*m]=b,u[2*m+1]=-1,c++):h[b]<l.index?(u[2*m]=b,u[2*m+1]=-1):(u[2*m]=b,u[2*m+1]=h[b])}if(s+c>l.index+e){var g={start:o,count:0,index:s};a.push(g),l=g;for(var v=0;v<6;v+=2){(y=u[v+1])>-1&&y<l.index&&(u[v+1]=-1)}}for(v=0;v<6;v+=2){var y,b=u[v];-1===(y=u[v+1])&&(y=s++),h[b]=y,d[y]=b,r[o++]=y-l.index,l.count++}}return this.reorderBuffers(r,d,s),this.offsets=a,this.drawcalls=a,a},merge:function(e,t){if(e instanceof Y.BufferGeometry!=!1){void 0===t&&(t=0);var i=this.attributes;for(var n in i)if(void 0!==e.attributes[n])for(var r=i[n].array,o=e.attributes[n],s=o.array,a=0,l=o.itemSize*t;a<s.length;a++,l++)r[l]=s[a];return this}Y.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e,t,i,n,r=this.attributes.normal.array,o=0,s=r.length;o<s;o+=3)e=r[o],t=r[o+1],i=r[o+2],n=1/Math.sqrt(e*e+t*t+i*i),r[o]*=n,r[o+1]*=n,r[o+2]*=n},reorderBuffers:function(e,t,i){var n={};for(var r in this.attributes)if("index"!=r){var o=this.attributes[r].array;n[r]=new o.constructor(this.attributes[r].itemSize*i)}for(var s=0;s<i;s++){var a=t[s];for(var r in this.attributes)if("index"!=r)for(var l=this.attributes[r].array,c=this.attributes[r].itemSize,u=n[r],h=0;h<c;h++)u[s*c+h]=l[a*c+h]}for(var r in this.attributes.index.array=e,this.attributes)"index"!=r&&(this.attributes[r].array=n[r],this.attributes[r].numItems=this.attributes[r].itemSize*i)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},t=this.attributes,i=this.offsets,n=this.boundingSphere;for(var r in t){var o=t[r],s=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:s}}return i.length>0&&(e.data.offsets=JSON.parse(JSON.stringify(i))),null!==n&&(e.data.boundingSphere={center:n.center.toArray(),radius:n.radius}),e},clone:function(){var e=new Y.BufferGeometry;for(var t in this.attributes){var i=this.attributes[t];e.setAttribute(t,i.clone())}for(var n=0,r=this.offsets.length;n<r;n++){var o=this.offsets[n];e.offsets.push({start:o.start,index:o.index,count:o.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Y.EventDispatcher.prototype.apply(Y.BufferGeometry.prototype),Y.Geometry=function(){Object.defineProperty(this,"id",{value:Y.GeometryIdCount++}),this.uuid=Y.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},Y.Geometry.prototype={constructor:Y.Geometry,applyMatrix:function(e){for(var t=(new Y.Matrix3).getNormalMatrix(e),i=0,n=this.vertices.length;i<n;i++){this.vertices[i].applyMatrix4(e)}for(i=0,n=this.faces.length;i<n;i++){var r=this.faces[i];r.normal.applyMatrix3(t).normalize();for(var o=0,s=r.vertexNormals.length;o<s;o++)r.vertexNormals[o].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},fromBufferGeometry:function(e){for(var t=this,i=e.attributes,n=i.position.array,r=void 0!==i.index?i.index.array:void 0,o=void 0!==i.normal?i.normal.array:void 0,s=void 0!==i.color?i.color.array:void 0,a=void 0!==i.uv?i.uv.array:void 0,l=[],c=[],u=0,h=0;u<n.length;u+=3,h+=2)t.vertices.push(new Y.Vector3(n[u],n[u+1],n[u+2])),void 0!==o&&l.push(new Y.Vector3(o[u],o[u+1],o[u+2])),void 0!==s&&t.colors.push(new Y.Color(s[u],s[u+1],s[u+2])),void 0!==a&&c.push(new Y.Vector2(a[h],a[h+1]));var d=function(e,i,n){var r=void 0!==o?[l[e].clone(),l[i].clone(),l[n].clone()]:[],u=void 0!==s?[t.colors[e].clone(),t.colors[i].clone(),t.colors[n].clone()]:[];t.faces.push(new Y.Face3(e,i,n,r,u)),void 0!==a&&t.faceVertexUvs[0].push([c[e].clone(),c[i].clone(),c[n].clone()])};if(void 0!==r){var f=e.drawcalls;if(f.length>0)for(u=0;u<f.length;u++)for(var p=f[u],m=p.start,g=p.count,v=p.index,y=(h=m,m+g);h<y;h+=3)d(v+r[h],v+r[h+1],v+r[h+2]);else for(u=0;u<r.length;u+=3)d(r[u],r[u+1],r[u+2])}else for(u=0;u<n.length/3;u+=3)d(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.applyMatrix((new Y.Matrix4).setPosition(e)),e},computeFaceNormals:function(){for(var e=new Y.Vector3,t=new Y.Vector3,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,i,n,r,o,s;for(s=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)s[t]=new Y.Vector3;if(e){var a,l,c,u=new Y.Vector3,h=new Y.Vector3;for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],a=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),h.subVectors(a,l),u.cross(h),s[o.a].add(u),s[o.b].add(u),s[o.c].add(u)}else for(n=0,r=this.faces.length;n<r;n++)s[(o=this.faces[n]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)s[t].normalize();for(n=0,r=this.faces.length;n<r;n++)(o=this.faces[n]).vertexNormals[0]=s[o.a].clone(),o.vertexNormals[1]=s[o.b].clone(),o.vertexNormals[2]=s[o.c].clone()},computeMorphNormals:function(){var e,t,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for((r=this.faces[i]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var o=new Y.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals;for(i=0,n=this.faces.length;i<n;i++)l=new Y.Vector3,c={a:new Y.Vector3,b:new Y.Vector3,c:new Y.Vector3},s.push(l),a.push(c)}var l,c,u=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,n=this.faces.length;i<n;i++)r=this.faces[i],l=u.faceNormals[i],c=u.vertexNormals[i],l.copy(r.normal),c.a.copy(r.vertexNormals[0]),c.b.copy(r.vertexNormals[1]),c.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)(r=this.faces[i]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeTangents:function(){var e,t,i,n,r,o,s,a,l,c,u,h,d,f,p,m,g,v,y,b,x,_,E,S,A,w,C,T,M,I,P,L,R,D,O=[],B=[],N=new Y.Vector3,U=new Y.Vector3,k=new Y.Vector3,F=new Y.Vector3,V=new Y.Vector3;for(i=0,n=this.vertices.length;i<n;i++)O[i]=new Y.Vector3,B[i]=new Y.Vector3;for(e=0,t=this.faces.length;e<t;e++)s=this.faces[e],a=this.faceVertexUvs[0][e],T=this,M=s.a,I=s.b,P=s.c,L=0,R=1,D=2,l=T.vertices[M],c=T.vertices[I],u=T.vertices[P],h=a[L],d=a[R],f=a[D],p=c.x-l.x,m=u.x-l.x,g=c.y-l.y,v=u.y-l.y,y=c.z-l.z,b=u.z-l.z,x=d.x-h.x,_=f.x-h.x,E=d.y-h.y,S=f.y-h.y,A=1/(x*S-_*E),N.set((S*p-E*m)*A,(S*g-E*v)*A,(S*y-E*b)*A),U.set((x*m-_*p)*A,(x*v-_*g)*A,(x*b-_*y)*A),O[M].add(N),O[I].add(N),O[P].add(N),B[M].add(U),B[I].add(U),B[P].add(U);var G=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(s=this.faces[e],r=0;r<Math.min(s.vertexNormals.length,3);r++)V.copy(s.vertexNormals[r]),o=s[G[r]],w=O[o],k.copy(w),k.sub(V.multiplyScalar(V.dot(w))).normalize(),F.crossVectors(s.vertexNormals[r],w),C=F.dot(B[o])<0?-1:1,s.vertexTangents[r]=new Y.Vector4(k.x,k.y,k.z,C);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,n=t.length;i<n;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Y.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Y.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e instanceof Y.Geometry!=!1){var n,r=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0];void 0===i&&(i=0),void 0!==t&&(n=(new Y.Matrix3).getNormalMatrix(t));for(var h=0,d=s.length;h<d;h++){var f=s[h].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(h=0,d=l.length;h<d;h++){var p,m,g,v=l[h],y=v.vertexNormals,b=v.vertexColors;(p=new Y.Face3(v.a+r,v.b+r,v.c+r)).normal.copy(v.normal),void 0!==n&&p.normal.applyMatrix3(n).normalize();for(var x=0,_=y.length;x<_;x++)m=y[x].clone(),void 0!==n&&m.applyMatrix3(n).normalize(),p.vertexNormals.push(m);p.color.copy(v.color);for(x=0,_=b.length;x<_;x++)g=b[x],p.vertexColors.push(g.clone());p.materialIndex=v.materialIndex+i,a.push(p)}for(h=0,d=u.length;h<d;h++){var E=u[h],S=[];if(void 0!==E){for(x=0,_=E.length;x<_;x++)S.push(E[x].clone());c.push(S)}}}else Y.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e instanceof Y.Mesh!=!1?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):Y.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,i,n,r,o,s,a,l={},c=[],u=[],h=Math.pow(10,4);for(i=0,n=this.vertices.length;i<n;i++)e=this.vertices[i],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=i,c.push(this.vertices[i]),u[i]=c.length-1):u[i]=u[l[t]];var d=[];for(i=0,n=this.faces.length;i<n;i++){(r=this.faces[i]).a=u[r.a],r.b=u[r.b],r.c=u[r.c],o=[r.a,r.b,r.c];for(var f=0;f<3;f++)if(o[f]==o[(f+1)%3]){f,d.push(i);break}}for(i=d.length-1;i>=0;i--){var p=d[i];for(this.faces.splice(p,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(p,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var n=[],r=0;r<this.vertices.length;r++){var o=this.vertices[r];n.push(o.x,o.y,o.z)}var s=[],a=[],l={},c=[],u={},h=[],d={};for(r=0;r<this.faces.length;r++){var f=this.faces[r],p=void 0!==this.faceVertexUvs[0][r],m=f.normal.length()>0,g=f.vertexNormals.length>0,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,b=0;if(b=S(b,0,0),b=S(b,1,!1),b=S(b,2,!1),b=S(b,3,p),b=S(b,4,m),b=S(b,5,g),b=S(b,6,v),b=S(b,7,y),s.push(b),s.push(f.a,f.b,f.c),p){var x=this.faceVertexUvs[0][r];s.push(C(x[0]),C(x[1]),C(x[2]))}if(m&&s.push(A(f.normal)),g){var _=f.vertexNormals;s.push(A(_[0]),A(_[1]),A(_[2]))}if(v&&s.push(w(f.color)),y){var E=f.vertexColors;s.push(w(E[0]),w(E[1]),w(E[2]))}}function S(e,t,i){return i?e|1<<t:e&~(1<<t)}function A(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=a.length/3,a.push(e.x,e.y,e.z)),l[t]}function w(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]||(u[t]=c.length,c.push(e.getHex())),u[t]}function C(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=h.length/2,h.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=n,e.data.normals=a,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=s,e},clone:function(){for(var e=new Y.Geometry,t=this.vertices,i=0,n=t.length;i<n;i++)e.vertices.push(t[i].clone());var r=this.faces;for(i=0,n=r.length;i<n;i++)e.faces.push(r[i].clone());for(i=0,n=this.faceVertexUvs.length;i<n;i++){var o=this.faceVertexUvs[i];void 0===e.faceVertexUvs[i]&&(e.faceVertexUvs[i]=[]);for(var s=0,a=o.length;s<a;s++){for(var l=o[s],c=[],u=0,h=l.length;u<h;u++){var d=l[u];c.push(d.clone())}e.faceVertexUvs[i].push(c)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Y.EventDispatcher.prototype.apply(Y.Geometry.prototype),Y.GeometryIdCount=0,Y.Camera=function(){Y.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Y.Matrix4,this.projectionMatrix=new Y.Matrix4},Y.Camera.prototype=Object.create(Y.Object3D.prototype),Y.Camera.prototype.constructor=Y.Camera,Y.Camera.prototype.getWorldDirection=function(){var e=new Y.Quaternion;return function(t){var i=t||new Y.Vector3;return this.getWorldQuaternion(e),i.set(0,0,-1).applyQuaternion(e)}}(),Y.Camera.prototype.lookAt=function(){var e=new Y.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),Y.Camera.prototype.clone=function(e){return void 0===e&&(e=new Y.Camera),Y.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},Y.CubeCamera=function(e,t,i){Y.Object3D.call(this),this.type="CubeCamera";var n=90,r=new Y.PerspectiveCamera(n,1,e,t);r.up.set(0,-1,0),r.lookAt(new Y.Vector3(1,0,0)),this.add(r);var o=new Y.PerspectiveCamera(n,1,e,t);o.up.set(0,-1,0),o.lookAt(new Y.Vector3(-1,0,0)),this.add(o);var s=new Y.PerspectiveCamera(n,1,e,t);s.up.set(0,0,1),s.lookAt(new Y.Vector3(0,1,0)),this.add(s);var a=new Y.PerspectiveCamera(n,1,e,t);a.up.set(0,0,-1),a.lookAt(new Y.Vector3(0,-1,0)),this.add(a);var l=new Y.PerspectiveCamera(n,1,e,t);l.up.set(0,-1,0),l.lookAt(new Y.Vector3(0,0,1)),this.add(l);var c=new Y.PerspectiveCamera(n,1,e,t);c.up.set(0,-1,0),c.lookAt(new Y.Vector3(0,0,-1)),this.add(c),this.renderTarget=new Y.WebGLRenderTargetCube(i,i,{format:Y.RGBFormat,magFilter:Y.LinearFilter,minFilter:Y.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,n=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,r,i),i.activeCubeFace=1,e.render(t,o,i),i.activeCubeFace=2,e.render(t,s,i),i.activeCubeFace=3,e.render(t,a,i),i.activeCubeFace=4,e.render(t,l,i),i.generateMipmaps=n,i.activeCubeFace=5,e.render(t,c,i)}},Y.CubeCamera.prototype=Object.create(Y.Object3D.prototype),Y.CubeCamera.prototype.constructor=Y.CubeCamera,Y.OrthographicCamera=function(e,t,i,n,r,o){Y.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},Y.OrthographicCamera.prototype=Object.create(Y.Camera.prototype),Y.OrthographicCamera.prototype.constructor=Y.OrthographicCamera,Y.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(i-e,i+e,n+t,n-t,this.near,this.far)},Y.OrthographicCamera.prototype.clone=function(){var e=new Y.OrthographicCamera;return Y.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},Y.PerspectiveCamera=function(e,t,i,n){Y.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},Y.PerspectiveCamera.prototype=Object.create(Y.Camera.prototype),Y.PerspectiveCamera.prototype.constructor=Y.PerspectiveCamera,Y.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*Y.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},Y.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,n,r,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=n,this.width=r,this.height=o,this.updateProjectionMatrix()},Y.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=Y.Math.radToDeg(2*Math.atan(Math.tan(.5*Y.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,i=Math.tan(Y.Math.degToRad(.5*e))*this.near,n=-i,r=t*n,o=t*i,s=Math.abs(o-r),a=Math.abs(i-n);this.projectionMatrix.makeFrustum(r+this.x*s/this.fullWidth,r+(this.x+this.width)*s/this.fullWidth,i-(this.y+this.height)*a/this.fullHeight,i-this.y*a/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},Y.PerspectiveCamera.prototype.clone=function(){var e=new Y.PerspectiveCamera;return Y.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},Y.Light=function(e){Y.Object3D.call(this),this.type="Light",this.color=new Y.Color(e)},Y.Light.prototype=Object.create(Y.Object3D.prototype),Y.Light.prototype.constructor=Y.Light,Y.Light.prototype.clone=function(e){return void 0===e&&(e=new Y.Light),Y.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},Y.AmbientLight=function(e){Y.Light.call(this,e),this.type="AmbientLight"},Y.AmbientLight.prototype=Object.create(Y.Light.prototype),Y.AmbientLight.prototype.constructor=Y.AmbientLight,Y.AmbientLight.prototype.clone=function(){var e=new Y.AmbientLight;return Y.Light.prototype.clone.call(this,e),e},Y.AreaLight=function(e,t){Y.Light.call(this,e),this.type="AreaLight",this.normal=new Y.Vector3(0,-1,0),this.right=new Y.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},Y.AreaLight.prototype=Object.create(Y.Light.prototype),Y.AreaLight.prototype.constructor=Y.AreaLight,Y.DirectionalLight=function(e,t){Y.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new Y.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new Y.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Y.DirectionalLight.prototype=Object.create(Y.Light.prototype),Y.DirectionalLight.prototype.constructor=Y.DirectionalLight,Y.DirectionalLight.prototype.clone=function(){var e=new Y.DirectionalLight;return Y.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},Y.HemisphereLight=function(e,t,i){Y.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new Y.Color(t),this.intensity=void 0!==i?i:1},Y.HemisphereLight.prototype=Object.create(Y.Light.prototype),Y.HemisphereLight.prototype.constructor=Y.HemisphereLight,Y.HemisphereLight.prototype.clone=function(){var e=new Y.HemisphereLight;return Y.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},Y.PointLight=function(e,t,i,n){Y.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1},Y.PointLight.prototype=Object.create(Y.Light.prototype),Y.PointLight.prototype.constructor=Y.PointLight,Y.PointLight.prototype.clone=function(){var e=new Y.PointLight;return Y.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e.decay=this.decay,e},Y.SpotLight=function(e,t,i,n,r,o){Y.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new Y.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.exponent=void 0!==r?r:10,this.decay=void 0!==o?o:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Y.SpotLight.prototype=Object.create(Y.Light.prototype),Y.SpotLight.prototype.constructor=Y.SpotLight,Y.SpotLight.prototype.clone=function(){var e=new Y.SpotLight;return Y.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.decay=this.decay,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},Y.Cache={files:{},add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Y.Loader=function(e){this.showStatus=e,this.statusDomElement=e?Y.Loader.prototype.addStatusElement():null,this.imageLoader=new Y.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},Y.Loader.prototype={constructor:Y.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var i=[],n=0;n<e.length;++n)i[n]=this.createMaterial(e[n],t);return i},needsTangents:function(e){for(var t=0,i=e.length;t<i;t++){if(e[t]instanceof Y.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){var i=this;function n(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function r(e,r,o,s,a,l,c){var u,h=t+o,d=Y.Loader.Handlers.get(h);if(null!==d?u=d.load(h):(u=new Y.Texture,(d=i.imageLoader).crossOrigin=i.crossOrigin,d.load(h,(function(e){if(!1===Y.Math.isPowerOfTwo(e.width)||!1===Y.Math.isPowerOfTwo(e.height)){var t=n(e.width),i=n(e.height),r=document.createElement("canvas");r.width=t,r.height=i,r.getContext("2d").drawImage(e,0,0,t,i),u.image=r}else u.image=e;u.needsUpdate=!0}))),u.sourceFile=o,s&&(u.repeat.set(s[0],s[1]),1!==s[0]&&(u.wrapS=Y.RepeatWrapping),1!==s[1]&&(u.wrapT=Y.RepeatWrapping)),a&&u.offset.set(a[0],a[1]),l){var f={repeat:Y.RepeatWrapping,mirror:Y.MirroredRepeatWrapping};void 0!==f[l[0]]&&(u.wrapS=f[l[0]]),void 0!==f[l[1]]&&(u.wrapT=f[l[1]])}c&&(u.anisotropy=c),e[r]=u}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s="MeshLambertMaterial",a={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?s="MeshPhongMaterial":"basic"===l&&(s="MeshBasicMaterial")}void 0!==e.blending&&void 0!==Y[e.blending]&&(a.blending=Y[e.blending]),void 0!==e.transparent&&(a.transparent=e.transparent),void 0!==e.opacity&&e.opacity<1&&(a.transparent=!0),void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.flipSided&&(a.side=Y.BackSide),void 0!==e.doubleSided&&(a.side=Y.DoubleSide),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?a.vertexColors=Y.FaceColors:e.vertexColors&&(a.vertexColors=Y.VertexColors)),e.colorDiffuse?a.color=o(e.colorDiffuse):e.DbgColor&&(a.color=e.DbgColor),e.colorSpecular&&(a.specular=o(e.colorSpecular)),e.colorEmissive&&(a.emissive=o(e.colorEmissive)),void 0!==e.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),e.opacity=e.transparency),void 0!==e.opacity&&(a.opacity=e.opacity),e.specularCoef&&(a.shininess=e.specularCoef),e.mapDiffuse&&t&&r(a,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&r(a,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&r(a,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&r(a,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&r(a,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&r(a,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(a.bumpScale=e.mapBumpScale),e.mapNormalFactor&&(a.normalScale=new Y.Vector2(e.mapNormalFactor,e.mapNormalFactor));var c=new Y[s](a);return void 0!==e.DbgName&&(c.name=e.DbgName),c}},Y.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var n=this.handlers[t],r=this.handlers[t+1];if(n.test(e))return r}return null}},Y.XHRLoader=function(e){this.manager=void 0!==e?e:Y.DefaultLoadingManager},Y.XHRLoader.prototype={constructor:Y.XHRLoader,load:function(e,t,i,n){var r=this,o=Y.Cache.get(e);if(void 0===o){var s=new XMLHttpRequest;s.open("GET",e,!0),s.addEventListener("load",(function(i){Y.Cache.add(e,this.response),t&&t(this.response),r.manager.itemEnd(e)}),!1),void 0!==i&&s.addEventListener("progress",(function(e){i(e)}),!1),void 0!==n&&s.addEventListener("error",(function(e){n(e)}),!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(s.responseType=this.responseType),s.send(null),r.manager.itemStart(e)}else t&&t(o)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},Y.ImageLoader=function(e){this.manager=void 0!==e?e:Y.DefaultLoadingManager},Y.ImageLoader.prototype={constructor:Y.ImageLoader,load:function(e,t,i,n){var r=this,o=Y.Cache.get(e);if(void 0===o){var s=document.createElement("img");return s.addEventListener("load",(function(i){Y.Cache.add(e,this),t&&t(this),r.manager.itemEnd(e)}),!1),void 0!==i&&s.addEventListener("progress",(function(e){i(e)}),!1),void 0!==n&&s.addEventListener("error",(function(e){n(e)}),!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.src=e,r.manager.itemStart(e),s}t(o)},setCrossOrigin:function(e){this.crossOrigin=e}},Y.JSONLoader=function(e){Y.Loader.call(this,e),this.withCredentials=!1},Y.JSONLoader.prototype=Object.create(Y.Loader.prototype),Y.JSONLoader.prototype.constructor=Y.JSONLoader,Y.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},Y.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,n,r){var o=new XMLHttpRequest,s=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var a=JSON.parse(o.responseText),l=a.metadata;if(void 0!==l){if("object"===l.type)return void Y.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===l.type)return void Y.error("THREE.JSONLoader: "+t+" seems to be a Scene. Use THREE.SceneLoader instead.")}var c=e.parse(a,n);i(c.geometry,c.materials)}else Y.error("THREE.JSONLoader: "+t+" seems to be unreachable or the file is empty.");e.onLoadComplete()}else Y.error("THREE.JSONLoader: Couldn't load "+t+" ("+o.status+")");else o.readyState===o.LOADING?r&&(0===s&&(s=o.getResponseHeader("Content-Length")),r({total:s,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==r&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},Y.JSONLoader.prototype.parse=function(e,t){var i=new Y.Geometry,n=void 0!==e.scale?1/e.scale:1;if(function(t){function n(e,t){return e&1<<t}var r,o,s,a,l,c,u,h,d,f,p,m,g,v,y,b,x,_,E,S,A,w,C,T,M,I,P,L=e.faces,R=e.vertices,D=e.normals,O=e.colors,B=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&B++;for(r=0;r<B;r++)i.faceVertexUvs[r]=[]}a=0,l=R.length;for(;a<l;)(_=new Y.Vector3).x=R[a++]*t,_.y=R[a++]*t,_.z=R[a++]*t,i.vertices.push(_);a=0,l=L.length;for(;a<l;)if(p=n(f=L[a++],0),m=n(f,1),g=n(f,3),v=n(f,4),y=n(f,5),b=n(f,6),x=n(f,7),p){if((S=new Y.Face3).a=L[a],S.b=L[a+1],S.c=L[a+3],(A=new Y.Face3).a=L[a+1],A.b=L[a+2],A.c=L[a+3],a+=4,m&&(d=L[a++],S.materialIndex=d,A.materialIndex=d),s=i.faces.length,g)for(r=0;r<B;r++)for(T=e.uvs[r],i.faceVertexUvs[r][s]=[],i.faceVertexUvs[r][s+1]=[],o=0;o<4;o++)I=T[2*(h=L[a++])],P=T[2*h+1],M=new Y.Vector2(I,P),2!==o&&i.faceVertexUvs[r][s].push(M),0!==o&&i.faceVertexUvs[r][s+1].push(M);if(v&&(u=3*L[a++],S.normal.set(D[u++],D[u++],D[u]),A.normal.copy(S.normal)),y)for(r=0;r<4;r++)u=3*L[a++],C=new Y.Vector3(D[u++],D[u++],D[u]),2!==r&&S.vertexNormals.push(C),0!==r&&A.vertexNormals.push(C);if(b&&(w=O[c=L[a++]],S.color.setHex(w),A.color.setHex(w)),x)for(r=0;r<4;r++)w=O[c=L[a++]],2!==r&&S.vertexColors.push(new Y.Color(w)),0!==r&&A.vertexColors.push(new Y.Color(w));i.faces.push(S),i.faces.push(A)}else{if((E=new Y.Face3).a=L[a++],E.b=L[a++],E.c=L[a++],m&&(d=L[a++],E.materialIndex=d),s=i.faces.length,g)for(r=0;r<B;r++)for(T=e.uvs[r],i.faceVertexUvs[r][s]=[],o=0;o<3;o++)I=T[2*(h=L[a++])],P=T[2*h+1],M=new Y.Vector2(I,P),i.faceVertexUvs[r][s].push(M);if(v&&(u=3*L[a++],E.normal.set(D[u++],D[u++],D[u])),y)for(r=0;r<3;r++)u=3*L[a++],C=new Y.Vector3(D[u++],D[u++],D[u]),E.vertexNormals.push(C);if(b&&(c=L[a++],E.color.setHex(O[c])),x)for(r=0;r<3;r++)c=L[a++],E.vertexColors.push(new Y.Color(O[c]));i.faces.push(E)}}(n),function(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,r=e.skinWeights.length;n<r;n+=t){var o=e.skinWeights[n],s=t>1?e.skinWeights[n+1]:0,a=t>2?e.skinWeights[n+2]:0,l=t>3?e.skinWeights[n+3]:0;i.skinWeights.push(new Y.Vector4(o,s,a,l))}if(e.skinIndices)for(n=0,r=e.skinIndices.length;n<r;n+=t){var c=e.skinIndices[n],u=t>1?e.skinIndices[n+1]:0,h=t>2?e.skinIndices[n+2]:0,d=t>3?e.skinIndices[n+3]:0;i.skinIndices.push(new Y.Vector4(c,u,h,d))}i.bones=e.bones,i.bones&&i.bones.length>0&&(i.skinWeights.length!==i.skinIndices.length||i.skinIndices.length!==i.vertices.length)&&Y.warn("THREE.JSONLoader: When skinning, number of vertices ("+i.vertices.length+"), skinIndices ("+i.skinIndices.length+"), and skinWeights ("+i.skinWeights.length+") should match.");i.animation=e.animation,i.animations=e.animations}(),function(t){var n,r,o,s,a,l,c,u,h,d,f;if(void 0!==e.morphTargets)for(a=0,l=e.morphTargets.length;a<l;a++)for(i.morphTargets[a]={},i.morphTargets[a].name=e.morphTargets[a].name,i.morphTargets[a].vertices=[],o=i.morphTargets[a].vertices,n=0,r=(s=e.morphTargets[a].vertices).length;n<r;n+=3){var p=new Y.Vector3;p.x=s[n]*t,p.y=s[n+1]*t,p.z=s[n+2]*t,o.push(p)}if(void 0!==e.morphColors)for(a=0,l=e.morphColors.length;a<l;a++)for(i.morphColors[a]={},i.morphColors[a].name=e.morphColors[a].name,i.morphColors[a].colors=[],h=i.morphColors[a].colors,c=0,u=(d=e.morphColors[a].colors).length;c<u;c+=3)(f=new Y.Color(16755200)).setRGB(d[c],d[c+1],d[c+2]),h.push(f)}(n),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:i};var r=this.initMaterials(e.materials,t);return this.needsTangents(r)&&i.computeTangents(),{geometry:i,materials:r}},Y.LoadingManager=function(e,t,i){var n=this,r=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++},this.itemEnd=function(e){r++,void 0!==n.onProgress&&n.onProgress(e,r,o),r===o&&void 0!==n.onLoad&&n.onLoad()}},Y.DefaultLoadingManager=new Y.LoadingManager,Y.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:Y.DefaultLoadingManager},Y.BufferGeometryLoader.prototype={constructor:Y.BufferGeometryLoader,load:function(e,t,i,n){var r=this,o=new Y.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,(function(e){t(r.parse(JSON.parse(e)))}),i,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new Y.BufferGeometry,i=e.data.attributes;for(var n in i){var r=i[n],o=new self[r.type](r.array);t.setAttribute(n,new Y.BufferAttribute(o,r.itemSize))}var s=e.data.offsets;void 0!==s&&(t.offsets=JSON.parse(JSON.stringify(s)));var a=e.data.boundingSphere;if(void 0!==a){var l=new Y.Vector3;void 0!==a.center&&l.fromArray(a.center),t.boundingSphere=new Y.Sphere(l,a.radius)}return t}},Y.MaterialLoader=function(e){this.manager=void 0!==e?e:Y.DefaultLoadingManager},Y.MaterialLoader.prototype={constructor:Y.MaterialLoader,load:function(e,t,i,n){var r=this,o=new Y.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,(function(e){t(r.parse(JSON.parse(e)))}),i,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new Y[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.materials)for(var i=0,n=e.materials.length;i<n;i++)t.materials.push(this.parse(e.materials[i]));return t}},Y.ObjectLoader=function(e){this.manager=void 0!==e?e:Y.DefaultLoadingManager,this.texturePath=""},Y.ObjectLoader.prototype={constructor:Y.ObjectLoader,load:function(e,t,i,n){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var r=this,o=new Y.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,(function(e){r.parse(JSON.parse(e),t)}),i,n)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=this.parseGeometries(e.geometries),n=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),r=this.parseTextures(e.textures,n),o=this.parseMaterials(e.materials,r),s=this.parseObject(e.object,i,o);return void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new Y.JSONLoader,n=new Y.BufferGeometryLoader,r=0,o=e.length;r<o;r++){var s,a=e[r];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Y[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new Y.BoxGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":s=new Y.CircleGeometry(a.radius,a.segments);break;case"CylinderGeometry":s=new Y.CylinderGeometry(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded);break;case"SphereGeometry":s=new Y.SphereGeometry(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"IcosahedronGeometry":s=new Y.IcosahedronGeometry(a.radius,a.detail);break;case"TorusGeometry":s=new Y.TorusGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":s=new Y.TorusKnotGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.p,a.q,a.heightScale);break;case"BufferGeometry":s=n.parse(a);break;case"Geometry":s=i.parse(a.data).geometry}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),t[a.uuid]=s}return t},parseMaterials:function(e,t){var i={};if(void 0!==e)for(var n=function(e){return void 0===t[e]&&Y.warn("THREE.ObjectLoader: Undefined texture",e),t[e]},r=new Y.MaterialLoader,o=0,s=e.length;o<s;o++){var a=e[o],l=r.parse(a);l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.map&&(l.map=n(a.map)),void 0!==a.bumpMap&&(l.bumpMap=n(a.bumpMap),a.bumpScale&&(l.bumpScale=new Y.Vector2(a.bumpScale,a.bumpScale))),void 0!==a.alphaMap&&(l.alphaMap=n(a.alphaMap)),void 0!==a.envMap&&(l.envMap=n(a.envMap)),void 0!==a.normalMap&&(l.normalMap=n(a.normalMap),a.normalScale&&(l.normalScale=new Y.Vector2(a.normalScale,a.normalScale))),void 0!==a.lightMap&&(l.lightMap=n(a.lightMap)),void 0!==a.specularMap&&(l.specularMap=n(a.specularMap)),i[a.uuid]=l}return i},parseImages:function(e,t){var i=this,n={};if(void 0!==e&&e.length>0){var r=new Y.LoadingManager(t),o=new Y.ImageLoader(r);o.setCrossOrigin(this.crossOrigin);for(var s=function(e){return i.manager.itemStart(e),o.load(e,(function(){i.manager.itemEnd(e)}))},a=0,l=e.length;a<l;a++){var c=e[a],u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:i.texturePath+c.url;n[c.uuid]=s(u)}}return n},parseTextures:function(e,t){var i={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var o=e[n];void 0===o.image&&Y.warn('THREE.ObjectLoader: No "image" speficied for',o.uuid),void 0===t[o.image]&&Y.warn("THREE.ObjectLoader: Undefined image",o.image);var s=new Y.Texture(t[o.image]);s.needsUpdate=!0,s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.repeat&&(s.repeat=new Y.Vector2(o.repeat[0],o.repeat[1])),void 0!==o.minFilter&&(s.minFilter=Y[o.minFilter]),void 0!==o.magFilter&&(s.magFilter=Y[o.magFilter]),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),o.wrap instanceof Array&&(s.wrapS=Y[o.wrap[0]],s.wrapT=Y[o.wrap[1]]),i[o.uuid]=s}return i},parseObject:function(){var e=new Y.Matrix4;return function(t,i,n){var r,o=function(e){return void 0===i[e]&&Y.warn("THREE.ObjectLoader: Undefined geometry",e),i[e]},s=function(e){return void 0===n[e]&&Y.warn("THREE.ObjectLoader: Undefined material",e),n[e]};switch(t.type){case"Scene":r=new Y.Scene;break;case"PerspectiveCamera":r=new Y.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":r=new Y.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":r=new Y.AmbientLight(t.color);break;case"DirectionalLight":r=new Y.DirectionalLight(t.color,t.intensity);break;case"PointLight":r=new Y.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":r=new Y.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":r=new Y.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":r=new Y.Mesh(o(t.geometry),s(t.material));break;case"Line":r=new Y.Line(o(t.geometry),s(t.material),t.mode);break;case"PointCloud":r=new Y.PointCloud(o(t.geometry),s(t.material));break;case"Sprite":r=new Y.Sprite(s(t.material));break;case"Group":r=new Y.Group;break;default:r=new Y.Object3D}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.children)for(var a in t.children)r.add(this.parseObject(t.children[a],i,n));return r}}()},Y.TextureLoader=function(e){this.manager=void 0!==e?e:Y.DefaultLoadingManager},Y.TextureLoader.prototype={constructor:Y.TextureLoader,load:function(e,t,i,n){var r=new Y.ImageLoader(this.manager);r.setCrossOrigin(this.crossOrigin),r.load(e,(function(e){var i=new Y.Texture(e);i.needsUpdate=!0,void 0!==t&&t(i)}),i,n)},setCrossOrigin:function(e){this.crossOrigin=e}},Y.DataTextureLoader=Y.BinaryTextureLoader=function(){this._parser=null},Y.BinaryTextureLoader.prototype={constructor:Y.BinaryTextureLoader,load:function(e,t,i,n){var r=this,o=new Y.DataTexture,s=new Y.XHRLoader;return s.setResponseType("arraybuffer"),s.load(e,(function(e){var i=r._parser(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:Y.ClampToEdgeWrapping,o.wrapT=void 0!==i.wrapT?i.wrapT:Y.ClampToEdgeWrapping,o.magFilter=void 0!==i.magFilter?i.magFilter:Y.LinearFilter,o.minFilter=void 0!==i.minFilter?i.minFilter:Y.LinearMipMapLinearFilter,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=Y.LinearFilter),o.needsUpdate=!0,t&&t(o,i))}),i,n),o}},Y.CompressedTextureLoader=function(){this._parser=null},Y.CompressedTextureLoader.prototype={constructor:Y.CompressedTextureLoader,load:function(e,t,i){var n=this,r=[],o=new Y.CompressedTexture;o.image=r;var s=new Y.XHRLoader;if(s.setResponseType("arraybuffer"),e instanceof Array)for(var a=0,l=function(i){s.load(e[i],(function(e){var s=n._parser(e,!0);r[i]={width:s.width,height:s.height,format:s.format,mipmaps:s.mipmaps},6===(a+=1)&&(1==s.mipmapCount&&(o.minFilter=Y.LinearFilter),o.format=s.format,o.needsUpdate=!0,t&&t(o))}))},c=0,u=e.length;c<u;++c)l(c);else s.load(e,(function(e){var i=n._parser(e,!0);if(i.isCubemap)for(var s=i.mipmaps.length/i.mipmapCount,a=0;a<s;a++){r[a]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)r[a].mipmaps.push(i.mipmaps[a*i.mipmapCount+l]),r[a].format=i.format,r[a].width=i.width,r[a].height=i.height}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=Y.LinearFilter),o.format=i.format,o.needsUpdate=!0,t&&t(o)}));return o}},Y.Material=function(){Object.defineProperty(this,"id",{value:Y.MaterialIdCount++}),this.uuid=Y.Math.generateUUID(),this.name="",this.type="Material",this.side=Y.FrontSide,this.opacity=1,this.transparent=!1,this.blending=Y.NormalBlending,this.blendSrc=Y.SrcAlphaFactor,this.blendDst=Y.OneMinusSrcAlphaFactor,this.blendEquation=Y.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0,this._uniformsNeedUpdate=!0},Y.Material.prototype={constructor:Y.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},get uniformsNeedUpdate(){return this._uniformsNeedUpdate},set uniformsNeedUpdate(e){!0===e&&this.update(),this._uniformsNeedUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){if(t in this){var n=this[t];n instanceof Y.Color?n.set(i):n instanceof Y.Vector3&&i instanceof Y.Vector3?n.copy(i):this[t]="overdraw"==t?Number(i):i}}else Y.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(e.name=this.name),this instanceof Y.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==Y.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==Y.NormalBlending&&(e.blending=this.blending),this.side!==Y.FrontSide&&(e.side=this.side)):this instanceof Y.MeshLambertMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==Y.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==Y.SmoothShading&&(e.shading=this.shading),this.blending!==Y.NormalBlending&&(e.blending=this.blending),this.side!==Y.FrontSide&&(e.side=this.side)):this instanceof Y.MeshPhongMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==Y.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==Y.SmoothShading&&(e.shading=this.shading),this.blending!==Y.NormalBlending&&(e.blending=this.blending),this.side!==Y.FrontSide&&(e.side=this.side)):this instanceof Y.MeshNormalMaterial||this instanceof Y.MeshDepthMaterial?(this.blending!==Y.NormalBlending&&(e.blending=this.blending),this.side!==Y.FrontSide&&(e.side=this.side)):this instanceof Y.PointCloudMaterial?(e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.color=this.color.getHex(),this.vertexColors!==Y.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==Y.NormalBlending&&(e.blending=this.blending)):this instanceof Y.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof Y.SpriteMaterial&&(e.color=this.color.getHex()),this.opacity<1&&(e.opacity=this.opacity),!1!==this.transparent&&(e.transparent=this.transparent),!1!==this.wireframe&&(e.wireframe=this.wireframe),e},clone:function(e){return void 0===e&&(e=new Y.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.blendSrcAlpha=this.blendSrcAlpha,e.blendDstAlpha=this.blendDstAlpha,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Y.EventDispatcher.prototype.apply(Y.Material.prototype),Y.MaterialIdCount=0,Y.LineBasicMaterial=function(e){Y.Material.call(this),this.type="LineBasicMaterial",this.color=new Y.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=Y.NoColors,this.fog=!0,this.setValues(e)},Y.LineBasicMaterial.prototype=Object.create(Y.Material.prototype),Y.LineBasicMaterial.prototype.constructor=Y.LineBasicMaterial,Y.LineBasicMaterial.prototype.clone=function(){var e=new Y.LineBasicMaterial;return Y.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Y.LineDashedMaterial=function(e){Y.Material.call(this),this.type="LineDashedMaterial",this.color=new Y.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},Y.LineDashedMaterial.prototype=Object.create(Y.Material.prototype),Y.LineDashedMaterial.prototype.constructor=Y.LineDashedMaterial,Y.LineDashedMaterial.prototype.clone=function(){var e=new Y.LineDashedMaterial;return Y.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Y.MeshBasicMaterial=function(e){Y.Material.call(this),this.type="MeshBasicMaterial",this.color=new Y.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Y.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Y.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},Y.MeshBasicMaterial.prototype=Object.create(Y.Material.prototype),Y.MeshBasicMaterial.prototype.constructor=Y.MeshBasicMaterial,Y.MeshBasicMaterial.prototype.clone=function(){var e=new Y.MeshBasicMaterial;return Y.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},Y.MeshLambertMaterial=function(e){Y.Material.call(this),this.type="MeshLambertMaterial",this.color=new Y.Color(16777215),this.emissive=new Y.Color(0),this.wrapAround=!1,this.wrapRGB=new Y.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Y.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Y.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},Y.MeshLambertMaterial.prototype=Object.create(Y.Material.prototype),Y.MeshLambertMaterial.prototype.constructor=Y.MeshLambertMaterial,Y.MeshLambertMaterial.prototype.clone=function(){var e=new Y.MeshLambertMaterial;return Y.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Y.MeshPhongMaterial=function(e){Y.Material.call(this),this.type="MeshPhongMaterial",this.color=new Y.Color(16777215),this.emissive=new Y.Color(0),this.specular=new Y.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new Y.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Y.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Y.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Y.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},Y.MeshPhongMaterial.prototype=Object.create(Y.Material.prototype),Y.MeshPhongMaterial.prototype.constructor=Y.MeshPhongMaterial,Y.MeshPhongMaterial.prototype.clone=function(){var e=new Y.MeshPhongMaterial;return Y.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Y.MeshDepthMaterial=function(e){Y.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},Y.MeshDepthMaterial.prototype=Object.create(Y.Material.prototype),Y.MeshDepthMaterial.prototype.constructor=Y.MeshDepthMaterial,Y.MeshDepthMaterial.prototype.clone=function(){var e=new Y.MeshDepthMaterial;return Y.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},Y.MeshNormalMaterial=function(e){Y.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},Y.MeshNormalMaterial.prototype=Object.create(Y.Material.prototype),Y.MeshNormalMaterial.prototype.constructor=Y.MeshNormalMaterial,Y.MeshNormalMaterial.prototype.clone=function(){var e=new Y.MeshNormalMaterial;return Y.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},Y.MeshFaceMaterial=function(e){this.uuid=Y.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=e instanceof Array?e:[]},Y.MeshFaceMaterial.prototype={constructor:Y.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,i=this.materials.length;t<i;t++)e.materials.push(this.materials[t].toJSON());return e},clone:function(){for(var e=new Y.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e}},Y.PointCloudMaterial=function(e){Y.Material.call(this),this.type="PointCloudMaterial",this.color=new Y.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=Y.NoColors,this.fog=!0,this.setValues(e)},Y.PointCloudMaterial.prototype=Object.create(Y.Material.prototype),Y.PointCloudMaterial.prototype.constructor=Y.PointCloudMaterial,Y.PointCloudMaterial.prototype.clone=function(){var e=new Y.PointCloudMaterial;return Y.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,this.defines&&(e.defines=Object.assign({},this.defines)),e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Y.ParticleBasicMaterial=function(e){return Y.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new Y.PointCloudMaterial(e)},Y.ParticleSystemMaterial=function(e){return Y.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new Y.PointCloudMaterial(e)},Y.ShaderMaterial=function(e){Y.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=Y.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=Y.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},Y.ShaderMaterial.prototype=Object.create(Y.Material.prototype),Y.ShaderMaterial.prototype.constructor=Y.ShaderMaterial,Y.ShaderMaterial.prototype.clone=function(){var e=new Y.ShaderMaterial;return Y.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=Y.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Y.RawShaderMaterial=function(e){Y.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},Y.RawShaderMaterial.prototype=Object.create(Y.ShaderMaterial.prototype),Y.RawShaderMaterial.prototype.constructor=Y.RawShaderMaterial,Y.RawShaderMaterial.prototype.clone=function(){var e=new Y.RawShaderMaterial;return Y.ShaderMaterial.prototype.clone.call(this,e),e},Y.SpriteMaterial=function(e){Y.Material.call(this),this.type="SpriteMaterial",this.color=new Y.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},Y.SpriteMaterial.prototype=Object.create(Y.Material.prototype),Y.SpriteMaterial.prototype.constructor=Y.SpriteMaterial,Y.SpriteMaterial.prototype.clone=function(){var e=new Y.SpriteMaterial;return Y.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},Y.Texture=function(e,t,i,n,r,o,s,a,l){Object.defineProperty(this,"id",{value:Y.TextureIdCount++}),this.uuid=Y.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:Y.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Y.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:Y.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:Y.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:Y.LinearFilter,this.minFilter=void 0!==o?o:Y.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:Y.RGBAFormat,this.type=void 0!==a?a:Y.UnsignedByteType,this.offset=new Y.Vector2(0,0),this.repeat=new Y.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},Y.Texture.DEFAULT_IMAGE=void 0,Y.Texture.DEFAULT_MAPPING=Y.UVMapping,Y.Texture.prototype={constructor:Y.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new Y.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Y.EventDispatcher.prototype.apply(Y.Texture.prototype),Y.TextureIdCount=0,Y.CubeTexture=function(e,t,i,n,r,o,s,a,l){t=void 0!==t?t:Y.CubeReflectionMapping,Y.Texture.call(this,e,t,i,n,r,o,s,a,l),this.images=e},Y.CubeTexture.prototype=Object.create(Y.Texture.prototype),Y.CubeTexture.prototype.constructor=Y.CubeTexture,Y.CubeTexture.clone=function(e){return void 0===e&&(e=new Y.CubeTexture),Y.Texture.prototype.clone.call(this,e),e.images=this.images,e},Y.CompressedTexture=function(e,t,i,n,r,o,s,a,l,c,u){Y.Texture.call(this,null,o,s,a,l,c,n,r,u),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},Y.CompressedTexture.prototype=Object.create(Y.Texture.prototype),Y.CompressedTexture.prototype.constructor=Y.CompressedTexture,Y.CompressedTexture.prototype.clone=function(){var e=new Y.CompressedTexture;return Y.Texture.prototype.clone.call(this,e),e},Y.DataTexture=function(e,t,i,n,r,o,s,a,l,c,u){Y.Texture.call(this,null,o,s,a,l,c,n,r,u),this.image={data:e,width:t,height:i}},Y.DataTexture.prototype=Object.create(Y.Texture.prototype),Y.DataTexture.prototype.constructor=Y.DataTexture,Y.DataTexture.prototype.clone=function(){var e=new Y.DataTexture;return Y.Texture.prototype.clone.call(this,e),e},Y.VideoTexture=function(e,t,i,n,r,o,s,a,l){Y.Texture.call(this,e,t,i,n,r,o,s,a,l),this.generateMipmaps=!1;var c=this,u=function(){requestAnimationFrame(u),e.readyState===e.HAVE_ENOUGH_DATA&&(c.needsUpdate=!0)};u()},Y.VideoTexture.prototype=Object.create(Y.Texture.prototype),Y.VideoTexture.prototype.constructor=Y.VideoTexture,Y.Group=function(){Y.Object3D.call(this),this.type="Group"},Y.Group.prototype=Object.create(Y.Object3D.prototype),Y.Group.prototype.constructor=Y.Group,Y.PointCloud=function(e,t){Y.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==e?e:new Y.Geometry,this.material=void 0!==t?t:new Y.PointCloudMaterial({color:16777215*Math.random()})},Y.PointCloud.prototype=Object.create(Y.Object3D.prototype),Y.PointCloud.prototype.constructor=Y.PointCloud,Y.PointCloud.prototype.raycast=(M=new Y.Matrix4,I=new Y.Ray,function(e,t){var i=this,n=i.geometry,r=e.params.PointCloud.threshold;if(M.getInverse(this.matrixWorld),I.copy(e.ray).applyMatrix4(M),null===n.boundingBox||!1!==I.isIntersectionBox(n.boundingBox)){var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=new Y.Vector3,a=function(n,r){var s=I.distanceToPoint(n);if(s<o){var a=I.closestPointToPoint(n);a.applyMatrix4(i.matrixWorld);var l=e.ray.origin.distanceTo(a);t.push({distance:l,distanceToRay:s,point:a.clone(),index:r,face:null,object:i})}};if(n instanceof Y.BufferGeometry){var l=n.attributes,c=l.position.array;if(void 0!==l.index){var u=l.index.array,h=n.offsets;0===h.length&&(h=[{start:0,count:u.length,index:0}]);for(var d=0,f=h.length;d<f;++d)for(var p=h[d].start,m=h[d].count,g=h[d].index,v=p,y=p+m;v<y;v++){var b=g+u[v];s.fromArray(c,3*b),a(s,b)}}else{var x=c.length/3;for(v=0;v<x;v++)s.set(c[3*v],c[3*v+1],c[3*v+2]),a(s,v)}}else{var _=this.geometry.vertices;for(v=0;v<_.length;v++)a(_[v],v)}}}),Y.PointCloud.prototype.clone=function(e){return void 0===e&&(e=new Y.PointCloud(this.geometry,this.material)),Y.Object3D.prototype.clone.call(this,e),e},Y.ParticleSystem=function(e,t){return Y.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new Y.PointCloud(e,t)},Y.Line=function(e,t,i){Y.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new Y.Geometry,this.material=void 0!==t?t:new Y.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==i?i:Y.LineStrip},Y.LineStrip=0,Y.LinePieces=1,Y.Line.prototype=Object.create(Y.Object3D.prototype),Y.Line.prototype.constructor=Y.Line,Y.Line.prototype.raycast=function(){var e=new Y.Matrix4,t=new Y.Ray,i=new Y.Sphere;return function(n,r){var o=n.linePrecision,s=o*o,a=this.geometry;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(this.matrixWorld),!1!==n.ray.isIntersectionSphere(i)){e.getInverse(this.matrixWorld),t.copy(n.ray).applyMatrix4(e);var l=new Y.Vector3,c=new Y.Vector3,u=new Y.Vector3,h=new Y.Vector3,d=this.mode===Y.LineStrip?1:2;if(a instanceof Y.BufferGeometry){var f=a.attributes;if(void 0!==f.index){var p=f.index.array,m=f.position.array,g=a.offsets;0===g.length&&(g=[{start:0,count:p.length,index:0}]);for(var v=0;v<g.length;v++)for(var y=g[v].start,b=g[v].count,x=g[v].index,_=y;_<y+b-1;_+=d){var E=x+p[_],S=x+p[_+1];if(l.fromArray(m,3*E),c.fromArray(m,3*S),!(t.distanceSqToSegment(l,c,h,u)>s))(C=t.origin.distanceTo(h))<n.near||C>n.far||r.push({distance:C,point:u.clone().applyMatrix4(this.matrixWorld),index:_,offsetIndex:v,face:null,faceIndex:null,object:this})}}else for(m=f.position.array,_=0;_<m.length/3-1;_+=d){if(l.fromArray(m,3*_),c.fromArray(m,3*_+3),!(t.distanceSqToSegment(l,c,h,u)>s))(C=t.origin.distanceTo(h))<n.near||C>n.far||r.push({distance:C,point:u.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else if(a instanceof Y.Geometry){var A=a.vertices,w=A.length;for(_=0;_<w-1;_+=d){var C;if(!(t.distanceSqToSegment(A[_],A[_+1],h,u)>s))(C=t.origin.distanceTo(h))<n.near||C>n.far||r.push({distance:C,point:u.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}}(),Y.Line.prototype.clone=function(e){return void 0===e&&(e=new Y.Line(this.geometry,this.material,this.mode)),Y.Object3D.prototype.clone.call(this,e),e},Y.Mesh=function(e,t){Y.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Y.Geometry,this.material=void 0!==t?t:new Y.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},Y.Mesh.prototype=Object.create(Y.Object3D.prototype),Y.Mesh.prototype.constructor=Y.Mesh,Y.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},Y.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(Y.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},Y.Mesh.prototype.raycast=function(){var e=new Y.Matrix4,t=new Y.Ray,i=new Y.Sphere,n=new Y.Vector3,r=new Y.Vector3,o=new Y.Vector3;return function(s,a){var l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),i.copy(l.boundingSphere),i.applyMatrix4(this.matrixWorld),!1!==s.ray.isIntersectionSphere(i)&&(e.getInverse(this.matrixWorld),t.copy(s.ray).applyMatrix4(e),null===l.boundingBox||!1!==t.isIntersectionBox(l.boundingBox)))if(l instanceof Y.BufferGeometry){if(void 0===(L=this.material))return;var c=l.attributes,u=s.precision;if(void 0!==c.index){var h=c.index.array,d=c.position.array,f=l.offsets;0===f.length&&(f=[{start:0,count:h.length,index:0}]);for(var p=0,m=f.length;p<m;++p)for(var g=f[p].start,v=f[p].count,y=f[p].index,b=g,x=g+v;b<x;b+=3){if(S=y+h[b],A=y+h[b+1],w=y+h[b+2],n.fromArray(d,3*S),r.fromArray(d,3*A),o.fromArray(d,3*w),L.side===Y.BackSide)var _=t.intersectTriangle(o,r,n,!0);else _=t.intersectTriangle(n,r,o,L.side!==Y.DoubleSide);if(null!==_)_.applyMatrix4(this.matrixWorld),(F=s.ray.origin.distanceTo(_))<u||F<s.near||F>s.far||a.push({distance:F,point:_,face:new Y.Face3(S,A,w,Y.Triangle.normal(n,r,o)),faceIndex:null,object:this})}}else{b=0;var E=0;for(x=(d=c.position.array).length;b<x;b+=3,E+=9){if(S=b,A=b+1,w=b+2,n.fromArray(d,E),r.fromArray(d,E+3),o.fromArray(d,E+6),L.side===Y.BackSide)_=t.intersectTriangle(o,r,n,!0);else _=t.intersectTriangle(n,r,o,L.side!==Y.DoubleSide);if(null!==_)_.applyMatrix4(this.matrixWorld),(F=s.ray.origin.distanceTo(_))<u||F<s.near||F>s.far||a.push({distance:F,point:_,face:new Y.Face3(S,A,w,Y.Triangle.normal(n,r,o)),faceIndex:null,object:this})}}}else if(l instanceof Y.Geometry)for(var S,A,w,C=this.material instanceof Y.MeshFaceMaterial,T=!0===C?this.material.materials:null,M=(u=s.precision,l.vertices),I=0,P=l.faces.length;I<P;I++){var L,R=l.faces[I];if(void 0!==(L=!0===C?T[R.materialIndex]:this.material)){if(S=M[R.a],A=M[R.b],w=M[R.c],!0===L.morphTargets){var D=l.morphTargets,O=this.morphTargetInfluences;n.set(0,0,0),r.set(0,0,0),o.set(0,0,0);for(var B=0,N=D.length;B<N;B++){var U=O[B];if(0!==U){var k=D[B].vertices;n.x+=(k[R.a].x-S.x)*U,n.y+=(k[R.a].y-S.y)*U,n.z+=(k[R.a].z-S.z)*U,r.x+=(k[R.b].x-A.x)*U,r.y+=(k[R.b].y-A.y)*U,r.z+=(k[R.b].z-A.z)*U,o.x+=(k[R.c].x-w.x)*U,o.y+=(k[R.c].y-w.y)*U,o.z+=(k[R.c].z-w.z)*U}}n.add(S),r.add(A),o.add(w),S=n,A=r,w=o}if(L.side===Y.BackSide)_=t.intersectTriangle(w,A,S,!0);else _=t.intersectTriangle(S,A,w,L.side!==Y.DoubleSide);var F;if(null!==_)_.applyMatrix4(this.matrixWorld),(F=s.ray.origin.distanceTo(_))<u||F<s.near||F>s.far||a.push({distance:F,point:_,face:R,faceIndex:I,object:this})}}}}(),Y.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new Y.Mesh(this.geometry,this.material)),Y.Object3D.prototype.clone.call(this,e,t),e},Y.Bone=function(e){Y.Object3D.call(this),this.type="Bone",this.skin=e},Y.Bone.prototype=Object.create(Y.Object3D.prototype),Y.Bone.prototype.constructor=Y.Bone,Y.Skeleton=function(e,t,i){var n;(this.useVertexTexture=void 0===i||i,this.identityMatrix=new Y.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture)?(n=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=n,this.boneTextureHeight=n,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new Y.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,Y.RGBAFormat,Y.FloatType),this.boneTexture.minFilter=Y.NearestFilter,this.boneTexture.magFilter=Y.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{Y.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var r=0,o=this.bones.length;r<o;r++)this.boneInverses.push(new Y.Matrix4)}},Y.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new Y.Matrix4;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},Y.Skeleton.prototype.pose=function(){for(var e,t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},Y.Skeleton.prototype.update=(P=new Y.Matrix4,function(){for(var e=0,t=this.bones.length;e<t;e++){var i=this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix;P.multiplyMatrices(i,this.boneInverses[e]),P.flattenToArrayOffset(this.boneMatrices,16*e)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),Y.SkinnedMesh=function(e,t,i){Y.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Y.Matrix4,this.bindMatrixInverse=new Y.Matrix4;var n=[];if(this.geometry&&void 0!==this.geometry.bones){for(var r,o,s,a,l,c=0,u=this.geometry.bones.length;c<u;++c)s=(o=this.geometry.bones[c]).pos,a=o.rotq,l=o.scl,r=new Y.Bone(this),n.push(r),r.name=o.name,r.position.set(s[0],s[1],s[2]),r.quaternion.set(a[0],a[1],a[2],a[3]),void 0!==l?r.scale.set(l[0],l[1],l[2]):r.scale.set(1,1,1);for(c=0,u=this.geometry.bones.length;c<u;++c)-1!==(o=this.geometry.bones[c]).parent?n[o.parent].add(n[c]):this.add(n[c])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new Y.Skeleton(n,void 0,i))},Y.SkinnedMesh.prototype=Object.create(Y.Mesh.prototype),Y.SkinnedMesh.prototype.constructor=Y.SkinnedMesh,Y.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},Y.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},Y.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof Y.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();i!==1/0?t.multiplyScalar(i):t.set(1)}},Y.SkinnedMesh.prototype.updateMatrixWorld=function(e){Y.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):Y.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},Y.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new Y.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),Y.Mesh.prototype.clone.call(this,e),e},Y.MorphAnimMesh=function(e,t){Y.Mesh.call(this,e,t),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},Y.MorphAnimMesh.prototype=Object.create(Y.Mesh.prototype),Y.MorphAnimMesh.prototype.constructor=Y.MorphAnimMesh,Y.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},Y.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},Y.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},Y.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,n=/([a-z]+)_?(\d+)/,r=0,o=e.morphTargets.length;r<o;r++){var s=e.morphTargets[r].name.match(n);if(s&&s.length>1){var a=s[1];i[a]||(i[a]={start:1/0,end:-1/0});var l=i[a];r<l.start&&(l.start=r),r>l.end&&(l.end=r),t||(t=a)}}e.firstAnimation=t},Y.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},Y.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=(i.end-i.start)/t*1e3,this.time=0):Y.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")},Y.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var i=this.startKeyframe+Y.Math.clamp(Math.floor(this.time/t),0,this.length-1);i!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[i]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=i);var n=this.time%t/t;this.directionBackwards&&(n=1-n),this.morphTargetInfluences[this.currentKeyframe]=n,this.morphTargetInfluences[this.lastKeyframe]=1-n},Y.MorphAnimMesh.prototype.interpolateTargets=function(e,t,i){for(var n=this.morphTargetInfluences,r=0,o=n.length;r<o;r++)n[r]=0;e>-1&&(n[e]=1-i),t>-1&&(n[t]=i)},Y.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new Y.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,Y.Mesh.prototype.clone.call(this,e),e},Y.LOD=function(){Y.Object3D.call(this),this.objects=[]},Y.LOD.prototype=Object.create(Y.Object3D.prototype),Y.LOD.prototype.constructor=Y.LOD,Y.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=0;i<this.objects.length&&!(t<this.objects[i].distance);i++);this.objects.splice(i,0,{distance:t,object:e}),this.add(e)},Y.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;t<i&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},Y.LOD.prototype.raycast=(L=new Y.Vector3,function(e,t){L.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(L);this.getObjectForDistance(i).raycast(e,t)}),Y.LOD.prototype.update=function(){var e=new Y.Vector3,t=new Y.Vector3;return function(i){if(this.objects.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);this.objects[0].object.visible=!0;for(var r=1,o=this.objects.length;r<o&&n>=this.objects[r].distance;r++)this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0;for(;r<o;r++)this.objects[r].object.visible=!1}}}(),Y.LOD.prototype.clone=function(e){void 0===e&&(e=new Y.LOD),Y.Object3D.prototype.clone.call(this,e);for(var t=0,i=this.objects.length;t<i;t++){var n=this.objects[t].object.clone();n.visible=0===t,e.addLevel(n,this.objects[t].distance)}return e},Y.Sprite=(R=new Uint16Array([0,1,2,0,2,3]),D=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),O=new Float32Array([0,0,1,0,1,1,0,1]),(B=new Y.BufferGeometry).setAttribute("index",new Y.BufferAttribute(R,1)),B.setAttribute("position",new Y.BufferAttribute(D,3)),B.setAttribute("uv",new Y.BufferAttribute(O,2)),function(e){Y.Object3D.call(this),this.type="Sprite",this.geometry=B,this.material=void 0!==e?e:new Y.SpriteMaterial}),Y.Sprite.prototype=Object.create(Y.Object3D.prototype),Y.Sprite.prototype.constructor=Y.Sprite,Y.Sprite.prototype.raycast=function(){var e=new Y.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.distanceToPoint(e);n>this.scale.x||i.push({distance:n,point:this.position,face:null,object:this})}}(),Y.Sprite.prototype.clone=function(e){return void 0===e&&(e=new Y.Sprite(this.material)),Y.Object3D.prototype.clone.call(this,e),e},Y.Particle=Y.Sprite,Y.LensFlare=function(e,t,i,n,r){Y.Object3D.call(this),this.lensFlares=[],this.positionScreen=new Y.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,n,r)},Y.LensFlare.prototype=Object.create(Y.Object3D.prototype),Y.LensFlare.prototype.constructor=Y.LensFlare,Y.LensFlare.prototype.add=function(e,t,i,n,r,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=new Y.Color(16777215)),void 0===n&&(n=Y.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:r,blending:n})},Y.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;e<i;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},Y.Scene=function(){Y.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},Y.Scene.prototype=Object.create(Y.Object3D.prototype),Y.Scene.prototype.constructor=Y.Scene,Y.Scene.prototype.clone=function(e){return void 0===e&&(e=new Y.Scene),Y.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},Y.Fog=function(e,t,i){this.name="",this.color=new Y.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},Y.Fog.prototype.clone=function(){return new Y.Fog(this.color.getHex(),this.near,this.far)},Y.FogExp2=function(e,t){this.name="",this.color=new Y.Color(e),this.density=void 0!==t?t:25e-5},Y.FogExp2.prototype.clone=function(){return new Y.FogExp2(this.color.getHex(),this.density)},Y.ShaderChunk={},Y.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n",Y.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",Y.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n",Y.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n",Y.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",Y.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",Y.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n",Y.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",Y.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif",Y.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n",Y.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",Y.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif",Y.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",Y.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",Y.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",Y.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n",Y.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif",Y.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",Y.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif",Y.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif",Y.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif",Y.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",Y.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",Y.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif",Y.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",Y.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",Y.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n",Y.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",Y.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n",Y.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",Y.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",Y.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",Y.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",Y.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",Y.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",Y.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",Y.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",Y.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",Y.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n",Y.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",Y.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",Y.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif",Y.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",Y.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",Y.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif",Y.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",Y.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n",Y.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n",Y.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif",Y.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",Y.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif",Y.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",Y.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",Y.UniformsUtils={merge:function(e){for(var t={},i=0;i<e.length;i++){var n=this.clone(e[i]);for(var r in n)t[r]=n[r]}return t},clone:function(e){var t={};for(var i in e)for(var n in t[i]={},e[i]){var r=e[i][n];r instanceof Y.Color||r instanceof Y.Vector2||r instanceof Y.Vector3||r instanceof Y.Vector4||r instanceof Y.Matrix4||r instanceof Y.Texture?t[i][n]=r.clone():t[i][n]=r instanceof Array?r.slice():r}return t}},Y.UniformsLib={common:{diffuse:{type:"c",value:new Y.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new Y.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new Y.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Y.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new Y.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new Y.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Y.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},Y.ShaderLib={basic:{uniforms:Y.UniformsUtils.merge([Y.UniformsLib.common,Y.UniformsLib.fog,Y.UniformsLib.shadowmap]),vertexShader:[Y.ShaderChunk.common,Y.ShaderChunk.map_pars_vertex,Y.ShaderChunk.lightmap_pars_vertex,Y.ShaderChunk.envmap_pars_vertex,Y.ShaderChunk.color_pars_vertex,Y.ShaderChunk.morphtarget_pars_vertex,Y.ShaderChunk.skinning_pars_vertex,Y.ShaderChunk.shadowmap_pars_vertex,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Y.ShaderChunk.map_vertex,Y.ShaderChunk.lightmap_vertex,Y.ShaderChunk.color_vertex,Y.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",Y.ShaderChunk.morphnormal_vertex,Y.ShaderChunk.skinnormal_vertex,Y.ShaderChunk.defaultnormal_vertex,"\t#endif",Y.ShaderChunk.morphtarget_vertex,Y.ShaderChunk.skinning_vertex,Y.ShaderChunk.default_vertex,Y.ShaderChunk.logdepthbuf_vertex,Y.ShaderChunk.worldpos_vertex,Y.ShaderChunk.envmap_vertex,Y.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",Y.ShaderChunk.common,Y.ShaderChunk.color_pars_fragment,Y.ShaderChunk.map_pars_fragment,Y.ShaderChunk.alphamap_pars_fragment,Y.ShaderChunk.lightmap_pars_fragment,Y.ShaderChunk.envmap_pars_fragment,Y.ShaderChunk.fog_pars_fragment,Y.ShaderChunk.shadowmap_pars_fragment,Y.ShaderChunk.specularmap_pars_fragment,Y.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",Y.ShaderChunk.logdepthbuf_fragment,Y.ShaderChunk.map_fragment,Y.ShaderChunk.color_fragment,Y.ShaderChunk.alphamap_fragment,Y.ShaderChunk.alphatest_fragment,Y.ShaderChunk.specularmap_fragment,"\toutgoingLight = diffuseColor.rgb;",Y.ShaderChunk.lightmap_fragment,Y.ShaderChunk.envmap_fragment,Y.ShaderChunk.shadowmap_fragment,Y.ShaderChunk.linear_to_gamma_fragment,Y.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:Y.UniformsUtils.merge([Y.UniformsLib.common,Y.UniformsLib.fog,Y.UniformsLib.lights,Y.UniformsLib.shadowmap,{emissive:{type:"c",value:new Y.Color(0)},wrapRGB:{type:"v3",value:new Y.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Y.ShaderChunk.common,Y.ShaderChunk.map_pars_vertex,Y.ShaderChunk.lightmap_pars_vertex,Y.ShaderChunk.envmap_pars_vertex,Y.ShaderChunk.lights_lambert_pars_vertex,Y.ShaderChunk.color_pars_vertex,Y.ShaderChunk.morphtarget_pars_vertex,Y.ShaderChunk.skinning_pars_vertex,Y.ShaderChunk.shadowmap_pars_vertex,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Y.ShaderChunk.map_vertex,Y.ShaderChunk.lightmap_vertex,Y.ShaderChunk.color_vertex,Y.ShaderChunk.morphnormal_vertex,Y.ShaderChunk.skinbase_vertex,Y.ShaderChunk.skinnormal_vertex,Y.ShaderChunk.defaultnormal_vertex,Y.ShaderChunk.morphtarget_vertex,Y.ShaderChunk.skinning_vertex,Y.ShaderChunk.default_vertex,Y.ShaderChunk.logdepthbuf_vertex,Y.ShaderChunk.worldpos_vertex,Y.ShaderChunk.envmap_vertex,Y.ShaderChunk.lights_lambert_vertex,Y.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Y.ShaderChunk.common,Y.ShaderChunk.color_pars_fragment,Y.ShaderChunk.map_pars_fragment,Y.ShaderChunk.alphamap_pars_fragment,Y.ShaderChunk.lightmap_pars_fragment,Y.ShaderChunk.envmap_pars_fragment,Y.ShaderChunk.fog_pars_fragment,Y.ShaderChunk.shadowmap_pars_fragment,Y.ShaderChunk.specularmap_pars_fragment,Y.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",Y.ShaderChunk.logdepthbuf_fragment,Y.ShaderChunk.map_fragment,Y.ShaderChunk.color_fragment,Y.ShaderChunk.alphamap_fragment,Y.ShaderChunk.alphatest_fragment,Y.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",Y.ShaderChunk.lightmap_fragment,Y.ShaderChunk.envmap_fragment,Y.ShaderChunk.shadowmap_fragment,Y.ShaderChunk.linear_to_gamma_fragment,Y.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:Y.UniformsUtils.merge([Y.UniformsLib.common,Y.UniformsLib.bump,Y.UniformsLib.normalmap,Y.UniformsLib.fog,Y.UniformsLib.lights,Y.UniformsLib.shadowmap,{emissive:{type:"c",value:new Y.Color(0)},specular:{type:"c",value:new Y.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new Y.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",Y.ShaderChunk.common,Y.ShaderChunk.map_pars_vertex,Y.ShaderChunk.lightmap_pars_vertex,Y.ShaderChunk.envmap_pars_vertex,Y.ShaderChunk.lights_phong_pars_vertex,Y.ShaderChunk.color_pars_vertex,Y.ShaderChunk.morphtarget_pars_vertex,Y.ShaderChunk.skinning_pars_vertex,Y.ShaderChunk.shadowmap_pars_vertex,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Y.ShaderChunk.map_vertex,Y.ShaderChunk.lightmap_vertex,Y.ShaderChunk.color_vertex,Y.ShaderChunk.morphnormal_vertex,Y.ShaderChunk.skinbase_vertex,Y.ShaderChunk.skinnormal_vertex,Y.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",Y.ShaderChunk.morphtarget_vertex,Y.ShaderChunk.skinning_vertex,Y.ShaderChunk.default_vertex,Y.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",Y.ShaderChunk.worldpos_vertex,Y.ShaderChunk.envmap_vertex,Y.ShaderChunk.lights_phong_vertex,Y.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",Y.ShaderChunk.common,Y.ShaderChunk.color_pars_fragment,Y.ShaderChunk.map_pars_fragment,Y.ShaderChunk.alphamap_pars_fragment,Y.ShaderChunk.lightmap_pars_fragment,Y.ShaderChunk.envmap_pars_fragment,Y.ShaderChunk.fog_pars_fragment,Y.ShaderChunk.lights_phong_pars_fragment,Y.ShaderChunk.shadowmap_pars_fragment,Y.ShaderChunk.bumpmap_pars_fragment,Y.ShaderChunk.normalmap_pars_fragment,Y.ShaderChunk.specularmap_pars_fragment,Y.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",Y.ShaderChunk.logdepthbuf_fragment,Y.ShaderChunk.map_fragment,Y.ShaderChunk.color_fragment,Y.ShaderChunk.alphamap_fragment,Y.ShaderChunk.alphatest_fragment,Y.ShaderChunk.specularmap_fragment,Y.ShaderChunk.lights_phong_fragment,Y.ShaderChunk.lightmap_fragment,Y.ShaderChunk.envmap_fragment,Y.ShaderChunk.shadowmap_fragment,Y.ShaderChunk.linear_to_gamma_fragment,Y.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:Y.UniformsUtils.merge([Y.UniformsLib.particle,Y.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",Y.ShaderChunk.common,Y.ShaderChunk.color_pars_vertex,Y.ShaderChunk.shadowmap_pars_vertex,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Y.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",Y.ShaderChunk.logdepthbuf_vertex,Y.ShaderChunk.worldpos_vertex,Y.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",Y.ShaderChunk.common,Y.ShaderChunk.color_pars_fragment,Y.ShaderChunk.map_particle_pars_fragment,Y.ShaderChunk.fog_pars_fragment,Y.ShaderChunk.shadowmap_pars_fragment,Y.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",Y.ShaderChunk.logdepthbuf_fragment,Y.ShaderChunk.map_particle_fragment,Y.ShaderChunk.color_fragment,Y.ShaderChunk.alphatest_fragment,"\toutgoingLight = diffuseColor.rgb;",Y.ShaderChunk.shadowmap_fragment,Y.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:Y.UniformsUtils.merge([Y.UniformsLib.common,Y.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",Y.ShaderChunk.common,Y.ShaderChunk.color_pars_vertex,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Y.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",Y.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",Y.ShaderChunk.common,Y.ShaderChunk.color_pars_fragment,Y.ShaderChunk.fog_pars_fragment,Y.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",Y.ShaderChunk.logdepthbuf_fragment,Y.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",Y.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[Y.ShaderChunk.common,Y.ShaderChunk.morphtarget_pars_vertex,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Y.ShaderChunk.morphtarget_vertex,Y.ShaderChunk.default_vertex,Y.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",Y.ShaderChunk.common,Y.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",Y.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",Y.ShaderChunk.common,Y.ShaderChunk.morphtarget_pars_vertex,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",Y.ShaderChunk.morphtarget_vertex,Y.ShaderChunk.default_vertex,Y.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",Y.ShaderChunk.common,Y.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",Y.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",Y.ShaderChunk.common,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",Y.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",Y.ShaderChunk.common,Y.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",Y.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",Y.ShaderChunk.common,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",Y.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",Y.ShaderChunk.common,Y.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",Y.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[Y.ShaderChunk.common,Y.ShaderChunk.morphtarget_pars_vertex,Y.ShaderChunk.skinning_pars_vertex,Y.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Y.ShaderChunk.skinbase_vertex,Y.ShaderChunk.morphtarget_vertex,Y.ShaderChunk.skinning_vertex,Y.ShaderChunk.default_vertex,Y.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[Y.ShaderChunk.common,Y.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",Y.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}},Y.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",Y.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),i=void 0!==e.context?e.context:null,n=1,r=void 0!==e.precision?e.precision:"highp",o=void 0!==e.alpha&&e.alpha,s=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,l=void 0!==e.antialias&&e.antialias,c=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,h=void 0!==e.logarithmicDepthBuffer&&e.logarithmicDepthBuffer,d=new Y.Color(0),f=0,p=[],m={},g=[],v=[],y=[],b=[],x=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=Y.PCFShadowMap,this.shadowMapCullFace=Y.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _,E=this,S=[],A=null,w=null,C=-1,T="",M=null,I=0,P=0,L=0,R=t.width,D=t.height,O=0,B=0,N=new Y.Frustum,U=new Y.Matrix4,k=new Y.Vector3,F=new Y.Vector3,V=!0,G={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var z={alpha:o,depth:s,stencil:a,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:u};if(null===(_=i||t.getContext("webgl",z)||t.getContext("experimental-webgl",z)))throw null!==t.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";t.addEventListener("webglcontextlost",(function(e){e.preventDefault(),K(),q(),m={}}),!1)}catch(e){Y.error("THREE.WebGLRenderer: "+e)}var H=new Y.WebGLState(_,st);void 0===_.getShaderPrecisionFormat&&(_.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var W=new Y.WebGLExtensions(_);W.get("OES_texture_float"),W.get("OES_texture_float_linear"),W.get("OES_texture_half_float"),W.get("OES_texture_half_float_linear"),W.get("OES_standard_derivatives"),h&&W.get("EXT_frag_depth");var j=function(e,t,i,n){!0===c&&(e*=n,t*=n,i*=n),_.clearColor(e,t,i,n)},q=function(){_.clearColor(0,0,0,1),_.clearDepth(1),_.clearStencil(0),_.enable(_.DEPTH_TEST),_.depthFunc(_.LEQUAL),_.frontFace(_.CCW),_.cullFace(_.BACK),_.enable(_.CULL_FACE),_.enable(_.BLEND),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA),_.viewport(P,L,R,D),j(d.r,d.g,d.b,f)},K=function(){A=null,M=null,T="",C=-1,V=!0,H.reset()};q(),this.context=_,this.state=H;var X,Q=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS),Z=_.getParameter(_.MAX_VERTEX_TEXTURE_IMAGE_UNITS),$=_.getParameter(_.MAX_TEXTURE_SIZE),J=_.getParameter(_.MAX_CUBE_MAP_TEXTURE_SIZE),ee=Z>0,te=ee&&W.get("OES_texture_float"),ie=_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.HIGH_FLOAT),ne=_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.MEDIUM_FLOAT),re=_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.HIGH_FLOAT),oe=_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.MEDIUM_FLOAT),se=function(){if(void 0!==X)return X;if(X=[],W.get("WEBGL_compressed_texture_pvrtc")||W.get("WEBGL_compressed_texture_s3tc"))for(var e=_.getParameter(_.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)X.push(e[t]);return X},ae=ie.precision>0&&re.precision>0,le=ne.precision>0&&oe.precision>0;"highp"!==r||ae||(le?(r="mediump",Y.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(r="lowp",Y.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==r||le||(r="lowp",Y.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var ce,ue=new Y.ShadowMapPlugin(this,p,m,g),he=new Y.SpritePlugin(this,b),de=new Y.LensFlarePlugin(this,x);function fe(e){e.__webglVertexBuffer=_.createBuffer(),e.__webglNormalBuffer=_.createBuffer(),e.__webglTangentBuffer=_.createBuffer(),e.__webglColorBuffer=_.createBuffer(),e.__webglUVBuffer=_.createBuffer(),e.__webglUV2Buffer=_.createBuffer(),e.__webglSkinIndicesBuffer=_.createBuffer(),e.__webglSkinWeightsBuffer=_.createBuffer(),e.__webglFaceBuffer=_.createBuffer(),e.__webglLineBuffer=_.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var i=0,n=t;i<n;i++)e.__webglMorphTargetsBuffers.push(_.createBuffer())}var r=e.numMorphNormals;if(r){e.__webglMorphNormalsBuffers=[];for(i=0,n=r;i<n;i++)e.__webglMorphNormalsBuffers.push(_.createBuffer())}E.info.memory.geometries++}this.getContext=function(){return _},this.forceContextLoss=function(){W.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return ee},this.supportsFloatTextures=function(){return W.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return W.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return W.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return W.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return W.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return W.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){if(void 0!==ce)return ce;var e=W.get("EXT_texture_filter_anisotropic");return ce=null!==e?_.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPrecision=function(){return r},this.getPixelRatio=function(){return n},this.setPixelRatio=function(e){n=e},this.setSize=function(e,i,r){t.width=e*n,t.height=i*n,!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i)},this.setViewport=function(e,t,i,r){P=e*n,L=t*n,R=i*n,D=r*n,_.viewport(P,L,R,D)},this.setScissor=function(e,t,i,r){_.scissor(e*n,t*n,i*n,r*n)},this.enableScissorTest=function(e){e?_.enable(_.SCISSOR_TEST):_.disable(_.SCISSOR_TEST)},this.getClearColor=function(){return d},this.setClearColor=function(e,t){d.set(e),f=void 0!==t?t:1,j(d.r,d.g,d.b,f)},this.getClearAlpha=function(){return f},this.setClearAlpha=function(e){f=e,j(d.r,d.g,d.b,f)},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=_.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=_.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=_.STENCIL_BUFFER_BIT),_.clear(n)},this.clearColor=function(){_.clear(_.COLOR_BUFFER_BIT)},this.clearDepth=function(){_.clear(_.DEPTH_BUFFER_BIT)},this.clearStencil=function(){_.clear(_.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.resetGLState=K;var pe=function(e){e.target.traverse((function(e){e.removeEventListener("remove",pe),function(e){e instanceof Y.Mesh||e instanceof Y.PointCloud||e instanceof Y.Line?delete m[e.id]:(e instanceof Y.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}(g,e);delete e.__webglInit,delete e._modelViewMatrix,delete e._normalMatrix,delete e.__webglActive}(e)}))},me=function(e){var t=e.target;t.removeEventListener("dispose",me),xe(t)},ge=function(e){var t=e.target;t.removeEventListener("dispose",ge),_e(t),E.info.memory.textures--},ve=function(e){var t=e.target;t.removeEventListener("dispose",ve),Ee(t),E.info.memory.textures--},ye=function(e){var t=e.target;t.removeEventListener("dispose",ye),Se(t)},be=function(e){for(var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],i=0,n=t.length;i<n;i++){void 0!==e[r=t[i]]&&(_.deleteBuffer(e[r]),delete e[r])}if(void 0!==e.__webglCustomAttributesList){for(var r in e.__webglCustomAttributesList)_.deleteBuffer(e.__webglCustomAttributesList[r].buffer);delete e.__webglCustomAttributesList}E.info.memory.geometries--},xe=function(e){if(delete e.__webglInit,e instanceof Y.BufferGeometry){for(var t in e.attributes){var i=e.attributes[t];void 0!==i.buffer&&(_.deleteBuffer(i.buffer),delete i.buffer)}E.info.memory.geometries--}else{var n=Ue[e.id];if(void 0!==n){for(var r=0,o=n.length;r<o;r++){var s=n[r];if(void 0!==s.numMorphTargets){for(var a=0,l=s.numMorphTargets;a<l;a++)_.deleteBuffer(s.__webglMorphTargetsBuffers[a]);delete s.__webglMorphTargetsBuffers}if(void 0!==s.numMorphNormals){for(a=0,l=s.numMorphNormals;a<l;a++)_.deleteBuffer(s.__webglMorphNormalsBuffers[a]);delete s.__webglMorphNormalsBuffers}be(s)}delete Ue[e.id]}else be(e)}T=""},_e=function(e){if(e.image&&e.image.__webglTextureCube)_.deleteTexture(e.image.__webglTextureCube),delete e.image.__webglTextureCube;else{if(void 0===e.__webglInit)return;_.deleteTexture(e.__webglTexture),delete e.__webglTexture,delete e.__webglInit}},Ee=function(e){if(e&&void 0!==e.__webglTexture){if(_.deleteTexture(e.__webglTexture),delete e.__webglTexture,e instanceof Y.WebGLRenderTargetCube)for(var t=0;t<6;t++)_.deleteFramebuffer(e.__webglFramebuffer[t]),_.deleteRenderbuffer(e.__webglRenderbuffer[t]);else _.deleteFramebuffer(e.__webglFramebuffer),_.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer,delete e.__webglRenderbuffer}},Se=function(e){var t=e.program.program;if(void 0!==t){var i,n,r;e.program=void 0;var o=!1;for(i=0,n=S.length;i<n;i++)if((r=S[i]).program===t){r.usedTimes--,0===r.usedTimes&&(o=!0);break}if(!0===o){var s=[];for(i=0,n=S.length;i<n;i++)(r=S[i]).program!==t&&s.push(r);S=s,_.deleteProgram(t),E.info.memory.programs--}}};function Ae(e){var t=e.geometry,i=e.material,n=t.vertices.length;if(i.attributes)for(var r in void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]),i.attributes){var o=i.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var s=1;"v2"===o.type?s=2:"v3"===o.type?s=3:"v4"===o.type?s=4:"c"===o.type&&(s=3),o.size=s,o.array=new Float32Array(n*s),o.buffer=_.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}function we(e,t){var i=t.geometry,n=e.faces3,r=3*n.length,o=1*n.length,s=3*n.length,a=Ce(t,e);e.__vertexArray=new Float32Array(3*r),e.__normalArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__uvArray=new Float32Array(2*r),i.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*r)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*r)),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*r),e.__skinWeightArray=new Float32Array(4*r));var l=null!==W.get("OES_element_index_uint")&&o>21845?Uint32Array:Uint16Array;e.__typeArray=l,e.__faceArray=new l(3*o),e.__lineArray=new l(2*s);var c=e.numMorphTargets;if(c){e.__morphTargetsArrays=[];for(var u=0,h=c;u<h;u++)e.__morphTargetsArrays.push(new Float32Array(3*r))}var d=e.numMorphNormals;if(d){e.__morphNormalsArrays=[];for(u=0,h=d;u<h;u++)e.__morphNormalsArrays.push(new Float32Array(3*r))}if(e.__webglFaceCount=3*o,e.__webglLineCount=2*s,a.attributes)for(var f in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),a.attributes){var p=a.attributes[f],m={};for(var g in p)m[g]=p[g];if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=!0;var v=1;"v2"===m.type?v=2:"v3"===m.type?v=3:"v4"===m.type?v=4:"c"===m.type&&(v=3),m.size=v,m.array=new Float32Array(r*v),m.buffer=_.createBuffer(),m.buffer.belongsToAttribute=f,p.needsUpdate=!0,m.__original=p}e.__webglCustomAttributesList.push(m)}e.__inittedArrays=!0}function Ce(e,t){return e.material instanceof Y.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Te(e,t,i,n,r){if(e.__inittedArrays){var o,s,a,l,c,u,h,d,f,p,m,g,v,y,b,x,E,S,A,w,C,T,M,I,P,L,R,D,O,B,N,U,k,F,V,G,z,H,W,j,q,K=function(e){return e instanceof Y.MeshPhongMaterial==0&&e.shading===Y.FlatShading}(r),X=0,Q=0,Z=0,$=0,J=0,ee=0,te=0,ie=0,ne=0,re=0,oe=0,se=0,ae=e.__vertexArray,le=e.__uvArray,ce=e.__uv2Array,ue=e.__normalArray,he=e.__tangentArray,de=e.__colorArray,fe=e.__skinIndexArray,pe=e.__skinWeightArray,me=e.__morphTargetsArrays,ge=e.__morphNormalsArrays,ve=e.__webglCustomAttributesList,ye=e.__faceArray,be=e.__lineArray,xe=t.geometry,_e=xe.verticesNeedUpdate,Ee=xe.elementsNeedUpdate,Se=xe.uvsNeedUpdate,Ae=xe.normalsNeedUpdate,we=xe.tangentsNeedUpdate,Ce=xe.colorsNeedUpdate,Te=xe.morphTargetsNeedUpdate,Me=xe.vertices,Ie=e.faces3,Pe=xe.faces,Le=xe.faceVertexUvs[0],Re=xe.faceVertexUvs[1],De=xe.skinIndices,Oe=xe.skinWeights,Be=xe.morphTargets,Ne=xe.morphNormals;if(_e){for(o=0,s=Ie.length;o<s;o++)m=Me[(a=Pe[Ie[o]]).a],g=Me[a.b],v=Me[a.c],ae[Q]=m.x,ae[Q+1]=m.y,ae[Q+2]=m.z,ae[Q+3]=g.x,ae[Q+4]=g.y,ae[Q+5]=g.z,ae[Q+6]=v.x,ae[Q+7]=v.y,ae[Q+8]=v.z,Q+=9;_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,ae,i)}if(Te)for(F=0,V=Be.length;F<V;F++){for(oe=0,o=0,s=Ie.length;o<s;o++)a=Pe[H=Ie[o]],m=Be[F].vertices[a.a],g=Be[F].vertices[a.b],v=Be[F].vertices[a.c],(G=me[F])[oe]=m.x,G[oe+1]=m.y,G[oe+2]=m.z,G[oe+3]=g.x,G[oe+4]=g.y,G[oe+5]=g.z,G[oe+6]=v.x,G[oe+7]=v.y,G[oe+8]=v.z,r.morphNormals&&(K?(S=E=Ne[F].faceNormals[H],A=E):(E=(W=Ne[F].vertexNormals[H]).a,S=W.b,A=W.c),(z=ge[F])[oe]=E.x,z[oe+1]=E.y,z[oe+2]=E.z,z[oe+3]=S.x,z[oe+4]=S.y,z[oe+5]=S.z,z[oe+6]=A.x,z[oe+7]=A.y,z[oe+8]=A.z),oe+=9;_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[F]),_.bufferData(_.ARRAY_BUFFER,me[F],i),r.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[F]),_.bufferData(_.ARRAY_BUFFER,ge[F],i))}if(Oe.length){for(o=0,s=Ie.length;o<s;o++)M=Oe[(a=Pe[Ie[o]]).a],I=Oe[a.b],P=Oe[a.c],pe[re]=M.x,pe[re+1]=M.y,pe[re+2]=M.z,pe[re+3]=M.w,pe[re+4]=I.x,pe[re+5]=I.y,pe[re+6]=I.z,pe[re+7]=I.w,pe[re+8]=P.x,pe[re+9]=P.y,pe[re+10]=P.z,pe[re+11]=P.w,L=De[a.a],R=De[a.b],D=De[a.c],fe[re]=L.x,fe[re+1]=L.y,fe[re+2]=L.z,fe[re+3]=L.w,fe[re+4]=R.x,fe[re+5]=R.y,fe[re+6]=R.z,fe[re+7]=R.w,fe[re+8]=D.x,fe[re+9]=D.y,fe[re+10]=D.z,fe[re+11]=D.w,re+=12;re>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),_.bufferData(_.ARRAY_BUFFER,fe,i),_.bindBuffer(_.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),_.bufferData(_.ARRAY_BUFFER,pe,i))}if(Ce){for(o=0,s=Ie.length;o<s;o++)u=(a=Pe[Ie[o]]).vertexColors,h=a.color,3===u.length&&r.vertexColors===Y.VertexColors?(w=u[0],C=u[1],T=u[2]):(w=h,C=h,T=h),de[ne]=w.r,de[ne+1]=w.g,de[ne+2]=w.b,de[ne+3]=C.r,de[ne+4]=C.g,de[ne+5]=C.b,de[ne+6]=T.r,de[ne+7]=T.g,de[ne+8]=T.b,ne+=9;ne>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,de,i))}if(we&&xe.hasTangents){for(o=0,s=Ie.length;o<s;o++)y=(d=(a=Pe[Ie[o]]).vertexTangents)[0],b=d[1],x=d[2],he[te]=y.x,he[te+1]=y.y,he[te+2]=y.z,he[te+3]=y.w,he[te+4]=b.x,he[te+5]=b.y,he[te+6]=b.z,he[te+7]=b.w,he[te+8]=x.x,he[te+9]=x.y,he[te+10]=x.z,he[te+11]=x.w,te+=12;_.bindBuffer(_.ARRAY_BUFFER,e.__webglTangentBuffer),_.bufferData(_.ARRAY_BUFFER,he,i)}if(Ae){for(o=0,s=Ie.length;o<s;o++)if(l=(a=Pe[Ie[o]]).vertexNormals,c=a.normal,3===l.length&&!1===K)for(O=0;O<3;O++)N=l[O],ue[ee]=N.x,ue[ee+1]=N.y,ue[ee+2]=N.z,ee+=3;else for(O=0;O<3;O++)ue[ee]=c.x,ue[ee+1]=c.y,ue[ee+2]=c.z,ee+=3;_.bindBuffer(_.ARRAY_BUFFER,e.__webglNormalBuffer),_.bufferData(_.ARRAY_BUFFER,ue,i)}if(Se&&Le){for(o=0,s=Ie.length;o<s;o++)if(void 0!==(f=Le[Ie[o]]))for(O=0;O<3;O++)U=f[O],le[Z]=U.x,le[Z+1]=U.y,Z+=2;Z>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglUVBuffer),_.bufferData(_.ARRAY_BUFFER,le,i))}if(Se&&Re){for(o=0,s=Ie.length;o<s;o++)if(void 0!==(p=Re[Ie[o]]))for(O=0;O<3;O++)k=p[O],ce[$]=k.x,ce[$+1]=k.y,$+=2;$>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglUV2Buffer),_.bufferData(_.ARRAY_BUFFER,ce,i))}if(Ee){for(o=0,s=Ie.length;o<s;o++)ye[J]=X,ye[J+1]=X+1,ye[J+2]=X+2,J+=3,be[ie]=X,be[ie+1]=X+1,be[ie+2]=X,be[ie+3]=X+2,be[ie+4]=X+1,be[ie+5]=X+2,ie+=6,X+=3;_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,ye,i),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,be,i)}if(ve)for(O=0,B=ve.length;O<B;O++)if((q=ve[O]).__original.needsUpdate){if(se=0,1===q.size){if(void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)a=Pe[Ie[o]],q.array[se]=q.value[a.a],q.array[se+1]=q.value[a.b],q.array[se+2]=q.value[a.c],se+=3;else if("faces"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)j=q.value[Ie[o]],q.array[se]=j,q.array[se+1]=j,q.array[se+2]=j,se+=3}else if(2===q.size){if(void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)a=Pe[Ie[o]],m=q.value[a.a],g=q.value[a.b],v=q.value[a.c],q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=g.x,q.array[se+3]=g.y,q.array[se+4]=v.x,q.array[se+5]=v.y,se+=6;else if("faces"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)m=j=q.value[Ie[o]],g=j,v=j,q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=g.x,q.array[se+3]=g.y,q.array[se+4]=v.x,q.array[se+5]=v.y,se+=6}else if(3===q.size){var Ue;if(Ue="c"===q.type?["r","g","b"]:["x","y","z"],void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)a=Pe[Ie[o]],m=q.value[a.a],g=q.value[a.b],v=q.value[a.c],q.array[se]=m[Ue[0]],q.array[se+1]=m[Ue[1]],q.array[se+2]=m[Ue[2]],q.array[se+3]=g[Ue[0]],q.array[se+4]=g[Ue[1]],q.array[se+5]=g[Ue[2]],q.array[se+6]=v[Ue[0]],q.array[se+7]=v[Ue[1]],q.array[se+8]=v[Ue[2]],se+=9;else if("faces"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)m=j=q.value[Ie[o]],g=j,v=j,q.array[se]=m[Ue[0]],q.array[se+1]=m[Ue[1]],q.array[se+2]=m[Ue[2]],q.array[se+3]=g[Ue[0]],q.array[se+4]=g[Ue[1]],q.array[se+5]=g[Ue[2]],q.array[se+6]=v[Ue[0]],q.array[se+7]=v[Ue[1]],q.array[se+8]=v[Ue[2]],se+=9;else if("faceVertices"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)m=(j=q.value[Ie[o]])[0],g=j[1],v=j[2],q.array[se]=m[Ue[0]],q.array[se+1]=m[Ue[1]],q.array[se+2]=m[Ue[2]],q.array[se+3]=g[Ue[0]],q.array[se+4]=g[Ue[1]],q.array[se+5]=g[Ue[2]],q.array[se+6]=v[Ue[0]],q.array[se+7]=v[Ue[1]],q.array[se+8]=v[Ue[2]],se+=9}else if(4===q.size)if(void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)a=Pe[Ie[o]],m=q.value[a.a],g=q.value[a.b],v=q.value[a.c],q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=m.z,q.array[se+3]=m.w,q.array[se+4]=g.x,q.array[se+5]=g.y,q.array[se+6]=g.z,q.array[se+7]=g.w,q.array[se+8]=v.x,q.array[se+9]=v.y,q.array[se+10]=v.z,q.array[se+11]=v.w,se+=12;else if("faces"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)m=j=q.value[Ie[o]],g=j,v=j,q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=m.z,q.array[se+3]=m.w,q.array[se+4]=g.x,q.array[se+5]=g.y,q.array[se+6]=g.z,q.array[se+7]=g.w,q.array[se+8]=v.x,q.array[se+9]=v.y,q.array[se+10]=v.z,q.array[se+11]=v.w,se+=12;else if("faceVertices"===q.boundTo)for(o=0,s=Ie.length;o<s;o++)m=(j=q.value[Ie[o]])[0],g=j[1],v=j[2],q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=m.z,q.array[se+3]=m.w,q.array[se+4]=g.x,q.array[se+5]=g.y,q.array[se+6]=g.z,q.array[se+7]=g.w,q.array[se+8]=v.x,q.array[se+9]=v.y,q.array[se+10]=v.z,q.array[se+11]=v.w,se+=12;_.bindBuffer(_.ARRAY_BUFFER,q.buffer),_.bufferData(_.ARRAY_BUFFER,q.array,i)}n&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Me(e,t,i,n){for(var r=i.attributes,o=t.attributes,s=t.attributesKeys,a=0,l=s.length;a<l;a++){var c=s[a],u=o[c];if(u>=0){var h=r[c];if(void 0!==h){var d=h.itemSize;_.bindBuffer(_.ARRAY_BUFFER,h.buffer),H.enableAttribute(u),_.vertexAttribPointer(u,d,_.FLOAT,!1,0,n*d*4)}else void 0!==e.defaultAttributeValues&&(2===e.defaultAttributeValues[c].length?_.vertexAttrib2fv(u,e.defaultAttributeValues[c]):3===e.defaultAttributeValues[c].length&&_.vertexAttrib3fv(u,e.defaultAttributeValues[c]))}}H.disableUnusedAttributes()}function Ie(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Pe(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Le(e,t){return t[0]-e[0]}function Re(e){if(!1!==e.visible){if(e instanceof Y.Scene||e instanceof Y.Group);else if(function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new Y.Matrix4,e._normalMatrix=new Y.Matrix3,e.addEventListener("removed",pe));var t=e.geometry;void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",me),t instanceof Y.BufferGeometry?E.info.memory.geometries++:e instanceof Y.Mesh?Fe(e,t):e instanceof Y.Line?void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=_.createBuffer(),e.__webglColorBuffer=_.createBuffer(),e.__webglLineDistanceBuffer=_.createBuffer(),E.info.memory.geometries++}(t),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i,Ae(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e instanceof Y.PointCloud&&void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=_.createBuffer(),e.__webglColorBuffer=_.createBuffer(),E.info.memory.geometries++}(t),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__webglParticleCount=i,Ae(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0));if(void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof Y.Mesh){if(t instanceof Y.BufferGeometry)Ve(m,t,e);else if(t instanceof Y.Geometry)for(var i=Ue[t.id],n=0,r=i.length;n<r;n++)Ve(m,i[n],e)}else e instanceof Y.Line||e instanceof Y.PointCloud?Ve(m,t,e):(e instanceof Y.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}(g,e)}(e),e instanceof Y.Light)p.push(e);else if(e instanceof Y.Sprite)b.push(e);else if(e instanceof Y.LensFlare)x.push(e);else{var t=m[e.id];if(t&&(!1===e.frustumCulled||!0===N.intersectsObject(e)))for(var i=0,n=t.length;i<n;i++){var r=t[i];Ne(r),r.render=!0,!0===E.sortObjects&&(k.setFromMatrixPosition(e.matrixWorld),k.applyProjection(U),r.z=k.z)}}for(i=0,n=e.children.length;i<n;i++)Re(e.children[i])}}function De(e,t,i,n,r){for(var o,s=0,a=e.length;s<a;s++){var l=e[s],c=l.object,u=l.buffer;if(Ze(c,t),r)o=r;else{if(!(o=l.material))continue;qe(o)}E.setMaterialFaces(o),u instanceof Y.BufferGeometry?E.renderBufferDirect(t,i,n,o,u,c):E.renderBuffer(t,i,n,o,u,c)}}function Oe(e,t,i,n,r,o){for(var s,a=0,l=e.length;a<l;a++){var c=e[a],u=c.object;if(u.visible){if(o)s=o;else{if(!(s=c[t]))continue;qe(s)}E.renderImmediateObject(i,n,r,s,u)}}}function Be(e){var t=e.object.material;t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)}function Ne(e){var t=e.object,i=e.buffer,n=t.geometry,r=t.material;if(r instanceof Y.MeshFaceMaterial){var o=n instanceof Y.BufferGeometry?0:i.materialIndex;r=r.materials[o],e.material=r,r.transparent?y.push(e):v.push(e)}else r&&(e.material=r,r.transparent?y.push(e):v.push(e))}this.renderBufferImmediate=function(e,t,i){if(H.initAttributes(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=_.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=_.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=_.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=_.createBuffer()),e.hasPositions&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,e.positionArray,_.DYNAMIC_DRAW),H.enableAttribute(t.attributes.position),_.vertexAttribPointer(t.attributes.position,3,_.FLOAT,!1,0,0)),e.hasNormals){if(_.bindBuffer(_.ARRAY_BUFFER,e.__webglNormalBuffer),i instanceof Y.MeshPhongMaterial==!1&&i.shading===Y.FlatShading){var n,r,o,s,a,l,c,u,h,d,f,p=3*e.count;for(f=0;f<p;f+=9)s=(d=e.normalArray)[f],l=d[f+1],u=d[f+2],a=d[f+3],c=d[f+4],h=d[f+5],n=(s+a+d[f+6])/3,r=(l+c+d[f+7])/3,o=(u+h+d[f+8])/3,d[f]=n,d[f+1]=r,d[f+2]=o,d[f+3]=n,d[f+4]=r,d[f+5]=o,d[f+6]=n,d[f+7]=r,d[f+8]=o}_.bufferData(_.ARRAY_BUFFER,e.normalArray,_.DYNAMIC_DRAW),H.enableAttribute(t.attributes.normal),_.vertexAttribPointer(t.attributes.normal,3,_.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglUvBuffer),_.bufferData(_.ARRAY_BUFFER,e.uvArray,_.DYNAMIC_DRAW),H.enableAttribute(t.attributes.uv),_.vertexAttribPointer(t.attributes.uv,2,_.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==Y.NoColors&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,e.colorArray,_.DYNAMIC_DRAW),H.enableAttribute(t.attributes.color),_.vertexAttribPointer(t.attributes.color,3,_.FLOAT,!1,0,0)),H.disableUnusedAttributes(),_.drawArrays(_.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,o,s){if(!1!==r.visible){Ge(s);var a=Ke(e,t,i,r,s),l=!1,c=r.wireframe?1:0,u="direct_"+o.id+"_"+a.id+"_"+c;if(u!==T&&(T=u,l=!0),l&&H.initAttributes(),s instanceof Y.Mesh){var h=!0===r.wireframe?_.LINES:_.TRIANGLES;if(g=o.attributes.index){if(g.array instanceof Uint32Array&&W.get("OES_element_index_uint")?(v=_.UNSIGNED_INT,y=4):(v=_.UNSIGNED_SHORT,y=2),0===(b=o.offsets).length)l&&(Me(r,a,o,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(h,g.array.length,v,0),E.info.render.calls++,E.info.render.vertices+=g.array.length,E.info.render.faces+=g.array.length/3;else{l=!0;for(var d=0,f=b.length;d<f;d++){var p=b[d].index;l&&(Me(r,a,o,p),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(h,b[d].count,v,b[d].start*y),E.info.render.calls++,E.info.render.vertices+=b[d].count,E.info.render.faces+=b[d].count/3}}}else{l&&Me(r,a,o,0);var m=o.attributes.position;_.drawArrays(h,0,m.array.length/m.itemSize),E.info.render.calls++,E.info.render.vertices+=m.array.length/m.itemSize,E.info.render.faces+=m.array.length/(3*m.itemSize)}}else if(s instanceof Y.PointCloud){h=_.POINTS;if(g=o.attributes.index){if(g.array instanceof Uint32Array&&W.get("OES_element_index_uint")?(v=_.UNSIGNED_INT,y=4):(v=_.UNSIGNED_SHORT,y=2),0===(b=o.offsets).length)l&&(Me(r,a,o,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(h,g.array.length,v,0),E.info.render.calls++,E.info.render.points+=g.array.length;else{b.length>1&&(l=!0);for(d=0,f=b.length;d<f;d++){p=b[d].index;l&&(Me(r,a,o,p),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(h,b[d].count,v,b[d].start*y),E.info.render.calls++,E.info.render.points+=b[d].count}}}else{l&&Me(r,a,o,0);m=o.attributes.position;if(0===(b=o.offsets).length)_.drawArrays(h,0,m.array.length/3),E.info.render.calls++,E.info.render.points+=m.array.length/3;else for(d=0,f=b.length;d<f;d++)_.drawArrays(h,b[d].index,b[d].count),E.info.render.calls++,E.info.render.points+=b[d].count}}else if(s instanceof Y.Line){var g;h=s.mode===Y.LineStrip?_.LINE_STRIP:_.LINES;if(H.setLineWidth(r.linewidth*n),g=o.attributes.index){var v,y;if(g.array instanceof Uint32Array?(v=_.UNSIGNED_INT,y=4):(v=_.UNSIGNED_SHORT,y=2),0===(b=o.offsets).length)l&&(Me(r,a,o,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(h,g.array.length,v,0),E.info.render.calls++,E.info.render.vertices+=g.array.length;else{b.length>1&&(l=!0);for(d=0,f=b.length;d<f;d++){p=b[d].index;l&&(Me(r,a,o,p),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(h,b[d].count,v,b[d].start*y),E.info.render.calls++,E.info.render.vertices+=b[d].count}}}else{l&&Me(r,a,o,0);var b;m=o.attributes.position;if(0===(b=o.offsets).length)_.drawArrays(h,0,m.array.length/3),E.info.render.calls++,E.info.render.vertices+=m.array.length/3;else for(d=0,f=b.length;d<f;d++)_.drawArrays(h,b[d].index,b[d].count),E.info.render.calls++,E.info.render.vertices+=b[d].count}}}},this.renderBuffer=function(e,t,i,r,o,s){if(!1!==r.visible){Ge(s);var a=Ke(e,t,i,r,s),l=a.attributes,c=!1,u=r.wireframe?1:0,h=o.id+"_"+a.id+"_"+u;if(h!==T&&(T=h,c=!0),c&&H.initAttributes(),!r.morphTargets&&l.position>=0?c&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglVertexBuffer),H.enableAttribute(l.position),_.vertexAttribPointer(l.position,3,_.FLOAT,!1,0,0)):s.morphTargetBase&&function(e,t,i){var n=e.program.attributes;-1!==i.morphTargetBase&&n.position>=0?(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]),H.enableAttribute(n.position),_.vertexAttribPointer(n.position,3,_.FLOAT,!1,0,0)):n.position>=0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglVertexBuffer),H.enableAttribute(n.position),_.vertexAttribPointer(n.position,3,_.FLOAT,!1,0,0));if(i.morphTargetForcedOrder.length)for(var r=0,o=i.morphTargetForcedOrder,s=i.morphTargetInfluences;r<e.numSupportedMorphTargets&&r<o.length;)(a=n["morphTarget"+r])>=0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[r]]),H.enableAttribute(a),_.vertexAttribPointer(a,3,_.FLOAT,!1,0,0)),(a=n["morphNormal"+r])>=0&&e.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[r]]),H.enableAttribute(a),_.vertexAttribPointer(a,3,_.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[r]=s[o[r]],r++;else{var a,l=[],c=(s=i.morphTargetInfluences,i.geometry.morphTargets);s.length>c.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),s.length=c.length);for(var u=0,h=s.length;u<h;u++){var d=s[u];l.push([d,u])}l.length>e.numSupportedMorphTargets?(l.sort(Le),l.length=e.numSupportedMorphTargets):l.length>e.numSupportedMorphNormals?l.sort(Le):0===l.length&&l.push([0,0]);r=0;for(var f=e.numSupportedMorphTargets;r<f;r++)if(l[r]){var p=l[r][1];(a=n["morphTarget"+r])>=0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[p]),H.enableAttribute(a),_.vertexAttribPointer(a,3,_.FLOAT,!1,0,0)),(a=n["morphNormal"+r])>=0&&e.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[p]),H.enableAttribute(a),_.vertexAttribPointer(a,3,_.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[r]=s[p]}else i.__webglMorphTargetInfluences[r]=0}null!==e.program.uniforms.morphTargetInfluences&&_.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}(r,o,s),c){if(o.__webglCustomAttributesList)for(var d=0,f=o.__webglCustomAttributesList.length;d<f;d++){var p=o.__webglCustomAttributesList[d];l[p.buffer.belongsToAttribute]>=0&&(_.bindBuffer(_.ARRAY_BUFFER,p.buffer),H.enableAttribute(l[p.buffer.belongsToAttribute]),_.vertexAttribPointer(l[p.buffer.belongsToAttribute],p.size,_.FLOAT,!1,0,0))}l.color>=0&&(s.geometry.colors.length>0||s.geometry.faces.length>0?(_.bindBuffer(_.ARRAY_BUFFER,o.__webglColorBuffer),H.enableAttribute(l.color),_.vertexAttribPointer(l.color,3,_.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&_.vertexAttrib3fv(l.color,r.defaultAttributeValues.color)),l.normal>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglNormalBuffer),H.enableAttribute(l.normal),_.vertexAttribPointer(l.normal,3,_.FLOAT,!1,0,0)),l.tangent>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglTangentBuffer),H.enableAttribute(l.tangent),_.vertexAttribPointer(l.tangent,4,_.FLOAT,!1,0,0)),l.uv>=0&&(s.geometry.faceVertexUvs[0]?(_.bindBuffer(_.ARRAY_BUFFER,o.__webglUVBuffer),H.enableAttribute(l.uv),_.vertexAttribPointer(l.uv,2,_.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&_.vertexAttrib2fv(l.uv,r.defaultAttributeValues.uv)),l.uv2>=0&&(s.geometry.faceVertexUvs[1]?(_.bindBuffer(_.ARRAY_BUFFER,o.__webglUV2Buffer),H.enableAttribute(l.uv2),_.vertexAttribPointer(l.uv2,2,_.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&_.vertexAttrib2fv(l.uv2,r.defaultAttributeValues.uv2)),r.skinning&&l.skinIndex>=0&&l.skinWeight>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),H.enableAttribute(l.skinIndex),_.vertexAttribPointer(l.skinIndex,4,_.FLOAT,!1,0,0),_.bindBuffer(_.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),H.enableAttribute(l.skinWeight),_.vertexAttribPointer(l.skinWeight,4,_.FLOAT,!1,0,0)),l.lineDistance>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglLineDistanceBuffer),H.enableAttribute(l.lineDistance),_.vertexAttribPointer(l.lineDistance,1,_.FLOAT,!1,0,0))}if(H.disableUnusedAttributes(),s instanceof Y.Mesh){var m=o.__typeArray===Uint32Array?_.UNSIGNED_INT:_.UNSIGNED_SHORT;r.wireframe?(H.setLineWidth(r.wireframeLinewidth*n),c&&_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),_.drawElements(_.LINES,o.__webglLineCount,m,0)):(c&&_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),_.drawElements(_.TRIANGLES,o.__webglFaceCount,m,0)),E.info.render.calls++,E.info.render.vertices+=o.__webglFaceCount,E.info.render.faces+=o.__webglFaceCount/3}else if(s instanceof Y.Line){var g=s.mode===Y.LineStrip?_.LINE_STRIP:_.LINES;H.setLineWidth(r.linewidth*n),_.drawArrays(g,0,o.__webglLineCount),E.info.render.calls++}else s instanceof Y.PointCloud&&(_.drawArrays(_.POINTS,0,o.__webglParticleCount),E.info.render.calls++,E.info.render.points+=o.__webglParticleCount)}},this.render=function(e,t,i,n){if(t instanceof Y.Camera!=!1){var r=e.fog;T="",C=-1,M=null,V=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),e.traverse((function(e){e instanceof Y.SkinnedMesh&&e.skeleton.update()})),t.matrixWorldInverse.getInverse(t.matrixWorld),U.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromMatrix(U),p.length=0,v.length=0,y.length=0,b.length=0,x.length=0,Re(e),!0===E.sortObjects&&(v.sort(Ie),y.sort(Pe)),ue.render(e,t),E.info.render.calls=0,E.info.render.vertices=0,E.info.render.faces=0,E.info.render.points=0,this.setRenderTarget(i),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var o=0,s=g.length;o<s;o++){var a=g[o],l=a.object;l.visible&&(Ze(l,t),Be(a))}if(e.overrideMaterial){var c=e.overrideMaterial;qe(c),De(v,t,p,r,c),De(y,t,p,r,c),Oe(g,"",t,p,r,c)}else H.setBlending(Y.NoBlending),De(v,t,p,r,null),Oe(g,"opaque",t,p,r,null),De(y,t,p,r,null),Oe(g,"transparent",t,p,r,null);he.render(e,t),de.render(e,t,O,B),i&&i.generateMipmaps&&i.minFilter!==Y.NearestFilter&&i.minFilter!==Y.LinearFilter&&function(e){e instanceof Y.WebGLRenderTargetCube?(_.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture),_.generateMipmap(_.TEXTURE_CUBE_MAP),_.bindTexture(_.TEXTURE_CUBE_MAP,null)):(_.bindTexture(_.TEXTURE_2D,e.__webglTexture),_.generateMipmap(_.TEXTURE_2D),_.bindTexture(_.TEXTURE_2D,null))}(i),H.setDepthTest(!0),H.setDepthWrite(!0),H.setColorWrite(!0)}else Y.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,i,n,r){var o=Ke(e,t,i,n,r);T="",E.setMaterialFaces(n),r.immediateRenderCallback?r.immediateRenderCallback(o,_,N):r.render((function(e){E.renderBufferImmediate(e,o,n)}))};var Ue={},ke=0;function Fe(e,t){var i=e.material,n=!1;void 0!==Ue[t.id]&&!0!==t.groupsNeedUpdate||(delete m[e.id],Ue[t.id]=function(e,t){for(var i,n,r=W.get("OES_element_index_uint")?4294967296:65535,o={},s=e.morphTargets.length,a=e.morphNormals.length,l={},c=[],u=0,h=e.faces.length;u<h;u++){var d=e.faces[u],f=t?d.materialIndex:0;f in o||(o[f]={hash:f,counter:0}),(i=o[f].hash+"_"+o[f].counter)in l||(n={id:ke++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:s,numMorphNormals:a},l[i]=n,c.push(n)),l[i].vertices+3>r&&(o[f].counter+=1,(i=o[f].hash+"_"+o[f].counter)in l||(n={id:ke++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:s,numMorphNormals:a},l[i]=n,c.push(n))),l[i].faces3.push(u),l[i].vertices+=3}return c}(t,i instanceof Y.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var r=Ue[t.id],o=0,s=r.length;o<s;o++){var a=r[o];void 0===a.__webglVertexBuffer?(fe(a),we(a,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,n=!0):n=!1,(n||void 0===e.__webglActive)&&Ve(m,a,e)}e.__webglActive=!0}function Ve(e,t,i){var n=i.id;e[n]=e[n]||[],e[n].push({id:n,buffer:t,object:i,material:null,z:0})}function Ge(e){var t=e.geometry;if(t instanceof Y.BufferGeometry)for(var i=t.attributes,n=t.attributesKeys,r=0,o=n.length;r<o;r++){var s=n[r],a=i[s],l="index"===s?_.ELEMENT_ARRAY_BUFFER:_.ARRAY_BUFFER;void 0===a.buffer?(a.buffer=_.createBuffer(),_.bindBuffer(l,a.buffer),_.bufferData(l,a.array,a instanceof Y.DynamicBufferAttribute?_.DYNAMIC_DRAW:_.STATIC_DRAW),a.needsUpdate=!1):!0===a.needsUpdate&&(_.bindBuffer(l,a.buffer),void 0===a.updateRange||-1===a.updateRange.count?_.bufferSubData(l,0,a.array):0===a.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(_.bufferSubData(l,a.updateRange.offset*a.array.BYTES_PER_ELEMENT,a.array.subarray(a.updateRange.offset,a.updateRange.offset+a.updateRange.count)),a.updateRange.count=0),a.needsUpdate=!1)}else if(e instanceof Y.Mesh){!0===t.groupsNeedUpdate&&Fe(e,t);for(var c=Ue[t.id],u=(r=0,c.length);r<u;r++){var h=c[r],d=(f=Ce(e,h)).attributes&&ze(f);(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||d)&&Te(h,e,_.DYNAMIC_DRAW,!t.dynamic,f)}t.verticesNeedUpdate=!1,t.morphTargetsNeedUpdate=!1,t.elementsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.tangentsNeedUpdate=!1,f.attributes&&He(f)}else if(e instanceof Y.Line){d=(f=Ce(e,t)).attributes&&ze(f);(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||d)&&function(e,t){var i,n,r,o,s,a,l,c,u,h,d,f,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,y=m.length,b=g.length,x=e.__vertexArray,E=e.__colorArray,S=e.__lineDistanceArray,A=e.verticesNeedUpdate,w=e.colorsNeedUpdate,C=e.lineDistancesNeedUpdate,T=e.__webglCustomAttributesList;if(A){for(i=0;i<v;i++)o=p[i],x[s=3*i]=o.x,x[s+1]=o.y,x[s+2]=o.z;_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,x,t)}if(w){for(n=0;n<y;n++)a=m[n],E[s=3*n]=a.r,E[s+1]=a.g,E[s+2]=a.b;_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,E,t)}if(C){for(r=0;r<b;r++)S[r]=g[r];_.bindBuffer(_.ARRAY_BUFFER,e.__webglLineDistanceBuffer),_.bufferData(_.ARRAY_BUFFER,S,t)}if(T)for(l=0,c=T.length;l<c;l++)if((f=T[l]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(s=0,h=f.value.length,1===f.size)for(u=0;u<h;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.x,f.array[s+1]=d.y,s+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.r,f.array[s+1]=d.g,f.array[s+2]=d.b,s+=3;else for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.x,f.array[s+1]=d.y,f.array[s+2]=d.z,s+=3;else if(4===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.x,f.array[s+1]=d.y,f.array[s+2]=d.z,f.array[s+3]=d.w,s+=4;_.bindBuffer(_.ARRAY_BUFFER,f.buffer),_.bufferData(_.ARRAY_BUFFER,f.array,t),f.needsUpdate=!1}}(t,_.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,f.attributes&&He(f)}else if(e instanceof Y.PointCloud){var f;d=(f=Ce(e,t)).attributes&&ze(f);(t.verticesNeedUpdate||t.colorsNeedUpdate||d)&&function(e,t,i){var n,r,o,s,a,l,c,u,h,d,f,p=e.vertices,m=p.length,g=e.colors,v=g.length,y=e.__vertexArray,b=e.__colorArray,x=e.verticesNeedUpdate,E=e.colorsNeedUpdate,S=e.__webglCustomAttributesList;if(x){for(n=0;n<m;n++)o=p[n],y[s=3*n]=o.x,y[s+1]=o.y,y[s+2]=o.z;_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,y,t)}if(E){for(r=0;r<v;r++)a=g[r],b[s=3*r]=a.r,b[s+1]=a.g,b[s+2]=a.b;_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,b,t)}if(S)for(l=0,c=S.length;l<c;l++){if((f=S[l]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo))if(h=f.value.length,s=0,1===f.size)for(u=0;u<h;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.x,f.array[s+1]=d.y,s+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.r,f.array[s+1]=d.g,f.array[s+2]=d.b,s+=3;else for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.x,f.array[s+1]=d.y,f.array[s+2]=d.z,s+=3;else if(4===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.x,f.array[s+1]=d.y,f.array[s+2]=d.z,f.array[s+3]=d.w,s+=4;_.bindBuffer(_.ARRAY_BUFFER,f.buffer),_.bufferData(_.ARRAY_BUFFER,f.array,t),f.needsUpdate=!1}}(t,_.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,f.attributes&&He(f)}}function ze(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function He(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}var We={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};function je(e,t,i,n){e.addEventListener("dispose",ye);var o=We[e.type];if(o){var s=Y.ShaderLib[o];e.__webglShader={uniforms:Y.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var a=function(e){for(var t=0,i=0,n=0,r=0,o=0,s=e.length;o<s;o++){var a=e[o];a.onlyShadow||!1===a.visible||(a instanceof Y.DirectionalLight&&t++,a instanceof Y.PointLight&&i++,a instanceof Y.SpotLight&&n++,a instanceof Y.HemisphereLight&&r++)}return{directional:t,point:i,spot:n,hemi:r}}(t),l=function(e){for(var t=0,i=0,n=e.length;i<n;i++){var r=e[i];r.castShadow&&(r instanceof Y.SpotLight&&t++,r instanceof Y.DirectionalLight&&!r.shadowCascade&&t++)}return t}(t),c=function(e){if(te&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=_.getParameter(_.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((t-20)/4);return void 0!==e&&e instanceof Y.SkinnedMesh&&(i=Math.min(e.skeleton.bones.length,i))<e.skeleton.bones.length&&Y.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)"),i}(n),u={precision:r,supportsVertexTextures:ee,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof Y.FogExp2,flatShading:e.shading===Y.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:h,skinning:e.skinning,maxBones:c,useVertexTexture:te&&n&&n.skeleton&&n.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:E.maxMorphTargets,maxMorphNormals:E.maxMorphNormals,maxDirLights:a.directional,maxPointLights:a.point,maxSpotLights:a.spot,maxHemiLights:a.hemi,maxShadows:l,shadowMapEnabled:E.shadowMapEnabled&&n.receiveShadow&&l>0,shadowMapType:E.shadowMapType,shadowMapDebug:E.shadowMapDebug,shadowMapCascade:E.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===Y.DoubleSide,flipSided:e.side===Y.BackSide},d=[];if(o?d.push(o):(d.push(e.fragmentShader),d.push(e.vertexShader)),void 0!==e.defines)for(var f in e.defines)d.push(f),d.push(e.defines[f]);for(var f in u)d.push(f),d.push(u[f]);for(var p,m=d.join(),g=0,v=S.length;g<v;g++){var y=S[g];if(y.code===m){(p=y).usedTimes++;break}}void 0===p&&(p=new Y.WebGLProgram(E,m,e,u),S.push(p),E.info.memory.programs=S.length),e.program=p;var b=p.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;for(var x="morphTarget",A=0;A<E.maxMorphTargets;A++)b[x+A]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;x="morphNormal";for(A=0;A<E.maxMorphNormals;A++)b[x+A]>=0&&e.numSupportedMorphNormals++}for(var w in e.uniformsList=[],e.__webglShader.uniforms){var C=e.program.uniforms[w];C&&e.uniformsList.push([e.__webglShader.uniforms[w],C])}}function qe(e){!0===e.transparent?H.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):H.setBlending(Y.NoBlending),H.setDepthTest(e.depthTest),H.setDepthWrite(e.depthWrite),H.setColorWrite(e.colorWrite),H.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Ke(e,i,n,r,o){I=0,r.needsUpdate&&(r.program&&Se(r),je(r,i,n,o),r.needsUpdate=!1),r.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(E.maxMorphTargets)));var s=!1,a=!1,l=!1,c=r.program,u=c.uniforms,d=r.__webglShader.uniforms;if(c.id!==A&&(_.useProgram(c.program),A=c.id,s=!0,a=!0,l=!0),r.id!==C&&(-1===C&&(l=!0),C=r.id,a=!0),(s||e!==M)&&(_.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),h&&_.uniform1f(u.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==M&&(M=e),(r instanceof Y.ShaderMaterial||r instanceof Y.MeshPhongMaterial||r.envMap)&&null!==u.cameraPosition&&(k.setFromMatrixPosition(e.matrixWorld),_.uniform3f(u.cameraPosition,k.x,k.y,k.z)),(r instanceof Y.MeshPhongMaterial||r instanceof Y.MeshLambertMaterial||r instanceof Y.MeshBasicMaterial||r instanceof Y.ShaderMaterial||r.skinning)&&null!==u.viewMatrix&&_.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements)),r.skinning)if(o.bindMatrix&&null!==u.bindMatrix&&_.uniformMatrix4fv(u.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&null!==u.bindMatrixInverse&&_.uniformMatrix4fv(u.bindMatrixInverse,!1,o.bindMatrixInverse.elements),te&&o.skeleton&&o.skeleton.useVertexTexture){if(null!==u.boneTexture){var f=Qe();_.uniform1i(u.boneTexture,f),E.setTexture(o.skeleton.boneTexture,f)}null!==u.boneTextureWidth&&_.uniform1i(u.boneTextureWidth,o.skeleton.boneTextureWidth),null!==u.boneTextureHeight&&_.uniform1i(u.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&null!==u.boneGlobalMatrices&&_.uniformMatrix4fv(u.boneGlobalMatrices,!1,o.skeleton.boneMatrices);return a&&(n&&r.fog&&function(e,t){e.fogColor.value=t.color,t instanceof Y.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof Y.FogExp2&&(e.fogDensity.value=t.density)}(d,n),(r instanceof Y.MeshPhongMaterial||r instanceof Y.MeshLambertMaterial||r.lights)&&(V&&(l=!0,function(e){var t,i,n,r,o,s,a,l,c=0,u=0,h=0,d=G,f=d.directional.colors,p=d.directional.positions,m=d.point.colors,g=d.point.positions,v=d.point.distances,y=d.point.decays,b=d.spot.colors,x=d.spot.positions,_=d.spot.distances,E=d.spot.directions,S=d.spot.anglesCos,A=d.spot.exponents,w=d.spot.decays,C=d.hemi.skyColors,T=d.hemi.groundColors,M=d.hemi.positions,I=0,P=0,L=0,R=0,D=0,O=0,B=0,N=0,U=0,V=0,z=0,H=0;for(t=0,i=e.length;t<i;t++)if(!(n=e[t]).onlyShadow)if(r=n.color,a=n.intensity,l=n.distance,n instanceof Y.AmbientLight){if(!n.visible)continue;c+=r.r,u+=r.g,h+=r.b}else if(n instanceof Y.DirectionalLight){if(D+=1,!n.visible)continue;F.setFromMatrixPosition(n.matrixWorld),k.setFromMatrixPosition(n.target.matrixWorld),F.sub(k),F.normalize(),p[U=3*I]=F.x,p[U+1]=F.y,p[U+2]=F.z,$e(f,U,r,a),I+=1}else if(n instanceof Y.PointLight){if(O+=1,!n.visible)continue;$e(m,V=3*P,r,a),k.setFromMatrixPosition(n.matrixWorld),g[V]=k.x,g[V+1]=k.y,g[V+2]=k.z,v[P]=l,y[P]=0===n.distance?0:n.decay,P+=1}else if(n instanceof Y.SpotLight){if(B+=1,!n.visible)continue;$e(b,z=3*L,r,a),F.setFromMatrixPosition(n.matrixWorld),x[z]=F.x,x[z+1]=F.y,x[z+2]=F.z,_[L]=l,k.setFromMatrixPosition(n.target.matrixWorld),F.sub(k),F.normalize(),E[z]=F.x,E[z+1]=F.y,E[z+2]=F.z,S[L]=Math.cos(n.angle),A[L]=n.exponent,w[L]=0===n.distance?0:n.decay,L+=1}else if(n instanceof Y.HemisphereLight){if(N+=1,!n.visible)continue;F.setFromMatrixPosition(n.matrixWorld),F.normalize(),M[H=3*R]=F.x,M[H+1]=F.y,M[H+2]=F.z,o=n.color,s=n.groundColor,$e(C,H,o,a),$e(T,H,s,a),R+=1}for(t=3*I,i=Math.max(f.length,3*D);t<i;t++)f[t]=0;for(t=3*P,i=Math.max(m.length,3*O);t<i;t++)m[t]=0;for(t=3*L,i=Math.max(b.length,3*B);t<i;t++)b[t]=0;for(t=3*R,i=Math.max(C.length,3*N);t<i;t++)C[t]=0;for(t=3*R,i=Math.max(T.length,3*N);t<i;t++)T[t]=0;d.directional.length=I,d.point.length=P,d.spot.length=L,d.hemi.length=R,d.ambient[0]=c,d.ambient[1]=u,d.ambient[2]=h}(i),V=!1),l?(!function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(d,G),Ye(d,!0)):Ye(d,!1)),(r instanceof Y.MeshBasicMaterial||r instanceof Y.MeshLambertMaterial||r instanceof Y.MeshPhongMaterial)&&function(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var i;t.map?i=t.map:t.specularMap?i=t.specularMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.alphaMap&&(i=t.alphaMap);if(void 0!==i){var n=i.offset,r=i.repeat;e.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof Y.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(d,r),r instanceof Y.LineBasicMaterial?Xe(d,r):r instanceof Y.LineDashedMaterial?(Xe(d,r),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(d,r)):r instanceof Y.PointCloudMaterial?function(e,i){if(e.psColor.value=i.color,e.opacity.value=i.opacity,e.size.value=i.size,e.scale.value=t.height/2,e.map.value=i.map,null!==i.map){var n=i.map.offset,r=i.map.repeat;e.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}}(d,r):r instanceof Y.MeshPhongMaterial?function(e,t){e.shininess.value=t.shininess,e.emissive.value=t.emissive,e.specular.value=t.specular,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,r):r instanceof Y.MeshLambertMaterial?function(e,t){e.emissive.value=t.emissive,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,r):r instanceof Y.MeshDepthMaterial?(d.mNear.value=e.near,d.mFar.value=e.far,d.opacity.value=r.opacity):r instanceof Y.MeshNormalMaterial&&(d.opacity.value=r.opacity),o.receiveShadow&&!r._shadowPass&&function(e,t){if(e.shadowMatrix)for(var i=0,n=0,r=t.length;n<r;n++){var o=t[n];o.castShadow&&((o instanceof Y.SpotLight||o instanceof Y.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[i]=o.shadowMap,e.shadowMapSize.value[i]=o.shadowMapSize,e.shadowMatrix.value[i]=o.shadowMatrix,e.shadowDarkness.value[i]=o.shadowDarkness,e.shadowBias.value[i]=o.shadowBias,i++))}}(d,i),function(e){for(var t,i,n,r=0,o=e.length;r<o;r++){var s=e[r][0];if(!1!==s.needsUpdate){var a=s.type,l=s.value,c=e[r][1];switch(a){case"1i":case"i":_.uniform1i(c,l);break;case"1f":case"f":_.uniform1f(c,l);break;case"2f":_.uniform2f(c,l[0],l[1]);break;case"3f":_.uniform3f(c,l[0],l[1],l[2]);break;case"4f":_.uniform4f(c,l[0],l[1],l[2],l[3]);break;case"1iv":case"iv1":_.uniform1iv(c,l);break;case"3iv":case"iv":_.uniform3iv(c,l);break;case"1fv":case"fv1":_.uniform1fv(c,l);break;case"2fv":_.uniform2fv(c,l);break;case"3fv":case"fv":_.uniform3fv(c,l);break;case"4fv":_.uniform4fv(c,l);break;case"Matrix3fv":_.uniformMatrix3fv(c,!1,l);break;case"Matrix4fv":_.uniformMatrix4fv(c,!1,l);break;case"v2":_.uniform2f(c,l.x,l.y);break;case"v3":_.uniform3f(c,l.x,l.y,l.z);break;case"v4":_.uniform4f(c,l.x,l.y,l.z,l.w);break;case"c":_.uniform3f(c,l.r,l.g,l.b);break;case"v2v":void 0===s._array&&(s._array=new Float32Array(2*l.length));for(var u=0,h=l.length;u<h;u++)n=2*u,s._array[n]=l[u].x,s._array[n+1]=l[u].y;_.uniform2fv(c,s._array);break;case"v3v":void 0===s._array&&(s._array=new Float32Array(3*l.length));for(u=0,h=l.length;u<h;u++)n=3*u,s._array[n]=l[u].x,s._array[n+1]=l[u].y,s._array[n+2]=l[u].z;_.uniform3fv(c,s._array);break;case"v4v":void 0===s._array&&(s._array=new Float32Array(4*l.length));for(u=0,h=l.length;u<h;u++)n=4*u,s._array[n]=l[u].x,s._array[n+1]=l[u].y,s._array[n+2]=l[u].z,s._array[n+3]=l[u].w;_.uniform4fv(c,s._array);break;case"m3":_.uniformMatrix3fv(c,!1,l.elements);break;case"m3v":void 0===s._array&&(s._array=new Float32Array(9*l.length));for(u=0,h=l.length;u<h;u++)l[u].flattenToArrayOffset(s._array,9*u);_.uniformMatrix3fv(c,!1,s._array);break;case"m4":_.uniformMatrix4fv(c,!1,l.elements);break;case"m4v":void 0===s._array&&(s._array=new Float32Array(16*l.length));for(u=0,h=l.length;u<h;u++)l[u].flattenToArrayOffset(s._array,16*u);_.uniformMatrix4fv(c,!1,s._array);break;case"t":if(t=l,i=Qe(),_.uniform1i(c,i),!t)continue;t instanceof Y.CubeTexture||t.image instanceof Array&&6===t.image.length?tt(t,i):t instanceof Y.WebGLRenderTargetCube?it(t,i):E.setTexture(t,i);break;case"tv":void 0===s._array&&(s._array=[]);for(u=0,h=s.value.length;u<h;u++)s._array[u]=Qe();_.uniform1iv(c,s._array);for(u=0,h=s.value.length;u<h;u++)t=s.value[u],i=s._array[u],t&&E.setTexture(t,i);break;default:Y.warn("THREE.WebGLRenderer: Unknown uniform type: "+a)}}}}(r.uniformsList)),function(e,t){_.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&_.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}(u,o),null!==u.modelMatrix&&_.uniformMatrix4fv(u.modelMatrix,!1,o.matrixWorld.elements),c}function Xe(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Ye(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Qe(){var e=I;return e>=Q&&Y.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Q),I+=1,e}function Ze(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function $e(e,t,i,n){e[t]=i.r*n,e[t+1]=i.g*n,e[t+2]=i.b*n}function Je(e,t,i){var n;i?(_.texParameteri(e,_.TEXTURE_WRAP_S,st(t.wrapS)),_.texParameteri(e,_.TEXTURE_WRAP_T,st(t.wrapT)),_.texParameteri(e,_.TEXTURE_MAG_FILTER,st(t.magFilter)),_.texParameteri(e,_.TEXTURE_MIN_FILTER,st(t.minFilter))):(_.texParameteri(e,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(e,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),t.wrapS===Y.ClampToEdgeWrapping&&t.wrapT===Y.ClampToEdgeWrapping||Y.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),_.texParameteri(e,_.TEXTURE_MAG_FILTER,ot(t.magFilter)),_.texParameteri(e,_.TEXTURE_MIN_FILTER,ot(t.minFilter)),t.minFilter!==Y.NearestFilter&&t.minFilter!==Y.LinearFilter&&Y.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(n=W.get("EXT_texture_filter_anisotropic"))&&t.type!==Y.FloatType&&t.type!==Y.HalfFloatType&&(t.anisotropy>1||t.__currentAnisotropy)&&(_.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,E.getMaxAnisotropy())),t.__currentAnisotropy=t.anisotropy)}function et(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height),n=document.createElement("canvas");return n.width=Math.floor(e.width*i),n.height=Math.floor(e.height*i),n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),Y.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function tt(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",ge),e.image.__webglTextureCube=_.createTexture(),E.info.memory.textures++),_.activeTexture(_.TEXTURE0+t),_.bindTexture(_.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof Y.CompressedTexture,n=e.image[0]instanceof Y.DataTexture,r=[],o=0;o<6;o++)!E.autoScaleCubemaps||i||n?r[o]=n?e.image[o].image:e.image[o]:r[o]=et(e.image[o],J);var s=r[0],a=Y.Math.isPowerOfTwo(s.width)&&Y.Math.isPowerOfTwo(s.height),l=st(e.format),c=st(e.type);Je(_.TEXTURE_CUBE_MAP,e,a);for(o=0;o<6;o++)if(i)for(var u,h=r[o].mipmaps,d=0,f=h.length;d<f;d++)u=h[d],e.format!==Y.RGBAFormat&&e.format!==Y.RGBFormat?se().indexOf(l)>-1?_.compressedTexImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,u.width,u.height,0,u.data):Y.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,u.width,u.height,0,l,c,u.data);else n?_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,r[o].width,r[o].height,0,l,c,r[o].data):_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,l,c,r[o]);e.generateMipmaps&&a&&_.generateMipmap(_.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else _.activeTexture(_.TEXTURE0+t),_.bindTexture(_.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function it(e,t){_.activeTexture(_.TEXTURE0+t),_.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture)}function nt(e,t,i){_.bindFramebuffer(_.FRAMEBUFFER,e),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function rt(e,t){_.bindRenderbuffer(_.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_COMPONENT16,t.width,t.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_STENCIL,t.width,t.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,e)):_.renderbufferStorage(_.RENDERBUFFER,_.RGBA4,t.width,t.height)}function ot(e){return e===Y.NearestFilter||e===Y.NearestMipMapNearestFilter||e===Y.NearestMipMapLinearFilter?_.NEAREST:_.LINEAR}function st(e){var t;if(e===Y.RepeatWrapping)return _.REPEAT;if(e===Y.ClampToEdgeWrapping)return _.CLAMP_TO_EDGE;if(e===Y.MirroredRepeatWrapping)return _.MIRRORED_REPEAT;if(e===Y.NearestFilter)return _.NEAREST;if(e===Y.NearestMipMapNearestFilter)return _.NEAREST_MIPMAP_NEAREST;if(e===Y.NearestMipMapLinearFilter)return _.NEAREST_MIPMAP_LINEAR;if(e===Y.LinearFilter)return _.LINEAR;if(e===Y.LinearMipMapNearestFilter)return _.LINEAR_MIPMAP_NEAREST;if(e===Y.LinearMipMapLinearFilter)return _.LINEAR_MIPMAP_LINEAR;if(e===Y.UnsignedByteType)return _.UNSIGNED_BYTE;if(e===Y.UnsignedShort4444Type)return _.UNSIGNED_SHORT_4_4_4_4;if(e===Y.UnsignedShort5551Type)return _.UNSIGNED_SHORT_5_5_5_1;if(e===Y.UnsignedShort565Type)return _.UNSIGNED_SHORT_5_6_5;if(e===Y.ByteType)return _.BYTE;if(e===Y.ShortType)return _.SHORT;if(e===Y.UnsignedShortType)return _.UNSIGNED_SHORT;if(e===Y.IntType)return _.INT;if(e===Y.UnsignedIntType)return _.UNSIGNED_INT;if(e===Y.FloatType)return _.FLOAT;if(null!==(t=W.get("OES_texture_half_float"))&&e===Y.HalfFloatType)return t.HALF_FLOAT_OES;if(e===Y.AlphaFormat)return _.ALPHA;if(e===Y.RGBFormat)return _.RGB;if(e===Y.RGBAFormat)return _.RGBA;if(e===Y.LuminanceFormat)return _.LUMINANCE;if(e===Y.LuminanceAlphaFormat)return _.LUMINANCE_ALPHA;if(e===Y.AddEquation)return _.FUNC_ADD;if(e===Y.SubtractEquation)return _.FUNC_SUBTRACT;if(e===Y.ReverseSubtractEquation)return _.FUNC_REVERSE_SUBTRACT;if(e===Y.ZeroFactor)return _.ZERO;if(e===Y.OneFactor)return _.ONE;if(e===Y.SrcColorFactor)return _.SRC_COLOR;if(e===Y.OneMinusSrcColorFactor)return _.ONE_MINUS_SRC_COLOR;if(e===Y.SrcAlphaFactor)return _.SRC_ALPHA;if(e===Y.OneMinusSrcAlphaFactor)return _.ONE_MINUS_SRC_ALPHA;if(e===Y.DstAlphaFactor)return _.DST_ALPHA;if(e===Y.OneMinusDstAlphaFactor)return _.ONE_MINUS_DST_ALPHA;if(e===Y.DstColorFactor)return _.DST_COLOR;if(e===Y.OneMinusDstColorFactor)return _.ONE_MINUS_DST_COLOR;if(e===Y.SrcAlphaSaturateFactor)return _.SRC_ALPHA_SATURATE;if(null!==(t=W.get("WEBGL_compressed_texture_s3tc"))){if(e===Y.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Y.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Y.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Y.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=W.get("WEBGL_compressed_texture_pvrtc"))){if(e===Y.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Y.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Y.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Y.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=W.get("EXT_blend_minmax"))){if(e===Y.MinEquation)return t.MIN_EXT;if(e===Y.MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===Y.CullFaceNone?_.disable(_.CULL_FACE):(t===Y.FrontFaceDirectionCW?_.frontFace(_.CW):_.frontFace(_.CCW),e===Y.CullFaceBack?_.cullFace(_.BACK):e===Y.CullFaceFront?_.cullFace(_.FRONT):_.cullFace(_.FRONT_AND_BACK),_.enable(_.CULL_FACE))},this.setMaterialFaces=function(e){H.setDoubleSided(e.side===Y.DoubleSide),H.setFlipSided(e.side===Y.BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",ge),e.__webglTexture=_.createTexture(),E.info.memory.textures++),_.bindTexture(_.TEXTURE_2D,e.__webglTexture),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,e.flipY),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),_.pixelStorei(_.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=et(e.image,$);var t=e.image,i=Y.Math.isPowerOfTwo(t.width)&&Y.Math.isPowerOfTwo(t.height),n=st(e.format),r=st(e.type);Je(_.TEXTURE_2D,e,i);var o,s=e.mipmaps;if(e instanceof Y.DataTexture)if(s.length>0&&i){for(var a=0,l=s.length;a<l;a++)o=s[a],_.texImage2D(_.TEXTURE_2D,a,n,o.width,o.height,0,n,r,o.data);e.generateMipmaps=!1}else _.texImage2D(_.TEXTURE_2D,0,n,t.width,t.height,0,n,r,t.data);else if(e instanceof Y.CompressedTexture)for(a=0,l=s.length;a<l;a++)o=s[a],e.format!==Y.RGBAFormat&&e.format!==Y.RGBFormat?se().indexOf(n)>-1?_.compressedTexImage2D(_.TEXTURE_2D,a,n,o.width,o.height,0,o.data):Y.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_.texImage2D(_.TEXTURE_2D,a,n,o.width,o.height,0,n,r,o.data);else if(s.length>0&&i){for(a=0,l=s.length;a<l;a++)o=s[a],_.texImage2D(_.TEXTURE_2D,a,n,n,r,o);e.generateMipmaps=!1}else _.texImage2D(_.TEXTURE_2D,0,n,n,r,e.image);e.generateMipmaps&&i&&_.generateMipmap(_.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){_.activeTexture(_.TEXTURE0+t),e.needsUpdate?E.uploadTexture(e):_.bindTexture(_.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,i,n,r,o,s=e instanceof Y.WebGLRenderTargetCube;if(e&&void 0===e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",ve),e.__webglTexture=_.createTexture(),E.info.memory.textures++;var a=Y.Math.isPowerOfTwo(e.width)&&Y.Math.isPowerOfTwo(e.height),l=st(e.format),c=st(e.type);if(s){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],_.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture),Je(_.TEXTURE_CUBE_MAP,e,a);for(var u=0;u<6;u++)e.__webglFramebuffer[u]=_.createFramebuffer(),e.__webglRenderbuffer[u]=_.createRenderbuffer(),_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,l,e.width,e.height,0,l,c,null),nt(e.__webglFramebuffer[u],e,_.TEXTURE_CUBE_MAP_POSITIVE_X+u),rt(e.__webglRenderbuffer[u],e);a&&_.generateMipmap(_.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=_.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=_.createRenderbuffer(),_.bindTexture(_.TEXTURE_2D,e.__webglTexture),Je(_.TEXTURE_2D,e,a),_.texImage2D(_.TEXTURE_2D,0,l,e.width,e.height,0,l,c,null),nt(e.__webglFramebuffer,e,_.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,e.__webglRenderbuffer):rt(e.__webglRenderbuffer,e),a&&_.generateMipmap(_.TEXTURE_2D);s?_.bindTexture(_.TEXTURE_CUBE_MAP,null):_.bindTexture(_.TEXTURE_2D,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null)}e?(t=s?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,n=e.height,r=0,o=0):(t=null,i=R,n=D,r=P,o=L),t!==w&&(_.bindFramebuffer(_.FRAMEBUFFER,t),_.viewport(r,o,i,n),w=t),O=i,B=n},this.readRenderTargetPixels=function(e,t,i,n,r,o){if(e instanceof Y.WebGLRenderTarget){if(e.__webglFramebuffer){if(e.format!==Y.RGBAFormat)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");var s=!1;e.__webglFramebuffer!==w&&(_.bindFramebuffer(_.FRAMEBUFFER,e.__webglFramebuffer),s=!0),_.checkFramebufferStatus(_.FRAMEBUFFER)===_.FRAMEBUFFER_COMPLETE?_.readPixels(t,i,n,r,_.RGBA,_.UNSIGNED_BYTE,o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&_.bindFramebuffer(_.FRAMEBUFFER,w)}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.initMaterial=function(){Y.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){Y.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){Y.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){Y.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},Y.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:Y.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:Y.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:Y.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:Y.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new Y.Vector2(0,0),this.repeat=new Y.Vector2(1,1),this.format=void 0!==i.format?i.format:Y.RGBAFormat,this.type=void 0!==i.type?i.type:Y.UnsignedByteType,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=void 0!==i.shareDepthFrom?i.shareDepthFrom:null},Y.WebGLRenderTarget.prototype={constructor:Y.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new Y.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Y.EventDispatcher.prototype.apply(Y.WebGLRenderTarget.prototype),Y.WebGLRenderTargetCube=function(e,t,i){Y.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},Y.WebGLRenderTargetCube.prototype=Object.create(Y.WebGLRenderTarget.prototype),Y.WebGLRenderTargetCube.prototype.constructor=Y.WebGLRenderTargetCube,Y.WebGLExtensions=function(e){var t={};this.get=function(i){if(void 0!==t[i])return t[i];var n;switch(i){case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return null===n&&Y.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=n,n}},Y.WebGLProgram=(N=0,function(e,t,i,n){var r=e,o=r.context,s=i.defines,a=i.__webglShader.uniforms,l=i.attributes,c=i.__webglShader.vertexShader,u=i.__webglShader.fragmentShader,h=i.index0AttributeName;void 0===h&&!0===n.morphTargets&&(h="position");var d="SHADOWMAP_TYPE_BASIC";n.shadowMapType===Y.PCFShadowMap?d="SHADOWMAP_TYPE_PCF":n.shadowMapType===Y.PCFSoftShadowMap&&(d="SHADOWMAP_TYPE_PCF_SOFT");var f="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(n.envMap){switch(i.envMap.mapping){case Y.CubeReflectionMapping:case Y.CubeRefractionMapping:f="ENVMAP_TYPE_CUBE";break;case Y.EquirectangularReflectionMapping:case Y.EquirectangularRefractionMapping:f="ENVMAP_TYPE_EQUIREC";break;case Y.SphericalReflectionMapping:f="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case Y.CubeRefractionMapping:case Y.EquirectangularRefractionMapping:p="ENVMAP_MODE_REFRACTION"}switch(i.combine){case Y.MultiplyOperation:m="ENVMAP_BLENDING_MULTIPLY";break;case Y.MixOperation:m="ENVMAP_BLENDING_MIX";break;case Y.AddOperation:m="ENVMAP_BLENDING_ADD"}}var g,v,y=e.gammaFactor>0?e.gammaFactor:1,b=function(e){var t,i,n=[];for(var r in e)!1!==(t=e[r])&&(i="#define "+r+" "+t,n.push(i));return n.join("\n")}(s),x=o.createProgram();i instanceof Y.RawShaderMaterial?(g="",v=""):(g=["precision "+n.precision+" float;","precision "+n.precision+" int;",b,n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",r.gammaInput?"#define GAMMA_INPUT":"",r.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n"),v=["precision "+n.precision+" float;","precision "+n.precision+" int;",n.bumpMap||n.normalMap||n.flatShading?"#extension GL_OES_standard_derivatives : enable":"",b,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",r.gammaInput?"#define GAMMA_INPUT":"",r.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.envMap?"#define "+p:"",n.envMap?"#define "+m:"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.flatShading?"#define FLAT_SHADED":"",n.metal?"#define METAL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var _=new Y.WebGLShader(o,o.VERTEX_SHADER,g+c),E=new Y.WebGLShader(o,o.FRAGMENT_SHADER,v+u);o.attachShader(x,_),o.attachShader(x,E),void 0!==h&&o.bindAttribLocation(x,0,h),o.linkProgram(x);var S=o.getProgramInfoLog(x);!1===o.getProgramParameter(x,o.LINK_STATUS)&&Y.error("THREE.WebGLProgram: shader error: "+o.getError(),"gl.VALIDATE_STATUS",o.getProgramParameter(x,o.VALIDATE_STATUS),"gl.getPRogramInfoLog",S),""!==S&&Y.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+S),o.deleteShader(_),o.deleteShader(E);var A=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];for(var w in n.useVertexTexture?(A.push("boneTexture"),A.push("boneTextureWidth"),A.push("boneTextureHeight")):A.push("boneGlobalMatrices"),n.logarithmicDepthBuffer&&A.push("logDepthBufFC"),a)A.push(w);this.uniforms=function(e,t,i){for(var n={},r=0,o=i.length;r<o;r++){var s=i[r];n[s]=e.getUniformLocation(t,s)}return n}(o,x,A),A=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var C=0;C<n.maxMorphTargets;C++)A.push("morphTarget"+C);for(C=0;C<n.maxMorphNormals;C++)A.push("morphNormal"+C);for(var T in l)A.push(T);return this.attributes=function(e,t,i){for(var n={},r=0,o=i.length;r<o;r++){var s=i[r];n[s]=e.getAttribLocation(t,s)}return n}(o,x,A),this.attributesKeys=Object.keys(this.attributes),this.id=N++,this.code=t,this.usedTimes=1,this.program=x,this.vertexShader=_,this.fragmentShader=E,this}),Y.WebGLShader=function(e,t,i){var n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),!1===e.getShaderParameter(n,e.COMPILE_STATUS)&&Y.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&Y.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(n),function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(i)),n},Y.WebGLState=function(e,t){var i=new Uint8Array(16),n=new Uint8Array(16),r=null,o=null,s=null,a=null,l=null,c=null,u=null,h=null,d=null,f=null,p=null,m=null,g=null,v=null,y=null,b=null;this.initAttributes=function(){for(var e=0,t=i.length;e<t;e++)i[e]=0},this.enableAttribute=function(t){i[t]=1,0===n[t]&&(e.enableVertexAttribArray(t),n[t]=1)},this.disableUnusedAttributes=function(){for(var t=0,r=n.length;t<r;t++)n[t]!==i[t]&&(e.disableVertexAttribArray(t),n[t]=0)},this.setBlending=function(i,n,h,d,f,p,m){i!==r&&(i===Y.NoBlending?e.disable(e.BLEND):i===Y.AdditiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):i===Y.SubtractiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):i===Y.MultiplyBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):i===Y.CustomBlending?e.enable(e.BLEND):(e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),r=i),i===Y.CustomBlending?(f=f||n,p=p||h,m=m||d,n===o&&f===l||(e.blendEquationSeparate(t(n),t(f)),o=n,l=f),h===s&&d===a&&p===c&&m===u||(e.blendFuncSeparate(t(h),t(d),t(p),t(m)),s=h,a=d,c=p,u=m)):(o=null,s=null,a=null,l=null,c=null,u=null)},this.setDepthTest=function(t){h!==t&&(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),h=t)},this.setDepthWrite=function(t){d!==t&&(e.depthMask(t),d=t)},this.setColorWrite=function(t){f!==t&&(e.colorMask(t,t,t,t),f=t)},this.setDoubleSided=function(t){p!==t&&(t?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),p=t)},this.setFlipSided=function(t){m!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),m=t)},this.setLineWidth=function(t){t!==g&&(e.lineWidth(t),g=t)},this.setPolygonOffset=function(t,i,n){v!==t&&(t?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),v=t),!t||y===i&&b===n||(e.polygonOffset(i,n),y=i,b=n)},this.reset=function(){for(var e=0;e<n.length;e++)n[e]=0;r=null,h=null,d=null,f=null,p=null,m=null}},Y.LensFlarePlugin=function(e,t){var i,n,r,o,s,a,l,c,u=e.context,h=function(){var t,h=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),d=new Uint16Array([0,1,2,0,2,3]);i=u.createBuffer(),n=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,i),u.bufferData(u.ARRAY_BUFFER,h,u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n),u.bufferData(u.ELEMENT_ARRAY_BUFFER,d,u.STATIC_DRAW),l=u.createTexture(),c=u.createTexture(),u.bindTexture(u.TEXTURE_2D,l),u.texImage2D(u.TEXTURE_2D,0,u.RGB,16,16,0,u.RGB,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.bindTexture(u.TEXTURE_2D,c),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,16,16,0,u.RGBA,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),t=(a=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0)?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},r=function(t){var i=u.createProgram(),n=u.createShader(u.FRAGMENT_SHADER),r=u.createShader(u.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return u.shaderSource(n,o+t.fragmentShader),u.shaderSource(r,o+t.vertexShader),u.compileShader(n),u.compileShader(r),u.attachShader(i,n),u.attachShader(i,r),u.linkProgram(i),i}(t),o={vertex:u.getAttribLocation(r,"position"),uv:u.getAttribLocation(r,"uv")},s={renderType:u.getUniformLocation(r,"renderType"),map:u.getUniformLocation(r,"map"),occlusionMap:u.getUniformLocation(r,"occlusionMap"),opacity:u.getUniformLocation(r,"opacity"),color:u.getUniformLocation(r,"color"),scale:u.getUniformLocation(r,"scale"),rotation:u.getUniformLocation(r,"rotation"),screenPosition:u.getUniformLocation(r,"screenPosition")}};this.render=function(d,f,p,m){if(0!==t.length){var g=new Y.Vector3,v=m/p,y=.5*p,b=.5*m,x=16/m,_=new Y.Vector2(x*v,x),E=new Y.Vector3(1,1,0),S=new Y.Vector2(1,1);void 0===r&&h(),u.useProgram(r),u.enableVertexAttribArray(o.vertex),u.enableVertexAttribArray(o.uv),u.uniform1i(s.occlusionMap,0),u.uniform1i(s.map,1),u.bindBuffer(u.ARRAY_BUFFER,i),u.vertexAttribPointer(o.vertex,2,u.FLOAT,!1,16,0),u.vertexAttribPointer(o.uv,2,u.FLOAT,!1,16,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n),u.disable(u.CULL_FACE),u.depthMask(!1);for(var A=0,w=t.length;A<w;A++){x=16/m,_.set(x*v,x);var C=t[A];if(g.set(C.matrixWorld.elements[12],C.matrixWorld.elements[13],C.matrixWorld.elements[14]),g.applyMatrix4(f.matrixWorldInverse),g.applyProjection(f.projectionMatrix),E.copy(g),S.x=E.x*y+y,S.y=E.y*b+b,a||S.x>0&&S.x<p&&S.y>0&&S.y<m){u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,l),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGB,S.x-8,S.y-8,16,16,0),u.uniform1i(s.renderType,0),u.uniform2f(s.scale,_.x,_.y),u.uniform3f(s.screenPosition,E.x,E.y,E.z),u.disable(u.BLEND),u.enable(u.DEPTH_TEST),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,S.x-8,S.y-8,16,16,0),u.uniform1i(s.renderType,1),u.disable(u.DEPTH_TEST),u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,l),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),C.positionScreen.copy(E),C.customUpdateCallback?C.customUpdateCallback(C):C.updateLensFlares(),u.uniform1i(s.renderType,2),u.enable(u.BLEND);for(var T=0,M=C.lensFlares.length;T<M;T++){var I=C.lensFlares[T];I.opacity>.001&&I.scale>.001&&(E.x=I.x,E.y=I.y,E.z=I.z,x=I.size*I.scale/m,_.x=x*v,_.y=x,u.uniform3f(s.screenPosition,E.x,E.y,E.z),u.uniform2f(s.scale,_.x,_.y),u.uniform1f(s.rotation,I.rotation),u.uniform1f(s.opacity,I.opacity),u.uniform3f(s.color,I.color.r,I.color.g,I.color.b),e.state.setBlending(I.blending,I.blendEquation,I.blendSrc,I.blendDst),e.setTexture(I.texture,1),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0))}}}u.enable(u.CULL_FACE),u.enable(u.DEPTH_TEST),u.depthMask(!0),e.resetGLState()}}},Y.ShadowMapPlugin=function(e,t,i,n){var r,o,s,a,l=e.context,c=new Y.Frustum,u=new Y.Matrix4,h=new Y.Vector3,d=new Y.Vector3,f=new Y.Vector3,p=[],m=Y.ShaderLib.depthRGBA,g=Y.UniformsUtils.clone(m.uniforms);function v(e,t,n){if(t.visible){var r=i[t.id];if(r&&t.castShadow&&(!1===t.frustumCulled||!0===c.intersectsObject(t)))for(var o=0,s=r.length;o<s;o++){var a=r[o];t._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),p.push(a)}for(o=0,s=t.children.length;o<s;o++)v(e,t.children[o],n)}}function y(e,t){var i=new Y.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var n=i.pointsWorld,r=i.pointsFrustum,o=0;o<8;o++)n[o]=new Y.Vector3,r[o]=new Y.Vector3;var s=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t];return r[0].set(-1,-1,s),r[1].set(1,-1,s),r[2].set(-1,1,s),r[3].set(1,1,s),r[4].set(-1,-1,a),r[5].set(1,-1,a),r[6].set(-1,1,a),r[7].set(1,1,a),i}function b(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var n=e.shadowCascadeNearZ[t],r=e.shadowCascadeFarZ[t],o=i.pointsFrustum;o[0].z=n,o[1].z=n,o[2].z=n,o[3].z=n,o[4].z=r,o[5].z=r,o[6].z=r,o[7].z=r}function x(e,t){var i=t.shadowCamera,n=t.pointsFrustum,r=t.pointsWorld;h.set(1/0,1/0,1/0),d.set(-1/0,-1/0,-1/0);for(var o=0;o<8;o++){var s=r[o];s.copy(n[o]),s.unproject(e),s.applyMatrix4(i.matrixWorldInverse),s.x<h.x&&(h.x=s.x),s.x>d.x&&(d.x=s.x),s.y<h.y&&(h.y=s.y),s.y>d.y&&(d.y=s.y),s.z<h.z&&(h.z=s.z),s.z>d.z&&(d.z=s.z)}i.left=h.x,i.right=d.x,i.top=d.y,i.bottom=h.y,i.updateProjectionMatrix()}function _(e){return e.material instanceof Y.MeshFaceMaterial?e.material.materials[0]:e.material}r=new Y.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader}),o=new Y.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0}),s=new Y.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,skinning:!0}),a=new Y.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0,skinning:!0}),r._shadowPass=!0,o._shadowPass=!0,s._shadowPass=!0,a._shadowPass=!0,this.render=function(i,h){if(!1!==e.shadowMapEnabled){var d,m,g,E,S,A,w,C,T,M,I,P,L,R=[],D=0,O=null;for(l.clearColor(1,1,1,1),l.disable(l.BLEND),l.enable(l.CULL_FACE),l.frontFace(l.CCW),e.shadowMapCullFace===Y.CullFaceFront?l.cullFace(l.FRONT):l.cullFace(l.BACK),e.state.setDepthTest(!0),d=0,m=t.length;d<m;d++)if((L=t[d]).castShadow)if(L instanceof Y.DirectionalLight&&L.shadowCascade)for(S=0;S<L.shadowCascadeCount;S++){var B;if(L.shadowCascadeArray[S])B=L.shadowCascadeArray[S];else{(B=y(L,S)).originalCamera=h;var N=new Y.Gyroscope;N.position.copy(L.shadowCascadeOffset),N.add(B),N.add(B.target),h.add(N),L.shadowCascadeArray[S]=B}b(L,S),R[D]=B,D++}else R[D]=L,D++;for(d=0,m=R.length;d<m;d++){if(!(L=R[d]).shadowMap){var U=Y.LinearFilter;e.shadowMapType===Y.PCFSoftShadowMap&&(U=Y.NearestFilter);var k={minFilter:U,magFilter:U,format:Y.RGBAFormat};L.shadowMap=new Y.WebGLRenderTarget(L.shadowMapWidth,L.shadowMapHeight,k),L.shadowMapSize=new Y.Vector2(L.shadowMapWidth,L.shadowMapHeight),L.shadowMatrix=new Y.Matrix4}if(!L.shadowCamera){if(L instanceof Y.SpotLight)L.shadowCamera=new Y.PerspectiveCamera(L.shadowCameraFov,L.shadowMapWidth/L.shadowMapHeight,L.shadowCameraNear,L.shadowCameraFar);else{if(!(L instanceof Y.DirectionalLight)){Y.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",L);continue}L.shadowCamera=new Y.OrthographicCamera(L.shadowCameraLeft,L.shadowCameraRight,L.shadowCameraTop,L.shadowCameraBottom,L.shadowCameraNear,L.shadowCameraFar)}i.add(L.shadowCamera),!0===i.autoUpdate&&i.updateMatrixWorld()}var F,V,G;for(L.shadowCameraVisible&&!L.cameraHelper&&(L.cameraHelper=new Y.CameraHelper(L.shadowCamera),i.add(L.cameraHelper)),L.isVirtual&&B.originalCamera==h&&x(h,L),A=L.shadowMap,w=L.shadowMatrix,(C=L.shadowCamera).position.setFromMatrixPosition(L.matrixWorld),f.setFromMatrixPosition(L.target.matrixWorld),C.lookAt(f),C.updateMatrixWorld(),C.matrixWorldInverse.getInverse(C.matrixWorld),L.cameraHelper&&(L.cameraHelper.visible=L.shadowCameraVisible),L.shadowCameraVisible&&L.cameraHelper.update(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(C.projectionMatrix),w.multiply(C.matrixWorldInverse),u.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse),c.setFromMatrix(u),e.setRenderTarget(A),e.clear(),p.length=0,v(i,i,C),g=0,E=p.length;g<E;g++)P=(I=p[g]).object,T=I.buffer,F=_(P),V=void 0!==P.geometry.morphTargets&&P.geometry.morphTargets.length>0&&F.morphTargets,G=P instanceof Y.SkinnedMesh&&F.skinning,M=P.customDepthMaterial?P.customDepthMaterial:G?V?a:s:V?o:r,e.setMaterialFaces(F),T instanceof Y.BufferGeometry?e.renderBufferDirect(C,t,O,M,T,P):e.renderBuffer(C,t,O,M,T,P);for(g=0,E=n.length;g<E;g++)(P=(I=n[g]).object).visible&&P.castShadow&&(P._modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,P.matrixWorld),e.renderImmediateObject(C,t,O,r,P))}var z=e.getClearColor(),H=e.getClearAlpha();l.clearColor(z.r,z.g,z.b,H),l.enable(l.BLEND),e.shadowMapCullFace===Y.CullFaceFront&&l.cullFace(l.BACK),e.resetGLState()}}},Y.SpritePlugin=function(e,t){var i,n,r,o,s,a,l=e.context,c=new Y.Vector3,u=new Y.Quaternion,h=new Y.Vector3,d=function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),c=new Uint16Array([0,1,2,0,2,3]);i=l.createBuffer(),n=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,i),l.bufferData(l.ARRAY_BUFFER,t,l.STATIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),l.bufferData(l.ELEMENT_ARRAY_BUFFER,c,l.STATIC_DRAW),r=function(){var t=l.createProgram(),i=l.createShader(l.VERTEX_SHADER),n=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),l.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),l.compileShader(i),l.compileShader(n),l.attachShader(t,i),l.attachShader(t,n),l.linkProgram(t),t}(),o={position:l.getAttribLocation(r,"position"),uv:l.getAttribLocation(r,"uv")},s={uvOffset:l.getUniformLocation(r,"uvOffset"),uvScale:l.getUniformLocation(r,"uvScale"),rotation:l.getUniformLocation(r,"rotation"),scale:l.getUniformLocation(r,"scale"),color:l.getUniformLocation(r,"color"),map:l.getUniformLocation(r,"map"),opacity:l.getUniformLocation(r,"opacity"),modelViewMatrix:l.getUniformLocation(r,"modelViewMatrix"),projectionMatrix:l.getUniformLocation(r,"projectionMatrix"),fogType:l.getUniformLocation(r,"fogType"),fogDensity:l.getUniformLocation(r,"fogDensity"),fogNear:l.getUniformLocation(r,"fogNear"),fogFar:l.getUniformLocation(r,"fogFar"),fogColor:l.getUniformLocation(r,"fogColor"),alphaTest:l.getUniformLocation(r,"alphaTest")};var u=document.createElement("canvas");u.width=8,u.height=8;var h=u.getContext("2d");h.fillStyle="white",h.fillRect(0,0,8,8),(a=new Y.Texture(u)).needsUpdate=!0};function f(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(p,m){if(0!==t.length){void 0===r&&d(),l.useProgram(r),l.enableVertexAttribArray(o.position),l.enableVertexAttribArray(o.uv),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.bindBuffer(l.ARRAY_BUFFER,i),l.vertexAttribPointer(o.position,2,l.FLOAT,!1,16,0),l.vertexAttribPointer(o.uv,2,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),l.uniformMatrix4fv(s.projectionMatrix,!1,m.projectionMatrix.elements),l.activeTexture(l.TEXTURE0),l.uniform1i(s.map,0);var g=0,v=0,y=p.fog;y?(l.uniform3f(s.fogColor,y.color.r,y.color.g,y.color.b),y instanceof Y.Fog?(l.uniform1f(s.fogNear,y.near),l.uniform1f(s.fogFar,y.far),l.uniform1i(s.fogType,1),g=1,v=1):y instanceof Y.FogExp2&&(l.uniform1f(s.fogDensity,y.density),l.uniform1i(s.fogType,2),g=2,v=2)):(l.uniform1i(s.fogType,0),g=0,v=0);for(var b=0,x=t.length;b<x;b++){(E=t[b])._modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,E.matrixWorld),E.z=-E._modelViewMatrix.elements[14]}t.sort(f);var _=[];for(b=0,x=t.length;b<x;b++){var E,S=(E=t[b]).material;l.uniform1f(s.alphaTest,S.alphaTest),l.uniformMatrix4fv(s.modelViewMatrix,!1,E._modelViewMatrix.elements),E.matrixWorld.decompose(c,u,h),_[0]=h.x,_[1]=h.y;var A=0;p.fog&&S.fog&&(A=v),g!==A&&(l.uniform1i(s.fogType,A),g=A),null!==S.map?(l.uniform2f(s.uvOffset,S.map.offset.x,S.map.offset.y),l.uniform2f(s.uvScale,S.map.repeat.x,S.map.repeat.y)):(l.uniform2f(s.uvOffset,0,0),l.uniform2f(s.uvScale,1,1)),l.uniform1f(s.opacity,S.opacity),l.uniform3f(s.color,S.color.r,S.color.g,S.color.b),l.uniform1f(s.rotation,S.rotation),l.uniform2fv(s.scale,_),e.state.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst),e.state.setDepthTest(S.depthTest),e.state.setDepthWrite(S.depthWrite),S.map&&S.map.image&&S.map.image.width?e.setTexture(S.map,0):e.setTexture(a,0),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0)}l.enable(l.CULL_FACE),e.resetGLState()}}},Y.GeometryUtils={merge:function(e,t,i){var n;Y.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof Y.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,i)},center:function(e){return Y.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},Y.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,i,n){var r=new Y.ImageLoader;r.crossOrigin=this.crossOrigin;var o=new Y.Texture(void 0,t);return r.load(e,(function(e){o.image=e,o.needsUpdate=!0,i&&i(o)}),void 0,(function(e){n&&n(e)})),o.sourceFile=e,o},loadTextureCube:function(e,t,i,n){var r=new Y.ImageLoader;r.crossOrigin=this.crossOrigin;var o=new Y.CubeTexture([],t);o.flipY=!1;for(var s=0,a=function(t){r.load(e[t],(function(e){o.images[t]=e,6===(s+=1)&&(o.needsUpdate=!0,i&&i(o))}),void 0,n)},l=0,c=e.length;l<c;++l)a(l);return o},loadCompressedTexture:function(){Y.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){Y.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var r=e.width,o=e.height,s=document.createElement("canvas");s.width=r,s.height=o;var a=s.getContext("2d");a.drawImage(e,0,0);for(var l,c,u=a.getImageData(0,0,r,o).data,h=a.createImageData(r,o),d=h.data,f=0;f<r;f++)for(var p=0;p<o;p++){var m=p-1<0?0:p-1,g=p+1>o-1?o-1:p+1,v=f-1<0?0:f-1,y=f+1>r-1?r-1:f+1,b=[],x=[0,0,u[4*(p*r+f)]/255*t];b.push([-1,0,u[4*(p*r+v)]/255*t]),b.push([-1,-1,u[4*(m*r+v)]/255*t]),b.push([0,-1,u[4*(m*r+f)]/255*t]),b.push([1,-1,u[4*(m*r+y)]/255*t]),b.push([1,0,u[4*(p*r+y)]/255*t]),b.push([1,1,u[4*(g*r+y)]/255*t]),b.push([0,1,u[4*(g*r+f)]/255*t]),b.push([-1,1,u[4*(g*r+v)]/255*t]);for(var _=[],E=b.length,S=0;S<E;S++){var A=b[S],w=b[(S+1)%E];A=i(A,x),w=i(w,x),_.push(n((c=w,[(l=A)[1]*c[2]-l[2]*c[1],l[2]*c[0]-l[0]*c[2],l[0]*c[1]-l[1]*c[0]])))}var C=[0,0,0];for(S=0;S<_.length;S++)C[0]+=_[S][0],C[1]+=_[S][1],C[2]+=_[S][2];C[0]/=_.length,C[1]/=_.length,C[2]/=_.length;var T=4*(p*r+f);d[T]=(C[0]+1)/2*255|0,d[T+1]=(C[1]+1)/2*255|0,d[T+2]=255*C[2]|0,d[T+3]=255}return a.putImageData(h,0,0),s},generateDataTexture:function(e,t,i){for(var n=e*t,r=new Uint8Array(3*n),o=Math.floor(255*i.r),s=Math.floor(255*i.g),a=Math.floor(255*i.b),l=0;l<n;l++)r[3*l]=o,r[3*l+1]=s,r[3*l+2]=a;var c=new Y.DataTexture(r,e,t,Y.RGBFormat);return c.needsUpdate=!0,c}},Y.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new Y.Object3D,n=0,r=t.length;n<r;n++)i.add(new Y.Mesh(e,t[n]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var n=new Y.Matrix4;n.getInverse(i.matrixWorld),e.applyMatrix(n),t.remove(e),i.add(e)}},Y.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase(),i=this;return i.faces[t]=i.faces[t]||{},i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{},i.faces[t][e.cssFontWeight][e.cssFontStyle]=e,i.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,i=this.getFace(),n=this.size/i.resolution,r=0,o=String(e).split(""),s=o.length,a=[];for(t=0;t<s;t++){var l=new Y.Path,c=this.extractGlyphPoints(o[t],i,n,r,l);r+=c.offset,a.push(c.path)}return{paths:a,offset:r/2}},extractGlyphPoints:function(e,t,i,n,r){var o,s,a,l,c,u,h,d,f,p,m,g,v,y,b,x,_,E,S=[],A=t.glyphs[e]||t.glyphs["?"];if(A){if(A.o)for(c=(l=A._cachedOutline||(A._cachedOutline=A.o.split(" "))).length,u=i,h=i,o=0;o<c;)switch(l[o++]){case"m":d=l[o++]*u+n,f=l[o++]*h,r.moveTo(d,f);break;case"l":d=l[o++]*u+n,f=l[o++]*h,r.lineTo(d,f);break;case"q":if(p=l[o++]*u+n,m=l[o++]*h,y=l[o++]*u+n,b=l[o++]*h,r.quadraticCurveTo(y,b,p,m),E=S[S.length-1])for(g=E.x,v=E.y,s=1,a=this.divisions;s<=a;s++){var w=s/a;Y.Shape.Utils.b2(w,g,y,p),Y.Shape.Utils.b2(w,v,b,m)}break;case"b":if(p=l[o++]*u+n,m=l[o++]*h,y=l[o++]*u+n,b=l[o++]*h,x=l[o++]*u+n,_=l[o++]*h,r.bezierCurveTo(y,b,x,_,p,m),E=S[S.length-1])for(g=E.x,v=E.y,s=1,a=this.divisions;s<=a;s++){w=s/a;Y.Shape.Utils.b3(w,g,y,x,p),Y.Shape.Utils.b3(w,v,b,_,m)}}return{offset:A.ha*i,path:r}}}},Y.FontUtils.generateShapes=function(e,t){var i=void 0!==(t=t||{}).size?t.size:100,n=void 0!==t.curveSegments?t.curveSegments:4,r=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";Y.FontUtils.size=i,Y.FontUtils.divisions=n,Y.FontUtils.face=r,Y.FontUtils.weight=o,Y.FontUtils.style=s;for(var a=Y.FontUtils.drawText(e).paths,l=[],c=0,u=a.length;c<u;c++)Array.prototype.push.apply(l,a[c].toShapes());return l},U=Y.FontUtils,k=1e-10,F=function(e){for(var t=e.length,i=0,n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i},V=function(e,t,i,n,r,o){var s,a,l,c,u,h,d,f,p,m,g,v,y,b,x;if(a=e[o[t]].x,l=e[o[t]].y,c=e[o[i]].x,u=e[o[i]].y,h=e[o[n]].x,d=e[o[n]].y,k>(c-a)*(d-l)-(u-l)*(h-a))return!1;for(m=h-c,g=d-u,v=a-h,y=l-d,b=c-a,x=u-l,s=0;s<r;s++)if(f=e[o[s]].x,p=e[o[s]].y,!(f===a&&p===l||f===c&&p===u||f===h&&p===d)&&m*(p-u)-g*(f-c)>=-1e-10&&v*(p-d)-y*(f-h)>=-1e-10&&b*(p-l)-x*(f-a)>=-1e-10)return!1;return!0},U.Triangulate=function(e,t){var i=e.length;if(i<3)return null;var n,r,o,s=[],a=[],l=[];if(F(e)>0)for(r=0;r<i;r++)a[r]=r;else for(r=0;r<i;r++)a[r]=i-1-r;var c=i,u=2*c;for(r=c-1;c>2;){if(u--<=0)return Y.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),t?l:s;if(c<=(n=r)&&(n=0),c<=(r=n+1)&&(r=0),c<=(o=r+1)&&(o=0),V(e,n,r,o,c,a)){var h,d,f,p,m;for(h=a[n],d=a[r],f=a[o],s.push([e[h],e[d],e[f]]),l.push([a[n],a[r],a[o]]),p=r,m=r+1;m<c;p++,m++)a[p]=a[m];u=2*--c}}return t?l:s},U.Triangulate.area=F,Y.Audio=function(e){Y.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.isPlaying=!1},Y.Audio.prototype=Object.create(Y.Object3D.prototype),Y.Audio.prototype.constructor=Y.Audio,Y.Audio.prototype.load=function(e){var t=this,i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(e){t.context.decodeAudioData(this.response,(function(e){t.source.buffer=e,t.autoplay&&t.play()}))},i.send(),this},Y.Audio.prototype.play=function(){if(!0!==this.isPlaying){var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.connect(this.panner),e.start(0,this.startTime),this.isPlaying=!0,this.source=e}else Y.warn("THREE.Audio: Audio is already playing.")},Y.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},Y.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},Y.Audio.prototype.onEnded=function(){this.isPlaying=!1},Y.Audio.prototype.setLoop=function(e){this.source.loop=e},Y.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},Y.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},Y.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},Y.Audio.prototype.updateMatrixWorld=function(){var e=new Y.Vector3;return function(t){Y.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),Y.AudioListener=function(){Y.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},Y.AudioListener.prototype=Object.create(Y.Object3D.prototype),Y.AudioListener.prototype.constructor=Y.AudioListener,Y.AudioListener.prototype.updateMatrixWorld=function(){var e=new Y.Vector3,t=new Y.Quaternion,i=new Y.Vector3,n=new Y.Vector3,r=new Y.Vector3,o=new Y.Vector3;return function(s){Y.Object3D.prototype.updateMatrixWorld.call(this,s);var a=this.context.listener,l=this.up;this.matrixWorld.decompose(e,t,i),n.set(0,0,-1).applyQuaternion(t),r.subVectors(e,o),a.setPosition(e.x,e.y,e.z),a.setOrientation(n.x,n.y,n.z,l.x,l.y,l.z),a.setVelocity(r.x,r.y,r.z),o.copy(e)}}(),Y.Curve=function(){},Y.Curve.prototype.getPoint=function(e){return Y.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},Y.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},Y.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i},Y.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i},Y.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},Y.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(r),n.push(o),r=t;return this.cacheArcLengths=n,n},Y.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},Y.Curve.prototype.getUtoTmapping=function(e,t){var i,n=this.getLengths(),r=0,o=n.length;i=t||e*n[o-1];for(var s,a=0,l=o-1;a<=l;)if((s=n[r=Math.floor(a+(l-a)/2)]-i)<0)a=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(n[r=l]==i)return r/(o-1);var c=n[r];return(r+(i-c)/(n[r+1]-c))/(o-1)},Y.Curve.prototype.getTangent=function(e){var t=1e-4,i=e-t,n=e+t;i<0&&(i=0),n>1&&(n=1);var r=this.getPoint(i);return this.getPoint(n).clone().sub(r).normalize()},Y.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},Y.Curve.Utils={tangentQuadraticBezier:function(e,t,i,n){return 2*(1-e)*(i-t)+2*e*(n-i)},tangentCubicBezier:function(e,t,i,n,r){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*r},tangentSpline:function(e,t,i,n,r){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,n,r){var o=.5*(i-e),s=.5*(n-t),a=r*r;return(2*t-2*i+o+s)*(r*a)+(-3*t+3*i-2*o-s)*a+o*r+t}},Y.Curve.create=function(e,t){return e.prototype=Object.create(Y.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Y.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},Y.CurvePath.prototype=Object.create(Y.Curve.prototype),Y.CurvePath.prototype.constructor=Y.CurvePath,Y.CurvePath.prototype.add=function(e){this.curves.push(e)},Y.CurvePath.prototype.checkConnection=function(){},Y.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Y.LineCurve(t,e))},Y.CurvePath.prototype.getPoint=function(e){for(var t,i=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=i){var o=1-(n[r]-i)/(t=this.curves[r]).getLength();return t.getPointAt(o)}r++}return null},Y.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},Y.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,n=this.curves.length;for(e=0;e<n;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t,t},Y.CurvePath.prototype.getBoundingBox=function(){var e,t,i,n,r,o,s,a,l,c,u=this.getPoints();e=t=Number.NEGATIVE_INFINITY,n=r=Number.POSITIVE_INFINITY;var h=u[0]instanceof Y.Vector3;for(c=h?new Y.Vector3:new Y.Vector2,a=0,l=u.length;a<l;a++)(s=u[a]).x>e?e=s.x:s.x<n&&(n=s.x),s.y>t?t=s.y:s.y<r&&(r=s.y),h&&(s.z>i?i=s.z:s.z<o&&(o=s.z)),c.add(s);var d={minX:n,minY:r,maxX:e,maxY:t};return h&&(d.maxZ=i,d.minZ=o),d},Y.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},Y.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},Y.CurvePath.prototype.createGeometry=function(e){for(var t=new Y.Geometry,i=0;i<e.length;i++)t.vertices.push(new Y.Vector3(e[i].x,e[i].y,e[i].z||0));return t},Y.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},Y.CurvePath.prototype.getTransformedPoints=function(e,t){var i,n,r=this.getPoints(e);for(t||(t=this.bends),i=0,n=t.length;i<n;i++)r=this.getWrapPoints(r,t[i]);return r},Y.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,n,r=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,n=t.length;i<n;i++)r=this.getWrapPoints(r,t[i]);return r},Y.CurvePath.prototype.getWrapPoints=function(e,t){var i,n,r,o,s,a,l=this.getBoundingBox();for(i=0,n=e.length;i<n;i++){o=(r=e[i]).x,s=r.y,a=o/l.maxX,a=t.getUtoTmapping(a,o);var c=t.getPoint(a),u=t.getTangent(a);u.set(-u.y,u.x).multiplyScalar(s),r.x=c.x+u.x,r.y=c.y+u.y}return e},Y.Gyroscope=function(){Y.Object3D.call(this)},Y.Gyroscope.prototype=Object.create(Y.Object3D.prototype),Y.Gyroscope.prototype.constructor=Y.Gyroscope,Y.Gyroscope.prototype.updateMatrixWorld=(G=new Y.Vector3,z=new Y.Quaternion,H=new Y.Vector3,W=new Y.Vector3,j=new Y.Quaternion,q=new Y.Vector3,function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(W,j,q),this.matrix.decompose(G,z,H),this.matrixWorld.compose(W,z,q)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)}),Y.Path=function(e){Y.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},Y.Path.prototype=Object.create(Y.CurvePath.prototype),Y.Path.prototype.constructor=Y.Path,Y.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},Y.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},Y.Path.prototype.moveTo=function(e,t){var i=Array.prototype.slice.call(arguments);this.actions.push({action:Y.PathActions.MOVE_TO,args:i})},Y.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,r=n[n.length-2],o=n[n.length-1],s=new Y.LineCurve(new Y.Vector2(r,o),new Y.Vector2(e,t));this.curves.push(s),this.actions.push({action:Y.PathActions.LINE_TO,args:i})},Y.Path.prototype.quadraticCurveTo=function(e,t,i,n){var r=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,s=o[o.length-2],a=o[o.length-1],l=new Y.QuadraticBezierCurve(new Y.Vector2(s,a),new Y.Vector2(e,t),new Y.Vector2(i,n));this.curves.push(l),this.actions.push({action:Y.PathActions.QUADRATIC_CURVE_TO,args:r})},Y.Path.prototype.bezierCurveTo=function(e,t,i,n,r,o){var s=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,l=a[a.length-2],c=a[a.length-1],u=new Y.CubicBezierCurve(new Y.Vector2(l,c),new Y.Vector2(e,t),new Y.Vector2(i,n),new Y.Vector2(r,o));this.curves.push(u),this.actions.push({action:Y.PathActions.BEZIER_CURVE_TO,args:s})},Y.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,n=i[i.length-2],r=i[i.length-1],o=[new Y.Vector2(n,r)];Array.prototype.push.apply(o,e);var s=new Y.SplineCurve(o);this.curves.push(s),this.actions.push({action:Y.PathActions.CSPLINE_THRU,args:t})},Y.Path.prototype.arc=function(e,t,i,n,r,o){var s=this.actions[this.actions.length-1].args,a=s[s.length-2],l=s[s.length-1];this.absarc(e+a,t+l,i,n,r,o)},Y.Path.prototype.absarc=function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},Y.Path.prototype.ellipse=function(e,t,i,n,r,o,s){var a=this.actions[this.actions.length-1].args,l=a[a.length-2],c=a[a.length-1];this.absellipse(e+l,t+c,i,n,r,o,s)},Y.Path.prototype.absellipse=function(e,t,i,n,r,o,s){var a=Array.prototype.slice.call(arguments),l=new Y.EllipseCurve(e,t,i,n,r,o,s);this.curves.push(l);var c=l.getPoint(1);a.push(c.x),a.push(c.y),this.actions.push({action:Y.PathActions.ELLIPSE,args:a})},Y.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var i=[],n=0;n<e;n++)i.push(this.getPoint(n/e));return i},Y.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,n,r,o,s,a,l,c,u,h,d,f,p,m,g,v,y,b,x=[];for(i=0,n=this.actions.length;i<n;i++)switch(o=(r=this.actions[i]).action,s=r.args,o){case Y.PathActions.MOVE_TO:case Y.PathActions.LINE_TO:x.push(new Y.Vector2(s[0],s[1]));break;case Y.PathActions.QUADRATIC_CURVE_TO:for(a=s[2],l=s[3],h=s[0],d=s[1],x.length>0?(f=(m=x[x.length-1]).x,p=m.y):(f=(m=this.actions[i-1].args)[m.length-2],p=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=Y.Shape.Utils.b2(v,f,h,a),b=Y.Shape.Utils.b2(v,p,d,l),x.push(new Y.Vector2(y,b));break;case Y.PathActions.BEZIER_CURVE_TO:for(a=s[4],l=s[5],h=s[0],d=s[1],c=s[2],u=s[3],x.length>0?(f=(m=x[x.length-1]).x,p=m.y):(f=(m=this.actions[i-1].args)[m.length-2],p=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=Y.Shape.Utils.b3(v,f,h,c,a),b=Y.Shape.Utils.b3(v,p,d,u,l),x.push(new Y.Vector2(y,b));break;case Y.PathActions.CSPLINE_THRU:m=this.actions[i-1].args;var _=[new Y.Vector2(m[m.length-2],m[m.length-1])],E=e*s[0].length;_=_.concat(s[0]);var S=new Y.SplineCurve(_);for(g=1;g<=E;g++)x.push(S.getPointAt(g/E));break;case Y.PathActions.ARC:var A=s[0],w=s[1],C=s[2],T=s[3],M=s[4],I=!!s[5],P=M-T,L=2*e;for(g=1;g<=L;g++)v=g/L,I||(v=1-v),R=T+v*P,y=A+C*Math.cos(R),b=w+C*Math.sin(R),x.push(new Y.Vector2(y,b));break;case Y.PathActions.ELLIPSE:A=s[0],w=s[1];var R,D=s[2],O=s[3];T=s[4],M=s[5],I=!!s[6],P=M-T,L=2*e;for(g=1;g<=L;g++)v=g/L,I||(v=1-v),R=T+v*P,y=A+D*Math.cos(R),b=w+O*Math.sin(R),x.push(new Y.Vector2(y,b))}var B=x[x.length-1];return Math.abs(B.x-x[0].x)<1e-10&&Math.abs(B.y-x[0].y)<1e-10&&x.splice(x.length-1,1),t&&x.push(x[0]),x},Y.Path.prototype.toShapes=function(e,t){function i(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i],o=new Y.Shape;o.actions=r.actions,o.curves=r.curves,t.push(o)}return t}function n(e,t){for(var i=t.length,n=!1,r=i-1,o=0;o<i;r=o++){var s=t[r],a=t[o],l=a.x-s.x,c=a.y-s.y;if(Math.abs(c)>1e-10){if(c<0&&(s=t[o],l=-l,a=t[r],c=-c),e.y<s.y||e.y>a.y)continue;if(e.y==s.y){if(e.x==s.x)return!0}else{var u=c*(e.x-s.x)-l*(e.y-s.y);if(0==u)return!0;if(u<0)continue;n=!n}}else{if(e.y!=s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return n}var r=function(e){var t,i,n,r,o,s=[],a=new Y.Path;for(t=0,i=e.length;t<i;t++)o=(n=e[t]).args,(r=n.action)==Y.PathActions.MOVE_TO&&0!=a.actions.length&&(s.push(a),a=new Y.Path),a[r].apply(a,o);return 0!=a.actions.length&&s.push(a),s}(this.actions);if(0==r.length)return[];if(!0===t)return i(r);var o,s,a,l=[];if(1==r.length)return s=r[0],(a=new Y.Shape).actions=s.actions,a.curves=s.curves,l.push(a),l;var c=!Y.Shape.Utils.isClockWise(r[0].getPoints());c=e?!c:c;var u,h,d,f,p,m,g=[],v=[],y=[],b=0;for(v[b]=void 0,y[b]=[],h=0,d=r.length;h<d;h++)u=(s=r[h]).getPoints(),o=Y.Shape.Utils.isClockWise(u),(o=e?!o:o)?(!c&&v[b]&&b++,v[b]={s:new Y.Shape,p:u},v[b].s.actions=s.actions,v[b].s.curves=s.curves,c&&b++,y[b]=[]):y[b].push({h:s,p:u[0]});if(!v[0])return i(r);if(v.length>1){for(var x=!1,_=[],E=0,S=v.length;E<S;E++)g[E]=[];for(E=0,S=v.length;E<S;E++)for(var A=y[E],w=0;w<A.length;w++){for(var C=A[w],T=!0,M=0;M<v.length;M++)n(C.p,v[M].p)&&(E!=M&&_.push({froms:E,tos:M,hole:w}),T?(T=!1,g[M].push(C)):x=!0);T&&g[E].push(C)}_.length>0&&(x||(y=g))}for(h=0,d=v.length;h<d;h++)for(a=v[h].s,l.push(a),p=0,m=(f=y[h]).length;p<m;p++)a.holes.push(f[p].h);return l},Y.Shape=function(){Y.Path.apply(this,arguments),this.holes=[]},Y.Shape.prototype=Object.create(Y.Path.prototype),Y.Shape.prototype.constructor=Y.Shape,Y.Shape.prototype.extrude=function(e){return new Y.ExtrudeGeometry(this,e)},Y.Shape.prototype.makeGeometry=function(e){return new Y.ShapeGeometry(this,e)},Y.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;t<i;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},Y.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;t<i;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},Y.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},Y.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},Y.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},Y.Shape.Utils={triangulateShape:function(e,t){function i(e,t,i){return e.x!=t.x?e.x<t.x?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:e.y<t.y?e.y<=i.y&&i.y<=t.y:t.y<=i.y&&i.y<=e.y}function n(e,t,n,r,o){var s=t.x-e.x,a=t.y-e.y,l=r.x-n.x,c=r.y-n.y,u=e.x-n.x,h=e.y-n.y,d=a*l-s*c,f=a*u-s*h;if(Math.abs(d)>1e-10){var p;if(d>0){if(f<0||f>d)return[];if((p=c*u-l*h)<0||p>d)return[]}else{if(f>0||f<d)return[];if((p=c*u-l*h)>0||p<d)return[]}if(0==p)return!o||0!=f&&f!=d?[e]:[];if(p==d)return!o||0!=f&&f!=d?[t]:[];if(0==f)return[n];if(f==d)return[r];var m=p/d;return[{x:e.x+m*s,y:e.y+m*a}]}if(0!=f||c*u!=l*h)return[];var g,v,y,b,x,_,E,S,A=0==s&&0==a,w=0==l&&0==c;return A&&w?e.x!=n.x||e.y!=n.y?[]:[e]:A?i(n,r,e)?[e]:[]:w?i(e,t,n)?[n]:[]:(0!=s?(e.x<t.x?(g=e,y=e.x,v=t,b=t.x):(g=t,y=t.x,v=e,b=e.x),n.x<r.x?(x=n,E=n.x,_=r,S=r.x):(x=r,E=r.x,_=n,S=n.x)):(e.y<t.y?(g=e,y=e.y,v=t,b=t.y):(g=t,y=t.y,v=e,b=e.y),n.y<r.y?(x=n,E=n.y,_=r,S=r.y):(x=r,E=r.y,_=n,S=n.y)),y<=E?b<E?[]:b==E?o?[]:[x]:b<=S?[x,v]:[x,_]:y>S?[]:y==S?o?[]:[g]:b<=S?[g,v]:[g,_])}function r(e,t,i,n){var r=t.x-e.x,o=t.y-e.y,s=i.x-e.x,a=i.y-e.y,l=n.x-e.x,c=n.y-e.y,u=r*a-o*s,h=r*c-o*l;if(Math.abs(u)>1e-10){var d=l*a-c*s;return u>0?h>=0&&d>=0:h>=0||d>=0}return h>0}for(var o,s,a,l,c,u,h={},d=e.concat(),f=0,p=t.length;f<p;f++)Array.prototype.push.apply(d,t[f]);for(o=0,s=d.length;o<s;o++)void 0!==h[c=d[o].x+":"+d[o].y]&&Y.warn("THREE.Shape: Duplicate point",c),h[c]=o;var m=function(e,t){var i,o=e.concat();function s(e,t){var n=o.length-1,s=e-1;s<0&&(s=n);var a=e+1;a>n&&(a=0);var l=r(o[e],o[s],o[a],i[t]);if(!l)return!1;var c=i.length-1,u=t-1;u<0&&(u=c);var h=t+1;return h>c&&(h=0),!!(l=r(i[t],i[u],i[h],o[e]))}function a(e,t){var i,r;for(i=0;i<o.length;i++)if(r=i+1,r%=o.length,n(e,t,o[i],o[r],!0).length>0)return!0;return!1}var l=[];function c(e,i){var r,o,s,a;for(r=0;r<l.length;r++)for(o=t[l[r]],s=0;s<o.length;s++)if(a=s+1,a%=o.length,n(e,i,o[s],o[a],!0).length>0)return!0;return!1}for(var u,h,d,f,p,m,g,v,y,b,x=[],_=0,E=t.length;_<E;_++)l.push(_);for(var S=0,A=2*l.length;l.length>0;){if(--A<0){console.log("Infinite Loop! Holes left:"+l.length+", Probably Hole outside Shape!");break}for(h=S;h<o.length;h++){d=o[h],u=-1;for(_=0;_<l.length;_++)if(p=l[_],void 0===x[m=d.x+":"+d.y+":"+p]){i=t[p];for(var w=0;w<i.length;w++)if(f=i[w],s(h,w)&&!a(d,f)&&!c(d,f)){u=w,l.splice(_,1),g=o.slice(0,h+1),v=o.slice(h),y=i.slice(u),b=i.slice(0,u+1),o=g.concat(y).concat(b).concat(v),S=h;break}if(u>=0)break;x[m]=!0}if(u>=0)break}}return o}(e,t),g=Y.FontUtils.Triangulate(m,!1);for(o=0,s=g.length;o<s;o++)for(l=g[o],a=0;a<3;a++)void 0!==(u=h[c=l[a].x+":"+l[a].y])&&(l[a]=u);return g.concat()},isClockWise:function(e){return Y.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,n){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,n)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,n,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,n)+this.b3p3(e,r)}},Y.LineCurve=function(e,t){this.v1=e,this.v2=t},Y.LineCurve.prototype=Object.create(Y.Curve.prototype),Y.LineCurve.prototype.constructor=Y.LineCurve,Y.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},Y.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},Y.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},Y.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},Y.QuadraticBezierCurve.prototype=Object.create(Y.Curve.prototype),Y.QuadraticBezierCurve.prototype.constructor=Y.QuadraticBezierCurve,Y.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new Y.Vector2;return t.x=Y.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=Y.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},Y.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new Y.Vector2;return t.x=Y.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=Y.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},Y.CubicBezierCurve=function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},Y.CubicBezierCurve.prototype=Object.create(Y.Curve.prototype),Y.CubicBezierCurve.prototype.constructor=Y.CubicBezierCurve,Y.CubicBezierCurve.prototype.getPoint=function(e){var t,i;return t=Y.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=Y.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new Y.Vector2(t,i)},Y.CubicBezierCurve.prototype.getTangent=function(e){var t,i;t=Y.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=Y.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var n=new Y.Vector2(t,i);return n.normalize(),n},Y.SplineCurve=function(e){this.points=null==e?[]:e},Y.SplineCurve.prototype=Object.create(Y.Curve.prototype),Y.SplineCurve.prototype.constructor=Y.SplineCurve,Y.SplineCurve.prototype.getPoint=function(e){var t=this.points,i=(t.length-1)*e,n=Math.floor(i),r=i-n,o=t[0==n?n:n-1],s=t[n],a=t[n>t.length-2?t.length-1:n+1],l=t[n>t.length-3?t.length-1:n+2],c=new Y.Vector2;return c.x=Y.Curve.Utils.interpolate(o.x,s.x,a.x,l.x,r),c.y=Y.Curve.Utils.interpolate(o.y,s.y,a.y,l.y,r),c},Y.EllipseCurve=function(e,t,i,n,r,o,s){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s},Y.EllipseCurve.prototype=Object.create(Y.Curve.prototype),Y.EllipseCurve.prototype.constructor=Y.EllipseCurve,Y.EllipseCurve.prototype.getPoint=function(e){var t,i=this.aEndAngle-this.aStartAngle;i<0&&(i+=2*Math.PI),i>2*Math.PI&&(i-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-i):this.aStartAngle+e*i;var n=new Y.Vector2;return n.x=this.aX+this.xRadius*Math.cos(t),n.y=this.aY+this.yRadius*Math.sin(t),n},Y.ArcCurve=function(e,t,i,n,r,o){Y.EllipseCurve.call(this,e,t,i,i,n,r,o)},Y.ArcCurve.prototype=Object.create(Y.EllipseCurve.prototype),Y.ArcCurve.prototype.constructor=Y.ArcCurve,Y.LineCurve3=Y.Curve.create((function(e,t){this.v1=e,this.v2=t}),(function(e){var t=new Y.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t})),Y.QuadraticBezierCurve3=Y.Curve.create((function(e,t,i){this.v0=e,this.v1=t,this.v2=i}),(function(e){var t=new Y.Vector3;return t.x=Y.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=Y.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=Y.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t})),Y.CubicBezierCurve3=Y.Curve.create((function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n}),(function(e){var t=new Y.Vector3;return t.x=Y.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=Y.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=Y.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t})),Y.SplineCurve3=Y.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t=this.points,i=(t.length-1)*e,n=Math.floor(i),r=i-n,o=t[0==n?n:n-1],s=t[n],a=t[n>t.length-2?t.length-1:n+1],l=t[n>t.length-3?t.length-1:n+2],c=new Y.Vector3;return c.x=Y.Curve.Utils.interpolate(o.x,s.x,a.x,l.x,r),c.y=Y.Curve.Utils.interpolate(o.y,s.y,a.y,l.y,r),c.z=Y.Curve.Utils.interpolate(o.z,s.z,a.z,l.z,r),c})),Y.ClosedSplineCurve3=Y.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t=this.points,i=(t.length-0)*e,n=Math.floor(i),r=i-n,o=t[((n+=n>0?0:(Math.floor(Math.abs(n)/t.length)+1)*t.length)-1)%t.length],s=t[n%t.length],a=t[(n+1)%t.length],l=t[(n+2)%t.length],c=new Y.Vector3;return c.x=Y.Curve.Utils.interpolate(o.x,s.x,a.x,l.x,r),c.y=Y.Curve.Utils.interpolate(o.y,s.y,a.y,l.y,r),c.z=Y.Curve.Utils.interpolate(o.z,s.z,a.z,l.z,r),c})),Y.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){Y.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){Y.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){Y.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof Y.Quaternion)){var n=e.hierarchy[t].keys[i].rot;e.hierarchy[t].keys[i].rot=(new Y.Quaternion).fromArray(n)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){var r={};for(i=0;i<e.hierarchy[t].keys.length;i++)for(var o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++){r[a=e.hierarchy[t].keys[i].morphTargets[o]]=-1}e.hierarchy[t].usedMorphTargets=r;for(i=0;i<e.hierarchy[t].keys.length;i++){var s={};for(var a in r){for(o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++)if(e.hierarchy[t].keys[i].morphTargets[o]===a){s[a]=e.hierarchy[t].keys[i].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[i].morphTargets.length&&(s[a]=0)}e.hierarchy[t].keys[i].morphTargetsInfluences=s}}for(i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}return e.initialized=!0,e},parse:function(e){var t=function(e,i){i.push(e);for(var n=0;n<e.children.length;n++)t(e.children[n],i)},i=[];if(e instanceof Y.SkinnedMesh)for(var n=0;n<e.skeleton.bones.length;n++)i.push(e.skeleton.bones[n]);else t(e,i);return i},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(t=0;t<this.animations.length;t++)this.animations[t].update(e)}},Y.Animation=function(e,t){this.root=e,this.data=Y.AnimationHandler.init(t),this.hierarchy=Y.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=Y.AnimationHandler.LINEAR},Y.Animation.prototype={constructor:Y.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),Y.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,Y.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e];void 0===i.animationCache&&(i.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var n=this.data.name,r=i.animationCache.animations,o=r[n];void 0===o&&(o={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:i.matrix},r[n]=o);for(var s=0;s<3;s++){for(var a=this.keyTypes[s],l=this.data.hierarchy[e].keys[0],c=this.getNextKeyWith(a,e,1);c.time<this.currentTime&&c.index>l.index;)l=c,c=this.getNextKeyWith(a,e,c.index+1);o.prevKey[a]=l,o.nextKey[a]=c}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e].animationCache;if(void 0!==i){var n=i.blending;n.positionWeight=0,n.quaternionWeight=0,n.scaleWeight=0}}},update:function(){var e=[],t=new Y.Vector3,i=new Y.Vector3,n=new Y.Quaternion,r=function(e,t){var i,n,r,s,a,l,c,u,h,d=[],f=[];return r=(i=(e.length-1)*t)-(n=Math.floor(i)),d[0]=0===n?n:n-1,d[1]=n,d[2]=n>e.length-2?n:n+1,d[3]=n>e.length-3?n:n+2,l=e[d[0]],c=e[d[1]],u=e[d[2]],h=e[d[3]],a=r*(s=r*r),f[0]=o(l[0],c[0],u[0],h[0],r,s,a),f[1]=o(l[1],c[1],u[1],h[1],r,s,a),f[2]=o(l[2],c[2],u[2],h[2],r,s,a),f},o=function(e,t,i,n,r,o,s){var a=.5*(i-e),l=.5*(n-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*r+t};return function(o){if(!1!==this.isPlaying&&(this.currentTime+=o*this.timeScale,0!==this.weight)){var s=this.data.length;(this.currentTime>s||this.currentTime<0)&&(this.loop?(this.currentTime%=s,this.currentTime<0&&(this.currentTime+=s),this.reset()):this.stop());for(var a=0,l=this.hierarchy.length;a<l;a++)for(var c=this.hierarchy[a],u=c.animationCache.animations[this.data.name],h=c.animationCache.blending,d=0;d<3;d++){var f=this.keyTypes[d],p=u.prevKey[f],m=u.nextKey[f];if(this.timeScale>0&&m.time<=this.currentTime||this.timeScale<0&&p.time>=this.currentTime){for(p=this.data.hierarchy[a].keys[0],m=this.getNextKeyWith(f,a,1);m.time<this.currentTime&&m.index>p.index;)p=m,m=this.getNextKeyWith(f,a,m.index+1);u.prevKey[f]=p,u.nextKey[f]=m}var g=(this.currentTime-p.time)/(m.time-p.time),v=p[f],y=m[f];if(g<0&&(g=0),g>1&&(g=1),"pos"===f){if(this.interpolationType===Y.AnimationHandler.LINEAR){i.x=v[0]+(y[0]-v[0])*g,i.y=v[1]+(y[1]-v[1])*g,i.z=v[2]+(y[2]-v[2])*g;var b=this.weight/(this.weight+h.positionWeight);c.position.lerp(i,b),h.positionWeight+=this.weight}else if(this.interpolationType===Y.AnimationHandler.CATMULLROM||this.interpolationType===Y.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",a,p.index-1).pos,e[1]=v,e[2]=y,e[3]=this.getNextKeyWith("pos",a,m.index+1).pos;var x=r(e,g=.33*g+.33);b=this.weight/(this.weight+h.positionWeight);h.positionWeight+=this.weight;var _=c.position;if(_.x=_.x+(x[0]-_.x)*b,_.y=_.y+(x[1]-_.y)*b,_.z=_.z+(x[2]-_.z)*b,this.interpolationType===Y.AnimationHandler.CATMULLROM_FORWARD){var E=r(e,1.01*g);t.set(E[0],E[1],E[2]),t.sub(_),t.y=0,t.normalize();var S=Math.atan2(t.x,t.z);c.rotation.set(0,S,0)}}}else if("rot"===f)if(Y.Quaternion.slerp(v,y,n,g),0===h.quaternionWeight)c.quaternion.copy(n),h.quaternionWeight=this.weight;else{b=this.weight/(this.weight+h.quaternionWeight);Y.Quaternion.slerp(c.quaternion,n,c.quaternion,b),h.quaternionWeight+=this.weight}else if("scl"===f){i.x=v[0]+(y[0]-v[0])*g,i.y=v[1]+(y[1]-v[1])*g,i.z=v[2]+(y[2]-v[2])*g;b=this.weight/(this.weight+h.scaleWeight);c.scale.lerp(i,b),h.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(e,t,i){var n=this.data.hierarchy[t].keys;for(this.interpolationType===Y.AnimationHandler.CATMULLROM||this.interpolationType===Y.AnimationHandler.CATMULLROM_FORWARD?i=i<n.length-1?i:n.length-1:i%=n.length;i<n.length;i++)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,i){var n=this.data.hierarchy[t].keys;for(i=this.interpolationType===Y.AnimationHandler.CATMULLROM||this.interpolationType===Y.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+n.length;i>=0;i--)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[n.length-1]}},Y.KeyFrameAnimation=function(e){this.root=e.node,this.data=Y.AnimationHandler.init(e),this.hierarchy=Y.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,i=this.hierarchy.length;t<i;t++){var n=this.data.hierarchy[t].keys,r=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(n.length&&r){for(var s=0;s<r.length;s++){var a=r[s],l=this.getNextKeyWith(a,t,0);l&&l.apply(a)}o.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},Y.KeyFrameAnimation.prototype={constructor:Y.KeyFrameAnimation,play:function(e){if(this.currentTime=void 0!==e?e:0,!1===this.isPlaying){this.isPlaying=!0;var t,i,n,r=this.hierarchy.length;for(t=0;t<r;t++){i=this.hierarchy[t],void 0===(n=this.data.hierarchy[t]).animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=i.matrix);var o=this.data.hierarchy[t].keys;o.length&&(n.animationCache.prevKey=o[0],n.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,Y.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,Y.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var n=i.animationCache.originalMatrix;n.copy(t.matrix),t.matrix=n,delete i.animationCache}}},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var i=0,n=this.hierarchy.length;i<n;i++){var r=this.hierarchy[i],o=this.data.hierarchy[i],s=o.keys,a=o.animationCache;if(s.length){var l=a.prevKey,c=a.nextKey;if(c.time<=this.currentTime){for(;c.time<this.currentTime&&c.index>l.index;)c=s[(l=c).index+1];a.prevKey=l,a.nextKey=c}c.time>=this.currentTime?l.interpolate(c,this.currentTime):l.interpolate(c,c.time),this.data.hierarchy[i].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(e,t,i){var n=this.data.hierarchy[t].keys;for(i%=n.length;i<n.length;i++)if(n[i].hasTarget(e))return n[i];return n[0]},getPrevKeyWith:function(e,t,i){var n=this.data.hierarchy[t].keys;for(i=i>=0?i:i+n.length;i>=0;i--)if(n[i].hasTarget(e))return n[i];return n[n.length-1]}},Y.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},Y.MorphAnimation.prototype={constructor:Y.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,i=Math.floor(this.currentTime/t),n=this.mesh.morphTargetInfluences;i!=this.currentFrame&&(n[this.lastFrame]=0,n[this.currentFrame]=1,n[i]=0,this.lastFrame=this.currentFrame,this.currentFrame=i),n[i]=this.currentTime%t/t,n[this.lastFrame]=1-n[i]}}},Y.BoxGeometry=function(e,t,i,n,r,o){Y.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o},this.widthSegments=n||1,this.heightSegments=r||1,this.depthSegments=o||1;var s=this,a=e/2,l=t/2,c=i/2;function u(e,t,i,n,r,o,a,l){var c,u,h,d=s.widthSegments,f=s.heightSegments,p=r/2,m=o/2,g=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",f=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",d=s.depthSegments);var v=d+1,y=f+1,b=r/d,x=o/f,_=new Y.Vector3;for(_[c]=a>0?1:-1,h=0;h<y;h++)for(u=0;u<v;u++){var E=new Y.Vector3;E[e]=(u*b-p)*i,E[t]=(h*x-m)*n,E[c]=a,s.vertices.push(E)}for(h=0;h<f;h++)for(u=0;u<d;u++){var S=u+v*h,A=u+v*(h+1),w=u+1+v*(h+1),C=u+1+v*h,T=new Y.Vector2(u/d,1-h/f),M=new Y.Vector2(u/d,1-(h+1)/f),I=new Y.Vector2((u+1)/d,1-(h+1)/f),P=new Y.Vector2((u+1)/d,1-h/f),L=new Y.Face3(S+g,A+g,C+g);L.normal.copy(_),L.vertexNormals.push(_.clone(),_.clone(),_.clone()),L.materialIndex=l,s.faces.push(L),s.faceVertexUvs[0].push([T,M,P]),(L=new Y.Face3(A+g,w+g,C+g)).normal.copy(_),L.vertexNormals.push(_.clone(),_.clone(),_.clone()),L.materialIndex=l,s.faces.push(L),s.faceVertexUvs[0].push([M.clone(),I,P.clone()])}}u("z","y",-1,-1,i,t,a,0),u("z","y",1,-1,i,t,-a,1),u("x","z",1,1,e,i,l,2),u("x","z",1,-1,e,i,-l,3),u("x","y",1,-1,e,t,c,4),u("x","y",-1,-1,e,t,-c,5),this.mergeVertices()},Y.BoxGeometry.prototype=Object.create(Y.Geometry.prototype),Y.BoxGeometry.prototype.constructor=Y.BoxGeometry,Y.CircleGeometry=function(e,t,i,n){Y.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},e=e||50,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var r,o=[],s=new Y.Vector3,a=new Y.Vector2(.5,.5);for(this.vertices.push(s),o.push(a),r=0;r<=t;r++){var l=new Y.Vector3,c=i+r/t*n;l.x=e*Math.cos(c),l.y=e*Math.sin(c),this.vertices.push(l),o.push(new Y.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var u=new Y.Vector3(0,0,1);for(r=1;r<=t;r++)this.faces.push(new Y.Face3(r,r+1,0,[u.clone(),u.clone(),u.clone()])),this.faceVertexUvs[0].push([o[r].clone(),o[r+1].clone(),a.clone()]);this.computeFaceNormals(),this.boundingSphere=new Y.Sphere(new Y.Vector3,e)},Y.CircleGeometry.prototype=Object.create(Y.Geometry.prototype),Y.CircleGeometry.prototype.constructor=Y.CircleGeometry,Y.CubeGeometry=function(e,t,i,n,r,o){return Y.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new Y.BoxGeometry(e,t,i,n,r,o)},Y.CylinderGeometry=function(e,t,i,n,r,o,s,a){Y.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a},e=void 0!==e?e:20,t=void 0!==t?t:20,i=void 0!==i?i:100,n=n||8,r=r||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var l,c,u=i/2,h=[],d=[];for(c=0;c<=r;c++){var f=[],p=[],m=c/r,g=m*(t-e)+e;for(l=0;l<=n;l++){var v=l/n,y=new Y.Vector3;y.x=g*Math.sin(v*a+s),y.y=-m*i+u,y.z=g*Math.cos(v*a+s),this.vertices.push(y),f.push(this.vertices.length-1),p.push(new Y.Vector2(v,1-m))}h.push(f),d.push(p)}var b,x,_=(t-e)/i;for(l=0;l<n;l++)for(0!==e?(b=this.vertices[h[0][l]].clone(),x=this.vertices[h[0][l+1]].clone()):(b=this.vertices[h[1][l]].clone(),x=this.vertices[h[1][l+1]].clone()),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*_).normalize(),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*_).normalize(),c=0;c<r;c++){var E=h[c][l],S=h[c+1][l],A=h[c+1][l+1],w=h[c][l+1],C=b.clone(),T=b.clone(),M=x.clone(),I=x.clone(),P=d[c][l].clone(),L=d[c+1][l].clone(),R=d[c+1][l+1].clone(),D=d[c][l+1].clone();this.faces.push(new Y.Face3(E,S,w,[C,T,I])),this.faceVertexUvs[0].push([P,L,D]),this.faces.push(new Y.Face3(S,A,w,[T.clone(),M,I.clone()])),this.faceVertexUvs[0].push([L.clone(),R,D.clone()])}if(!1===o&&e>0)for(this.vertices.push(new Y.Vector3(0,u,0)),l=0;l<n;l++){E=h[0][l],S=h[0][l+1],A=this.vertices.length-1,C=new Y.Vector3(0,1,0),T=new Y.Vector3(0,1,0),M=new Y.Vector3(0,1,0),P=d[0][l].clone(),L=d[0][l+1].clone(),R=new Y.Vector2(L.x,0);this.faces.push(new Y.Face3(E,S,A,[C,T,M])),this.faceVertexUvs[0].push([P,L,R])}if(!1===o&&t>0)for(this.vertices.push(new Y.Vector3(0,-u,0)),l=0;l<n;l++){E=h[r][l+1],S=h[r][l],A=this.vertices.length-1,C=new Y.Vector3(0,-1,0),T=new Y.Vector3(0,-1,0),M=new Y.Vector3(0,-1,0),P=d[r][l+1].clone(),L=d[r][l].clone(),R=new Y.Vector2(L.x,1);this.faces.push(new Y.Face3(E,S,A,[C,T,M])),this.faceVertexUvs[0].push([P,L,R])}this.computeFaceNormals()},Y.CylinderGeometry.prototype=Object.create(Y.Geometry.prototype),Y.CylinderGeometry.prototype.constructor=Y.CylinderGeometry,Y.ExtrudeGeometry=function(e,t){void 0!==e?(Y.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,t),this.computeFaceNormals()):e=[]},Y.ExtrudeGeometry.prototype=Object.create(Y.Geometry.prototype),Y.ExtrudeGeometry.prototype.constructor=Y.ExtrudeGeometry,Y.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,n=0;n<i;n++){var r=e[n];this.addShape(r,t)}},Y.ExtrudeGeometry.prototype.addShape=function(e,t){var i,n,r,o,s,a,l,c,u=void 0!==t.amount?t.amount:100,h=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:h-2,f=void 0!==t.bevelSegments?t.bevelSegments:3,p=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=t.extrudePath,y=!1,b=t.material,x=t.extrudeMaterial,_=void 0!==t.UVGenerator?t.UVGenerator:Y.ExtrudeGeometry.WorldUVGenerator;v&&(i=v.getSpacedPoints(g),y=!0,p=!1,n=void 0!==t.frames?t.frames:new Y.TubeGeometry.FrenetFrames(v,g,!1),r=new Y.Vector3,o=new Y.Vector3,s=new Y.Vector3),p||(f=0,h=0,d=0);var E=this,S=this.vertices.length,A=e.extractPoints(m),w=A.shape,C=A.holes,T=!Y.Shape.Utils.isClockWise(w);if(T){for(w=w.reverse(),l=0,c=C.length;l<c;l++)a=C[l],Y.Shape.Utils.isClockWise(a)&&(C[l]=a.reverse());T=!1}var M=Y.Shape.Utils.triangulateShape(w,C),I=w;for(l=0,c=C.length;l<c;l++)a=C[l],w=w.concat(a);function P(e,t,i){return t||Y.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}var L,R,D,O,B,N,U=w.length,k=M.length;function F(e,t,i){var n,r,o=1e-10,s=1,a=e.x-t.x,l=e.y-t.y,c=i.x-e.x,u=i.y-e.y,h=a*a+l*l,d=a*u-l*c;if(Math.abs(d)>o){var f=Math.sqrt(h),p=Math.sqrt(c*c+u*u),m=t.x-l/f,g=t.y+a/f,v=((i.x-u/p-m)*u-(i.y+c/p-g)*c)/(a*u-l*c),y=(n=m+a*v-e.x)*n+(r=g+l*v-e.y)*r;if(y<=2)return new Y.Vector2(n,r);s=Math.sqrt(y/2)}else{var b=!1;a>o?c>o&&(b=!0):a<-1e-10?c<-1e-10&&(b=!0):Math.sign(l)==Math.sign(u)&&(b=!0),b?(n=-l,r=a,s=Math.sqrt(h)):(n=a,r=l,s=Math.sqrt(h/2))}return new Y.Vector2(n/s,r/s)}for(var V=[],G=0,z=I.length,H=z-1,W=G+1;G<z;G++,H++,W++)H===z&&(H=0),W===z&&(W=0),V[G]=F(I[G],I[H],I[W]);var j,q,K=[],X=V.concat();for(l=0,c=C.length;l<c;l++){for(a=C[l],j=[],G=0,H=(z=a.length)-1,W=G+1;G<z;G++,H++,W++)H===z&&(H=0),W===z&&(W=0),j[G]=F(a[G],a[H],a[W]);K.push(j),X=X.concat(j)}for(L=0;L<f;L++){for(O=h*(1-(D=L/f)),R=d*Math.sin(D*Math.PI/2),G=0,z=I.length;G<z;G++)Z((B=P(I[G],V[G],R)).x,B.y,-O);for(l=0,c=C.length;l<c;l++)for(a=C[l],j=K[l],G=0,z=a.length;G<z;G++)Z((B=P(a[G],j[G],R)).x,B.y,-O)}for(R=d,G=0;G<U;G++)B=p?P(w[G],X[G],R):w[G],y?(o.copy(n.normals[0]).multiplyScalar(B.x),r.copy(n.binormals[0]).multiplyScalar(B.y),s.copy(i[0]).add(o).add(r),Z(s.x,s.y,s.z)):Z(B.x,B.y,0);for(q=1;q<=g;q++)for(G=0;G<U;G++)B=p?P(w[G],X[G],R):w[G],y?(o.copy(n.normals[q]).multiplyScalar(B.x),r.copy(n.binormals[q]).multiplyScalar(B.y),s.copy(i[q]).add(o).add(r),Z(s.x,s.y,s.z)):Z(B.x,B.y,u/g*q);for(L=f-1;L>=0;L--){for(O=h*(1-(D=L/f)),R=d*Math.sin(D*Math.PI/2),G=0,z=I.length;G<z;G++)Z((B=P(I[G],V[G],R)).x,B.y,u+O);for(l=0,c=C.length;l<c;l++)for(a=C[l],j=K[l],G=0,z=a.length;G<z;G++)B=P(a[G],j[G],R),y?Z(B.x,B.y+i[g-1].y,i[g-1].x+O):Z(B.x,B.y,u+O)}function Q(e,t){var i,n;for(G=e.length;--G>=0;){i=G,(n=G-1)<0&&(n=e.length-1);var r=0,o=g+2*f;for(r=0;r<o;r++){var s=U*r,a=U*(r+1);J(t+i+s,t+n+s,t+n+a,t+i+a,e,r,o,i,n)}}}function Z(e,t,i){E.vertices.push(new Y.Vector3(e,t,i))}function $(e,t,i){e+=S,t+=S,i+=S,E.faces.push(new Y.Face3(e,t,i,null,null,b));var n=_.generateTopUV(E,e,t,i);E.faceVertexUvs[0].push(n)}function J(e,t,i,n,r,o,s,a,l){e+=S,t+=S,i+=S,n+=S,E.faces.push(new Y.Face3(e,t,n,null,null,x)),E.faces.push(new Y.Face3(t,i,n,null,null,x));var c=_.generateSideWallUV(E,e,t,i,n);E.faceVertexUvs[0].push([c[0],c[1],c[3]]),E.faceVertexUvs[0].push([c[1],c[2],c[3]])}!function(){if(p){var e=0,t=U*e;for(G=0;G<k;G++)$((N=M[G])[2]+t,N[1]+t,N[0]+t);for(t=U*(e=g+2*f),G=0;G<k;G++)$((N=M[G])[0]+t,N[1]+t,N[2]+t)}else{for(G=0;G<k;G++)$((N=M[G])[2],N[1],N[0]);for(G=0;G<k;G++)$((N=M[G])[0]+U*g,N[1]+U*g,N[2]+U*g)}}(),function(){var e=0;for(Q(I,e),e+=I.length,l=0,c=C.length;l<c;l++)Q(a=C[l],e),e+=a.length}()},Y.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,n){var r=e.vertices,o=r[t],s=r[i],a=r[n];return[new Y.Vector2(o.x,o.y),new Y.Vector2(s.x,s.y),new Y.Vector2(a.x,a.y)]},generateSideWallUV:function(e,t,i,n,r){var o=e.vertices,s=o[t],a=o[i],l=o[n],c=o[r];return Math.abs(s.y-a.y)<.01?[new Y.Vector2(s.x,1-s.z),new Y.Vector2(a.x,1-a.z),new Y.Vector2(l.x,1-l.z),new Y.Vector2(c.x,1-c.z)]:[new Y.Vector2(s.y,1-s.z),new Y.Vector2(a.y,1-a.z),new Y.Vector2(l.y,1-l.z),new Y.Vector2(c.y,1-c.z)]}},Y.ShapeGeometry=function(e,t){Y.Geometry.call(this),this.type="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},Y.ShapeGeometry.prototype=Object.create(Y.Geometry.prototype),Y.ShapeGeometry.prototype.constructor=Y.ShapeGeometry,Y.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,n=e.length;i<n;i++)this.addShape(e[i],t);return this},Y.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,n,r,o=void 0!==t.curveSegments?t.curveSegments:12,s=t.material,a=void 0===t.UVGenerator?Y.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,c=e.extractPoints(o),u=c.shape,h=c.holes,d=!Y.Shape.Utils.isClockWise(u);if(d){for(u=u.reverse(),i=0,n=h.length;i<n;i++)r=h[i],Y.Shape.Utils.isClockWise(r)&&(h[i]=r.reverse());d=!1}var f=Y.Shape.Utils.triangulateShape(u,h);for(i=0,n=h.length;i<n;i++)r=h[i],u=u.concat(r);var p,m,g=u.length,v=f.length;for(i=0;i<g;i++)p=u[i],this.vertices.push(new Y.Vector3(p.x,p.y,0));for(i=0;i<v;i++){var y=(m=f[i])[0]+l,b=m[1]+l,x=m[2]+l;this.faces.push(new Y.Face3(y,b,x,null,null,s)),this.faceVertexUvs[0].push(a.generateTopUV(this,y,b,x))}},Y.LatheGeometry=function(e,t,i,n){Y.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=t||12,i=i||0,n=n||2*Math.PI;for(var r=1/(e.length-1),o=1/t,s=0,a=t;s<=a;s++)for(var l=i+s*o*n,c=Math.cos(l),u=Math.sin(l),h=0,d=e.length;h<d;h++){var f=e[h],p=new Y.Vector3;p.x=c*f.x-u*f.y,p.y=u*f.x+c*f.y,p.z=f.z,this.vertices.push(p)}var m=e.length;for(s=0,a=t;s<a;s++)for(h=0,d=e.length-1;h<d;h++){var g=h+m*s,v=g,y=g+m,b=(c=g+1+m,g+1),x=s*o,_=h*r,E=x+o,S=_+r;this.faces.push(new Y.Face3(v,y,b)),this.faceVertexUvs[0].push([new Y.Vector2(x,_),new Y.Vector2(E,_),new Y.Vector2(x,S)]),this.faces.push(new Y.Face3(y,c,b)),this.faceVertexUvs[0].push([new Y.Vector2(E,_),new Y.Vector2(E,S),new Y.Vector2(x,S)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},Y.LatheGeometry.prototype=Object.create(Y.Geometry.prototype),Y.LatheGeometry.prototype.constructor=Y.LatheGeometry,Y.PlaneGeometry=function(e,t,i,n){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),Y.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new Y.PlaneBufferGeometry(e,t,i,n))},Y.PlaneGeometry.prototype=Object.create(Y.Geometry.prototype),Y.PlaneGeometry.prototype.constructor=Y.PlaneGeometry,Y.PlaneBufferGeometry=function(e,t,i,n){Y.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};for(var r=e/2,o=t/2,s=i||1,a=n||1,l=s+1,c=a+1,u=e/s,h=t/a,d=new Float32Array(l*c*3),f=new Float32Array(l*c*3),p=new Float32Array(l*c*2),m=0,g=0,v=0;v<c;v++)for(var y=v*h-o,b=0;b<l;b++){var x=b*u-r;d[m]=x,d[m+1]=-y,f[m+2]=1,p[g]=b/s,p[g+1]=1-v/a,m+=3,g+=2}m=0;var _=new(d.length/3>65535?Uint32Array:Uint16Array)(s*a*6);for(v=0;v<a;v++)for(b=0;b<s;b++){var E=b+l*v,S=b+l*(v+1),A=b+1+l*(v+1),w=b+1+l*v;_[m]=E,_[m+1]=S,_[m+2]=w,_[m+3]=S,_[m+4]=A,_[m+5]=w,m+=6}this.setAttribute("index",new Y.BufferAttribute(_,1)),this.setAttribute("position",new Y.BufferAttribute(d,3)),this.setAttribute("normal",new Y.BufferAttribute(f,3)),this.setAttribute("uv",new Y.BufferAttribute(p,2))},Y.PlaneBufferGeometry.prototype=Object.create(Y.BufferGeometry.prototype),Y.PlaneBufferGeometry.prototype.constructor=Y.PlaneBufferGeometry,Y.RingGeometry=function(e,t,i,n,r,o){Y.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},e=e||0,t=t||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var s,a,l=[],c=e,u=(t-e)/(n=void 0!==n?Math.max(1,n):8);for(s=0;s<n+1;s++){for(a=0;a<i+1;a++){var h=new Y.Vector3,d=r+a/i*o;h.x=c*Math.cos(d),h.y=c*Math.sin(d),this.vertices.push(h),l.push(new Y.Vector2((h.x/t+1)/2,(h.y/t+1)/2))}c+=u}var f=new Y.Vector3(0,0,1);for(s=0;s<n;s++){var p=s*(i+1);for(a=0;a<i;a++){var m=d=a+p,g=d+i+1,v=d+i+2;this.faces.push(new Y.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()]),m=d,g=d+i+2,v=d+1,this.faces.push(new Y.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new Y.Sphere(new Y.Vector3,c)},Y.RingGeometry.prototype=Object.create(Y.Geometry.prototype),Y.RingGeometry.prototype.constructor=Y.RingGeometry,Y.SphereGeometry=function(e,t,i,n,r,o,s){Y.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:s},e=e||50,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;var a,l,c=[],u=[];for(l=0;l<=i;l++){var h=[],d=[];for(a=0;a<=t;a++){var f=a/t,p=l/i,m=new Y.Vector3;m.x=-e*Math.cos(n+f*r)*Math.sin(o+p*s),m.y=e*Math.cos(o+p*s),m.z=e*Math.sin(n+f*r)*Math.sin(o+p*s),this.vertices.push(m),h.push(this.vertices.length-1),d.push(new Y.Vector2(f,1-p))}c.push(h),u.push(d)}for(l=0;l<i;l++)for(a=0;a<t;a++){var g=c[l][a+1],v=c[l][a],y=c[l+1][a],b=c[l+1][a+1],x=this.vertices[g].clone().normalize(),_=this.vertices[v].clone().normalize(),E=this.vertices[y].clone().normalize(),S=this.vertices[b].clone().normalize(),A=u[l][a+1].clone(),w=u[l][a].clone(),C=u[l+1][a].clone(),T=u[l+1][a+1].clone();Math.abs(this.vertices[g].y)===e?(A.x=(A.x+w.x)/2,this.faces.push(new Y.Face3(g,y,b,[x,E,S])),this.faceVertexUvs[0].push([A,C,T])):Math.abs(this.vertices[y].y)===e?(C.x=(C.x+T.x)/2,this.faces.push(new Y.Face3(g,v,y,[x,_,E])),this.faceVertexUvs[0].push([A,w,C])):(this.faces.push(new Y.Face3(g,v,b,[x,_,S])),this.faceVertexUvs[0].push([A,w,T]),this.faces.push(new Y.Face3(v,y,b,[_.clone(),E,S.clone()])),this.faceVertexUvs[0].push([w.clone(),C,T.clone()]))}this.computeFaceNormals(),this.boundingSphere=new Y.Sphere(new Y.Vector3,e)},Y.SphereGeometry.prototype=Object.create(Y.Geometry.prototype),Y.SphereGeometry.prototype.constructor=Y.SphereGeometry,Y.TextGeometry=function(e,t){t=t||{};var i=Y.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Y.ExtrudeGeometry.call(this,i,t),this.type="TextGeometry"},Y.TextGeometry.prototype=Object.create(Y.ExtrudeGeometry.prototype),Y.TextGeometry.prototype.constructor=Y.TextGeometry,Y.TorusGeometry=function(e,t,i,n,r){Y.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},e=e||100,t=t||40,i=i||8,n=n||6,r=r||2*Math.PI;for(var o=new Y.Vector3,s=[],a=[],l=0;l<=i;l++)for(var c=0;c<=n;c++){var u=c/n*r,h=l/i*Math.PI*2;o.x=e*Math.cos(u),o.y=e*Math.sin(u);var d=new Y.Vector3;d.x=(e+t*Math.cos(h))*Math.cos(u),d.y=(e+t*Math.cos(h))*Math.sin(u),d.z=t*Math.sin(h),this.vertices.push(d),s.push(new Y.Vector2(c/n,l/i)),a.push(d.clone().sub(o).normalize())}for(l=1;l<=i;l++)for(c=1;c<=n;c++){var f=(n+1)*l+c-1,p=(n+1)*(l-1)+c-1,m=(n+1)*(l-1)+c,g=(n+1)*l+c,v=new Y.Face3(f,p,g,[a[f].clone(),a[p].clone(),a[g].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([s[f].clone(),s[p].clone(),s[g].clone()]),v=new Y.Face3(p,m,g,[a[p].clone(),a[m].clone(),a[g].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([s[p].clone(),s[m].clone(),s[g].clone()])}this.computeFaceNormals()},Y.TorusGeometry.prototype=Object.create(Y.Geometry.prototype),Y.TorusGeometry.prototype.constructor=Y.TorusGeometry,Y.TorusKnotGeometry=function(e,t,i,n,r,o,s){Y.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,p:r,q:o,heightScale:s},e=e||100,t=t||40,i=i||64,n=n||8,r=r||2,o=o||3,s=s||1;for(var a=new Array(i),l=new Y.Vector3,c=new Y.Vector3,u=new Y.Vector3,h=0;h<i;++h){a[h]=new Array(n);var d=h/i*2*r*Math.PI,f=P(d,o,r,e,s),p=P(d+.01,o,r,e,s);l.subVectors(p,f),c.addVectors(p,f),u.crossVectors(l,c),c.crossVectors(u,l),u.normalize(),c.normalize();for(var m=0;m<n;++m){var g=m/n*2*Math.PI,v=-t*Math.cos(g),y=t*Math.sin(g),b=new Y.Vector3;b.x=f.x+v*c.x+y*u.x,b.y=f.y+v*c.y+y*u.y,b.z=f.z+v*c.z+y*u.z,a[h][m]=this.vertices.push(b)-1}}for(h=0;h<i;++h)for(m=0;m<n;++m){var x=(h+1)%i,_=(m+1)%n,E=a[h][m],S=a[x][m],A=a[x][_],w=a[h][_],C=new Y.Vector2(h/i,m/n),T=new Y.Vector2((h+1)/i,m/n),M=new Y.Vector2((h+1)/i,(m+1)/n),I=new Y.Vector2(h/i,(m+1)/n);this.faces.push(new Y.Face3(E,S,w)),this.faceVertexUvs[0].push([C,T,I]),this.faces.push(new Y.Face3(S,A,w)),this.faceVertexUvs[0].push([T.clone(),M,I.clone()])}function P(e,t,i,n,r){var o=Math.cos(e),s=Math.sin(e),a=t/i*e,l=Math.cos(a),c=n*(2+l)*.5*o,u=n*(2+l)*s*.5,h=r*n*Math.sin(a)*.5;return new Y.Vector3(c,u,h)}this.computeFaceNormals(),this.computeVertexNormals()},Y.TorusKnotGeometry.prototype=Object.create(Y.Geometry.prototype),Y.TorusKnotGeometry.prototype.constructor=Y.TorusKnotGeometry,Y.TubeGeometry=function(e,t,i,n,r,o){Y.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:i,radialSegments:n,closed:r},t=t||64,i=i||1,n=n||8,r=r||!1,o=o||Y.TubeGeometry.NoTaper;var s,a,l,c,u,h,d,f,p,m,g,v,y,b,x,_,E,S,A,w,C=[],T=this,M=t+1,I=new Y.Vector3,P=new Y.TubeGeometry.FrenetFrames(e,t,r),L=P.tangents,R=P.normals,D=P.binormals;function O(e,t,i){return T.vertices.push(new Y.Vector3(e,t,i))-1}for(this.tangents=L,this.normals=R,this.binormals=D,p=0;p<M;p++)for(C[p]=[],l=p/(M-1),f=e.getPointAt(l),L[p],s=R[p],a=D[p],u=i*o(l),m=0;m<n;m++)c=m/n*2*Math.PI,h=-u*Math.cos(c),d=u*Math.sin(c),I.copy(f),I.x+=h*s.x+d*a.x,I.y+=h*s.y+d*a.y,I.z+=h*s.z+d*a.z,C[p][m]=O(I.x,I.y,I.z);for(p=0;p<t;p++)for(m=0;m<n;m++)g=r?(p+1)%t:p+1,v=(m+1)%n,y=C[p][m],b=C[g][m],x=C[g][v],_=C[p][v],E=new Y.Vector2(p/t,m/n),S=new Y.Vector2((p+1)/t,m/n),A=new Y.Vector2((p+1)/t,(m+1)/n),w=new Y.Vector2(p/t,(m+1)/n),this.faces.push(new Y.Face3(y,b,_)),this.faceVertexUvs[0].push([E,S,w]),this.faces.push(new Y.Face3(b,x,_)),this.faceVertexUvs[0].push([S.clone(),A,w.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},Y.TubeGeometry.prototype=Object.create(Y.Geometry.prototype),Y.TubeGeometry.prototype.constructor=Y.TubeGeometry,Y.TubeGeometry.NoTaper=function(e){return 1},Y.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},Y.TubeGeometry.FrenetFrames=function(e,t,i){var n,r,o,s,a,l,c,u=new Y.Vector3,h=[],d=[],f=[],p=new Y.Vector3,m=new Y.Matrix4,g=t+1;for(this.tangents=h,this.normals=d,this.binormals=f,l=0;l<g;l++)c=l/(g-1),h[l]=e.getTangentAt(c),h[l].normalize();for(function(){d[0]=new Y.Vector3,f[0]=new Y.Vector3,r=Number.MAX_VALUE,o=Math.abs(h[0].x),s=Math.abs(h[0].y),a=Math.abs(h[0].z),o<=r&&(r=o,u.set(1,0,0));s<=r&&(r=s,u.set(0,1,0));a<=r&&u.set(0,0,1);p.crossVectors(h[0],u).normalize(),d[0].crossVectors(h[0],p),f[0].crossVectors(h[0],d[0])}(),l=1;l<g;l++)d[l]=d[l-1].clone(),f[l]=f[l-1].clone(),p.crossVectors(h[l-1],h[l]),p.length()>1e-4&&(p.normalize(),n=Math.acos(Y.Math.clamp(h[l-1].dot(h[l]),-1,1)),d[l].applyMatrix4(m.makeRotationAxis(p,n))),f[l].crossVectors(h[l],d[l]);if(i)for(n=Math.acos(Y.Math.clamp(d[0].dot(d[g-1]),-1,1)),n/=g-1,h[0].dot(p.crossVectors(d[0],d[g-1]))>0&&(n=-n),l=1;l<g;l++)d[l].applyMatrix4(m.makeRotationAxis(h[l],n*l)),f[l].crossVectors(h[l],d[l])},Y.PolyhedronGeometry=function(e,t,i,n){Y.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},i=i||1,n=n||0;for(var r=this,o=0,s=e.length;o<s;o+=3)x(new Y.Vector3(e[o],e[o+1],e[o+2]));var a=this.vertices,l=[],c=(o=0,0);for(s=t.length;o<s;o+=3,c++){var u=a[t[o]],h=a[t[o+1]],d=a[t[o+2]];l[c]=new Y.Face3(u.index,h.index,d.index,[u.clone(),h.clone(),d.clone()])}var f=new Y.Vector3;for(o=0,s=l.length;o<s;o++)E(l[o],n);for(o=0,s=this.faceVertexUvs[0].length;o<s;o++){var p=this.faceVertexUvs[0][o],m=p[0].x,g=p[1].x,v=p[2].x,y=Math.max(m,Math.max(g,v)),b=Math.min(m,Math.min(g,v));y>.9&&b<.1&&(m<.2&&(p[0].x+=1),g<.2&&(p[1].x+=1),v<.2&&(p[2].x+=1))}for(o=0,s=this.vertices.length;o<s;o++)this.vertices[o].multiplyScalar(i);function x(e){var t=e.normalize().clone();t.index=r.vertices.push(t)-1;var i=S(e)/2/Math.PI+.5,n=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new Y.Vector2(i,1-n),t}function _(e,t,i){var n=new Y.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);r.faces.push(n),f.copy(e).add(t).add(i).divideScalar(3);var o=S(f);r.faceVertexUvs[0].push([A(e.uv,e,o),A(t.uv,t,o),A(i.uv,i,o)])}function E(e,t){for(var i=Math.pow(2,t),n=x(r.vertices[e.a]),o=x(r.vertices[e.b]),s=x(r.vertices[e.c]),a=[],l=0;l<=i;l++){a[l]=[];for(var c=x(n.clone().lerp(s,l/i)),u=x(o.clone().lerp(s,l/i)),h=i-l,d=0;d<=h;d++)a[l][d]=0==d&&l==i?c:x(c.clone().lerp(u,d/h))}for(l=0;l<i;l++)for(d=0;d<2*(i-l)-1;d++){var f=Math.floor(d/2);d%2==0?_(a[l][f+1],a[l+1][f],a[l][f]):_(a[l][f+1],a[l+1][f+1],a[l+1][f])}}function S(e){return Math.atan2(e.z,-e.x)}function A(e,t,i){return i<0&&1===e.x&&(e=new Y.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new Y.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new Y.Sphere(new Y.Vector3,i)},Y.PolyhedronGeometry.prototype=Object.create(Y.Geometry.prototype),Y.PolyhedronGeometry.prototype.constructor=Y.PolyhedronGeometry,Y.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n];Y.PolyhedronGeometry.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t)},Y.DodecahedronGeometry.prototype=Object.create(Y.Geometry.prototype),Y.DodecahedronGeometry.prototype.constructor=Y.DodecahedronGeometry,Y.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];Y.PolyhedronGeometry.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},Y.IcosahedronGeometry.prototype=Object.create(Y.Geometry.prototype),Y.IcosahedronGeometry.prototype.constructor=Y.IcosahedronGeometry,Y.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};Y.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},Y.OctahedronGeometry.prototype=Object.create(Y.Geometry.prototype),Y.OctahedronGeometry.prototype.constructor=Y.OctahedronGeometry,Y.TetrahedronGeometry=function(e,t){Y.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},Y.TetrahedronGeometry.prototype=Object.create(Y.Geometry.prototype),Y.TetrahedronGeometry.prototype.constructor=Y.TetrahedronGeometry,Y.ParametricGeometry=function(e,t,i){Y.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};var n,r,o,s,a,l,c,u,h,d,f,p,m=this.vertices,g=this.faces,v=this.faceVertexUvs[0],y=t+1;for(n=0;n<=i;n++)for(s=n/i,r=0;r<=t;r++)o=e(r/t,s),m.push(o);for(n=0;n<i;n++)for(r=0;r<t;r++)a=n*y+r,l=n*y+r+1,c=(n+1)*y+r+1,u=(n+1)*y+r,h=new Y.Vector2(r/t,n/i),d=new Y.Vector2((r+1)/t,n/i),f=new Y.Vector2((r+1)/t,(n+1)/i),p=new Y.Vector2(r/t,(n+1)/i),g.push(new Y.Face3(a,l,u)),v.push([h,d,p]),g.push(new Y.Face3(l,c,u)),v.push([d.clone(),f,p.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},Y.ParametricGeometry.prototype=Object.create(Y.Geometry.prototype),Y.ParametricGeometry.prototype.constructor=Y.ParametricGeometry,Y.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),i=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),n=new Y.BufferGeometry;n.setAttribute("position",new Y.BufferAttribute(t,3)),n.setAttribute("color",new Y.BufferAttribute(i,3));var r=new Y.LineBasicMaterial({vertexColors:Y.VertexColors});Y.Line.call(this,n,r,Y.LinePieces)},Y.AxisHelper.prototype=Object.create(Y.Line.prototype),Y.AxisHelper.prototype.constructor=Y.AxisHelper,Y.ArrowHelper=function(){var e=new Y.Geometry;e.vertices.push(new Y.Vector3(0,0,0),new Y.Vector3(0,1,0));var t=new Y.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new Y.Matrix4).makeTranslation(0,-.5,0)),function(i,n,r,o,s,a){Y.Object3D.call(this),void 0===o&&(o=16776960),void 0===r&&(r=1),void 0===s&&(s=.2*r),void 0===a&&(a=.2*s),this.position.copy(n),this.line=new Y.Line(e,new Y.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Y.Mesh(t,new Y.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(r,s,a)}}(),Y.ArrowHelper.prototype=Object.create(Y.Object3D.prototype),Y.ArrowHelper.prototype.constructor=Y.ArrowHelper,Y.ArrowHelper.prototype.setDirection=(X=new Y.Vector3,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(X.set(e.z,0,-e.x).normalize(),K=Math.acos(e.y),this.quaternion.setFromAxisAngle(X,K))}),Y.ArrowHelper.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,e-t,1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},Y.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Y.BoxHelper=function(e){var t=new Y.BufferGeometry;t.setAttribute("position",new Y.BufferAttribute(new Float32Array(72),3)),Y.Line.call(this,t,new Y.LineBasicMaterial({color:16776960}),Y.LinePieces),void 0!==e&&this.update(e)},Y.BoxHelper.prototype=Object.create(Y.Line.prototype),Y.BoxHelper.prototype.constructor=Y.BoxHelper,Y.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var i=t.boundingBox.min,n=t.boundingBox.max,r=this.geometry.attributes.position.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=i.x,r[4]=n.y,r[5]=n.z,r[6]=i.x,r[7]=n.y,r[8]=n.z,r[9]=i.x,r[10]=i.y,r[11]=n.z,r[12]=i.x,r[13]=i.y,r[14]=n.z,r[15]=n.x,r[16]=i.y,r[17]=n.z,r[18]=n.x,r[19]=i.y,r[20]=n.z,r[21]=n.x,r[22]=n.y,r[23]=n.z,r[24]=n.x,r[25]=n.y,r[26]=i.z,r[27]=i.x,r[28]=n.y,r[29]=i.z,r[30]=i.x,r[31]=n.y,r[32]=i.z,r[33]=i.x,r[34]=i.y,r[35]=i.z,r[36]=i.x,r[37]=i.y,r[38]=i.z,r[39]=n.x,r[40]=i.y,r[41]=i.z,r[42]=n.x,r[43]=i.y,r[44]=i.z,r[45]=n.x,r[46]=n.y,r[47]=i.z,r[48]=n.x,r[49]=n.y,r[50]=n.z,r[51]=n.x,r[52]=n.y,r[53]=i.z,r[54]=i.x,r[55]=n.y,r[56]=n.z,r[57]=i.x,r[58]=n.y,r[59]=i.z,r[60]=i.x,r[61]=i.y,r[62]=n.z,r[63]=i.x,r[64]=i.y,r[65]=i.z,r[66]=n.x,r[67]=i.y,r[68]=n.z,r[69]=n.x,r[70]=i.y,r[71]=i.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Y.BoundingBoxHelper=function(e,t){var i=void 0!==t?t:8947848;this.object=e,this.box=new Y.Box3,Y.Mesh.call(this,new Y.BoxGeometry(1,1,1),new Y.MeshBasicMaterial({color:i,wireframe:!0}))},Y.BoundingBoxHelper.prototype=Object.create(Y.Mesh.prototype),Y.BoundingBoxHelper.prototype.constructor=Y.BoundingBoxHelper,Y.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.getCenter(this.position)},Y.CameraHelper=function(e){var t=new Y.Geometry,i=new Y.LineBasicMaterial({color:16777215,vertexColors:Y.FaceColors}),n={},r=16755200,o=16711680,s=43775,a=3355443;function l(e,t,i){c(e,i),c(t,i)}function c(e,i){t.vertices.push(new Y.Vector3),t.colors.push(new Y.Color(i)),void 0===n[e]&&(n[e]=[]),n[e].push(t.vertices.length-1)}l("n1","n2",r),l("n2","n4",r),l("n4","n3",r),l("n3","n1",r),l("f1","f2",r),l("f2","f4",r),l("f4","f3",r),l("f3","f1",r),l("n1","f1",r),l("n2","f2",r),l("n3","f3",r),l("n4","f4",r),l("p","n1",o),l("p","n2",o),l("p","n3",o),l("p","n4",o),l("u1","u2",s),l("u2","u3",s),l("u3","u1",s),l("c","t",16777215),l("p","c",a),l("cn1","cn2",a),l("cn3","cn4",a),l("cf1","cf2",a),l("cf3","cf4",a),Y.Line.call(this,t,i,Y.LinePieces),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update()},Y.CameraHelper.prototype=Object.create(Y.Line.prototype),Y.CameraHelper.prototype.constructor=Y.CameraHelper,Y.CameraHelper.prototype.update=function(){var e,t,i=new Y.Vector3,n=new Y.Camera,r=function(r,o,s,a){i.set(o,s,a).unproject(n);var l=t[r];if(void 0!==l)for(var c=0,u=l.length;c<u;c++)e.vertices[l[c]].copy(i)};return function(){e=this.geometry,t=this.pointMap;n.projectionMatrix.copy(this.camera.projectionMatrix),r("c",0,0,-1),r("t",0,0,1),r("n1",-1,-1,-1),r("n2",1,-1,-1),r("n3",-1,1,-1),r("n4",1,1,-1),r("f1",-1,-1,1),r("f2",1,-1,1),r("f3",-1,1,1),r("f4",1,1,1),r("u1",.7,1.1,-1),r("u2",-.7,1.1,-1),r("u3",0,2,-1),r("cf1",-1,0,1),r("cf2",1,0,1),r("cf3",0,-1,1),r("cf4",0,1,1),r("cn1",-1,0,-1),r("cn2",1,0,-1),r("cn3",0,-1,-1),r("cn4",0,1,-1),e.verticesNeedUpdate=!0}}(),Y.DirectionalLightHelper=function(e,t){Y.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var i=new Y.Geometry;i.vertices.push(new Y.Vector3(-t,t,0),new Y.Vector3(t,t,0),new Y.Vector3(t,-t,0),new Y.Vector3(-t,-t,0),new Y.Vector3(-t,t,0));var n=new Y.LineBasicMaterial({fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new Y.Line(i,n),this.add(this.lightPlane),(i=new Y.Geometry).vertices.push(new Y.Vector3,new Y.Vector3),(n=new Y.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new Y.Line(i,n),this.add(this.targetLine),this.update()},Y.DirectionalLightHelper.prototype=Object.create(Y.Object3D.prototype),Y.DirectionalLightHelper.prototype.constructor=Y.DirectionalLightHelper,Y.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Y.DirectionalLightHelper.prototype.update=function(){var e=new Y.Vector3,t=new Y.Vector3,i=new Y.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(i),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(i),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),Y.EdgesHelper=function(e,t,i){var n=void 0!==t?t:16777215;i=void 0!==i?i:1;var r,o=Math.cos(Y.Math.degToRad(i)),s=[0,0],a={},l=function(e,t){return e-t},c=["a","b","c"],u=new Y.BufferGeometry;e.geometry instanceof Y.BufferGeometry?(r=new Y.Geometry).fromBufferGeometry(e.geometry):r=e.geometry.clone(),r.mergeVertices(),r.computeFaceNormals();for(var h=r.vertices,d=r.faces,f=0,p=0,m=d.length;p<m;p++)for(var g=d[p],v=0;v<3;v++){s[0]=g[c[v]],s[1]=g[c[(v+1)%3]],s.sort(l),void 0===a[x=s.toString()]?(a[x]={vert1:s[0],vert2:s[1],face1:p,face2:void 0},f++):a[x].face2=p}var y=new Float32Array(2*f*3),b=0;for(var x in a){var _=a[x];if(void 0===_.face2||d[_.face1].normal.dot(d[_.face2].normal)<=o){var E=h[_.vert1];y[b++]=E.x,y[b++]=E.y,y[b++]=E.z,E=h[_.vert2],y[b++]=E.x,y[b++]=E.y,y[b++]=E.z}}u.setAttribute("position",new Y.BufferAttribute(y,3)),Y.Line.call(this,u,new Y.LineBasicMaterial({color:n}),Y.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Y.EdgesHelper.prototype=Object.create(Y.Line.prototype),Y.EdgesHelper.prototype.constructor=Y.EdgesHelper,Y.FaceNormalsHelper=function(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;for(var r=void 0!==i?i:16776960,o=void 0!==n?n:1,s=new Y.Geometry,a=0,l=this.object.geometry.faces.length;a<l;a++)s.vertices.push(new Y.Vector3,new Y.Vector3);Y.Line.call(this,s,new Y.LineBasicMaterial({color:r,linewidth:o}),Y.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new Y.Matrix3,this.update()},Y.FaceNormalsHelper.prototype=Object.create(Y.Line.prototype),Y.FaceNormalsHelper.prototype.constructor=Y.FaceNormalsHelper,Y.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,i=t.geometry.vertices,n=t.geometry.faces,r=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(r);for(var o=0,s=0,a=n.length;o<a;o++,s+=2){var l=n[o];e[s].copy(i[l.a]).add(i[l.b]).add(i[l.c]).divideScalar(3).applyMatrix4(r),e[s+1].copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[s])}return this.geometry.verticesNeedUpdate=!0,this},Y.GridHelper=function(e,t){var i=new Y.Geometry,n=new Y.LineBasicMaterial({vertexColors:Y.VertexColors});this.color1=new Y.Color(4473924),this.color2=new Y.Color(8947848);for(var r=-e;r<=e;r+=t){i.vertices.push(new Y.Vector3(-e,0,r),new Y.Vector3(e,0,r),new Y.Vector3(r,0,-e),new Y.Vector3(r,0,e));var o=0===r?this.color1:this.color2;i.colors.push(o,o,o,o)}Y.Line.call(this,i,n,Y.LinePieces)},Y.GridHelper.prototype=Object.create(Y.Line.prototype),Y.GridHelper.prototype.constructor=Y.GridHelper,Y.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},Y.HemisphereLightHelper=function(e,t){Y.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new Y.Color,new Y.Color];var i=new Y.SphereGeometry(t,4,2);i.applyMatrix((new Y.Matrix4).makeRotationX(-Math.PI/2));for(var n=0;n<8;n++)i.faces[n].color=this.colors[n<4?0:1];var r=new Y.MeshBasicMaterial({vertexColors:Y.FaceColors,wireframe:!0});this.lightSphere=new Y.Mesh(i,r),this.add(this.lightSphere),this.update()},Y.HemisphereLightHelper.prototype=Object.create(Y.Object3D.prototype),Y.HemisphereLightHelper.prototype.constructor=Y.HemisphereLightHelper,Y.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},Y.HemisphereLightHelper.prototype.update=function(){var e=new Y.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),Y.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var i=new Y.SphereGeometry(t,4,2),n=new Y.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),Y.Mesh.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},Y.PointLightHelper.prototype=Object.create(Y.Mesh.prototype),Y.PointLightHelper.prototype.constructor=Y.PointLightHelper,Y.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Y.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},Y.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new Y.Geometry,i=0;i<this.bones.length;i++){this.bones[i].parent instanceof Y.Bone&&(t.vertices.push(new Y.Vector3),t.vertices.push(new Y.Vector3),t.colors.push(new Y.Color(0,0,1)),t.colors.push(new Y.Color(0,1,0)))}var n=new Y.LineBasicMaterial({vertexColors:Y.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});Y.Line.call(this,t,n,Y.LinePieces),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},Y.SkeletonHelper.prototype=Object.create(Y.Line.prototype),Y.SkeletonHelper.prototype.constructor=Y.SkeletonHelper,Y.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof Y.Bone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,this.getBoneList(e.children[i]));return t},Y.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new Y.Matrix4).getInverse(this.root.matrixWorld),i=new Y.Matrix4,n=0,r=0;r<this.bones.length;r++){var o=this.bones[r];o.parent instanceof Y.Bone&&(i.multiplyMatrices(t,o.matrixWorld),e.vertices[n].setFromMatrixPosition(i),i.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[n+1].setFromMatrixPosition(i),n+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},Y.SpotLightHelper=function(e){Y.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new Y.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new Y.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new Y.Matrix4).makeRotationX(-Math.PI/2));var i=new Y.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new Y.Mesh(t,i),this.add(this.cone),this.update()},Y.SpotLightHelper.prototype=Object.create(Y.Object3D.prototype),Y.SpotLightHelper.prototype.constructor=Y.SpotLightHelper,Y.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Y.SpotLightHelper.prototype.update=function(){var e=new Y.Vector3,t=new Y.Vector3;return function(){var i=this.light.distance?this.light.distance:1e4,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),Y.VertexNormalsHelper=function(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;for(var r=void 0!==i?i:16711680,o=void 0!==n?n:1,s=new Y.Geometry,a=e.geometry.faces,l=0,c=a.length;l<c;l++)for(var u=0,h=a[l].vertexNormals.length;u<h;u++)s.vertices.push(new Y.Vector3,new Y.Vector3);Y.Line.call(this,s,new Y.LineBasicMaterial({color:r,linewidth:o}),Y.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new Y.Matrix3,this.update()},Y.VertexNormalsHelper.prototype=Object.create(Y.Line.prototype),Y.VertexNormalsHelper.prototype.constructor=Y.VertexNormalsHelper,Y.VertexNormalsHelper.prototype.update=function(e){var t=new Y.Vector3;return function(e){var i=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,s=this.object.matrixWorld,a=0,l=0,c=o.length;l<c;l++)for(var u=o[l],h=0,d=u.vertexNormals.length;h<d;h++){var f=r[u[i[h]]],p=u.vertexNormals[h];n[a].copy(f).applyMatrix4(s),t.copy(p).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(n[a]),n[a+=1].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),Y.VertexTangentsHelper=function(e,t,i,n){this.object=e,this.size=void 0!==t?t:1;for(var r=void 0!==i?i:255,o=void 0!==n?n:1,s=new Y.Geometry,a=e.geometry.faces,l=0,c=a.length;l<c;l++)for(var u=0,h=a[l].vertexTangents.length;u<h;u++)s.vertices.push(new Y.Vector3),s.vertices.push(new Y.Vector3);Y.Line.call(this,s,new Y.LineBasicMaterial({color:r,linewidth:o}),Y.LinePieces),this.matrixAutoUpdate=!1,this.update()},Y.VertexTangentsHelper.prototype=Object.create(Y.Line.prototype),Y.VertexTangentsHelper.prototype.constructor=Y.VertexTangentsHelper,Y.VertexTangentsHelper.prototype.update=function(e){var t=new Y.Vector3;return function(e){var i=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,s=this.object.matrixWorld,a=0,l=0,c=o.length;l<c;l++)for(var u=o[l],h=0,d=u.vertexTangents.length;h<d;h++){var f=r[u[i[h]]],p=u.vertexTangents[h];n[a].copy(f).applyMatrix4(s),t.copy(p).transformDirection(s).multiplyScalar(this.size),t.add(n[a]),n[a+=1].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),Y.WireframeHelper=function(e,t){var i=void 0!==t?t:16777215,n=[0,0],r={},o=function(e,t){return e-t},s=["a","b","c"],a=new Y.BufferGeometry;if(e.geometry instanceof Y.Geometry){for(var l=e.geometry.vertices,c=e.geometry.faces,u=0,h=new Uint32Array(6*c.length),d=0,f=c.length;d<f;d++)for(var p=c[d],m=0;m<3;m++){n[0]=p[s[m]],n[1]=p[s[(m+1)%3]],n.sort(o),void 0===r[C=n.toString()]&&(h[2*u]=n[0],h[2*u+1]=n[1],r[C]=!0,u++)}var g=new Float32Array(2*u*3);for(d=0,f=u;d<f;d++)for(m=0;m<2;m++){var v=l[h[2*d+m]];g[(A=6*d+3*m)+0]=v.x,g[A+1]=v.y,g[A+2]=v.z}a.setAttribute("position",new Y.BufferAttribute(g,3))}else if(e.geometry instanceof Y.BufferGeometry)if(void 0!==e.geometry.attributes.index){l=e.geometry.attributes.position.array;var y=e.geometry.attributes.index.array,b=e.geometry.drawcalls;u=0;0===b.length&&(b=[{count:y.length,index:0,start:0}]);h=new Uint32Array(2*y.length);for(var x=0,_=b.length;x<_;++x)for(var E=b[x].start,S=b[x].count,A=b[x].index,w=(d=E,E+S);d<w;d+=3)for(m=0;m<3;m++){var C;n[0]=A+y[d+m],n[1]=A+y[d+(m+1)%3],n.sort(o),void 0===r[C=n.toString()]&&(h[2*u]=n[0],h[2*u+1]=n[1],r[C]=!0,u++)}for(g=new Float32Array(2*u*3),d=0,f=u;d<f;d++)for(m=0;m<2;m++){A=6*d+3*m;var T=3*h[2*d+m];g[A+0]=l[T],g[A+1]=l[T+1],g[A+2]=l[T+2]}a.setAttribute("position",new Y.BufferAttribute(g,3))}else{var M=(u=(l=e.geometry.attributes.position.array).length/3)/3;for(g=new Float32Array(2*u*3),d=0,f=M;d<f;d++)for(m=0;m<3;m++){var I=9*d+3*m;g[(A=18*d+6*m)+0]=l[I],g[A+1]=l[I+1],g[A+2]=l[I+2];T=9*d+(m+1)%3*3;g[A+3]=l[T],g[A+4]=l[T+1],g[A+5]=l[T+2]}a.setAttribute("position",new Y.BufferAttribute(g,3))}Y.Line.call(this,a,new Y.LineBasicMaterial({color:i}),Y.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Y.WireframeHelper.prototype=Object.create(Y.Line.prototype),Y.WireframeHelper.prototype.constructor=Y.WireframeHelper,Y.ImmediateRenderObject=function(){Y.Object3D.call(this),this.render=function(e){}},Y.ImmediateRenderObject.prototype=Object.create(Y.Object3D.prototype),Y.ImmediateRenderObject.prototype.constructor=Y.ImmediateRenderObject,Y.MorphBlendMesh=function(e,t){Y.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,n="__default",r=i-1,o=i/1;this.createAnimation(n,0,r,o),this.setAnimationWeight(n,1)},Y.MorphBlendMesh.prototype=Object.create(Y.Mesh.prototype),Y.MorphBlendMesh.prototype.constructor=Y.MorphBlendMesh,Y.MorphBlendMesh.prototype.createAnimation=function(e,t,i,n){var r={startFrame:t,endFrame:i,length:i-t+1,fps:n,duration:(i-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=r,this.animationsList.push(r)},Y.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)_?(\d+)/,n={},r=this.geometry,o=0,s=r.morphTargets.length;o<s;o++){var a=r.morphTargets[o].name.match(i);if(a&&a.length>1)n[l=a[1]]||(n[l]={start:1/0,end:-1/0}),o<(c=n[l]).start&&(c.start=o),o>c.end&&(c.end=o),t||(t=l)}for(var l in n){var c=n[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},Y.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},Y.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},Y.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},Y.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},Y.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},Y.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},Y.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},Y.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},Y.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):Y.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},Y.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},Y.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var n=this.animationsList[t];if(n.active){var r=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.startFrame+Y.Math.clamp(Math.floor(n.time/r),0,n.length-1),s=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*s,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var a=n.time%r/r;n.directionBackwards&&(a=1-a),this.morphTargetInfluences[n.currentFrame]=a*s,this.morphTargetInfluences[n.lastFrame]=(1-a)*s}}};const{polyfillTHREE:Q}=i(63004);Q(Y)},67526:(e,t)=>{"use strict";t.byteLength=function(e){var t=a(e),i=t[0],n=t[1];return 3*(i+n)/4-n},t.toByteArray=function(e){var t,i,o=a(e),s=o[0],l=o[1],c=new r(function(e,t,i){return 3*(t+i)/4-i}(0,s,l)),u=0,h=l>0?s-4:s;for(i=0;i<h;i+=4)t=n[e.charCodeAt(i)]<<18|n[e.charCodeAt(i+1)]<<12|n[e.charCodeAt(i+2)]<<6|n[e.charCodeAt(i+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;2===l&&(t=n[e.charCodeAt(i)]<<2|n[e.charCodeAt(i+1)]>>4,c[u++]=255&t);1===l&&(t=n[e.charCodeAt(i)]<<10|n[e.charCodeAt(i+1)]<<4|n[e.charCodeAt(i+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,o=[],s=16383,a=0,c=n-r;a<c;a+=s)o.push(l(e,a,a+s>c?c:a+s));1===r?(t=e[n-1],o.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],o.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return o.join("")};for(var i=[],n=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)i[s]=o[s],n[o.charCodeAt(s)]=s;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function l(e,t,n){for(var r,o,s=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(i[(o=r)>>18&63]+i[o>>12&63]+i[o>>6&63]+i[63&o]);return s.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},31320:e=>{e.exports=function(){"use strict";var e=function(){for(var e=3,t=document.createElement("b"),i=t.all||[];t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i><![endif]--\x3e",i[0];);return e>4?e:document.documentMode}(),t=navigator.platform.toLowerCase().indexOf("mac")+1,i=function(e){if(!(this instanceof i))return new i(e);var s=this,a={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};s.options={};for(var l,c=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],u=0;l=c[u];u++)s.options[l]=void 0!==e[l]&&null!=e[l]?e[l]:a[l];var h,d=["scroll","content"];for(u=0;h=d[u];u++)if(s[h+"_elem"]=e[h+"Id"]?document.getElementById(e[h+"Id"]):e[h+"Elem"],!s[h+"_elem"])throw new Error("Error! Could not find "+h+" element");s.content_elem.hasAttribute("tabindex")||s.content_elem.setAttribute("tabindex",0);var f=o(e.rows)?e.rows:s.fetchMarkup(),p={},m=s.scroll_elem.scrollTop;s.insertToDOM(f,p),s.scroll_elem.scrollTop=m;var g=!1,v=0,y=!1,b=function(){t&&(y||(s.content_elem.style.pointerEvents="none"),y=!0,clearTimeout(v),v=setTimeout((function(){s.content_elem.style.pointerEvents="auto",y=!1}),50)),g!=(g=s.getClusterNum())&&s.insertToDOM(f,p),s.options.callbacks.scrollingProgress&&s.options.callbacks.scrollingProgress(s.getScrollProgress())},x=0,_=function(){clearTimeout(x),x=setTimeout(s.refresh,100)};n("scroll",s.scroll_elem,b),n("resize",window,_),s.destroy=function(e){r("scroll",s.scroll_elem,b),r("resize",window,_),s.html((e?s.generateEmptyRow():f).join(""))},s.refresh=function(e){(s.getRowsHeight(f)||e)&&s.update(f)},s.update=function(e){f=o(e)?e:[];var t=s.scroll_elem.scrollTop;f.length*s.options.item_height<t&&(s.scroll_elem.scrollTop=0,g=0),s.insertToDOM(f,p),s.scroll_elem.scrollTop=t},s.clear=function(){s.update([])},s.getRowsAmount=function(){return f.length},s.getScrollProgress=function(){return this.options.scroll_top/(f.length*this.options.item_height)*100||0};var E=function(e,t){var i=o(t)?t:[];i.length&&(f="append"==e?f.concat(i):i.concat(f),s.insertToDOM(f,p))};s.append=function(e){E("append",e)},s.prepend=function(e){E("prepend",e)}};function n(e,t,i){return t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function r(e,t,i){return t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent("on"+e,i)}function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function s(e,t){return window.getComputedStyle?window.getComputedStyle(t)[e]:t.currentStyle[e]}return i.prototype={constructor:i,fetchMarkup:function(){for(var e=[],t=this.getChildNodes(this.content_elem);t.length;)e.push(t.shift().outerHTML);return e},exploreEnvironment:function(t,i){var n=this.options;n.content_tag=this.content_elem.tagName.toLowerCase(),t.length&&(e&&e<=9&&!n.tag&&(n.tag=t[0].match(/<([^>\s/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&(i.data=this.html(t[0]+t[0]+t[0])),n.tag||(n.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(t))},getRowsHeight:function(e){var t=this.options,i=t.item_height;if(t.cluster_height=0,e.length){var n=this.content_elem.children;if(n.length){var r=n[Math.floor(n.length/2)];if(t.item_height=r.offsetHeight,"tr"==t.tag&&"collapse"!=s("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(s("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){var o=parseInt(s("marginTop",r),10)||0,a=parseInt(s("marginBottom",r),10)||0;t.item_height+=Math.max(o,a)}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,i!=t.item_height}}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var e=this.options;if(!e.tag||!e.show_no_data_row)return[];var t,i=document.createElement(e.tag),n=document.createTextNode(e.no_data_text);return i.className=e.no_data_class,"tr"==e.tag&&((t=document.createElement("td")).colSpan=100,t.appendChild(n)),i.appendChild(t||n),[i.outerHTML]},generate:function(e,t){var i=this.options,n=e.length;if(n<i.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:n?e:this.generateEmptyRow()};var r=Math.max((i.rows_in_cluster-i.rows_in_block)*t,0),o=r+i.rows_in_cluster,s=Math.max(r*i.item_height,0),a=Math.max((n-o)*i.item_height,0),l=[],c=r;s<1&&c++;for(var u=r;u<o;u++)e[u]&&l.push(e[u]);return{top_offset:s,bottom_offset:a,rows_above:c,rows:l}},renderExtraTag:function(e,t){var i=document.createElement(this.options.tag),n="clusterize-";return i.className=[n+"extra-row",n+e].join(" "),t&&(i.style.height=t+"px"),i.outerHTML},insertToDOM:function(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);var i=this.generate(e,this.getClusterNum()),n=i.rows.join(""),r=this.checkChanges("data",n,t),o=this.checkChanges("top",i.top_offset,t),s=this.checkChanges("bottom",i.bottom_offset,t),a=this.options.callbacks,l=[];r||o?(i.top_offset&&(this.options.keep_parity&&l.push(this.renderExtraTag("keep-parity")),l.push(this.renderExtraTag("top-space",i.top_offset))),l.push(n),i.bottom_offset&&l.push(this.renderExtraTag("bottom-space",i.bottom_offset)),a.clusterWillChange&&a.clusterWillChange(),this.html(l.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",i.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(i.rows_above-1),a.clusterChanged&&a.clusterChanged()):s&&(this.content_elem.lastChild.style.height=i.bottom_offset+"px")},html:function(t){var i=this.content_elem;if(e&&e<=9&&"tr"==this.options.tag){var n,r=document.createElement("div");for(r.innerHTML="<table><tbody>"+t+"</tbody></table>";n=i.lastChild;)i.removeChild(n);for(var o=this.getChildNodes(r.firstChild.firstChild);o.length;)i.appendChild(o.shift())}else i.innerHTML=t},getChildNodes:function(e){for(var t=e.children,i=[],n=0,r=t.length;n<r;n++)i.push(t[n]);return i},checkChanges:function(e,t,i){var n=t!=i[e];return i[e]=t,n}},i}()},18211:(e,t,i)=>{"use strict";var n=i(67526),r=i(251),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */t.hp=l,t.IS=50;var s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,i){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return c(e,t,i)}function c(e,t,i){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var i=0|m(e,t),n=a(i),r=n.write(e,t);r!==i&&(n=n.slice(0,r));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){var t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return f(e,t,i);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return f(e,t,i);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return l.from(n,t,i);var r=function(e){if(l.isBuffer(e)){var t=0|p(e.length),i=a(t);return 0===i.length||e.copy(i,0,0,t),i}if(void 0!==e.length)return"number"!=typeof e.length||z(e.length)?a(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|p(e))}function d(e){for(var t=e.length<0?0:0|p(e.length),i=a(t),n=0;n<t;n+=1)i[n]=255&e[n];return i}function f(e,t,i){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(i||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,t):new Uint8Array(e,t,i),Object.setPrototypeOf(n,l.prototype),n}function p(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function m(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var i=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return k(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return F(e).length;default:if(r)return n?-1:k(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,i){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,i);case"utf8":case"utf-8":return C(this,t,i);case"ascii":return M(this,t,i);case"latin1":case"binary":return I(this,t,i);case"base64":return w(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,i);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function y(e,t,i,n,r){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),z(i=+i)&&(i=r?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(r)return-1;i=e.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:b(e,t,i,n,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):b(e,[t],i,n,r);throw new TypeError("val must be string, number or Buffer")}function b(e,t,i,n,r){var o,s=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,i/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){var u=-1;for(o=i;o<a;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(i+l>a&&(i=a-l),o=i;o>=0;o--){for(var h=!0,d=0;d<l;d++)if(c(e,o+d)!==c(t,d)){h=!1;break}if(h)return o}return-1}function x(e,t,i,n){i=Number(i)||0;var r=e.length-i;n?(n=Number(n))>r&&(n=r):n=r;var o=t.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(z(a))return s;e[i+s]=a}return s}function _(e,t,i,n){return V(k(t,e.length-i),e,i,n)}function E(e,t,i,n){return V(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function S(e,t,i,n){return V(F(t),e,i,n)}function A(e,t,i,n){return V(function(e,t){for(var i,n,r,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(i=e.charCodeAt(s))>>8,r=i%256,o.push(r),o.push(n);return o}(t,e.length-i),e,i,n)}function w(e,t,i){return 0===t&&i===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,i))}function C(e,t,i){i=Math.min(e.length,i);for(var n=[],r=t;r<i;){var o,s,a,l,c=e[r],u=null,h=c>239?4:c>223?3:c>191?2:1;if(r+h<=i)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[r+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[r+1],s=e[r+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[r+1],s=e[r+2],a=e[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),r+=h}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);var i="",n=0;for(;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=T));return i}(n)}l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,i){return c(e,t,i)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,i){return function(e,t,i){return u(e),e<=0?a(e):void 0!==t?"string"==typeof i?a(e).fill(t,i):a(e).fill(t):a(e)}(e,t,i)},l.allocUnsafe=function(e){return h(e)},l.allocUnsafeSlow=function(e){return h(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var i=e.length,n=t.length,r=0,o=Math.min(i,n);r<o;++r)if(e[r]!==t[r]){i=e[r],n=t[r];break}return i<n?-1:n<i?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var n=l.allocUnsafe(t),r=0;for(i=0;i<e.length;++i){var o=e[i];if(G(o,Uint8Array))r+o.length>n.length?l.from(o).copy(n,r):Uint8Array.prototype.set.call(n,o,r);else{if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,r)}r+=o.length}return n},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?C(this,0,e):g.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",i=t.IS;return e=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,i,n,r){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),t<0||i>e.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&t>=i)return 0;if(n>=r)return-1;if(t>=i)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(n>>>=0),s=(i>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(n,r),u=e.slice(t,i),h=0;h<a;++h)if(c[h]!==u[h]){o=c[h],s=u[h];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},l.prototype.indexOf=function(e,t,i){return y(this,e,t,i,!0)},l.prototype.lastIndexOf=function(e,t,i){return y(this,e,t,i,!1)},l.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-t;if((void 0===i||i>r)&&(i=r),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return x(this,e,t,i);case"utf8":case"utf-8":return _(this,e,t,i);case"ascii":case"latin1":case"binary":return E(this,e,t,i);case"base64":return S(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function M(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(127&e[r]);return n}function I(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(e[r]);return n}function P(e,t,i){var n=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>n)&&(i=n);for(var r="",o=t;o<i;++o)r+=H[e[o]];return r}function L(e,t,i){for(var n=e.slice(t,i),r="",o=0;o<n.length-1;o+=2)r+=String.fromCharCode(n[o]+256*n[o+1]);return r}function R(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,i,n,r,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function O(e,t,i,n,r,o){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function B(e,t,i,n,o){return t=+t,i>>>=0,o||O(e,0,i,4),r.write(e,t,i,n,23,4),i+4}function N(e,t,i,n,o){return t=+t,i>>>=0,o||O(e,0,i,8),r.write(e,t,i,n,52,8),i+8}l.prototype.slice=function(e,t){var i=this.length;(e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,l.prototype),n},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||R(e,t,this.length);for(var n=this[e],r=1,o=0;++o<t&&(r*=256);)n+=this[e+o]*r;return n},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||R(e,t,this.length);for(var n=this[e+--t],r=1;t>0&&(r*=256);)n+=this[e+--t]*r;return n},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||R(e,t,this.length);for(var n=this[e],r=1,o=0;++o<t&&(r*=256);)n+=this[e+o]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||R(e,t,this.length);for(var n=t,r=1,o=this[e+--n];n>0&&(r*=256);)o+=this[e+--n]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||R(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(e,t){e>>>=0,t||R(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||R(e,4,this.length),r.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||R(e,4,this.length),r.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||R(e,8,this.length),r.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||R(e,8,this.length),r.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,i,n){(e=+e,t>>>=0,i>>>=0,n)||D(this,e,t,i,Math.pow(2,8*i)-1,0);var r=1,o=0;for(this[t]=255&e;++o<i&&(r*=256);)this[t+o]=e/r&255;return t+i},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,i,n){(e=+e,t>>>=0,i>>>=0,n)||D(this,e,t,i,Math.pow(2,8*i)-1,0);var r=i-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+i},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t>>>=0,!n){var r=Math.pow(2,8*i-1);D(this,e,t,i,r-1,-r)}var o=0,s=1,a=0;for(this[t]=255&e;++o<i&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s|0)-a&255;return t+i},l.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t>>>=0,!n){var r=Math.pow(2,8*i-1);D(this,e,t,i,r-1,-r)}var o=i-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s|0)-a&255;return t+i},l.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,i){return B(this,e,t,!0,i)},l.prototype.writeFloatBE=function(e,t,i){return B(this,e,t,!1,i)},l.prototype.writeDoubleLE=function(e,t,i){return N(this,e,t,!0,i)},l.prototype.writeDoubleBE=function(e,t,i){return N(this,e,t,!1,i)},l.prototype.copy=function(e,t,i,n){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i||(i=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);var r=n-i;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,i,n):Uint8Array.prototype.set.call(e,this.subarray(i,n),t),r},l.prototype.fill=function(e,t,i,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var r=e.charCodeAt(0);("utf8"===n&&r<128||"latin1"===n)&&(e=r)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var o;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(o=t;o<i;++o)this[o]=e;else{var s=l.isBuffer(e)?e:l.from(e,n),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<i-t;++o)this[o+t]=s[o%a]}return this};var U=/[^+/0-9A-Za-z-_]/g;function k(e,t){var i;t=t||1/0;for(var n=e.length,r=null,o=[],s=0;s<n;++s){if((i=e.charCodeAt(s))>55295&&i<57344){if(!r){if(i>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}r=i;continue}if(i<56320){(t-=3)>-1&&o.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function F(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,i,n){for(var r=0;r<n&&!(r+i>=t.length||r>=e.length);++r)t[r+i]=e[r];return r}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function z(e){return e!=e}var H=function(){for(var e="0123456789abcdef",t=new Array(256),i=0;i<16;++i)for(var n=16*i,r=0;r<16;++r)t[n+r]=e[i]+e[r];return t}()},84406:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(90784),s=i(65757);t.backOff=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i;return r(this,(function(n){switch(n.label){case 0:return i=o.getSanitizedOptions(t),[4,new a(e,i).execute()];case 1:return[2,n.sent()]}}))}))};var a=function(){function e(e,t){this.request=e,this.options=t,this.attemptNumber=0}return e.prototype.execute=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:if(this.attemptLimitReached)return[3,7];t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.applyDelay()];case 2:return t.sent(),[4,this.request()];case 3:return[2,t.sent()];case 4:return e=t.sent(),this.attemptNumber++,[4,this.options.retry(e,this.attemptNumber)];case 5:if(!t.sent()||this.attemptLimitReached)throw e;return[3,6];case 6:return[3,0];case 7:throw new Error("Something went wrong.")}}))}))},Object.defineProperty(e.prototype,"attemptLimitReached",{get:function(){return this.attemptNumber>=this.options.numOfAttempts},enumerable:!0,configurable:!0}),e.prototype.applyDelay=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,s.DelayFactory(this.options,this.attemptNumber).apply()];case 1:return e.sent(),[2]}}))}))},e}()},88348:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},n(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(i(36698).Delay);t.AlwaysDelay=o},36698:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(66071),r=function(){function e(e){this.options=e,this.attempt=0}return e.prototype.apply=function(){var e=this;return new Promise((function(t){return setTimeout(t,e.jitteredDelay)}))},e.prototype.setAttemptNumber=function(e){this.attempt=e},Object.defineProperty(e.prototype,"jitteredDelay",{get:function(){return n.JitterFactory(this.options)(this.delay)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"delay",{get:function(){var e=this.options.startingDelay,t=this.options.timeMultiple,i=this.numOfDelayedAttempts,n=e*Math.pow(t,i);return Math.min(n,this.options.maxDelay)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numOfDelayedAttempts",{get:function(){return this.attempt},enumerable:!0,configurable:!0}),e}();t.Delay=r},65757:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(7510),r=i(88348);t.DelayFactory=function(e,t){var i=function(e){if(!e.delayFirstAttempt)return new n.SkipFirstDelay(e);return new r.AlwaysDelay(e)}(e);return i.setAttemptNumber(t),i}},7510:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},n(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.apply=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,!!this.isFirstAttempt||e.prototype.apply.call(this)]}))}))},Object.defineProperty(t.prototype,"isFirstAttempt",{get:function(){return 0===this.attempt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numOfDelayedAttempts",{get:function(){return this.attempt-1},enumerable:!0,configurable:!0}),t}(i(36698).Delay);t.SkipFirstDelay=a},38500:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fullJitter=function(e){var t=Math.random()*e;return Math.round(t)}},66071:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(38500),r=i(14764);t.JitterFactory=function(e){return"full"===e.jitter?n.fullJitter:r.noJitter}},14764:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noJitter=function(e){return e}},90784:function(e,t){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n={delayFirstAttempt:!1,jitter:"none",maxDelay:1/0,numOfAttempts:10,retry:function(){return!0},startingDelay:100,timeMultiple:2};t.getSanitizedOptions=function(e){var t=i(i({},n),e);return t.numOfAttempts<1&&(t.numOfAttempts=1),t}},95204:function(e,t){var i="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=i.DOMException}return e.prototype=i,new e}();!function(e){!function(t){var i="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in e,s="ArrayBuffer"in e;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function h(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function f(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}}))}function m(e){var t=new FileReader,i=p(t);return t.readAsArrayBuffer(e),i}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:i&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&r&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||l(e))?this._bodyArrayBuffer=g(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var e,t,i,n=f(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,i=p(t),t.readAsText(e),i;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),i=new Array(t.length),n=0;n<t.length;n++)i[n]=String.fromCharCode(t[n]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(x)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=c(e),t=u(t);var i=this.map[e];this.map[e]=i?i+", "+t:t},d.prototype.delete=function(e){delete this.map[c(e)]},d.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},d.prototype.set=function(e,t){this.map[c(e)]=u(t)},d.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,i){e.push(i)})),h(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),h(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,i){e.push([i,t])})),h(e)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(e,t){var i,n,r=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(i=t.method||this.method||"GET",n=i.toUpperCase(),y.indexOf(n)>-1?n:i),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function x(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var i=e.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(r))}})),t}function _(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},v.call(b.prototype),v.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},_.error=function(){var e=new _(null,{status:0,statusText:""});return e.type="error",e};var E=[301,302,303,307,308];_.redirect=function(e,t){if(-1===E.indexOf(t))throw new RangeError("Invalid status code");return new _(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var i=Error(e);this.stack=i.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function S(e,i){return new Promise((function(n,o){var s=new b(e,i);if(s.signal&&s.signal.aborted)return o(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function l(){a.abort()}a.onload=function(){var e,t,i={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var i=e.split(":"),n=i.shift().trim();if(n){var r=i.join(":").trim();t.append(n,r)}})),t)};i.url="responseURL"in a?a.responseURL:i.headers.get("X-Request-URL");var r="response"in a?a.response:a.responseText;n(new _(r,i))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.onabort=function(){o(new t.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),s.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",l),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",l)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}S.polyfill=!0,e.fetch||(e.fetch=S,e.Headers=d,e.Request=b,e.Response=_),t.Headers=d,t.Request=b,t.Response=_,t.fetch=S,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var r=n;(t=r.fetch).default=r.fetch,t.fetch=r.fetch,t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response,e.exports=t},251:(e,t)=>{t.read=function(e,t,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,f=e[t+h];for(h+=d,o=f&(1<<-u)-1,f>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),o-=c}return(f?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,i,n,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[i+f]=255&a,f+=p,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[i+f]=255&s,f+=p,s/=256,c-=8);e[i+f-p]|=128*m}},55580:(e,t,i)=>{var n=i(56110)(i(9325),"DataView");e.exports=n},21549:(e,t,i)=>{var n=i(22032),r=i(63862),o=i(66721),s=i(12749),a=i(35749);function l(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}l.prototype.clear=n,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=s,l.prototype.set=a,e.exports=l},80079:(e,t,i)=>{var n=i(63702),r=i(70080),o=i(24739),s=i(48655),a=i(31175);function l(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}l.prototype.clear=n,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=s,l.prototype.set=a,e.exports=l},68223:(e,t,i)=>{var n=i(56110)(i(9325),"Map");e.exports=n},53661:(e,t,i)=>{var n=i(63040),r=i(17670),o=i(90289),s=i(4509),a=i(72949);function l(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}l.prototype.clear=n,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=s,l.prototype.set=a,e.exports=l},32804:(e,t,i)=>{var n=i(56110)(i(9325),"Promise");e.exports=n},76545:(e,t,i)=>{var n=i(56110)(i(9325),"Set");e.exports=n},38859:(e,t,i)=>{var n=i(53661),r=i(31380),o=i(51459);function s(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new n;++t<i;)this.add(e[t])}s.prototype.add=s.prototype.push=r,s.prototype.has=o,e.exports=s},37217:(e,t,i)=>{var n=i(80079),r=i(51420),o=i(90938),s=i(63605),a=i(29817),l=i(80945);function c(e){var t=this.__data__=new n(e);this.size=t.size}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=s,c.prototype.has=a,c.prototype.set=l,e.exports=c},51873:(e,t,i)=>{var n=i(9325).Symbol;e.exports=n},37828:(e,t,i)=>{var n=i(9325).Uint8Array;e.exports=n},28303:(e,t,i)=>{var n=i(56110)(i(9325),"WeakMap");e.exports=n},79770:e=>{e.exports=function(e,t){for(var i=-1,n=null==e?0:e.length,r=0,o=[];++i<n;){var s=e[i];t(s,i,e)&&(o[r++]=s)}return o}},70695:(e,t,i)=>{var n=i(78096),r=i(72428),o=i(56449),s=i(3656),a=i(30361),l=i(37167),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var i=o(e),u=!i&&r(e),h=!i&&!u&&s(e),d=!i&&!u&&!h&&l(e),f=i||u||h||d,p=f?n(e.length,String):[],m=p.length;for(var g in e)!t&&!c.call(e,g)||f&&("length"==g||h&&("offset"==g||"parent"==g)||d&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||a(g,m))||p.push(g);return p}},34932:e=>{e.exports=function(e,t){for(var i=-1,n=null==e?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r}},14528:e=>{e.exports=function(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}},14248:e=>{e.exports=function(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}},26025:(e,t,i)=>{var n=i(75288);e.exports=function(e,t){for(var i=e.length;i--;)if(n(e[i][0],t))return i;return-1}},47422:(e,t,i)=>{var n=i(31769),r=i(77797);e.exports=function(e,t){for(var i=0,o=(t=n(t,e)).length;null!=e&&i<o;)e=e[r(t[i++])];return i&&i==o?e:void 0}},82199:(e,t,i)=>{var n=i(14528),r=i(56449);e.exports=function(e,t,i){var o=t(e);return r(e)?o:n(o,i(e))}},72552:(e,t,i)=>{var n=i(51873),r=i(659),o=i(59350),s=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?r(e):o(e)}},28077:e=>{e.exports=function(e,t){return null!=e&&t in Object(e)}},27534:(e,t,i)=>{var n=i(72552),r=i(40346);e.exports=function(e){return r(e)&&"[object Arguments]"==n(e)}},60270:(e,t,i)=>{var n=i(87068),r=i(40346);e.exports=function e(t,i,o,s,a){return t===i||(null==t||null==i||!r(t)&&!r(i)?t!=t&&i!=i:n(t,i,o,s,e,a))}},87068:(e,t,i)=>{var n=i(37217),r=i(25911),o=i(21986),s=i(50689),a=i(5861),l=i(56449),c=i(3656),u=i(37167),h="[object Arguments]",d="[object Array]",f="[object Object]",p=Object.prototype.hasOwnProperty;e.exports=function(e,t,i,m,g,v){var y=l(e),b=l(t),x=y?d:a(e),_=b?d:a(t),E=(x=x==h?f:x)==f,S=(_=_==h?f:_)==f,A=x==_;if(A&&c(e)){if(!c(t))return!1;y=!0,E=!1}if(A&&!E)return v||(v=new n),y||u(e)?r(e,t,i,m,g,v):o(e,t,x,i,m,g,v);if(!(1&i)){var w=E&&p.call(e,"__wrapped__"),C=S&&p.call(t,"__wrapped__");if(w||C){var T=w?e.value():e,M=C?t.value():t;return v||(v=new n),g(T,M,i,m,v)}}return!!A&&(v||(v=new n),s(e,t,i,m,g,v))}},41799:(e,t,i)=>{var n=i(37217),r=i(60270);e.exports=function(e,t,i,o){var s=i.length,a=s,l=!o;if(null==e)return!a;for(e=Object(e);s--;){var c=i[s];if(l&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++s<a;){var u=(c=i[s])[0],h=e[u],d=c[1];if(l&&c[2]){if(void 0===h&&!(u in e))return!1}else{var f=new n;if(o)var p=o(h,d,u,e,t,f);if(!(void 0===p?r(d,h,3,o,f):p))return!1}}return!0}},45083:(e,t,i)=>{var n=i(1882),r=i(87296),o=i(23805),s=i(47473),a=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,u=l.toString,h=c.hasOwnProperty,d=RegExp("^"+u.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||r(e))&&(n(e)?d:a).test(s(e))}},4901:(e,t,i)=>{var n=i(72552),r=i(30294),o=i(40346),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&r(e.length)&&!!s[n(e)]}},15389:(e,t,i)=>{var n=i(93663),r=i(87978),o=i(83488),s=i(56449),a=i(50583);e.exports=function(e){return"function"==typeof e?e:null==e?o:"object"==typeof e?s(e)?r(e[0],e[1]):n(e):a(e)}},88984:(e,t,i)=>{var n=i(55527),r=i(3650),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return r(e);var t=[];for(var i in Object(e))o.call(e,i)&&"constructor"!=i&&t.push(i);return t}},93663:(e,t,i)=>{var n=i(41799),r=i(10776),o=i(67197);e.exports=function(e){var t=r(e);return 1==t.length&&t[0][2]?o(t[0][0],t[0][1]):function(i){return i===e||n(i,e,t)}}},87978:(e,t,i)=>{var n=i(60270),r=i(58156),o=i(80631),s=i(28586),a=i(30756),l=i(67197),c=i(77797);e.exports=function(e,t){return s(e)&&a(t)?l(c(e),t):function(i){var s=r(i,e);return void 0===s&&s===t?o(i,e):n(t,s,3)}}},47237:e=>{e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},17255:(e,t,i)=>{var n=i(47422);e.exports=function(e){return function(t){return n(t,e)}}},14116:(e,t,i)=>{var n=i(44394),r=Math.floor,o=Math.min;e.exports=function(e,t,i,s){var a=0,l=null==e?0:e.length;if(0===l)return 0;for(var c=(t=i(t))!=t,u=null===t,h=n(t),d=void 0===t;a<l;){var f=r((a+l)/2),p=i(e[f]),m=void 0!==p,g=null===p,v=p==p,y=n(p);if(c)var b=s||v;else b=d?v&&(s||m):u?v&&m&&(s||!g):h?v&&m&&!g&&(s||!y):!g&&!y&&(s?p<=t:p<t);b?a=f+1:l=f}return o(l,4294967294)}},17721:e=>{e.exports=function(e,t){for(var i,n=-1,r=e.length;++n<r;){var o=t(e[n]);void 0!==o&&(i=void 0===i?o:i+o)}return i}},78096:e=>{e.exports=function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}},77556:(e,t,i)=>{var n=i(51873),r=i(34932),o=i(56449),s=i(44394),a=n?n.prototype:void 0,l=a?a.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return r(t,e)+"";if(s(t))return l?l.call(t):"";var i=t+"";return"0"==i&&1/t==-1/0?"-0":i}},54128:(e,t,i)=>{var n=i(31800),r=/^\s+/;e.exports=function(e){return e?e.slice(0,n(e)+1).replace(r,""):e}},27301:e=>{e.exports=function(e){return function(t){return e(t)}}},19219:e=>{e.exports=function(e,t){return e.has(t)}},31769:(e,t,i)=>{var n=i(56449),r=i(28586),o=i(61802),s=i(13222);e.exports=function(e,t){return n(e)?e:r(e,t)?[e]:o(s(e))}},55481:(e,t,i)=>{var n=i(9325)["__core-js_shared__"];e.exports=n},25911:(e,t,i)=>{var n=i(38859),r=i(14248),o=i(19219);e.exports=function(e,t,i,s,a,l){var c=1&i,u=e.length,h=t.length;if(u!=h&&!(c&&h>u))return!1;var d=l.get(e),f=l.get(t);if(d&&f)return d==t&&f==e;var p=-1,m=!0,g=2&i?new n:void 0;for(l.set(e,t),l.set(t,e);++p<u;){var v=e[p],y=t[p];if(s)var b=c?s(y,v,p,t,e,l):s(v,y,p,e,t,l);if(void 0!==b){if(b)continue;m=!1;break}if(g){if(!r(t,(function(e,t){if(!o(g,t)&&(v===e||a(v,e,i,s,l)))return g.push(t)}))){m=!1;break}}else if(v!==y&&!a(v,y,i,s,l)){m=!1;break}}return l.delete(e),l.delete(t),m}},21986:(e,t,i)=>{var n=i(51873),r=i(37828),o=i(75288),s=i(25911),a=i(20317),l=i(84247),c=n?n.prototype:void 0,u=c?c.valueOf:void 0;e.exports=function(e,t,i,n,c,h,d){switch(i){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!h(new r(e),new r(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var f=a;case"[object Set]":var p=1&n;if(f||(f=l),e.size!=t.size&&!p)return!1;var m=d.get(e);if(m)return m==t;n|=2,d.set(e,t);var g=s(f(e),f(t),n,c,h,d);return d.delete(e),g;case"[object Symbol]":if(u)return u.call(e)==u.call(t)}return!1}},50689:(e,t,i)=>{var n=i(50002),r=Object.prototype.hasOwnProperty;e.exports=function(e,t,i,o,s,a){var l=1&i,c=n(e),u=c.length;if(u!=n(t).length&&!l)return!1;for(var h=u;h--;){var d=c[h];if(!(l?d in t:r.call(t,d)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var m=!0;a.set(e,t),a.set(t,e);for(var g=l;++h<u;){var v=e[d=c[h]],y=t[d];if(o)var b=l?o(y,v,d,t,e,a):o(v,y,d,e,t,a);if(!(void 0===b?v===y||s(v,y,i,o,a):b)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var x=e.constructor,_=t.constructor;x==_||!("constructor"in e)||!("constructor"in t)||"function"==typeof x&&x instanceof x&&"function"==typeof _&&_ instanceof _||(m=!1)}return a.delete(e),a.delete(t),m}},34840:(e,t,i)=>{var n="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;e.exports=n},50002:(e,t,i)=>{var n=i(82199),r=i(4664),o=i(95950);e.exports=function(e){return n(e,o,r)}},12651:(e,t,i)=>{var n=i(74218);e.exports=function(e,t){var i=e.__data__;return n(t)?i["string"==typeof t?"string":"hash"]:i.map}},10776:(e,t,i)=>{var n=i(30756),r=i(95950);e.exports=function(e){for(var t=r(e),i=t.length;i--;){var o=t[i],s=e[o];t[i]=[o,s,n(s)]}return t}},56110:(e,t,i)=>{var n=i(45083),r=i(10392);e.exports=function(e,t){var i=r(e,t);return n(i)?i:void 0}},659:(e,t,i)=>{var n=i(51873),r=Object.prototype,o=r.hasOwnProperty,s=r.toString,a=n?n.toStringTag:void 0;e.exports=function(e){var t=o.call(e,a),i=e[a];try{e[a]=void 0;var n=!0}catch(e){}var r=s.call(e);return n&&(t?e[a]=i:delete e[a]),r}},4664:(e,t,i)=>{var n=i(79770),r=i(63345),o=Object.prototype.propertyIsEnumerable,s=Object.getOwnPropertySymbols,a=s?function(e){return null==e?[]:(e=Object(e),n(s(e),(function(t){return o.call(e,t)})))}:r;e.exports=a},5861:(e,t,i)=>{var n=i(55580),r=i(68223),o=i(32804),s=i(76545),a=i(28303),l=i(72552),c=i(47473),u="[object Map]",h="[object Promise]",d="[object Set]",f="[object WeakMap]",p="[object DataView]",m=c(n),g=c(r),v=c(o),y=c(s),b=c(a),x=l;(n&&x(new n(new ArrayBuffer(1)))!=p||r&&x(new r)!=u||o&&x(o.resolve())!=h||s&&x(new s)!=d||a&&x(new a)!=f)&&(x=function(e){var t=l(e),i="[object Object]"==t?e.constructor:void 0,n=i?c(i):"";if(n)switch(n){case m:return p;case g:return u;case v:return h;case y:return d;case b:return f}return t}),e.exports=x},10392:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},49326:(e,t,i)=>{var n=i(31769),r=i(72428),o=i(56449),s=i(30361),a=i(30294),l=i(77797);e.exports=function(e,t,i){for(var c=-1,u=(t=n(t,e)).length,h=!1;++c<u;){var d=l(t[c]);if(!(h=null!=e&&i(e,d)))break;e=e[d]}return h||++c!=u?h:!!(u=null==e?0:e.length)&&a(u)&&s(d,u)&&(o(e)||r(e))}},22032:(e,t,i)=>{var n=i(81042);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},63862:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},66721:(e,t,i)=>{var n=i(81042),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return r.call(t,e)?t[e]:void 0}},12749:(e,t,i)=>{var n=i(81042),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:r.call(t,e)}},35749:(e,t,i)=>{var n=i(81042);e.exports=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=n&&void 0===t?"__lodash_hash_undefined__":t,this}},30361:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,i){var n=typeof e;return!!(i=null==i?9007199254740991:i)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<i}},28586:(e,t,i)=>{var n=i(56449),r=i(44394),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(n(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!r(e))||(s.test(e)||!o.test(e)||null!=t&&e in Object(t))}},74218:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},87296:(e,t,i)=>{var n,r=i(55481),o=(n=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!o&&o in e}},55527:e=>{var t=Object.prototype;e.exports=function(e){var i=e&&e.constructor;return e===("function"==typeof i&&i.prototype||t)}},30756:(e,t,i)=>{var n=i(23805);e.exports=function(e){return e==e&&!n(e)}},63702:e=>{e.exports=function(){this.__data__=[],this.size=0}},70080:(e,t,i)=>{var n=i(26025),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__,i=n(t,e);return!(i<0)&&(i==t.length-1?t.pop():r.call(t,i,1),--this.size,!0)}},24739:(e,t,i)=>{var n=i(26025);e.exports=function(e){var t=this.__data__,i=n(t,e);return i<0?void 0:t[i][1]}},48655:(e,t,i)=>{var n=i(26025);e.exports=function(e){return n(this.__data__,e)>-1}},31175:(e,t,i)=>{var n=i(26025);e.exports=function(e,t){var i=this.__data__,r=n(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}},63040:(e,t,i)=>{var n=i(21549),r=i(80079),o=i(68223);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(o||r),string:new n}}},17670:(e,t,i)=>{var n=i(12651);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},90289:(e,t,i)=>{var n=i(12651);e.exports=function(e){return n(this,e).get(e)}},4509:(e,t,i)=>{var n=i(12651);e.exports=function(e){return n(this,e).has(e)}},72949:(e,t,i)=>{var n=i(12651);e.exports=function(e,t){var i=n(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}},20317:e=>{e.exports=function(e){var t=-1,i=Array(e.size);return e.forEach((function(e,n){i[++t]=[n,e]})),i}},67197:e=>{e.exports=function(e,t){return function(i){return null!=i&&(i[e]===t&&(void 0!==t||e in Object(i)))}}},62224:(e,t,i)=>{var n=i(50104);e.exports=function(e){var t=n(e,(function(e){return 500===i.size&&i.clear(),e})),i=t.cache;return t}},81042:(e,t,i)=>{var n=i(56110)(Object,"create");e.exports=n},3650:(e,t,i)=>{var n=i(74335)(Object.keys,Object);e.exports=n},86009:(e,t,i)=>{e=i.nmd(e);var n=i(34840),r=t&&!t.nodeType&&t,o=r&&e&&!e.nodeType&&e,s=o&&o.exports===r&&n.process,a=function(){try{var e=o&&o.require&&o.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=a},59350:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},74335:e=>{e.exports=function(e,t){return function(i){return e(t(i))}}},9325:(e,t,i)=>{var n=i(34840),r="object"==typeof self&&self&&self.Object===Object&&self,o=n||r||Function("return this")();e.exports=o},31380:e=>{e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},51459:e=>{e.exports=function(e){return this.__data__.has(e)}},84247:e=>{e.exports=function(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}},51420:(e,t,i)=>{var n=i(80079);e.exports=function(){this.__data__=new n,this.size=0}},90938:e=>{e.exports=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}},63605:e=>{e.exports=function(e){return this.__data__.get(e)}},29817:e=>{e.exports=function(e){return this.__data__.has(e)}},80945:(e,t,i)=>{var n=i(80079),r=i(68223),o=i(53661);e.exports=function(e,t){var i=this.__data__;if(i instanceof n){var s=i.__data__;if(!r||s.length<199)return s.push([e,t]),this.size=++i.size,this;i=this.__data__=new o(s)}return i.set(e,t),this.size=i.size,this}},61802:(e,t,i)=>{var n=i(62224),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,s=n((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(r,(function(e,i,n,r){t.push(n?r.replace(o,"$1"):i||e)})),t}));e.exports=s},77797:(e,t,i)=>{var n=i(44394);e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},47473:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},31800:e=>{var t=/\s/;e.exports=function(e){for(var i=e.length;i--&&t.test(e.charAt(i)););return i}},38221:(e,t,i)=>{var n=i(23805),r=i(10124),o=i(99374),s=Math.max,a=Math.min;e.exports=function(e,t,i){var l,c,u,h,d,f,p=0,m=!1,g=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var i=l,n=c;return l=c=void 0,p=t,h=e.apply(n,i)}function b(e){var i=e-f;return void 0===f||i>=t||i<0||g&&e-p>=u}function x(){var e=r();if(b(e))return _(e);d=setTimeout(x,function(e){var i=t-(e-f);return g?a(i,u-(e-p)):i}(e))}function _(e){return d=void 0,v&&l?y(e):(l=c=void 0,h)}function E(){var e=r(),i=b(e);if(l=arguments,c=this,f=e,i){if(void 0===d)return function(e){return p=e,d=setTimeout(x,t),m?y(e):h}(f);if(g)return clearTimeout(d),d=setTimeout(x,t),y(f)}return void 0===d&&(d=setTimeout(x,t)),h}return t=o(t)||0,n(i)&&(m=!!i.leading,u=(g="maxWait"in i)?s(o(i.maxWait)||0,t):u,v="trailing"in i?!!i.trailing:v),E.cancel=function(){void 0!==d&&clearTimeout(d),p=0,l=f=c=d=void 0},E.flush=function(){return void 0===d?h:_(r())},E}},75288:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},58156:(e,t,i)=>{var n=i(47422);e.exports=function(e,t,i){var r=null==e?void 0:n(e,t);return void 0===r?i:r}},80631:(e,t,i)=>{var n=i(28077),r=i(49326);e.exports=function(e,t){return null!=e&&r(e,t,n)}},83488:e=>{e.exports=function(e){return e}},72428:(e,t,i)=>{var n=i(27534),r=i(40346),o=Object.prototype,s=o.hasOwnProperty,a=o.propertyIsEnumerable,l=n(function(){return arguments}())?n:function(e){return r(e)&&s.call(e,"callee")&&!a.call(e,"callee")};e.exports=l},56449:e=>{var t=Array.isArray;e.exports=t},64894:(e,t,i)=>{var n=i(1882),r=i(30294);e.exports=function(e){return null!=e&&r(e.length)&&!n(e)}},3656:(e,t,i)=>{e=i.nmd(e);var n=i(9325),r=i(89935),o=t&&!t.nodeType&&t,s=o&&e&&!e.nodeType&&e,a=s&&s.exports===o?n.Buffer:void 0,l=(a?a.isBuffer:void 0)||r;e.exports=l},2404:(e,t,i)=>{var n=i(60270);e.exports=function(e,t){return n(e,t)}},1882:(e,t,i)=>{var n=i(72552),r=i(23805);e.exports=function(e){if(!r(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},30294:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},23805:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},40346:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},44394:(e,t,i)=>{var n=i(72552),r=i(40346);e.exports=function(e){return"symbol"==typeof e||r(e)&&"[object Symbol]"==n(e)}},37167:(e,t,i)=>{var n=i(4901),r=i(27301),o=i(86009),s=o&&o.isTypedArray,a=s?r(s):n;e.exports=a},95950:(e,t,i)=>{var n=i(70695),r=i(88984),o=i(64894);e.exports=function(e){return o(e)?n(e):r(e)}},50104:(e,t,i)=>{var n=i(53661);function r(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],o=i.cache;if(o.has(r))return o.get(r);var s=e.apply(this,n);return i.cache=o.set(r,s)||o,s};return i.cache=new(r.Cache||n),i}r.Cache=n,e.exports=r},10124:(e,t,i)=>{var n=i(9325);e.exports=function(){return n.Date.now()}},50583:(e,t,i)=>{var n=i(47237),r=i(17255),o=i(28586),s=i(77797);e.exports=function(e){return o(e)?n(s(e)):r(e)}},41298:(e,t,i)=>{var n=i(15389),r=i(14116);e.exports=function(e,t,i){return r(e,t,n(i,2))}},63345:e=>{e.exports=function(){return[]}},89935:e=>{e.exports=function(){return!1}},36119:(e,t,i)=>{var n=i(17721),r=i(83488);e.exports=function(e){return e&&e.length?n(e,r):0}},99374:(e,t,i)=>{var n=i(54128),r=i(23805),o=i(44394),s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=n(e);var i=a.test(e);return i||l.test(e)?c(e.slice(2),i?2:8):s.test(e)?NaN:+e}},13222:(e,t,i)=>{var n=i(77556);e.exports=function(e){return null==e?"":n(e)}},39504:(e,t,i)=>{var n=i(50276);function r(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.aes.Algorithm(e,t)}))}i(93900),i(56370),i(7619),e.exports=n.aes=n.aes||{},n.aes.startEncrypting=function(e,t,i,n){var r=m({key:e,output:i,decrypt:!1,mode:n});return r.start(t),r},n.aes.createEncryptionCipher=function(e,t){return m({key:e,output:null,decrypt:!1,mode:t})},n.aes.startDecrypting=function(e,t,i,n){var r=m({key:e,output:i,decrypt:!0,mode:n});return r.start(t),r},n.aes.createDecryptionCipher=function(e,t){return m({key:e,output:null,decrypt:!0,mode:t})},n.aes.Algorithm=function(e,t){u||d();var i=this;i.name=e,i.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return p(i._w,e,t,!1)},decrypt:function(e,t){return p(i._w,e,t,!0)}}}),i._init=!1},n.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,i=e.key;if("string"!=typeof i||16!==i.length&&24!==i.length&&32!==i.length){if(n.util.isArray(i)&&(16===i.length||24===i.length||32===i.length)){t=i,i=n.util.createBuffer();for(var r=0;r<t.length;++r)i.putByte(t[r])}}else i=n.util.createBuffer(i);if(!n.util.isArray(i)){t=i,i=[];var o=t.length();if(16===o||24===o||32===o){o>>>=2;for(r=0;r<o;++r)i.push(t.getInt32())}}if(!n.util.isArray(i)||4!==i.length&&6!==i.length&&8!==i.length)throw new Error("Invalid key parameter.");var s=this.mode.name,a=-1!==["CFB","OFB","CTR","GCM"].indexOf(s);this._w=f(i,e.decrypt&&!a),this._init=!0}},n.aes._expandKey=function(e,t){return u||d(),f(e,t)},n.aes._updateBlock=p,r("AES-ECB",n.cipher.modes.ecb),r("AES-CBC",n.cipher.modes.cbc),r("AES-CFB",n.cipher.modes.cfb),r("AES-OFB",n.cipher.modes.ofb),r("AES-CTR",n.cipher.modes.ctr),r("AES-GCM",n.cipher.modes.gcm);var o,s,a,l,c,u=!1,h=4;function d(){u=!0,a=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;o=new Array(256),s=new Array(256),l=new Array(4),c=new Array(4);for(t=0;t<4;++t)l[t]=new Array(256),c[t]=new Array(256);var i,n,r,h,d,f,p,m=0,g=0;for(t=0;t<256;++t){h=(h=g^g<<1^g<<2^g<<3^g<<4)>>8^255&h^99,o[m]=h,s[h]=m,f=(d=e[h])<<24^h<<16^h<<8^h^d,p=((i=e[m])^(n=e[i])^(r=e[n]))<<24^(m^r)<<16^(m^n^r)<<8^m^i^r;for(var v=0;v<4;++v)l[v][m]=f,c[v][h]=p,f=f<<24|f>>>8,p=p<<24|p>>>8;0===m?m=g=1:(m=i^e[e[e[i^r]]],g^=e[e[g]])}}function f(e,t){for(var i,n=e.slice(0),r=1,s=n.length,l=h*(s+6+1),u=s;u<l;++u)i=n[u-1],u%s==0?(i=o[i>>>16&255]<<24^o[i>>>8&255]<<16^o[255&i]<<8^o[i>>>24]^a[r]<<24,r++):s>6&&u%s==4&&(i=o[i>>>24]<<24^o[i>>>16&255]<<16^o[i>>>8&255]<<8^o[255&i]),n[u]=n[u-s]^i;if(t){for(var d,f=c[0],p=c[1],m=c[2],g=c[3],v=n.slice(0),y=(u=0,(l=n.length)-h);u<l;u+=h,y-=h)if(0===u||u===l-h)v[u]=n[y],v[u+1]=n[y+3],v[u+2]=n[y+2],v[u+3]=n[y+1];else for(var b=0;b<h;++b)d=n[y+b],v[u+(3&-b)]=f[o[d>>>24]]^p[o[d>>>16&255]]^m[o[d>>>8&255]]^g[o[255&d]];n=v}return n}function p(e,t,i,n){var r,a,u,h,d,f,p,m,g,v,y,b,x=e.length/4-1;n?(r=c[0],a=c[1],u=c[2],h=c[3],d=s):(r=l[0],a=l[1],u=l[2],h=l[3],d=o),f=t[0]^e[0],p=t[n?3:1]^e[1],m=t[2]^e[2],g=t[n?1:3]^e[3];for(var _=3,E=1;E<x;++E)v=r[f>>>24]^a[p>>>16&255]^u[m>>>8&255]^h[255&g]^e[++_],y=r[p>>>24]^a[m>>>16&255]^u[g>>>8&255]^h[255&f]^e[++_],b=r[m>>>24]^a[g>>>16&255]^u[f>>>8&255]^h[255&p]^e[++_],g=r[g>>>24]^a[f>>>16&255]^u[p>>>8&255]^h[255&m]^e[++_],f=v,p=y,m=b;i[0]=d[f>>>24]<<24^d[p>>>16&255]<<16^d[m>>>8&255]<<8^d[255&g]^e[++_],i[n?3:1]=d[p>>>24]<<24^d[m>>>16&255]<<16^d[g>>>8&255]<<8^d[255&f]^e[++_],i[2]=d[m>>>24]<<24^d[g>>>16&255]<<16^d[f>>>8&255]<<8^d[255&p]^e[++_],i[n?1:3]=d[g>>>24]<<24^d[f>>>16&255]<<16^d[p>>>8&255]<<8^d[255&m]^e[++_]}function m(e){var t,i="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),r=(t=e.decrypt?n.cipher.createDecipher(i,e.key):n.cipher.createCipher(i,e.key)).start;return t.start=function(e,i){var o=null;i instanceof n.util.ByteBuffer&&(o=i,i={}),(i=i||{}).output=o,i.iv=e,r.call(t,i)},t}},38678:(e,t,i)=>{var n=i(50276);i(39504),i(43986);var r=e.exports=n.tls;function o(e,t,i){var o=t.entity===n.tls.ConnectionEnd.client;e.read.cipherState={init:!1,cipher:n.cipher.createDecipher("AES-CBC",o?i.keys.server_write_key:i.keys.client_write_key),iv:o?i.keys.server_write_IV:i.keys.client_write_IV},e.write.cipherState={init:!1,cipher:n.cipher.createCipher("AES-CBC",o?i.keys.client_write_key:i.keys.server_write_key),iv:o?i.keys.client_write_IV:i.keys.server_write_IV},e.read.cipherFunction=c,e.write.cipherFunction=s,e.read.macLength=e.write.macLength=i.mac_length,e.read.macFunction=e.write.macFunction=r.hmac_sha1}function s(e,t){var i,o=!1,s=t.macFunction(t.macKey,t.sequenceNumber,e);e.fragment.putBytes(s),t.updateSequenceNumber(),i=e.version.minor===r.Versions.TLS_1_0.minor?t.cipherState.init?null:t.cipherState.iv:n.random.getBytesSync(16),t.cipherState.init=!0;var l=t.cipherState.cipher;return l.start({iv:i}),e.version.minor>=r.Versions.TLS_1_1.minor&&l.output.putBytes(i),l.update(e.fragment),l.finish(a)&&(e.fragment=l.output,e.length=e.fragment.length(),o=!0),o}function a(e,t,i){if(!i){var n=e-t.length()%e;t.fillWithByte(n-1,n)}return!0}function l(e,t,i){var n=!0;if(i){for(var r=t.length(),o=t.last(),s=r-1-o;s<r-1;++s)n=n&&t.at(s)==o;n&&t.truncate(o+1)}return n}function c(e,t){var i,o=!1;i=e.version.minor===r.Versions.TLS_1_0.minor?t.cipherState.init?null:t.cipherState.iv:e.fragment.getBytes(16),t.cipherState.init=!0;var s=t.cipherState.cipher;s.start({iv:i}),s.update(e.fragment),o=s.finish(l);var a=t.macLength,c=n.random.getBytesSync(a),u=s.output.length();u>=a?(e.fragment=s.output.getBytes(u-a),c=s.output.getBytes(a)):e.fragment=s.output.getBytes(),e.fragment=n.util.createBuffer(e.fragment),e.length=e.fragment.length();var h=t.macFunction(t.macKey,t.sequenceNumber,e);return t.updateSequenceNumber(),o=function(e,t,i){var r=n.hmac.create();return r.start("SHA1",e),r.update(t),t=r.digest().getBytes(),r.start(null,null),r.update(i),i=r.digest().getBytes(),t===i}(t.macKey,c,h)&&o,o}r.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=r.BulkCipherAlgorithm.aes,e.cipher_type=r.CipherType.block,e.enc_key_length=16,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=r.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:o},r.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=r.BulkCipherAlgorithm.aes,e.cipher_type=r.CipherType.block,e.enc_key_length=32,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=r.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:o}},24309:(e,t,i)=>{var n=i(50276);i(12746);var r=n.asn1;t.privateKeyValidator={name:"PrivateKeyInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},t.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:r.Class.UNIVERSAL,type:r.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]}},12746:(e,t,i)=>{var n=i(50276);i(7619),i(16418);var r=e.exports=n.asn1=n.asn1||{};function o(e,t,i){if(i>t){var n=new Error("Too few bytes to parse DER.");throw n.available=e.length(),n.remaining=t,n.requested=i,n}}r.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},r.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},r.create=function(e,t,i,o,s){if(n.util.isArray(o)){for(var a=[],l=0;l<o.length;++l)void 0!==o[l]&&a.push(o[l]);o=a}var c={tagClass:e,type:t,constructed:i,composed:i||n.util.isArray(o),value:o};return s&&"bitStringContents"in s&&(c.bitStringContents=s.bitStringContents,c.original=r.copy(c)),c},r.copy=function(e,t){var i;if(n.util.isArray(e)){i=[];for(var o=0;o<e.length;++o)i.push(r.copy(e[o],t));return i}return"string"==typeof e?e:(i={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:r.copy(e.value,t)},t&&!t.excludeBitStringContents&&(i.bitStringContents=e.bitStringContents),i)},r.equals=function(e,t,i){if(n.util.isArray(e)){if(!n.util.isArray(t))return!1;if(e.length!==t.length)return!1;for(var o=0;o<e.length;++o)if(!r.equals(e[o],t[o]))return!1;return!0}if(typeof e!=typeof t)return!1;if("string"==typeof e)return e===t;var s=e.tagClass===t.tagClass&&e.type===t.type&&e.constructed===t.constructed&&e.composed===t.composed&&r.equals(e.value,t.value);return i&&i.includeBitStringContents&&(s=s&&e.bitStringContents===t.bitStringContents),s},r.getBerValueLength=function(e){var t=e.getByte();if(128!==t)return 128&t?e.getInt((127&t)<<3):t};function s(e,t,i,n){var a;o(e,t,2);var l=e.getByte();t--;var c=192&l,u=31&l;a=e.length();var h,d,f=function(e,t){var i=e.getByte();if(t--,128!==i){var n;if(128&i){var r=127&i;o(e,t,r),n=e.getInt(r<<3)}else n=i;if(n<0)throw new Error("Negative length: "+n);return n}}(e,t);if(t-=a-e.length(),void 0!==f&&f>t){if(n.strict){var p=new Error("Too few bytes to read ASN.1 value.");throw p.available=e.length(),p.remaining=t,p.requested=f,p}f=t}var m=!(32&~l);if(m)if(h=[],void 0===f)for(;;){if(o(e,t,2),e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2),t-=2;break}a=e.length(),h.push(s(e,t,i+1,n)),t-=a-e.length()}else for(;f>0;)a=e.length(),h.push(s(e,f,i+1,n)),t-=a-e.length(),f-=a-e.length();if(void 0===h&&c===r.Class.UNIVERSAL&&u===r.Type.BITSTRING&&(d=e.bytes(f)),void 0===h&&n.decodeBitStrings&&c===r.Class.UNIVERSAL&&u===r.Type.BITSTRING&&f>1){var g=e.read,v=t,y=0;if(u===r.Type.BITSTRING&&(o(e,t,1),y=e.getByte(),t--),0===y)try{a=e.length();var b=s(e,t,i+1,{strict:!0,decodeBitStrings:!0}),x=a-e.length();t-=x,u==r.Type.BITSTRING&&x++;var _=b.tagClass;x!==f||_!==r.Class.UNIVERSAL&&_!==r.Class.CONTEXT_SPECIFIC||(h=[b])}catch(e){}void 0===h&&(e.read=g,t=v)}if(void 0===h){if(void 0===f){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");f=t}if(u===r.Type.BMPSTRING)for(h="";f>0;f-=2)o(e,t,2),h+=String.fromCharCode(e.getInt16()),t-=2;else h=e.getBytes(f),t-=f}var E=void 0===d?null:{bitStringContents:d};return r.create(c,u,m,h,E)}r.fromDer=function(e,t){void 0===t&&(t={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),"boolean"==typeof t&&(t={strict:t,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in t||(t.strict=!0),"parseAllBytes"in t||(t.parseAllBytes=!0),"decodeBitStrings"in t||(t.decodeBitStrings=!0),"string"==typeof e&&(e=n.util.createBuffer(e));var i=e.length(),r=s(e,e.length(),0,t);if(t.parseAllBytes&&0!==e.length()){var o=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw o.byteCount=i,o.remaining=e.length(),o}return r},r.toDer=function(e){var t=n.util.createBuffer(),i=e.tagClass|e.type,o=n.util.createBuffer(),s=!1;if("bitStringContents"in e&&(s=!0,e.original&&(s=r.equals(e,e.original))),s)o.putBytes(e.bitStringContents);else if(e.composed){e.constructed?i|=32:o.putByte(0);for(var a=0;a<e.value.length;++a)void 0!==e.value[a]&&o.putBuffer(r.toDer(e.value[a]))}else if(e.type===r.Type.BMPSTRING)for(a=0;a<e.value.length;++a)o.putInt16(e.value.charCodeAt(a));else!(e.type===r.Type.INTEGER&&e.value.length>1)||(0!==e.value.charCodeAt(0)||128&e.value.charCodeAt(1))&&(255!==e.value.charCodeAt(0)||128&~e.value.charCodeAt(1))?o.putBytes(e.value):o.putBytes(e.value.substr(1));if(t.putByte(i),o.length()<=127)t.putByte(127&o.length());else{var l=o.length(),c="";do{c+=String.fromCharCode(255&l),l>>>=8}while(l>0);t.putByte(128|c.length);for(a=c.length-1;a>=0;--a)t.putByte(c.charCodeAt(a))}return t.putBuffer(o),t},r.oidToDer=function(e){var t,i,r,o,s=e.split("."),a=n.util.createBuffer();a.putByte(40*parseInt(s[0],10)+parseInt(s[1],10));for(var l=2;l<s.length;++l){t=!0,i=[],r=parseInt(s[l],10);do{o=127&r,r>>>=7,t||(o|=128),i.push(o),t=!1}while(r>0);for(var c=i.length-1;c>=0;--c)a.putByte(i[c])}return a},r.derToOid=function(e){var t;"string"==typeof e&&(e=n.util.createBuffer(e));var i=e.getByte();t=Math.floor(i/40)+"."+i%40;for(var r=0;e.length()>0;)r<<=7,128&(i=e.getByte())?r+=127&i:(t+="."+(r+i),r=0);return t},r.utcTimeToDate=function(e){var t=new Date,i=parseInt(e.substr(0,2),10);i=i>=50?1900+i:2e3+i;var n=parseInt(e.substr(2,2),10)-1,r=parseInt(e.substr(4,2),10),o=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),a=0;if(e.length>11){var l=e.charAt(10),c=10;"+"!==l&&"-"!==l&&(a=parseInt(e.substr(10,2),10),c+=2)}if(t.setUTCFullYear(i,n,r),t.setUTCHours(o,s,a,0),c&&("+"===(l=e.charAt(c))||"-"===l)){var u=60*parseInt(e.substr(c+1,2),10)+parseInt(e.substr(c+4,2),10);u*=6e4,"+"===l?t.setTime(+t-u):t.setTime(+t+u)}return t},r.generalizedTimeToDate=function(e){var t=new Date,i=parseInt(e.substr(0,4),10),n=parseInt(e.substr(4,2),10)-1,r=parseInt(e.substr(6,2),10),o=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),a=parseInt(e.substr(12,2),10),l=0,c=0,u=!1;"Z"===e.charAt(e.length-1)&&(u=!0);var h=e.length-5,d=e.charAt(h);"+"!==d&&"-"!==d||(c=60*parseInt(e.substr(h+1,2),10)+parseInt(e.substr(h+4,2),10),c*=6e4,"+"===d&&(c*=-1),u=!0);return"."===e.charAt(14)&&(l=1e3*parseFloat(e.substr(14),10)),u?(t.setUTCFullYear(i,n,r),t.setUTCHours(o,s,a,l),t.setTime(+t+c)):(t.setFullYear(i,n,r),t.setHours(o,s,a,l)),t},r.dateToUtcTime=function(e){if("string"==typeof e)return e;var t="",i=[];i.push((""+e.getUTCFullYear()).substr(2)),i.push(""+(e.getUTCMonth()+1)),i.push(""+e.getUTCDate()),i.push(""+e.getUTCHours()),i.push(""+e.getUTCMinutes()),i.push(""+e.getUTCSeconds());for(var n=0;n<i.length;++n)i[n].length<2&&(t+="0"),t+=i[n];return t+="Z"},r.dateToGeneralizedTime=function(e){if("string"==typeof e)return e;var t="",i=[];i.push(""+e.getUTCFullYear()),i.push(""+(e.getUTCMonth()+1)),i.push(""+e.getUTCDate()),i.push(""+e.getUTCHours()),i.push(""+e.getUTCMinutes()),i.push(""+e.getUTCSeconds());for(var n=0;n<i.length;++n)i[n].length<2&&(t+="0"),t+=i[n];return t+="Z"},r.integerToDer=function(e){var t=n.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var i=new Error("Integer too large; max is 32-bits.");throw i.integer=e,i},r.derToInteger=function(e){"string"==typeof e&&(e=n.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},r.validate=function(e,t,i,o){var s=!1;if(e.tagClass!==t.tagClass&&void 0!==t.tagClass||e.type!==t.type&&void 0!==t.type)o&&(e.tagClass!==t.tagClass&&o.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&o.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||void 0===t.constructed){if(s=!0,t.value&&n.util.isArray(t.value))for(var a=0,l=0;s&&l<t.value.length;++l)s=t.value[l].optional||!1,e.value[a]&&((s=r.validate(e.value[a],t.value[l],i,o))?++a:t.value[l].optional&&(s=!0)),!s&&o&&o.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');if(s&&i)if(t.capture&&(i[t.capture]=e.value),t.captureAsn1&&(i[t.captureAsn1]=e),t.captureBitStringContents&&"bitStringContents"in e&&(i[t.captureBitStringContents]=e.bitStringContents),t.captureBitStringValue&&"bitStringContents"in e)if(e.bitStringContents.length<2)i[t.captureBitStringValue]="";else{if(0!==e.bitStringContents.charCodeAt(0))throw new Error("captureBitStringValue only supported for zero unused bits");i[t.captureBitStringValue]=e.bitStringContents.slice(1)}}else o&&o.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return s};var a=/[^\\u0000-\\u00ff]/;r.prettyPrint=function(e,t,i){var o="";i=i||2,(t=t||0)>0&&(o+="\n");for(var s="",l=0;l<t*i;++l)s+=" ";switch(o+=s+"Tag: ",e.tagClass){case r.Class.UNIVERSAL:o+="Universal:";break;case r.Class.APPLICATION:o+="Application:";break;case r.Class.CONTEXT_SPECIFIC:o+="Context-Specific:";break;case r.Class.PRIVATE:o+="Private:"}if(e.tagClass===r.Class.UNIVERSAL)switch(o+=e.type,e.type){case r.Type.NONE:o+=" (None)";break;case r.Type.BOOLEAN:o+=" (Boolean)";break;case r.Type.INTEGER:o+=" (Integer)";break;case r.Type.BITSTRING:o+=" (Bit string)";break;case r.Type.OCTETSTRING:o+=" (Octet string)";break;case r.Type.NULL:o+=" (Null)";break;case r.Type.OID:o+=" (Object Identifier)";break;case r.Type.ODESC:o+=" (Object Descriptor)";break;case r.Type.EXTERNAL:o+=" (External or Instance of)";break;case r.Type.REAL:o+=" (Real)";break;case r.Type.ENUMERATED:o+=" (Enumerated)";break;case r.Type.EMBEDDED:o+=" (Embedded PDV)";break;case r.Type.UTF8:o+=" (UTF8)";break;case r.Type.ROID:o+=" (Relative Object Identifier)";break;case r.Type.SEQUENCE:o+=" (Sequence)";break;case r.Type.SET:o+=" (Set)";break;case r.Type.PRINTABLESTRING:o+=" (Printable String)";break;case r.Type.IA5String:o+=" (IA5String (ASCII))";break;case r.Type.UTCTIME:o+=" (UTC time)";break;case r.Type.GENERALIZEDTIME:o+=" (Generalized time)";break;case r.Type.BMPSTRING:o+=" (BMP String)"}else o+=e.type;if(o+="\n",o+=s+"Constructed: "+e.constructed+"\n",e.composed){var c=0,u="";for(l=0;l<e.value.length;++l)void 0!==e.value[l]&&(c+=1,u+=r.prettyPrint(e.value[l],t+1,i),l+1<e.value.length&&(u+=","));o+=s+"Sub values: "+c+u}else{if(o+=s+"Value: ",e.type===r.Type.OID){var h=r.derToOid(e.value);o+=h,n.pki&&n.pki.oids&&h in n.pki.oids&&(o+=" ("+n.pki.oids[h]+") ")}if(e.type===r.Type.INTEGER)try{o+=r.derToInteger(e.value)}catch(t){o+="0x"+n.util.bytesToHex(e.value)}else if(e.type===r.Type.BITSTRING){if(e.value.length>1?o+="0x"+n.util.bytesToHex(e.value.slice(1)):o+="(none)",e.value.length>0){var d=e.value.charCodeAt(0);1==d?o+=" (1 unused bit shown)":d>1&&(o+=" ("+d+" unused bits shown)")}}else if(e.type===r.Type.OCTETSTRING)a.test(e.value)||(o+="("+e.value+") "),o+="0x"+n.util.bytesToHex(e.value);else if(e.type===r.Type.UTF8)try{o+=n.util.decodeUtf8(e.value)}catch(t){if("URI malformed"!==t.message)throw t;o+="0x"+n.util.bytesToHex(e.value)+" (malformed UTF8)"}else e.type===r.Type.PRINTABLESTRING||e.type===r.Type.IA5String?o+=e.value:a.test(e.value)?o+="0x"+n.util.bytesToHex(e.value):0===e.value.length?o+="[null]":o+=e.value}return o}},44058:e=>{var t={};e.exports=t;var i={};t.encode=function(e,t,i){if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==i&&"number"!=typeof i)throw new TypeError('"maxline" must be a number.');var n="";if(e instanceof Uint8Array){var r=0,o=t.length,s=t.charAt(0),a=[0];for(r=0;r<e.length;++r){for(var l=0,c=e[r];l<a.length;++l)c+=a[l]<<8,a[l]=c%o,c=c/o|0;for(;c>0;)a.push(c%o),c=c/o|0}for(r=0;0===e[r]&&r<e.length-1;++r)n+=s;for(r=a.length-1;r>=0;--r)n+=t[a[r]]}else n=function(e,t){var i=0,n=t.length,r=t.charAt(0),o=[0];for(i=0;i<e.length();++i){for(var s=0,a=e.at(i);s<o.length;++s)a+=o[s]<<8,o[s]=a%n,a=a/n|0;for(;a>0;)o.push(a%n),a=a/n|0}var l="";for(i=0;0===e.at(i)&&i<e.length()-1;++i)l+=r;for(i=o.length-1;i>=0;--i)l+=t[o[i]];return l}(e,t);if(i){var u=new RegExp(".{1,"+i+"}","g");n=n.match(u).join("\r\n")}return n},t.decode=function(e,t){if("string"!=typeof e)throw new TypeError('"input" must be a string.');if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');var n=i[t];if(!n){n=i[t]=[];for(var r=0;r<t.length;++r)n[t.charCodeAt(r)]=r}e=e.replace(/\s/g,"");var o=t.length,s=t.charAt(0),a=[0];for(r=0;r<e.length;r++){var l=n[e.charCodeAt(r)];if(void 0===l)return;for(var c=0,u=l;c<a.length;++c)u+=a[c]*o,a[c]=255&u,u>>=8;for(;u>0;)a.push(255&u),u>>=8}for(var h=0;e[h]===s&&h<e.length-1;++h)a.push(0);return"undefined"!=typeof Buffer?Buffer.from(a.reverse()):new Uint8Array(a.reverse())}},93900:(e,t,i)=>{var n=i(50276);i(7619),e.exports=n.cipher=n.cipher||{},n.cipher.algorithms=n.cipher.algorithms||{},n.cipher.createCipher=function(e,t){var i=e;if("string"==typeof i&&(i=n.cipher.getAlgorithm(i))&&(i=i()),!i)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:i,key:t,decrypt:!1})},n.cipher.createDecipher=function(e,t){var i=e;if("string"==typeof i&&(i=n.cipher.getAlgorithm(i))&&(i=i()),!i)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:i,key:t,decrypt:!0})},n.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),n.cipher.algorithms[e]=t},n.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in n.cipher.algorithms?n.cipher.algorithms[e]:null};var r=n.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};r.prototype.start=function(e){e=e||{};var t={};for(var i in e)t[i]=e[i];t.decrypt=this._decrypt,this._finish=!1,this._input=n.util.createBuffer(),this.output=e.output||n.util.createBuffer(),this.mode.start(t)},r.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},r.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))}},56370:(e,t,i)=>{var n=i(50276);i(7619),n.cipher=n.cipher||{};var r=e.exports=n.cipher.modes=n.cipher.modes||{};function o(e,t){if("string"==typeof e&&(e=n.util.createBuffer(e)),n.util.isArray(e)&&e.length>4){var i=e;e=n.util.createBuffer();for(var r=0;r<i.length;++r)e.putByte(i[r])}if(e.length()<t)throw new Error("Invalid IV length; got "+e.length()+" bytes and expected "+t+" bytes.");if(!n.util.isArray(e)){var o=[],s=t/4;for(r=0;r<s;++r)o.push(e.getInt32());e=o}return e}function s(e){e[e.length-1]=e[e.length-1]+1&4294967295}function a(e){return[e/4294967296|0,4294967295&e]}r.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},r.ecb.prototype.start=function(e){},r.ecb.prototype.encrypt=function(e,t,i){if(e.length()<this.blockSize&&!(i&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},r.ecb.prototype.decrypt=function(e,t,i){if(e.length()<this.blockSize&&!(i&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},r.ecb.prototype.pad=function(e,t){var i=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(i,i),!0},r.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var i=e.length(),n=e.at(i-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},r.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},r.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=o(e.iv,this.blockSize),this._prev=this._iv.slice(0)}},r.cbc.prototype.encrypt=function(e,t,i){if(e.length()<this.blockSize&&!(i&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n]);this._prev=this._outBlock},r.cbc.prototype.decrypt=function(e,t,i){if(e.length()<this.blockSize&&!(i&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)},r.cbc.prototype.pad=function(e,t){var i=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(i,i),!0},r.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var i=e.length(),n=e.at(i-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},r.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},r.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=o(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},r.cfb.prototype.encrypt=function(e,t,i){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32()^this._outBlock[r],t.putInt32(this._inBlock[r]);else{var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialBlock[r]=e.getInt32()^this._outBlock[r],this._partialOutput.putInt32(this._partialBlock[r]);if(o>0)e.read-=this.blockSize;else for(r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!i)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},r.cfb.prototype.decrypt=function(e,t,i){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32(),t.putInt32(this._inBlock[r]^this._outBlock[r]);else{var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialBlock[r]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[r]^this._outBlock[r]);if(o>0)e.read-=this.blockSize;else for(r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!i)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},r.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},r.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=o(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},r.ofb.prototype.encrypt=function(e,t,i){var n=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var r=0;r<this._ints;++r)t.putInt32(e.getInt32()^this._outBlock[r]),this._inBlock[r]=this._outBlock[r];else{var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialOutput.putInt32(e.getInt32()^this._outBlock[r]);if(o>0)e.read-=this.blockSize;else for(r=0;r<this._ints;++r)this._inBlock[r]=this._outBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!i)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},r.ofb.prototype.decrypt=r.ofb.prototype.encrypt,r.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},r.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=o(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},r.ctr.prototype.encrypt=function(e,t,i){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var r=0;r<this._ints;++r)t.putInt32(e.getInt32()^this._outBlock[r]);else{var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialOutput.putInt32(e.getInt32()^this._outBlock[r]);if(o>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!i)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}s(this._inBlock)},r.ctr.prototype.decrypt=r.ctr.prototype.encrypt,r.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0,this._R=3774873600},r.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,i=n.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?n.util.createBuffer(e.additionalData):n.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=n.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var r=i.length();if(12===r)this._j0=[i.getInt32(),i.getInt32(),i.getInt32(),1];else{for(this._j0=[0,0,0,0];i.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[i.getInt32(),i.getInt32(),i.getInt32(),i.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(a(8*r)))}this._inBlock=this._j0.slice(0),s(this._inBlock),this._partialBytes=0,t=n.util.createBuffer(t),this._aDataLength=a(8*t.length());var o=t.length()%this.blockSize;for(o&&t.fillWithByte(0,this.blockSize-o),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},r.gcm.prototype.encrypt=function(e,t,i){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize){for(var r=0;r<this._ints;++r)t.putInt32(this._outBlock[r]^=e.getInt32());this._cipherLength+=this.blockSize}else{var o=(this.blockSize-n)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(r=0;r<this._ints;++r)this._partialOutput.putInt32(e.getInt32()^this._outBlock[r]);if(o<=0||i){if(i){var a=n%this.blockSize;this._cipherLength+=a,this._partialOutput.truncate(this.blockSize-a)}else this._cipherLength+=this.blockSize;for(r=0;r<this._ints;++r)this._outBlock[r]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!i)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),s(this._inBlock)},r.gcm.prototype.decrypt=function(e,t,i){var n=e.length();if(n<this.blockSize&&!(i&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),s(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var r=0;r<this._ints;++r)t.putInt32(this._outBlock[r]^this._hashBlock[r]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize},r.gcm.prototype.afterFinish=function(e,t){var i=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=n.util.createBuffer();var r=this._aDataLength.concat(a(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,r);var o=[];this.cipher.encrypt(this._j0,o);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^o[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(i=!1),i},r.gcm.prototype.multiply=function(e,t){for(var i=[0,0,0,0],n=t.slice(0),r=0;r<128;++r){e[r/32|0]&1<<31-r%32&&(i[0]^=n[0],i[1]^=n[1],i[2]^=n[2],i[3]^=n[3]),this.pow(n,n)}return i},r.gcm.prototype.pow=function(e,t){for(var i=1&e[3],n=3;n>0;--n)t[n]=e[n]>>>1|(1&e[n-1])<<31;t[0]=e[0]>>>1,i&&(t[0]^=this._R)},r.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],i=0;i<32;++i){var n=e[i/8|0]>>>4*(7-i%8)&15,r=this._m[i][n];t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3]}return t},r.gcm.prototype.ghash=function(e,t,i){return t[0]^=i[0],t[1]^=i[1],t[2]^=i[2],t[3]^=i[3],this.tableMultiply(t)},r.gcm.prototype.generateHashTable=function(e,t){for(var i=8/t,n=4*i,r=16*i,o=new Array(r),s=0;s<r;++s){var a=[0,0,0,0],l=(n-1-s%n)*t;a[s/n|0]=1<<t-1<<l,o[s]=this.generateSubHashTable(this.multiply(a,e),t)}return o},r.gcm.prototype.generateSubHashTable=function(e,t){var i=1<<t,n=i>>>1,r=new Array(i);r[n]=e.slice(0);for(var o=n>>>1;o>0;)this.pow(r[2*o],r[o]=[]),o>>=1;for(o=2;o<n;){for(var s=1;s<o;++s){var a=r[o],l=r[s];r[o+s]=[a[0]^l[0],a[1]^l[1],a[2]^l[2],a[3]^l[3]]}o*=2}for(r[0]=[0,0,0,0],o=n+1;o<i;++o){var c=r[o^n];r[o]=[e[0]^c[0],e[1]^c[1],e[2]^c[2],e[3]^c[3]]}return r}},19095:(e,t,i)=>{var n=i(50276);function r(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.des.Algorithm(e,t)}))}i(93900),i(56370),i(7619),e.exports=n.des=n.des||{},n.des.startEncrypting=function(e,t,i,n){var r=p({key:e,output:i,decrypt:!1,mode:n||(null===t?"ECB":"CBC")});return r.start(t),r},n.des.createEncryptionCipher=function(e,t){return p({key:e,output:null,decrypt:!1,mode:t})},n.des.startDecrypting=function(e,t,i,n){var r=p({key:e,output:i,decrypt:!0,mode:n||(null===t?"ECB":"CBC")});return r.start(t),r},n.des.createDecryptionCipher=function(e,t){return p({key:e,output:null,decrypt:!0,mode:t})},n.des.Algorithm=function(e,t){var i=this;i.name=e,i.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return f(i._keys,e,t,!1)},decrypt:function(e,t){return f(i._keys,e,t,!0)}}}),i._init=!1},n.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=n.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=function(e){for(var t,i=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],n=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],r=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],o=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],a=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],l=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],d=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],f=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],p=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],m=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=e.length()>8?3:1,v=[],y=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],b=0,x=0;x<g;x++){var _=e.getInt32(),E=e.getInt32();_^=(t=252645135&(_>>>4^E))<<4,_^=t=65535&((E^=t)>>>-16^_),_^=(t=858993459&(_>>>2^(E^=t<<-16)))<<2,_^=t=65535&((E^=t)>>>-16^_),_^=(t=1431655765&(_>>>1^(E^=t<<-16)))<<1,_^=t=16711935&((E^=t)>>>8^_),t=(_^=(t=1431655765&(_>>>1^(E^=t<<8)))<<1)<<8|(E^=t)>>>20&240,_=E<<24|E<<8&16711680|E>>>8&65280|E>>>24&240,E=t;for(var S=0;S<y.length;++S){y[S]?(_=_<<2|_>>>26,E=E<<2|E>>>26):(_=_<<1|_>>>27,E=E<<1|E>>>27),E&=-15;var A=i[(_&=-15)>>>28]|n[_>>>24&15]|r[_>>>20&15]|o[_>>>16&15]|s[_>>>12&15]|a[_>>>8&15]|l[_>>>4&15],w=c[E>>>28]|u[E>>>24&15]|h[E>>>20&15]|d[E>>>16&15]|f[E>>>12&15]|p[E>>>8&15]|m[E>>>4&15];t=65535&(w>>>16^A),v[b++]=A^t,v[b++]=w^t<<16}}return v}(t),this._init=!0}},r("DES-ECB",n.cipher.modes.ecb),r("DES-CBC",n.cipher.modes.cbc),r("DES-CFB",n.cipher.modes.cfb),r("DES-OFB",n.cipher.modes.ofb),r("DES-CTR",n.cipher.modes.ctr),r("3DES-ECB",n.cipher.modes.ecb),r("3DES-CBC",n.cipher.modes.cbc),r("3DES-CFB",n.cipher.modes.cfb),r("3DES-OFB",n.cipher.modes.ofb),r("3DES-CTR",n.cipher.modes.ctr);var o=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],s=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],a=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],l=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],c=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],u=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],h=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],d=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function f(e,t,i,n){var r,f,p=32===e.length?3:9;r=3===p?n?[30,-2,-2]:[0,32,2]:n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var m=t[0],g=t[1];m^=(f=252645135&(m>>>4^g))<<4,m^=(f=65535&(m>>>16^(g^=f)))<<16,m^=f=858993459&((g^=f)>>>2^m),m^=f=16711935&((g^=f<<2)>>>8^m),m=(m^=(f=1431655765&(m>>>1^(g^=f<<8)))<<1)<<1|m>>>31,g=(g^=f)<<1|g>>>31;for(var v=0;v<p;v+=3){for(var y=r[v+1],b=r[v+2],x=r[v];x!=y;x+=b){var _=g^e[x],E=(g>>>4|g<<28)^e[x+1];f=m,m=g,g=f^(s[_>>>24&63]|l[_>>>16&63]|u[_>>>8&63]|d[63&_]|o[E>>>24&63]|a[E>>>16&63]|c[E>>>8&63]|h[63&E])}f=m,m=g,g=f}g=g>>>1|g<<31,g^=f=1431655765&((m=m>>>1|m<<31)>>>1^g),g^=(f=16711935&(g>>>8^(m^=f<<1)))<<8,g^=(f=858993459&(g>>>2^(m^=f)))<<2,g^=f=65535&((m^=f)>>>16^g),g^=f=252645135&((m^=f<<16)>>>4^g),m^=f<<4,i[0]=m,i[1]=g}function p(e){var t,i="DES-"+((e=e||{}).mode||"CBC").toUpperCase(),r=(t=e.decrypt?n.cipher.createDecipher(i,e.key):n.cipher.createCipher(i,e.key)).start;return t.start=function(e,i){var o=null;i instanceof n.util.ByteBuffer&&(o=i,i={}),(i=i||{}).output=o,i.iv=e,r.call(t,i)},t}},62926:(e,t,i)=>{var n=i(50276);i(43736),i(89356),i(72313),i(7619);var r=i(24309),o=r.publicKeyValidator,s=r.privateKeyValidator;if(void 0===a)var a=n.jsbn.BigInteger;var l=n.util.ByteBuffer,c="undefined"==typeof Buffer?Uint8Array:Buffer;n.pki=n.pki||{},e.exports=n.pki.ed25519=n.ed25519=n.ed25519||{};var u=n.ed25519;function h(e){var t=e.message;if(t instanceof Uint8Array||t instanceof c)return t;var i=e.encoding;if(void 0===t){if(!e.md)throw new TypeError('"options.message" or "options.md" not specified.');t=e.md.digest().getBytes(),i="binary"}if("string"==typeof t&&!i)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if("string"==typeof t){if("undefined"!=typeof Buffer)return Buffer.from(t,i);t=new l(t,i)}else if(!(t instanceof l))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');for(var n=new c(t.length()),r=0;r<n.length;++r)n[r]=t.at(r);return n}u.constants={},u.constants.PUBLIC_KEY_BYTE_LENGTH=32,u.constants.PRIVATE_KEY_BYTE_LENGTH=64,u.constants.SEED_BYTE_LENGTH=32,u.constants.SIGN_BYTE_LENGTH=64,u.constants.HASH_BYTE_LENGTH=64,u.generateKeyPair=function(e){var t=(e=e||{}).seed;if(void 0===t)t=n.random.getBytesSync(u.constants.SEED_BYTE_LENGTH);else if("string"==typeof t){if(t.length!==u.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+u.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');t=h({message:t,encoding:"binary"});for(var i=new c(u.constants.PUBLIC_KEY_BYTE_LENGTH),r=new c(u.constants.PRIVATE_KEY_BYTE_LENGTH),o=0;o<32;++o)r[o]=t[o];return function(e,t){var i,n=[B(),B(),B(),B()],r=x(t,32);for(r[0]&=248,r[31]&=127,r[31]|=64,L(n,r),w(e,n),i=0;i<32;++i)t[i+32]=e[i]}(i,r),{publicKey:i,privateKey:r}},u.privateKeyFromAsn1=function(e){var t={},i=[];if(!n.asn1.validate(e,s,t,i)){var r=new Error("Invalid Key.");throw r.errors=i,r}var o=n.asn1.derToOid(t.privateKeyOid),a=n.oids.EdDSA25519;if(o!==a)throw new Error('Invalid OID "'+o+'"; OID must be "'+a+'".');var l=t.privateKey;return{privateKeyBytes:h({message:n.asn1.fromDer(l).value,encoding:"binary"})}},u.publicKeyFromAsn1=function(e){var t={},i=[];if(!n.asn1.validate(e,o,t,i)){var r=new Error("Invalid Key.");throw r.errors=i,r}var s=n.asn1.derToOid(t.publicKeyOid),a=n.oids.EdDSA25519;if(s!==a)throw new Error('Invalid OID "'+s+'"; OID must be "'+a+'".');var l=t.ed25519PublicKey;if(l.length!==u.constants.PUBLIC_KEY_BYTE_LENGTH)throw new Error("Key length is invalid.");return h({message:l,encoding:"binary"})},u.publicKeyFromPrivateKey=function(e){var t=h({message:(e=e||{}).privateKey,encoding:"binary"});if(t.length!==u.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+u.constants.PRIVATE_KEY_BYTE_LENGTH);for(var i=new c(u.constants.PUBLIC_KEY_BYTE_LENGTH),n=0;n<i.length;++n)i[n]=t[32+n];return i},u.sign=function(e){var t=h(e=e||{}),i=h({message:e.privateKey,encoding:"binary"});if(i.length===u.constants.SEED_BYTE_LENGTH)i=u.generateKeyPair({seed:i}).privateKey;else if(i.length!==u.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+u.constants.SEED_BYTE_LENGTH+" or "+u.constants.PRIVATE_KEY_BYTE_LENGTH);var n=new c(u.constants.SIGN_BYTE_LENGTH+t.length);!function(e,t,i,n){var r,o,s=new Float64Array(64),a=[B(),B(),B(),B()],l=x(n,32);l[0]&=248,l[31]&=127,l[31]|=64;var c=i+64;for(r=0;r<i;++r)e[64+r]=t[r];for(r=0;r<32;++r)e[32+r]=l[32+r];var u=x(e.subarray(32),i+32);for(E(u),L(a,u),w(e,a),r=32;r<64;++r)e[r]=n[r];var h=x(e,i+64);for(E(h),r=32;r<64;++r)s[r]=0;for(r=0;r<32;++r)s[r]=u[r];for(r=0;r<32;++r)for(o=0;o<32;o++)s[r+o]+=h[r]*l[o];_(e.subarray(32),s)}(n,t,t.length,i);for(var r=new c(u.constants.SIGN_BYTE_LENGTH),o=0;o<r.length;++o)r[o]=n[o];return r},u.verify=function(e){var t=h(e=e||{});if(void 0===e.signature)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');var i=h({message:e.signature,encoding:"binary"});if(i.length!==u.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+u.constants.SIGN_BYTE_LENGTH);var n=h({message:e.publicKey,encoding:"binary"});if(n.length!==u.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+u.constants.PUBLIC_KEY_BYTE_LENGTH);var r,o=new c(u.constants.SIGN_BYTE_LENGTH+t.length),s=new c(u.constants.SIGN_BYTE_LENGTH+t.length);for(r=0;r<u.constants.SIGN_BYTE_LENGTH;++r)o[r]=i[r];for(r=0;r<t.length;++r)o[r+u.constants.SIGN_BYTE_LENGTH]=t[r];return function(e,t,i,n){var r,o=new c(32),s=[B(),B(),B(),B()],a=[B(),B(),B(),B()];if(-1,i<64)return-1;if(function(e,t){var i=B(),n=B(),r=B(),o=B(),s=B(),a=B(),l=B();R(e[2],f),function(e,t){var i;for(i=0;i<16;++i)e[i]=t[2*i]+(t[2*i+1]<<8);e[15]&=32767}(e[1],t),k(r,e[1]),F(o,r,p),U(r,r,e[2]),N(o,e[2],o),k(s,o),k(a,s),F(l,a,s),F(i,l,r),F(i,i,o),function(e,t){var i,n=B();for(i=0;i<16;++i)n[i]=t[i];for(i=250;i>=0;--i)k(n,n),1!==i&&F(n,n,t);for(i=0;i<16;++i)e[i]=n[i]}(i,i),F(i,i,r),F(i,i,o),F(i,i,o),F(e[0],i,o),k(n,e[0]),F(n,n,o),T(n,r)&&F(e[0],e[0],b);if(k(n,e[0]),F(n,n,o),T(n,r))return-1;I(e[0])===t[31]>>7&&U(e[0],d,e[0]);return F(e[3],e[0],e[1]),0}(a,n))return-1;for(r=0;r<i;++r)e[r]=t[r];for(r=0;r<32;++r)e[r+32]=n[r];var l=x(e,i);if(E(l),P(s,a,l),L(a,t.subarray(32)),S(s,a),w(o,s),i-=64,M(t,0,o,0)){for(r=0;r<i;++r)e[r]=0;return-1}for(r=0;r<i;++r)e[r]=t[r+64];return i}(s,o,o.length,n)>=0};var d=B(),f=B([1]),p=B([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),m=B([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),g=B([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),v=B([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),y=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),b=B([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function x(e,t){var i=n.md.sha512.create(),r=new l(e);i.update(r.getBytes(t),"binary");var o=i.digest().getBytes();if("undefined"!=typeof Buffer)return Buffer.from(o,"binary");for(var s=new c(u.constants.HASH_BYTE_LENGTH),a=0;a<64;++a)s[a]=o.charCodeAt(a);return s}function _(e,t){var i,n,r,o;for(n=63;n>=32;--n){for(i=0,r=n-32,o=n-12;r<o;++r)t[r]+=i-16*t[n]*y[r-(n-32)],i=t[r]+128>>8,t[r]-=256*i;t[r]+=i,t[n]=0}for(i=0,r=0;r<32;++r)t[r]+=i-(t[31]>>4)*y[r],i=t[r]>>8,t[r]&=255;for(r=0;r<32;++r)t[r]-=i*y[r];for(n=0;n<32;++n)t[n+1]+=t[n]>>8,e[n]=255&t[n]}function E(e){for(var t=new Float64Array(64),i=0;i<64;++i)t[i]=e[i],e[i]=0;_(e,t)}function S(e,t){var i=B(),n=B(),r=B(),o=B(),s=B(),a=B(),l=B(),c=B(),u=B();U(i,e[1],e[0]),U(u,t[1],t[0]),F(i,i,u),N(n,e[0],e[1]),N(u,t[0],t[1]),F(n,n,u),F(r,e[3],t[3]),F(r,r,m),F(o,e[2],t[2]),N(o,o,o),U(s,n,i),U(a,o,r),N(l,o,r),N(c,n,i),F(e[0],s,a),F(e[1],c,l),F(e[2],l,a),F(e[3],s,c)}function A(e,t,i){for(var n=0;n<4;++n)O(e[n],t[n],i)}function w(e,t){var i=B(),n=B(),r=B();!function(e,t){var i,n=B();for(i=0;i<16;++i)n[i]=t[i];for(i=253;i>=0;--i)k(n,n),2!==i&&4!==i&&F(n,n,t);for(i=0;i<16;++i)e[i]=n[i]}(r,t[2]),F(i,t[0],r),F(n,t[1],r),C(e,n),e[31]^=I(i)<<7}function C(e,t){var i,n,r,o=B(),s=B();for(i=0;i<16;++i)s[i]=t[i];for(D(s),D(s),D(s),n=0;n<2;++n){for(o[0]=s[0]-65517,i=1;i<15;++i)o[i]=s[i]-65535-(o[i-1]>>16&1),o[i-1]&=65535;o[15]=s[15]-32767-(o[14]>>16&1),r=o[15]>>16&1,o[14]&=65535,O(s,o,1-r)}for(i=0;i<16;i++)e[2*i]=255&s[i],e[2*i+1]=s[i]>>8}function T(e,t){var i=new c(32),n=new c(32);return C(i,e),C(n,t),M(i,0,n,0)}function M(e,t,i,n){return function(e,t,i,n,r){var o,s=0;for(o=0;o<r;++o)s|=e[t+o]^i[n+o];return(1&s-1>>>8)-1}(e,t,i,n,32)}function I(e){var t=new c(32);return C(t,e),1&t[0]}function P(e,t,i){var n,r;for(R(e[0],d),R(e[1],f),R(e[2],f),R(e[3],d),r=255;r>=0;--r)A(e,t,n=i[r/8|0]>>(7&r)&1),S(t,e),S(e,e),A(e,t,n)}function L(e,t){var i=[B(),B(),B(),B()];R(i[0],g),R(i[1],v),R(i[2],f),F(i[3],g,v),P(e,i,t)}function R(e,t){var i;for(i=0;i<16;i++)e[i]=0|t[i]}function D(e){var t,i,n=1;for(t=0;t<16;++t)i=e[t]+n+65535,n=Math.floor(i/65536),e[t]=i-65536*n;e[0]+=n-1+37*(n-1)}function O(e,t,i){for(var n,r=~(i-1),o=0;o<16;++o)n=r&(e[o]^t[o]),e[o]^=n,t[o]^=n}function B(e){var t,i=new Float64Array(16);if(e)for(t=0;t<e.length;++t)i[t]=e[t];return i}function N(e,t,i){for(var n=0;n<16;++n)e[n]=t[n]+i[n]}function U(e,t,i){for(var n=0;n<16;++n)e[n]=t[n]-i[n]}function k(e,t){F(e,t,t)}function F(e,t,i){var n,r,o=0,s=0,a=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,m=0,g=0,v=0,y=0,b=0,x=0,_=0,E=0,S=0,A=0,w=0,C=0,T=0,M=0,I=0,P=0,L=0,R=0,D=0,O=0,B=0,N=i[0],U=i[1],k=i[2],F=i[3],V=i[4],G=i[5],z=i[6],H=i[7],W=i[8],j=i[9],q=i[10],K=i[11],X=i[12],Y=i[13],Q=i[14],Z=i[15];o+=(n=t[0])*N,s+=n*U,a+=n*k,l+=n*F,c+=n*V,u+=n*G,h+=n*z,d+=n*H,f+=n*W,p+=n*j,m+=n*q,g+=n*K,v+=n*X,y+=n*Y,b+=n*Q,x+=n*Z,s+=(n=t[1])*N,a+=n*U,l+=n*k,c+=n*F,u+=n*V,h+=n*G,d+=n*z,f+=n*H,p+=n*W,m+=n*j,g+=n*q,v+=n*K,y+=n*X,b+=n*Y,x+=n*Q,_+=n*Z,a+=(n=t[2])*N,l+=n*U,c+=n*k,u+=n*F,h+=n*V,d+=n*G,f+=n*z,p+=n*H,m+=n*W,g+=n*j,v+=n*q,y+=n*K,b+=n*X,x+=n*Y,_+=n*Q,E+=n*Z,l+=(n=t[3])*N,c+=n*U,u+=n*k,h+=n*F,d+=n*V,f+=n*G,p+=n*z,m+=n*H,g+=n*W,v+=n*j,y+=n*q,b+=n*K,x+=n*X,_+=n*Y,E+=n*Q,S+=n*Z,c+=(n=t[4])*N,u+=n*U,h+=n*k,d+=n*F,f+=n*V,p+=n*G,m+=n*z,g+=n*H,v+=n*W,y+=n*j,b+=n*q,x+=n*K,_+=n*X,E+=n*Y,S+=n*Q,A+=n*Z,u+=(n=t[5])*N,h+=n*U,d+=n*k,f+=n*F,p+=n*V,m+=n*G,g+=n*z,v+=n*H,y+=n*W,b+=n*j,x+=n*q,_+=n*K,E+=n*X,S+=n*Y,A+=n*Q,w+=n*Z,h+=(n=t[6])*N,d+=n*U,f+=n*k,p+=n*F,m+=n*V,g+=n*G,v+=n*z,y+=n*H,b+=n*W,x+=n*j,_+=n*q,E+=n*K,S+=n*X,A+=n*Y,w+=n*Q,C+=n*Z,d+=(n=t[7])*N,f+=n*U,p+=n*k,m+=n*F,g+=n*V,v+=n*G,y+=n*z,b+=n*H,x+=n*W,_+=n*j,E+=n*q,S+=n*K,A+=n*X,w+=n*Y,C+=n*Q,T+=n*Z,f+=(n=t[8])*N,p+=n*U,m+=n*k,g+=n*F,v+=n*V,y+=n*G,b+=n*z,x+=n*H,_+=n*W,E+=n*j,S+=n*q,A+=n*K,w+=n*X,C+=n*Y,T+=n*Q,M+=n*Z,p+=(n=t[9])*N,m+=n*U,g+=n*k,v+=n*F,y+=n*V,b+=n*G,x+=n*z,_+=n*H,E+=n*W,S+=n*j,A+=n*q,w+=n*K,C+=n*X,T+=n*Y,M+=n*Q,I+=n*Z,m+=(n=t[10])*N,g+=n*U,v+=n*k,y+=n*F,b+=n*V,x+=n*G,_+=n*z,E+=n*H,S+=n*W,A+=n*j,w+=n*q,C+=n*K,T+=n*X,M+=n*Y,I+=n*Q,P+=n*Z,g+=(n=t[11])*N,v+=n*U,y+=n*k,b+=n*F,x+=n*V,_+=n*G,E+=n*z,S+=n*H,A+=n*W,w+=n*j,C+=n*q,T+=n*K,M+=n*X,I+=n*Y,P+=n*Q,L+=n*Z,v+=(n=t[12])*N,y+=n*U,b+=n*k,x+=n*F,_+=n*V,E+=n*G,S+=n*z,A+=n*H,w+=n*W,C+=n*j,T+=n*q,M+=n*K,I+=n*X,P+=n*Y,L+=n*Q,R+=n*Z,y+=(n=t[13])*N,b+=n*U,x+=n*k,_+=n*F,E+=n*V,S+=n*G,A+=n*z,w+=n*H,C+=n*W,T+=n*j,M+=n*q,I+=n*K,P+=n*X,L+=n*Y,R+=n*Q,D+=n*Z,b+=(n=t[14])*N,x+=n*U,_+=n*k,E+=n*F,S+=n*V,A+=n*G,w+=n*z,C+=n*H,T+=n*W,M+=n*j,I+=n*q,P+=n*K,L+=n*X,R+=n*Y,D+=n*Q,O+=n*Z,x+=(n=t[15])*N,s+=38*(E+=n*k),a+=38*(S+=n*F),l+=38*(A+=n*V),c+=38*(w+=n*G),u+=38*(C+=n*z),h+=38*(T+=n*H),d+=38*(M+=n*W),f+=38*(I+=n*j),p+=38*(P+=n*q),m+=38*(L+=n*K),g+=38*(R+=n*X),v+=38*(D+=n*Y),y+=38*(O+=n*Q),b+=38*(B+=n*Z),o=(n=(o+=38*(_+=n*U))+(r=1)+65535)-65536*(r=Math.floor(n/65536)),s=(n=s+r+65535)-65536*(r=Math.floor(n/65536)),a=(n=a+r+65535)-65536*(r=Math.floor(n/65536)),l=(n=l+r+65535)-65536*(r=Math.floor(n/65536)),c=(n=c+r+65535)-65536*(r=Math.floor(n/65536)),u=(n=u+r+65535)-65536*(r=Math.floor(n/65536)),h=(n=h+r+65535)-65536*(r=Math.floor(n/65536)),d=(n=d+r+65535)-65536*(r=Math.floor(n/65536)),f=(n=f+r+65535)-65536*(r=Math.floor(n/65536)),p=(n=p+r+65535)-65536*(r=Math.floor(n/65536)),m=(n=m+r+65535)-65536*(r=Math.floor(n/65536)),g=(n=g+r+65535)-65536*(r=Math.floor(n/65536)),v=(n=v+r+65535)-65536*(r=Math.floor(n/65536)),y=(n=y+r+65535)-65536*(r=Math.floor(n/65536)),b=(n=b+r+65535)-65536*(r=Math.floor(n/65536)),x=(n=x+r+65535)-65536*(r=Math.floor(n/65536)),o=(n=(o+=r-1+37*(r-1))+(r=1)+65535)-65536*(r=Math.floor(n/65536)),s=(n=s+r+65535)-65536*(r=Math.floor(n/65536)),a=(n=a+r+65535)-65536*(r=Math.floor(n/65536)),l=(n=l+r+65535)-65536*(r=Math.floor(n/65536)),c=(n=c+r+65535)-65536*(r=Math.floor(n/65536)),u=(n=u+r+65535)-65536*(r=Math.floor(n/65536)),h=(n=h+r+65535)-65536*(r=Math.floor(n/65536)),d=(n=d+r+65535)-65536*(r=Math.floor(n/65536)),f=(n=f+r+65535)-65536*(r=Math.floor(n/65536)),p=(n=p+r+65535)-65536*(r=Math.floor(n/65536)),m=(n=m+r+65535)-65536*(r=Math.floor(n/65536)),g=(n=g+r+65535)-65536*(r=Math.floor(n/65536)),v=(n=v+r+65535)-65536*(r=Math.floor(n/65536)),y=(n=y+r+65535)-65536*(r=Math.floor(n/65536)),b=(n=b+r+65535)-65536*(r=Math.floor(n/65536)),x=(n=x+r+65535)-65536*(r=Math.floor(n/65536)),o+=r-1+37*(r-1),e[0]=o,e[1]=s,e[2]=a,e[3]=l,e[4]=c,e[5]=u,e[6]=h,e[7]=d,e[8]=f,e[9]=p,e[10]=m,e[11]=g,e[12]=v,e[13]=y,e[14]=b,e[15]=x}},50276:e=>{e.exports={options:{usePureJavaScript:!1}}},71696:(e,t,i)=>{var n=i(50276);i(8106),i(7619),(e.exports=n.hmac=n.hmac||{}).create=function(){var e=null,t=null,i=null,r=null,o={start:function(o,s){if(null!==o)if("string"==typeof o){if(!((o=o.toLowerCase())in n.md.algorithms))throw new Error('Unknown hash algorithm "'+o+'"');t=n.md.algorithms[o].create()}else t=o;if(null===s)s=e;else{if("string"==typeof s)s=n.util.createBuffer(s);else if(n.util.isArray(s)){var a=s;s=n.util.createBuffer();for(var l=0;l<a.length;++l)s.putByte(a[l])}var c=s.length();c>t.blockLength&&(t.start(),t.update(s.bytes()),s=t.digest()),i=n.util.createBuffer(),r=n.util.createBuffer(),c=s.length();for(l=0;l<c;++l){a=s.at(l);i.putByte(54^a),r.putByte(92^a)}if(c<t.blockLength)for(a=t.blockLength-c,l=0;l<a;++l)i.putByte(54),r.putByte(92);e=s,i=i.bytes(),r=r.bytes()}t.start(),t.update(i)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(r),t.update(e),t.digest()}};return o.digest=o.getMac,o}},39547:(e,t,i)=>{e.exports=i(50276),i(39504),i(38678),i(12746),i(93900),i(19095),i(62926),i(71696),i(83432),i(52045),i(61355),i(45250),i(3254),i(2385),i(47501),i(55071),i(59343),i(29255),i(10268),i(73878),i(51417),i(89356),i(55124),i(50149),i(43986),i(7619)},43736:(e,t,i)=>{var n,r=i(50276);e.exports=r.jsbn=r.jsbn||{};function o(e,t,i){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,i):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function s(){return new o(null)}function a(e,t,i,n,r,o){for(var s=16383&t,a=t>>14;--o>=0;){var l=16383&this.data[e],c=this.data[e++]>>14,u=a*l+c*s;r=((l=s*l+((16383&u)<<14)+i.data[n]+r)>>28)+(u>>14)+a*c,i.data[n++]=268435455&l}return r}r.jsbn.BigInteger=o,"undefined"==typeof navigator?(o.prototype.am=a,n=28):"Microsoft Internet Explorer"==navigator.appName?(o.prototype.am=function(e,t,i,n,r,o){for(var s=32767&t,a=t>>15;--o>=0;){var l=32767&this.data[e],c=this.data[e++]>>15,u=a*l+c*s;r=((l=s*l+((32767&u)<<15)+i.data[n]+(1073741823&r))>>>30)+(u>>>15)+a*c+(r>>>30),i.data[n++]=1073741823&l}return r},n=30):"Netscape"!=navigator.appName?(o.prototype.am=function(e,t,i,n,r,o){for(;--o>=0;){var s=t*this.data[e++]+i.data[n]+r;r=Math.floor(s/67108864),i.data[n++]=67108863&s}return r},n=26):(o.prototype.am=a,n=28),o.prototype.DB=n,o.prototype.DM=(1<<n)-1,o.prototype.DV=1<<n;o.prototype.FV=Math.pow(2,52),o.prototype.F1=52-n,o.prototype.F2=2*n-52;var l,c,u="0123456789abcdefghijklmnopqrstuvwxyz",h=new Array;for(l="0".charCodeAt(0),c=0;c<=9;++c)h[l++]=c;for(l="a".charCodeAt(0),c=10;c<36;++c)h[l++]=c;for(l="A".charCodeAt(0),c=10;c<36;++c)h[l++]=c;function d(e){return u.charAt(e)}function f(e,t){var i=h[e.charCodeAt(t)];return null==i?-1:i}function p(e){var t=s();return t.fromInt(e),t}function m(e){var t,i=1;return 0!=(t=e>>>16)&&(e=t,i+=16),0!=(t=e>>8)&&(e=t,i+=8),0!=(t=e>>4)&&(e=t,i+=4),0!=(t=e>>2)&&(e=t,i+=2),0!=(t=e>>1)&&(e=t,i+=1),i}function g(e){this.m=e}function v(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function y(e,t){return e&t}function b(e,t){return e|t}function x(e,t){return e^t}function _(e,t){return e&~t}function E(e){if(0==e)return-1;var t=0;return 65535&e||(e>>=16,t+=16),255&e||(e>>=8,t+=8),15&e||(e>>=4,t+=4),3&e||(e>>=2,t+=2),1&e||++t,t}function S(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function A(){}function w(e){return e}function C(e){this.r2=s(),this.q3=s(),o.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}g.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},g.prototype.revert=function(e){return e},g.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},g.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},g.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},v.prototype.convert=function(e){var t=s();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(o.ZERO)>0&&this.m.subTo(t,t),t},v.prototype.revert=function(e){var t=s();return e.copyTo(t),this.reduce(t),t},v.prototype.reduce=function(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var i=32767&e.data[t],n=i*this.mpl+((i*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(i=t+this.m.t,e.data[i]+=this.m.am(0,n,e,t,0,this.m.t);e.data[i]>=e.DV;)e.data[i]-=e.DV,e.data[++i]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},v.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},v.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},o.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},o.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},o.prototype.fromString=function(e,t){var i;if(16==t)i=4;else if(8==t)i=3;else if(256==t)i=8;else if(2==t)i=1;else if(32==t)i=5;else{if(4!=t)return void this.fromRadix(e,t);i=2}this.t=0,this.s=0;for(var n=e.length,r=!1,s=0;--n>=0;){var a=8==i?255&e[n]:f(e,n);a<0?"-"==e.charAt(n)&&(r=!0):(r=!1,0==s?this.data[this.t++]=a:s+i>this.DB?(this.data[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this.data[this.t++]=a>>this.DB-s):this.data[this.t-1]|=a<<s,(s+=i)>=this.DB&&(s-=this.DB))}8==i&&128&e[0]&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),r&&o.ZERO.subTo(this,this)},o.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t},o.prototype.dlShiftTo=function(e,t){var i;for(i=this.t-1;i>=0;--i)t.data[i+e]=this.data[i];for(i=e-1;i>=0;--i)t.data[i]=0;t.t=this.t+e,t.s=this.s},o.prototype.drShiftTo=function(e,t){for(var i=e;i<this.t;++i)t.data[i-e]=this.data[i];t.t=Math.max(this.t-e,0),t.s=this.s},o.prototype.lShiftTo=function(e,t){var i,n=e%this.DB,r=this.DB-n,o=(1<<r)-1,s=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(i=this.t-1;i>=0;--i)t.data[i+s+1]=this.data[i]>>r|a,a=(this.data[i]&o)<<n;for(i=s-1;i>=0;--i)t.data[i]=0;t.data[s]=a,t.t=this.t+s+1,t.s=this.s,t.clamp()},o.prototype.rShiftTo=function(e,t){t.s=this.s;var i=Math.floor(e/this.DB);if(i>=this.t)t.t=0;else{var n=e%this.DB,r=this.DB-n,o=(1<<n)-1;t.data[0]=this.data[i]>>n;for(var s=i+1;s<this.t;++s)t.data[s-i-1]|=(this.data[s]&o)<<r,t.data[s-i]=this.data[s]>>n;n>0&&(t.data[this.t-i-1]|=(this.s&o)<<r),t.t=this.t-i,t.clamp()}},o.prototype.subTo=function(e,t){for(var i=0,n=0,r=Math.min(e.t,this.t);i<r;)n+=this.data[i]-e.data[i],t.data[i++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;i<this.t;)n+=this.data[i],t.data[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<e.t;)n-=e.data[i],t.data[i++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t.data[i++]=this.DV+n:n>0&&(t.data[i++]=n),t.t=i,t.clamp()},o.prototype.multiplyTo=function(e,t){var i=this.abs(),n=e.abs(),r=i.t;for(t.t=r+n.t;--r>=0;)t.data[r]=0;for(r=0;r<n.t;++r)t.data[r+i.t]=i.am(0,n.data[r],t,r,0,i.t);t.s=0,t.clamp(),this.s!=e.s&&o.ZERO.subTo(t,t)},o.prototype.squareTo=function(e){for(var t=this.abs(),i=e.t=2*t.t;--i>=0;)e.data[i]=0;for(i=0;i<t.t-1;++i){var n=t.am(i,t.data[i],e,2*i,0,1);(e.data[i+t.t]+=t.am(i+1,2*t.data[i],e,2*i+1,n,t.t-i-1))>=t.DV&&(e.data[i+t.t]-=t.DV,e.data[i+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(i,t.data[i],e,2*i,0,1)),e.s=0,e.clamp()},o.prototype.divRemTo=function(e,t,i){var n=e.abs();if(!(n.t<=0)){var r=this.abs();if(r.t<n.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=s());var a=s(),l=this.s,c=e.s,u=this.DB-m(n.data[n.t-1]);u>0?(n.lShiftTo(u,a),r.lShiftTo(u,i)):(n.copyTo(a),r.copyTo(i));var h=a.t,d=a.data[h-1];if(0!=d){var f=d*(1<<this.F1)+(h>1?a.data[h-2]>>this.F2:0),p=this.FV/f,g=(1<<this.F1)/f,v=1<<this.F2,y=i.t,b=y-h,x=null==t?s():t;for(a.dlShiftTo(b,x),i.compareTo(x)>=0&&(i.data[i.t++]=1,i.subTo(x,i)),o.ONE.dlShiftTo(h,x),x.subTo(a,a);a.t<h;)a.data[a.t++]=0;for(;--b>=0;){var _=i.data[--y]==d?this.DM:Math.floor(i.data[y]*p+(i.data[y-1]+v)*g);if((i.data[y]+=a.am(0,_,i,b,0,h))<_)for(a.dlShiftTo(b,x),i.subTo(x,i);i.data[y]<--_;)i.subTo(x,i)}null!=t&&(i.drShiftTo(h,t),l!=c&&o.ZERO.subTo(t,t)),i.t=h,i.clamp(),u>0&&i.rShiftTo(u,i),l<0&&o.ZERO.subTo(i,i)}}},o.prototype.invDigit=function(){if(this.t<1)return 0;var e=this.data[0];if(!(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},o.prototype.isEven=function(){return 0==(this.t>0?1&this.data[0]:this.s)},o.prototype.exp=function(e,t){if(e>4294967295||e<1)return o.ONE;var i=s(),n=s(),r=t.convert(this),a=m(e)-1;for(r.copyTo(i);--a>=0;)if(t.sqrTo(i,n),(e&1<<a)>0)t.mulTo(n,r,i);else{var l=i;i=n,n=l}return t.revert(i)},o.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var i,n=(1<<t)-1,r=!1,o="",s=this.t,a=this.DB-s*this.DB%t;if(s-- >0)for(a<this.DB&&(i=this.data[s]>>a)>0&&(r=!0,o=d(i));s>=0;)a<t?(i=(this.data[s]&(1<<a)-1)<<t-a,i|=this.data[--s]>>(a+=this.DB-t)):(i=this.data[s]>>(a-=t)&n,a<=0&&(a+=this.DB,--s)),i>0&&(r=!0),r&&(o+=d(i));return r?o:"0"},o.prototype.negate=function(){var e=s();return o.ZERO.subTo(this,e),e},o.prototype.abs=function(){return this.s<0?this.negate():this},o.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var i=this.t;if(0!=(t=i-e.t))return this.s<0?-t:t;for(;--i>=0;)if(0!=(t=this.data[i]-e.data[i]))return t;return 0},o.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+m(this.data[this.t-1]^this.s&this.DM)},o.prototype.mod=function(e){var t=s();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(o.ZERO)>0&&e.subTo(t,t),t},o.prototype.modPowInt=function(e,t){var i;return i=e<256||t.isEven()?new g(t):new v(t),this.exp(e,i)},o.ZERO=p(0),o.ONE=p(1),A.prototype.convert=w,A.prototype.revert=w,A.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i)},A.prototype.sqrTo=function(e,t){e.squareTo(t)},C.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=s();return e.copyTo(t),this.reduce(t),t},C.prototype.revert=function(e){return e},C.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},C.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},C.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var T=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],M=(1<<26)/T[T.length-1];o.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},o.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),i=Math.pow(e,t),n=p(i),r=s(),o=s(),a="";for(this.divRemTo(n,r,o);r.signum()>0;)a=(i+o.intValue()).toString(e).substr(1)+a,r.divRemTo(n,r,o);return o.intValue().toString(e)+a},o.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var i=this.chunkSize(t),n=Math.pow(t,i),r=!1,s=0,a=0,l=0;l<e.length;++l){var c=f(e,l);c<0?"-"==e.charAt(l)&&0==this.signum()&&(r=!0):(a=t*a+c,++s>=i&&(this.dMultiply(n),this.dAddOffset(a,0),s=0,a=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(a,0)),r&&o.ZERO.subTo(this,this)},o.prototype.fromNumber=function(e,t,i){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,i),this.testBit(e-1)||this.bitwiseTo(o.ONE.shiftLeft(e-1),b,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(o.ONE.shiftLeft(e-1),this);else{var n=new Array,r=7&e;n.length=1+(e>>3),t.nextBytes(n),r>0?n[0]&=(1<<r)-1:n[0]=0,this.fromString(n,256)}},o.prototype.bitwiseTo=function(e,t,i){var n,r,o=Math.min(e.t,this.t);for(n=0;n<o;++n)i.data[n]=t(this.data[n],e.data[n]);if(e.t<this.t){for(r=e.s&this.DM,n=o;n<this.t;++n)i.data[n]=t(this.data[n],r);i.t=this.t}else{for(r=this.s&this.DM,n=o;n<e.t;++n)i.data[n]=t(r,e.data[n]);i.t=e.t}i.s=t(this.s,e.s),i.clamp()},o.prototype.changeBit=function(e,t){var i=o.ONE.shiftLeft(e);return this.bitwiseTo(i,t,i),i},o.prototype.addTo=function(e,t){for(var i=0,n=0,r=Math.min(e.t,this.t);i<r;)n+=this.data[i]+e.data[i],t.data[i++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;i<this.t;)n+=this.data[i],t.data[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<e.t;)n+=e.data[i],t.data[i++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t.data[i++]=n:n<-1&&(t.data[i++]=this.DV+n),t.t=i,t.clamp()},o.prototype.dMultiply=function(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},o.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},o.prototype.multiplyLowerTo=function(e,t,i){var n,r=Math.min(this.t+e.t,t);for(i.s=0,i.t=r;r>0;)i.data[--r]=0;for(n=i.t-this.t;r<n;++r)i.data[r+this.t]=this.am(0,e.data[r],i,r,0,this.t);for(n=Math.min(e.t,t);r<n;++r)this.am(0,e.data[r],i,r,0,t-r);i.clamp()},o.prototype.multiplyUpperTo=function(e,t,i){--t;var n=i.t=this.t+e.t-t;for(i.s=0;--n>=0;)i.data[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)i.data[this.t+n-t]=this.am(t-n,e.data[n],i,0,0,this.t+n-t);i.clamp(),i.drShiftTo(1,i)},o.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,i=this.s<0?e-1:0;if(this.t>0)if(0==t)i=this.data[0]%e;else for(var n=this.t-1;n>=0;--n)i=(t*i+this.data[n])%e;return i},o.prototype.millerRabin=function(e){var t=this.subtract(o.ONE),i=t.getLowestSetBit();if(i<=0)return!1;for(var n,r=t.shiftRight(i),s={nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}},a=0;a<e;++a){do{n=new o(this.bitLength(),s)}while(n.compareTo(o.ONE)<=0||n.compareTo(t)>=0);var l=n.modPow(r,this);if(0!=l.compareTo(o.ONE)&&0!=l.compareTo(t)){for(var c=1;c++<i&&0!=l.compareTo(t);)if(0==(l=l.modPowInt(2,this)).compareTo(o.ONE))return!1;if(0!=l.compareTo(t))return!1}}return!0},o.prototype.clone=function(){var e=s();return this.copyTo(e),e},o.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},o.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24},o.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16},o.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},o.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var i,n=this.DB-e*this.DB%8,r=0;if(e-- >0)for(n<this.DB&&(i=this.data[e]>>n)!=(this.s&this.DM)>>n&&(t[r++]=i|this.s<<this.DB-n);e>=0;)n<8?(i=(this.data[e]&(1<<n)-1)<<8-n,i|=this.data[--e]>>(n+=this.DB-8)):(i=this.data[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),128&i&&(i|=-256),0==r&&(128&this.s)!=(128&i)&&++r,(r>0||i!=this.s)&&(t[r++]=i);return t},o.prototype.equals=function(e){return 0==this.compareTo(e)},o.prototype.min=function(e){return this.compareTo(e)<0?this:e},o.prototype.max=function(e){return this.compareTo(e)>0?this:e},o.prototype.and=function(e){var t=s();return this.bitwiseTo(e,y,t),t},o.prototype.or=function(e){var t=s();return this.bitwiseTo(e,b,t),t},o.prototype.xor=function(e){var t=s();return this.bitwiseTo(e,x,t),t},o.prototype.andNot=function(e){var t=s();return this.bitwiseTo(e,_,t),t},o.prototype.not=function(){for(var e=s(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},o.prototype.shiftLeft=function(e){var t=s();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},o.prototype.shiftRight=function(e){var t=s();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},o.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+E(this.data[e]);return this.s<0?this.t*this.DB:-1},o.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,i=0;i<this.t;++i)e+=S(this.data[i]^t);return e},o.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:!!(this.data[t]&1<<e%this.DB)},o.prototype.setBit=function(e){return this.changeBit(e,b)},o.prototype.clearBit=function(e){return this.changeBit(e,_)},o.prototype.flipBit=function(e){return this.changeBit(e,x)},o.prototype.add=function(e){var t=s();return this.addTo(e,t),t},o.prototype.subtract=function(e){var t=s();return this.subTo(e,t),t},o.prototype.multiply=function(e){var t=s();return this.multiplyTo(e,t),t},o.prototype.divide=function(e){var t=s();return this.divRemTo(e,t,null),t},o.prototype.remainder=function(e){var t=s();return this.divRemTo(e,null,t),t},o.prototype.divideAndRemainder=function(e){var t=s(),i=s();return this.divRemTo(e,t,i),new Array(t,i)},o.prototype.modPow=function(e,t){var i,n,r=e.bitLength(),o=p(1);if(r<=0)return o;i=r<18?1:r<48?3:r<144?4:r<768?5:6,n=r<8?new g(t):t.isEven()?new C(t):new v(t);var a=new Array,l=3,c=i-1,u=(1<<i)-1;if(a[1]=n.convert(this),i>1){var h=s();for(n.sqrTo(a[1],h);l<=u;)a[l]=s(),n.mulTo(h,a[l-2],a[l]),l+=2}var d,f,y=e.t-1,b=!0,x=s();for(r=m(e.data[y])-1;y>=0;){for(r>=c?d=e.data[y]>>r-c&u:(d=(e.data[y]&(1<<r+1)-1)<<c-r,y>0&&(d|=e.data[y-1]>>this.DB+r-c)),l=i;!(1&d);)d>>=1,--l;if((r-=l)<0&&(r+=this.DB,--y),b)a[d].copyTo(o),b=!1;else{for(;l>1;)n.sqrTo(o,x),n.sqrTo(x,o),l-=2;l>0?n.sqrTo(o,x):(f=o,o=x,x=f),n.mulTo(x,a[d],o)}for(;y>=0&&!(e.data[y]&1<<r);)n.sqrTo(o,x),f=o,o=x,x=f,--r<0&&(r=this.DB-1,--y)}return n.revert(o)},o.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return o.ZERO;for(var i=e.clone(),n=this.clone(),r=p(1),s=p(0),a=p(0),l=p(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),t?(r.isEven()&&s.isEven()||(r.addTo(this,r),s.subTo(e,s)),r.rShiftTo(1,r)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),t?(a.isEven()&&l.isEven()||(a.addTo(this,a),l.subTo(e,l)),a.rShiftTo(1,a)):l.isEven()||l.subTo(e,l),l.rShiftTo(1,l);i.compareTo(n)>=0?(i.subTo(n,i),t&&r.subTo(a,r),s.subTo(l,s)):(n.subTo(i,n),t&&a.subTo(r,a),l.subTo(s,l))}return 0!=n.compareTo(o.ONE)?o.ZERO:l.compareTo(e)>=0?l.subtract(e):l.signum()<0?(l.addTo(e,l),l.signum()<0?l.add(e):l):l},o.prototype.pow=function(e){return this.exp(e,new A)},o.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),i=e.s<0?e.negate():e.clone();if(t.compareTo(i)<0){var n=t;t=i,i=n}var r=t.getLowestSetBit(),o=i.getLowestSetBit();if(o<0)return t;for(r<o&&(o=r),o>0&&(t.rShiftTo(o,t),i.rShiftTo(o,i));t.signum()>0;)(r=t.getLowestSetBit())>0&&t.rShiftTo(r,t),(r=i.getLowestSetBit())>0&&i.rShiftTo(r,i),t.compareTo(i)>=0?(t.subTo(i,t),t.rShiftTo(1,t)):(i.subTo(t,i),i.rShiftTo(1,i));return o>0&&i.lShiftTo(o,i),i},o.prototype.isProbablePrime=function(e){var t,i=this.abs();if(1==i.t&&i.data[0]<=T[T.length-1]){for(t=0;t<T.length;++t)if(i.data[0]==T[t])return!0;return!1}if(i.isEven())return!1;for(t=1;t<T.length;){for(var n=T[t],r=t+1;r<T.length&&n<M;)n*=T[r++];for(n=i.modInt(n);t<r;)if(n%T[t++]==0)return!1}return i.millerRabin(e)}},83432:(e,t,i)=>{var n=i(50276);i(7619),i(89356),i(43736),e.exports=n.kem=n.kem||{};var r=n.jsbn.BigInteger;function o(e,t,i,r){e.generate=function(e,o){for(var s=new n.util.ByteBuffer,a=Math.ceil(o/r)+i,l=new n.util.ByteBuffer,c=i;c<a;++c){l.putInt32(c),t.start(),t.update(e+l.getBytes());var u=t.digest();s.putBytes(u.getBytes(r))}return s.truncate(s.length()-o),s.getBytes()}}n.kem.rsa={},n.kem.rsa.create=function(e,t){var i=(t=t||{}).prng||n.random,o={encrypt:function(t,o){var s,a=Math.ceil(t.n.bitLength()/8);do{s=new r(n.util.bytesToHex(i.getBytesSync(a)),16).mod(t.n)}while(s.compareTo(r.ONE)<=0);var l=a-(s=n.util.hexToBytes(s.toString(16))).length;return l>0&&(s=n.util.fillString(String.fromCharCode(0),l)+s),{encapsulation:t.encrypt(s,"NONE"),key:e.generate(s,o)}},decrypt:function(t,i,n){var r=t.decrypt(i,"NONE");return e.generate(r,n)}};return o},n.kem.kdf1=function(e,t){o(this,e,0,t||e.digestLength)},n.kem.kdf2=function(e,t){o(this,e,1,t||e.digestLength)}},52045:(e,t,i)=>{var n=i(50276);i(7619),e.exports=n.log=n.log||{},n.log.levels=["none","error","warning","info","debug","verbose","max"];var r={},o=[],s=null;n.log.LEVEL_LOCKED=2,n.log.NO_LEVEL_CHECK=4,n.log.INTERPOLATE=8;for(var a=0;a<n.log.levels.length;++a){var l=n.log.levels[a];r[l]={index:a,name:l.toUpperCase()}}n.log.logMessage=function(e){for(var t=r[e.level].index,i=0;i<o.length;++i){var s=o[i];if(s.flags&n.log.NO_LEVEL_CHECK)s.f(e);else t<=r[s.level].index&&s.f(s,e)}},n.log.prepareStandard=function(e){"standard"in e||(e.standard=r[e.level].name+" ["+e.category+"] "+e.message)},n.log.prepareFull=function(e){if(!("full"in e)){var t=[e.message];t=t.concat([]||0),e.full=n.util.format.apply(this,t)}},n.log.prepareStandardFull=function(e){"standardFull"in e||(n.log.prepareStandard(e),e.standardFull=e.standard)};var c=["error","warning","info","debug","verbose"];for(a=0;a<c.length;++a)!function(e){n.log[e]=function(t,i){var r=Array.prototype.slice.call(arguments).slice(2),o={timestamp:new Date,level:e,category:t,message:i,arguments:r};n.log.logMessage(o)}}(c[a]);if(n.log.makeLogger=function(e){var t={flags:0,f:e};return n.log.setLevel(t,"none"),t},n.log.setLevel=function(e,t){var i=!1;if(e&&!(e.flags&n.log.LEVEL_LOCKED))for(var r=0;r<n.log.levels.length;++r){if(t==n.log.levels[r]){e.level=t,i=!0;break}}return i},n.log.lock=function(e,t){void 0===t||t?e.flags|=n.log.LEVEL_LOCKED:e.flags&=~n.log.LEVEL_LOCKED},n.log.addLogger=function(e){o.push(e)},"undefined"!=typeof console&&"log"in console){var u;if(console.error&&console.warn&&console.info&&console.debug){var h={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},d=function(e,t){n.log.prepareStandard(t);var i=h[t.level],r=[t.standard];r=r.concat(t.arguments.slice()),i.apply(console,r)};u=n.log.makeLogger(d)}else{d=function(e,t){n.log.prepareStandardFull(t),console.log(t.standardFull)};u=n.log.makeLogger(d)}n.log.setLevel(u,"debug"),n.log.addLogger(u),s=u}else console={log:function(){}};if(null!==s&&"undefined"!=typeof window&&window.location){var f=new URL(window.location.href).searchParams;if(f.has("console.level")&&n.log.setLevel(s,f.get("console.level").slice(-1)[0]),f.has("console.lock"))"true"==f.get("console.lock").slice(-1)[0]&&n.log.lock(s)}n.log.consoleLogger=s},61355:(e,t,i)=>{e.exports=i(8106),i(1267),i(21598),i(30172),i(72313)},8106:(e,t,i)=>{var n=i(50276);e.exports=n.md=n.md||{},n.md.algorithms=n.md.algorithms||{}},1267:(e,t,i)=>{var n=i(50276);i(8106),i(7619);var r=e.exports=n.md5=n.md5||{};n.md.md5=n.md.algorithms.md5=r,r.create=function(){c||function(){o=String.fromCharCode(128),o+=n.util.fillString(String.fromCharCode(0),64),s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],a=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],l=new Array(64);for(var e=0;e<64;++e)l[e]=Math.floor(4294967296*Math.abs(Math.sin(e+1)));c=!0}();var e=null,t=n.util.createBuffer(),i=new Array(16),r={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){r.messageLength=0,r.fullMessageLength=r.messageLength64=[];for(var i=r.messageLengthSize/4,o=0;o<i;++o)r.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},r}};return r.start(),r.update=function(o,s){"utf8"===s&&(o=n.util.encodeUtf8(o));var a=o.length;r.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var l=r.fullMessageLength.length-1;l>=0;--l)r.fullMessageLength[l]+=a[1],a[1]=a[0]+(r.fullMessageLength[l]/4294967296>>>0),r.fullMessageLength[l]=r.fullMessageLength[l]>>>0,a[0]=a[1]/4294967296>>>0;return t.putBytes(o),u(e,i,t),(t.read>2048||0===t.length())&&t.compact(),r},r.digest=function(){var s=n.util.createBuffer();s.putBytes(t.bytes());var a=r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize&r.blockLength-1;s.putBytes(o.substr(0,r.blockLength-a));for(var l,c=0,h=r.fullMessageLength.length-1;h>=0;--h)c=(l=8*r.fullMessageLength[h]+c)/4294967296>>>0,s.putInt32Le(l>>>0);var d={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3};u(d,i,s);var f=n.util.createBuffer();return f.putInt32Le(d.h0),f.putInt32Le(d.h1),f.putInt32Le(d.h2),f.putInt32Le(d.h3),f},r};var o=null,s=null,a=null,l=null,c=!1;function u(e,t,i){for(var n,r,o,c,u,h,d,f=i.length();f>=64;){for(r=e.h0,o=e.h1,c=e.h2,u=e.h3,d=0;d<16;++d)t[d]=i.getInt32Le(),n=r+(u^o&(c^u))+l[d]+t[d],r=u,u=c,c=o,o+=n<<(h=a[d])|n>>>32-h;for(;d<32;++d)n=r+(c^u&(o^c))+l[d]+t[s[d]],r=u,u=c,c=o,o+=n<<(h=a[d])|n>>>32-h;for(;d<48;++d)n=r+(o^c^u)+l[d]+t[s[d]],r=u,u=c,c=o,o+=n<<(h=a[d])|n>>>32-h;for(;d<64;++d)n=r+(c^(o|~u))+l[d]+t[s[d]],r=u,u=c,c=o,o+=n<<(h=a[d])|n>>>32-h;e.h0=e.h0+r|0,e.h1=e.h1+o|0,e.h2=e.h2+c|0,e.h3=e.h3+u|0,f-=64}}},41373:(e,t,i)=>{var n=i(50276);i(45250),e.exports=n.mgf=n.mgf||{},n.mgf.mgf1=n.mgf1},45250:(e,t,i)=>{var n=i(50276);i(7619),n.mgf=n.mgf||{},(e.exports=n.mgf.mgf1=n.mgf1=n.mgf1||{}).create=function(e){return{generate:function(t,i){for(var r=new n.util.ByteBuffer,o=Math.ceil(i/e.digestLength),s=0;s<o;s++){var a=new n.util.ByteBuffer;a.putInt32(s),e.start(),e.update(t+a.getBytes()),r.putBuffer(e.digest())}return r.truncate(r.length()-i),r.getBytes()}}}},16418:(e,t,i)=>{var n=i(50276);n.pki=n.pki||{};var r=e.exports=n.pki.oids=n.oids=n.oids||{};function o(e,t){r[e]=t,r[t]=e}function s(e,t){r[e]=t}o("1.2.840.113549.1.1.1","rsaEncryption"),o("1.2.840.113549.1.1.4","md5WithRSAEncryption"),o("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),o("1.2.840.113549.1.1.7","RSAES-OAEP"),o("1.2.840.113549.1.1.8","mgf1"),o("1.2.840.113549.1.1.9","pSpecified"),o("1.2.840.113549.1.1.10","RSASSA-PSS"),o("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),o("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),o("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),o("1.3.101.112","EdDSA25519"),o("1.2.840.10040.4.3","dsa-with-sha1"),o("1.3.14.3.2.7","desCBC"),o("1.3.14.3.2.26","sha1"),o("1.3.14.3.2.29","sha1WithRSASignature"),o("2.16.840.1.101.3.4.2.1","sha256"),o("2.16.840.1.101.3.4.2.2","sha384"),o("2.16.840.1.101.3.4.2.3","sha512"),o("2.16.840.1.101.3.4.2.4","sha224"),o("2.16.840.1.101.3.4.2.5","sha512-224"),o("2.16.840.1.101.3.4.2.6","sha512-256"),o("1.2.840.113549.2.2","md2"),o("1.2.840.113549.2.5","md5"),o("1.2.840.113549.1.7.1","data"),o("1.2.840.113549.1.7.2","signedData"),o("1.2.840.113549.1.7.3","envelopedData"),o("1.2.840.113549.1.7.4","signedAndEnvelopedData"),o("1.2.840.113549.1.7.5","digestedData"),o("1.2.840.113549.1.7.6","encryptedData"),o("1.2.840.113549.1.9.1","emailAddress"),o("1.2.840.113549.1.9.2","unstructuredName"),o("1.2.840.113549.1.9.3","contentType"),o("1.2.840.113549.1.9.4","messageDigest"),o("1.2.840.113549.1.9.5","signingTime"),o("1.2.840.113549.1.9.6","counterSignature"),o("1.2.840.113549.1.9.7","challengePassword"),o("1.2.840.113549.1.9.8","unstructuredAddress"),o("1.2.840.113549.1.9.14","extensionRequest"),o("1.2.840.113549.1.9.20","friendlyName"),o("1.2.840.113549.1.9.21","localKeyId"),o("1.2.840.113549.1.9.22.1","x509Certificate"),o("1.2.840.113549.1.12.10.1.1","keyBag"),o("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),o("1.2.840.113549.1.12.10.1.3","certBag"),o("1.2.840.113549.1.12.10.1.4","crlBag"),o("1.2.840.113549.1.12.10.1.5","secretBag"),o("1.2.840.113549.1.12.10.1.6","safeContentsBag"),o("1.2.840.113549.1.5.13","pkcs5PBES2"),o("1.2.840.113549.1.5.12","pkcs5PBKDF2"),o("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),o("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),o("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),o("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),o("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),o("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),o("1.2.840.113549.2.7","hmacWithSHA1"),o("1.2.840.113549.2.8","hmacWithSHA224"),o("1.2.840.113549.2.9","hmacWithSHA256"),o("1.2.840.113549.2.10","hmacWithSHA384"),o("1.2.840.113549.2.11","hmacWithSHA512"),o("1.2.840.113549.3.7","des-EDE3-CBC"),o("2.16.840.1.101.3.4.1.2","aes128-CBC"),o("2.16.840.1.101.3.4.1.22","aes192-CBC"),o("2.16.840.1.101.3.4.1.42","aes256-CBC"),o("2.5.4.3","commonName"),o("2.5.4.4","surname"),o("2.5.4.5","serialNumber"),o("2.5.4.6","countryName"),o("2.5.4.7","localityName"),o("2.5.4.8","stateOrProvinceName"),o("2.5.4.9","streetAddress"),o("2.5.4.10","organizationName"),o("2.5.4.11","organizationalUnitName"),o("2.5.4.12","title"),o("2.5.4.13","description"),o("2.5.4.15","businessCategory"),o("2.5.4.17","postalCode"),o("2.5.4.42","givenName"),o("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),o("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),o("2.16.840.1.113730.1.1","nsCertType"),o("2.16.840.1.113730.1.13","nsComment"),s("2.5.29.1","authorityKeyIdentifier"),s("2.5.29.2","keyAttributes"),s("2.5.29.3","certificatePolicies"),s("2.5.29.4","keyUsageRestriction"),s("2.5.29.5","policyMapping"),s("2.5.29.6","subtreesConstraint"),s("2.5.29.7","subjectAltName"),s("2.5.29.8","issuerAltName"),s("2.5.29.9","subjectDirectoryAttributes"),s("2.5.29.10","basicConstraints"),s("2.5.29.11","nameConstraints"),s("2.5.29.12","policyConstraints"),s("2.5.29.13","basicConstraints"),o("2.5.29.14","subjectKeyIdentifier"),o("2.5.29.15","keyUsage"),s("2.5.29.16","privateKeyUsagePeriod"),o("2.5.29.17","subjectAltName"),o("2.5.29.18","issuerAltName"),o("2.5.29.19","basicConstraints"),s("2.5.29.20","cRLNumber"),s("2.5.29.21","cRLReason"),s("2.5.29.22","expirationDate"),s("2.5.29.23","instructionCode"),s("2.5.29.24","invalidityDate"),s("2.5.29.25","cRLDistributionPoints"),s("2.5.29.26","issuingDistributionPoint"),s("2.5.29.27","deltaCRLIndicator"),s("2.5.29.28","issuingDistributionPoint"),s("2.5.29.29","certificateIssuer"),s("2.5.29.30","nameConstraints"),o("2.5.29.31","cRLDistributionPoints"),o("2.5.29.32","certificatePolicies"),s("2.5.29.33","policyMappings"),s("2.5.29.34","policyConstraints"),o("2.5.29.35","authorityKeyIdentifier"),s("2.5.29.36","policyConstraints"),o("2.5.29.37","extKeyUsage"),s("2.5.29.46","freshestCRL"),s("2.5.29.54","inhibitAnyPolicy"),o("1.3.6.1.4.1.11129.2.4.2","timestampList"),o("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),o("1.3.6.1.5.5.7.3.1","serverAuth"),o("1.3.6.1.5.5.7.3.2","clientAuth"),o("1.3.6.1.5.5.7.3.3","codeSigning"),o("1.3.6.1.5.5.7.3.4","emailProtection"),o("1.3.6.1.5.5.7.3.8","timeStamping")},12698:(e,t,i)=>{var n=i(50276);if(i(39504),i(12746),i(19095),i(8106),i(16418),i(3254),i(2385),i(89356),i(55124),i(15805),i(7619),void 0===r)var r=n.jsbn.BigInteger;var o=n.asn1,s=n.pki=n.pki||{};e.exports=s.pbe=n.pbe=n.pbe||{};var a=s.oids,l={name:"EncryptedPrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},c={name:"PBES2Algorithms",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},u={name:"pkcs-12PbeParams",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"iterations"}]};function h(e,t){return e.start().update(t).digest().getBytes()}function d(e){var t;if(e){if(!(t=s.oids[o.derToOid(e)])){var i=new Error("Unsupported PRF OID.");throw i.oid=e,i.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],i}}else t="hmacWithSHA1";return f(t)}function f(e){var t=n.md;switch(e){case"hmacWithSHA224":t=n.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var i=new Error("Unsupported PRF algorithm.");throw i.algorithm=e,i.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],i}if(!t||!(e in t))throw new Error("Unknown hash algorithm: "+e);return t[e].create()}s.encryptPrivateKeyInfo=function(e,t,i){(i=i||{}).saltSize=i.saltSize||8,i.count=i.count||2048,i.algorithm=i.algorithm||"aes128",i.prfAlgorithm=i.prfAlgorithm||"sha1";var r,l,c,u=n.random.getBytesSync(i.saltSize),h=i.count,d=o.integerToDer(h);if(0===i.algorithm.indexOf("aes")||"des"===i.algorithm){var p,m,g;switch(i.algorithm){case"aes128":r=16,p=16,m=a["aes128-CBC"],g=n.aes.createEncryptionCipher;break;case"aes192":r=24,p=16,m=a["aes192-CBC"],g=n.aes.createEncryptionCipher;break;case"aes256":r=32,p=16,m=a["aes256-CBC"],g=n.aes.createEncryptionCipher;break;case"des":r=8,p=8,m=a.desCBC,g=n.des.createEncryptionCipher;break;default:throw(E=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=i.algorithm,E}var v="hmacWith"+i.prfAlgorithm.toUpperCase(),y=f(v),b=n.pkcs5.pbkdf2(t,u,h,r,y),x=n.random.getBytesSync(p);(S=g(b)).start(x),S.update(o.toDer(e)),S.finish(),c=S.output.getBytes();var _=function(e,t,i,r){var a=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,e),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,t.getBytes())]);"hmacWithSHA1"!==r&&a.value.push(o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,n.util.hexToBytes(i.toString(16))),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(s.oids[r]).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]));return a}(u,d,r,v);l=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(a.pkcs5PBES2).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(a.pkcs5PBKDF2).getBytes()),_]),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(m).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,x)])])])}else{var E;if("3des"!==i.algorithm)throw(E=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=i.algorithm,E;r=24;var S,A=new n.util.ByteBuffer(u);b=s.pbe.generatePkcs12Key(t,A,1,h,r),x=s.pbe.generatePkcs12Key(t,A,2,h,r);(S=n.des.createEncryptionCipher(b)).start(x),S.update(o.toDer(e)),S.finish(),c=S.output.getBytes(),l=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(a["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,u),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,d.getBytes())])])}return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[l,o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,c)])},s.decryptPrivateKeyInfo=function(e,t){var i=null,r={},a=[];if(!o.validate(e,l,r,a)){var c=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw c.errors=a,c}var u=o.derToOid(r.encryptionOid),h=s.pbe.getCipher(u,r.encryptionParams,t),d=n.util.createBuffer(r.encryptedData);return h.update(d),h.finish()&&(i=o.fromDer(h.output)),i},s.encryptedPrivateKeyToPem=function(e,t){var i={type:"ENCRYPTED PRIVATE KEY",body:o.toDer(e).getBytes()};return n.pem.encode(i,{maxline:t})},s.encryptedPrivateKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var i=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw i.headerType=t.type,i}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return o.fromDer(t.body)},s.encryptRsaPrivateKey=function(e,t,i){if(!(i=i||{}).legacy){var r=s.wrapRsaPrivateKey(s.privateKeyToAsn1(e));return r=s.encryptPrivateKeyInfo(r,t,i),s.encryptedPrivateKeyToPem(r)}var a,l,c,u;switch(i.algorithm){case"aes128":a="AES-128-CBC",c=16,l=n.random.getBytesSync(16),u=n.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",c=24,l=n.random.getBytesSync(16),u=n.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",c=32,l=n.random.getBytesSync(16),u=n.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",c=24,l=n.random.getBytesSync(8),u=n.des.createEncryptionCipher;break;case"des":a="DES-CBC",c=8,l=n.random.getBytesSync(8),u=n.des.createEncryptionCipher;break;default:var h=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+i.algorithm+'".');throw h.algorithm=i.algorithm,h}var d=u(n.pbe.opensslDeriveBytes(t,l.substr(0,8),c));d.start(l),d.update(o.toDer(s.privateKeyToAsn1(e))),d.finish();var f={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:n.util.bytesToHex(l).toUpperCase()},body:d.output.getBytes()};return n.pem.encode(f)},s.decryptRsaPrivateKey=function(e,t){var i=null,r=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==r.type&&"PRIVATE KEY"!==r.type&&"RSA PRIVATE KEY"!==r.type)throw(c=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=c,c;if(r.procType&&"ENCRYPTED"===r.procType.type){var a,l;switch(r.dekInfo.algorithm){case"DES-CBC":a=8,l=n.des.createDecryptionCipher;break;case"DES-EDE3-CBC":a=24,l=n.des.createDecryptionCipher;break;case"AES-128-CBC":a=16,l=n.aes.createDecryptionCipher;break;case"AES-192-CBC":a=24,l=n.aes.createDecryptionCipher;break;case"AES-256-CBC":a=32,l=n.aes.createDecryptionCipher;break;case"RC2-40-CBC":a=5,l=function(e){return n.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":a=8,l=function(e){return n.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":a=16,l=function(e){return n.rc2.createDecryptionCipher(e,128)};break;default:var c;throw(c=new Error('Could not decrypt private key; unsupported encryption algorithm "'+r.dekInfo.algorithm+'".')).algorithm=r.dekInfo.algorithm,c}var u=n.util.hexToBytes(r.dekInfo.parameters),h=l(n.pbe.opensslDeriveBytes(t,u.substr(0,8),a));if(h.start(u),h.update(n.util.createBuffer(r.body)),!h.finish())return i;i=h.output.getBytes()}else i=r.body;return null!==(i="ENCRYPTED PRIVATE KEY"===r.type?s.decryptPrivateKeyInfo(o.fromDer(i),t):o.fromDer(i))&&(i=s.privateKeyFromAsn1(i)),i},s.pbe.generatePkcs12Key=function(e,t,i,r,o,s){var a,l;if(null==s){if(!("sha1"in n.md))throw new Error('"sha1" hash algorithm unavailable.');s=n.md.sha1.create()}var c=s.digestLength,u=s.blockLength,h=new n.util.ByteBuffer,d=new n.util.ByteBuffer;if(null!=e){for(l=0;l<e.length;l++)d.putInt16(e.charCodeAt(l));d.putInt16(0)}var f=d.length(),p=t.length(),m=new n.util.ByteBuffer;m.fillWithByte(i,u);var g=u*Math.ceil(p/u),v=new n.util.ByteBuffer;for(l=0;l<g;l++)v.putByte(t.at(l%p));var y=u*Math.ceil(f/u),b=new n.util.ByteBuffer;for(l=0;l<y;l++)b.putByte(d.at(l%f));var x=v;x.putBuffer(b);for(var _=Math.ceil(o/c),E=1;E<=_;E++){var S=new n.util.ByteBuffer;S.putBytes(m.bytes()),S.putBytes(x.bytes());for(var A=0;A<r;A++)s.start(),s.update(S.getBytes()),S=s.digest();var w=new n.util.ByteBuffer;for(l=0;l<u;l++)w.putByte(S.at(l%c));var C=Math.ceil(p/u)+Math.ceil(f/u),T=new n.util.ByteBuffer;for(a=0;a<C;a++){var M=new n.util.ByteBuffer(x.getBytes(u)),I=511;for(l=w.length()-1;l>=0;l--)I>>=8,I+=w.at(l)+M.at(l),M.setAt(l,255&I);T.putBuffer(M)}x=T,h.putBuffer(S)}return h.truncate(h.length()-o),h},s.pbe.getCipher=function(e,t,i){switch(e){case s.oids.pkcs5PBES2:return s.pbe.getCipherForPBES2(e,t,i);case s.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case s.oids["pbewithSHAAnd40BitRC2-CBC"]:return s.pbe.getCipherForPKCS12PBE(e,t,i);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=e,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}},s.pbe.getCipherForPBES2=function(e,t,i){var r,a={},l=[];if(!o.validate(t,c,a,l))throw(r=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=l,r;if((e=o.derToOid(a.kdfOid))!==s.oids.pkcs5PBKDF2)throw(r=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,r.supportedOids=["pkcs5PBKDF2"],r;if((e=o.derToOid(a.encOid))!==s.oids["aes128-CBC"]&&e!==s.oids["aes192-CBC"]&&e!==s.oids["aes256-CBC"]&&e!==s.oids["des-EDE3-CBC"]&&e!==s.oids.desCBC)throw(r=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,r.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],r;var u,h,f=a.kdfSalt,p=n.util.createBuffer(a.kdfIterationCount);switch(p=p.getInt(p.length()<<3),s.oids[e]){case"aes128-CBC":u=16,h=n.aes.createDecryptionCipher;break;case"aes192-CBC":u=24,h=n.aes.createDecryptionCipher;break;case"aes256-CBC":u=32,h=n.aes.createDecryptionCipher;break;case"des-EDE3-CBC":u=24,h=n.des.createDecryptionCipher;break;case"desCBC":u=8,h=n.des.createDecryptionCipher}var m=d(a.prfOid),g=n.pkcs5.pbkdf2(i,f,p,u,m),v=a.encIv,y=h(g);return y.start(v),y},s.pbe.getCipherForPKCS12PBE=function(e,t,i){var r={},a=[];if(!o.validate(t,u,r,a))throw(m=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=a,m;var l,c,h,f=n.util.createBuffer(r.salt),p=n.util.createBuffer(r.iterations);switch(p=p.getInt(p.length()<<3),e){case s.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:l=24,c=8,h=n.des.startDecrypting;break;case s.oids["pbewithSHAAnd40BitRC2-CBC"]:l=5,c=8,h=function(e,t){var i=n.rc2.createDecryptionCipher(e,40);return i.start(t,null),i};break;default:var m;throw(m=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,m}var g=d(r.prfOid),v=s.pbe.generatePkcs12Key(i,f,1,p,l,g);return g.start(),h(v,s.pbe.generatePkcs12Key(i,f,2,p,c,g))},s.pbe.opensslDeriveBytes=function(e,t,i,r){if(null==r){if(!("md5"in n.md))throw new Error('"md5" hash algorithm unavailable.');r=n.md.md5.create()}null===t&&(t="");for(var o=[h(r,e+t)],s=16,a=1;s<i;++a,s+=16)o.push(h(r,o[a-1]+e+t));return o.join("").substr(0,i)}},3254:(e,t,i)=>{var n=i(50276);i(71696),i(8106),i(7619);var r,o=n.pkcs5=n.pkcs5||{};n.util.isNodejs&&!n.options.usePureJavaScript&&(r=i(50310)),e.exports=n.pbkdf2=o.pbkdf2=function(e,t,i,o,s,a){if("function"==typeof s&&(a=s,s=null),n.util.isNodejs&&!n.options.usePureJavaScript&&r.pbkdf2&&(null===s||"object"!=typeof s)&&(r.pbkdf2Sync.length>4||!s||"sha1"===s))return"string"!=typeof s&&(s="sha1"),e=Buffer.from(e,"binary"),t=Buffer.from(t,"binary"),a?4===r.pbkdf2Sync.length?r.pbkdf2(e,t,i,o,(function(e,t){if(e)return a(e);a(null,t.toString("binary"))})):r.pbkdf2(e,t,i,o,s,(function(e,t){if(e)return a(e);a(null,t.toString("binary"))})):4===r.pbkdf2Sync.length?r.pbkdf2Sync(e,t,i,o).toString("binary"):r.pbkdf2Sync(e,t,i,o,s).toString("binary");if(null==s&&(s="sha1"),"string"==typeof s){if(!(s in n.md.algorithms))throw new Error("Unknown hash algorithm: "+s);s=n.md[s].create()}var l=s.digestLength;if(o>4294967295*l){var c=new Error("Derived key is too long.");if(a)return a(c);throw c}var u=Math.ceil(o/l),h=o-(u-1)*l,d=n.hmac.create();d.start(s,e);var f,p,m,g="";if(!a){for(var v=1;v<=u;++v){d.start(null,null),d.update(t),d.update(n.util.int32ToBytes(v)),f=m=d.digest().getBytes();for(var y=2;y<=i;++y)d.start(null,null),d.update(m),p=d.digest().getBytes(),f=n.util.xorBytes(f,p,l),m=p;g+=v<u?f:f.substr(0,h)}return g}v=1;function b(){if(v>u)return a(null,g);d.start(null,null),d.update(t),d.update(n.util.int32ToBytes(v)),f=m=d.digest().getBytes(),y=2,x()}function x(){if(y<=i)return d.start(null,null),d.update(m),p=d.digest().getBytes(),f=n.util.xorBytes(f,p,l),m=p,++y,n.util.setImmediate(x);g+=v<u?f:f.substr(0,h),++v,b()}b()}},2385:(e,t,i)=>{var n=i(50276);i(7619);var r=e.exports=n.pem=n.pem||{};function o(e){for(var t=e.name+": ",i=[],n=function(e,t){return" "+t},r=0;r<e.values.length;++r)i.push(e.values[r].replace(/^(\S+\r\n)/,n));t+=i.join(",")+"\r\n";var o=0,s=-1;for(r=0;r<t.length;++r,++o)if(o>65&&-1!==s){var a=t[s];","===a?(++s,t=t.substr(0,s)+"\r\n "+t.substr(s)):t=t.substr(0,s)+"\r\n"+a+t.substr(s+1),o=r-s-1,s=-1,++r}else" "!==t[r]&&"\t"!==t[r]&&","!==t[r]||(s=r);return t}function s(e){return e.replace(/^\s+/,"")}r.encode=function(e,t){t=t||{};var i,r="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(r+=o(i={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(r+=o(i={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(i={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&i.values.push(e.dekInfo.parameters),r+=o(i)),e.headers)for(var s=0;s<e.headers.length;++s)r+=o(e.headers[s]);return e.procType&&(r+="\r\n"),r+=n.util.encode64(e.body,t.maxline||64)+"\r\n",r+="-----END "+e.type+"-----\r\n"},r.decode=function(e){for(var t,i=[],r=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,o=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,a=/\r?\n/;t=r.exec(e);){var l=t[1];"NEW CERTIFICATE REQUEST"===l&&(l="CERTIFICATE REQUEST");var c={type:l,procType:null,contentDomain:null,dekInfo:null,headers:[],body:n.util.decode64(t[3])};if(i.push(c),t[2]){for(var u=t[2].split(a),h=0;t&&h<u.length;){for(var d=u[h].replace(/\s+$/,""),f=h+1;f<u.length;++f){var p=u[f];if(!/\s/.test(p[0]))break;d+=p,h=f}if(t=d.match(o)){for(var m={name:t[1],values:[]},g=t[2].split(","),v=0;v<g.length;++v)m.values.push(s(g[v]));if(c.procType)if(c.contentDomain||"Content-Domain"!==m.name)if(c.dekInfo||"DEK-Info"!==m.name)c.headers.push(m);else{if(0===m.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');c.dekInfo={algorithm:g[0],parameters:g[1]||null}}else c.contentDomain=g[0]||"";else{if("Proc-Type"!==m.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==m.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');c.procType={version:g[0],type:g[1]}}}++h}if("ENCRYPTED"===c.procType&&!c.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===i.length)throw new Error("Invalid PEM formatted message.");return i}},47501:(e,t,i)=>{var n=i(50276);i(7619),i(89356),i(21598);var r=e.exports=n.pkcs1=n.pkcs1||{};function o(e,t,i){i||(i=n.md.sha1.create());for(var r="",o=Math.ceil(t/i.digestLength),s=0;s<o;++s){var a=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,255&s);i.start(),i.update(e+a),r+=i.digest().getBytes()}return r.substring(0,t)}r.encode_rsa_oaep=function(e,t,i){var r,s,a,l;"string"==typeof i?(r=i,s=arguments[3]||void 0,a=arguments[4]||void 0):i&&(r=i.label||void 0,s=i.seed||void 0,a=i.md||void 0,i.mgf1&&i.mgf1.md&&(l=i.mgf1.md)),a?a.start():a=n.md.sha1.create(),l||(l=a);var c=Math.ceil(e.n.bitLength()/8),u=c-2*a.digestLength-2;if(t.length>u)throw(g=new Error("RSAES-OAEP input message length is too long.")).length=t.length,g.maxLength=u,g;r||(r=""),a.update(r,"raw");for(var h=a.digest(),d="",f=u-t.length,p=0;p<f;p++)d+="\0";var m=h.getBytes()+d+""+t;if(s){if(s.length!==a.digestLength){var g;throw(g=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=s.length,g.digestLength=a.digestLength,g}}else s=n.random.getBytes(a.digestLength);var v=o(s,c-a.digestLength-1,l),y=n.util.xorBytes(m,v,m.length),b=o(y,a.digestLength,l);return"\0"+n.util.xorBytes(s,b,s.length)+y},r.decode_rsa_oaep=function(e,t,i){var r,s,a;"string"==typeof i?(r=i,s=arguments[3]||void 0):i&&(r=i.label||void 0,s=i.md||void 0,i.mgf1&&i.mgf1.md&&(a=i.mgf1.md));var l=Math.ceil(e.n.bitLength()/8);if(t.length!==l)throw(v=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,v.expectedLength=l,v;if(void 0===s?s=n.md.sha1.create():s.start(),a||(a=s),l<2*s.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");r||(r=""),s.update(r,"raw");for(var c=s.digest().getBytes(),u=t.charAt(0),h=t.substring(1,s.digestLength+1),d=t.substring(1+s.digestLength),f=o(d,s.digestLength,a),p=o(n.util.xorBytes(h,f,h.length),l-s.digestLength-1,a),m=n.util.xorBytes(d,p,d.length),g=m.substring(0,s.digestLength),v="\0"!==u,y=0;y<s.digestLength;++y)v|=c.charAt(y)!==g.charAt(y);for(var b=1,x=s.digestLength,_=s.digestLength;_<m.length;_++){var E=m.charCodeAt(_);v|=E&(b?65534:0),x+=b&=1&E^1}if(v||1!==m.charCodeAt(x))throw new Error("Invalid RSAES-OAEP padding.");return m.substring(x+1)}},55071:(e,t,i)=>{var n=i(50276);i(12746),i(71696),i(16418),i(39954),i(12698),i(89356),i(15805),i(21598),i(7619),i(66011);var r=n.asn1,o=n.pki,s=e.exports=n.pkcs12=n.pkcs12||{},a={name:"ContentInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:r.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},l={name:"PFX",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"version"},a,{name:"PFX.macData",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:r.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:r.Class.UNIVERSAL,type:r.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:r.Class.UNIVERSAL,type:r.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},c={name:"SafeBag",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:r.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:r.Class.UNIVERSAL,type:r.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},u={name:"Attribute",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:r.Class.UNIVERSAL,type:r.Type.SET,constructed:!0,capture:"values"}]},h={name:"CertBag",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:r.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:r.Class.UNIVERSAL,type:r.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};function d(e,t,i,n){for(var r=[],o=0;o<e.length;o++)for(var s=0;s<e[o].safeBags.length;s++){var a=e[o].safeBags[s];void 0!==n&&a.type!==n||(null!==t?void 0!==a.attributes[t]&&a.attributes[t].indexOf(i)>=0&&r.push(a):r.push(a))}return r}function f(e){if(e.composed||e.constructed){for(var t=n.util.createBuffer(),i=0;i<e.value.length;++i)t.putBytes(e.value[i].value);e.composed=e.constructed=!1,e.value=t.getBytes()}return e}function p(e,t){var i={},s=[];if(!r.validate(e,n.pkcs7.asn1.encryptedDataValidator,i,s))throw(a=new Error("Cannot read EncryptedContentInfo.")).errors=s,a;var a,l=r.derToOid(i.contentType);if(l!==o.oids.data)throw(a=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.")).oid=l,a;l=r.derToOid(i.encAlgorithm);var c=o.pbe.getCipher(l,i.encParameter,t),u=f(i.encryptedContentAsn1),h=n.util.createBuffer(u.value);if(c.update(h),!c.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return c.output.getBytes()}function m(e,t,i){if(!t&&0===e.length)return[];if((e=r.fromDer(e,t)).tagClass!==r.Class.UNIVERSAL||e.type!==r.Type.SEQUENCE||!0!==e.constructed)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var n=[],s=0;s<e.value.length;s++){var a=e.value[s],l={},u=[];if(!r.validate(a,c,l,u))throw(v=new Error("Cannot read SafeBag.")).errors=u,v;var d,f,p={type:r.derToOid(l.bagId),attributes:g(l.bagAttributes)};n.push(p);var m=l.bagValue.value[0];switch(p.type){case o.oids.pkcs8ShroudedKeyBag:if(null===(m=o.decryptPrivateKeyInfo(m,i)))throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case o.oids.keyBag:try{p.key=o.privateKeyFromAsn1(m)}catch(e){p.key=null,p.asn1=m}continue;case o.oids.certBag:d=h,f=function(){if(r.derToOid(l.certId)!==o.oids.x509Certificate){var e=new Error("Unsupported certificate type, only X.509 supported.");throw e.oid=r.derToOid(l.certId),e}var i=r.fromDer(l.cert,t);try{p.cert=o.certificateFromAsn1(i,!0)}catch(e){p.cert=null,p.asn1=i}};break;default:var v;throw(v=new Error("Unsupported PKCS#12 SafeBag type.")).oid=p.type,v}if(void 0!==d&&!r.validate(m,d,l,u))throw(v=new Error("Cannot read PKCS#12 "+d.name)).errors=u,v;f()}return n}function g(e){var t={};if(void 0!==e)for(var i=0;i<e.length;++i){var n={},s=[];if(!r.validate(e[i],u,n,s)){var a=new Error("Cannot read PKCS#12 BagAttribute.");throw a.errors=s,a}var l=r.derToOid(n.oid);if(void 0!==o.oids[l]){t[o.oids[l]]=[];for(var c=0;c<n.values.length;++c)t[o.oids[l]].push(n.values[c].value)}}return t}s.pkcs12FromAsn1=function(e,t,i){"string"==typeof t?(i=t,t=!0):void 0===t&&(t=!0);var c={};if(!r.validate(e,l,c,[]))throw(u=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.")).errors=u,u;var u,h={version:c.version.charCodeAt(0),safeContents:[],getBags:function(e){var t,i={};return"localKeyId"in e?t=e.localKeyId:"localKeyIdHex"in e&&(t=n.util.hexToBytes(e.localKeyIdHex)),void 0===t&&!("friendlyName"in e)&&"bagType"in e&&(i[e.bagType]=d(h.safeContents,null,null,e.bagType)),void 0!==t&&(i.localKeyId=d(h.safeContents,"localKeyId",t,e.bagType)),"friendlyName"in e&&(i.friendlyName=d(h.safeContents,"friendlyName",e.friendlyName,e.bagType)),i},getBagsByFriendlyName:function(e,t){return d(h.safeContents,"friendlyName",e,t)},getBagsByLocalKeyId:function(e,t){return d(h.safeContents,"localKeyId",e,t)}};if(3!==c.version.charCodeAt(0))throw(u=new Error("PKCS#12 PFX of version other than 3 not supported.")).version=c.version.charCodeAt(0),u;if(r.derToOid(c.contentType)!==o.oids.data)throw(u=new Error("Only PKCS#12 PFX in password integrity mode supported.")).oid=r.derToOid(c.contentType),u;var g=c.content.value[0];if(g.tagClass!==r.Class.UNIVERSAL||g.type!==r.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(g=f(g),c.mac){var v=null,y=0,b=r.derToOid(c.macAlgorithm);switch(b){case o.oids.sha1:v=n.md.sha1.create(),y=20;break;case o.oids.sha256:v=n.md.sha256.create(),y=32;break;case o.oids.sha384:v=n.md.sha384.create(),y=48;break;case o.oids.sha512:v=n.md.sha512.create(),y=64;break;case o.oids.md5:v=n.md.md5.create(),y=16}if(null===v)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+b);var x=new n.util.ByteBuffer(c.macSalt),_="macIterations"in c?parseInt(n.util.bytesToHex(c.macIterations),16):1,E=s.generateKey(i,x,3,_,y,v),S=n.hmac.create();if(S.start(v,E),S.update(g.value),S.getMac().getBytes()!==c.macDigest)throw new Error("PKCS#12 MAC could not be verified. Invalid password?")}return function(e,t,i,n){if(t=r.fromDer(t,i),t.tagClass!==r.Class.UNIVERSAL||t.type!==r.Type.SEQUENCE||!0!==t.constructed)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var s=0;s<t.value.length;s++){var l=t.value[s],c={},u=[];if(!r.validate(l,a,c,u))throw(v=new Error("Cannot read ContentInfo.")).errors=u,v;var h={encrypted:!1},d=null,g=c.content.value[0];switch(r.derToOid(c.contentType)){case o.oids.data:if(g.tagClass!==r.Class.UNIVERSAL||g.type!==r.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");d=f(g).value;break;case o.oids.encryptedData:d=p(g,n),h.encrypted=!0;break;default:var v;throw(v=new Error("Unsupported PKCS#12 contentType.")).contentType=r.derToOid(c.contentType),v}h.safeBags=m(d,i,n),e.safeContents.push(h)}}(h,g.value,t,i),h},s.toPkcs12Asn1=function(e,t,i,a){(a=a||{}).saltSize=a.saltSize||8,a.count=a.count||2048,a.algorithm=a.algorithm||a.encAlgorithm||"aes128","useMac"in a||(a.useMac=!0),"localKeyId"in a||(a.localKeyId=null),"generateLocalKeyId"in a||(a.generateLocalKeyId=!0);var l,c=a.localKeyId;if(null!==c)c=n.util.hexToBytes(c);else if(a.generateLocalKeyId)if(t){var u=n.util.isArray(t)?t[0]:t;"string"==typeof u&&(u=o.certificateFromPem(u)),(T=n.md.sha1.create()).update(r.toDer(o.certificateToAsn1(u)).getBytes()),c=T.digest().getBytes()}else c=n.random.getBytes(20);var h=[];null!==c&&h.push(r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.localKeyId).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SET,!0,[r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,c)])])),"friendlyName"in a&&h.push(r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.friendlyName).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SET,!0,[r.create(r.Class.UNIVERSAL,r.Type.BMPSTRING,!1,a.friendlyName)])])),h.length>0&&(l=r.create(r.Class.UNIVERSAL,r.Type.SET,!0,h));var d=[],f=[];null!==t&&(f=n.util.isArray(t)?t:[t]);for(var p=[],m=0;m<f.length;++m){"string"==typeof(t=f[m])&&(t=o.certificateFromPem(t));var g=0===m?l:void 0,v=o.certificateToAsn1(t),y=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.certBag).getBytes()),r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.x509Certificate).getBytes()),r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,r.toDer(v).getBytes())])])]),g]);p.push(y)}if(p.length>0){var b=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,p),x=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.data).getBytes()),r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,r.toDer(b).getBytes())])]);d.push(x)}var _=null;if(null!==e){var E=o.wrapRsaPrivateKey(o.privateKeyToAsn1(e));_=null===i?r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.keyBag).getBytes()),r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[E]),l]):r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.pkcs8ShroudedKeyBag).getBytes()),r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[o.encryptPrivateKeyInfo(E,i,a)]),l]);var S=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[_]),A=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.data).getBytes()),r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,r.toDer(S).getBytes())])]);d.push(A)}var w,C=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,d);if(a.useMac){var T=n.md.sha1.create(),M=new n.util.ByteBuffer(n.random.getBytes(a.saltSize)),I=a.count,P=(e=s.generateKey(i,M,3,I,20),n.hmac.create());P.start(T,e),P.update(r.toDer(C).getBytes());var L=P.getMac();w=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.sha1).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")]),r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,L.getBytes())]),r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,M.getBytes()),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(I).getBytes())])}return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(3).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(o.oids.data).getBytes()),r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,r.toDer(C).getBytes())])]),w])},s.generateKey=n.pbe.generatePkcs12Key},59343:(e,t,i)=>{var n=i(50276);i(39504),i(12746),i(19095),i(16418),i(2385),i(39954),i(89356),i(7619),i(66011);var r=n.asn1,o=e.exports=n.pkcs7=n.pkcs7||{};function s(e){var t={},i=[];if(!r.validate(e,o.asn1.recipientInfoValidator,t,i)){var s=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw s.errors=i,s}return{version:t.version.charCodeAt(0),issuer:n.pki.RDNAttributesAsArray(t.issuer),serialNumber:n.util.createBuffer(t.serial).toHex(),encryptedContent:{algorithm:r.derToOid(t.encAlgorithm),parameter:t.encParameter?t.encParameter.value:void 0,content:t.encKey}}}function a(e){for(var t,i=[],o=0;o<e.length;++o)i.push((t=e[o],r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(t.version).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[n.pki.distinguishedNameToAsn1({attributes:t.issuer}),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,n.util.hexToBytes(t.serialNumber))]),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(t.encryptedContent.algorithm).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")]),r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,t.encryptedContent.content)])));return i}function l(e){var t=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(e.version).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[n.pki.distinguishedNameToAsn1({attributes:e.issuer}),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,n.util.hexToBytes(e.serialNumber))]),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.digestAlgorithm).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")])]);if(e.authenticatedAttributesAsn1&&t.value.push(e.authenticatedAttributesAsn1),t.value.push(r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.signatureAlgorithm).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")])),t.value.push(r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,e.signature)),e.unauthenticatedAttributes.length>0){for(var i=r.create(r.Class.CONTEXT_SPECIFIC,1,!0,[]),o=0;o<e.unauthenticatedAttributes.length;++o){var s=e.unauthenticatedAttributes[o];i.values.push(c(s))}t.value.push(i)}return t}function c(e){var t;if(e.type===n.pki.oids.contentType)t=r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.value).getBytes());else if(e.type===n.pki.oids.messageDigest)t=r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,e.value.bytes());else if(e.type===n.pki.oids.signingTime){var i=new Date("1950-01-01T00:00:00Z"),o=new Date("2050-01-01T00:00:00Z"),s=e.value;if("string"==typeof s){var a=Date.parse(s);s=isNaN(a)?13===s.length?r.utcTimeToDate(s):r.generalizedTimeToDate(s):new Date(a)}t=s>=i&&s<o?r.create(r.Class.UNIVERSAL,r.Type.UTCTIME,!1,r.dateToUtcTime(s)):r.create(r.Class.UNIVERSAL,r.Type.GENERALIZEDTIME,!1,r.dateToGeneralizedTime(s))}return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.type).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SET,!0,[t])])}function u(e,t,i){var o={};if(!r.validate(t,i,o,[])){var s=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw s.errors=s,s}if(r.derToOid(o.contentType)!==n.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(o.encryptedContent){var a="";if(n.util.isArray(o.encryptedContent))for(var l=0;l<o.encryptedContent.length;++l){if(o.encryptedContent[l].type!==r.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");a+=o.encryptedContent[l].value}else a=o.encryptedContent;e.encryptedContent={algorithm:r.derToOid(o.encAlgorithm),parameter:n.util.createBuffer(o.encParameter.value),content:n.util.createBuffer(a)}}if(o.content){a="";if(n.util.isArray(o.content))for(l=0;l<o.content.length;++l){if(o.content[l].type!==r.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");a+=o.content[l].value}else a=o.content;e.content=n.util.createBuffer(a)}return e.version=o.version.charCodeAt(0),e.rawCapture=o,o}function h(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content){var t;switch(e.encryptedContent.algorithm){case n.pki.oids["aes128-CBC"]:case n.pki.oids["aes192-CBC"]:case n.pki.oids["aes256-CBC"]:t=n.aes.createDecryptionCipher(e.encryptedContent.key);break;case n.pki.oids.desCBC:case n.pki.oids["des-EDE3-CBC"]:t=n.des.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}}o.messageFromPem=function(e){var t=n.pem.decode(e)[0];if("PKCS7"!==t.type){var i=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw i.headerType=t.type,i}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var s=r.fromDer(t.body);return o.messageFromAsn1(s)},o.messageToPem=function(e,t){var i={type:"PKCS7",body:r.toDer(e.toAsn1()).getBytes()};return n.pem.encode(i,{maxline:t})},o.messageFromAsn1=function(e){var t={},i=[];if(!r.validate(e,o.asn1.contentInfoValidator,t,i)){var s=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw s.errors=i,s}var a,l=r.derToOid(t.contentType);switch(l){case n.pki.oids.envelopedData:a=o.createEnvelopedData();break;case n.pki.oids.encryptedData:a=o.createEncryptedData();break;case n.pki.oids.signedData:a=o.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+l+" is not (yet) supported.")}return a.fromAsn1(t.content.value[0]),a},o.createSignedData=function(){var e=null;return e={type:n.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){if(u(e,t,o.asn1.signedDataValidator),e.certificates=[],e.crls=[],e.digestAlgorithmIdentifiers=[],e.contentInfo=null,e.signerInfos=[],e.rawCapture.certificates)for(var i=e.rawCapture.certificates.value,r=0;r<i.length;++r)e.certificates.push(n.pki.certificateFromAsn1(i[r]))},toAsn1:function(){e.contentInfo||e.sign();for(var t=[],i=0;i<e.certificates.length;++i)t.push(n.pki.certificateToAsn1(e.certificates[i]));var o=[],s=r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(e.version).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SET,!0,e.digestAlgorithmIdentifiers),e.contentInfo])]);return t.length>0&&s.value[0].value.push(r.create(r.Class.CONTEXT_SPECIFIC,0,!0,t)),o.length>0&&s.value[0].value.push(r.create(r.Class.CONTEXT_SPECIFIC,1,!0,o)),s.value[0].value.push(r.create(r.Class.UNIVERSAL,r.Type.SET,!0,e.signerInfos)),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.type).getBytes()),s])},addSigner:function(t){var i=t.issuer,r=t.serialNumber;if(t.certificate){var o=t.certificate;"string"==typeof o&&(o=n.pki.certificateFromPem(o)),i=o.issuer.attributes,r=o.serialNumber}var s=t.key;if(!s)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"==typeof s&&(s=n.pki.privateKeyFromPem(s));var a=t.digestAlgorithm||n.pki.oids.sha1;switch(a){case n.pki.oids.sha1:case n.pki.oids.sha256:case n.pki.oids.sha384:case n.pki.oids.sha512:case n.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+a)}var l=t.authenticatedAttributes||[];if(l.length>0){for(var c=!1,u=!1,h=0;h<l.length;++h){var d=l[h];if(c||d.type!==n.pki.oids.contentType){if(u||d.type!==n.pki.oids.messageDigest);else if(u=!0,c)break}else if(c=!0,u)break}if(!c||!u)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}e.signers.push({key:s,version:1,issuer:i,serialNumber:r,digestAlgorithm:a,signatureAlgorithm:n.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:l,unauthenticatedAttributes:[]})},sign:function(t){var i;(t=t||{},"object"!=typeof e.content||null===e.contentInfo)&&(e.contentInfo=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(n.pki.oids.data).getBytes())]),"content"in e&&(e.content instanceof n.util.ByteBuffer?i=e.content.bytes():"string"==typeof e.content&&(i=n.util.encodeUtf8(e.content)),t.detached?e.detachedContent=r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,i):e.contentInfo.value.push(r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,i)]))));0!==e.signers.length&&function(t){var i;i=e.detachedContent?e.detachedContent:(i=e.contentInfo.value[1]).value[0];if(!i)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var o=r.derToOid(e.contentInfo.value[0].value),s=r.toDer(i);for(var a in s.getByte(),r.getBerValueLength(s),s=s.getBytes(),t)t[a].start().update(s);for(var u=new Date,h=0;h<e.signers.length;++h){var d=e.signers[h];if(0===d.authenticatedAttributes.length){if(o!==n.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{d.authenticatedAttributesAsn1=r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var f=r.create(r.Class.UNIVERSAL,r.Type.SET,!0,[]),p=0;p<d.authenticatedAttributes.length;++p){var m=d.authenticatedAttributes[p];m.type===n.pki.oids.messageDigest?m.value=t[d.digestAlgorithm].digest():m.type===n.pki.oids.signingTime&&(m.value||(m.value=u)),f.value.push(c(m)),d.authenticatedAttributesAsn1.value.push(c(m))}s=r.toDer(f).getBytes(),d.md.start().update(s)}d.signature=d.key.sign(d.md,"RSASSA-PKCS1-V1_5")}e.signerInfos=function(e){for(var t=[],i=0;i<e.length;++i)t.push(l(e[i]));return t}(e.signers)}(function(){for(var t={},i=0;i<e.signers.length;++i){var o=e.signers[i];(s=o.digestAlgorithm)in t||(t[s]=n.md[n.pki.oids[s]].create()),0===o.authenticatedAttributes.length?o.md=t[s]:o.md=n.md[n.pki.oids[s]].create()}for(var s in e.digestAlgorithmIdentifiers=[],t)e.digestAlgorithmIdentifiers.push(r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(s).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")]));return t}())},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(t){"string"==typeof t&&(t=n.pki.certificateFromPem(t)),e.certificates.push(t)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}}},o.createEncryptedData=function(){var e=null;return e={type:n.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(t){u(e,t,o.asn1.encryptedDataValidator)},decrypt:function(t){void 0!==t&&(e.encryptedContent.key=t),h(e)}}},o.createEnvelopedData=function(){var e=null;return e={type:n.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(t){var i=u(e,t,o.asn1.envelopedDataValidator);e.recipients=function(e){for(var t=[],i=0;i<e.length;++i)t.push(s(e[i]));return t}(i.recipientInfos.value)},toAsn1:function(){return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.type).getBytes()),r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(e.version).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SET,!0,a(e.recipients)),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,(t=e.encryptedContent,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(n.pki.oids.data).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(t.algorithm).getBytes()),t.parameter?r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,t.parameter.getBytes()):void 0]),r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,t.content.getBytes())])]))])])]);var t},findRecipient:function(t){for(var i=t.issuer.attributes,n=0;n<e.recipients.length;++n){var r=e.recipients[n],o=r.issuer;if(r.serialNumber===t.serialNumber&&o.length===i.length){for(var s=!0,a=0;a<i.length;++a)if(o[a].type!==i[a].type||o[a].value!==i[a].value){s=!1;break}if(s)return r}}return null},decrypt:function(t,i){if(void 0===e.encryptedContent.key&&void 0!==t&&void 0!==i)switch(t.encryptedContent.algorithm){case n.pki.oids.rsaEncryption:case n.pki.oids.desCBC:var r=i.decrypt(t.encryptedContent.content);e.encryptedContent.key=n.util.createBuffer(r);break;default:throw new Error("Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm)}h(e)},addRecipient:function(t){e.recipients.push({version:0,issuer:t.issuer.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:n.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,i){if(void 0===e.encryptedContent.content){var r,o,s;switch(i=i||e.encryptedContent.algorithm,t=t||e.encryptedContent.key,i){case n.pki.oids["aes128-CBC"]:r=16,o=16,s=n.aes.createEncryptionCipher;break;case n.pki.oids["aes192-CBC"]:r=24,o=16,s=n.aes.createEncryptionCipher;break;case n.pki.oids["aes256-CBC"]:r=32,o=16,s=n.aes.createEncryptionCipher;break;case n.pki.oids["des-EDE3-CBC"]:r=24,o=8,s=n.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+i)}if(void 0===t)t=n.util.createBuffer(n.random.getBytes(r));else if(t.length()!=r)throw new Error("Symmetric key has wrong length; got "+t.length()+" bytes, expected "+r+".");e.encryptedContent.algorithm=i,e.encryptedContent.key=t,e.encryptedContent.parameter=n.util.createBuffer(n.random.getBytes(o));var a=s(t);if(a.start(e.encryptedContent.parameter.copy()),a.update(e.content),!a.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=a.output}for(var l=0;l<e.recipients.length;++l){var c=e.recipients[l];if(void 0===c.encryptedContent.content){if(c.encryptedContent.algorithm!==n.pki.oids.rsaEncryption)throw new Error("Unsupported asymmetric cipher, OID "+c.encryptedContent.algorithm);c.encryptedContent.content=c.encryptedContent.key.encrypt(e.encryptedContent.key.data)}}}}}},39954:(e,t,i)=>{var n=i(50276);i(12746),i(7619);var r=n.asn1,o=e.exports=n.pkcs7asn1=n.pkcs7asn1||{};n.pkcs7=n.pkcs7||{},n.pkcs7.asn1=o;var s={name:"ContentInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:r.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};o.contentInfoValidator=s;var a={name:"EncryptedContentInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:r.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:r.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};o.envelopedDataValidator={name:"EnvelopedData",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:r.Class.UNIVERSAL,type:r.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(a)},o.encryptedDataValidator={name:"EncryptedData",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"version"}].concat(a)};var l={name:"SignerInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:r.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:r.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:r.Class.UNIVERSAL,type:r.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:r.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};o.signedDataValidator={name:"SignedData",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:r.Class.UNIVERSAL,type:r.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},s,{name:"SignedData.Certificates",tagClass:r.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:r.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:r.Class.UNIVERSAL,type:r.Type.SET,capture:"signerInfos",optional:!0,value:[l]}]},o.recipientInfoValidator={name:"RecipientInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:r.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:r.Class.UNIVERSAL,type:r.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}},29255:(e,t,i)=>{var n=i(50276);i(12746),i(16418),i(12698),i(2385),i(3254),i(55071),i(51417),i(15805),i(7619),i(66011);var r=n.asn1,o=e.exports=n.pki=n.pki||{};o.pemToDer=function(e){var t=n.pem.decode(e)[0];if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PEM to DER; PEM is encrypted.");return n.util.createBuffer(t.body)},o.privateKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("PRIVATE KEY"!==t.type&&"RSA PRIVATE KEY"!==t.type){var i=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');throw i.headerType=t.type,i}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert private key from PEM; PEM is encrypted.");var s=r.fromDer(t.body);return o.privateKeyFromAsn1(s)},o.privateKeyToPem=function(e,t){var i={type:"RSA PRIVATE KEY",body:r.toDer(o.privateKeyToAsn1(e)).getBytes()};return n.pem.encode(i,{maxline:t})},o.privateKeyInfoToPem=function(e,t){var i={type:"PRIVATE KEY",body:r.toDer(e).getBytes()};return n.pem.encode(i,{maxline:t})}},10268:(e,t,i)=>{var n=i(50276);i(7619),i(43736),i(89356),function(){if(n.prime)e.exports=n.prime;else{var t=e.exports=n.prime=n.prime||{},i=n.jsbn.BigInteger,r=[6,4,2,4,2,4,6,2],o=new i(null);o.fromInt(30);var s=function(e,t){return e|t};t.generateProbablePrime=function(e,t,r){"function"==typeof t&&(r=t,t={});var o=(t=t||{}).algorithm||"PRIMEINC";"string"==typeof o&&(o={name:o}),o.options=o.options||{};var s=t.prng||n.random,l={nextBytes:function(e){for(var t=s.getBytesSync(e.length),i=0;i<e.length;++i)e[i]=t.charCodeAt(i)}};if("PRIMEINC"===o.name)return function(e,t,r,o){if("workers"in r)return function(e,t,r,o){if("undefined"==typeof Worker)return a(e,t,r,o);var s=c(e,t),l=r.workers,u=r.workLoad||100,h=30*u/8,d=r.workerScript||"forge/prime.worker.js";if(-1===l)return n.util.estimateCores((function(e,t){e&&(t=2),l=t-1,f()}));function f(){l=Math.max(1,l);for(var n=[],r=0;r<l;++r)n[r]=new Worker(d);for(r=0;r<l;++r)n[r].addEventListener("message",f);var a=!1;function f(r){if(!a){0;var l=r.data;if(l.found){for(var d=0;d<n.length;++d)n[d].terminate();return a=!0,o(null,new i(l.prime,16))}s.bitLength()>e&&(s=c(e,t));var f=s.toString(16);r.target.postMessage({hex:f,workLoad:u}),s.dAddOffset(h,0)}}}f()}(e,t,r,o);return a(e,t,r,o)}(e,l,o.options,r);throw new Error("Invalid prime generation algorithm: "+o.name)}}function a(e,t,i,n){var r=c(e,t),o=function(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(r.bitLength());"millerRabinTests"in i&&(o=i.millerRabinTests);var s=10;"maxBlockTime"in i&&(s=i.maxBlockTime),l(r,e,t,0,o,s,n)}function l(e,t,i,o,s,a,u){var h=+new Date;do{if(e.bitLength()>t&&(e=c(t,i)),e.isProbablePrime(s))return u(null,e);e.dAddOffset(r[o++%8],0)}while(a<0||+new Date-h<a);n.util.setImmediate((function(){l(e,t,i,o,s,a,u)}))}function c(e,t){var n=new i(e,t),r=e-1;return n.testBit(r)||n.bitwiseTo(i.ONE.shiftLeft(r),s,n),n.dAddOffset(31-n.mod(o).byteValue(),0),n}}()},73878:(e,t,i)=>{var n=i(50276);i(7619);var r=null;!n.util.isNodejs||n.options.usePureJavaScript||process.versions["node-webkit"]||(r=i(50310)),(e.exports=n.prng=n.prng||{}).create=function(e){for(var t={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},i=e.md,o=new Array(32),s=0;s<32;++s)o[s]=i.create();function a(){if(t.pools[0].messageLength>=32)return l();var e=32-t.pools[0].messageLength<<5;t.collect(t.seedFileSync(e)),l()}function l(){t.reseeds=4294967295===t.reseeds?0:t.reseeds+1;var e=t.plugin.md.create();e.update(t.keyBytes);for(var i=1,n=0;n<32;++n)t.reseeds%i==0&&(e.update(t.pools[n].digest().getBytes()),t.pools[n].start()),i<<=1;t.keyBytes=e.digest().getBytes(),e.start(),e.update(t.keyBytes);var r=e.digest().getBytes();t.key=t.plugin.formatKey(t.keyBytes),t.seed=t.plugin.formatSeed(r),t.generated=0}function c(e){var t=null,i=n.util.globalScope,r=i.crypto||i.msCrypto;r&&r.getRandomValues&&(t=function(e){return r.getRandomValues(e)});var o=n.util.createBuffer();if(t)for(;o.length()<e;){var s=Math.max(1,Math.min(e-o.length(),65536)/4),a=new Uint32Array(Math.floor(s));try{t(a);for(var l=0;l<a.length;++l)o.putInt32(a[l])}catch(e){if(!("undefined"!=typeof QuotaExceededError&&e instanceof QuotaExceededError))throw e}}if(o.length()<e)for(var c,u,h,d=Math.floor(65536*Math.random());o.length()<e;){u=16807*(65535&d),u+=(32767&(c=16807*(d>>16)))<<16,d=4294967295&(u=(2147483647&(u+=c>>15))+(u>>31));for(l=0;l<3;++l)h=d>>>(l<<3),h^=Math.floor(256*Math.random()),o.putByte(255&h)}return o.getBytes(e)}return t.pools=o,t.pool=0,t.generate=function(e,i){if(!i)return t.generateSync(e);var r=t.plugin.cipher,o=t.plugin.increment,s=t.plugin.formatKey,a=t.plugin.formatSeed,c=n.util.createBuffer();t.key=null,function u(h){if(h)return i(h);if(c.length()>=e)return i(null,c.getBytes(e));t.generated>1048575&&(t.key=null);if(null===t.key)return n.util.nextTick((function(){!function(e){if(t.pools[0].messageLength>=32)return l(),e();var i=32-t.pools[0].messageLength<<5;t.seedFile(i,(function(i,n){if(i)return e(i);t.collect(n),l(),e()}))}(u)}));var d=r(t.key,t.seed);t.generated+=d.length,c.putBytes(d),t.key=s(r(t.key,o(t.seed))),t.seed=a(r(t.key,t.seed)),n.util.setImmediate(u)}()},t.generateSync=function(e){var i=t.plugin.cipher,r=t.plugin.increment,o=t.plugin.formatKey,s=t.plugin.formatSeed;t.key=null;for(var l=n.util.createBuffer();l.length()<e;){t.generated>1048575&&(t.key=null),null===t.key&&a();var c=i(t.key,t.seed);t.generated+=c.length,l.putBytes(c),t.key=o(i(t.key,r(t.seed))),t.seed=s(i(t.key,t.seed))}return l.getBytes(e)},r?(t.seedFile=function(e,t){r.randomBytes(e,(function(e,i){if(e)return t(e);t(null,i.toString())}))},t.seedFileSync=function(e){return r.randomBytes(e).toString()}):(t.seedFile=function(e,t){try{t(null,c(e))}catch(e){t(e)}},t.seedFileSync=c),t.collect=function(e){for(var i=e.length,n=0;n<i;++n)t.pools[t.pool].update(e.substr(n,1)),t.pool=31===t.pool?0:t.pool+1},t.collectInt=function(e,i){for(var n="",r=0;r<i;r+=8)n+=String.fromCharCode(e>>r&255);t.collect(n)},t.registerWorker=function(e){if(e===self)t.seedFile=function(e,t){self.addEventListener("message",(function e(i){var n=i.data;n.forge&&n.forge.prng&&(self.removeEventListener("message",e),t(n.forge.prng.err,n.forge.prng.bytes))})),self.postMessage({forge:{prng:{needed:e}}})};else{e.addEventListener("message",(function(i){var n=i.data;n.forge&&n.forge.prng&&t.seedFile(n.forge.prng.needed,(function(t,i){e.postMessage({forge:{prng:{err:t,bytes:i}}})}))}))}},t}},51417:(e,t,i)=>{var n=i(50276);i(89356),i(7619),(e.exports=n.pss=n.pss||{}).create=function(e){3===arguments.length&&(e={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var t,i=e.md,r=e.mgf,o=i.digestLength,s=e.salt||null;if("string"==typeof s&&(s=n.util.createBuffer(s)),"saltLength"in e)t=e.saltLength;else{if(null===s)throw new Error("Salt length not specified or specific salt not given.");t=s.length()}if(null!==s&&s.length()!==t)throw new Error("Given salt length does not match length of given salt.");var a=e.prng||n.random,l={encode:function(e,l){var c,u,h=l-1,d=Math.ceil(h/8),f=e.digest().getBytes();if(d<o+t+2)throw new Error("Message is too long to encrypt.");u=null===s?a.getBytesSync(t):s.bytes();var p=new n.util.ByteBuffer;p.fillWithByte(0,8),p.putBytes(f),p.putBytes(u),i.start(),i.update(p.getBytes());var m=i.digest().getBytes(),g=new n.util.ByteBuffer;g.fillWithByte(0,d-t-o-2),g.putByte(1),g.putBytes(u);var v=g.getBytes(),y=d-o-1,b=r.generate(m,y),x="";for(c=0;c<y;c++)x+=String.fromCharCode(v.charCodeAt(c)^b.charCodeAt(c));var _=65280>>8*d-h&255;return(x=String.fromCharCode(x.charCodeAt(0)&~_)+x.substr(1))+m+String.fromCharCode(188)},verify:function(e,s,a){var l,c=a-1,u=Math.ceil(c/8);if(s=s.substr(-u),u<o+t+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==s.charCodeAt(u-1))throw new Error("Encoded message does not end in 0xBC.");var h=u-o-1,d=s.substr(0,h),f=s.substr(h,o),p=65280>>8*u-c&255;if(d.charCodeAt(0)&p)throw new Error("Bits beyond keysize not zero as expected.");var m=r.generate(f,h),g="";for(l=0;l<h;l++)g+=String.fromCharCode(d.charCodeAt(l)^m.charCodeAt(l));g=String.fromCharCode(g.charCodeAt(0)&~p)+g.substr(1);var v=u-o-t-2;for(l=0;l<v;l++)if(0!==g.charCodeAt(l))throw new Error("Leftmost octets not zero as expected");if(1!==g.charCodeAt(v))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var y=g.substr(-t),b=new n.util.ByteBuffer;return b.fillWithByte(0,8),b.putBytes(e),b.putBytes(y),i.start(),i.update(b.getBytes()),f===i.digest().getBytes()}};return l}},89356:(e,t,i)=>{var n=i(50276);i(39504),i(30172),i(73878),i(7619),n.random&&n.random.getBytes?e.exports=n.random:function(t){var i={},r=new Array(4),o=n.util.createBuffer();function s(){var e=n.prng.create(i);return e.getBytes=function(t,i){return e.generate(t,i)},e.getBytesSync=function(t){return e.generate(t)},e}i.formatKey=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),n.aes._expandKey(e,!1)},i.formatSeed=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},i.cipher=function(e,t){return n.aes._updateBlock(e,t,r,!1),o.putInt32(r[0]),o.putInt32(r[1]),o.putInt32(r[2]),o.putInt32(r[3]),o.getBytes()},i.increment=function(e){return++e[3],e},i.md=n.md.sha256;var a=s(),l=null,c=n.util.globalScope,u=c.crypto||c.msCrypto;if(u&&u.getRandomValues&&(l=function(e){return u.getRandomValues(e)}),n.options.usePureJavaScript||!n.util.isNodejs&&!l){if("undefined"==typeof window||window.document,a.collectInt(+new Date,32),"undefined"!=typeof navigator){var h="";for(var d in navigator)try{"string"==typeof navigator[d]&&(h+=navigator[d])}catch(e){}a.collect(h),h=null}t&&(t().mousemove((function(e){a.collectInt(e.clientX,16),a.collectInt(e.clientY,16)})),t().keypress((function(e){a.collectInt(e.charCode,8)})))}if(n.random)for(var d in a)n.random[d]=a[d];else n.random=a;n.random.createInstance=s,e.exports=n.random}("undefined"!=typeof jQuery?jQuery:null)},55124:(e,t,i)=>{var n=i(50276);i(7619);var r=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],o=[1,2,3,5],s=function(e,t){return e<<t&65535|(65535&e)>>16-t},a=function(e,t){return(65535&e)>>t|e<<16-t&65535};e.exports=n.rc2=n.rc2||{},n.rc2.expandKey=function(e,t){"string"==typeof e&&(e=n.util.createBuffer(e)),t=t||128;var i,o=e,s=e.length(),a=t,l=Math.ceil(a/8),c=255>>(7&a);for(i=s;i<128;i++)o.putByte(r[o.at(i-1)+o.at(i-s)&255]);for(o.setAt(128-l,r[o.at(128-l)&c]),i=127-l;i>=0;i--)o.setAt(i,r[o.at(i+1)^o.at(i+l)]);return o};var l=function(e,t,i){var r,l,c,u,h=!1,d=null,f=null,p=null,m=[];for(e=n.rc2.expandKey(e,t),c=0;c<64;c++)m.push(e.getInt16Le());i?(r=function(e){for(c=0;c<4;c++)e[c]+=m[u]+(e[(c+3)%4]&e[(c+2)%4])+(~e[(c+3)%4]&e[(c+1)%4]),e[c]=s(e[c],o[c]),u++},l=function(e){for(c=0;c<4;c++)e[c]+=m[63&e[(c+3)%4]]}):(r=function(e){for(c=3;c>=0;c--)e[c]=a(e[c],o[c]),e[c]-=m[u]+(e[(c+3)%4]&e[(c+2)%4])+(~e[(c+3)%4]&e[(c+1)%4]),u--},l=function(e){for(c=3;c>=0;c--)e[c]-=m[63&e[(c+3)%4]]});var g=function(e){var t=[];for(c=0;c<4;c++){var n=d.getInt16Le();null!==p&&(i?n^=p.getInt16Le():p.putInt16Le(n)),t.push(65535&n)}u=i?0:63;for(var r=0;r<e.length;r++)for(var o=0;o<e[r][0];o++)e[r][1](t);for(c=0;c<4;c++)null!==p&&(i?p.putInt16Le(t[c]):t[c]^=p.getInt16Le()),f.putInt16Le(t[c])},v=null;return v={start:function(e,t){e&&"string"==typeof e&&(e=n.util.createBuffer(e)),h=!1,d=n.util.createBuffer(),f=t||new n.util.createBuffer,p=e,v.output=f},update:function(e){for(h||d.putBuffer(e);d.length()>=8;)g([[5,r],[1,l],[6,r],[1,l],[5,r]])},finish:function(e){var t=!0;if(i)if(e)t=e(8,d,!i);else{var n=8===d.length()?8:8-d.length();d.fillWithByte(n,n)}if(t&&(h=!0,v.update()),!i&&(t=0===d.length()))if(e)t=e(8,f,!i);else{var r=f.length(),o=f.at(r-1);o>r?t=!1:f.truncate(o)}return t}}};n.rc2.startEncrypting=function(e,t,i){var r=n.rc2.createEncryptionCipher(e,128);return r.start(t,i),r},n.rc2.createEncryptionCipher=function(e,t){return l(e,t,!0)},n.rc2.startDecrypting=function(e,t,i){var r=n.rc2.createDecryptionCipher(e,128);return r.start(t,i),r},n.rc2.createDecryptionCipher=function(e,t){return l(e,t,!1)}},15805:(e,t,i)=>{var n=i(50276);if(i(12746),i(43736),i(16418),i(47501),i(10268),i(89356),i(7619),void 0===r)var r=n.jsbn.BigInteger;var o=n.util.isNodejs?i(50310):null,s=n.asn1,a=n.util;n.pki=n.pki||{},e.exports=n.pki.rsa=n.rsa=n.rsa||{};var l=n.pki,c=[6,4,2,4,2,4,6,2],u={name:"PrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},h={name:"RSAPrivateKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},d={name:"RSAPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},f=n.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},p={name:"DigestInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:s.Class.UNIVERSAL,type:s.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},m=function(e){var t;if(!(e.algorithm in l.oids)){var i=new Error("Unknown message digest algorithm.");throw i.algorithm=e.algorithm,i}t=l.oids[e.algorithm];var n=s.oidToDer(t).getBytes(),r=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),o=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);o.value.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,n)),o.value.push(s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,""));var a=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.digest().getBytes());return r.value.push(o),r.value.push(a),s.toDer(r).getBytes()},g=function(e,t,i){if(i)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var o;t.dP||(t.dP=t.d.mod(t.p.subtract(r.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(r.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));do{o=new r(n.util.bytesToHex(n.random.getBytes(t.n.bitLength()/8)),16)}while(o.compareTo(t.n)>=0||!o.gcd(t.n).equals(r.ONE));for(var s=(e=e.multiply(o.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),a=e.mod(t.q).modPow(t.dQ,t.q);s.compareTo(a)<0;)s=s.add(t.p);var l=s.subtract(a).multiply(t.qInv).mod(t.p).multiply(t.q).add(a);return l=l.multiply(o.modInverse(t.n)).mod(t.n)};function v(e,t,i){var r=n.util.createBuffer(),o=Math.ceil(t.n.bitLength()/8);if(e.length>o-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=e.length,s.max=o-11,s}r.putByte(0),r.putByte(i);var a,l=o-3-e.length;if(0===i||1===i){a=0===i?0:255;for(var c=0;c<l;++c)r.putByte(a)}else for(;l>0;){var u=0,h=n.random.getBytes(l);for(c=0;c<l;++c)0===(a=h.charCodeAt(c))?++u:r.putByte(a);l=u}return r.putByte(0),r.putBytes(e),r}function y(e,t,i,r){var o=Math.ceil(t.n.bitLength()/8),s=n.util.createBuffer(e),a=s.getByte(),l=s.getByte();if(0!==a||i&&0!==l&&1!==l||!i&&2!=l||i&&0===l&&void 0===r)throw new Error("Encryption block is invalid.");var c=0;if(0===l){c=o-3-r;for(var u=0;u<c;++u)if(0!==s.getByte())throw new Error("Encryption block is invalid.")}else if(1===l)for(c=0;s.length()>1;){if(255!==s.getByte()){--s.read;break}++c}else if(2===l)for(c=0;s.length()>1;){if(0===s.getByte()){--s.read;break}++c}if(0!==s.getByte()||c!==o-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function b(e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var i=n.util.hexToBytes(t);return!(i.length>1)||(0!==i.charCodeAt(0)||128&i.charCodeAt(1))&&(255!==i.charCodeAt(0)||128&~i.charCodeAt(1))?i:i.substr(1)}function x(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function _(e){return n.util.isNodejs&&"function"==typeof o[e]}function E(e){return void 0!==a.globalScope&&"object"==typeof a.globalScope.crypto&&"object"==typeof a.globalScope.crypto.subtle&&"function"==typeof a.globalScope.crypto.subtle[e]}function S(e){return void 0!==a.globalScope&&"object"==typeof a.globalScope.msCrypto&&"object"==typeof a.globalScope.msCrypto.subtle&&"function"==typeof a.globalScope.msCrypto.subtle[e]}function A(e){for(var t=n.util.hexToBytes(e.toString(16)),i=new Uint8Array(t.length),r=0;r<t.length;++r)i[r]=t.charCodeAt(r);return i}l.rsa.encrypt=function(e,t,i){var o,s=i,a=Math.ceil(t.n.bitLength()/8);!1!==i&&!0!==i?(s=2===i,o=v(e,t,i)):(o=n.util.createBuffer()).putBytes(e);for(var l=new r(o.toHex(),16),c=g(l,t,s).toString(16),u=n.util.createBuffer(),h=a-Math.ceil(c.length/2);h>0;)u.putByte(0),--h;return u.putBytes(n.util.hexToBytes(c)),u.getBytes()},l.rsa.decrypt=function(e,t,i,o){var s=Math.ceil(t.n.bitLength()/8);if(e.length!==s){var a=new Error("Encrypted message length is invalid.");throw a.length=e.length,a.expected=s,a}var l=new r(n.util.createBuffer(e).toHex(),16);if(l.compareTo(t.n)>=0)throw new Error("Encrypted message is invalid.");for(var c=g(l,t,i).toString(16),u=n.util.createBuffer(),h=s-Math.ceil(c.length/2);h>0;)u.putByte(0),--h;return u.putBytes(n.util.hexToBytes(c)),!1!==o?y(u.getBytes(),t,i):u.getBytes()},l.rsa.createKeyPairGenerationState=function(e,t,i){"string"==typeof e&&(e=parseInt(e,10)),e=e||2048;var o,s=(i=i||{}).prng||n.random,a={nextBytes:function(e){for(var t=s.getBytesSync(e.length),i=0;i<e.length;++i)e[i]=t.charCodeAt(i)}},l=i.algorithm||"PRIMEINC";if("PRIMEINC"!==l)throw new Error("Invalid key generation algorithm: "+l);return(o={algorithm:l,state:0,bits:e,rng:a,eInt:t||65537,e:new r(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(o.eInt),o},l.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var i=new r(null);i.fromInt(30);for(var n,o=0,s=function(e,t){return e|t},a=+new Date,u=0;null===e.keys&&(t<=0||u<t);){if(0===e.state){var h=null===e.p?e.pBits:e.qBits,d=h-1;0===e.pqState?(e.num=new r(h,e.rng),e.num.testBit(d)||e.num.bitwiseTo(r.ONE.shiftLeft(d),s,e.num),e.num.dAddOffset(31-e.num.mod(i).byteValue(),0),o=0,++e.pqState):1===e.pqState?e.num.bitLength()>h?e.pqState=0:e.num.isProbablePrime(x(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(c[o++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(r.ONE).gcd(e.e).compareTo(r.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(r.ONE),e.q1=e.q.subtract(r.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(r.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var f=e.e.modInverse(e.phi);e.keys={privateKey:l.rsa.setPrivateKey(e.n,e.e,f,e.p,e.q,f.mod(e.p1),f.mod(e.q1),e.q.modInverse(e.p)),publicKey:l.rsa.setPublicKey(e.n,e.e)}}u+=(n=+new Date)-a,a=n}return null!==e.keys},l.rsa.generateKeyPair=function(e,t,i,c){if(1===arguments.length?"object"==typeof e?(i=e,e=void 0):"function"==typeof e&&(c=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof t?(c=t,t=void 0):"number"!=typeof t&&(i=t,t=void 0):(i=e,c=t,e=void 0,t=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof i&&(c=i,i=void 0):(c=i,i=t,t=void 0)),i=i||{},void 0===e&&(e=i.bits||2048),void 0===t&&(t=i.e||65537),!n.options.usePureJavaScript&&!i.prng&&e>=256&&e<=16384&&(65537===t||3===t))if(c){if(_("generateKeyPair"))return o.generateKeyPair("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},(function(e,t,i){if(e)return c(e);c(null,{privateKey:l.privateKeyFromPem(i),publicKey:l.publicKeyFromPem(t)})}));if(E("generateKey")&&E("exportKey"))return a.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:A(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(e){return a.globalScope.crypto.subtle.exportKey("pkcs8",e.privateKey)})).then(void 0,(function(e){c(e)})).then((function(e){if(e){var t=l.privateKeyFromAsn1(s.fromDer(n.util.createBuffer(e)));c(null,{privateKey:t,publicKey:l.setRsaPublicKey(t.n,t.e)})}}));if(S("generateKey")&&S("exportKey")){var u=a.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:A(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return u.oncomplete=function(e){var t=e.target.result,i=a.globalScope.msCrypto.subtle.exportKey("pkcs8",t.privateKey);i.oncomplete=function(e){var t=e.target.result,i=l.privateKeyFromAsn1(s.fromDer(n.util.createBuffer(t)));c(null,{privateKey:i,publicKey:l.setRsaPublicKey(i.n,i.e)})},i.onerror=function(e){c(e)}},void(u.onerror=function(e){c(e)})}}else if(_("generateKeyPairSync")){var h=o.generateKeyPairSync("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:l.privateKeyFromPem(h.privateKey),publicKey:l.publicKeyFromPem(h.publicKey)}}var d=l.rsa.createKeyPairGenerationState(e,t,i);if(!c)return l.rsa.stepKeyPairGenerationState(d,0),d.keys;!function(e,t,i){"function"==typeof t&&(i=t,t={});t=t||{};var o={algorithm:{name:t.algorithm||"PRIMEINC",options:{workers:t.workers||2,workLoad:t.workLoad||100,workerScript:t.workerScript}}};"prng"in t&&(o.prng=t.prng);function s(){a(e.pBits,(function(t,n){return t?i(t):(e.p=n,null!==e.q?c(t,e.q):void a(e.qBits,c))}))}function a(e,t){n.prime.generateProbablePrime(e,o,t)}function c(t,n){if(t)return i(t);if(e.q=n,e.p.compareTo(e.q)<0){var o=e.p;e.p=e.q,e.q=o}if(0!==e.p.subtract(r.ONE).gcd(e.e).compareTo(r.ONE))return e.p=null,void s();if(0!==e.q.subtract(r.ONE).gcd(e.e).compareTo(r.ONE))return e.q=null,void a(e.qBits,c);if(e.p1=e.p.subtract(r.ONE),e.q1=e.q.subtract(r.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(r.ONE))return e.p=e.q=null,void s();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void a(e.qBits,c);var u=e.e.modInverse(e.phi);e.keys={privateKey:l.rsa.setPrivateKey(e.n,e.e,u,e.p,e.q,u.mod(e.p1),u.mod(e.q1),e.q.modInverse(e.p)),publicKey:l.rsa.setPublicKey(e.n,e.e)},i(null,e.keys)}s()}(d,i,c)},l.setRsaPublicKey=l.rsa.setPublicKey=function(e,t){var i={n:e,e:t,encrypt:function(e,t,r){if("string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,i){return v(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return n.pkcs1.encode_rsa_oaep(t,e,r)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"==typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var o=t.encode(e,i,!0);return l.rsa.encrypt(o,i,!0)},verify:function(e,t,r,o){"string"==typeof r?r=r.toUpperCase():void 0===r&&(r="RSASSA-PKCS1-V1_5"),void 0===o&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),"RSASSA-PKCS1-V1_5"===r?r={verify:function(e,t){t=y(t,i,!0);var r=s.fromDer(t,{parseAllBytes:o._parseAllDigestBytes}),a={},l=[];if(!s.validate(r,p,a,l))throw(c=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.")).errors=l,c;var c,u=s.derToOid(a.algorithmIdentifier);if(u!==n.oids.md2&&u!==n.oids.md5&&u!==n.oids.sha1&&u!==n.oids.sha224&&u!==n.oids.sha256&&u!==n.oids.sha384&&u!==n.oids.sha512&&u!==n.oids["sha512-224"]&&u!==n.oids["sha512-256"])throw(c=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.")).oid=u,c;if((u===n.oids.md2||u===n.oids.md5)&&!("parameters"in a))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return e===a.digest}}:"NONE"!==r&&"NULL"!==r&&null!==r||(r={verify:function(e,t){return e===(t=y(t,i,!0))}});var a=l.rsa.decrypt(t,i,!0,!1);return r.verify(e,a,i.n.bitLength())}};return i},l.setRsaPrivateKey=l.rsa.setPrivateKey=function(e,t,i,r,o,s,a,c){var u={n:e,e:t,d:i,p:r,q:o,dP:s,dQ:a,qInv:c,decrypt:function(e,t,i){"string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var r=l.rsa.decrypt(e,u,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:y};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return n.pkcs1.decode_rsa_oaep(t,e,i)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(r,u,!1)},sign:function(e,t){var i=!1;"string"==typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:m},i=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},i=1);var n=t.encode(e,u.n.bitLength());return l.rsa.encrypt(n,u,i)}};return u},l.wrapRsaPrivateKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(0).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(l.oids.rsaEncryption).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,s.toDer(e).getBytes())])},l.privateKeyFromAsn1=function(e){var t,i,o,a,c,d,f,p,m={},g=[];if(s.validate(e,u,m,g)&&(e=s.fromDer(n.util.createBuffer(m.privateKey))),m={},g=[],!s.validate(e,h,m,g)){var v=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw v.errors=g,v}return t=n.util.createBuffer(m.privateKeyModulus).toHex(),i=n.util.createBuffer(m.privateKeyPublicExponent).toHex(),o=n.util.createBuffer(m.privateKeyPrivateExponent).toHex(),a=n.util.createBuffer(m.privateKeyPrime1).toHex(),c=n.util.createBuffer(m.privateKeyPrime2).toHex(),d=n.util.createBuffer(m.privateKeyExponent1).toHex(),f=n.util.createBuffer(m.privateKeyExponent2).toHex(),p=n.util.createBuffer(m.privateKeyCoefficient).toHex(),l.setRsaPrivateKey(new r(t,16),new r(i,16),new r(o,16),new r(a,16),new r(c,16),new r(d,16),new r(f,16),new r(p,16))},l.privateKeyToAsn1=l.privateKeyToRSAPrivateKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(0).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.n)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.e)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.d)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.p)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.q)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.dP)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.dQ)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.qInv))])},l.publicKeyFromAsn1=function(e){var t={},i=[];if(s.validate(e,f,t,i)){var o,a=s.derToOid(t.publicKeyOid);if(a!==l.oids.rsaEncryption)throw(o=new Error("Cannot read public key. Unknown OID.")).oid=a,o;e=t.rsaPublicKey}if(i=[],!s.validate(e,d,t,i))throw(o=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=i,o;var c=n.util.createBuffer(t.publicKeyModulus).toHex(),u=n.util.createBuffer(t.publicKeyExponent).toHex();return l.setRsaPublicKey(new r(c,16),new r(u,16))},l.publicKeyToAsn1=l.publicKeyToSubjectPublicKeyInfo=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(l.oids.rsaEncryption).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,[l.publicKeyToRSAPublicKey(e)])])},l.publicKeyToRSAPublicKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.n)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,b(e.e))])}},21598:(e,t,i)=>{var n=i(50276);i(8106),i(7619);var r=e.exports=n.sha1=n.sha1||{};n.md.sha1=n.md.algorithms.sha1=r,r.create=function(){s||(o=String.fromCharCode(128),o+=n.util.fillString(String.fromCharCode(0),64),s=!0);var e=null,t=n.util.createBuffer(),i=new Array(80),r={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){r.messageLength=0,r.fullMessageLength=r.messageLength64=[];for(var i=r.messageLengthSize/4,o=0;o<i;++o)r.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},r}};return r.start(),r.update=function(o,s){"utf8"===s&&(o=n.util.encodeUtf8(o));var l=o.length;r.messageLength+=l,l=[l/4294967296>>>0,l>>>0];for(var c=r.fullMessageLength.length-1;c>=0;--c)r.fullMessageLength[c]+=l[1],l[1]=l[0]+(r.fullMessageLength[c]/4294967296>>>0),r.fullMessageLength[c]=r.fullMessageLength[c]>>>0,l[0]=l[1]/4294967296>>>0;return t.putBytes(o),a(e,i,t),(t.read>2048||0===t.length())&&t.compact(),r},r.digest=function(){var s=n.util.createBuffer();s.putBytes(t.bytes());var l,c=r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize&r.blockLength-1;s.putBytes(o.substr(0,r.blockLength-c));for(var u=8*r.fullMessageLength[0],h=0;h<r.fullMessageLength.length-1;++h)u+=(l=8*r.fullMessageLength[h+1])/4294967296>>>0,s.putInt32(u>>>0),u=l>>>0;s.putInt32(u);var d={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};a(d,i,s);var f=n.util.createBuffer();return f.putInt32(d.h0),f.putInt32(d.h1),f.putInt32(d.h2),f.putInt32(d.h3),f.putInt32(d.h4),f},r};var o=null,s=!1;function a(e,t,i){for(var n,r,o,s,a,l,c,u=i.length();u>=64;){for(r=e.h0,o=e.h1,s=e.h2,a=e.h3,l=e.h4,c=0;c<16;++c)n=i.getInt32(),t[c]=n,n=(r<<5|r>>>27)+(a^o&(s^a))+l+1518500249+n,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=r,r=n;for(;c<20;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,t[c]=n,n=(r<<5|r>>>27)+(a^o&(s^a))+l+1518500249+n,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=r,r=n;for(;c<32;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,t[c]=n,n=(r<<5|r>>>27)+(o^s^a)+l+1859775393+n,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=r,r=n;for(;c<40;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(r<<5|r>>>27)+(o^s^a)+l+1859775393+n,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=r,r=n;for(;c<60;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(r<<5|r>>>27)+(o&s|a&(o^s))+l+2400959708+n,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=r,r=n;for(;c<80;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(r<<5|r>>>27)+(o^s^a)+l+3395469782+n,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=r,r=n;e.h0=e.h0+r|0,e.h1=e.h1+o|0,e.h2=e.h2+s|0,e.h3=e.h3+a|0,e.h4=e.h4+l|0,u-=64}}},30172:(e,t,i)=>{var n=i(50276);i(8106),i(7619);var r=e.exports=n.sha256=n.sha256||{};n.md.sha256=n.md.algorithms.sha256=r,r.create=function(){s||(o=String.fromCharCode(128),o+=n.util.fillString(String.fromCharCode(0),64),a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=!0);var e=null,t=n.util.createBuffer(),i=new Array(64),r={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){r.messageLength=0,r.fullMessageLength=r.messageLength64=[];for(var i=r.messageLengthSize/4,o=0;o<i;++o)r.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},r}};return r.start(),r.update=function(o,s){"utf8"===s&&(o=n.util.encodeUtf8(o));var a=o.length;r.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var c=r.fullMessageLength.length-1;c>=0;--c)r.fullMessageLength[c]+=a[1],a[1]=a[0]+(r.fullMessageLength[c]/4294967296>>>0),r.fullMessageLength[c]=r.fullMessageLength[c]>>>0,a[0]=a[1]/4294967296>>>0;return t.putBytes(o),l(e,i,t),(t.read>2048||0===t.length())&&t.compact(),r},r.digest=function(){var s=n.util.createBuffer();s.putBytes(t.bytes());var a,c=r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize&r.blockLength-1;s.putBytes(o.substr(0,r.blockLength-c));for(var u=8*r.fullMessageLength[0],h=0;h<r.fullMessageLength.length-1;++h)u+=(a=8*r.fullMessageLength[h+1])/4294967296>>>0,s.putInt32(u>>>0),u=a>>>0;s.putInt32(u);var d={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};l(d,i,s);var f=n.util.createBuffer();return f.putInt32(d.h0),f.putInt32(d.h1),f.putInt32(d.h2),f.putInt32(d.h3),f.putInt32(d.h4),f.putInt32(d.h5),f.putInt32(d.h6),f.putInt32(d.h7),f},r};var o=null,s=!1,a=null;function l(e,t,i){for(var n,r,o,s,l,c,u,h,d,f,p,m,g,v=i.length();v>=64;){for(l=0;l<16;++l)t[l]=i.getInt32();for(;l<64;++l)n=((n=t[l-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,r=((r=t[l-15])>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,t[l]=n+t[l-7]+r+t[l-16]|0;for(c=e.h0,u=e.h1,h=e.h2,d=e.h3,f=e.h4,p=e.h5,m=e.h6,g=e.h7,l=0;l<64;++l)o=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),s=c&u|h&(c^u),n=g+((f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(m^f&(p^m))+a[l]+t[l],g=m,m=p,p=f,f=d+n>>>0,d=h,h=u,u=c,c=n+(r=o+s)>>>0;e.h0=e.h0+c|0,e.h1=e.h1+u|0,e.h2=e.h2+h|0,e.h3=e.h3+d|0,e.h4=e.h4+f|0,e.h5=e.h5+p|0,e.h6=e.h6+m|0,e.h7=e.h7+g|0,v-=64}}},72313:(e,t,i)=>{var n=i(50276);i(8106),i(7619);var r=e.exports=n.sha512=n.sha512||{};n.md.sha512=n.md.algorithms.sha512=r;var o=n.sha384=n.sha512.sha384=n.sha512.sha384||{};o.create=function(){return r.create("SHA-384")},n.md.sha384=n.md.algorithms.sha384=o,n.sha512.sha256=n.sha512.sha256||{create:function(){return r.create("SHA-512/256")}},n.md["sha512/256"]=n.md.algorithms["sha512/256"]=n.sha512.sha256,n.sha512.sha224=n.sha512.sha224||{create:function(){return r.create("SHA-512/224")}},n.md["sha512/224"]=n.md.algorithms["sha512/224"]=n.sha512.sha224,r.create=function(e){if(a||(s=String.fromCharCode(128),s+=n.util.fillString(String.fromCharCode(0),128),l=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(c={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],c["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],c["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],c["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],a=!0),void 0===e&&(e="SHA-512"),!(e in c))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=c[e],i=null,r=n.util.createBuffer(),o=new Array(80),h=0;h<80;++h)o[h]=new Array(2);var d=64;switch(e){case"SHA-384":d=48;break;case"SHA-512/256":d=32;break;case"SHA-512/224":d=28}var f={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:d,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){f.messageLength=0,f.fullMessageLength=f.messageLength128=[];for(var e=f.messageLengthSize/4,o=0;o<e;++o)f.fullMessageLength.push(0);r=n.util.createBuffer(),i=new Array(t.length);for(o=0;o<t.length;++o)i[o]=t[o].slice(0);return f}};return f.start(),f.update=function(e,t){"utf8"===t&&(e=n.util.encodeUtf8(e));var s=e.length;f.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var a=f.fullMessageLength.length-1;a>=0;--a)f.fullMessageLength[a]+=s[1],s[1]=s[0]+(f.fullMessageLength[a]/4294967296>>>0),f.fullMessageLength[a]=f.fullMessageLength[a]>>>0,s[0]=s[1]/4294967296>>>0;return r.putBytes(e),u(i,o,r),(r.read>2048||0===r.length())&&r.compact(),f},f.digest=function(){var t=n.util.createBuffer();t.putBytes(r.bytes());var a,l=f.fullMessageLength[f.fullMessageLength.length-1]+f.messageLengthSize&f.blockLength-1;t.putBytes(s.substr(0,f.blockLength-l));for(var c=8*f.fullMessageLength[0],h=0;h<f.fullMessageLength.length-1;++h)c+=(a=8*f.fullMessageLength[h+1])/4294967296>>>0,t.putInt32(c>>>0),c=a>>>0;t.putInt32(c);var d=new Array(i.length);for(h=0;h<i.length;++h)d[h]=i[h].slice(0);u(d,o,t);var p,m=n.util.createBuffer();p="SHA-512"===e?d.length:"SHA-384"===e?d.length-2:d.length-4;for(h=0;h<p;++h)m.putInt32(d[h][0]),h===p-1&&"SHA-512/224"===e||m.putInt32(d[h][1]);return m},f};var s=null,a=!1,l=null,c=null;function u(e,t,i){for(var n,r,o,s,a,c,u,h,d,f,p,m,g,v,y,b,x,_,E,S,A,w,C,T,M,I,P,L,R,D,O,B,N,U=i.length();U>=128;){for(P=0;P<16;++P)t[P][0]=i.getInt32()>>>0,t[P][1]=i.getInt32()>>>0;for(;P<80;++P)n=(((L=(D=t[P-2])[0])>>>19|(R=D[1])<<13)^(R>>>29|L<<3)^L>>>6)>>>0,r=((L<<13|R>>>19)^(R<<3|L>>>29)^(L<<26|R>>>6))>>>0,o=(((L=(B=t[P-15])[0])>>>1|(R=B[1])<<31)^(L>>>8|R<<24)^L>>>7)>>>0,s=((L<<31|R>>>1)^(L<<24|R>>>8)^(L<<25|R>>>7))>>>0,O=t[P-7],N=t[P-16],R=r+O[1]+s+N[1],t[P][0]=n+O[0]+o+N[0]+(R/4294967296>>>0)>>>0,t[P][1]=R>>>0;for(p=e[0][0],m=e[0][1],g=e[1][0],v=e[1][1],y=e[2][0],b=e[2][1],x=e[3][0],_=e[3][1],E=e[4][0],S=e[4][1],A=e[5][0],w=e[5][1],C=e[6][0],T=e[6][1],M=e[7][0],I=e[7][1],P=0;P<80;++P)u=((E>>>14|S<<18)^(E>>>18|S<<14)^(S>>>9|E<<23))>>>0,h=(C^E&(A^C))>>>0,a=((p>>>28|m<<4)^(m>>>2|p<<30)^(m>>>7|p<<25))>>>0,c=((p<<4|m>>>28)^(m<<30|p>>>2)^(m<<25|p>>>7))>>>0,d=(p&g|y&(p^g))>>>0,f=(m&v|b&(m^v))>>>0,R=I+(((E<<18|S>>>14)^(E<<14|S>>>18)^(S<<23|E>>>9))>>>0)+((T^S&(w^T))>>>0)+l[P][1]+t[P][1],n=M+u+h+l[P][0]+t[P][0]+(R/4294967296>>>0)>>>0,r=R>>>0,o=a+d+((R=c+f)/4294967296>>>0)>>>0,s=R>>>0,M=C,I=T,C=A,T=w,A=E,w=S,E=x+n+((R=_+r)/4294967296>>>0)>>>0,S=R>>>0,x=y,_=b,y=g,b=v,g=p,v=m,p=n+o+((R=r+s)/4294967296>>>0)>>>0,m=R>>>0;R=e[0][1]+m,e[0][0]=e[0][0]+p+(R/4294967296>>>0)>>>0,e[0][1]=R>>>0,R=e[1][1]+v,e[1][0]=e[1][0]+g+(R/4294967296>>>0)>>>0,e[1][1]=R>>>0,R=e[2][1]+b,e[2][0]=e[2][0]+y+(R/4294967296>>>0)>>>0,e[2][1]=R>>>0,R=e[3][1]+_,e[3][0]=e[3][0]+x+(R/4294967296>>>0)>>>0,e[3][1]=R>>>0,R=e[4][1]+S,e[4][0]=e[4][0]+E+(R/4294967296>>>0)>>>0,e[4][1]=R>>>0,R=e[5][1]+w,e[5][0]=e[5][0]+A+(R/4294967296>>>0)>>>0,e[5][1]=R>>>0,R=e[6][1]+T,e[6][0]=e[6][0]+C+(R/4294967296>>>0)>>>0,e[6][1]=R>>>0,R=e[7][1]+I,e[7][0]=e[7][0]+M+(R/4294967296>>>0)>>>0,e[7][1]=R>>>0,U-=128}}},50149:(e,t,i)=>{var n=i(50276);i(39504),i(71696),i(1267),i(21598),i(7619);var r=e.exports=n.ssh=n.ssh||{};function o(e,t){var i=t.toString(16);i[0]>="8"&&(i="00"+i);var r=n.util.hexToBytes(i);e.putInt32(r.length),e.putBytes(r)}function s(e,t){e.putInt32(t.length),e.putString(t)}function a(){for(var e=n.md.sha1.create(),t=arguments.length,i=0;i<t;++i)e.update(arguments[i]);return e.digest()}r.privateKeyToPutty=function(e,t,i){var r="ssh-rsa",l=""===(t=t||"")?"none":"aes256-cbc",c="PuTTY-User-Key-File-2: "+r+"\r\n";c+="Encryption: "+l+"\r\n",c+="Comment: "+(i=i||"")+"\r\n";var u=n.util.createBuffer();s(u,r),o(u,e.e),o(u,e.n);var h=n.util.encode64(u.bytes(),64),d=Math.floor(h.length/66)+1;c+="Public-Lines: "+d+"\r\n",c+=h;var f,p=n.util.createBuffer();if(o(p,e.d),o(p,e.p),o(p,e.q),o(p,e.qInv),t){var m=p.length()+16-1;m-=m%16;var g=a(p.bytes());g.truncate(g.length()-m+p.length()),p.putBuffer(g);var v=n.util.createBuffer();v.putBuffer(a("\0\0\0\0",t)),v.putBuffer(a("\0\0\0",t));var y=n.aes.createEncryptionCipher(v.truncate(8),"CBC");y.start(n.util.createBuffer().fillWithByte(0,16)),y.update(p.copy()),y.finish();var b=y.output;b.truncate(16),f=n.util.encode64(b.bytes(),64)}else f=n.util.encode64(p.bytes(),64);c+="\r\nPrivate-Lines: "+(d=Math.floor(f.length/66)+1)+"\r\n",c+=f;var x=a("putty-private-key-file-mac-key",t),_=n.util.createBuffer();s(_,r),s(_,l),s(_,i),_.putInt32(u.length()),_.putBuffer(u),_.putInt32(p.length()),_.putBuffer(p);var E=n.hmac.create();return E.start("sha1",x),E.update(_.bytes()),c+="\r\nPrivate-MAC: "+E.digest().toHex()+"\r\n"},r.publicKeyToOpenSSH=function(e,t){var i="ssh-rsa";t=t||"";var r=n.util.createBuffer();return s(r,i),o(r,e.e),o(r,e.n),i+" "+n.util.encode64(r.bytes())+" "+t},r.privateKeyToOpenSSH=function(e,t){return t?n.pki.encryptRsaPrivateKey(e,t,{legacy:!0,algorithm:"aes128"}):n.pki.privateKeyToPem(e)},r.getPublicKeyFingerprint=function(e,t){var i=(t=t||{}).md||n.md.md5.create(),r=n.util.createBuffer();s(r,"ssh-rsa"),o(r,e.e),o(r,e.n),i.start(),i.update(r.getBytes());var a=i.digest();if("hex"===t.encoding){var l=a.toHex();return t.delimiter?l.match(/.{2}/g).join(t.delimiter):l}if("binary"===t.encoding)return a.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return a}},43986:(e,t,i)=>{var n=i(50276);i(12746),i(71696),i(1267),i(2385),i(29255),i(89356),i(21598),i(7619);var r=function(e,t,i,r){var o=n.util.createBuffer(),s=e.length>>1,a=s+(1&e.length),l=e.substr(0,a),c=e.substr(s,a),u=n.util.createBuffer(),h=n.hmac.create();i=t+i;var d=Math.ceil(r/16),f=Math.ceil(r/20);h.start("MD5",l);var p=n.util.createBuffer();u.putBytes(i);for(var m=0;m<d;++m)h.start(null,null),h.update(u.getBytes()),u.putBuffer(h.digest()),h.start(null,null),h.update(u.bytes()+i),p.putBuffer(h.digest());h.start("SHA1",c);var g=n.util.createBuffer();u.clear(),u.putBytes(i);for(m=0;m<f;++m)h.start(null,null),h.update(u.getBytes()),u.putBuffer(h.digest()),h.start(null,null),h.update(u.bytes()+i),g.putBuffer(h.digest());return o.putBytes(n.util.xorBytes(p.getBytes(),g.getBytes(),r)),o},o=function(e,t,i){var r=!1;try{var o=e.deflate(t.fragment.getBytes());t.fragment=n.util.createBuffer(o),t.length=o.length,r=!0}catch(e){}return r},s=function(e,t,i){var r=!1;try{var o=e.inflate(t.fragment.getBytes());t.fragment=n.util.createBuffer(o),t.length=o.length,r=!0}catch(e){}return r},a=function(e,t){var i=0;switch(t){case 1:i=e.getByte();break;case 2:i=e.getInt16();break;case 3:i=e.getInt24();break;case 4:i=e.getInt32()}return n.util.createBuffer(e.getBytes(i))},l=function(e,t,i){e.putInt(i.length(),t<<3),e.putBuffer(i)},c={Versions:{TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}}};c.SupportedVersions=[c.Versions.TLS_1_1,c.Versions.TLS_1_0],c.Version=c.SupportedVersions[0],c.MaxFragment=15360,c.ConnectionEnd={server:0,client:1},c.PRFAlgorithm={tls_prf_sha256:0},c.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2},c.CipherType={stream:0,block:1,aead:2},c.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4},c.CompressionMethod={none:0,deflate:1},c.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24},c.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20},c.Alert={},c.Alert.Level={warning:1,fatal:2},c.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100},c.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2},c.CipherSuites={},c.getCipherSuite=function(e){var t=null;for(var i in c.CipherSuites){var n=c.CipherSuites[i];if(n.id[0]===e.charCodeAt(0)&&n.id[1]===e.charCodeAt(1)){t=n;break}}return t},c.handleUnexpected=function(e,t){!e.open&&e.entity===c.ConnectionEnd.client||e.error(e,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.unexpected_message}})},c.handleHelloRequest=function(e,t,i){!e.handshaking&&e.handshakes>0&&(c.queue(e,c.createAlert(e,{level:c.Alert.Level.warning,description:c.Alert.Description.no_renegotiation})),c.flush(e)),e.process()},c.parseHelloMessage=function(e,t,i){var r=null,o=e.entity===c.ConnectionEnd.client;if(i<38)e.error(e,{message:o?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.illegal_parameter}});else{var s=t.fragment,l=s.length();if(r={version:{major:s.getByte(),minor:s.getByte()},random:n.util.createBuffer(s.getBytes(32)),session_id:a(s,1),extensions:[]},o?(r.cipher_suite=s.getBytes(2),r.compression_method=s.getByte()):(r.cipher_suites=a(s,2),r.compression_methods=a(s,1)),(l=i-(l-s.length()))>0){for(var u=a(s,2);u.length()>0;)r.extensions.push({type:[u.getByte(),u.getByte()],data:a(u,2)});if(!o)for(var h=0;h<r.extensions.length;++h){var d=r.extensions[h];if(0===d.type[0]&&0===d.type[1])for(var f=a(d.data,2);f.length()>0;){if(0!==f.getByte())break;e.session.extensions.server_name.serverNameList.push(a(f,2).getBytes())}}}if(e.session.version&&(r.version.major!==e.session.version.major||r.version.minor!==e.session.version.minor))return e.error(e,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.protocol_version}});if(o)e.session.cipherSuite=c.getCipherSuite(r.cipher_suite);else for(var p=n.util.createBuffer(r.cipher_suites.bytes());p.length()>0&&(e.session.cipherSuite=c.getCipherSuite(p.getBytes(2)),null===e.session.cipherSuite););if(null===e.session.cipherSuite)return e.error(e,{message:"No cipher suites in common.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.handshake_failure},cipherSuite:n.util.bytesToHex(r.cipher_suite)});e.session.compressionMethod=o?r.compression_method:c.CompressionMethod.none}return r},c.createSecurityParameters=function(e,t){var i=e.entity===c.ConnectionEnd.client,n=t.random.bytes(),r=i?e.session.sp.client_random:n,o=i?n:c.createRandom().getBytes();e.session.sp={entity:e.entity,prf_algorithm:c.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:e.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:r,server_random:o}},c.handleServerHello=function(e,t,i){var n=c.parseHelloMessage(e,t,i);if(!e.fail){if(!(n.version.minor<=e.version.minor))return e.error(e,{message:"Incompatible TLS version.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.protocol_version}});e.version.minor=n.version.minor,e.session.version=e.version;var r=n.session_id.bytes();r.length>0&&r===e.session.id?(e.expect=p,e.session.resuming=!0,e.session.sp.server_random=n.random.bytes()):(e.expect=u,e.session.resuming=!1,c.createSecurityParameters(e,n)),e.session.id=r,e.process()}},c.handleClientHello=function(e,t,i){var r=c.parseHelloMessage(e,t,i);if(!e.fail){var o=r.session_id.bytes(),s=null;if(e.sessionCache&&(null===(s=e.sessionCache.getSession(o))?o="":(s.version.major!==r.version.major||s.version.minor>r.version.minor)&&(s=null,o="")),0===o.length&&(o=n.random.getBytes(32)),e.session.id=o,e.session.clientHelloVersion=r.version,e.session.sp={},s)e.version=e.session.version=s.version,e.session.sp=s.sp;else{for(var a,l=1;l<c.SupportedVersions.length&&!((a=c.SupportedVersions[l]).minor<=r.version.minor);++l);e.version={major:a.major,minor:a.minor},e.session.version=e.version}null!==s?(e.expect=_,e.session.resuming=!0,e.session.sp.client_random=r.random.bytes()):(e.expect=!1!==e.verifyClient?y:b,e.session.resuming=!1,c.createSecurityParameters(e,r)),e.open=!0,c.queue(e,c.createRecord(e,{type:c.ContentType.handshake,data:c.createServerHello(e)})),e.session.resuming?(c.queue(e,c.createRecord(e,{type:c.ContentType.change_cipher_spec,data:c.createChangeCipherSpec()})),e.state.pending=c.createConnectionState(e),e.state.current.write=e.state.pending.write,c.queue(e,c.createRecord(e,{type:c.ContentType.handshake,data:c.createFinished(e)}))):(c.queue(e,c.createRecord(e,{type:c.ContentType.handshake,data:c.createCertificate(e)})),e.fail||(c.queue(e,c.createRecord(e,{type:c.ContentType.handshake,data:c.createServerKeyExchange(e)})),!1!==e.verifyClient&&c.queue(e,c.createRecord(e,{type:c.ContentType.handshake,data:c.createCertificateRequest(e)})),c.queue(e,c.createRecord(e,{type:c.ContentType.handshake,data:c.createServerHelloDone(e)})))),c.flush(e),e.process()}},c.handleCertificate=function(e,t,i){if(i<3)return e.error(e,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.illegal_parameter}});var r,o,s=t.fragment,l={certificate_list:a(s,3)},u=[];try{for(;l.certificate_list.length()>0;)r=a(l.certificate_list,3),o=n.asn1.fromDer(r),r=n.pki.certificateFromAsn1(o,!0),u.push(r)}catch(t){return e.error(e,{message:"Could not parse certificate list.",cause:t,send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.bad_certificate}})}var d=e.entity===c.ConnectionEnd.client;!d&&!0!==e.verifyClient||0!==u.length?0===u.length?e.expect=d?h:b:(d?e.session.serverCertificate=u[0]:e.session.clientCertificate=u[0],c.verifyCertificateChain(e,u)&&(e.expect=d?h:b)):e.error(e,{message:d?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.illegal_parameter}}),e.process()},c.handleServerKeyExchange=function(e,t,i){if(i>0)return e.error(e,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.unsupported_certificate}});e.expect=d,e.process()},c.handleClientKeyExchange=function(e,t,i){if(i<48)return e.error(e,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.unsupported_certificate}});var r=t.fragment,o={enc_pre_master_secret:a(r,2).getBytes()},s=null;if(e.getPrivateKey)try{s=e.getPrivateKey(e,e.session.serverCertificate),s=n.pki.privateKeyFromPem(s)}catch(t){e.error(e,{message:"Could not get private key.",cause:t,send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.internal_error}})}if(null===s)return e.error(e,{message:"No private key set.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.internal_error}});try{var l=e.session.sp;l.pre_master_secret=s.decrypt(o.enc_pre_master_secret);var u=e.session.clientHelloVersion;if(u.major!==l.pre_master_secret.charCodeAt(0)||u.minor!==l.pre_master_secret.charCodeAt(1))throw new Error("TLS version rollback attack detected.")}catch(e){l.pre_master_secret=n.random.getBytes(48)}e.expect=_,null!==e.session.clientCertificate&&(e.expect=x),e.process()},c.handleCertificateRequest=function(e,t,i){if(i<3)return e.error(e,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.illegal_parameter}});var n=t.fragment,r={certificate_types:a(n,1),certificate_authorities:a(n,2)};e.session.certificateRequest=r,e.expect=f,e.process()},c.handleCertificateVerify=function(e,t,i){if(i<2)return e.error(e,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.illegal_parameter}});var r=t.fragment;r.read-=4;var o=r.bytes();r.read+=4;var s={signature:a(r,2).getBytes()},l=n.util.createBuffer();l.putBuffer(e.session.md5.digest()),l.putBuffer(e.session.sha1.digest()),l=l.getBytes();try{if(!e.session.clientCertificate.publicKey.verify(l,s.signature,"NONE"))throw new Error("CertificateVerify signature does not match.");e.session.md5.update(o),e.session.sha1.update(o)}catch(t){return e.error(e,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.handshake_failure}})}e.expect=_,e.process()},c.handleServerHelloDone=function(e,t,i){if(i>0)return e.error(e,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.record_overflow}});if(null===e.serverCertificate){var r={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.insufficient_security}},o=e.verify(e,r.alert.description,0,[]);if(!0!==o)return(o||0===o)&&("object"!=typeof o||n.util.isArray(o)?"number"==typeof o&&(r.alert.description=o):(o.message&&(r.message=o.message),o.alert&&(r.alert.description=o.alert))),e.error(e,r)}null!==e.session.certificateRequest&&(t=c.createRecord(e,{type:c.ContentType.handshake,data:c.createCertificate(e)}),c.queue(e,t)),t=c.createRecord(e,{type:c.ContentType.handshake,data:c.createClientKeyExchange(e)}),c.queue(e,t),e.expect=v;var s=function(e,t){null!==e.session.certificateRequest&&null!==e.session.clientCertificate&&c.queue(e,c.createRecord(e,{type:c.ContentType.handshake,data:c.createCertificateVerify(e,t)})),c.queue(e,c.createRecord(e,{type:c.ContentType.change_cipher_spec,data:c.createChangeCipherSpec()})),e.state.pending=c.createConnectionState(e),e.state.current.write=e.state.pending.write,c.queue(e,c.createRecord(e,{type:c.ContentType.handshake,data:c.createFinished(e)})),e.expect=p,c.flush(e),e.process()};if(null===e.session.certificateRequest||null===e.session.clientCertificate)return s(e,null);c.getClientSignature(e,s)},c.handleChangeCipherSpec=function(e,t){if(1!==t.fragment.getByte())return e.error(e,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.illegal_parameter}});var i=e.entity===c.ConnectionEnd.client;(e.session.resuming&&i||!e.session.resuming&&!i)&&(e.state.pending=c.createConnectionState(e)),e.state.current.read=e.state.pending.read,(!e.session.resuming&&i||e.session.resuming&&!i)&&(e.state.pending=null),e.expect=i?m:E,e.process()},c.handleFinished=function(e,t,i){var o=t.fragment;o.read-=4;var s=o.bytes();o.read+=4;var a=t.fragment.getBytes();(o=n.util.createBuffer()).putBuffer(e.session.md5.digest()),o.putBuffer(e.session.sha1.digest());var l=e.entity===c.ConnectionEnd.client,u=l?"server finished":"client finished",h=e.session.sp;if((o=r(h.master_secret,u,o.getBytes(),12)).getBytes()!==a)return e.error(e,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.decrypt_error}});e.session.md5.update(s),e.session.sha1.update(s),(e.session.resuming&&l||!e.session.resuming&&!l)&&(c.queue(e,c.createRecord(e,{type:c.ContentType.change_cipher_spec,data:c.createChangeCipherSpec()})),e.state.current.write=e.state.pending.write,e.state.pending=null,c.queue(e,c.createRecord(e,{type:c.ContentType.handshake,data:c.createFinished(e)}))),e.expect=l?g:S,e.handshaking=!1,++e.handshakes,e.peerCertificate=l?e.session.serverCertificate:e.session.clientCertificate,c.flush(e),e.isConnected=!0,e.connected(e),e.process()},c.handleAlert=function(e,t){var i,n=t.fragment,r={level:n.getByte(),description:n.getByte()};switch(r.description){case c.Alert.Description.close_notify:i="Connection closed.";break;case c.Alert.Description.unexpected_message:i="Unexpected message.";break;case c.Alert.Description.bad_record_mac:i="Bad record MAC.";break;case c.Alert.Description.decryption_failed:i="Decryption failed.";break;case c.Alert.Description.record_overflow:i="Record overflow.";break;case c.Alert.Description.decompression_failure:i="Decompression failed.";break;case c.Alert.Description.handshake_failure:i="Handshake failure.";break;case c.Alert.Description.bad_certificate:i="Bad certificate.";break;case c.Alert.Description.unsupported_certificate:i="Unsupported certificate.";break;case c.Alert.Description.certificate_revoked:i="Certificate revoked.";break;case c.Alert.Description.certificate_expired:i="Certificate expired.";break;case c.Alert.Description.certificate_unknown:i="Certificate unknown.";break;case c.Alert.Description.illegal_parameter:i="Illegal parameter.";break;case c.Alert.Description.unknown_ca:i="Unknown certificate authority.";break;case c.Alert.Description.access_denied:i="Access denied.";break;case c.Alert.Description.decode_error:i="Decode error.";break;case c.Alert.Description.decrypt_error:i="Decrypt error.";break;case c.Alert.Description.export_restriction:i="Export restriction.";break;case c.Alert.Description.protocol_version:i="Unsupported protocol version.";break;case c.Alert.Description.insufficient_security:i="Insufficient security.";break;case c.Alert.Description.internal_error:i="Internal error.";break;case c.Alert.Description.user_canceled:i="User canceled.";break;case c.Alert.Description.no_renegotiation:i="Renegotiation not supported.";break;default:i="Unknown error."}if(r.description===c.Alert.Description.close_notify)return e.close();e.error(e,{message:i,send:!1,origin:e.entity===c.ConnectionEnd.client?"server":"client",alert:r}),e.process()},c.handleHandshake=function(e,t){var i=t.fragment,r=i.getByte(),o=i.getInt24();if(o>i.length())return e.fragmented=t,t.fragment=n.util.createBuffer(),i.read-=4,e.process();e.fragmented=null,i.read-=4;var s=i.bytes(o+4);i.read+=4,r in k[e.entity][e.expect]?(e.entity!==c.ConnectionEnd.server||e.open||e.fail||(e.handshaking=!0,e.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:n.md.md5.create(),sha1:n.md.sha1.create()}),r!==c.HandshakeType.hello_request&&r!==c.HandshakeType.certificate_verify&&r!==c.HandshakeType.finished&&(e.session.md5.update(s),e.session.sha1.update(s)),k[e.entity][e.expect][r](e,t,o)):c.handleUnexpected(e,t)},c.handleApplicationData=function(e,t){e.data.putBuffer(t.fragment),e.dataReady(e),e.process()},c.handleHeartbeat=function(e,t){var i=t.fragment,r=i.getByte(),o=i.getInt16(),s=i.getBytes(o);if(r===c.HeartbeatMessageType.heartbeat_request){if(e.handshaking||o>s.length)return e.process();c.queue(e,c.createRecord(e,{type:c.ContentType.heartbeat,data:c.createHeartbeat(c.HeartbeatMessageType.heartbeat_response,s)})),c.flush(e)}else if(r===c.HeartbeatMessageType.heartbeat_response){if(s!==e.expectedHeartbeatPayload)return e.process();e.heartbeatReceived&&e.heartbeatReceived(e,n.util.createBuffer(s))}e.process()};var u=1,h=2,d=3,f=4,p=5,m=6,g=7,v=8,y=1,b=2,x=3,_=4,E=5,S=6,A=c.handleUnexpected,w=c.handleChangeCipherSpec,C=c.handleAlert,T=c.handleHandshake,M=c.handleApplicationData,I=c.handleHeartbeat,P=[];P[c.ConnectionEnd.client]=[[A,C,T,A,I],[A,C,T,A,I],[A,C,T,A,I],[A,C,T,A,I],[A,C,T,A,I],[w,C,A,A,I],[A,C,T,A,I],[A,C,T,M,I],[A,C,T,A,I]],P[c.ConnectionEnd.server]=[[A,C,T,A,I],[A,C,T,A,I],[A,C,T,A,I],[A,C,T,A,I],[w,C,A,A,I],[A,C,T,A,I],[A,C,T,M,I],[A,C,T,A,I]];var L=c.handleHelloRequest,R=c.handleServerHello,D=c.handleCertificate,O=c.handleServerKeyExchange,B=c.handleCertificateRequest,N=c.handleServerHelloDone,U=c.handleFinished,k=[];k[c.ConnectionEnd.client]=[[A,A,R,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[L,A,A,A,A,A,A,A,A,A,A,D,O,B,N,A,A,A,A,A,A],[L,A,A,A,A,A,A,A,A,A,A,A,O,B,N,A,A,A,A,A,A],[L,A,A,A,A,A,A,A,A,A,A,A,A,B,N,A,A,A,A,A,A],[L,A,A,A,A,A,A,A,A,A,A,A,A,A,N,A,A,A,A,A,A],[L,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[L,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,U],[L,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[L,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]];var F=c.handleClientHello,V=c.handleClientKeyExchange,G=c.handleCertificateVerify;k[c.ConnectionEnd.server]=[[A,F,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[A,A,A,A,A,A,A,A,A,A,A,D,A,A,A,A,A,A,A,A,A],[A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,V,A,A,A,A],[A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,G,A,A,A,A,A],[A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,U],[A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]],c.generateKeys=function(e,t){var i=r,n=t.client_random+t.server_random;e.session.resuming||(t.master_secret=i(t.pre_master_secret,"master secret",n,48).bytes(),t.pre_master_secret=null),n=t.server_random+t.client_random;var o=2*t.mac_key_length+2*t.enc_key_length,s=e.version.major===c.Versions.TLS_1_0.major&&e.version.minor===c.Versions.TLS_1_0.minor;s&&(o+=2*t.fixed_iv_length);var a=i(t.master_secret,"key expansion",n,o),l={client_write_MAC_key:a.getBytes(t.mac_key_length),server_write_MAC_key:a.getBytes(t.mac_key_length),client_write_key:a.getBytes(t.enc_key_length),server_write_key:a.getBytes(t.enc_key_length)};return s&&(l.client_write_IV=a.getBytes(t.fixed_iv_length),l.server_write_IV=a.getBytes(t.fixed_iv_length)),l},c.createConnectionState=function(e){var t=e.entity===c.ConnectionEnd.client,i=function(){var e={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(e){return!0},compressionState:null,compressFunction:function(e){return!0},updateSequenceNumber:function(){4294967295===e.sequenceNumber[1]?(e.sequenceNumber[1]=0,++e.sequenceNumber[0]):++e.sequenceNumber[1]}};return e},n={read:i(),write:i()};if(n.read.update=function(e,t){return n.read.cipherFunction(t,n.read)?n.read.compressFunction(e,t,n.read)||e.error(e,{message:"Could not decompress record.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.decompression_failure}}):e.error(e,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.bad_record_mac}}),!e.fail},n.write.update=function(e,t){return n.write.compressFunction(e,t,n.write)?n.write.cipherFunction(t,n.write)||e.error(e,{message:"Could not encrypt record.",send:!1,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.internal_error}}):e.error(e,{message:"Could not compress record.",send:!1,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.internal_error}}),!e.fail},e.session){var r=e.session.sp;switch(e.session.cipherSuite.initSecurityParameters(r),r.keys=c.generateKeys(e,r),n.read.macKey=t?r.keys.server_write_MAC_key:r.keys.client_write_MAC_key,n.write.macKey=t?r.keys.client_write_MAC_key:r.keys.server_write_MAC_key,e.session.cipherSuite.initConnectionState(n,e,r),r.compression_algorithm){case c.CompressionMethod.none:break;case c.CompressionMethod.deflate:n.read.compressFunction=s,n.write.compressFunction=o;break;default:throw new Error("Unsupported compression algorithm.")}}return n},c.createRandom=function(){var e=new Date,t=+e+6e4*e.getTimezoneOffset(),i=n.util.createBuffer();return i.putInt32(t),i.putBytes(n.random.getBytes(28)),i},c.createRecord=function(e,t){return t.data?{type:t.type,version:{major:e.version.major,minor:e.version.minor},length:t.data.length(),fragment:t.data}:null},c.createAlert=function(e,t){var i=n.util.createBuffer();return i.putByte(t.level),i.putByte(t.description),c.createRecord(e,{type:c.ContentType.alert,data:i})},c.createClientHello=function(e){e.session.clientHelloVersion={major:e.version.major,minor:e.version.minor};for(var t=n.util.createBuffer(),i=0;i<e.cipherSuites.length;++i){var r=e.cipherSuites[i];t.putByte(r.id[0]),t.putByte(r.id[1])}var o=t.length(),s=n.util.createBuffer();s.putByte(c.CompressionMethod.none);var a=s.length(),u=n.util.createBuffer();if(e.virtualHost){var h=n.util.createBuffer();h.putByte(0),h.putByte(0);var d=n.util.createBuffer();d.putByte(0),l(d,2,n.util.createBuffer(e.virtualHost));var f=n.util.createBuffer();l(f,2,d),l(h,2,f),u.putBuffer(h)}var p=u.length();p>0&&(p+=2);var m=e.session.id,g=m.length+1+2+4+28+2+o+1+a+p,v=n.util.createBuffer();return v.putByte(c.HandshakeType.client_hello),v.putInt24(g),v.putByte(e.version.major),v.putByte(e.version.minor),v.putBytes(e.session.sp.client_random),l(v,1,n.util.createBuffer(m)),l(v,2,t),l(v,1,s),p>0&&l(v,2,u),v},c.createServerHello=function(e){var t=e.session.id,i=t.length+1+2+4+28+2+1,r=n.util.createBuffer();return r.putByte(c.HandshakeType.server_hello),r.putInt24(i),r.putByte(e.version.major),r.putByte(e.version.minor),r.putBytes(e.session.sp.server_random),l(r,1,n.util.createBuffer(t)),r.putByte(e.session.cipherSuite.id[0]),r.putByte(e.session.cipherSuite.id[1]),r.putByte(e.session.compressionMethod),r},c.createCertificate=function(e){var t,i=e.entity===c.ConnectionEnd.client,r=null;e.getCertificate&&(t=i?e.session.certificateRequest:e.session.extensions.server_name.serverNameList,r=e.getCertificate(e,t));var o=n.util.createBuffer();if(null!==r)try{n.util.isArray(r)||(r=[r]);for(var s=null,a=0;a<r.length;++a){var u=n.pem.decode(r[a])[0];if("CERTIFICATE"!==u.type&&"X509 CERTIFICATE"!==u.type&&"TRUSTED CERTIFICATE"!==u.type){var h=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw h.headerType=u.type,h}if(u.procType&&"ENCRYPTED"===u.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var d=n.util.createBuffer(u.body);null===s&&(s=n.asn1.fromDer(d.bytes(),!1));var f=n.util.createBuffer();l(f,3,d),o.putBuffer(f)}r=n.pki.certificateFromAsn1(s),i?e.session.clientCertificate=r:e.session.serverCertificate=r}catch(t){return e.error(e,{message:"Could not send certificate list.",cause:t,send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.bad_certificate}})}var p=3+o.length(),m=n.util.createBuffer();return m.putByte(c.HandshakeType.certificate),m.putInt24(p),l(m,3,o),m},c.createClientKeyExchange=function(e){var t=n.util.createBuffer();t.putByte(e.session.clientHelloVersion.major),t.putByte(e.session.clientHelloVersion.minor),t.putBytes(n.random.getBytes(46));var i=e.session.sp;i.pre_master_secret=t.getBytes();var r=(t=e.session.serverCertificate.publicKey.encrypt(i.pre_master_secret)).length+2,o=n.util.createBuffer();return o.putByte(c.HandshakeType.client_key_exchange),o.putInt24(r),o.putInt16(t.length),o.putBytes(t),o},c.createServerKeyExchange=function(e){var t=n.util.createBuffer();return t},c.getClientSignature=function(e,t){var i=n.util.createBuffer();i.putBuffer(e.session.md5.digest()),i.putBuffer(e.session.sha1.digest()),i=i.getBytes(),e.getSignature=e.getSignature||function(e,t,i){var r=null;if(e.getPrivateKey)try{r=e.getPrivateKey(e,e.session.clientCertificate),r=n.pki.privateKeyFromPem(r)}catch(t){e.error(e,{message:"Could not get private key.",cause:t,send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.internal_error}})}null===r?e.error(e,{message:"No private key set.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.internal_error}}):t=r.sign(t,null),i(e,t)},e.getSignature(e,i,t)},c.createCertificateVerify=function(e,t){var i=t.length+2,r=n.util.createBuffer();return r.putByte(c.HandshakeType.certificate_verify),r.putInt24(i),r.putInt16(t.length),r.putBytes(t),r},c.createCertificateRequest=function(e){var t=n.util.createBuffer();t.putByte(1);var i=n.util.createBuffer();for(var r in e.caStore.certs){var o=e.caStore.certs[r],s=n.pki.distinguishedNameToAsn1(o.subject),a=n.asn1.toDer(s);i.putInt16(a.length()),i.putBuffer(a)}var u=1+t.length()+2+i.length(),h=n.util.createBuffer();return h.putByte(c.HandshakeType.certificate_request),h.putInt24(u),l(h,1,t),l(h,2,i),h},c.createServerHelloDone=function(e){var t=n.util.createBuffer();return t.putByte(c.HandshakeType.server_hello_done),t.putInt24(0),t},c.createChangeCipherSpec=function(){var e=n.util.createBuffer();return e.putByte(1),e},c.createFinished=function(e){var t=n.util.createBuffer();t.putBuffer(e.session.md5.digest()),t.putBuffer(e.session.sha1.digest());var i=e.entity===c.ConnectionEnd.client,o=e.session.sp,s=i?"client finished":"server finished";t=r(o.master_secret,s,t.getBytes(),12);var a=n.util.createBuffer();return a.putByte(c.HandshakeType.finished),a.putInt24(t.length()),a.putBuffer(t),a},c.createHeartbeat=function(e,t,i){void 0===i&&(i=t.length);var r=n.util.createBuffer();r.putByte(e),r.putInt16(i),r.putBytes(t);var o=r.length(),s=Math.max(16,o-i-3);return r.putBytes(n.random.getBytes(s)),r},c.queue=function(e,t){if(t&&(0!==t.fragment.length()||t.type!==c.ContentType.handshake&&t.type!==c.ContentType.alert&&t.type!==c.ContentType.change_cipher_spec)){if(t.type===c.ContentType.handshake){var i=t.fragment.bytes();e.session.md5.update(i),e.session.sha1.update(i),i=null}var r;if(t.fragment.length()<=c.MaxFragment)r=[t];else{r=[];for(var o=t.fragment.bytes();o.length>c.MaxFragment;)r.push(c.createRecord(e,{type:t.type,data:n.util.createBuffer(o.slice(0,c.MaxFragment))})),o=o.slice(c.MaxFragment);o.length>0&&r.push(c.createRecord(e,{type:t.type,data:n.util.createBuffer(o)}))}for(var s=0;s<r.length&&!e.fail;++s){var a=r[s];e.state.current.write.update(e,a)&&e.records.push(a)}}},c.flush=function(e){for(var t=0;t<e.records.length;++t){var i=e.records[t];e.tlsData.putByte(i.type),e.tlsData.putByte(i.version.major),e.tlsData.putByte(i.version.minor),e.tlsData.putInt16(i.fragment.length()),e.tlsData.putBuffer(e.records[t].fragment)}return e.records=[],e.tlsDataReady(e)};var z=function(e){switch(e){case!0:return!0;case n.pki.certificateError.bad_certificate:return c.Alert.Description.bad_certificate;case n.pki.certificateError.unsupported_certificate:return c.Alert.Description.unsupported_certificate;case n.pki.certificateError.certificate_revoked:return c.Alert.Description.certificate_revoked;case n.pki.certificateError.certificate_expired:return c.Alert.Description.certificate_expired;case n.pki.certificateError.certificate_unknown:return c.Alert.Description.certificate_unknown;case n.pki.certificateError.unknown_ca:return c.Alert.Description.unknown_ca;default:return c.Alert.Description.bad_certificate}};for(var H in c.verifyCertificateChain=function(e,t){try{var i={};for(var r in e.verifyOptions)i[r]=e.verifyOptions[r];i.verify=function(t,i,r){z(t);var o=e.verify(e,t,i,r);if(!0!==o){if("object"==typeof o&&!n.util.isArray(o)){var s=new Error("The application rejected the certificate.");throw s.send=!0,s.alert={level:c.Alert.Level.fatal,description:c.Alert.Description.bad_certificate},o.message&&(s.message=o.message),o.alert&&(s.alert.description=o.alert),s}o!==t&&(o=function(e){switch(e){case!0:return!0;case c.Alert.Description.bad_certificate:return n.pki.certificateError.bad_certificate;case c.Alert.Description.unsupported_certificate:return n.pki.certificateError.unsupported_certificate;case c.Alert.Description.certificate_revoked:return n.pki.certificateError.certificate_revoked;case c.Alert.Description.certificate_expired:return n.pki.certificateError.certificate_expired;case c.Alert.Description.certificate_unknown:return n.pki.certificateError.certificate_unknown;case c.Alert.Description.unknown_ca:return n.pki.certificateError.unknown_ca;default:return n.pki.certificateError.bad_certificate}}(o))}return o},n.pki.verifyCertificateChain(e.caStore,t,i)}catch(t){var o=t;("object"!=typeof o||n.util.isArray(o))&&(o={send:!0,alert:{level:c.Alert.Level.fatal,description:z(t)}}),"send"in o||(o.send=!0),"alert"in o||(o.alert={level:c.Alert.Level.fatal,description:z(o.error)}),e.error(e,o)}return!e.fail},c.createSessionCache=function(e,t){var i=null;if(e&&e.getSession&&e.setSession&&e.order)i=e;else{for(var r in(i={}).cache=e||{},i.capacity=Math.max(t||100,1),i.order=[],e)i.order.length<=t?i.order.push(r):delete e[r];i.getSession=function(e){var t=null,r=null;if(e?r=n.util.bytesToHex(e):i.order.length>0&&(r=i.order[0]),null!==r&&r in i.cache)for(var o in t=i.cache[r],delete i.cache[r],i.order)if(i.order[o]===r){i.order.splice(o,1);break}return t},i.setSession=function(e,t){if(i.order.length===i.capacity){var r=i.order.shift();delete i.cache[r]}r=n.util.bytesToHex(e);i.order.push(r),i.cache[r]=t}}return i},c.createConnection=function(e){var t=null;t=e.caStore?n.util.isArray(e.caStore)?n.pki.createCaStore(e.caStore):e.caStore:n.pki.createCaStore();var i=e.cipherSuites||null;if(null===i)for(var r in i=[],c.CipherSuites)i.push(c.CipherSuites[r]);var o=e.server?c.ConnectionEnd.server:c.ConnectionEnd.client,s=e.sessionCache?c.createSessionCache(e.sessionCache):null,a={version:{major:c.Version.major,minor:c.Version.minor},entity:o,sessionId:e.sessionId,caStore:t,sessionCache:s,cipherSuites:i,connected:e.connected,virtualHost:e.virtualHost||null,verifyClient:e.verifyClient||!1,verify:e.verify||function(e,t,i,n){return t},verifyOptions:e.verifyOptions||{},getCertificate:e.getCertificate||null,getPrivateKey:e.getPrivateKey||null,getSignature:e.getSignature||null,input:n.util.createBuffer(),tlsData:n.util.createBuffer(),data:n.util.createBuffer(),tlsDataReady:e.tlsDataReady,dataReady:e.dataReady,heartbeatReceived:e.heartbeatReceived,closed:e.closed,error:function(t,i){i.origin=i.origin||(t.entity===c.ConnectionEnd.client?"client":"server"),i.send&&(c.queue(t,c.createAlert(t,i.alert)),c.flush(t));var n=!1!==i.fatal;n&&(t.fail=!0),e.error(t,i),n&&t.close(!1)},deflate:e.deflate||null,inflate:e.inflate||null,reset:function(e){a.version={major:c.Version.major,minor:c.Version.minor},a.record=null,a.session=null,a.peerCertificate=null,a.state={pending:null,current:null},a.expect=(a.entity,c.ConnectionEnd.client,0),a.fragmented=null,a.records=[],a.open=!1,a.handshakes=0,a.handshaking=!1,a.isConnected=!1,a.fail=!(e||void 0===e),a.input.clear(),a.tlsData.clear(),a.data.clear(),a.state.current=c.createConnectionState(a)}};a.reset();return a.handshake=function(e){if(a.entity!==c.ConnectionEnd.client)a.error(a,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(a.handshaking)a.error(a,{message:"Handshake already in progress.",fatal:!1});else{a.fail&&!a.open&&0===a.handshakes&&(a.fail=!1),a.handshaking=!0;var t=null;(e=e||"").length>0&&(a.sessionCache&&(t=a.sessionCache.getSession(e)),null===t&&(e="")),0===e.length&&a.sessionCache&&null!==(t=a.sessionCache.getSession())&&(e=t.id),a.session={id:e,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:n.md.md5.create(),sha1:n.md.sha1.create()},t&&(a.version=t.version,a.session.sp=t.sp),a.session.sp.client_random=c.createRandom().getBytes(),a.open=!0,c.queue(a,c.createRecord(a,{type:c.ContentType.handshake,data:c.createClientHello(a)})),c.flush(a)}},a.process=function(e){var t=0;return e&&a.input.putBytes(e),a.fail||(null!==a.record&&a.record.ready&&a.record.fragment.isEmpty()&&(a.record=null),null===a.record&&(t=function(e){var t=0,i=e.input,r=i.length();if(r<5)t=5-r;else{e.record={type:i.getByte(),version:{major:i.getByte(),minor:i.getByte()},length:i.getInt16(),fragment:n.util.createBuffer(),ready:!1};var o=e.record.version.major===e.version.major;o&&e.session&&e.session.version&&(o=e.record.version.minor===e.version.minor),o||e.error(e,{message:"Incompatible TLS version.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.protocol_version}})}return t}(a)),a.fail||null===a.record||a.record.ready||(t=function(e){var t=0,i=e.input,n=i.length();return n<e.record.length?t=e.record.length-n:(e.record.fragment.putBytes(i.getBytes(e.record.length)),i.compact(),e.state.current.read.update(e,e.record)&&(null!==e.fragmented&&(e.fragmented.type===e.record.type?(e.fragmented.fragment.putBuffer(e.record.fragment),e.record=e.fragmented):e.error(e,{message:"Invalid fragmented record.",send:!0,alert:{level:c.Alert.Level.fatal,description:c.Alert.Description.unexpected_message}})),e.record.ready=!0)),t}(a)),!a.fail&&null!==a.record&&a.record.ready&&function(e,t){var i=t.type-c.ContentType.change_cipher_spec,n=P[e.entity][e.expect];i in n?n[i](e,t):c.handleUnexpected(e,t)}(a,a.record)),t},a.prepare=function(e){return c.queue(a,c.createRecord(a,{type:c.ContentType.application_data,data:n.util.createBuffer(e)})),c.flush(a)},a.prepareHeartbeatRequest=function(e,t){return e instanceof n.util.ByteBuffer&&(e=e.bytes()),void 0===t&&(t=e.length),a.expectedHeartbeatPayload=e,c.queue(a,c.createRecord(a,{type:c.ContentType.heartbeat,data:c.createHeartbeat(c.HeartbeatMessageType.heartbeat_request,e,t)})),c.flush(a)},a.close=function(e){if(!a.fail&&a.sessionCache&&a.session){var t={id:a.session.id,version:a.session.version,sp:a.session.sp};t.sp.keys=null,a.sessionCache.setSession(t.id,t)}a.open&&(a.open=!1,a.input.clear(),(a.isConnected||a.handshaking)&&(a.isConnected=a.handshaking=!1,c.queue(a,c.createAlert(a,{level:c.Alert.Level.warning,description:c.Alert.Description.close_notify})),c.flush(a)),a.closed(a)),a.reset(e)},a},e.exports=n.tls=n.tls||{},c)"function"!=typeof c[H]&&(n.tls[H]=c[H]);n.tls.prf_tls1=r,n.tls.hmac_sha1=function(e,t,i){var r=n.hmac.create();r.start("SHA1",e);var o=n.util.createBuffer();return o.putInt32(t[0]),o.putInt32(t[1]),o.putByte(i.type),o.putByte(i.version.major),o.putByte(i.version.minor),o.putInt16(i.length),o.putBytes(i.fragment.bytes()),r.update(o.getBytes()),r.digest().getBytes()},n.tls.createSessionCache=c.createSessionCache,n.tls.createConnection=c.createConnection},7619:(e,t,i)=>{var n=i(50276),r=i(44058),o=e.exports=n.util=n.util||{};function s(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function a(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(o.isArrayBuffer(e)||o.isArrayBufferView(e))if("undefined"!=typeof Buffer&&e instanceof Buffer)this.data=e.toString("binary");else{var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(e){for(var i=0;i<t.length;++i)this.putByte(t[i])}}else(e instanceof a||"object"==typeof e&&"string"==typeof e.data&&"number"==typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}!function(){if("undefined"!=typeof process&&process.nextTick&&!process.browser)return o.nextTick=process.nextTick,void("function"==typeof setImmediate?o.setImmediate=setImmediate:o.setImmediate=o.nextTick);if("function"==typeof setImmediate)return o.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(o.nextTick=function(e){return setImmediate(e)});if(o.setImmediate=function(e){setTimeout(e,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var e="forge.setImmediate",t=[];o.setImmediate=function(i){t.push(i),1===t.length&&window.postMessage(e,"*")},window.addEventListener("message",(function(i){if(i.source===window&&i.data===e){i.stopPropagation();var n=t.slice();t.length=0,n.forEach((function(e){e()}))}}),!0)}if("undefined"!=typeof MutationObserver){var i=Date.now(),n=!0,r=document.createElement("div");t=[];new MutationObserver((function(){var e=t.slice();t.length=0,e.forEach((function(e){e()}))})).observe(r,{attributes:!0});var s=o.setImmediate;o.setImmediate=function(e){Date.now()-i>15?(i=Date.now(),s(e)):(t.push(e),1===t.length&&r.setAttribute("a",n=!n))}}o.nextTick=o.setImmediate}(),o.isNodejs="undefined"!=typeof process&&process.versions&&process.versions.node,o.globalScope=o.isNodejs?i.g:"undefined"==typeof self?window:self,o.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},o.isArrayBufferView=function(e){return e&&o.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},o.ByteBuffer=a,o.ByteStringBuffer=a;o.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>4096&&(this.data.substr(0,1),this._constructedStringLength=0)},o.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},o.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},o.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},o.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var i=this.data;t>0;)1&t&&(i+=e),(t>>>=1)>0&&(e+=e);return this.data=i,this._optimizeConstructedString(t),this},o.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},o.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(o.encodeUtf8(e))},o.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},o.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},o.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},o.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},o.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},o.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},o.ByteStringBuffer.prototype.putInt=function(e,t){s(t);var i="";do{t-=8,i+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(i)},o.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},o.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},o.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},o.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},o.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},o.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},o.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},o.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},o.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},o.ByteStringBuffer.prototype.getInt=function(e){s(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},o.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),i=2<<e-2;return t>=i&&(t-=i<<1),t},o.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},o.ByteStringBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},o.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},o.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},o.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},o.ByteStringBuffer.prototype.copy=function(){var e=o.createBuffer(this.data);return e.read=this.read,e},o.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},o.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},o.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},o.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var i=this.data.charCodeAt(t);i<16&&(e+="0"),e+=i.toString(16)}return e},o.ByteStringBuffer.prototype.toString=function(){return o.decodeUtf8(this.bytes())},o.DataBuffer=function(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var i=o.isArrayBuffer(e),n=o.isArrayBufferView(e);if(i||n)return this.data=i?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},o.DataBuffer.prototype.length=function(){return this.write-this.read},o.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},o.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var i=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+t);return n.set(i),this.data=new DataView(n.buffer),this},o.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},o.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var i=0;i<t;++i)this.data.setUint8(e);return this},o.DataBuffer.prototype.putBytes=function(e,t){if(o.isArrayBufferView(e)){var i=(n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-n.byteOffset;return this.accommodate(i),new Uint8Array(this.data.buffer,this.write).set(n),this.write+=i,this}if(o.isArrayBuffer(e)){var n=new Uint8Array(e);return this.accommodate(n.byteLength),new Uint8Array(this.data.buffer).set(n,this.write),this.write+=n.byteLength,this}if(e instanceof o.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&o.isArrayBufferView(e.data)){n=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(n.byteLength),new Uint8Array(e.data.byteLength,this.write).set(n),this.write+=n.byteLength,this}if(e instanceof o.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"==typeof e){var r;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),r=new Uint8Array(this.data.buffer,this.write),this.write+=o.binary.hex.decode(e,r,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),r=new Uint8Array(this.data.buffer,this.write),this.write+=o.binary.base64.decode(e,r,this.write),this;if("utf8"===t&&(e=o.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),r=new Uint8Array(this.data.buffer,this.write),this.write+=o.binary.raw.decode(r),this;if("utf16"===t)return this.accommodate(2*e.length),r=new Uint16Array(this.data.buffer,this.write),this.write+=o.text.utf16.encode(r),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},o.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},o.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},o.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},o.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},o.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},o.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},o.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},o.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},o.DataBuffer.prototype.putInt=function(e,t){s(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},o.DataBuffer.prototype.putSignedInt=function(e,t){return s(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},o.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},o.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},o.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},o.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},o.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},o.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},o.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},o.DataBuffer.prototype.getInt=function(e){s(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},o.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),i=2<<e-2;return t>=i&&(t-=i<<1),t},o.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},o.DataBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},o.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},o.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},o.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},o.DataBuffer.prototype.copy=function(){return new o.DataBuffer(this)},o.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},o.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},o.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},o.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var i=this.data.getUint8(t);i<16&&(e+="0"),e+=i.toString(16)}return e},o.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return o.binary.raw.encode(t);if("hex"===e)return o.binary.hex.encode(t);if("base64"===e)return o.binary.base64.encode(t);if("utf8"===e)return o.text.utf8.decode(t);if("utf16"===e)return o.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},o.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=o.encodeUtf8(e)),new o.ByteBuffer(e)},o.fillString=function(e,t){for(var i="";t>0;)1&t&&(i+=e),(t>>>=1)>0&&(e+=e);return i},o.xorBytes=function(e,t,i){for(var n="",r="",o="",s=0,a=0;i>0;--i,++s)r=e.charCodeAt(s)^t.charCodeAt(s),a>=10&&(n+=o,o="",a=0),o+=String.fromCharCode(r),++a;return n+=o},o.hexToBytes=function(e){var t="",i=0;for(!0&e.length&&(i=1,t+=String.fromCharCode(parseInt(e[0],16)));i<e.length;i+=2)t+=String.fromCharCode(parseInt(e.substr(i,2),16));return t},o.bytesToHex=function(e){return o.createBuffer(e).toHex()},o.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],u="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";o.encode64=function(e,t){for(var i,n,r,o="",s="",a=0;a<e.length;)i=e.charCodeAt(a++),n=e.charCodeAt(a++),r=e.charCodeAt(a++),o+=l.charAt(i>>2),o+=l.charAt((3&i)<<4|n>>4),isNaN(n)?o+="==":(o+=l.charAt((15&n)<<2|r>>6),o+=isNaN(r)?"=":l.charAt(63&r)),t&&o.length>t&&(s+=o.substr(0,t)+"\r\n",o=o.substr(t));return s+=o},o.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,i,n,r,o="",s=0;s<e.length;)t=c[e.charCodeAt(s++)-43],i=c[e.charCodeAt(s++)-43],n=c[e.charCodeAt(s++)-43],r=c[e.charCodeAt(s++)-43],o+=String.fromCharCode(t<<2|i>>4),64!==n&&(o+=String.fromCharCode((15&i)<<4|n>>2),64!==r&&(o+=String.fromCharCode((3&n)<<6|r)));return o},o.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},o.decodeUtf8=function(e){return decodeURIComponent(escape(e))},o.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:r.encode,decode:r.decode}},o.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},o.binary.raw.decode=function(e,t,i){var n=t;n||(n=new Uint8Array(e.length));for(var r=i=i||0,o=0;o<e.length;++o)n[r++]=e.charCodeAt(o);return t?r-i:n},o.binary.hex.encode=o.bytesToHex,o.binary.hex.decode=function(e,t,i){var n=t;n||(n=new Uint8Array(Math.ceil(e.length/2)));var r=0,o=i=i||0;for(1&e.length&&(r=1,n[o++]=parseInt(e[0],16));r<e.length;r+=2)n[o++]=parseInt(e.substr(r,2),16);return t?o-i:n},o.binary.base64.encode=function(e,t){for(var i,n,r,o="",s="",a=0;a<e.byteLength;)i=e[a++],n=e[a++],r=e[a++],o+=l.charAt(i>>2),o+=l.charAt((3&i)<<4|n>>4),isNaN(n)?o+="==":(o+=l.charAt((15&n)<<2|r>>6),o+=isNaN(r)?"=":l.charAt(63&r)),t&&o.length>t&&(s+=o.substr(0,t)+"\r\n",o=o.substr(t));return s+=o},o.binary.base64.decode=function(e,t,i){var n,r,o,s,a=t;a||(a=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var l=0,u=i=i||0;l<e.length;)n=c[e.charCodeAt(l++)-43],r=c[e.charCodeAt(l++)-43],o=c[e.charCodeAt(l++)-43],s=c[e.charCodeAt(l++)-43],a[u++]=n<<2|r>>4,64!==o&&(a[u++]=(15&r)<<4|o>>2,64!==s&&(a[u++]=(3&o)<<6|s));return t?u-i:a.subarray(0,u)},o.binary.base58.encode=function(e,t){return o.binary.baseN.encode(e,u,t)},o.binary.base58.decode=function(e,t){return o.binary.baseN.decode(e,u,t)},o.text={utf8:{},utf16:{}},o.text.utf8.encode=function(e,t,i){e=o.encodeUtf8(e);var n=t;n||(n=new Uint8Array(e.length));for(var r=i=i||0,s=0;s<e.length;++s)n[r++]=e.charCodeAt(s);return t?r-i:n},o.text.utf8.decode=function(e){return o.decodeUtf8(String.fromCharCode.apply(null,e))},o.text.utf16.encode=function(e,t,i){var n=t;n||(n=new Uint8Array(2*e.length));for(var r=new Uint16Array(n.buffer),o=i=i||0,s=i,a=0;a<e.length;++a)r[s++]=e.charCodeAt(a),o+=2;return t?o-i:n},o.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},o.deflate=function(e,t,i){if(t=o.decode64(e.deflate(o.encode64(t)).rval),i){var n=2;32&t.charCodeAt(1)&&(n=6),t=t.substring(n,t.length-4)}return t},o.inflate=function(e,t,i){var n=e.inflate(o.encode64(t)).rval;return null===n?null:o.decode64(n)};var h=function(e,t,i){if(!e)throw new Error("WebStorage not available.");var n;if(null===i?n=e.removeItem(t):(i=o.encode64(JSON.stringify(i)),n=e.setItem(t,i)),void 0!==n&&!0!==n.rval){var r=new Error(n.error.message);throw r.id=n.error.id,r.name=n.error.name,r}},d=function(e,t){if(!e)throw new Error("WebStorage not available.");var i=e.getItem(t);if(e.init)if(null===i.rval){if(i.error){var n=new Error(i.error.message);throw n.id=i.error.id,n.name=i.error.name,n}i=null}else i=i.rval;return null!==i&&(i=JSON.parse(o.decode64(i))),i},f=function(e,t,i,n){var r=d(e,t);null===r&&(r={}),r[i]=n,h(e,t,r)},p=function(e,t,i){var n=d(e,t);return null!==n&&(n=i in n?n[i]:null),n},m=function(e,t,i){var n=d(e,t);if(null!==n&&i in n){delete n[i];var r=!0;for(var o in n){r=!1;break}r&&(n=null),h(e,t,n)}},g=function(e,t){h(e,t,null)},v=function(e,t,i){var n,r=null;void 0===i&&(i=["web","flash"]);var o=!1,s=null;for(var a in i){n=i[a];try{if("flash"===n||"both"===n){if(null===t[0])throw new Error("Flash local storage not available.");r=e.apply(this,t),o="flash"===n}"web"!==n&&"both"!==n||(t[0]=localStorage,r=e.apply(this,t),o=!0)}catch(e){s=e}if(o)break}if(!o)throw s;return r};o.setItem=function(e,t,i,n,r){v(f,arguments,r)},o.getItem=function(e,t,i,n){return v(p,arguments,n)},o.removeItem=function(e,t,i,n){v(m,arguments,n)},o.clearItems=function(e,t,i){v(g,arguments,i)},o.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},o.format=function(e){for(var t,i,n=/%./g,r=0,o=[],s=0;t=n.exec(e);){(i=e.substring(s,n.lastIndex-2)).length>0&&o.push(i),s=n.lastIndex;var a=t[0][1];switch(a){case"s":case"o":r<arguments.length?o.push(arguments[1+r++]):o.push("<?>");break;case"%":o.push("%");break;default:o.push("<%"+a+"?>")}}return o.push(e.substring(s)),o.join("")},o.formatNumber=function(e,t,i,n){var r=e,o=isNaN(t=Math.abs(t))?2:t,s=void 0===i?",":i,a=void 0===n?".":n,l=r<0?"-":"",c=parseInt(r=Math.abs(+r||0).toFixed(o),10)+"",u=c.length>3?c.length%3:0;return l+(u?c.substr(0,u)+a:"")+c.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+a)+(o?s+Math.abs(r-c).toFixed(o).slice(2):"")},o.formatSize=function(e){return e=e>=1073741824?o.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?o.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?o.formatNumber(e/1024,0)+" KiB":o.formatNumber(e,0)+" bytes"},o.bytesFromIP=function(e){return-1!==e.indexOf(".")?o.bytesFromIPv4(e):-1!==e.indexOf(":")?o.bytesFromIPv6(e):null},o.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=o.createBuffer(),i=0;i<e.length;++i){var n=parseInt(e[i],10);if(isNaN(n))return null;t.putByte(n)}return t.getBytes()},o.bytesFromIPv6=function(e){for(var t=0,i=2*(8-(e=e.split(":").filter((function(e){return 0===e.length&&++t,!0}))).length+t),n=o.createBuffer(),r=0;r<8;++r)if(e[r]&&0!==e[r].length){var s=o.hexToBytes(e[r]);s.length<2&&n.putByte(0),n.putBytes(s)}else n.fillWithByte(0,i),i=0;return n.getBytes()},o.bytesToIP=function(e){return 4===e.length?o.bytesToIPv4(e):16===e.length?o.bytesToIPv6(e):null},o.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t.join(".")},o.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],i=[],n=0,r=0;r<e.length;r+=2){for(var s=o.bytesToHex(e[r]+e[r+1]);"0"===s[0]&&"0"!==s;)s=s.substr(1);if("0"===s){var a=i[i.length-1],l=t.length;a&&l===a.end+1?(a.end=l,a.end-a.start>i[n].end-i[n].start&&(n=i.length-1)):i.push({start:l,end:l})}t.push(s)}if(i.length>0){var c=i[n];c.end-c.start>0&&(t.splice(c.start,c.end-c.start+1,""),0===c.start&&t.unshift(""),7===c.end&&t.push(""))}return t.join(":")},o.estimateCores=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"cores"in o&&!e.update)return t(null,o.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return o.cores=navigator.hardwareConcurrency,t(null,o.cores);if("undefined"==typeof Worker)return o.cores=1,t(null,o.cores);if("undefined"==typeof Blob)return o.cores=2,t(null,o.cores);var i=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){for(var t=Date.now(),i=t+4;Date.now()<i;);self.postMessage({st:t,et:i})}))}.toString(),")()"],{type:"application/javascript"}));!function e(n,r,s){if(0===r){var a=Math.floor(n.reduce((function(e,t){return e+t}),0)/n.length);return o.cores=Math.max(1,a),URL.revokeObjectURL(i),t(null,o.cores)}!function(e,t){for(var n=[],r=[],o=0;o<e;++o){var s=new Worker(i);s.addEventListener("message",(function(i){if(r.push(i.data),r.length===e){for(var o=0;o<e;++o)n[o].terminate();t(null,r)}})),n.push(s)}for(o=0;o<e;++o)n[o].postMessage(o)}(s,(function(t,i){n.push(function(e,t){for(var i=[],n=0;n<e;++n)for(var r=t[n],o=i[n]=[],s=0;s<e;++s)if(n!==s){var a=t[s];(r.st>a.st&&r.st<a.et||a.st>r.st&&a.st<r.et)&&o.push(s)}return i.reduce((function(e,t){return Math.max(e,t.length)}),0)}(s,i)),e(n,r-1,s)}))}([],5,16)}},66011:(e,t,i)=>{var n=i(50276);i(39504),i(12746),i(19095),i(8106),i(41373),i(16418),i(2385),i(51417),i(15805),i(7619);var r=n.asn1,o=e.exports=n.pki=n.pki||{},s=o.oids,a={};a.CN=s.commonName,a.commonName="CN",a.C=s.countryName,a.countryName="C",a.L=s.localityName,a.localityName="L",a.ST=s.stateOrProvinceName,a.stateOrProvinceName="ST",a.O=s.organizationName,a.organizationName="O",a.OU=s.organizationalUnitName,a.organizationalUnitName="OU",a.E=s.emailAddress,a.emailAddress="E";var l=n.pki.rsa.publicKeyValidator,c={name:"Certificate",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:r.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:r.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:r.Class.UNIVERSAL,type:r.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:r.Class.UNIVERSAL,type:r.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:r.Class.UNIVERSAL,type:r.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:r.Class.UNIVERSAL,type:r.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},l,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:r.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:r.Class.UNIVERSAL,type:r.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:r.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:r.Class.UNIVERSAL,type:r.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:r.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:r.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:r.Class.UNIVERSAL,type:r.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},u={name:"rsapss",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:r.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:r.Class.UNIVERSAL,type:r.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:r.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:r.Class.UNIVERSAL,type:r.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:r.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:r.Class.UNIVERSAL,type:r.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:r.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:r.Class.UNIVERSAL,type:r.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},h={name:"CertificationRequestInfo",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:r.Class.UNIVERSAL,type:r.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},l,{name:"CertificationRequestInfo.attributes",tagClass:r.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:r.Class.UNIVERSAL,type:r.Type.SET,constructed:!0}]}]}]},d={name:"CertificationRequest",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[h,{name:"CertificationRequest.signatureAlgorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:r.Class.UNIVERSAL,type:r.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:r.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:r.Class.UNIVERSAL,type:r.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};function f(e,t){"string"==typeof t&&(t={shortName:t});for(var i,n=null,r=0;null===n&&r<e.attributes.length;++r)i=e.attributes[r],(t.type&&t.type===i.type||t.name&&t.name===i.name||t.shortName&&t.shortName===i.shortName)&&(n=i);return n}o.RDNAttributesAsArray=function(e,t){for(var i,n,o,l=[],c=0;c<e.value.length;++c){i=e.value[c];for(var u=0;u<i.value.length;++u)o={},n=i.value[u],o.type=r.derToOid(n.value[0].value),o.value=n.value[1].value,o.valueTagClass=n.value[1].type,o.type in s&&(o.name=s[o.type],o.name in a&&(o.shortName=a[o.name])),t&&(t.update(o.type),t.update(o.value)),l.push(o)}return l},o.CRIAttributesAsArray=function(e){for(var t=[],i=0;i<e.length;++i)for(var n=e[i],l=r.derToOid(n.value[0].value),c=n.value[1].value,u=0;u<c.length;++u){var h={};if(h.type=l,h.value=c[u].value,h.valueTagClass=c[u].type,h.type in s&&(h.name=s[h.type],h.name in a&&(h.shortName=a[h.name])),h.type===s.extensionRequest){h.extensions=[];for(var d=0;d<h.value.length;++d)h.extensions.push(o.certificateExtensionFromAsn1(h.value[d]))}t.push(h)}return t};var p=function(e,t,i){var n={};if(e!==s["RSASSA-PSS"])return n;i&&(n={hash:{algorithmOid:s.sha1},mgf:{algorithmOid:s.mgf1,hash:{algorithmOid:s.sha1}},saltLength:20});var o={},a=[];if(!r.validate(t,u,o,a)){var l=new Error("Cannot read RSASSA-PSS parameter block.");throw l.errors=a,l}return void 0!==o.hashOid&&(n.hash=n.hash||{},n.hash.algorithmOid=r.derToOid(o.hashOid)),void 0!==o.maskGenOid&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=r.derToOid(o.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=r.derToOid(o.maskGenHashOid)),void 0!==o.saltLength&&(n.saltLength=o.saltLength.charCodeAt(0)),n},m=function(e){switch(s[e.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return n.md.sha1.create();case"md5WithRSAEncryption":return n.md.md5.create();case"sha256WithRSAEncryption":case"RSASSA-PSS":return n.md.sha256.create();case"sha384WithRSAEncryption":return n.md.sha384.create();case"sha512WithRSAEncryption":return n.md.sha512.create();default:var t=new Error("Could not compute "+e.type+" digest. Unknown signature OID.");throw t.signatureOid=e.signatureOid,t}},g=function(e){var t,i=e.certificate;switch(i.signatureOid){case s.sha1WithRSAEncryption:case s.sha1WithRSASignature:break;case s["RSASSA-PSS"]:var r,o,a;if(void 0===(r=s[i.signatureParameters.mgf.hash.algorithmOid])||void 0===n.md[r])throw(a=new Error("Unsupported MGF hash function.")).oid=i.signatureParameters.mgf.hash.algorithmOid,a.name=r,a;if(void 0===(o=s[i.signatureParameters.mgf.algorithmOid])||void 0===n.mgf[o])throw(a=new Error("Unsupported MGF function.")).oid=i.signatureParameters.mgf.algorithmOid,a.name=o,a;if(o=n.mgf[o].create(n.md[r].create()),void 0===(r=s[i.signatureParameters.hash.algorithmOid])||void 0===n.md[r])throw(a=new Error("Unsupported RSASSA-PSS hash function.")).oid=i.signatureParameters.hash.algorithmOid,a.name=r,a;t=n.pss.create(n.md[r].create(),o,i.signatureParameters.saltLength)}return i.publicKey.verify(e.md.digest().getBytes(),e.signature,t)};function v(e){for(var t,i,o=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]),s=e.attributes,a=0;a<s.length;++a){var l=(t=s[a]).value,c=r.Type.PRINTABLESTRING;"valueTagClass"in t&&(c=t.valueTagClass)===r.Type.UTF8&&(l=n.util.encodeUtf8(l)),i=r.create(r.Class.UNIVERSAL,r.Type.SET,!0,[r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(t.type).getBytes()),r.create(r.Class.UNIVERSAL,c,!1,l)])]),o.value.push(i)}return o}function y(e){for(var t,i=0;i<e.length;++i){if(void 0===(t=e[i]).name&&(t.type&&t.type in o.oids?t.name=o.oids[t.type]:t.shortName&&t.shortName in a&&(t.name=o.oids[a[t.shortName]])),void 0===t.type){if(!t.name||!(t.name in o.oids))throw(l=new Error("Attribute type not specified.")).attribute=t,l;t.type=o.oids[t.name]}if(void 0===t.shortName&&t.name&&t.name in a&&(t.shortName=a[t.name]),t.type===s.extensionRequest&&(t.valueConstructed=!0,t.valueTagClass=r.Type.SEQUENCE,!t.value&&t.extensions)){t.value=[];for(var n=0;n<t.extensions.length;++n)t.value.push(o.certificateExtensionToAsn1(b(t.extensions[n])))}var l;if(void 0===t.value)throw(l=new Error("Attribute value not specified.")).attribute=t,l}}function b(e,t){if(t=t||{},void 0===e.name&&e.id&&e.id in o.oids&&(e.name=o.oids[e.id]),void 0===e.id){if(!e.name||!(e.name in o.oids))throw(_=new Error("Extension ID not specified.")).extension=e,_;e.id=o.oids[e.name]}if(void 0!==e.value)return e;if("keyUsage"===e.name){var i=0,a=0,l=0;e.digitalSignature&&(a|=128,i=7),e.nonRepudiation&&(a|=64,i=6),e.keyEncipherment&&(a|=32,i=5),e.dataEncipherment&&(a|=16,i=4),e.keyAgreement&&(a|=8,i=3),e.keyCertSign&&(a|=4,i=2),e.cRLSign&&(a|=2,i=1),e.encipherOnly&&(a|=1,i=0),e.decipherOnly&&(l|=128,i=7);var c=String.fromCharCode(i);0!==l?c+=String.fromCharCode(a)+String.fromCharCode(l):0!==a&&(c+=String.fromCharCode(a)),e.value=r.create(r.Class.UNIVERSAL,r.Type.BITSTRING,!1,c)}else if("basicConstraints"===e.name)e.value=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(r.create(r.Class.UNIVERSAL,r.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]);var u=e.value.value;for(var h in e)!0===e[h]&&(h in s?u.push(r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(s[h]).getBytes())):-1!==h.indexOf(".")&&u.push(r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(h).getBytes())))}else if("nsCertType"===e.name){i=0,a=0;e.client&&(a|=128,i=7),e.server&&(a|=64,i=6),e.email&&(a|=32,i=5),e.objsign&&(a|=16,i=4),e.reserved&&(a|=8,i=3),e.sslCA&&(a|=4,i=2),e.emailCA&&(a|=2,i=1),e.objCA&&(a|=1,i=0);c=String.fromCharCode(i);0!==a&&(c+=String.fromCharCode(a)),e.value=r.create(r.Class.UNIVERSAL,r.Type.BITSTRING,!1,c)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]);for(var d=0;d<e.altNames.length;++d){c=(y=e.altNames[d]).value;if(7===y.type&&y.ip){if(null===(c=n.util.bytesFromIP(y.ip)))throw(_=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,_}else 8===y.type&&(c=y.oid?r.oidToDer(r.oidToDer(y.oid)):r.oidToDer(c));e.value.value.push(r.create(r.Class.CONTEXT_SPECIFIC,y.type,!1,c))}}else if("nsComment"===e.name&&t.cert){if(!/^[\x00-\x7F]*$/.test(e.comment)||e.comment.length<1||e.comment.length>128)throw new Error('Invalid "nsComment" content.');e.value=r.create(r.Class.UNIVERSAL,r.Type.IA5STRING,!1,e.comment)}else if("subjectKeyIdentifier"===e.name&&t.cert){var f=t.cert.generateSubjectKeyIdentifier();e.subjectKeyIdentifier=f.toHex(),e.value=r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,f.getBytes())}else if("authorityKeyIdentifier"===e.name&&t.cert){e.value=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]);u=e.value.value;if(e.keyIdentifier){var p=!0===e.keyIdentifier?t.cert.generateSubjectKeyIdentifier().getBytes():e.keyIdentifier;u.push(r.create(r.Class.CONTEXT_SPECIFIC,0,!1,p))}if(e.authorityCertIssuer){var m=[r.create(r.Class.CONTEXT_SPECIFIC,4,!0,[v(!0===e.authorityCertIssuer?t.cert.issuer:e.authorityCertIssuer)])];u.push(r.create(r.Class.CONTEXT_SPECIFIC,1,!0,m))}if(e.serialNumber){var g=n.util.hexToBytes(!0===e.serialNumber?t.cert.serialNumber:e.serialNumber);u.push(r.create(r.Class.CONTEXT_SPECIFIC,2,!1,g))}}else if("cRLDistributionPoints"===e.name){e.value=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]);u=e.value.value;var y,b=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]),x=r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[]);for(d=0;d<e.altNames.length;++d){c=(y=e.altNames[d]).value;if(7===y.type&&y.ip){if(null===(c=n.util.bytesFromIP(y.ip)))throw(_=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,_}else 8===y.type&&(c=y.oid?r.oidToDer(r.oidToDer(y.oid)):r.oidToDer(c));x.value.push(r.create(r.Class.CONTEXT_SPECIFIC,y.type,!1,c))}b.value.push(r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[x])),u.push(b)}var _;if(void 0===e.value)throw(_=new Error("Extension value not specified.")).extension=e,_;return e}function x(e,t){if(e===s["RSASSA-PSS"]){var i=[];return void 0!==t.hash.algorithmOid&&i.push(r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(t.hash.algorithmOid).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")])])),void 0!==t.mgf.algorithmOid&&i.push(r.create(r.Class.CONTEXT_SPECIFIC,1,!0,[r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(t.mgf.algorithmOid).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(t.mgf.hash.algorithmOid).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")])])])),void 0!==t.saltLength&&i.push(r.create(r.Class.CONTEXT_SPECIFIC,2,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(t.saltLength).getBytes())])),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,i)}return r.create(r.Class.UNIVERSAL,r.Type.NULL,!1,"")}function _(e){var t=r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return t;for(var i=e.attributes,o=0;o<i.length;++o){var s=i[o],a=s.value,l=r.Type.UTF8;"valueTagClass"in s&&(l=s.valueTagClass),l===r.Type.UTF8&&(a=n.util.encodeUtf8(a));var c=!1;"valueConstructed"in s&&(c=s.valueConstructed);var u=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(s.type).getBytes()),r.create(r.Class.UNIVERSAL,r.Type.SET,!0,[r.create(r.Class.UNIVERSAL,l,c,a)])]);t.value.push(u)}return t}o.certificateFromPem=function(e,t,i){var s=n.pem.decode(e)[0];if("CERTIFICATE"!==s.type&&"X509 CERTIFICATE"!==s.type&&"TRUSTED CERTIFICATE"!==s.type){var a=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw a.headerType=s.type,a}if(s.procType&&"ENCRYPTED"===s.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var l=r.fromDer(s.body,i);return o.certificateFromAsn1(l,t)},o.certificateToPem=function(e,t){var i={type:"CERTIFICATE",body:r.toDer(o.certificateToAsn1(e)).getBytes()};return n.pem.encode(i,{maxline:t})},o.publicKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("PUBLIC KEY"!==t.type&&"RSA PUBLIC KEY"!==t.type){var i=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw i.headerType=t.type,i}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var s=r.fromDer(t.body);return o.publicKeyFromAsn1(s)},o.publicKeyToPem=function(e,t){var i={type:"PUBLIC KEY",body:r.toDer(o.publicKeyToAsn1(e)).getBytes()};return n.pem.encode(i,{maxline:t})},o.publicKeyToRSAPublicKeyPem=function(e,t){var i={type:"RSA PUBLIC KEY",body:r.toDer(o.publicKeyToRSAPublicKey(e)).getBytes()};return n.pem.encode(i,{maxline:t})},o.getPublicKeyFingerprint=function(e,t){var i,s=(t=t||{}).md||n.md.sha1.create();switch(t.type||"RSAPublicKey"){case"RSAPublicKey":i=r.toDer(o.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":i=r.toDer(o.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+t.type+'".')}s.start(),s.update(i);var a=s.digest();if("hex"===t.encoding){var l=a.toHex();return t.delimiter?l.match(/.{2}/g).join(t.delimiter):l}if("binary"===t.encoding)return a.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return a},o.certificationRequestFromPem=function(e,t,i){var s=n.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==s.type){var a=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw a.headerType=s.type,a}if(s.procType&&"ENCRYPTED"===s.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var l=r.fromDer(s.body,i);return o.certificationRequestFromAsn1(l,t)},o.certificationRequestToPem=function(e,t){var i={type:"CERTIFICATE REQUEST",body:r.toDer(o.certificationRequestToAsn1(e)).getBytes()};return n.pem.encode(i,{maxline:t})},o.createCertificate=function(){var e={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.validity={},e.validity.notBefore=new Date,e.validity.notAfter=new Date,e.issuer={},e.issuer.getField=function(t){return f(e.issuer,t)},e.issuer.addField=function(t){y([t]),e.issuer.attributes.push(t)},e.issuer.attributes=[],e.issuer.hash=null,e.subject={},e.subject.getField=function(t){return f(e.subject,t)},e.subject.addField=function(t){y([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.extensions=[],e.publicKey=null,e.md=null,e.setSubject=function(t,i){y(t),e.subject.attributes=t,delete e.subject.uniqueId,i&&(e.subject.uniqueId=i),e.subject.hash=null},e.setIssuer=function(t,i){y(t),e.issuer.attributes=t,delete e.issuer.uniqueId,i&&(e.issuer.uniqueId=i),e.issuer.hash=null},e.setExtensions=function(t){for(var i=0;i<t.length;++i)b(t[i],{cert:e});e.extensions=t},e.getExtension=function(t){"string"==typeof t&&(t={name:t});for(var i,n=null,r=0;null===n&&r<e.extensions.length;++r)i=e.extensions[r],(t.id&&i.id===t.id||t.name&&i.name===t.name)&&(n=i);return n},e.sign=function(t,i){e.md=i||n.md.sha1.create();var a=s[e.md.algorithm+"WithRSAEncryption"];if(!a){var l=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw l.algorithm=e.md.algorithm,l}e.signatureOid=e.siginfo.algorithmOid=a,e.tbsCertificate=o.getTBSCertificate(e);var c=r.toDer(e.tbsCertificate);e.md.update(c.getBytes()),e.signature=t.sign(e.md)},e.verify=function(t){var i=!1;if(!e.issued(t)){var n=t.issuer,s=e.subject,a=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw a.expectedIssuer=s.attributes,a.actualIssuer=n.attributes,a}var l=t.md;if(null===l){l=m({signatureOid:t.signatureOid,type:"certificate"});var c=t.tbsCertificate||o.getTBSCertificate(t),u=r.toDer(c);l.update(u.getBytes())}return null!==l&&(i=g({certificate:e,md:l,signature:t.signature})),i},e.isIssuer=function(t){var i=!1,n=e.issuer,r=t.subject;if(n.hash&&r.hash)i=n.hash===r.hash;else if(n.attributes.length===r.attributes.length){var o,s;i=!0;for(var a=0;i&&a<n.attributes.length;++a)o=n.attributes[a],s=r.attributes[a],o.type===s.type&&o.value===s.value||(i=!1)}return i},e.issued=function(t){return t.isIssuer(e)},e.generateSubjectKeyIdentifier=function(){return o.getPublicKeyFingerprint(e.publicKey,{type:"RSAPublicKey"})},e.verifySubjectKeyIdentifier=function(){for(var t=s.subjectKeyIdentifier,i=0;i<e.extensions.length;++i){var r=e.extensions[i];if(r.id===t){var o=e.generateSubjectKeyIdentifier().getBytes();return n.util.hexToBytes(r.subjectKeyIdentifier)===o}}return!1},e},o.certificateFromAsn1=function(e,t){var i={},s=[];if(!r.validate(e,c,i,s)){var a=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw a.errors=s,a}if(r.derToOid(i.publicKeyOid)!==o.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var l=o.createCertificate();l.version=i.certVersion?i.certVersion.charCodeAt(0):0;var u=n.util.createBuffer(i.certSerialNumber);l.serialNumber=u.toHex(),l.signatureOid=n.asn1.derToOid(i.certSignatureOid),l.signatureParameters=p(l.signatureOid,i.certSignatureParams,!0),l.siginfo.algorithmOid=n.asn1.derToOid(i.certinfoSignatureOid),l.siginfo.parameters=p(l.siginfo.algorithmOid,i.certinfoSignatureParams,!1),l.signature=i.certSignature;var h=[];if(void 0!==i.certValidity1UTCTime&&h.push(r.utcTimeToDate(i.certValidity1UTCTime)),void 0!==i.certValidity2GeneralizedTime&&h.push(r.generalizedTimeToDate(i.certValidity2GeneralizedTime)),void 0!==i.certValidity3UTCTime&&h.push(r.utcTimeToDate(i.certValidity3UTCTime)),void 0!==i.certValidity4GeneralizedTime&&h.push(r.generalizedTimeToDate(i.certValidity4GeneralizedTime)),h.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(h.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(l.validity.notBefore=h[0],l.validity.notAfter=h[1],l.tbsCertificate=i.tbsCertificate,t){l.md=m({signatureOid:l.signatureOid,type:"certificate"});var d=r.toDer(l.tbsCertificate);l.md.update(d.getBytes())}var g=n.md.sha1.create(),v=r.toDer(i.certIssuer);g.update(v.getBytes()),l.issuer.getField=function(e){return f(l.issuer,e)},l.issuer.addField=function(e){y([e]),l.issuer.attributes.push(e)},l.issuer.attributes=o.RDNAttributesAsArray(i.certIssuer),i.certIssuerUniqueId&&(l.issuer.uniqueId=i.certIssuerUniqueId),l.issuer.hash=g.digest().toHex();var b=n.md.sha1.create(),x=r.toDer(i.certSubject);return b.update(x.getBytes()),l.subject.getField=function(e){return f(l.subject,e)},l.subject.addField=function(e){y([e]),l.subject.attributes.push(e)},l.subject.attributes=o.RDNAttributesAsArray(i.certSubject),i.certSubjectUniqueId&&(l.subject.uniqueId=i.certSubjectUniqueId),l.subject.hash=b.digest().toHex(),i.certExtensions?l.extensions=o.certificateExtensionsFromAsn1(i.certExtensions):l.extensions=[],l.publicKey=o.publicKeyFromAsn1(i.subjectPublicKeyInfo),l},o.certificateExtensionsFromAsn1=function(e){for(var t=[],i=0;i<e.value.length;++i)for(var n=e.value[i],r=0;r<n.value.length;++r)t.push(o.certificateExtensionFromAsn1(n.value[r]));return t},o.certificateExtensionFromAsn1=function(e){var t={};if(t.id=r.derToOid(e.value[0].value),t.critical=!1,e.value[1].type===r.Type.BOOLEAN?(t.critical=0!==e.value[1].value.charCodeAt(0),t.value=e.value[2].value):t.value=e.value[1].value,t.id in s)if(t.name=s[t.id],"keyUsage"===t.name){var i=0,o=0;(l=r.fromDer(t.value)).value.length>1&&(i=l.value.charCodeAt(1),o=l.value.length>2?l.value.charCodeAt(2):0),t.digitalSignature=!(128&~i),t.nonRepudiation=!(64&~i),t.keyEncipherment=!(32&~i),t.dataEncipherment=!(16&~i),t.keyAgreement=!(8&~i),t.keyCertSign=!(4&~i),t.cRLSign=!(2&~i),t.encipherOnly=!(1&~i),t.decipherOnly=!(128&~o)}else if("basicConstraints"===t.name){(l=r.fromDer(t.value)).value.length>0&&l.value[0].type===r.Type.BOOLEAN?t.cA=0!==l.value[0].value.charCodeAt(0):t.cA=!1;var a=null;l.value.length>0&&l.value[0].type===r.Type.INTEGER?a=l.value[0].value:l.value.length>1&&(a=l.value[1].value),null!==a&&(t.pathLenConstraint=r.derToInteger(a))}else if("extKeyUsage"===t.name)for(var l=r.fromDer(t.value),c=0;c<l.value.length;++c){var u=r.derToOid(l.value[c].value);u in s?t[s[u]]=!0:t[u]=!0}else if("nsCertType"===t.name){i=0;(l=r.fromDer(t.value)).value.length>1&&(i=l.value.charCodeAt(1)),t.client=!(128&~i),t.server=!(64&~i),t.email=!(32&~i),t.objsign=!(16&~i),t.reserved=!(8&~i),t.sslCA=!(4&~i),t.emailCA=!(2&~i),t.objCA=!(1&~i)}else if("subjectAltName"===t.name||"issuerAltName"===t.name){var h;t.altNames=[];l=r.fromDer(t.value);for(var d=0;d<l.value.length;++d){var f={type:(h=l.value[d]).type,value:h.value};switch(t.altNames.push(f),h.type){case 1:case 2:case 6:break;case 7:f.ip=n.util.bytesToIP(h.value);break;case 8:f.oid=r.derToOid(h.value)}}}else if("subjectKeyIdentifier"===t.name){l=r.fromDer(t.value);t.subjectKeyIdentifier=n.util.bytesToHex(l.value)}return t},o.certificationRequestFromAsn1=function(e,t){var i={},s=[];if(!r.validate(e,d,i,s)){var a=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw a.errors=s,a}if(r.derToOid(i.publicKeyOid)!==o.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var l=o.createCertificationRequest();if(l.version=i.csrVersion?i.csrVersion.charCodeAt(0):0,l.signatureOid=n.asn1.derToOid(i.csrSignatureOid),l.signatureParameters=p(l.signatureOid,i.csrSignatureParams,!0),l.siginfo.algorithmOid=n.asn1.derToOid(i.csrSignatureOid),l.siginfo.parameters=p(l.siginfo.algorithmOid,i.csrSignatureParams,!1),l.signature=i.csrSignature,l.certificationRequestInfo=i.certificationRequestInfo,t){l.md=m({signatureOid:l.signatureOid,type:"certification request"});var c=r.toDer(l.certificationRequestInfo);l.md.update(c.getBytes())}var u=n.md.sha1.create();return l.subject.getField=function(e){return f(l.subject,e)},l.subject.addField=function(e){y([e]),l.subject.attributes.push(e)},l.subject.attributes=o.RDNAttributesAsArray(i.certificationRequestInfoSubject,u),l.subject.hash=u.digest().toHex(),l.publicKey=o.publicKeyFromAsn1(i.subjectPublicKeyInfo),l.getAttribute=function(e){return f(l,e)},l.addAttribute=function(e){y([e]),l.attributes.push(e)},l.attributes=o.CRIAttributesAsArray(i.certificationRequestInfoAttributes||[]),l},o.createCertificationRequest=function(){var e={version:0,signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.subject={},e.subject.getField=function(t){return f(e.subject,t)},e.subject.addField=function(t){y([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.publicKey=null,e.attributes=[],e.getAttribute=function(t){return f(e,t)},e.addAttribute=function(t){y([t]),e.attributes.push(t)},e.md=null,e.setSubject=function(t){y(t),e.subject.attributes=t,e.subject.hash=null},e.setAttributes=function(t){y(t),e.attributes=t},e.sign=function(t,i){e.md=i||n.md.sha1.create();var a=s[e.md.algorithm+"WithRSAEncryption"];if(!a){var l=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw l.algorithm=e.md.algorithm,l}e.signatureOid=e.siginfo.algorithmOid=a,e.certificationRequestInfo=o.getCertificationRequestInfo(e);var c=r.toDer(e.certificationRequestInfo);e.md.update(c.getBytes()),e.signature=t.sign(e.md)},e.verify=function(){var t=!1,i=e.md;if(null===i){i=m({signatureOid:e.signatureOid,type:"certification request"});var n=e.certificationRequestInfo||o.getCertificationRequestInfo(e),s=r.toDer(n);i.update(s.getBytes())}return null!==i&&(t=g({certificate:e,md:i,signature:e.signature})),t},e};var E=new Date("1950-01-01T00:00:00Z"),S=new Date("2050-01-01T00:00:00Z");function A(e){return e>=E&&e<S?r.create(r.Class.UNIVERSAL,r.Type.UTCTIME,!1,r.dateToUtcTime(e)):r.create(r.Class.UNIVERSAL,r.Type.GENERALIZEDTIME,!1,r.dateToGeneralizedTime(e))}o.getTBSCertificate=function(e){var t=A(e.validity.notBefore),i=A(e.validity.notAfter),s=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.CONTEXT_SPECIFIC,0,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(e.version).getBytes())]),r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,n.util.hexToBytes(e.serialNumber)),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.siginfo.algorithmOid).getBytes()),x(e.siginfo.algorithmOid,e.siginfo.parameters)]),v(e.issuer),r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[t,i]),v(e.subject),o.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&s.value.push(r.create(r.Class.CONTEXT_SPECIFIC,1,!0,[r.create(r.Class.UNIVERSAL,r.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&s.value.push(r.create(r.Class.CONTEXT_SPECIFIC,2,!0,[r.create(r.Class.UNIVERSAL,r.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),e.extensions.length>0&&s.value.push(o.certificateExtensionsToAsn1(e.extensions)),s},o.getCertificationRequestInfo=function(e){return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.INTEGER,!1,r.integerToDer(e.version).getBytes()),v(e.subject),o.publicKeyToAsn1(e.publicKey),_(e)])},o.distinguishedNameToAsn1=function(e){return v(e)},o.certificateToAsn1=function(e){var t=e.tbsCertificate||o.getTBSCertificate(e);return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[t,r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.signatureOid).getBytes()),x(e.signatureOid,e.signatureParameters)]),r.create(r.Class.UNIVERSAL,r.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},o.certificateExtensionsToAsn1=function(e){var t=r.create(r.Class.CONTEXT_SPECIFIC,3,!0,[]),i=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]);t.value.push(i);for(var n=0;n<e.length;++n)i.value.push(o.certificateExtensionToAsn1(e[n]));return t},o.certificateExtensionToAsn1=function(e){var t=r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[]);t.value.push(r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.id).getBytes())),e.critical&&t.value.push(r.create(r.Class.UNIVERSAL,r.Type.BOOLEAN,!1,String.fromCharCode(255)));var i=e.value;return"string"!=typeof e.value&&(i=r.toDer(i).getBytes()),t.value.push(r.create(r.Class.UNIVERSAL,r.Type.OCTETSTRING,!1,i)),t},o.certificationRequestToAsn1=function(e){var t=e.certificationRequestInfo||o.getCertificationRequestInfo(e);return r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[t,r.create(r.Class.UNIVERSAL,r.Type.SEQUENCE,!0,[r.create(r.Class.UNIVERSAL,r.Type.OID,!1,r.oidToDer(e.signatureOid).getBytes()),x(e.signatureOid,e.signatureParameters)]),r.create(r.Class.UNIVERSAL,r.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},o.createCaStore=function(e){var t={certs:{}};function i(e){return s(e),t.certs[e.hash]||null}function s(e){if(!e.hash){var t=n.md.sha1.create();e.attributes=o.RDNAttributesAsArray(v(e),t),e.hash=t.digest().toHex()}}if(t.getIssuer=function(e){return i(e.issuer)},t.addCertificate=function(e){if("string"==typeof e&&(e=n.pki.certificateFromPem(e)),s(e.subject),!t.hasCertificate(e))if(e.subject.hash in t.certs){var i=t.certs[e.subject.hash];n.util.isArray(i)||(i=[i]),i.push(e),t.certs[e.subject.hash]=i}else t.certs[e.subject.hash]=e},t.hasCertificate=function(e){"string"==typeof e&&(e=n.pki.certificateFromPem(e));var t=i(e.subject);if(!t)return!1;n.util.isArray(t)||(t=[t]);for(var s=r.toDer(o.certificateToAsn1(e)).getBytes(),a=0;a<t.length;++a){if(s===r.toDer(o.certificateToAsn1(t[a])).getBytes())return!0}return!1},t.listAllCertificates=function(){var e=[];for(var i in t.certs)if(t.certs.hasOwnProperty(i)){var r=t.certs[i];if(n.util.isArray(r))for(var o=0;o<r.length;++o)e.push(r[o]);else e.push(r)}return e},t.removeCertificate=function(e){var a;if("string"==typeof e&&(e=n.pki.certificateFromPem(e)),s(e.subject),!t.hasCertificate(e))return null;var l=i(e.subject);if(!n.util.isArray(l))return a=t.certs[e.subject.hash],delete t.certs[e.subject.hash],a;for(var c=r.toDer(o.certificateToAsn1(e)).getBytes(),u=0;u<l.length;++u){c===r.toDer(o.certificateToAsn1(l[u])).getBytes()&&(a=l[u],l.splice(u,1))}return 0===l.length&&delete t.certs[e.subject.hash],a},e)for(var a=0;a<e.length;++a){var l=e[a];t.addCertificate(l)}return t},o.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},o.verifyCertificateChain=function(e,t,i){"function"==typeof i&&(i={verify:i}),i=i||{};var r=(t=t.slice(0)).slice(0),s=i.validityCheckDate;void 0===s&&(s=new Date);var a=!0,l=null,c=0;do{var u=t.shift(),h=null,d=!1;if(s&&(s<u.validity.notBefore||s>u.validity.notAfter)&&(l={message:"Certificate is not valid yet or has expired.",error:o.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:s}),null===l){if(null===(h=t[0]||e.getIssuer(u))&&u.isIssuer(u)&&(d=!0,h=u),h){var f=h;n.util.isArray(f)||(f=[f]);for(var p=!1;!p&&f.length>0;){h=f.shift();try{p=h.verify(u)}catch(e){}}p||(l={message:"Certificate signature is invalid.",error:o.certificateError.bad_certificate})}null!==l||h&&!d||e.hasCertificate(u)||(l={message:"Certificate is not trusted.",error:o.certificateError.unknown_ca})}if(null===l&&h&&!u.isIssuer(h)&&(l={message:"Certificate issuer is invalid.",error:o.certificateError.bad_certificate}),null===l)for(var m={keyUsage:!0,basicConstraints:!0},g=0;null===l&&g<u.extensions.length;++g){var v=u.extensions[g];v.critical&&!(v.name in m)&&(l={message:"Certificate has an unsupported critical extension.",error:o.certificateError.unsupported_certificate})}if(null===l&&(!a||0===t.length&&(!h||d))){var y=u.getExtension("basicConstraints"),b=u.getExtension("keyUsage");if(null!==b&&(b.keyCertSign&&null!==y||(l={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:o.certificateError.bad_certificate})),null!==l||null===y||y.cA||(l={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:o.certificateError.bad_certificate}),null===l&&null!==b&&"pathLenConstraint"in y)c-1>y.pathLenConstraint&&(l={message:"Certificate basicConstraints pathLenConstraint violated.",error:o.certificateError.bad_certificate})}var x=null===l||l.error,_=i.verify?i.verify(x,c,r):x;if(!0!==_)throw!0===x&&(l={message:"The application rejected the certificate.",error:o.certificateError.bad_certificate}),(_||0===_)&&("object"!=typeof _||n.util.isArray(_)?"string"==typeof _&&(l.error=_):(_.message&&(l.message=_.message),_.error&&(l.error=_.error))),l;l=null,a=!1,++c}while(t.length>0);return!0}},51436:e=>{function t(){this.pending=0,this.max=1/0,this.listeners=[],this.waiting=[],this.error=null}function i(e){e.pending+=1;var t=!1;return function(r){if(t)throw new Error("callback called twice");if(t=!0,e.error=e.error||r,e.pending-=1,e.waiting.length>0&&e.pending<e.max)n(e,e.waiting.shift());else if(0===e.pending){var o=e.listeners;e.listeners=[],o.forEach(i)}};function i(t){t(e.error)}}function n(e,t){t(i(e))}e.exports=t,t.prototype.go=function(e){this.pending<this.max?n(this,e):this.waiting.push(e)},t.prototype.wait=function(e){0===this.pending?e(this.error):this.listeners.push(e)},t.prototype.hold=function(){return i(this)}},86059:e=>{"use strict";e.exports="DELETED_WORKERNODE"},50310:()=>{},39709:()=>{},50684:()=>{},9631:()=>{},18215:()=>{},90315:()=>{},79306:(e,t,i)=>{"use strict";var n=i(94901),r=i(16823),o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(r(e)+" is not a function")}},36194:(e,t,i)=>{"use strict";var n=i(72248).has;e.exports=function(e){return n(e),e}},73506:(e,t,i)=>{"use strict";var n=i(13925),r=String,o=TypeError;e.exports=function(e){if(n(e))return e;throw new o("Can't set "+r(e)+" as a prototype")}},97080:(e,t,i)=>{"use strict";var n=i(94402).has;e.exports=function(e){return n(e),e}},76557:(e,t,i)=>{"use strict";var n=i(44995).has;e.exports=function(e){return n(e),e}},23755:(e,t,i)=>{"use strict";var n=i(88205).has;e.exports=function(e){return n(e),e}},6469:(e,t,i)=>{"use strict";var n=i(78227),r=i(2360),o=i(24913).f,s=n("unscopables"),a=Array.prototype;void 0===a[s]&&o(a,s,{configurable:!0,value:r(null)}),e.exports=function(e){a[s][e]=!0}},90679:(e,t,i)=>{"use strict";var n=i(1625),r=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new r("Incorrect invocation")}},28551:(e,t,i)=>{"use strict";var n=i(20034),r=String,o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(r(e)+" is not an object")}},77811:e=>{"use strict";e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},15652:(e,t,i)=>{"use strict";var n=i(79039);e.exports=n((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))},94644:(e,t,i)=>{"use strict";var n,r,o,s=i(77811),a=i(43724),l=i(24475),c=i(94901),u=i(20034),h=i(39297),d=i(36955),f=i(16823),p=i(66699),m=i(36840),g=i(62106),v=i(1625),y=i(42787),b=i(52967),x=i(78227),_=i(33392),E=i(91181),S=E.enforce,A=E.get,w=l.Int8Array,C=w&&w.prototype,T=l.Uint8ClampedArray,M=T&&T.prototype,I=w&&y(w),P=C&&y(C),L=Object.prototype,R=l.TypeError,D=x("toStringTag"),O=_("TYPED_ARRAY_TAG"),B="TypedArrayConstructor",N=s&&!!b&&"Opera"!==d(l.opera),U=!1,k={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},F={BigInt64Array:8,BigUint64Array:8},V=function(e){var t=y(e);if(u(t)){var i=A(t);return i&&h(i,B)?i[B]:V(t)}},G=function(e){if(!u(e))return!1;var t=d(e);return h(k,t)||h(F,t)};for(n in k)(o=(r=l[n])&&r.prototype)?S(o)[B]=r:N=!1;for(n in F)(o=(r=l[n])&&r.prototype)&&(S(o)[B]=r);if((!N||!c(I)||I===Function.prototype)&&(I=function(){throw new R("Incorrect invocation")},N))for(n in k)l[n]&&b(l[n],I);if((!N||!P||P===L)&&(P=I.prototype,N))for(n in k)l[n]&&b(l[n].prototype,P);if(N&&y(M)!==P&&b(M,P),a&&!h(P,D))for(n in U=!0,g(P,D,{configurable:!0,get:function(){return u(this)?this[O]:void 0}}),k)l[n]&&p(l[n],O,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:N,TYPED_ARRAY_TAG:U&&O,aTypedArray:function(e){if(G(e))return e;throw new R("Target is not a typed array")},aTypedArrayConstructor:function(e){if(c(e)&&(!b||v(I,e)))return e;throw new R(f(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,i,n){if(a){if(i)for(var r in k){var o=l[r];if(o&&h(o.prototype,e))try{delete o.prototype[e]}catch(i){try{o.prototype[e]=t}catch(e){}}}P[e]&&!i||m(P,e,i?t:N&&C[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,i){var n,r;if(a){if(b){if(i)for(n in k)if((r=l[n])&&h(r,e))try{delete r[e]}catch(e){}if(I[e]&&!i)return;try{return m(I,e,i?t:N&&I[e]||t)}catch(e){}}for(n in k)!(r=l[n])||r[e]&&!i||m(r,e,t)}},getTypedArrayConstructor:V,isView:function(e){if(!u(e))return!1;var t=d(e);return"DataView"===t||h(k,t)||h(F,t)},isTypedArray:G,TypedArray:I,TypedArrayPrototype:P}},19617:(e,t,i)=>{"use strict";var n=i(25397),r=i(35610),o=i(26198),s=function(e){return function(t,i,s){var a=n(t),l=o(a);if(0===l)return!e&&-1;var c,u=r(s,l);if(e&&i!=i){for(;l>u;)if((c=a[u++])!=c)return!0}else for(;l>u;u++)if((e||u in a)&&a[u]===i)return e||u||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},59213:(e,t,i)=>{"use strict";var n=i(76080),r=i(79504),o=i(47055),s=i(48981),a=i(26198),l=i(1469),c=r([].push),u=function(e){var t=1===e,i=2===e,r=3===e,u=4===e,h=6===e,d=7===e,f=5===e||h;return function(p,m,g,v){for(var y,b,x=s(p),_=o(x),E=a(_),S=n(m,g),A=0,w=v||l,C=t?w(p,E):i||d?w(p,0):void 0;E>A;A++)if((f||A in _)&&(b=S(y=_[A],A,x),e))if(t)C[A]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return A;case 2:c(C,y)}else switch(e){case 4:return!1;case 7:c(C,y)}return h?-1:r||u?u:C}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterReject:u(7)}},67680:(e,t,i)=>{"use strict";var n=i(79504);e.exports=n([].slice)},87433:(e,t,i)=>{"use strict";var n=i(34376),r=i(33517),o=i(20034),s=i(78227)("species"),a=Array;e.exports=function(e){var t;return n(e)&&(t=e.constructor,(r(t)&&(t===a||n(t.prototype))||o(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?a:t}},1469:(e,t,i)=>{"use strict";var n=i(87433);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},79565:(e,t,i)=>{"use strict";var n=i(79504),r=i(79306),o=i(64117),s=i(26198),a=i(48981),l=i(72248),c=i(26223),u=l.Map,h=l.has,d=l.set,f=n([].push);e.exports=function(e){var t,i,n,l=a(this),p=s(l),m=[],g=new u,v=o(e)?function(e){return e}:r(e);for(t=0;t<p;t++)n=v(i=l[t]),h(g,n)||d(g,n,i);return c(g,(function(e){f(m,e)})),m}},84428:(e,t,i)=>{"use strict";var n=i(78227)("iterator"),r=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){r=!0}};s[n]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){try{if(!t&&!r)return!1}catch(e){return!1}var i=!1;try{var o={};o[n]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch(e){}return i}},44576:(e,t,i)=>{"use strict";var n=i(79504),r=n({}.toString),o=n("".slice);e.exports=function(e){return o(r(e),8,-1)}},36955:(e,t,i)=>{"use strict";var n=i(92140),r=i(94901),o=i(44576),s=i(78227)("toStringTag"),a=Object,l="Arguments"===o(function(){return arguments}());e.exports=n?o:function(e){var t,i,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=a(e),s))?i:l?o(t):"Object"===(n=o(t))&&r(t.callee)?"Arguments":n}},70933:(e,t,i)=>{"use strict";var n=i(76080),r=i(28551),o=i(48981),s=i(72652);e.exports=function(e,t,i){return function(a){var l=o(a),c=arguments.length,u=c>1?arguments[1]:void 0,h=void 0!==u,d=h?n(u,c>2?arguments[2]:void 0):void 0,f=new e,p=0;return s(l,(function(e){var n=h?d(e,p++):e;i?t(f,r(n)[0],n[1]):t(f,n)})),f}}},87500:(e,t,i)=>{"use strict";var n=i(28551);e.exports=function(e,t,i){return function(){for(var r=new e,o=arguments.length,s=0;s<o;s++){var a=arguments[s];i?t(r,n(a)[0],a[1]):t(r,a)}return r}}},86938:(e,t,i)=>{"use strict";var n=i(2360),r=i(62106),o=i(56279),s=i(76080),a=i(90679),l=i(64117),c=i(72652),u=i(51088),h=i(62529),d=i(87633),f=i(43724),p=i(3451).fastKey,m=i(91181),g=m.set,v=m.getterFor;e.exports={getConstructor:function(e,t,i,u){var h=e((function(e,r){a(e,d),g(e,{type:t,index:n(null),first:void 0,last:void 0,size:0}),f||(e.size=0),l(r)||c(r,e[u],{that:e,AS_ENTRIES:i})})),d=h.prototype,m=v(t),y=function(e,t,i){var n,r,o=m(e),s=b(e,t);return s?s.value=i:(o.last=s={index:r=p(t,!0),key:t,value:i,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=s),n&&(n.next=s),f?o.size++:e.size++,"F"!==r&&(o.index[r]=s)),e},b=function(e,t){var i,n=m(e),r=p(t);if("F"!==r)return n.index[r];for(i=n.first;i;i=i.next)if(i.key===t)return i};return o(d,{clear:function(){for(var e=m(this),t=e.first;t;)t.removed=!0,t.previous&&(t.previous=t.previous.next=void 0),t=t.next;e.first=e.last=void 0,e.index=n(null),f?e.size=0:this.size=0},delete:function(e){var t=this,i=m(t),n=b(t,e);if(n){var r=n.next,o=n.previous;delete i.index[n.index],n.removed=!0,o&&(o.next=r),r&&(r.previous=o),i.first===n&&(i.first=r),i.last===n&&(i.last=o),f?i.size--:t.size--}return!!n},forEach:function(e){for(var t,i=m(this),n=s(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:i.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!b(this,e)}}),o(d,i?{get:function(e){var t=b(this,e);return t&&t.value},set:function(e,t){return y(this,0===e?0:e,t)}}:{add:function(e){return y(this,e=0===e?0:e,e)}}),f&&r(d,"size",{configurable:!0,get:function(){return m(this).size}}),h},setStrong:function(e,t,i){var n=t+" Iterator",r=v(t),o=v(n);u(e,t,(function(e,t){g(this,{type:n,target:e,state:r(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,i=e.last;i&&i.removed;)i=i.previous;return e.target&&(e.last=i=i?i.next:e.state.first)?h("keys"===t?i.key:"values"===t?i.value:[i.key,i.value],!1):(e.target=void 0,h(void 0,!0))}),i?"entries":"values",!i,!0),d(t)}}},91625:(e,t,i)=>{"use strict";var n=i(79504),r=i(56279),o=i(3451).getWeakData,s=i(90679),a=i(28551),l=i(64117),c=i(20034),u=i(72652),h=i(59213),d=i(39297),f=i(91181),p=f.set,m=f.getterFor,g=h.find,v=h.findIndex,y=n([].splice),b=0,x=function(e){return e.frozen||(e.frozen=new _)},_=function(){this.entries=[]},E=function(e,t){return g(e.entries,(function(e){return e[0]===t}))};_.prototype={get:function(e){var t=E(this,e);if(t)return t[1]},has:function(e){return!!E(this,e)},set:function(e,t){var i=E(this,e);i?i[1]=t:this.entries.push([e,t])},delete:function(e){var t=v(this.entries,(function(t){return t[0]===e}));return~t&&y(this.entries,t,1),!!~t}},e.exports={getConstructor:function(e,t,i,n){var h=e((function(e,r){s(e,f),p(e,{type:t,id:b++,frozen:void 0}),l(r)||u(r,e[n],{that:e,AS_ENTRIES:i})})),f=h.prototype,g=m(t),v=function(e,t,i){var n=g(e),r=o(a(t),!0);return!0===r?x(n).set(t,i):r[n.id]=i,e};return r(f,{delete:function(e){var t=g(this);if(!c(e))return!1;var i=o(e);return!0===i?x(t).delete(e):i&&d(i,t.id)&&delete i[t.id]},has:function(e){var t=g(this);if(!c(e))return!1;var i=o(e);return!0===i?x(t).has(e):i&&d(i,t.id)}}),r(f,i?{get:function(e){var t=g(this);if(c(e)){var i=o(e);return!0===i?x(t).get(e):i?i[t.id]:void 0}},set:function(e,t){return v(this,e,t)}}:{add:function(e){return v(this,e,!0)}}),h}}},16468:(e,t,i)=>{"use strict";var n=i(46518),r=i(24475),o=i(79504),s=i(92796),a=i(36840),l=i(3451),c=i(72652),u=i(90679),h=i(94901),d=i(64117),f=i(20034),p=i(79039),m=i(84428),g=i(10687),v=i(23167);e.exports=function(e,t,i){var y=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),x=y?"set":"add",_=r[e],E=_&&_.prototype,S=_,A={},w=function(e){var t=o(E[e]);a(E,e,"add"===e?function(e){return t(this,0===e?0:e),this}:"delete"===e?function(e){return!(b&&!f(e))&&t(this,0===e?0:e)}:"get"===e?function(e){return b&&!f(e)?void 0:t(this,0===e?0:e)}:"has"===e?function(e){return!(b&&!f(e))&&t(this,0===e?0:e)}:function(e,i){return t(this,0===e?0:e,i),this})};if(s(e,!h(_)||!(b||E.forEach&&!p((function(){(new _).entries().next()})))))S=i.getConstructor(t,e,y,x),l.enable();else if(s(e,!0)){var C=new S,T=C[x](b?{}:-0,1)!==C,M=p((function(){C.has(1)})),I=m((function(e){new _(e)})),P=!b&&p((function(){for(var e=new _,t=5;t--;)e[x](t,t);return!e.has(-0)}));I||((S=t((function(e,t){u(e,E);var i=v(new _,e,S);return d(t)||c(t,i[x],{that:i,AS_ENTRIES:y}),i}))).prototype=E,E.constructor=S),(M||P)&&(w("delete"),w("has"),y&&w("get")),(P||T)&&w(x),b&&E.clear&&delete E.clear}return A[e]=S,n({global:!0,constructor:!0,forced:S!==_},A),g(S,e),b||i.setStrong(S,e,y),S}},59323:(e,t,i)=>{"use strict";i(36033),i(73772);var n=i(97751),r=i(2360),o=i(20034),s=Object,a=TypeError,l=n("Map"),c=n("WeakMap"),u=function(){this.object=null,this.symbol=null,this.primitives=null,this.objectsByIndex=r(null)};u.prototype.get=function(e,t){return this[e]||(this[e]=t())},u.prototype.next=function(e,t,i){var n=i?this.objectsByIndex[e]||(this.objectsByIndex[e]=new c):this.primitives||(this.primitives=new l),r=n.get(t);return r||n.set(t,r=new u),r};var h=new u;e.exports=function(){var e,t,i=h,n=arguments.length;for(e=0;e<n;e++)o(t=arguments[e])&&(i=i.next(e,t,!0));if(this===s&&i===h)throw new a("Composite keys must contain a non-primitive component");for(e=0;e<n;e++)o(t=arguments[e])||(i=i.next(e,t,!1));return i}},77740:(e,t,i)=>{"use strict";var n=i(39297),r=i(35031),o=i(77347),s=i(24913);e.exports=function(e,t,i){for(var a=r(t),l=s.f,c=o.f,u=0;u<a.length;u++){var h=a[u];n(e,h)||i&&n(i,h)||l(e,h,c(t,h))}}},12211:(e,t,i)=>{"use strict";var n=i(79039);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},62529:e=>{"use strict";e.exports=function(e,t){return{value:e,done:t}}},66699:(e,t,i)=>{"use strict";var n=i(43724),r=i(24913),o=i(6980);e.exports=n?function(e,t,i){return r.f(e,t,o(1,i))}:function(e,t,i){return e[t]=i,e}},6980:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},62106:(e,t,i)=>{"use strict";var n=i(50283),r=i(24913);e.exports=function(e,t,i){return i.get&&n(i.get,t,{getter:!0}),i.set&&n(i.set,t,{setter:!0}),r.f(e,t,i)}},36840:(e,t,i)=>{"use strict";var n=i(94901),r=i(24913),o=i(50283),s=i(39433);e.exports=function(e,t,i,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(n(i)&&o(i,c,a),a.global)l?e[t]=i:s(t,i);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=i:r.f(e,t,{value:i,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},56279:(e,t,i)=>{"use strict";var n=i(36840);e.exports=function(e,t,i){for(var r in t)n(e,r,t[r],i);return e}},39433:(e,t,i)=>{"use strict";var n=i(24475),r=Object.defineProperty;e.exports=function(e,t){try{r(n,e,{value:t,configurable:!0,writable:!0})}catch(i){n[e]=t}return t}},43724:(e,t,i)=>{"use strict";var n=i(79039);e.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4055:(e,t,i)=>{"use strict";var n=i(24475),r=i(20034),o=n.document,s=r(o)&&r(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},6763:e=>{"use strict";e.exports="function"==typeof Bun&&Bun&&"string"==typeof Bun.version},48119:(e,t,i)=>{"use strict";var n=i(79392);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},19088:(e,t,i)=>{"use strict";var n=i(24475),r=i(44576);e.exports="process"===r(n.process)},79392:e=>{"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},77388:(e,t,i)=>{"use strict";var n,r,o=i(24475),s=i(79392),a=o.process,l=o.Deno,c=a&&a.versions||l&&l.version,u=c&&c.v8;u&&(r=(n=u.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!r&&s&&(!(n=s.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/))&&(r=+n[1]),e.exports=r},88727:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},46518:(e,t,i)=>{"use strict";var n=i(24475),r=i(77347).f,o=i(66699),s=i(36840),a=i(39433),l=i(77740),c=i(92796);e.exports=function(e,t){var i,u,h,d,f,p=e.target,m=e.global,g=e.stat;if(i=m?n:g?n[p]||a(p,{}):n[p]&&n[p].prototype)for(u in t){if(d=t[u],h=e.dontCallGetSet?(f=r(i,u))&&f.value:i[u],!c(m?u:p+(g?".":"#")+u,e.forced)&&void 0!==h){if(typeof d==typeof h)continue;l(d,h)}(e.sham||h&&h.sham)&&o(d,"sham",!0),s(i,u,d,e)}}},79039:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},92744:(e,t,i)=>{"use strict";var n=i(79039);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},18745:(e,t,i)=>{"use strict";var n=i(40616),r=Function.prototype,o=r.apply,s=r.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?s.bind(o):function(){return s.apply(o,arguments)})},76080:(e,t,i)=>{"use strict";var n=i(27476),r=i(79306),o=i(40616),s=n(n.bind);e.exports=function(e,t){return r(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},40616:(e,t,i)=>{"use strict";var n=i(79039);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},69565:(e,t,i)=>{"use strict";var n=i(40616),r=Function.prototype.call;e.exports=n?r.bind(r):function(){return r.apply(r,arguments)}},10350:(e,t,i)=>{"use strict";var n=i(43724),r=i(39297),o=Function.prototype,s=n&&Object.getOwnPropertyDescriptor,a=r(o,"name"),l=a&&"something"===function(){}.name,c=a&&(!n||n&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},46706:(e,t,i)=>{"use strict";var n=i(79504),r=i(79306);e.exports=function(e,t,i){try{return n(r(Object.getOwnPropertyDescriptor(e,t)[i]))}catch(e){}}},27476:(e,t,i)=>{"use strict";var n=i(44576),r=i(79504);e.exports=function(e){if("Function"===n(e))return r(e)}},79504:(e,t,i)=>{"use strict";var n=i(40616),r=Function.prototype,o=r.call,s=n&&r.bind.bind(o,o);e.exports=n?s:function(e){return function(){return o.apply(e,arguments)}}},97751:(e,t,i)=>{"use strict";var n=i(24475),r=i(94901);e.exports=function(e,t){return arguments.length<2?(i=n[e],r(i)?i:void 0):n[e]&&n[e][t];var i}},1767:e=>{"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},50851:(e,t,i)=>{"use strict";var n=i(36955),r=i(55966),o=i(64117),s=i(26269),a=i(78227)("iterator");e.exports=function(e){if(!o(e))return r(e,a)||r(e,"@@iterator")||s[n(e)]}},70081:(e,t,i)=>{"use strict";var n=i(69565),r=i(79306),o=i(28551),s=i(16823),a=i(50851),l=TypeError;e.exports=function(e,t){var i=arguments.length<2?a(e):t;if(r(i))return o(n(i,e));throw new l(s(e)+" is not iterable")}},55966:(e,t,i)=>{"use strict";var n=i(79306),r=i(64117);e.exports=function(e,t){var i=e[t];return r(i)?void 0:n(i)}},83789:(e,t,i)=>{"use strict";var n=i(79306),r=i(28551),o=i(69565),s=i(91291),a=i(1767),l="Invalid size",c=RangeError,u=TypeError,h=Math.max,d=function(e,t){this.set=e,this.size=h(t,0),this.has=n(e.has),this.keys=n(e.keys)};d.prototype={getIterator:function(){return a(r(o(this.keys,this.set)))},includes:function(e){return o(this.has,this.set,e)}},e.exports=function(e){r(e);var t=+e.size;if(t!=t)throw new u(l);var i=s(t);if(i<0)throw new c(l);return new d(e,i)}},24475:function(e,t,i){"use strict";var n=function(e){return e&&e.Math===Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof i.g&&i.g)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},39297:(e,t,i)=>{"use strict";var n=i(79504),r=i(48981),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(r(e),t)}},30421:e=>{"use strict";e.exports={}},90757:e=>{"use strict";e.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}},20397:(e,t,i)=>{"use strict";var n=i(97751);e.exports=n("document","documentElement")},35917:(e,t,i)=>{"use strict";var n=i(43724),r=i(79039),o=i(4055);e.exports=!n&&!r((function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},47055:(e,t,i)=>{"use strict";var n=i(79504),r=i(79039),o=i(44576),s=Object,a=n("".split);e.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===o(e)?a(e,""):s(e)}:s},23167:(e,t,i)=>{"use strict";var n=i(94901),r=i(20034),o=i(52967);e.exports=function(e,t,i){var s,a;return o&&n(s=t.constructor)&&s!==i&&r(a=s.prototype)&&a!==i.prototype&&o(e,a),e}},33706:(e,t,i)=>{"use strict";var n=i(79504),r=i(94901),o=i(77629),s=n(Function.toString);r(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},3451:(e,t,i)=>{"use strict";var n=i(46518),r=i(79504),o=i(30421),s=i(20034),a=i(39297),l=i(24913).f,c=i(38480),u=i(10298),h=i(34124),d=i(33392),f=i(92744),p=!1,m=d("meta"),g=0,v=function(e){l(e,m,{value:{objectID:"O"+g++,weakData:{}}})},y=e.exports={enable:function(){y.enable=function(){},p=!0;var e=c.f,t=r([].splice),i={};i[m]=1,e(i).length&&(c.f=function(i){for(var n=e(i),r=0,o=n.length;r<o;r++)if(n[r]===m){t(n,r,1);break}return n},n({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:u.f}))},fastKey:function(e,t){if(!s(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,m)){if(!h(e))return"F";if(!t)return"E";v(e)}return e[m].objectID},getWeakData:function(e,t){if(!a(e,m)){if(!h(e))return!0;if(!t)return!1;v(e)}return e[m].weakData},onFreeze:function(e){return f&&p&&h(e)&&!a(e,m)&&v(e),e}};o[m]=!0},91181:(e,t,i)=>{"use strict";var n,r,o,s=i(58622),a=i(24475),l=i(20034),c=i(66699),u=i(39297),h=i(77629),d=i(66119),f=i(30421),p="Object already initialized",m=a.TypeError,g=a.WeakMap;if(s||h.state){var v=h.state||(h.state=new g);v.get=v.get,v.has=v.has,v.set=v.set,n=function(e,t){if(v.has(e))throw new m(p);return t.facade=e,v.set(e,t),t},r=function(e){return v.get(e)||{}},o=function(e){return v.has(e)}}else{var y=d("state");f[y]=!0,n=function(e,t){if(u(e,y))throw new m(p);return t.facade=e,c(e,y,t),t},r=function(e){return u(e,y)?e[y]:{}},o=function(e){return u(e,y)}}e.exports={set:n,get:r,has:o,enforce:function(e){return o(e)?r(e):n(e,{})},getterFor:function(e){return function(t){var i;if(!l(t)||(i=r(t)).type!==e)throw new m("Incompatible receiver, "+e+" required");return i}}}},44209:(e,t,i)=>{"use strict";var n=i(78227),r=i(26269),o=n("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||s[o]===e)}},34376:(e,t,i)=>{"use strict";var n=i(44576);e.exports=Array.isArray||function(e){return"Array"===n(e)}},94901:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},33517:(e,t,i)=>{"use strict";var n=i(79504),r=i(79039),o=i(94901),s=i(36955),a=i(97751),l=i(33706),c=function(){},u=a("Reflect","construct"),h=/^\s*(?:class|function)\b/,d=n(h.exec),f=!h.test(c),p=function(e){if(!o(e))return!1;try{return u(c,[],e),!0}catch(e){return!1}},m=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!d(h,l(e))}catch(e){return!0}};m.sham=!0,e.exports=!u||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?m:p},92796:(e,t,i)=>{"use strict";var n=i(79039),r=i(94901),o=/#|\.prototype\./,s=function(e,t){var i=l[a(e)];return i===u||i!==c&&(r(t)?n(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=s.data={},c=s.NATIVE="N",u=s.POLYFILL="P";e.exports=s},31563:(e,t,i)=>{"use strict";var n=i(36955),r=i(39297),o=i(64117),s=i(78227),a=i(26269),l=s("iterator"),c=Object;e.exports=function(e){if(o(e))return!1;var t=c(e);return void 0!==t[l]||"@@iterator"in t||r(a,n(t))}},64117:e=>{"use strict";e.exports=function(e){return null==e}},20034:(e,t,i)=>{"use strict";var n=i(94901);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},13925:(e,t,i)=>{"use strict";var n=i(20034);e.exports=function(e){return n(e)||null===e}},96395:e=>{"use strict";e.exports=!1},10757:(e,t,i)=>{"use strict";var n=i(97751),r=i(94901),o=i(1625),s=i(7040),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return r(t)&&o(t.prototype,a(e))}},40507:(e,t,i)=>{"use strict";var n=i(69565);e.exports=function(e,t,i){for(var r,o,s=i?e:e.iterator,a=e.next;!(r=n(a,s)).done;)if(void 0!==(o=t(r.value)))return o}},72652:(e,t,i)=>{"use strict";var n=i(76080),r=i(69565),o=i(28551),s=i(16823),a=i(44209),l=i(26198),c=i(1625),u=i(70081),h=i(50851),d=i(9539),f=TypeError,p=function(e,t){this.stopped=e,this.result=t},m=p.prototype;e.exports=function(e,t,i){var g,v,y,b,x,_,E,S=i&&i.that,A=!(!i||!i.AS_ENTRIES),w=!(!i||!i.IS_RECORD),C=!(!i||!i.IS_ITERATOR),T=!(!i||!i.INTERRUPTED),M=n(t,S),I=function(e){return g&&d(g,"normal",e),new p(!0,e)},P=function(e){return A?(o(e),T?M(e[0],e[1],I):M(e[0],e[1])):T?M(e,I):M(e)};if(w)g=e.iterator;else if(C)g=e;else{if(!(v=h(e)))throw new f(s(e)+" is not iterable");if(a(v)){for(y=0,b=l(e);b>y;y++)if((x=P(e[y]))&&c(m,x))return x;return new p(!1)}g=u(e,v)}for(_=w?e.next:g.next;!(E=r(_,g)).done;){try{x=P(E.value)}catch(e){d(g,"throw",e)}if("object"==typeof x&&x&&c(m,x))return x}return new p(!1)}},9539:(e,t,i)=>{"use strict";var n=i(69565),r=i(28551),o=i(55966);e.exports=function(e,t,i){var s,a;r(e);try{if(!(s=o(e,"return"))){if("throw"===t)throw i;return i}s=n(s,e)}catch(e){a=!0,s=e}if("throw"===t)throw i;if(a)throw s;return r(s),i}},33994:(e,t,i)=>{"use strict";var n=i(57657).IteratorPrototype,r=i(2360),o=i(6980),s=i(10687),a=i(26269),l=function(){return this};e.exports=function(e,t,i,c){var u=t+" Iterator";return e.prototype=r(n,{next:o(+!c,i)}),s(e,u,!1,!0),a[u]=l,e}},51088:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(96395),s=i(10350),a=i(94901),l=i(33994),c=i(42787),u=i(52967),h=i(10687),d=i(66699),f=i(36840),p=i(78227),m=i(26269),g=i(57657),v=s.PROPER,y=s.CONFIGURABLE,b=g.IteratorPrototype,x=g.BUGGY_SAFARI_ITERATORS,_=p("iterator"),E="keys",S="values",A="entries",w=function(){return this};e.exports=function(e,t,i,s,p,g,C){l(i,t,s);var T,M,I,P=function(e){if(e===p&&B)return B;if(!x&&e&&e in D)return D[e];switch(e){case E:case S:case A:return function(){return new i(this,e)}}return function(){return new i(this)}},L=t+" Iterator",R=!1,D=e.prototype,O=D[_]||D["@@iterator"]||p&&D[p],B=!x&&O||P(p),N="Array"===t&&D.entries||O;if(N&&(T=c(N.call(new e)))!==Object.prototype&&T.next&&(o||c(T)===b||(u?u(T,b):a(T[_])||f(T,_,w)),h(T,L,!0,!0),o&&(m[L]=w)),v&&p===S&&O&&O.name!==S&&(!o&&y?d(D,"name",S):(R=!0,B=function(){return r(O,this)})),p)if(M={values:P(S),keys:g?B:P(E),entries:P(A)},C)for(I in M)(x||R||!(I in D))&&f(D,I,M[I]);else n({target:t,proto:!0,forced:x||R},M);return o&&!C||D[_]===B||f(D,_,B,{name:p}),m[t]=B,M}},57657:(e,t,i)=>{"use strict";var n,r,o,s=i(79039),a=i(94901),l=i(20034),c=i(2360),u=i(42787),h=i(36840),d=i(78227),f=i(96395),p=d("iterator"),m=!1;[].keys&&("next"in(o=[].keys())?(r=u(u(o)))!==Object.prototype&&(n=r):m=!0),!l(n)||s((function(){var e={};return n[p].call(e)!==e}))?n={}:f&&(n=c(n)),a(n[p])||h(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:m}},26269:e=>{"use strict";e.exports={}},26198:(e,t,i)=>{"use strict";var n=i(18014);e.exports=function(e){return n(e.length)}},50283:(e,t,i)=>{"use strict";var n=i(79504),r=i(79039),o=i(94901),s=i(39297),a=i(43724),l=i(10350).CONFIGURABLE,c=i(33706),u=i(91181),h=u.enforce,d=u.get,f=String,p=Object.defineProperty,m=n("".slice),g=n("".replace),v=n([].join),y=a&&!r((function(){return 8!==p((function(){}),"length",{value:8}).length})),b=String(String).split("String"),x=e.exports=function(e,t,i){"Symbol("===m(f(t),0,7)&&(t="["+g(f(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),i&&i.getter&&(t="get "+t),i&&i.setter&&(t="set "+t),(!s(e,"name")||l&&e.name!==t)&&(a?p(e,"name",{value:t,configurable:!0}):e.name=t),y&&i&&s(i,"arity")&&e.length!==i.arity&&p(e,"length",{value:i.arity});try{i&&s(i,"constructor")&&i.constructor?a&&p(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=h(e);return s(n,"source")||(n.source=v(b,"string"==typeof t?t:"")),e};Function.prototype.toString=x((function(){return o(this)&&d(this).source||c(this)}),"toString")},72248:(e,t,i)=>{"use strict";var n=i(79504),r=Map.prototype;e.exports={Map,set:n(r.set),get:n(r.get),has:n(r.has),remove:n(r.delete),proto:r}},26223:(e,t,i)=>{"use strict";var n=i(79504),r=i(40507),o=i(72248),s=o.Map,a=o.proto,l=n(a.forEach),c=n(a.entries),u=c(new s).next;e.exports=function(e,t,i){return i?r({iterator:c(e),next:u},(function(e){return t(e[1],e[0])})):l(e,t)}},33164:(e,t,i)=>{"use strict";var n=i(77782),r=Math.abs,o=2220446049250313e-31,s=1/o;e.exports=function(e,t,i,a){var l=+e,c=r(l),u=n(l);if(c<a)return u*function(e){return e+s-s}(c/a/t)*a*t;var h=(1+t/o)*c,d=h-(h-c);return d>i||d!=d?u*(1/0):u*d}},15617:(e,t,i)=>{"use strict";var n=i(33164);e.exports=Math.fround||function(e){return n(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)}},77905:e=>{"use strict";e.exports=Math.scale||function(e,t,i,n,r){var o=+e,s=+t,a=+i,l=+n,c=+r;return o!=o||s!=s||a!=a||l!=l||c!=c?NaN:o===1/0||o===-1/0?o:(o-s)*(c-l)/(a-s)+l}},77782:e=>{"use strict";e.exports=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1}},80741:e=>{"use strict";var t=Math.ceil,i=Math.floor;e.exports=Math.trunc||function(e){var n=+e;return(n>0?i:t)(n)}},36043:(e,t,i)=>{"use strict";var n=i(79306),r=TypeError,o=function(e){var t,i;this.promise=new e((function(e,n){if(void 0!==t||void 0!==i)throw new r("Bad Promise constructor");t=e,i=n})),this.resolve=n(t),this.reject=n(i)};e.exports.f=function(e){return new o(e)}},50360:(e,t,i)=>{"use strict";var n=i(24475).isFinite;e.exports=Number.isFinite||function(e){return"number"==typeof e&&n(e)}},2360:(e,t,i)=>{"use strict";var n,r=i(28551),o=i(96801),s=i(88727),a=i(30421),l=i(20397),c=i(4055),u=i(66119),h="prototype",d="script",f=u("IE_PROTO"),p=function(){},m=function(e){return"<"+d+">"+e+"</"+d+">"},g=function(e){e.write(m("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,i;v="undefined"!=typeof document?document.domain&&n?g(n):(t=c("iframe"),i="java"+d+":",t.style.display="none",l.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(m("document.F=Object")),e.close(),e.F):g(n);for(var r=s.length;r--;)delete v[h][s[r]];return v()};a[f]=!0,e.exports=Object.create||function(e,t){var i;return null!==e?(p[h]=r(e),i=new p,p[h]=null,i[f]=e):i=v(),void 0===t?i:o.f(i,t)}},96801:(e,t,i)=>{"use strict";var n=i(43724),r=i(48686),o=i(24913),s=i(28551),a=i(25397),l=i(71072);t.f=n&&!r?Object.defineProperties:function(e,t){s(e);for(var i,n=a(t),r=l(t),c=r.length,u=0;c>u;)o.f(e,i=r[u++],n[i]);return e}},24913:(e,t,i)=>{"use strict";var n=i(43724),r=i(35917),o=i(48686),s=i(28551),a=i(56969),l=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,h="enumerable",d="configurable",f="writable";t.f=n?o?function(e,t,i){if(s(e),t=a(t),s(i),"function"==typeof e&&"prototype"===t&&"value"in i&&f in i&&!i[f]){var n=u(e,t);n&&n[f]&&(e[t]=i.value,i={configurable:d in i?i[d]:n[d],enumerable:h in i?i[h]:n[h],writable:!1})}return c(e,t,i)}:c:function(e,t,i){if(s(e),t=a(t),s(i),r)try{return c(e,t,i)}catch(e){}if("get"in i||"set"in i)throw new l("Accessors not supported");return"value"in i&&(e[t]=i.value),e}},77347:(e,t,i)=>{"use strict";var n=i(43724),r=i(69565),o=i(48773),s=i(6980),a=i(25397),l=i(56969),c=i(39297),u=i(35917),h=Object.getOwnPropertyDescriptor;t.f=n?h:function(e,t){if(e=a(e),t=l(t),u)try{return h(e,t)}catch(e){}if(c(e,t))return s(!r(o.f,e,t),e[t])}},10298:(e,t,i)=>{"use strict";var n=i(44576),r=i(25397),o=i(38480).f,s=i(67680),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"===n(e)?function(e){try{return o(e)}catch(e){return s(a)}}(e):o(r(e))}},38480:(e,t,i)=>{"use strict";var n=i(61828),r=i(88727).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,r)}},33717:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},42787:(e,t,i)=>{"use strict";var n=i(39297),r=i(94901),o=i(48981),s=i(66119),a=i(12211),l=s("IE_PROTO"),c=Object,u=c.prototype;e.exports=a?c.getPrototypeOf:function(e){var t=o(e);if(n(t,l))return t[l];var i=t.constructor;return r(i)&&t instanceof i?i.prototype:t instanceof c?u:null}},34124:(e,t,i)=>{"use strict";var n=i(79039),r=i(20034),o=i(44576),s=i(15652),a=Object.isExtensible,l=n((function(){a(1)}));e.exports=l||s?function(e){return!!r(e)&&((!s||"ArrayBuffer"!==o(e))&&(!a||a(e)))}:a},1625:(e,t,i)=>{"use strict";var n=i(79504);e.exports=n({}.isPrototypeOf)},61828:(e,t,i)=>{"use strict";var n=i(79504),r=i(39297),o=i(25397),s=i(19617).indexOf,a=i(30421),l=n([].push);e.exports=function(e,t){var i,n=o(e),c=0,u=[];for(i in n)!r(a,i)&&r(n,i)&&l(u,i);for(;t.length>c;)r(n,i=t[c++])&&(~s(u,i)||l(u,i));return u}},71072:(e,t,i)=>{"use strict";var n=i(61828),r=i(88727);e.exports=Object.keys||function(e){return n(e,r)}},48773:(e,t)=>{"use strict";var i={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,r=n&&!i.call({1:2},1);t.f=r?function(e){var t=n(this,e);return!!t&&t.enumerable}:i},52967:(e,t,i)=>{"use strict";var n=i(46706),r=i(20034),o=i(67750),s=i(73506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=n(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch(e){}return function(i,n){return o(i),s(n),r(i)?(t?e(i,n):i.__proto__=n,i):i}}():void 0)},84270:(e,t,i)=>{"use strict";var n=i(69565),r=i(94901),o=i(20034),s=TypeError;e.exports=function(e,t){var i,a;if("string"===t&&r(i=e.toString)&&!o(a=n(i,e)))return a;if(r(i=e.valueOf)&&!o(a=n(i,e)))return a;if("string"!==t&&r(i=e.toString)&&!o(a=n(i,e)))return a;throw new s("Can't convert object to primitive value")}},35031:(e,t,i)=>{"use strict";var n=i(97751),r=i(79504),o=i(38480),s=i(33717),a=i(28551),l=r([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(a(e)),i=s.f;return i?l(t,i(e)):t}},19167:(e,t,i)=>{"use strict";var n=i(24475);e.exports=n},1103:e=>{"use strict";e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},18449:(e,t,i)=>{"use strict";i(36033),i(73772);var n=i(97751),r=i(79504),o=i(25745),s=n("Map"),a=n("WeakMap"),l=r([].push),c=o("metadata"),u=c.store||(c.store=new a),h=function(e,t,i){var n=u.get(e);if(!n){if(!i)return;u.set(e,n=new s)}var r=n.get(t);if(!r){if(!i)return;n.set(t,r=new s)}return r};e.exports={store:u,getMap:h,has:function(e,t,i){var n=h(t,i,!1);return void 0!==n&&n.has(e)},get:function(e,t,i){var n=h(t,i,!1);return void 0===n?void 0:n.get(e)},set:function(e,t,i,n){h(i,n,!0).set(e,t)},keys:function(e,t){var i=h(e,t,!1),n=[];return i&&i.forEach((function(e,t){l(n,t)})),n},toKey:function(e){return void 0===e||"symbol"==typeof e?e:String(e)}}},67979:(e,t,i)=>{"use strict";var n=i(28551);e.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},67750:(e,t,i)=>{"use strict";var n=i(64117),r=TypeError;e.exports=function(e){if(n(e))throw new r("Can't call method on "+e);return e}},33317:e=>{"use strict";e.exports=function(e,t){return e===t||e!=e&&t!=t}},79472:(e,t,i)=>{"use strict";var n,r=i(24475),o=i(18745),s=i(94901),a=i(6763),l=i(79392),c=i(67680),u=i(22812),h=r.Function,d=/MSIE .\./.test(l)||a&&((n=r.Bun.version.split(".")).length<3||"0"===n[0]&&(n[1]<3||"3"===n[1]&&"0"===n[2]));e.exports=function(e,t){var i=t?2:1;return d?function(n,r){var a=u(arguments.length,1)>i,l=s(n)?n:h(n),d=a?c(arguments,i):[],f=a?function(){o(l,this,d)}:l;return t?e(f,r):e(f)}:e}},89286:(e,t,i)=>{"use strict";var n=i(94402),r=i(38469),o=n.Set,s=n.add;e.exports=function(e){var t=new o;return r(e,(function(e){s(t,e)})),t}},83440:(e,t,i)=>{"use strict";var n=i(97080),r=i(94402),o=i(89286),s=i(25170),a=i(83789),l=i(38469),c=i(40507),u=r.has,h=r.remove;e.exports=function(e){var t=n(this),i=a(e),r=o(t);return s(t)<=i.size?l(t,(function(e){i.includes(e)&&h(r,e)})):c(i.getIterator(),(function(e){u(t,e)&&h(r,e)})),r}},94402:(e,t,i)=>{"use strict";var n=i(79504),r=Set.prototype;e.exports={Set,add:n(r.add),has:n(r.has),remove:n(r.delete),proto:r}},68750:(e,t,i)=>{"use strict";var n=i(97080),r=i(94402),o=i(25170),s=i(83789),a=i(38469),l=i(40507),c=r.Set,u=r.add,h=r.has;e.exports=function(e){var t=n(this),i=s(e),r=new c;return o(t)>i.size?l(i.getIterator(),(function(e){h(t,e)&&u(r,e)})):a(t,(function(e){i.includes(e)&&u(r,e)})),r}},64449:(e,t,i)=>{"use strict";var n=i(97080),r=i(94402).has,o=i(25170),s=i(83789),a=i(38469),l=i(40507),c=i(9539);e.exports=function(e){var t=n(this),i=s(e);if(o(t)<=i.size)return!1!==a(t,(function(e){if(i.includes(e))return!1}),!0);var u=i.getIterator();return!1!==l(u,(function(e){if(r(t,e))return c(u,"normal",!1)}))}},53838:(e,t,i)=>{"use strict";var n=i(97080),r=i(25170),o=i(38469),s=i(83789);e.exports=function(e){var t=n(this),i=s(e);return!(r(t)>i.size)&&!1!==o(t,(function(e){if(!i.includes(e))return!1}),!0)}},28527:(e,t,i)=>{"use strict";var n=i(97080),r=i(94402).has,o=i(25170),s=i(83789),a=i(40507),l=i(9539);e.exports=function(e){var t=n(this),i=s(e);if(o(t)<i.size)return!1;var c=i.getIterator();return!1!==a(c,(function(e){if(!r(t,e))return l(c,"normal",!1)}))}},38469:(e,t,i)=>{"use strict";var n=i(79504),r=i(40507),o=i(94402),s=o.Set,a=o.proto,l=n(a.forEach),c=n(a.keys),u=c(new s).next;e.exports=function(e,t,i){return i?r({iterator:c(e),next:u},t):l(e,t)}},25170:(e,t,i)=>{"use strict";var n=i(46706),r=i(94402);e.exports=n(r.proto,"size","get")||function(e){return e.size}},87633:(e,t,i)=>{"use strict";var n=i(97751),r=i(62106),o=i(78227),s=i(43724),a=o("species");e.exports=function(e){var t=n(e);s&&t&&!t[a]&&r(t,a,{configurable:!0,get:function(){return this}})}},83650:(e,t,i)=>{"use strict";var n=i(97080),r=i(94402),o=i(89286),s=i(83789),a=i(40507),l=r.add,c=r.has,u=r.remove;e.exports=function(e){var t=n(this),i=s(e).getIterator(),r=o(t);return a(i,(function(e){c(t,e)?u(r,e):l(r,e)})),r}},10687:(e,t,i)=>{"use strict";var n=i(24913).f,r=i(39297),o=i(78227)("toStringTag");e.exports=function(e,t,i){e&&!i&&(e=e.prototype),e&&!r(e,o)&&n(e,o,{configurable:!0,value:t})}},44204:(e,t,i)=>{"use strict";var n=i(97080),r=i(94402).add,o=i(89286),s=i(83789),a=i(40507);e.exports=function(e){var t=n(this),i=s(e).getIterator(),l=o(t);return a(i,(function(e){r(l,e)})),l}},66119:(e,t,i)=>{"use strict";var n=i(25745),r=i(33392),o=n("keys");e.exports=function(e){return o[e]||(o[e]=r(e))}},77629:(e,t,i)=>{"use strict";var n=i(96395),r=i(24475),o=i(39433),s="__core-js_shared__",a=e.exports=r[s]||o(s,{});(a.versions||(a.versions=[])).push({version:"3.36.1",mode:n?"pure":"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.36.1/LICENSE",source:"https://github.com/zloirock/core-js"})},25745:(e,t,i)=>{"use strict";var n=i(77629);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},68183:(e,t,i)=>{"use strict";var n=i(79504),r=i(91291),o=i(655),s=i(67750),a=n("".charAt),l=n("".charCodeAt),c=n("".slice),u=function(e){return function(t,i){var n,u,h=o(s(t)),d=r(i),f=h.length;return d<0||d>=f?e?"":void 0:(n=l(h,d))<55296||n>56319||d+1===f||(u=l(h,d+1))<56320||u>57343?e?a(h,d):n:e?c(h,d,d+2):u-56320+(n-55296<<10)+65536}};e.exports={codeAt:u(!1),charAt:u(!0)}},4495:(e,t,i)=>{"use strict";var n=i(77388),r=i(79039),o=i(24475).String;e.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},59225:(e,t,i)=>{"use strict";var n,r,o,s,a=i(24475),l=i(18745),c=i(76080),u=i(94901),h=i(39297),d=i(79039),f=i(20397),p=i(67680),m=i(4055),g=i(22812),v=i(48119),y=i(19088),b=a.setImmediate,x=a.clearImmediate,_=a.process,E=a.Dispatch,S=a.Function,A=a.MessageChannel,w=a.String,C=0,T={},M="onreadystatechange";d((function(){n=a.location}));var I=function(e){if(h(T,e)){var t=T[e];delete T[e],t()}},P=function(e){return function(){I(e)}},L=function(e){I(e.data)},R=function(e){a.postMessage(w(e),n.protocol+"//"+n.host)};b&&x||(b=function(e){g(arguments.length,1);var t=u(e)?e:S(e),i=p(arguments,1);return T[++C]=function(){l(t,void 0,i)},r(C),C},x=function(e){delete T[e]},y?r=function(e){_.nextTick(P(e))}:E&&E.now?r=function(e){E.now(P(e))}:A&&!v?(s=(o=new A).port2,o.port1.onmessage=L,r=c(s.postMessage,s)):a.addEventListener&&u(a.postMessage)&&!a.importScripts&&n&&"file:"!==n.protocol&&!d(R)?(r=R,a.addEventListener("message",L,!1)):r=M in m("script")?function(e){f.appendChild(m("script"))[M]=function(){f.removeChild(this),I(e)}}:function(e){setTimeout(P(e),0)}),e.exports={set:b,clear:x}},35610:(e,t,i)=>{"use strict";var n=i(91291),r=Math.max,o=Math.min;e.exports=function(e,t){var i=n(e);return i<0?r(i+t,0):o(i,t)}},25397:(e,t,i)=>{"use strict";var n=i(47055),r=i(67750);e.exports=function(e){return n(r(e))}},91291:(e,t,i)=>{"use strict";var n=i(80741);e.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}},18014:(e,t,i)=>{"use strict";var n=i(91291),r=Math.min;e.exports=function(e){var t=n(e);return t>0?r(t,9007199254740991):0}},48981:(e,t,i)=>{"use strict";var n=i(67750),r=Object;e.exports=function(e){return r(n(e))}},58229:(e,t,i)=>{"use strict";var n=i(99590),r=RangeError;e.exports=function(e,t){var i=n(e);if(i%t)throw new r("Wrong offset");return i}},99590:(e,t,i)=>{"use strict";var n=i(91291),r=RangeError;e.exports=function(e){var t=n(e);if(t<0)throw new r("The argument can't be less than 0");return t}},72777:(e,t,i)=>{"use strict";var n=i(69565),r=i(20034),o=i(10757),s=i(55966),a=i(84270),l=i(78227),c=TypeError,u=l("toPrimitive");e.exports=function(e,t){if(!r(e)||o(e))return e;var i,l=s(e,u);if(l){if(void 0===t&&(t="default"),i=n(l,e,t),!r(i)||o(i))return i;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},56969:(e,t,i)=>{"use strict";var n=i(72777),r=i(10757);e.exports=function(e){var t=n(e,"string");return r(t)?t:t+""}},47650:(e,t,i)=>{"use strict";var n=i(97751),r=i(94901),o=i(31563),s=i(20034),a=n("Set");e.exports=function(e){return function(e){return s(e)&&"number"==typeof e.size&&r(e.has)&&r(e.keys)}(e)?e:o(e)?new a(e):e}},92140:(e,t,i)=>{"use strict";var n={};n[i(78227)("toStringTag")]="z",e.exports="[object z]"===String(n)},655:(e,t,i)=>{"use strict";var n=i(36955),r=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}},16823:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},33392:(e,t,i)=>{"use strict";var n=i(79504),r=0,o=Math.random(),s=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+o,36)}},7040:(e,t,i)=>{"use strict";var n=i(4495);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},48686:(e,t,i)=>{"use strict";var n=i(43724),r=i(79039);e.exports=n&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},22812:e=>{"use strict";var t=TypeError;e.exports=function(e,i){if(e<i)throw new t("Not enough arguments");return e}},58622:(e,t,i)=>{"use strict";var n=i(24475),r=i(94901),o=n.WeakMap;e.exports=r(o)&&/native code/.test(String(o))},44995:(e,t,i)=>{"use strict";var n=i(79504),r=WeakMap.prototype;e.exports={WeakMap,set:n(r.set),get:n(r.get),has:n(r.has),remove:n(r.delete)}},88205:(e,t,i)=>{"use strict";var n=i(79504),r=WeakSet.prototype;e.exports={WeakSet,add:n(r.add),has:n(r.has),remove:n(r.delete)}},70511:(e,t,i)=>{"use strict";var n=i(19167),r=i(39297),o=i(1951),s=i(24913).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});r(t,e)||s(t,e,{value:o.f(e)})}},1951:(e,t,i)=>{"use strict";var n=i(78227);t.f=n},78227:(e,t,i)=>{"use strict";var n=i(24475),r=i(25745),o=i(39297),s=i(33392),a=i(4495),l=i(7040),c=n.Symbol,u=r("wks"),h=l?c.for||c:c&&c.withoutSetter||s;e.exports=function(e){return o(u,e)||(u[e]=a&&o(c,e)?c[e]:h("Symbol."+e)),u[e]}},74423:(e,t,i)=>{"use strict";var n=i(46518),r=i(19617).includes,o=i(79039),s=i(6469);n({target:"Array",proto:!0,forced:o((function(){return!Array(1).includes()}))},{includes:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),s("includes")},48523:(e,t,i)=>{"use strict";i(16468)("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),i(86938))},47072:(e,t,i)=>{"use strict";var n=i(46518),r=i(79504),o=i(79306),s=i(67750),a=i(72652),l=i(72248),c=i(96395),u=l.Map,h=l.has,d=l.get,f=l.set,p=r([].push);n({target:"Map",stat:!0,forced:c},{groupBy:function(e,t){s(e),o(t);var i=new u,n=0;return a(e,(function(e){var r=t(e,n++);h(i,r)?p(d(i,r),e):f(i,r,[e])})),i}})},36033:(e,t,i)=>{"use strict";i(48523)},69479:(e,t,i)=>{"use strict";var n=i(24475),r=i(43724),o=i(62106),s=i(67979),a=i(79039),l=n.RegExp,c=l.prototype;r&&a((function(){var e=!0;try{l(".","d")}catch(t){e=!1}var t={},i="",n=e?"dgimsy":"gimsy",r=function(e,n){Object.defineProperty(t,e,{get:function(){return i+=n,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var s in e&&(o.hasIndices="d"),o)r(s,o[s]);return Object.getOwnPropertyDescriptor(c,"flags").get.call(t)!==n||i!==n}))&&o(c,"flags",{configurable:!0,get:s})},28845:(e,t,i)=>{"use strict";var n=i(24475),r=i(69565),o=i(94644),s=i(26198),a=i(58229),l=i(48981),c=i(79039),u=n.RangeError,h=n.Int8Array,d=h&&h.prototype,f=d&&d.set,p=o.aTypedArray,m=o.exportTypedArrayMethod,g=!c((function(){var e=new Uint8ClampedArray(2);return r(f,e,{length:1,0:3},1),3!==e[1]})),v=g&&o.NATIVE_ARRAY_BUFFER_VIEWS&&c((function(){var e=new h(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));m("set",(function(e){p(this);var t=a(arguments.length>1?arguments[1]:void 0,1),i=l(e);if(g)return r(f,this,i,t);var n=this.length,o=s(i),c=0;if(o+t>n)throw new u("Wrong length");for(;c<o;)this[t+c]=i[c++]}),!g||v)},65746:(e,t,i)=>{"use strict";var n,r=i(92744),o=i(24475),s=i(79504),a=i(56279),l=i(3451),c=i(16468),u=i(91625),h=i(20034),d=i(91181).enforce,f=i(79039),p=i(58622),m=Object,g=Array.isArray,v=m.isExtensible,y=m.isFrozen,b=m.isSealed,x=m.freeze,_=m.seal,E=!o.ActiveXObject&&"ActiveXObject"in o,S=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},A=c("WeakMap",S,u),w=A.prototype,C=s(w.set);if(p)if(E){n=u.getConstructor(S,"WeakMap",!0),l.enable();var T=s(w.delete),M=s(w.has),I=s(w.get);a(w,{delete:function(e){if(h(e)&&!v(e)){var t=d(this);return t.frozen||(t.frozen=new n),T(this,e)||t.frozen.delete(e)}return T(this,e)},has:function(e){if(h(e)&&!v(e)){var t=d(this);return t.frozen||(t.frozen=new n),M(this,e)||t.frozen.has(e)}return M(this,e)},get:function(e){if(h(e)&&!v(e)){var t=d(this);return t.frozen||(t.frozen=new n),M(this,e)?I(this,e):t.frozen.get(e)}return I(this,e)},set:function(e,t){if(h(e)&&!v(e)){var i=d(this);i.frozen||(i.frozen=new n),M(this,e)?C(this,e,t):i.frozen.set(e,t)}else C(this,e,t);return this}})}else r&&f((function(){var e=x([]);return C(new A,e,1),!y(e)}))&&a(w,{set:function(e,t){var i;return g(e)&&(y(e)?i=x:b(e)&&(i=_)),C(this,e,t),i&&i(e),this}})},73772:(e,t,i)=>{"use strict";i(65746)},17656:(e,t,i)=>{"use strict";var n=i(43724),r=i(6469),o=i(48981),s=i(26198),a=i(62106);n&&(a(Array.prototype,"lastIndex",{configurable:!0,get:function(){var e=o(this),t=s(e);return 0===t?0:t-1}}),r("lastIndex"))},55105:(e,t,i)=>{"use strict";var n=i(43724),r=i(6469),o=i(48981),s=i(26198),a=i(62106);n&&(a(Array.prototype,"lastItem",{configurable:!0,get:function(){var e=o(this),t=s(e);return 0===t?void 0:e[t-1]},set:function(e){var t=o(this),i=s(t);return t[0===i?0:i-1]=e}}),r("lastItem"))},7467:(e,t,i)=>{"use strict";var n=i(46518),r=i(18745),o=i(59323),s=i(97751),a=i(2360),l=Object,c=function(){var e=s("Object","freeze");return e?e(a(null)):a(null)};n({global:!0,forced:!0},{compositeKey:function(){return r(o,l,arguments).get("object",c)}})},10586:(e,t,i)=>{"use strict";var n=i(46518),r=i(59323),o=i(97751),s=i(18745);n({global:!0,forced:!0},{compositeSymbol:function(){return 1===arguments.length&&"string"==typeof arguments[0]?o("Symbol").for(arguments[0]):s(r,null,arguments).get("symbol",o("Symbol"))}})},71517:(e,t,i)=>{"use strict";var n=i(46518),r=i(36194),o=i(72248).remove;n({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=r(this),i=!0,n=0,s=arguments.length;n<s;n++)e=o(t,arguments[n]),i=i&&e;return!!i}})},93777:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(36194),s=i(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0);return!1!==s(t,(function(e,n){if(!i(e,n,t))return!1}),!0)}})},14190:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(36194),s=i(72248),a=i(26223),l=s.Map,c=s.set;n({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e,r){i(e,r,t)&&c(n,r,e)})),n}})},86097:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(36194),s=i(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0),n=s(t,(function(e,n){if(i(e,n,t))return{key:n}}),!0);return n&&n.key}})},12359:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(36194),s=i(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0),n=s(t,(function(e,n){if(i(e,n,t))return{value:e}}),!0);return n&&n.value}})},39172:(e,t,i)=>{"use strict";var n=i(46518),r=i(72248);n({target:"Map",stat:!0,forced:!0},{from:i(70933)(r.Map,r.set,!0)})},57019:(e,t,i)=>{"use strict";i(47072)},17273:(e,t,i)=>{"use strict";var n=i(46518),r=i(33317),o=i(36194),s=i(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return!0===s(o(this),(function(t){if(r(t,e))return!0}),!0)}})},81723:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(72652),s=i(94901),a=i(79306),l=i(72248).Map;n({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var i=new(s(this)?this:l);a(t);var n=a(i.set);return o(e,(function(e){r(n,i,t(e),e)})),i}})},27415:(e,t,i)=>{"use strict";var n=i(46518),r=i(36194),o=i(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){var t=o(r(this),(function(t,i){if(t===e)return{key:i}}),!0);return t&&t.key}})},19929:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(36194),s=i(72248),a=i(26223),l=s.Map,c=s.set;n({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e,r){c(n,i(e,r,t),e)})),n}})},37583:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(36194),s=i(72248),a=i(26223),l=s.Map,c=s.set;n({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e,r){c(n,r,i(e,r,t))})),n}})},55122:(e,t,i)=>{"use strict";var n=i(46518),r=i(36194),o=i(72652),s=i(72248).set;n({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=r(this),i=arguments.length,n=0;n<i;)o(arguments[n++],(function(e,i){s(t,e,i)}),{AS_ENTRIES:!0});return t}})},16385:(e,t,i)=>{"use strict";var n=i(46518),r=i(72248);n({target:"Map",stat:!0,forced:!0},{of:i(87500)(r.Map,r.set,!0)})},20230:(e,t,i)=>{"use strict";var n=i(46518),r=i(79306),o=i(36194),s=i(26223),a=TypeError;n({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=o(this),i=arguments.length<2,n=i?void 0:arguments[1];if(r(e),s(t,(function(r,o){i?(i=!1,n=r):n=e(n,r,o,t)})),i)throw new a("Reduce of empty map with no initial value");return n}})},57268:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(36194),s=i(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0);return!0===s(t,(function(e,n){if(i(e,n,t))return!0}),!0)}})},79733:(e,t,i)=>{"use strict";var n=i(46518),r=i(79306),o=i(36194),s=i(72248),a=TypeError,l=s.get,c=s.has,u=s.set;n({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var i=o(this),n=arguments.length;r(t);var s=c(i,e);if(!s&&n<3)throw new a("Updating absent value");var h=s?l(i,e):r(n>2?arguments[2]:void 0)(e,i);return u(i,e,t(h,e,i)),i}})},58179:(e,t,i)=>{"use strict";var n=i(46518),r=Math.min,o=Math.max;n({target:"Math",stat:!0,forced:!0},{clamp:function(e,t,i){return r(i,o(t,e))}})},30456:(e,t,i)=>{"use strict";i(46518)({target:"Math",stat:!0,nonConfigurable:!0,nonWritable:!0},{DEG_PER_RAD:Math.PI/180})},74017:(e,t,i)=>{"use strict";var n=i(46518),r=180/Math.PI;n({target:"Math",stat:!0,forced:!0},{degrees:function(e){return e*r}})},79310:(e,t,i)=>{"use strict";var n=i(46518),r=i(77905),o=i(15617);n({target:"Math",stat:!0,forced:!0},{fscale:function(e,t,i,n,s){return o(r(e,t,i,n,s))}})},83062:(e,t,i)=>{"use strict";i(46518)({target:"Math",stat:!0,forced:!0},{iaddh:function(e,t,i,n){var r=e>>>0,o=i>>>0;return(t>>>0)+(n>>>0)+((r&o|(r|o)&~(r+o>>>0))>>>31)|0}})},96369:(e,t,i)=>{"use strict";i(46518)({target:"Math",stat:!0,forced:!0},{imulh:function(e,t){var i=65535,n=+e,r=+t,o=n&i,s=r&i,a=n>>16,l=r>>16,c=(a*s>>>0)+(o*s>>>16);return a*l+(c>>16)+((o*l>>>0)+(c&i)>>16)}})},15637:(e,t,i)=>{"use strict";i(46518)({target:"Math",stat:!0,forced:!0},{isubh:function(e,t,i,n){var r=e>>>0,o=i>>>0;return(t>>>0)-(n>>>0)-((~r&o|(r^~o)&r-o>>>0)>>>31)|0}})},2848:(e,t,i)=>{"use strict";i(46518)({target:"Math",stat:!0,nonConfigurable:!0,nonWritable:!0},{RAD_PER_DEG:180/Math.PI})},24842:(e,t,i)=>{"use strict";var n=i(46518),r=Math.PI/180;n({target:"Math",stat:!0,forced:!0},{radians:function(e){return e*r}})},24746:(e,t,i)=>{"use strict";i(46518)({target:"Math",stat:!0,forced:!0},{scale:i(77905)})},33454:(e,t,i)=>{"use strict";var n=i(46518),r=i(28551),o=i(50360),s=i(33994),a=i(62529),l=i(91181),c="Seeded Random",u=c+" Generator",h=l.set,d=l.getterFor(u),f=TypeError,p=s((function(e){h(this,{type:u,seed:e%2147483647})}),c,(function(){var e=d(this),t=e.seed=(1103515245*e.seed+12345)%2147483647;return a((1073741823&t)/1073741823,!1)}));n({target:"Math",stat:!0,forced:!0},{seededPRNG:function(e){var t=r(e).seed;if(!o(t))throw new f('Math.seededPRNG() argument should have a "seed" field with a finite value.');return new p(t)}})},6660:(e,t,i)=>{"use strict";i(46518)({target:"Math",stat:!0,forced:!0},{signbit:function(e){var t=+e;return t==t&&0===t?1/t==-1/0:t<0}})},15941:(e,t,i)=>{"use strict";i(46518)({target:"Math",stat:!0,forced:!0},{umulh:function(e,t){var i=65535,n=+e,r=+t,o=n&i,s=r&i,a=n>>>16,l=r>>>16,c=(a*s>>>0)+(o*s>>>16);return a*l+(c>>>16)+((o*l>>>0)+(c&i)>>>16)}})},82101:(e,t,i)=>{"use strict";var n=i(46518),r=i(79504),o=i(91291),s="Invalid number representation",a=RangeError,l=SyntaxError,c=TypeError,u=parseInt,h=Math.pow,d=/^[\d.a-z]+$/,f=r("".charAt),p=r(d.exec),m=r(1..toString),g=r("".slice),v=r("".split);n({target:"Number",stat:!0,forced:!0},{fromString:function(e,t){var i=1;if("string"!=typeof e)throw new c(s);if(!e.length)throw new l(s);if("-"===f(e,0)&&(i=-1,!(e=g(e,1)).length))throw new l(s);var n=void 0===t?10:o(t);if(n<2||n>36)throw new a("Invalid radix");if(!p(d,e))throw new l(s);var r=v(e,"."),y=u(r[0],n);if(r.length>1&&(y+=u(r[1],n)/h(n,r[1].length)),10===n&&m(y,n)!==e)throw new l(s);return i*y}})},15239:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(43724),s=i(87633),a=i(79306),l=i(28551),c=i(90679),u=i(94901),h=i(64117),d=i(20034),f=i(55966),p=i(36840),m=i(56279),g=i(62106),v=i(90757),y=i(78227),b=i(91181),x=y("observable"),_="Observable",E="Subscription",S="SubscriptionObserver",A=b.getterFor,w=b.set,C=A(_),T=A(E),M=A(S),I=function(e){this.observer=l(e),this.cleanup=void 0,this.subscriptionObserver=void 0};I.prototype={type:E,clean:function(){var e=this.cleanup;if(e){this.cleanup=void 0;try{e()}catch(e){v(e)}}},close:function(){if(!o){var e=this.facade,t=this.subscriptionObserver;e.closed=!0,t&&(t.closed=!0)}this.observer=void 0},isClosed:function(){return void 0===this.observer}};var P=function(e,t){var i,n=w(this,new I(e));o||(this.closed=!1);try{(i=f(e,"start"))&&r(i,e,this)}catch(e){v(e)}if(!n.isClosed()){var s=n.subscriptionObserver=new L(n);try{var l=t(s),c=l;h(l)||(n.cleanup=u(l.unsubscribe)?function(){c.unsubscribe()}:a(l))}catch(e){return void s.error(e)}n.isClosed()&&n.clean()}};P.prototype=m({},{unsubscribe:function(){var e=T(this);e.isClosed()||(e.close(),e.clean())}}),o&&g(P.prototype,"closed",{configurable:!0,get:function(){return T(this).isClosed()}});var L=function(e){w(this,{type:S,subscriptionState:e}),o||(this.closed=!1)};L.prototype=m({},{next:function(e){var t=M(this).subscriptionState;if(!t.isClosed()){var i=t.observer;try{var n=f(i,"next");n&&r(n,i,e)}catch(e){v(e)}}},error:function(e){var t=M(this).subscriptionState;if(!t.isClosed()){var i=t.observer;t.close();try{var n=f(i,"error");n?r(n,i,e):v(e)}catch(e){v(e)}t.clean()}},complete:function(){var e=M(this).subscriptionState;if(!e.isClosed()){var t=e.observer;e.close();try{var i=f(t,"complete");i&&r(i,t)}catch(e){v(e)}e.clean()}}}),o&&g(L.prototype,"closed",{configurable:!0,get:function(){return M(this).subscriptionState.isClosed()}});var R=function(e){c(this,D),w(this,{type:_,subscriber:a(e)})},D=R.prototype;m(D,{subscribe:function(e){var t=arguments.length;return new P(u(e)?{next:e,error:t>1?arguments[1]:void 0,complete:t>2?arguments[2]:void 0}:d(e)?e:{},C(this).subscriber)}}),p(D,x,(function(){return this})),n({global:!0,constructor:!0,forced:!0},{Observable:R}),s(_)},9035:(e,t,i)=>{"use strict";var n=i(46518),r=i(97751),o=i(69565),s=i(28551),a=i(33517),l=i(70081),c=i(55966),u=i(72652),h=i(78227)("observable");n({target:"Observable",stat:!0,forced:!0},{from:function(e){var t=a(this)?this:r("Observable"),i=c(s(e),h);if(i){var n=s(o(i,e));return n.constructor===t?n:new t((function(e){return n.subscribe(e)}))}var d=l(e);return new t((function(e){u(d,(function(t,i){if(e.next(t),e.closed)return i()}),{IS_ITERATOR:!0,INTERRUPTED:!0}),e.complete()}))}})},2917:(e,t,i)=>{"use strict";i(15239),i(9035),i(78662)},78662:(e,t,i)=>{"use strict";var n=i(46518),r=i(97751),o=i(33517),s=r("Array");n({target:"Observable",stat:!0,forced:!0},{of:function(){for(var e=o(this)?this:r("Observable"),t=arguments.length,i=s(t),n=0;n<t;)i[n]=arguments[n++];return new e((function(e){for(var n=0;n<t;n++)if(e.next(i[n]),e.closed)return;e.complete()}))}})},47628:(e,t,i)=>{"use strict";var n=i(46518),r=i(36043),o=i(1103);n({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=r.f(this),i=o(e);return(i.error?t.reject:t.resolve)(i.value),t.promise}})},65186:(e,t,i)=>{"use strict";var n=i(46518),r=i(18449),o=i(28551),s=r.toKey,a=r.set;n({target:"Reflect",stat:!0},{defineMetadata:function(e,t,i){var n=arguments.length<4?void 0:s(arguments[3]);a(e,t,o(i),n)}})},42978:(e,t,i)=>{"use strict";var n=i(46518),r=i(18449),o=i(28551),s=r.toKey,a=r.getMap,l=r.store;n({target:"Reflect",stat:!0},{deleteMetadata:function(e,t){var i=arguments.length<3?void 0:s(arguments[2]),n=a(o(t),i,!1);if(void 0===n||!n.delete(e))return!1;if(n.size)return!0;var r=l.get(t);return r.delete(i),!!r.size||l.delete(t)}})},79852:(e,t,i)=>{"use strict";var n=i(46518),r=i(79504),o=i(18449),s=i(28551),a=i(42787),l=r(i(79565)),c=r([].concat),u=o.keys,h=o.toKey,d=function(e,t){var i=u(e,t),n=a(e);if(null===n)return i;var r=d(n,t);return r.length?i.length?l(c(i,r)):r:i};n({target:"Reflect",stat:!0},{getMetadataKeys:function(e){var t=arguments.length<2?void 0:h(arguments[1]);return d(s(e),t)}})},72527:(e,t,i)=>{"use strict";var n=i(46518),r=i(18449),o=i(28551),s=i(42787),a=r.has,l=r.get,c=r.toKey,u=function(e,t,i){if(a(e,t,i))return l(e,t,i);var n=s(t);return null!==n?u(e,n,i):void 0};n({target:"Reflect",stat:!0},{getMetadata:function(e,t){var i=arguments.length<3?void 0:c(arguments[2]);return u(e,o(t),i)}})},40617:(e,t,i)=>{"use strict";var n=i(46518),r=i(18449),o=i(28551),s=r.keys,a=r.toKey;n({target:"Reflect",stat:!0},{getOwnMetadataKeys:function(e){var t=arguments.length<2?void 0:a(arguments[1]);return s(o(e),t)}})},42376:(e,t,i)=>{"use strict";var n=i(46518),r=i(18449),o=i(28551),s=r.get,a=r.toKey;n({target:"Reflect",stat:!0},{getOwnMetadata:function(e,t){var i=arguments.length<3?void 0:a(arguments[2]);return s(e,o(t),i)}})},73067:(e,t,i)=>{"use strict";var n=i(46518),r=i(18449),o=i(28551),s=i(42787),a=r.has,l=r.toKey,c=function(e,t,i){if(a(e,t,i))return!0;var n=s(t);return null!==n&&c(e,n,i)};n({target:"Reflect",stat:!0},{hasMetadata:function(e,t){var i=arguments.length<3?void 0:l(arguments[2]);return c(e,o(t),i)}})},66820:(e,t,i)=>{"use strict";var n=i(46518),r=i(18449),o=i(28551),s=r.has,a=r.toKey;n({target:"Reflect",stat:!0},{hasOwnMetadata:function(e,t){var i=arguments.length<3?void 0:a(arguments[2]);return s(e,o(t),i)}})},8288:(e,t,i)=>{"use strict";var n=i(46518),r=i(18449),o=i(28551),s=r.toKey,a=r.set;n({target:"Reflect",stat:!0},{metadata:function(e,t){return function(i,n){a(e,t,o(i),s(n))}}})},25509:(e,t,i)=>{"use strict";var n=i(46518),r=i(97080),o=i(94402).add;n({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=r(this),t=0,i=arguments.length;t<i;t++)o(e,arguments[t]);return e}})},65223:(e,t,i)=>{"use strict";var n=i(46518),r=i(97080),o=i(94402).remove;n({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=r(this),i=!0,n=0,s=arguments.length;n<s;n++)e=o(t,arguments[n]),i=i&&e;return!!i}})},60321:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(47650),s=i(83440);n({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(e){return r(s,this,o(e))}})},41927:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(97080),s=i(38469);n({target:"Set",proto:!0,real:!0,forced:!0},{every:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0);return!1!==s(t,(function(e){if(!i(e,e,t))return!1}),!0)}})},11632:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(97080),s=i(94402),a=i(38469),l=s.Set,c=s.add;n({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e){i(e,e,t)&&c(n,e)})),n}})},64377:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(97080),s=i(38469);n({target:"Set",proto:!0,real:!0,forced:!0},{find:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0),n=s(t,(function(e){if(i(e,e,t))return{value:e}}),!0);return n&&n.value}})},49522:(e,t,i)=>{"use strict";var n=i(46518),r=i(94402);n({target:"Set",stat:!0,forced:!0},{from:i(70933)(r.Set,r.add,!1)})},66771:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(47650),s=i(68750);n({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(e){return r(s,this,o(e))}})},12516:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(47650),s=i(64449);n({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){return r(s,this,o(e))}})},68931:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(47650),s=i(53838);n({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){return r(s,this,o(e))}})},52514:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(47650),s=i(28527);n({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(e){return r(s,this,o(e))}})},35694:(e,t,i)=>{"use strict";var n=i(46518),r=i(79504),o=i(97080),s=i(38469),a=i(655),l=r([].join),c=r([].push);n({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=o(this),i=void 0===e?",":a(e),n=[];return s(t,(function(e){c(n,e)})),l(n,i)}})},52774:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(97080),s=i(94402),a=i(38469),l=s.Set,c=s.add;n({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e){c(n,i(e,e,t))})),n}})},23283:(e,t,i)=>{"use strict";var n=i(46518),r=i(94402);n({target:"Set",stat:!0,forced:!0},{of:i(87500)(r.Set,r.add,!1)})},49536:(e,t,i)=>{"use strict";var n=i(46518),r=i(79306),o=i(97080),s=i(38469),a=TypeError;n({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=o(this),i=arguments.length<2,n=i?void 0:arguments[1];if(r(e),s(t,(function(r){i?(i=!1,n=r):n=e(n,r,r,t)})),i)throw new a("Reduce of empty set with no initial value");return n}})},21926:(e,t,i)=>{"use strict";var n=i(46518),r=i(76080),o=i(97080),s=i(38469);n({target:"Set",proto:!0,real:!0,forced:!0},{some:function(e){var t=o(this),i=r(e,arguments.length>1?arguments[1]:void 0);return!0===s(t,(function(e){if(i(e,e,t))return!0}),!0)}})},94483:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(47650),s=i(83650);n({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(e){return r(s,this,o(e))}})},16215:(e,t,i)=>{"use strict";var n=i(46518),r=i(69565),o=i(47650),s=i(44204);n({target:"Set",proto:!0,real:!0,forced:!0},{union:function(e){return r(s,this,o(e))}})},78898:(e,t,i)=>{"use strict";var n=i(46518),r=i(68183).charAt,o=i(67750),s=i(91291),a=i(655);n({target:"String",proto:!0,forced:!0},{at:function(e){var t=a(o(this)),i=t.length,n=s(e),l=n>=0?n:i+n;return l<0||l>=i?void 0:r(t,l)}})},74176:(e,t,i)=>{"use strict";var n=i(46518),r=i(33994),o=i(62529),s=i(67750),a=i(655),l=i(91181),c=i(68183),u=c.codeAt,h=c.charAt,d="String Iterator",f=l.set,p=l.getterFor(d),m=r((function(e){f(this,{type:d,string:e,index:0})}),"String",(function(){var e,t=p(this),i=t.string,n=t.index;return n>=i.length?o(void 0,!0):(e=h(i,n),t.index+=e.length,o({codePoint:u(e,0),position:n},!1))}));n({target:"String",proto:!0,forced:!0},{codePoints:function(){return new m(a(s(this)))}})},43275:(e,t,i)=>{"use strict";var n=i(24475),r=i(70511),o=i(24913).f,s=i(77347).f,a=n.Symbol;if(r("dispose"),a){var l=s(a,"dispose");l.enumerable&&l.configurable&&l.writable&&o(a,"dispose",{value:l.value,enumerable:!1,configurable:!1,writable:!1})}},42793:(e,t,i)=>{"use strict";i(70511)("observable")},77208:(e,t,i)=>{"use strict";i(70511)("patternMatch")},67348:(e,t,i)=>{"use strict";var n=i(46518),r=i(76557),o=i(44995).remove;n({target:"WeakMap",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=r(this),i=!0,n=0,s=arguments.length;n<s;n++)e=o(t,arguments[n]),i=i&&e;return!!i}})},26957:(e,t,i)=>{"use strict";var n=i(46518),r=i(44995);n({target:"WeakMap",stat:!0,forced:!0},{from:i(70933)(r.WeakMap,r.set,!0)})},79732:(e,t,i)=>{"use strict";var n=i(46518),r=i(44995);n({target:"WeakMap",stat:!0,forced:!0},{of:i(87500)(r.WeakMap,r.set,!0)})},83742:(e,t,i)=>{"use strict";var n=i(46518),r=i(23755),o=i(88205).add;n({target:"WeakSet",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=r(this),t=0,i=arguments.length;t<i;t++)o(e,arguments[t]);return e}})},56422:(e,t,i)=>{"use strict";var n=i(46518),r=i(23755),o=i(88205).remove;n({target:"WeakSet",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=r(this),i=!0,n=0,s=arguments.length;n<s;n++)e=o(t,arguments[n]),i=i&&e;return!!i}})},82451:(e,t,i)=>{"use strict";var n=i(46518),r=i(88205);n({target:"WeakSet",stat:!0,forced:!0},{from:i(70933)(r.WeakSet,r.add,!1)})},46270:(e,t,i)=>{"use strict";var n=i(46518),r=i(88205);n({target:"WeakSet",stat:!0,forced:!0},{of:i(87500)(r.WeakSet,r.add,!1)})},86368:(e,t,i)=>{"use strict";var n=i(46518),r=i(24475),o=i(59225).clear;n({global:!0,bind:!0,enumerable:!0,forced:r.clearImmediate!==o},{clearImmediate:o})},59848:(e,t,i)=>{"use strict";i(86368),i(29309)},29309:(e,t,i)=>{"use strict";var n=i(46518),r=i(24475),o=i(59225).set,s=i(79472),a=r.setImmediate?s(o,!1):o;n({global:!0,bind:!0,enumerable:!0,forced:r.setImmediate!==a},{setImmediate:a})},85178:(e,t,i)=>{var n;if("function"==typeof fetch&&(n=void 0!==i.g&&i.g.fetch?i.g.fetch:"undefined"!=typeof window&&window.fetch?window.fetch:fetch),"undefined"==typeof window||void 0===window.document){var r=n||i(95204);r.default&&(r=r.default),t.default=r,e.exports=t.default}}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return i[e].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.amdO={},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"==typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"==typeof i.then)return i}var o=Object.create(null);r.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>i[e]));return s.default=()=>i,r.d(o,s),o},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var o={};(()=>{"use strict";r.r(o),r.d(o,{Autodesk:()=>nD,THREE:()=>lD,av:()=>rD,ave:()=>aD,avp:()=>oD,avu:()=>sD,default:()=>uD});var e={};r.r(e),r.d(e,{EPSILON:()=>MC,angleVectorToVector:()=>XC,calculateDistance:()=>DC,computeResult:()=>FC,correctPerpendicularPicks:()=>PC,createCommonOverlay:()=>JC,getCircularArcRadius:()=>GC,getDpiPrecision:()=>OC,getEndPointsInEdge:()=>KC,getFaceArea:()=>VC,getSnapResultPosition:()=>IC,inverseProject:()=>HC,isEqualVectors:()=>qC,isParallel:()=>QC,isPerpendicular:()=>ZC,nearestPointInPointToLine:()=>WC,nearestPointInPointToSegment:()=>jC,nearestVertexInVertexToEdge:()=>$C,project:()=>zC,safeToggle:()=>eT});var t={};r.r(t),r.d(t,{ALLOW_WEBGPU_OOC:()=>an,AlertBox:()=>yT,AnalyticsProviderInterface:()=>Ve,AnimatedParam:()=>yR,Animation:()=>WL,BVH:()=>Nf,BVHBuilder:()=>Bf,BVHModule:()=>Lf,BVHSortFuncType:()=>Of,BVH_CACHING:()=>on,BackgroundPresets:()=>yo,BasicShader:()=>$I,BoundsCallback:()=>iw,Browser:()=>LR,BrowserDelegate:()=>PR,BufferGeometryUtils:()=>Oc,BufferManager:()=>gw,BufferSubset:()=>pw,CONSOLIDATION_MEMORY_LIMIT:()=>Wi,CONSOLIDATION_STOP_MARKER:()=>Iv,CONTAINMENT_UNKNOWN:()=>hc,CONTAINS:()=>uc,CPUTexture:()=>wP,CelShader:()=>tP,ConsolidatedRenderBatch:()=>Ac,Consolidation:()=>bv,ConsolidationBuilder:()=>xv,ConsolidationIterator:()=>Gv,ConsolidationMap:()=>_v,ContextMenu:()=>TR,CopyFragmentShader:()=>nP,CopyShader:()=>mb,CreateCubeMapFromColors:()=>_u,CutPlanesShaderChunk:()=>Dd,CutPlanesUniforms:()=>gd,DDSLoader:()=>Iu,DEBUG_TEXTURE_LOAD:()=>bw,DEFAULT_CONSOLIDATION_POLYCOUNT_LIMIT:()=>hn,DEPTH_EPSILON:()=>Tn,DISABLE_FORGE_CANVAS_LOGO:()=>se,DISABLE_FORGE_LOGO:()=>ne,DecodeEnvMap:()=>Mu,DefaultLightPreset:()=>mo,DefaultLightPreset2d:()=>go,DefaultToneMapMethod:()=>vo,DepthTextureTestUniforms:()=>Ad,DepthTextureUniforms:()=>Sd,DummyFragmentShader:()=>iP,ENABLE_DEBUG:()=>kR,ENABLE_INLINE_WORKER:()=>FR,ENABLE_PIXEL_CULLING:()=>Zi,Empty2DModelLoader:()=>pR,EnvSamplingShaderChunk:()=>Nd,EnvironmentConfigurations:()=>ya,ErrorHandler:()=>wT,F2D:()=>BL,F2DLoader:()=>hR,F2dDataType:()=>LL,F2dSemanticType:()=>RL,F2dShadowRatio:()=>DL,FinalOutputShaderChunk:()=>Gd,FlatStringStorage:()=>zf,FloatToHalf:()=>mu,FragInfoFlags:()=>Df,FragmentIterator:()=>UP,FragmentList:()=>Sl,FragmentPointer:()=>Al,FrustumIntersector:()=>ac,GEOMETRY_OVERHEAD:()=>Yi,GPU_MEMORY_LIMIT:()=>zi,GPU_OBJECT_LIMIT:()=>Hi,GeomMergeTask:()=>kc,GeometryList:()=>Cl,Get2DSimpleMapTransform:()=>iu,GetPrismMapUniforms:()=>gA,GroundFlags:()=>cS,GroundReflection:()=>KA,GroundShadow:()=>dA,GroundShadowShader:()=>OA,HALF_INT_MAX:()=>vu,HalfTest:()=>xu,HalfToFloat:()=>gu,HalfToInt:()=>bu,HatchPatternShaderChunk:()=>Bd,HudMessage:()=>CT,INDEX_BUFFER_REGION_SIZE:()=>yn,INTERSECTS:()=>cc,IdFragmentDeclaration:()=>Fd,IdOutputShaderChunk:()=>Vd,IdUniforms:()=>vd,IdVertexDeclaration:()=>Ud,IdVertexShaderChunk:()=>kd,InitParametersSetting:()=>Lw,Initializer:()=>Ia,InstanceBufferBuilder:()=>Ev,InstanceTree:()=>Vf,InstanceTreeAccess:()=>qf,InstanceTreeStorage:()=>Wf,InstancingVertexDeclaration:()=>Wd,IntToHalf:()=>yu,InternalFeatureFlags:()=>OR,IsUsingWebGPU:()=>Cn,KeyFrameAnimator:()=>rR,LMV_WORKER_URL:()=>UR,Lang:()=>DR,LeafletLoader:()=>fR,LightPresets:()=>xo,LineStyleDefs:()=>mf,LmvBox3:()=>yc,LmvMatrix4:()=>al,LmvVector3:()=>rl,LocalStorage:()=>Rs,LogLevels:()=>Je,Logger:()=>et,MATERIAL_FAILED_EVENT:()=>zm,MATERIAL_RECEIVE_EVENT:()=>Gm,MATERIAL_VARIANT:()=>Sf,MAX_FRAGMENTS_PER_CONSOLIDATED_MESH:()=>pn,MAX_MATERIALS_PER_CONSOLIDATED_MESH:()=>mn,MESH_FAILED_EVENT:()=>Vm,MESH_RECEIVE_EVENT:()=>Fm,MESH_STILL_PENDING:()=>Fg,MIN_VALUE_FOR_PENDING_RANGE:()=>Vg,MODEL_MEMORY_LIMIT:()=>qi,MaterialConverter:()=>ou,MaterialConverterCommon:()=>nu,MaterialManager:()=>wf,MemoryTracker:()=>wl,MeshAccessor:()=>OP,MeshAnimation:()=>KL,MeshFlags:()=>ll,ModelIteratorBVH:()=>Sm,ModelIteratorLinear:()=>iy,ModelIteratorTexQuad:()=>tL,ModelLayers:()=>YA,ModelUnits:()=>oy,MultiModelSelector:()=>GS,MultiModelVisibilityManager:()=>HS,NODE_TYPE:()=>Uf,NO_MESH_FOR_FRAGMENT:()=>kg,NoOpTraversalController:()=>Hv,NodeArray:()=>Mf,OUTPUT_TYPE:()=>uR,OUTSIDE:()=>lc,ObjectAssign:()=>q,OptionButton:()=>LT,OptionCheckbox:()=>IT,OptionDropDown:()=>RT,OptionLabel:()=>PT,OptionRow:()=>OT,OptionSlider:()=>MT,OrderedDitheringShaderChunk:()=>Rd,OtgLoader:()=>_g,OtgResourceCache:()=>eg,OutOfCoreTileManager:()=>km,PER_FRAME_CONSOLIDATION_TIME_BUDGET:()=>$i,PER_FRAME_TASK_TIME_BUDGET_FACTOR:()=>un,PER_FRAME_TASK_TIME_BUDGET_MAX:()=>cn,PER_TILE_INSTANCING:()=>dn,PIXEL_CULLING_THRESHOLD:()=>Qi,PackDepthShaderChunk:()=>Pd,PackNormalsShaderChunk:()=>Od,PhongShader:()=>KI,PointSizeDeclaration:()=>Yd,PointSizeShaderChunk:()=>Qd,PointSizeUniforms:()=>_d,Preferences:()=>Ds,Prefs:()=>Pn,Prefs2D:()=>In,Prefs3D:()=>Mn,PrismUtil:()=>vA,ProgressBar:()=>TT,PropDbLoader:()=>rp,PropertyDatabase:()=>kL,RenderBatch:()=>Sc,RenderContext:()=>lx,RenderContextPostProcessExtension:()=>zb,RenderContextPostProcessManager:()=>Hb,RenderFlags:()=>vc,RenderModel:()=>ty,RenderOptionsPanel:()=>UT,RenderScene:()=>kS,Renderer:()=>xS,ResetFlags:()=>PS,ResizeFooter:()=>DT,SAOShader:()=>nx,SHADOWMAP_INCOMPLETE:()=>kA,SHADOWMAP_NEEDS_UPDATE:()=>UA,SHADOWMAP_VALID:()=>FA,SRGBToLinear:()=>tu,SRGBToLinearFloat:()=>eu,SYNTHETIC_ROOT_ID:()=>re,SceneMath:()=>Kp,SceneTraversal:()=>Wv,Selector:()=>VS,ShaderChunks:()=>Zd,ShaderPass:()=>rx,ShaderPassWebGPU:()=>sP,ShaderUtils:()=>Ob,ShadowConfig:()=>NA,ShadowFader:()=>AR,ShadowMapCommonUniforms:()=>bd,ShadowMapDeclareCommonUniforms:()=>jd,ShadowMapFragmentDeclaration:()=>Xd,ShadowMapOverrideMaterials:()=>BA,ShadowMapShader:()=>DA,ShadowMapUniforms:()=>xd,ShadowMapVertexDeclaration:()=>qd,ShadowMapVertexShaderChunk:()=>Kd,ShadowMaps:()=>zA,ShadowRender:()=>HA,SimpleList:()=>BT,SortedList:()=>NP,SvfLoader:()=>lR,TexQuadConfig:()=>eL,TextureLoader:()=>Hu,ThemingFragmentDeclaration:()=>zd,ThemingFragmentShaderChunk:()=>Hd,ThemingUniform:()=>yd,TileCoords:()=>kP,TonemapShaderChunk:()=>Ld,USE_BUFFER_MANAGER:()=>nn,USE_DEFERRED_CONSOLIDATION:()=>tn,USE_DYNAMIC_UNIFORM_ALLOCATION:()=>en,USE_HLOD:()=>rn,USE_MULTI_MATERIAL_RENDER_CALLS:()=>fn,USE_OUT_OF_CORE_TILE_MANAGER:()=>Ji,USE_TRANSFORM_FEEDBACK_FOR_CONSOLIDATION:()=>ln,USE_VAO:()=>Xi,USE_WEBGPU:()=>sn,UniformGroup:()=>oE,UnitParser:()=>GL,UnpackRGB10DepthShader:()=>rP,UnpackRGB10NormalsShader:()=>oP,VBB_MITER_SEGMENT_CP:()=>lf,VBB_MITER_SEGMENT_LIMIT:()=>sf,VBB_MITER_SEGMENT_SCALE_FACTOR:()=>af,VBIntersector:()=>oc,VERTEX_BUFFER_REGION_SIZE:()=>vn,VIEW_TYPES:()=>Ln,VertexBufferBuilder:()=>cf,VertexBufferReader:()=>hl,VertexEnumerator:()=>Xl,Viewer3DImpl:()=>Dw,ViewerState:()=>Yy,ViewingService:()=>ei,VisibilityManager:()=>zS,Wasm:()=>CR,WebGLProgram:()=>aw,WebGLRenderer:()=>Ew,WebGLShader:()=>rw,WideLinesUniforms:()=>Ed,analytics:()=>Qe,applyInstancingToRange:()=>Ov,bin16ToPackedString:()=>je,binToPackedString:()=>We,calculatePrecision:()=>by,canBeMerged:()=>vv,clearPropertyWorkerCache:()=>ip,computeFragIdToNodeIdx:()=>Fv,consolidateFragmentList:()=>Vv,convertTexture:()=>aP,convertToDisplayUnits:()=>xy,convertUnits:()=>yy,copyGPUTexture:()=>lP,copyLightPreset:()=>Eo,copyPrimitiveProps:()=>fv,copyVertexFormat:()=>dv,createBufferGeometry:()=>Rc,createConsolidatedGeometry:()=>yv,createGroundShape:()=>uA,createLinePatternForDef:()=>bf,createLinePatternTexture:()=>yf,createLinePatternTextureData:()=>gf,createLinePatternTextureFromDefs:()=>vf,createRenderer:()=>Rw,createShaderMaterial:()=>Lb,createWireframe:()=>BP,createWorker:()=>fi,derivativeStreamingAUSUrls:()=>pa,digest:()=>Xe,disableDocumentTouchSafari:()=>X,disableGpuObjectLimit:()=>Ki,displayUnits:()=>ps,displayUnitsEnum:()=>ms,displayUnitsPrecision:()=>gs,displayUnitsPrecisionEnum:()=>vs,enableDocumentTouchSafari:()=>Y,enableOutOfCoreTileManager:()=>En,enableUBOs:()=>Sn,enumMeshEdges:()=>Kl,enumMeshIndices:()=>Wl,enumMeshLines:()=>ql,enumMeshTriangles:()=>jl,enumMeshVertices:()=>Hl,exitFullscreen:()=>T,extendLocalization:()=>Ni,fadeValue:()=>vR,findBufferAttribute:()=>Cc,fixUnitString:()=>gy,flyToView:()=>SR,formatValueWithUnits:()=>my,fromUrlSafeBase64:()=>ve,fullscreenElement:()=>I,getAndroidVersion:()=>D,getByteSize:()=>Nc,getDefaultSampler:()=>rE,getGlobal:()=>c,getHtmlTemplate:()=>ue,getIOSVersion:()=>R,getIndicesCount:()=>Ml,getMainUnit:()=>_y,getParameterByName:()=>fe,getParameterByNameFromPath:()=>pe,getPolygonCount:()=>Bc,getPropWorker:()=>ep,getResourceUrl:()=>de,getScript:()=>le,getUInt8Buffer:()=>Qv,getUnitData:()=>vy,getUnitEnum:()=>bs,getUpstreamApiData:()=>ba,getVertexCount:()=>Tl,getWebGLHelpLink:()=>Ws,inFullscreen:()=>M,index2Tile:()=>VP,initWorkerScript:()=>pi,initializeAuth:()=>Ca,initializeEnvironmentVariable:()=>xa,initializeLocalization:()=>ki,initializeLogger:()=>Ta,initializeResourceRoot:()=>_a,initializeServiceEndPoints:()=>Ea,injectCSS:()=>ce,interpolateCatmullRom:()=>jL,isAndroidDevice:()=>k,isBrowser:()=>E,isChrome:()=>H,isConsolidatedMesh:()=>jg,isExperimentalFlagEnabled:()=>he,isFirefox:()=>z,isFullscreenAvailable:()=>P,isFullscreenEnabled:()=>L,isIE11:()=>A,isIE11Only:()=>w,isIOSDevice:()=>N,isInstanceMesh:()=>Wg,isMac:()=>W,isMiddleClick:()=>BR,isMobileDevice:()=>F,isNodeJS:()=>S,isPhoneFormFactor:()=>V,isPlaceholderMesh:()=>Hg,isRightClick:()=>NR,isSafari:()=>G,isTouchDevice:()=>O,isVisible:()=>cv,isWindows:()=>j,launchFullscreen:()=>C,lerp:()=>bR,linearToSRGB:()=>Jc,linearToSRGBFloat:()=>$c,loadDependency:()=>Va,loadWasmWorker:()=>wR,logger:()=>rt,mergeGeometries:()=>gv,meshToGeometry:()=>Dc,packedToBin:()=>Ke,parseMaterialBoolean:()=>Qc,parseMaterialColor:()=>Xc,parseMaterialGeneric:()=>Zc,parseMaterialScalar:()=>Yc,patchShader:()=>VL,pathToURL:()=>ni,readLmvBufferGeom:()=>ML,refreshCookie:()=>Sa,refreshRequestHeader:()=>Aa,refreshToken:()=>wa,removeMacro:()=>Db,resetGlobalArrayBuffer:()=>Zg,resolve:()=>Id,restoreSignBitFromLSB:()=>OL,serializeLmvBufferGeom:()=>wL,setCONSOLIDATION_MEMORY_LIMIT:()=>ji,setDISABLE_FORGE_CANVAS_LOGO:()=>ae,setDISABLE_FORGE_LOGO:()=>oe,setENABLE_INLINE_WORKER:()=>VR,setENABLE_PIXEL_CULLING:()=>An,setGroundShapeTransform:()=>hA,setLanguage:()=>Ui,setLogger:()=>ot,setMacro:()=>Rb,shutdown:()=>Pa,shutdownPropWorker:()=>tp,smootherStep:()=>xR,stringToDOM:()=>me,textToArrayBuffer:()=>ri,theResourceLoader:()=>Fa,tile2Index:()=>FP,toUrlSafeBase64:()=>ge,token:()=>zs,touchStartToClick:()=>Q,unpackHexString:()=>qe,updateConsolidationLimits:()=>gn,useBufferManager:()=>bn,useEarlyConsolidation:()=>Gg,useHLOD:()=>_n,useNodeInitializationOnGeometryLoaded:()=>zg,useWebGPU:()=>wn,workerCreator:()=>di,writeIdToBuffer:()=>Gc});var i={};r.r(i),r.d(i,{ViewerModelStructurePanel:()=>oI,ViewerObjectContextMenu:()=>zR,ViewerPanelMixin:()=>HT,ViewerPropertyPanel:()=>dM,ViewerSettingTab:()=>JT,ViewerSettingsPanel:()=>tM,generateDefaultViewerHandlerOptions:()=>iI});var n={};r.r(n),r.d(n,{Button:()=>xT,ComboButton:()=>uI,Control:()=>bT,ControlGroup:()=>ST,DataTable:()=>qR,DockingPanel:()=>NT,Filterbox:()=>KR,LoadingSpinner:()=>bM,ModelStructurePanel:()=>GM,ObjectContextMenu:()=>GR,PropertyPanel:()=>uM,RadioButtonGroup:()=>VT,Searchbox:()=>tI,SettingsPanel:()=>FT,SplitViewLayout:()=>JR,ToolBar:()=>GT,Tree:()=>cM,TreeDelegate:()=>lM,TreeOnDemand:()=>EM});var s={};r.r(s),r.d(s,{AGGREGATE_FIT_TO_VIEW_EVENT:()=>Cr,AGGREGATE_HIDDEN_CHANGED_EVENT:()=>yr,AGGREGATE_ISOLATION_CHANGED_EVENT:()=>gr,AGGREGATE_SELECTION_CHANGED_EVENT:()=>pr,ANIMATION_READY_EVENT:()=>Nr,ANIM_ENDED:()=>$r,AggregatedView:()=>gC,AppScreenModeDelegate:()=>el,ApplicationScreenModeDelegate:()=>tl,Autocam:()=>tb,AutodeskNamespace:()=>u,BEFORE_MODEL_UNLOAD_EVENT:()=>Qn,BubbleNode:()=>Oa,CAMERA_CHANGE_EVENT:()=>Sr,CAMERA_TRANSITION_COMPLETED:()=>Ur,CANCEL_LEAFLET_SCREENSHOT:()=>Wr,CUTPLANES_CHANGE_EVENT:()=>Tr,CameraLS:()=>xC,CrossViewerInteractionCommon:()=>FI,DISABLE_FORGE_CANVAS_LOGO:()=>se,DISABLE_FORGE_LOGO:()=>ne,DefaultHandler:()=>qy,DefaultSettings:()=>Es,Document:()=>Uy,DynamicGlobalOffset:()=>Yv,ESCAPE_EVENT:()=>Rn,EXPLODE_CHANGE_EVENT:()=>Ar,EXTENSION_ACTIVATED_EVENT:()=>ur,EXTENSION_DEACTIVATED_EVENT:()=>dr,EXTENSION_LOADED_EVENT:()=>sr,EXTENSION_PRE_ACTIVATED_EVENT:()=>cr,EXTENSION_PRE_DEACTIVATED_EVENT:()=>hr,EXTENSION_PRE_LOADED_EVENT:()=>or,EXTENSION_PRE_UNLOADED_EVENT:()=>ar,EXTENSION_UNLOADED_EVENT:()=>lr,EnumType:()=>xs,EnvironmentConfigurations:()=>ya,ErrorCodes:()=>st,EventDispatcher:()=>Ba,EventUtils:()=>Ka,Extension:()=>Na,ExtensionMixin:()=>Ha,Extensions:()=>i,FINAL_FRAME_RENDERED_CHANGED_EVENT:()=>Pr,FIT_TO_VIEW_EVENT:()=>wr,FRAGMENTS_LOADED_EVENT:()=>to,FRAGMENTS_UNLOADED_EVENT:()=>io,FULLSCREEN_MODE_EVENT:()=>On,FeatureFlags:()=>Bs,FileLoader:()=>Wa,FileLoaderManager:()=>Ra,FovTool:()=>cT,GEOMETRY_LOADED_EVENT:()=>Wn,GestureHandler:()=>Xy,GestureRecognizers:()=>Ky,GlobalManager:()=>ao,GlobalManagerMixin:()=>fo,GuiViewer3D:()=>aM,HIDE_ALL_EVENT:()=>Er,HIDE_EVENT:()=>vr,HYPERLINK_EVENT:()=>kr,HYPERLINK_NAVIGATE:()=>Fr,Hammer:()=>ye.A,HotGestureTool:()=>lT,HotkeyManager:()=>Vy,ISOLATE_EVENT:()=>mr,Initializer:()=>Ia,KeyCode:()=>Hy,LAYER_VISIBILITY_CHANGED_EVENT:()=>Rr,LOADER_LOAD_ERROR_EVENT:()=>Gn,LOADER_LOAD_FILE_EVENT:()=>Vn,LOADER_REPAINT_REQUEST_EVENT:()=>zn,LOAD_GEOMETRY_EVENT:()=>Vr,LOAD_MISSING_GEOMETRY:()=>Gr,MODEL_ADDED_EVENT:()=>Zn,MODEL_FRAGMENT_BOUNDING_BOXES_SET_EVENT:()=>nr,MODEL_LAYERS_LOADED_EVENT:()=>Jn,MODEL_PLACEMENT_CHANGED_EVENT:()=>tr,MODEL_REMOVED_EVENT:()=>$n,MODEL_ROOT_LOADED_EVENT:()=>Hn,MODEL_TRANSFORM_CHANGED_EVENT:()=>er,MODEL_TRAVERSAL_CONTROLLER_ADDED:()=>rr,MODEL_UNLOADED_EVENT:()=>Yn,MODEL_VIEWPORT_BOUNDS_CHANGED_EVENT:()=>ir,MeasureCommon:()=>tD,MobileCallbacks:()=>dT,Model:()=>Dy,ModelMemoryTracker:()=>Jw,ModelUnits:()=>eD,MultiViewerFactory:()=>UI,NAVIGATION_MODE_CHANGED_EVENT:()=>Bn,NEW_GEOMETRY_ADDED:()=>Kr,NEW_MATERIAL_ADDED:()=>Xr,Navigation:()=>zy,NullScreenModeDelegate:()=>il,OBJECT_TREE_CREATED_EVENT:()=>qn,OBJECT_TREE_LOAD_PROGRESS_EVENT:()=>Xn,OBJECT_TREE_UNAVAILABLE_EVENT:()=>Kn,OBJECT_UNDER_MOUSE_CHANGED:()=>Zr,ObjectAssign:()=>q,OrbitDollyPanTool:()=>Zy,OverlayManager:()=>Fw,PDFUtils:()=>AC,PREF_CHANGED_EVENT:()=>Dr,PREF_RESET_EVENT:()=>Or,PROFILE_CHANGE_EVENT:()=>Yr,PROGRESS_UPDATE_EVENT:()=>Dn,Private:()=>t,Profile:()=>Os,ProfileManager:()=>ky,ProfileSettings:()=>Ms,ProgressState:()=>Gp,PropertySet:()=>Ty,PublicFeatureFlags:()=>Ns,REFRESH_CUSTOM_PROPERTIES:()=>ro,REFRESH_CUSTOM_PROPERTIES_VALUES:()=>oo,RENDER_FIRST_PIXEL:()=>qr,RENDER_OPTION_CHANGED_EVENT:()=>Ir,RENDER_PRESENTED_EVENT:()=>Lr,RENDER_SCENE_PART:()=>Qr,RESTORE_DEFAULT_SETTINGS_EVENT:()=>Br,SCENE_UPDATED_EVENT:()=>no,SELECTION_CHANGED_EVENT:()=>fr,SETTINGS_PANEL_CREATED_EVENT:()=>mT,SET_VIEW_EVENT:()=>jr,SHOW_ALL_EVENT:()=>_r,SHOW_EVENT:()=>br,SHOW_PROPERTIES_EVENT:()=>xr,SYNTHETIC_ROOT_ID:()=>re,ScreenMode:()=>$a,ScreenModeDelegate:()=>Ja,ScreenModeMixin:()=>nl,ScreenShot:()=>IS,Search:()=>zI,SearchManager:()=>GI,SelectionMode:()=>po,SelectionType:()=>FS,TEXTURES_LOADED_EVENT:()=>jn,TOOLBAR:()=>vT,TOOLBAR_CREATED_EVENT:()=>pT,TOOL_CHANGE_EVENT:()=>Mr,TRANSITION_ENDED:()=>eo,TRANSITION_STARTED:()=>Jr,Thumbnails:()=>eC,ToolController:()=>Wy,ToolInterface:()=>aT,UI:()=>n,UnifiedCamera:()=>ny,VIEWER_INITIALIZED:()=>kn,VIEWER_RESIZE_EVENT:()=>Un,VIEWER_STATE_RESTORED_EVENT:()=>Nn,VIEWER_UNINITIALIZED:()=>Fn,VIEWER_VISIBILITY_CHANGED:()=>so,VIEW_CUBE_CREATED_EVENT:()=>gT,Viewer3D:()=>Ww,ViewingUtilities:()=>jy,WEBGL_CONTEXT_LOST_EVENT:()=>zr,WEBGL_CONTEXT_RESTORED_EVENT:()=>Hr,WorldUpTool:()=>uT,createLeechViewer:()=>NI,derivativeStreamingAUSUrls:()=>pa,disableDocumentTouchSafari:()=>X,enableDocumentTouchSafari:()=>Y,endpoint:()=>ke,errorCodeString:()=>at,estimateMemUsage:()=>$w,exitFullscreen:()=>T,fromUrlSafeBase64:()=>ve,fullscreenElement:()=>I,getAndroidVersion:()=>D,getEnv:()=>Pe,getErrorCode:()=>lt,getGlobal:()=>c,getHtmlTemplate:()=>ue,getIOSVersion:()=>R,getOfflineResourcePrefix:()=>Ue,getParameterByName:()=>fe,getParameterByNameFromPath:()=>pe,getResourceUrl:()=>de,getScript:()=>le,getUpstreamApiData:()=>ba,getWebGLHelpLink:()=>Ws,i18n:()=>hs,inFullscreen:()=>M,initLoadContext:()=>Fe,initializeAuth:()=>Ca,initializeEnvironmentVariable:()=>xa,initializeLogger:()=>Ta,initializeResourceRoot:()=>_a,initializeServiceEndPoints:()=>Ea,injectCSS:()=>ce,isAndroidDevice:()=>k,isBrowser:()=>E,isChrome:()=>H,isExperimentalFlagEnabled:()=>he,isFirefox:()=>z,isFullscreenAvailable:()=>P,isFullscreenEnabled:()=>L,isIE11:()=>A,isIE11Only:()=>w,isIOSDevice:()=>N,isMac:()=>W,isMiddleClick:()=>BR,isMobileDevice:()=>F,isNodeJS:()=>S,isOffline:()=>De,isPhoneFormFactor:()=>V,isRightClick:()=>NR,isSafari:()=>G,isTouchDevice:()=>O,isWindows:()=>j,launchFullscreen:()=>C,refreshCookie:()=>Sa,refreshRequestHeader:()=>Aa,refreshToken:()=>wa,setDISABLE_FORGE_CANVAS_LOGO:()=>ae,setDISABLE_FORGE_LOGO:()=>oe,setEnv:()=>Le,setOffline:()=>Oe,setOfflineResourcePrefix:()=>Ne,shutdown:()=>Pa,stringToDOM:()=>me,theExtensionManager:()=>za,toUrlSafeBase64:()=>ge,token:()=>zs,touchStartToClick:()=>Q,waitForCompleteLoad:()=>jw});var a;r(74423),r(69479),r(28845),r(17656),r(55105),r(7467),r(10586),r(71517),r(93777),r(14190),r(12359),r(86097),r(39172),r(57019),r(17273),r(81723),r(27415),r(19929),r(37583),r(55122),r(16385),r(20230),r(57268),r(79733),r(58179),r(30456),r(74017),r(79310),r(83062),r(96369),r(15637),r(2848),r(24842),r(24746),r(33454),r(6660),r(15941),r(82101),r(2917),r(47628),r(65186),r(42978),r(72527),r(79852),r(42376),r(40617),r(73067),r(66820),r(8288),r(25509),r(65223),r(60321),r(41927),r(11632),r(64377),r(49522),r(66771),r(12516),r(68931),r(52514),r(35694),r(52774),r(23283),r(49536),r(21926),r(94483),r(16215),r(78898),r(74176),r(43275),r(42793),r(77208),r(67348),r(26957),r(79732),r(83742),r(56422),r(82451),r(46270),r(59848);function l(e){return e[e.LMV_APP_NAMESPACE]=e[e.LMV_APP_NAMESPACE]||{}}function c(){const e="undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:r.g;return e.USE_LMV_APP_NAMESPACES?(e.globalProxy||(e.globalProxy=new Proxy({},{get(t,i){let n=e[i];return"function"==typeof n?function(e,t){return new Proxy(t,{get:(e,t)=>e[t],apply:(t,i,n)=>t.call(e||i,...n)})}(e,n):n},set:(t,i,n)=>(Object.prototype.hasOwnProperty.call(e,i)?e[i]!==n&&(e[i]=n):(l(e)[i]=n,Object.defineProperty(e,i,{get:()=>l(e)[i],set:t=>{l(e)[i]=t}})),!0)})),e.globalProxy):e}function u(e){for(var t=c(),i=e.split("."),n=0;n<i.length;++n)t[i[n]]=t[i[n]]||{},t=t[i[n]];return t}const h=u("Autodesk"),d={Autodesk:h};u("Autodesk.Viewing.Private"),u("Autodesk.Viewing.Extensions"),u("Autodesk.Extensions"),u("Autodesk.Viewing.Shaders"),u("Autodesk.Viewing.UI"),u("Autodesk.LMVTK"),c().AutodeskNamespace=u,c().ENABLE_DEBUG=globalThis.ENABLE_DEBUG??(null===(a=globalThis.Autodesk)||void 0===a||null===(a=a.Viewing)||void 0===a||null===(a=a.Private)||void 0===a?void 0:a.ENABLE_DEBUG)??!1;let f=new Set;function p(e,t,i,n){for(let r in t)if((!n||-1===n.indexOf(r))&&Object.prototype.hasOwnProperty.call(t,r)){let n=function(e){t[r]instanceof Object?e[r]=t[r]:Object.defineProperty(e,r,{get:()=>t[r],set(e){t["set"+r]?t["set"+r](e):f.has(r)||(h.Viewing.Private.logger.error("No setter for global variable "+r+" defined. It is read only."),f.add(r))},enumerable:!0,configurable:!0})};n(e),i&&n(e[i])}}var m,g=r(72091),v=r.n(g);const b=c(),_=b&&b.document,E="undefined"!=typeof navigator,S=function(){return!E};let A=E&&!!navigator.userAgent.match(/Edge|Trident\/7\./),w=E&&!!navigator.userAgent.match(/Trident\/7\./);function C(e,t){e.requestFullscreen?e.requestFullscreen(t):e.mozRequestFullScreen?e.mozRequestFullScreen(t):e.webkitRequestFullscreen?e.webkitRequestFullscreen(t):e.msRequestFullscreen&&e.msRequestFullscreen(t)}function T(e){M(e)&&(e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.msExitFullscreen&&e.msExitFullscreen())}function M(e){return"webkitIsFullScreen"in e?!!e.webkitIsFullScreen:"fullscreenElement"in e?!!e.fullscreenElement:"mozFullScreenElement"in e?!!e.mozFullScreenElement:"msFullscreenElement"in e?!!e.msFullscreenElement:!!e.querySelector(".viewer-fill-browser")}function I(e){return e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement}function P(e){return e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen}function L(e){return e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled}function R(e){var t=(e=e||navigator.userAgent).match(/OS ((\d+)_(\d+)(_(\d+))?) like Mac OS X/);return!t&&N()&&(t=e.match(/\/((\d+)\.(\d+)(\.\d)?) Safari\//)),t?t[1].replace("_","."):""}function D(e){var t=(e=e||navigator.userAgent).match(/Android\s([0-9\.]*)/);return!!t&&t[1]}function O(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0)}const B=E&&(/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||/^ip(ad|hone|od)$/.test(null===(m=navigator.platform)||void 0===m?void 0:m.toLowerCase()));function N(){return B}const U=E&&-1!==navigator.userAgent.toLowerCase().indexOf("android");function k(){return U}function F(){return!!E&&(N()||k())}function V(){return F()&&(b.matchMedia("(max-width: 750px)").matches||b.matchMedia("(max-height: 750px)").matches)}function G(){if(!E)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")}function z(){return!!E&&-1!==navigator.userAgent.toLowerCase().indexOf("firefox")}function H(){return!!E&&-1!==navigator.userAgent.toLowerCase().indexOf("chrome")}function W(){return!!E&&(-1!==navigator.userAgent.toLowerCase().indexOf("mac os")&&!N())}function j(){if(!E)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("win32")||-1!==e.indexOf("windows")}function q(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function K(e){var t=b.hasOwnProperty("pageXOffset")?b.pageXOffset:_.documentElement.scrollLeft,i=b.hasOwnProperty("pageYOffset")?b.pageYOffset:_.documentElement.scrollTop,n=void 0===e.pageX?e.changedTouches[0].pageX:e.pageX,r=void 0===e.pageY?e.changedTouches[0].pageY:e.pageY,o=_.elementFromPoint(n-t,r-i);return!o||"CANVAS"!==o.nodeName||("true"!==o.getAttribute("data-viewer-canvas")||(e.preventDefault(),!1))}function X(){F()&&G()&&(_.documentElement.addEventListener("touchstart",K,!0),_.documentElement.addEventListener("touchmove",K,!0),_.documentElement.addEventListener("touchcanceled",K,!0),_.documentElement.addEventListener("touchend",K,!0))}function Y(){F()&&G()&&(_.documentElement.removeEventListener("touchstart",K,!0),_.documentElement.removeEventListener("touchmove",K,!0),_.documentElement.removeEventListener("touchcanceled",K,!0),_.documentElement.removeEventListener("touchend",K,!0))}function Q(e){e.target.className&&(e.target.className.indexOf("fullscreen")>-1||e.target.className.indexOf("webvr")>-1)||(e.preventDefault(),e.stopPropagation(),e.target.click())}const Z=!0,$="lmvworker.min.js",J=!1;var ee=c(),te=ee,ie=te&&te.document;ee.LOCALIZATION_REL_PATH="",ee.LMV_VIEWER_VERSION="7.105.0",ee.LMV_BUILD_TYPE="Production",ee.LMV_RESOURCE_ROOT="",ee.LMV_IS_FLUENT_BUILD=!1,ee.USE_OTG_DS_PROXY=!1,ee.LMV_THIRD_PARTY_COOKIE=!S()&&void 0,"v"===ee.LMV_VIEWER_VERSION.charAt(0)&&(ee.LMV_VIEWER_VERSION=ee.LMV_VIEWER_VERSION.substr(1)),ee.LMV_VECTOR_PDF=!1,ee.LMV_RASTER_PDF=!0;let ne=!1;const re=-1e10;function oe(e){ne=e}let se=!0;function ae(e){se=e}function le(e){e=e.toLowerCase();var t=ie.getElementsByTagName("SCRIPT");if(t&&t.length>0)for(var i=0;i<t.length;++i)if(t[i].src&&-1!==t[i].src.toLowerCase().indexOf(e))return t[i];return null}function ce(e,t,i){for(var n=e.indexOf("://")>0?e:de(e),r=ie.getElementsByTagName("link"),o=0,s=r.length;o<s;o++)if(r[o].href===n)return void(t&&t());var a=ie.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",n),t&&(a.onload=t),i&&(a.onerror=i),ie.head.appendChild(a)}function ue(e,t){var i=e.indexOf("://")>0?e:de(e),n=new XMLHttpRequest;function r(e){t(e,null)}n.onload=function(e){var i=e.currentTarget.responseText;t(null,i)},n.onerror=r,n.ontimeout=r,n.open("GET",i,!0),n.send()}function he(e,t){return!(!t||!Array.isArray(t.experimental))&&-1!==t.experimental.indexOf(e)}function de(e){return ee.LMV_RESOURCE_ROOT+e}function fe(e){return"undefined"==typeof window?"":pe(e,te.location.href)}function pe(e,t){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function me(e){var t=ie.createElement("div");return t.innerHTML=e,t.firstChild}function ge(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function ve(e){for(e=(e=e.replace(/-/g,"+")).replace(/_/g,"/");e.length%4;)e+="=";return S()?Buffer.from(e,"base64").toString():atob(e)}var ye=r(41944);const be=c();var xe={},_e=null;xe.ENDPOINT_API_DERIVATIVE_SERVICE_V2="derivativeV2",xe.ENDPOINT_API_MODEL_DERIVATIVE_V2="modelDerivativeV2",xe.ENDPOINT_API_FLUENT="fluent",xe.ENDPOINT_API_D3S="D3S",xe.ENDPOINT_API_DERIVATIVE_STREAMING="streamingV2";var Ee,Se={derivativeV2:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",propertyQueryURL:"/modelderivative/v2/designdata/:urn/metadata/:guid/properties:query"},derivativeV2_EU:{baseURL:"/derivativeservice/v2/regions/eu",itemURL:"/derivativeservice/v2/regions/eu/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/regions/eu/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn"},derivativeV2_AUS:{baseURL:"/derivativeservice/v2/regions/aus",itemURL:"/derivativeservice/v2/regions/aus/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/regions/aus/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/aus/thumbnails/:urn"},derivativeV2_APAC:{baseURL:"/derivativeservice/v2/regions/aus",itemURL:"/derivativeservice/v2/regions/aus/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/regions/aus/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/aus/thumbnails/:urn"},derivativeV2_Fedramp:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn"},modelDerivativeV2:{baseURL:"/modelderivative/v2/",itemURL:"/modelderivative/v2/designdata/:urn/manifest/:derivativeurn",manifestURL:"/modelderivative/v2/designdata/:urn/manifest",thumbnailsURL:"/modelderivative/v2/designdata/:urn/thumbnail",propertyQueryURL:"/modelderivative/v2/designdata/:urn/metadata/:guid/properties:query"},fluent:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},D3S:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},D3S_EU:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},D3S_AUS:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/aus/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},D3S_APAC:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/aus/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},streamingV2:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},streamingV2_EU:{baseURL:"/regions/eu/modeldata",itemURL:"/regions/eu/modeldata/file/:derivativeurn",manifestURL:"/regions/eu/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn",cdnURL:"/regions/eu/cdn",cdnWS:"/regions/eu/cdnws"},streamingV2_AUS:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},streamingV2_APAC:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},streamingV2_Fedramp:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"}},Ae="",we=xe.ENDPOINT_API_DERIVATIVE_SERVICE_V2,Ce=!1,Te=!1,Me="",Ie=!1;function Pe(){return Ee}function Le(e){Ee=e,e.startsWith("MD20")&&console.warn(`env=${e} is deprecated and will be removed in a future release. Use Autodesk{env}2 instead, where env=Development, Staging, or Production`)}xe.HTTP_REQUEST_HEADERS={},xe.queryParams={},xe.setEndpointAndApi=function(e,t){null!=e&&(Ae=e),t&&(we=t,t.startsWith("D3S")&&console.warn(`api=${t} is deprecated and will be removed in a future release. Use streamingV2 or streamingV2_EU (europe region) instead`))},xe.getEndpointAndApi=function(){return Ae+Se[we].baseURL},xe.getApiEndpoint=function(){return Ae},xe.getApiFlavor=function(){return we},xe.getCdnUrl=function(){return _e||(Ae?Ae+Se[we].cdnURL:void 0)},xe.getCdnWebSocketEndpoint=function(){return Ae+(Se[we].cdnWS||"")},xe.setCdnUrl=function(e){_e=e},xe.getCdnRedirectUrl=function(){var e=Se[we].cdnRedirectURL;return e?Ae+e:null},xe.setAcmSession=function(e){Me=e},xe.getAcmSession=function(){return Me},xe.getManifestApi=function(e,t,i){var n=e||Ae;return t=t||"",n=(n+=Se[i=i||we].manifestURL).replace(":urn",t)},xe.getItemApi=function(e,t,i){var n=i||we,r=(e||Ae)+Se[n].itemURL;t=t||"";var o=decodeURIComponent(t);if(-1!==r.indexOf(":urn")){var s=o.split("/")[0]||"";s=(s=s.split(":"))[s.length-1]||"",r=r.replace(":urn",s)}return n===xe.ENDPOINT_API_MODEL_DERIVATIVE_V2&&(t=encodeURIComponent(o)),r=r.replace(":derivativeurn",t)},xe.getThumbnailApi=function(e,t,i){return((e||Ae)+Se[i||we].thumbnailsURL).replace(":urn",t||"")},xe.getPropertyQueryApi=function(e,t,i,n){let r=(e||Ae)+Se[i||we].propertyQueryURL;return r=r.replace(":urn",t||""),r.replace(":guid",n||"")},xe.getUseCredentials=function(){return Ce},xe.getDomainParam=function(){return console.warn("getDomainParam is deprecated, switch to getQueryParams instead."),this.getUseCredentials()&&!S()?"domain="+encodeURIComponent(be.location.origin):""},xe.addQueryParam=function(e,t){this.queryParams[e]=t},xe.deleteQueryParam=function(e){delete this.queryParams[e]},xe.getQueryParams=function(e){let t=this.getUseCredentials()&&!S()?"domain="+encodeURIComponent(be.location.origin):"";fe("bypassds")&&(t=t?t+"&bypassds=1":"bypassds=1");let i=[];for(let e in this.queryParams)i.push(encodeURIComponent(e)+"="+encodeURIComponent(this.queryParams[e]));return i.length&&(t?t+="&"+i.join("&"):t=i.join("&")),t&&e&&(e.queryParams?e.queryParams+="&"+t:e.queryParams=t),t},xe.setUseCredentials=function(e){Ce=e},xe.setUseCookie=function(e){Te=e},xe.getUseCookie=function(){return Te},xe.isOtgBackend=function(){return this.getApiFlavor()===this.ENDPOINT_API_FLUENT},xe.isSVF2Backend=function(){let e=this.getApiFlavor();return e.startsWith(this.ENDPOINT_API_D3S)||e.startsWith(this.ENDPOINT_API_DERIVATIVE_STREAMING)},xe.setEscapeOssObjects=function(e){Ie=e},xe.getEscapeOssObjects=function(){return Ie},xe.initLoadContext=function(e){for(var t in(e=e||{}).auth=this.getUseCredentials(),e.endpoint||(e.endpoint=this.getApiEndpoint()),e.api||(e.api=this.getApiFlavor()),e.headers||(e.headers={}),this.HTTP_REQUEST_HEADERS)e.headers[t]=this.HTTP_REQUEST_HEADERS[t];return e.api,this.ENDPOINT_API_FLUENT,this.getQueryParams(e),e.otg_cdn=_e||this.getCdnUrl(),e.otg_ws=this.getCdnWebSocketEndpoint(),e.escapeOssObjects=this.getEscapeOssObjects(),e};var Re=!1;function De(){return Re}function Oe(e){Re=e}var Be="";function Ne(e){Be=e}function Ue(){return Be}let ke=xe,Fe=xe.initLoadContext.bind(xe);class Ve{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e}init(){}register(){}static get name(){return null}static get defaultOptions(){return{}}optIn(e){}optOut(e){}hasOptedOut(){}getDistinctId(){}track(e,t){}identify(e){}}const Ge=new Array(256);for(let e=0;e<256;e++){let t=e.toString(16);1===t.length&&(t="0"+t),Ge[e]=t}var ze=new Array(20),He=new Array(10);function We(e,t,i){for(var n=20===i?He:[],r=0;r<i;r+=2){var o=e[t+r],s=e[t+r+1];n[r/2]=s<<8|o}return String.fromCharCode.apply(null,n)}function je(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3],e[t+4],e[t+5],e[t+6],e[t+7],e[t+8],e[t+9])}function qe(e){for(var t=10===e.length?ze:[],i=0;i<e.length;i++){var n=e.charCodeAt(i);t[2*i]=Ge[255&n],t[2*i+1]=Ge[n>>8&255]}return t.join("")}function Ke(e,t,i){for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);t[i+2*n]=255&r,t[i+2*n+1]=r>>8&255}}async function Xe(e,t){var i;let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==(null===(i=crypto)||void 0===i||null===(i=i.subtle)||void 0===i?void 0:i.digest)){const i=await crypto.subtle.digest(e,new TextEncoder("utf-8").encode(t));if(!n)return i;return Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("")}const o=r(39547);let s;switch(e){case"SHA-1":s=o.md.sha1.create();break;case"SHA-256":s=o.md.sha256.create();break;default:return console.error("Hash function is not supported"),n?"":new ArrayBuffer(0)}s.update(t,"utf8");const a=s.digest();return n?a.toHex():Uint8Array.from(a.getBytes(),(e=>e.charCodeAt(0))).buffer}async function Ye(e){const t=function(e){if("string"!=typeof e)return;const t=e.split(".");if(3!==t.length)return;const i=t[1];try{const e=Autodesk.Viewing.fromUrlSafeBase64(i);return JSON.parse(e).client_id||""}catch(e){}}(e);if(!t)return"NOT_SET";return await Xe("SHA-256",t,!0)}const Qe=new class{providerMap={};instances=new Array;superProps={};shouldTrack=!0;trackCache=new Array;oneTimers={};#e;#t;registerProvider(e){if(!e)return void rt.error("Undefined provider");if(!e.name)return void rt.error("missing provider name");const t=e.name.toLowerCase();this.isProviderRegistered(t)?rt.warn(`Provider with name ${e.name} already registered`):this.providerMap[t]=e;const i=this.createInstance(e.name,e.defaultOptions);this.instances.push(i),this.shouldTrack&&this.init(i),this.trackCache.length>0&&(this.trackCache.forEach((e=>{let{event:t,properties:i}=e;this.track(t,i)})),this.trackCache=[])}isProviderRegistered(e){var t;return("string"==typeof e?e:null===(t=e.name)||void 0===t?void 0:t.toLowerCase())in this.providerMap}init(e){e.initialized||(e.init(),e.register(this.superProps))}createInstance(e,t){const i=e&&e.toLowerCase();if(!(i in this.providerMap))return void rt.error(`Unknown ${e}`);const n=this.providerMap[i],r=new n(t);if(!(r instanceof Ve))throw new Error("not an analytics provider");return n.instanceCount=n.instanceCount||0,r.name=`${i}-${n.instanceCount}`,n.instanceCount++,r}optIn(e){this.instances.forEach((e=>this.init(e))),this._callMethod("optIn",e),this.shouldTrack=!0}optOut(e){this._callMethod("optOut",e),this.shouldTrack=!1}hasOptedOut(){return this._callMethod("hasOptedOut")}getDistinctId(){return this._callMethod("getDistinctId")}async trackClientInfo(e){this.superProps.clientId=await Ye(e)}track(e,t,i){if(this.shouldTrack){if(t||(t={}),i){const i={event:e,properties:t};try{const e=JSON.stringify(i);if(this.oneTimers[e])return;this.oneTimers[e]=!0}catch(e){}}0===this.instances.length?this.trackCache.push({event:e,properties:t}):this._callMethod("track",e,t)}}trackHWInfo(e,t){this.#e=e||"NOT_SET",this.#t=t||"NOT_SET"}appendCommonPropsForModelLoad(e){e.renderer=this.#e,e.vendor=this.#t}identify(e){this._callMethod("identify",e)}_callMethod(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const n=t[0],r=t.slice(1,t.length);return this.instances.map((e=>({name:e.name,value:e[n](...r)})))}},Ze=c(),$e=Ze,Je={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0};function et(){this.runtimeStats={},this.level=-1,this.setLevel(Je.ERROR),this._reportError=this._reportError.bind(this)}function tt(e,t){let i;"string"==typeof t?i={message:t}:"object"==typeof t&&(i=t),Qe.track(e,i)}function it(){return"undefined"!=typeof window?encodeURI($e.location.href):""}function nt(){}et.prototype.initialize=function(e){if(e.eventCallback&&(this.callback=e.eventCallback),this.sessionId=e.sessionId,!this.sessionId){var t=Date.now()+"";this.sessionId=parseFloat((1e4*Math.random()|0)+""+t.substring(4))}"number"==typeof e.logLevel&&this.setLevel(e.logLevel),this.environmentInfo={touch:O(),env:Pe(),referer:it(),version:Ze.LMV_VIEWER_VERSION,build_type:Ze.LMV_BUILD_TYPE};var i={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,build_type:this.environmentInfo.build_type};this.track(i);var n=this;this.interval=setInterval((function(){n.reportRuntimeStats()}),6e4)},et.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},et.prototype.track=function(e){this.updateRuntimeStats(e),!De()&&this.sessionId&&(this.callback&&(e.timestamp=Date.now(),e.sessionId=this.sessionId,this.callback(e)),"error"===(null==e?void 0:e.category)&&tt("viewer.error.tracked",e))},et.prototype.updateRuntimeStats=function(e){if(Object.prototype.hasOwnProperty.call(e,"aggregate"))switch(e.aggregate){case"count":this.runtimeStats[e.name]>0?this.runtimeStats[e.name]++:this.runtimeStats[e.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[e.name]=e.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},et.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},et.prototype.setLevel=function(e){this.level!==e&&(this.level=e,this.debug=e>=Je.DEBUG?console.log:nt,this.log=e>=Je.LOG?console.log:nt,this.info=e>=Je.INFO?console.info:nt,this.warn=e>=Je.WARNING?console.warn:nt,this.error=e>=Je.ERROR?this._reportError:nt)},et.prototype._reportError=function(){console.error.apply(console,arguments);const e=Array.prototype.slice.call(arguments).join(" ");this.callback&&this.callback({category:"error",message:e}),tt("viewer.error.logged",e)};let rt=new et;function ot(e){rt=e}const st={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,UNSUPORTED_FILE_EXTENSION:13,VIEWER_INTERNAL_ERROR:14,WEBGL_LOST_CONTEXT:15,LOAD_CANCELED:16};function at(e){return"ErrorCode:"+e+"."}function lt(e){return 403===e||401===e?st.NETWORK_ACCESS_DENIED:404===e?st.NETWORK_FILE_NOT_FOUND:e>=500?st.NETWORK_SERVER_ERROR:st.NETWORK_UNHANDLED_RESPONSE_CODE}function ct(e,t,i){var n,r,o,s,a,l;for(n="",o=i,r=0;r<o;)switch((s=e[t+r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(s);break;case 12:case 13:a=e[t+r++],n+=String.fromCharCode((31&s)<<6|63&a);break;case 14:a=e[t+r++],l=e[t+r++],n+=String.fromCharCode((15&s)<<12|(63&a)<<6|63&l)}return n}function ut(e,t,i){var n,r,o,s=i||0;if(r=e.length,t)for(n=0;n<r;n++)(o=e.charCodeAt(n))>=1&&o<=127?t[s++]=o:o>2047?(t[s++]=224|o>>12&15,t[s++]=128|o>>6&63,t[s++]=128|63&o):(t[s++]=192|o>>6&31,t[s++]=128|63&o);else for(n=0;n<r;n++)(o=e.charCodeAt(n))>=1&&o<=127?s++:s+=o>2047?3:2;return s-(i||0)}var ht=!0,dt=1048576;function ft(e,t,i){if(void 0===t&&(t=0),void 0===i&&(i=e.length),ht)return i>dt?function(e,t,i){var n,r,o,s,a,l,c,u;for(n="",a=[],o=i,l=0,r=0;r<o;){switch((s=e[t+r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a.push(String.fromCharCode(s));break;case 12:case 13:c=e[t+r++],a.push(String.fromCharCode((31&s)<<6|63&c));break;case 14:c=e[t+r++],u=e[t+r++],a.push(String.fromCharCode((15&s)<<12|(63&c)<<6|63&u))}(++l>=32768||r>=o)&&(n+=a.join(""),a.length=0,l=0)}return n}(e,t,i):ct(e,t,i);for(var n="",r=t,o=t+i;r<o;r++)n+=String.fromCharCode(e[r]);return decodeURIComponent(escape(n))}function pt(e){var t=ft(e,0,e.length);return t=t.replace(/\u000e/gi,""),JSON.parse(t)}function mt(e,t){if(void 0===t)return"";for(var i=t;i<e.length-1;){var n=e[i];if(44==n&&(10==e[i+1]||13==e[i+1]))break;if(10==n||13==n)break;i++}var r=ft(e,t,i-t);try{return JSON.parse(r)}catch(e){return console.error("Error parsing property blob to JSON : "+r),r}}function gt(e,t){for(var i=0,n=0,r=e.length;n<r;n++)44==e[n]&&i++;i++;var o=new Uint32Array(i+(t?1:0));n=0;for(var s=e.length;91!=e[n]&&n<s;)n++;if(n==e.length)return null;n++;var a=!1;i=0;for(var l=0;n<s;){var c=e[n];c>=48&&c<=57?(l=10*l+(c-48),a=!0):44==c||93==c?a&&(o[i++]=l,a=!1,l=0):(a=!1,l=0),n++}return o}function vt(e){for(var t=0,i=e.length-1,n=0;n<i;n++)44!=e[n]||10!=e[n+1]&&13!=e[n+1]||t++;if(!t)return null;t++;var r=new Uint32Array(t);for(n=0,t=0;91!=e[n]&&n<i;)n++;n++,r[t++]=n;for(var o=!1;n<i;)10==e[n]||13==e[n]?o=!0:o&&(o=!1,r[t++]=n),n++;return r}var yt=r(84406),bt=Uint8Array,xt=Uint16Array,_t=Int32Array,Et=new bt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),St=new bt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),At=new bt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wt=function(e,t){for(var i=new xt(31),n=0;n<31;++n)i[n]=t+=1<<e[n-1];var r=new _t(i[30]);for(n=1;n<30;++n)for(var o=i[n];o<i[n+1];++o)r[o]=o-i[n]<<5|n;return{b:i,r}},Ct=wt(Et,2),Tt=Ct.b,Mt=Ct.r;Tt[28]=258,Mt[258]=28;for(var It=wt(St,0),Pt=It.b,Lt=(It.r,new xt(32768)),Rt=0;Rt<32768;++Rt){var Dt=(43690&Rt)>>1|(21845&Rt)<<1;Dt=(61680&(Dt=(52428&Dt)>>2|(13107&Dt)<<2))>>4|(3855&Dt)<<4,Lt[Rt]=((65280&Dt)>>8|(255&Dt)<<8)>>1}var Ot=function(e,t,i){for(var n=e.length,r=0,o=new xt(t);r<n;++r)e[r]&&++o[e[r]-1];var s,a=new xt(t);for(r=1;r<t;++r)a[r]=a[r-1]+o[r-1]<<1;if(i){s=new xt(1<<t);var l=15-t;for(r=0;r<n;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],h=a[e[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)s[Lt[h]>>l]=c}else for(s=new xt(n),r=0;r<n;++r)e[r]&&(s[r]=Lt[a[e[r]-1]++]>>15-e[r]);return s},Bt=new bt(288);for(Rt=0;Rt<144;++Rt)Bt[Rt]=8;for(Rt=144;Rt<256;++Rt)Bt[Rt]=9;for(Rt=256;Rt<280;++Rt)Bt[Rt]=7;for(Rt=280;Rt<288;++Rt)Bt[Rt]=8;var Nt=new bt(32);for(Rt=0;Rt<32;++Rt)Nt[Rt]=5;var Ut=Ot(Bt,9,1),kt=Ot(Nt,5,1),Ft=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},Vt=function(e,t,i){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&i},Gt=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},zt=function(e){return(e+7)/8|0},Ht=function(e,t,i){return(null==t||t<0)&&(t=0),(null==i||i>e.length)&&(i=e.length),new bt(e.subarray(t,i))},Wt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],jt=function(e,t,i){var n=new Error(t||Wt[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,jt),!i)throw n;return n},qt=function(e,t,i,n){var r=e.length,o=n?n.length:0;if(!r||t.f&&!t.l)return i||new bt(0);var s=!i,a=s||2!=t.i,l=t.i;s&&(i=new bt(3*r));var c=function(e){var t=i.length;if(e>t){var n=new bt(Math.max(2*t,e));n.set(i),i=n}},u=t.f||0,h=t.p||0,d=t.b||0,f=t.l,p=t.d,m=t.m,g=t.n,v=8*r;do{if(!f){u=Vt(e,h,1);var y=Vt(e,h+1,3);if(h+=3,!y){var b=e[(P=zt(h)+4)-4]|e[P-3]<<8,x=P+b;if(x>r){l&&jt(0);break}a&&c(d+b),i.set(e.subarray(P,x),d),t.b=d+=b,t.p=h=8*x,t.f=u;continue}if(1==y)f=Ut,p=kt,m=9,g=5;else if(2==y){var _=Vt(e,h,31)+257,E=Vt(e,h+10,15)+4,S=_+Vt(e,h+5,31)+1;h+=14;for(var A=new bt(S),w=new bt(19),C=0;C<E;++C)w[At[C]]=Vt(e,h+3*C,7);h+=3*E;var T=Ft(w),M=(1<<T)-1,I=Ot(w,T,1);for(C=0;C<S;){var P,L=I[Vt(e,h,M)];if(h+=15&L,(P=L>>4)<16)A[C++]=P;else{var R=0,D=0;for(16==P?(D=3+Vt(e,h,3),h+=2,R=A[C-1]):17==P?(D=3+Vt(e,h,7),h+=3):18==P&&(D=11+Vt(e,h,127),h+=7);D--;)A[C++]=R}}var O=A.subarray(0,_),B=A.subarray(_);m=Ft(O),g=Ft(B),f=Ot(O,m,1),p=Ot(B,g,1)}else jt(1);if(h>v){l&&jt(0);break}}a&&c(d+131072);for(var N=(1<<m)-1,U=(1<<g)-1,k=h;;k=h){var F=(R=f[Gt(e,h)&N])>>4;if((h+=15&R)>v){l&&jt(0);break}if(R||jt(2),F<256)i[d++]=F;else{if(256==F){k=h,f=null;break}var V=F-254;if(F>264){var G=Et[C=F-257];V=Vt(e,h,(1<<G)-1)+Tt[C],h+=G}var z=p[Gt(e,h)&U],H=z>>4;z||jt(3),h+=15&z;B=Pt[H];if(H>3){G=St[H];B+=Gt(e,h)&(1<<G)-1,h+=G}if(h>v){l&&jt(0);break}a&&c(d+131072);var W=d+V;if(d<B){var j=o-B,q=Math.min(B,W);for(j+d<0&&jt(3);d<q;++d)i[d]=n[j+d]}for(;d<W;++d)i[d]=i[d-B]}}t.l=f,t.p=k,t.b=d,t.f=u,f&&(u=1,t.m=m,t.d=p,t.n=g)}while(!u);return d!=i.length&&s?Ht(i,0,d):i.subarray(0,d)},Kt=new bt(0),Xt=function(e){31==e[0]&&139==e[1]&&8==e[2]||jt(6,"invalid gzip data");var t=e[3],i=10;4&t&&(i+=2+(e[10]|e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[i++]);return i+(2&t)},Yt=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0};function Qt(e,t){var i=Xt(e);return i+8>e.length&&jt(6,"invalid gzip data"),qt(e.subarray(i,-8),{i:2},t&&t.out||new bt(Yt(e)),t&&t.dictionary)}var Zt="undefined"!=typeof TextDecoder&&new TextDecoder;try{Zt.decode(Kt,{stream:!0}),1}catch(e){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;var $t=r(51436),Jt=r.n($t);let ei={WORKER_REGISTER_FILE_PORT:"REGISTER_FILE_PORT",WORKER_READ_FILE:"READ_FILE"};var ti=!1;function ii(e){var t=e.split("/");if(0==t.length)return e;for(var i=[],n=0;n<t.length;++n){var r=t[n];"."!==r&&(".."===r&&i.length?i.pop():i.push(r))}return 0==i.length?"":i.join("/")}function ni(e,t){if(-1!==e.indexOf("://")||0===e.indexOf("urn:"))return e;if(t)return t+e;if("undefined"==typeof window)return e;const i=c();var n=i.location.pathname,r=n.lastIndexOf("/");return n=n.substr(0,r+1),i.location.protocol+"//"+i.location.host+n+e}function ri(e,t){for(var i=e.length-t,n=new ArrayBuffer(i),r=new Uint8Array(n,0),o=0,s=t;o<i;o++,s++)r[o]=255&e.charCodeAt(s);return r}function oi(e,t){return-1===t.indexOf("file://")&&(-1!==t.indexOf("://")||(!!e||void 0))}if(ei.simplifyPath=ii,ei.OSS_PREFIX="urn:adsk.objects:os.object:",ei.generateUrl=function(e,t,i,n,r,o,s){if(i=i||"",S()&&!oi(e,i))return i;if(i=ii(i),!s){var a=i.indexOf("urn:"),l=i.indexOf("?");i=-1!=a?-1!==l?i.slice(0,a)+encodeURIComponent(i.slice(a,l))+i.slice(l):i.slice(0,a)+encodeURIComponent(i.slice(a)):encodeURI(i)}if(r&&ei.isOSSUrl(i)){var c=i.indexOf("/objects/")+9,u=i.substring(c);i=i.substring(0,c)+encodeURIComponent(u)}if(!t||0!==decodeURIComponent(i).indexOf("urn:"))return oi(null,i)?i:e+i;switch("items"!==t&&(i=i.substr(6)),t){case"items":return ke.getItemApi(e,i,n);case"bubbles":return ke.getManifestApi(e,i,n);case"thumbnails":return ke.getThumbnailApi(e,i,n);case"properties":return ke.getPropertyQueryApi(e,i,n,o)}},S())!function(){var e=r(39709),t=r(90315),i=r(9631),n=r(50684),o=r(18215);let s=new i.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10}),a=new n.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10});var l=new i.Agent({maxSockets:10});ei.rawGet=function(r,c,u,h,d,f){if(f=f||{},oi(r,u=ei.generateUrl(r,c,u,void 0,f.escapeOssObjects,!1))){if(f.queryParams){var p=-1===u.indexOf("?")?"?":"&";u=u+p+f.queryParams}var m=o.parse(u),g={host:m.hostname,port:m.port,method:f.method||"GET",path:m.path,headers:{},retryCount:0,agent:"https:"===m.protocol?s:a};if(g.host.endsWith(".api.autodesk.com")&&(g.path.startsWith("/derivativeservice")||g.path.startsWith("/modelderivative"))&&(g.agent=l),f.headers)for(var v in f.headers)g.headers[v]=f.headers[v];g.headers["accept-encoding"]||(g.headers["accept-encoding"]="gzip, deflate"),f.range&&(g.headers.Range="bytes="+f.range.min+"-"+f.range.max),f.ondata&&(f.responseType="arraybuffer");var y=("https:"===m.protocol?i:n).request(g,(function(e){var i=!(e.statusCode>=200&&e.statusCode<400),n=e;!i&&function(e,t){return!!("gzip"===e.headers["content-encoding"]||t.endsWith(".json.gz")||t.endsWith("FragmentList.pack")||t.endsWith("LightList.bin")||t.endsWith("CameraList.bin")||t.endsWith("CameraDefinitions.bin")||t.endsWith("LightDefinitions.bin"))}(e,m.pathname)&&(n=e.pipe(t.createGunzip())),"json"!==f.responseType&&"text"!==f.responseType&&f.responseType||n.setEncoding("utf8");var r=[],o=(Buffer.allocUnsafe(65536),0);n.on("data",(function(e){r.push(e),f.ondata&&f.ondata(e)})),n.on("end",(function(){if(e.statusCode>=200&&e.statusCode<400){if("json"===f.responseType){var i=JSON.parse(r.join(""));return void h(i)}if("text"===f.responseType||""===f.responseType){var n=r.join("");return void h(n)}var s=Buffer.concat(r);if(31===s[0]&&139===s[1]){rt.warn("An LMV resource ("+u+") was double compressed, or Content-Encoding header missing");try{s=t.gunzipSync(s),o=s.length}catch(e){d(st.BAD_DATA,"Malformed data received when requesting file",{url:u,exception:e.toString(),stack:e.stack})}}200===y.status&&f.range&&(s=new Uint8Array(s,f.range.min,f.range.max-f.range.min)),h(s,o)}else d&&d(e.statusCode,e.statusMessage,{url:u})}))}));y.on("error",(function(e){d&&d(e.code,e.message,{url:u})})),f.postData&&y.write(f.postData),y.end()}else!function(i,n,r,o){function s(e){if("json"===o.responseType)try{return JSON.parse(e.toString("utf8"))}catch(e){r(e)}return e}0===i.indexOf("file://")&&(i=i.substr(7)),e.readFile(i,(function(e,a){e?r(0,0,{httpStatusText:e,url:i}):31===a[0]&&139===a[1]?t.gunzip(a,null,(function(e,t){e?r(0,0,{httpStatusText:e,url:i}):(t=s(t),o.ondata&&o.ondata(t),n(t))})):(a=s(a),o.ondata&&o.ondata(a),n(a))}))}(u,h,d,f)}}();else{var si=new(Jt());si.max=25;var ai={},li={},ci={};ei.registerProtocolPort=function(e,t){/^(http(s)?|file):/gi.test(e)?console.warn("http(s) or file protocol were not allowed to be handled"):t?(ai[e]=t,t.onmessage=function(e){var t=e.data.url;if(li[t]){var i=li[t];if(e.data.error)i.onFailureWrapped(st.BAD_DATA,"Malformed data received when requesting file",{url:t,exception:e.data.error.message,stack:e.data.error.stack});else{var n=e.data.buffer;if(li[t]=void 0,31===n[0]&&139===n[1]&&t.match(/(.f2d|.gz)$/gi))try{n=Qt(n),i.options&&i.options.ondata&&i.options.ondata(n),i.onSuccessWrapped(n)}catch(e){i.onFailureWrapped(st.BAD_DATA,"Malformed data received when requesting file",{url:t,exception:e.toString(),stack:e.stack})}else i.onSuccessWrapped(n)}}else if(ci[t]){var r=[];e.data&&e.data.buffer&&e.data.buffer.buffer instanceof ArrayBuffer&&r.push(e.data.buffer.buffer),ci[t].postMessage(e.data,r),ci[t]=void 0}}):ai[e]&&ai[e]instanceof MessagePort&&(ai[e].onmessage=void 0,ai[e]=void 0)},ei.handlerProtocol=function(e,t,i,n,r){var o=ai[e];li[t]={onSuccessWrapped:i,onFailureWrapped:n,options:r},o.postMessage({operation:ei.WORKER_READ_FILE,url:t})},ei.forwardProtocolHandlerToWorker=function(e){var t={},i=new MessageChannel;for(var n in i.port1.onmessage=function(e){var t=new URL(e.data.url);ai[t.protocol].postMessage(e.data),ci[t]=i.port1},ai)ai[n]instanceof MessagePort&&(t[n]=i.port2);e.doOperation({operation:ei.WORKER_REGISTER_FILE_PORT,protocolPortMap:t},[i.port2])},ei.rawGet=function(e,t,i,n,r,o){si.go((s=>{let a=function(){s();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];r&&r.apply(r,t)},l=function(){s();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n&&n.apply(n,t)};var c=/^(\w+:)\/\//gi.exec(i);if(c&&2==c.length&&ai[c[1]])ei.handlerProtocol(c[1],i,l,a,o);else{let n=ei._rawGet;null!=o&&o.useFetch&&(n=ei._rawGetFetch),n(e,t,i,l,(function(){const n=arguments.length<=0?void 0:arguments[0];let r="get"===((null==o?void 0:o.method)||(null!=o&&o.noBody?"HEAD":"GET")).toLowerCase()&&(0===n||429===n||n>=500);if((arguments.length<=2?void 0:arguments[2]).aborted&&(r=!1),r){const r=arguments.length<=3?void 0:arguments[3];let s=100,c=5,u=!1;if(429!==n&&503!==n||null==r||!r.getResponseHeader("Retry-After")?0===n&&(u=3,c=2):u=r.getResponseHeader("Retry-After"),u){const e=Number(u);s=!isNaN(e)&&1e3*e||Date.parse(u)-(new Date).getTime(),s=s>100?s:100}ei._retryRequest(e,t,i,o,s,c).then((e=>{rt.warn(`request ${i} successful after retries.`),l(...e)})).catch((e=>{rt.warn(`request ${i} unsuccessful after retries.`),a(...e)}))}else a(...arguments)}),o)}}))},ei._retryRequest=function(e,t,i,n,r,o){const s={delayFirstAttempt:!0,startingDelay:r,numOfAttempts:4,retry:(e,t)=>{let[i,n,{url:r}]=e;return rt.warn(`request ${r} failed with status ${i} ${n}. Attempt ${t}`),!0},timeMultiple:o};return(0,yt.backOff)((()=>new Promise(((r,o)=>{let s=ei._rawGet;null!=n&&n.useFetch&&(s=ei._rawGetFetch),s(e,t,i,(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r(t)}),(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o(t)}),n)}))),s)},ei.isOSSUrl=function(e){return!!e&&-1!==e.indexOf("/oss/v2/buckets")},ei.getSignedS3DownloadUrl=function(e){return new Promise((t=>{const i=e.indexOf("?acmsession=");-1!==i&&(e=e.substring(0,i)),e+="/signeds3download?useCdn=true";const n=new XMLHttpRequest;n.open("GET",e),n.setRequestHeader("Authorization",ke.HTTP_REQUEST_HEADERS.Authorization),n.responseType="json",n.send();const r=()=>{t(null)};n.onload=e=>{const i=e.currentTarget.response;t(i.url)},n.onerror=r,n.ontimeout=r,n.onabort=r}))},ei._rawGet=async function(e,t,i,n,r,o){o=o||{},i=ei.generateUrl(e,t,i,o.apiData,o.escapeOssObjects,o.guid,!1);let s=!1;if(ei.isOSSUrl(i)){const e=await ei.getSignedS3DownloadUrl(i);e?(i=e,s=!0):console.warn("Failed getting signed URL - Fallback to direct OSS resource.")}if(o.queryParams&&!s){var a=-1===i.indexOf("?")?"?":"&";i=i+a+o.queryParams}var l=new XMLHttpRequest;function c(e){r&&r(l.status,l.statusText,{url:i},l)}function u(e){if("json"===o.responseType)try{if(e instanceof Uint8Array)return pt(e);if("string"==typeof e)return JSON.parse(e)}catch(e){}return e}function h(e){if(l.status>=200&&l.status<400)if(l.response&&l.response instanceof ArrayBuffer){var t;if(31===(t=200===l.status&&o.range?new Uint8Array(l.response,o.range.min,o.range.max-o.range.min):new Uint8Array(l.response))[0]&&139===t[1]){ti||(ti=!0,rt.warn("An LMV resource ("+i+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{t=Qt(t)}catch(e){r(st.BAD_DATA,"Malformed data received when requesting file",{url:i,exception:e.toString(),stack:e.stack},l)}}n&&n(u(t))}else{var s=l.response;s||o.responseType&&"text"!==o.responseType||(s=l.responseText),n&&n(u(s))}else c()}try{var d=!Object.prototype.hasOwnProperty.call(o,"asynchronous")||o.asynchronous;if(l.open(o.method||(o.noBody?"HEAD":"GET"),i,d),Object.prototype.hasOwnProperty.call(o,"responseType")&&(l.responseType=o.responseType),o.range&&l.setRequestHeader("Range","bytes="+o.range.min+"-"+o.range.max),!s&&(l.withCredentials=!0,Object.prototype.hasOwnProperty.call(o,"withCredentials")&&(l.withCredentials=o.withCredentials),o.headers))for(var f in o.headers)l.setRequestHeader(f,o.headers[f]),"authorization"===f.toLocaleLowerCase()&&(l.withCredentials=!1);d&&(l.onload=h,l.onerror=c,l.ontimeout=c,l.onabort=function(e){r&&r(l.status,"request was aborted",{url:i,aborted:!0},l)},o.ondata&&(l.overrideMimeType("text/plain; charset=x-user-defined"),o._dlProgress={streamOffset:0},l.onreadystatechange=function(){if(l.readyState>2&&200===l.status&&o.ondata){var e=l.responseText;if(o._dlProgress.streamOffset>=e.length)return;var t=ri(e,o._dlProgress.streamOffset);o._dlProgress.streamOffset=e.length,o.ondata(t)}})),l.send(o.postData),d||h()}catch(e){r(l.status,l.statusText,{url:i,exception:e},l)}},ei._rawGetFetch=async function(e,t,i,n,r,o){o=o||{},i=ei.generateUrl(e,t,i,o.apiData,o.escapeOssObjects,o.guid,!1);let s=!1;if(ei.isOSSUrl(i)){const e=await ei.getSignedS3DownloadUrl(i);e?(i=e,s=!0):console.warn("Failed getting signed URL - Fallback to direct OSS resource.")}if(o.queryParams&&!s){var a=-1===i.indexOf("?")?"?":"&";i=i+a+o.queryParams}var l,c=new Request(i);function u(e){return{getResponseHeader:t=>{var i;return null==e||null===(i=e.headers)||void 0===i?void 0:i.get(t)}}}try{const e={method:o.method||(o.noBody?"HEAD":"GET"),body:o.postData,headers:o.headers||{},signal:o.abortSignal};if(o.range&&(e.headers.Range="bytes="+o.range.min+"-"+o.range.max),!s&&(e.credentials="include",Object.prototype.hasOwnProperty.call(o,"withCredentials")&&!1===o.withCredentials&&(e.credentials="omit"),o.headers))for(var h in o.headers)"authorization"===h.toLocaleLowerCase()&&(e.credentials="omit");if(!(l=await fetch(c,e)).ok){let e=await l.text();return void r(l.status,e,{url:i},u(l))}if(o.ondata){const e=l.body.getReader();for(;;){let{done:t,value:i}=await e.read();if(t)return void(n&&n(null));o.ondata(i)}}else{let e;o.responseType&&"text"!==o.responseType?"json"===o.responseType?e=await l.json():(e=await l.arrayBuffer(),200===c.status&&o.range&&(e=new Uint8Array(e,o.range.min,o.range.max-o.range.min))):e=await l.text(),n&&n(e)}}catch(e){"AbortError"===e.name?r(0,"request was aborted",{url:i,aborted:!0},u(l)):l?r(l.status,l.statusText,{url:i,exception:e},u(l)):r(0,"network error",{url:i,exception:e})}}}function ui(e,t){Object.prototype.hasOwnProperty.call(t,"responseType")||(t.responseType="arraybuffer"),Object.prototype.hasOwnProperty.call(t,"withCredentials")||(t.withCredentials=!!e.auth),t.headers=e.headers,t.queryParams=e.queryParams,t.endpoint=e.endpoint,t.escapeOssObjects=e.escapeOssObjects}ei.defaultFailureCallback=function(e,t,i){403==e?this.raiseError(st.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:i.url,httpStatus:e,httpStatusText:t}):404==e?this.raiseError(st.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:i.url,httpStatus:e,httpStatusText:t}):0===e&&i.aborted?this.raiseError(st.LOAD_CANCELED,"Request aborted",{url:i.url,httpStatus:e,httpStatusText:t}):e>=500&&e<600?this.raiseError(st.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:i.url,httpStatus:e,httpStatusText:t}):i.exception?this.raiseError(st.NETWORK_FAILURE,"Network failure",{url:i.url,exception:i.exception.toString(),stack:i.exception.stack}):this.raiseError(st.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:i.url,httpStatus:e,httpStatusText:t,data:i})},ei.getItem=function(e,t,i,n,r){if(ui(e,r=r||{}),r.range&&!e.supportsRangeRequests){let e="start="+r.range.min+"&end="+r.range.max;r.queryParams?r.queryParams+="&"+e:r.queryParams=e,r.range=void 0}ei.rawGet(e.endpoint,"items",t,i,n,r)},ei.getManifest=function(e,t,i,n,r){r=r||{},Object.prototype.hasOwnProperty.call(r,"responseType")||(r.responseType="json"),ui(e,r),ei.rawGet(e.endpoint,"bubbles",t,i,n,r)},ei.getProperties=function(e,t,i,n,r,o){const s={};ui(e,s),s.responseType="json",s.guid=i,s.method="POST",s.postData=JSON.stringify(n),s.headers["Content-Type"]="application/json",s.headers.accept="application/json",s.headers["Access-Control-Allow-Origin"]="*",ei.rawGet(e.endpoint,"properties",t,r,o,s)},ei.getThumbnail=function(e,t,i,n,r){ui(e,r=r||{});var o=r.queryParams||"",s=[];if(-1===o.indexOf("guid=")&&r.guid&&s.push("guid="+encodeURIComponent(r.guid)),-1===o.indexOf("role=")){var a=r.role||"rendered";s.push("role="+a)}if(-1===o.indexOf("width=")){let e=r.size||400;s.push("width="+e)}if(-1===o.indexOf("height=")){let e=r.size||400;s.push("height="+e)}-1===o.indexOf("acmsession=")&&r.acmsession&&s.push("acmsession="+r.acmsession);var l=s.join("&");r.queryParams?r.queryParams=r.queryParams+"&"+l:r.queryParams=l,ei.rawGet(e.endpoint,"thumbnails",t,i,n,r)},ei.getACMSession=function(e,t,i,n){const r={numOfAttempts:4,timeMultiple:5,retry:(e,t)=>(rt.warn(`acmsession request failed. Attempt #${t}`),!0)};(0,yt.backOff)((()=>new Promise(((i,n)=>{ei._getACMSession(e,t,i,n)}))),r).then((function(){return i(...arguments)})).catch((function(){return n(...arguments)}))},ei._getACMSession=function(e,t,i,n){var r,o={};for(var s in t)"oauth2AccessToken"===s?r=t[s]:-1!==s.indexOf("x-ads-acm")&&(o[s]=t[s]);o.application="autodesk";var a=new XMLHttpRequest;a.open("POST",e+"/oss-ext/v2/acmsessions",!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+r),a.responseType="json",a.onload=function(){if(200===a.status&&a.response){var e="string"==typeof a.response?JSON.parse(a.response):a.response;e&&e.acmsession?i(e.acmsession):n(a.status,"Can't get acm session from response.")}else n(a.status)},a.onerror=n,a.ontimeout=n,a.send(JSON.stringify(o)),delete o.application};class hi{LMV_WORKER_URL=$||0;WORKER_DATA_URL=null;customWorkerScriptURLs=[];initWorkerScript(){fetch(de(this.LMV_WORKER_URL))}addCustomWorkerScript(e){this.WORKER_DATA_URL?console.warn("Called addCustomWorkerScript after a worker has been created. The call is ignored."):this.customWorkerScriptURLs.push(e)}createWorker(e,t){if(!this.WORKER_DATA_URL){const e=[new URL(de(this.LMV_WORKER_URL),document.baseURI).href].concat(this.customWorkerScriptURLs).map((e=>JSON.stringify(e))).join(","),t=new Blob([`\n                try {\n                    importScripts(${e});\n                } catch (e) {\n                    console.warn("Failed to import worker script. Could be a network failure or just the worker closing.");\n                    console.log(e);\n                }\n            `],{type:"application/javascript"});this.WORKER_DATA_URL=URL.createObjectURL(t)}let i=new Worker(this.WORKER_DATA_URL,{name:e});return i.doOperation=i.postMessage,!0===t&&ei.forwardProtocolHandlerToWorker(i),i}}let di=S()?new class extends hi{constructor(){super(),this.MainWorker=r(86059).MainWorker}initWorkerScript(){}addCustomWorkerScript(){console.warn("addCustomWorkerScript is not supported in a Node environment.")}createWorker=function(){return new this.MainWorker}}:new hi;function fi(){return di.createWorker(...arguments)}function pi(){return di.initWorkerScript(...arguments)}function mi(e){return mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mi(e)}var gi=[],vi=gi.forEach,yi=gi.slice;function bi(e){return vi.call(yi.call(arguments,1),(function(t){if(t)for(var i in t)void 0===e[i]&&(e[i]=t[i])})),e}function xi(){return"function"==typeof XMLHttpRequest||"object"===("undefined"==typeof XMLHttpRequest?"undefined":mi(XMLHttpRequest))}var _i,Ei,Si,Ai=r(85178),wi=r.t(Ai,2);function Ci(e){return Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ci(e)}"function"==typeof fetch&&(_i="undefined"!=typeof global&&global.fetch?global.fetch:"undefined"!=typeof window&&window.fetch?window.fetch:fetch),xi()&&("undefined"!=typeof global&&global.XMLHttpRequest?Ei=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(Ei=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?Si=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(Si=window.ActiveXObject)),_i||!wi||Ei||Si||(_i=Ai||wi),"function"!=typeof _i&&(_i=void 0);var Ti=function(e,t){if(t&&"object"===Ci(t)){var i="";for(var n in t)i+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t[n]);if(!i)return e;e=e+(-1!==e.indexOf("?")?"&":"?")+i.slice(1)}return e},Mi=function(e,t,i){_i(e,t).then((function(e){if(!e.ok)return i(e.statusText||"Error",{status:e.status});e.text().then((function(t){i(null,{status:e.status,data:t})})).catch(i)})).catch(i)},Ii=!1;const Pi=function(e,t,i,n){return"function"==typeof i&&(n=i,i=void 0),n=n||function(){},_i?function(e,t,i,n){e.queryStringParams&&(t=Ti(t,e.queryStringParams));var r=bi({},"function"==typeof e.customHeaders?e.customHeaders():e.customHeaders);i&&(r["Content-Type"]="application/json");var o="function"==typeof e.requestOptions?e.requestOptions(i):e.requestOptions,s=bi({method:i?"POST":"GET",body:i?e.stringify(i):void 0,headers:r},Ii?{}:o);try{Mi(t,s,n)}catch(e){if(!o||0===Object.keys(o).length||!e.message||e.message.indexOf("not implemented")<0)return n(e);try{Object.keys(o).forEach((function(e){delete s[e]})),Mi(t,s,n),Ii=!0}catch(e){n(e)}}}(e,t,i,n):xi()||"function"==typeof ActiveXObject?function(e,t,i,n){i&&"object"===Ci(i)&&(i=Ti("",i).slice(1)),e.queryStringParams&&(t=Ti(t,e.queryStringParams));try{var r;(r=Ei?new Ei:new Si("MSXML2.XMLHTTP.3.0")).open(i?"POST":"GET",t,1),e.crossDomain||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.withCredentials=!!e.withCredentials,i&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.overrideMimeType&&r.overrideMimeType("application/json");var o=e.customHeaders;if(o="function"==typeof o?o():o)for(var s in o)r.setRequestHeader(s,o[s]);r.onreadystatechange=function(){r.readyState>3&&n(r.status>=400?r.statusText:null,{status:r.status,data:r.responseText})},r.send(i)}catch(e){console&&console.log(e)}}(e,t,i,n):void n(new Error("No fetch and no xhr implementation found!"))};function Li(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ri=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:function(e){return JSON.parse(e)},stringify:JSON.stringify,parsePayload:function(e,t,i){return function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},t,i||"")},request:Pi,reloadInterval:"undefined"==typeof window&&36e5,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},Di=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.services=t,this.options=i,this.allOptions=n,this.type="backend",this.init(t,i,n)}var t,i,n;return t=e,i=[{key:"init",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=bi(i,this.options||{},Ri()),this.allOptions=n,this.services&&this.options.reloadInterval&&setInterval((function(){return t.reload()}),this.options.reloadInterval)}},{key:"readMulti",value:function(e,t,i){this._readAny(e,e,t,t,i)}},{key:"read",value:function(e,t,i){this._readAny([e],e,[t],t,i)}},{key:"_readAny",value:function(e,t,i,n,r){var o,s=this,a=this.options.loadPath;"function"==typeof this.options.loadPath&&(a=this.options.loadPath(e,i)),(a=function(e){return!!e&&"function"==typeof e.then}(o=a)?o:Promise.resolve(o)).then((function(o){if(!o)return r(null,{});var a=s.services.interpolator.interpolate(o,{lng:e.join("+"),ns:i.join("+")});s.loadUrl(a,r,t,n)}))}},{key:"loadUrl",value:function(e,t,i,n){var r=this;this.options.request(this.options,e,void 0,(function(o,s){if(s&&(s.status>=500&&s.status<600||!s.status))return t("failed loading "+e+"; status code: "+s.status,!0);if(s&&s.status>=400&&s.status<500)return t("failed loading "+e+"; status code: "+s.status,!1);if(!s&&o&&o.message&&o.message.indexOf("Failed to fetch")>-1)return t("failed loading "+e+": "+o.message,!0);if(o)return t(o,!1);var a,l;try{a="string"==typeof s.data?r.options.parse(s.data,i,n):s.data}catch(t){l="failed parsing "+e+" to json"}if(l)return t(l,!1);t(null,a)}))}},{key:"create",value:function(e,t,i,n,r){var o=this;if(this.options.addPath){"string"==typeof e&&(e=[e]);var s=this.options.parsePayload(t,i,n),a=0,l=[],c=[];e.forEach((function(i){var n=o.options.addPath;"function"==typeof o.options.addPath&&(n=o.options.addPath(i,t));var u=o.services.interpolator.interpolate(n,{lng:i,ns:t});o.options.request(o.options,u,s,(function(t,i){a+=1,l.push(t),c.push(i),a===e.length&&r&&r(l,c)}))}))}}},{key:"reload",value:function(){var e=this,t=this.services,i=t.backendConnector,n=t.languageUtils,r=t.logger,o=i.language;if(!o||"cimode"!==o.toLowerCase()){var s=[],a=function(e){n.toResolveHierarchy(e).forEach((function(e){s.indexOf(e)<0&&s.push(e)}))};a(o),this.allOptions.preload&&this.allOptions.preload.forEach((function(e){return a(e)})),s.forEach((function(t){e.allOptions.ns.forEach((function(e){i.read(t,e,"read",null,null,(function(n,o){n&&r.warn("loading namespace ".concat(e," for language ").concat(t," failed"),n),!n&&o&&r.log("loaded namespace ".concat(e," for language ").concat(t),o),i.loaded("".concat(t,"|").concat(e),n,o)}))}))}))}}}],i&&Li(t.prototype,i),n&&Li(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();Di.type="backend";const Oi=Di;var Bi=r(77427),Ni=function(e){return null!==e&&"object"==typeof e&&(Object.keys(e).forEach((function(t){Autodesk.Viewing.i18n.addResourceBundle(t,"allstrings",e[t],!0,!0)})),!0)},Ui=function(e,t){return c().LOCALIZATION_REL_PATH="res/locales/"+e+"/",Autodesk.Viewing.i18n.changeLanguage(e).then((()=>Autodesk.Viewing.i18n.reloadResources())).then((()=>{t&&t()}))},ki=function(e){const t=c(),i=t&&t.document;Autodesk.Viewing.i18n.localize=function(e){var t=e||i;Array.prototype.forEach.call(t.querySelectorAll("[data-i18n]"),(function(e){var t=e.getAttribute("data-i18n"),i=[null,t],n=i[0],r=i[1],o=Autodesk.Viewing.i18n.translate(r);o?n?e.setAttribute(n,o):e.placeholder?e.placeholder=o:e.textContent=o:n?e.setAttribute(n,r):e.textContent=r}))};var n=e&&e.language||navigator.language;return n=Bi.Lang.getSupported(n),Autodesk.Viewing.i18n.use(Oi).init({lng:n,backend:{loadPath:Autodesk.Viewing.Private.getResourceUrl("res/locales/%(lng)/%(ns).json")},load:"currentOnly",ns:"allstrings",defaultNS:"allstrings",fallbackLng:"en",debug:!1,useCookie:!1,interpolation:{prefix:"%(",suffix:")",escapeValue:!1}}),Ui(n)};let Fi=null;async function Vi(e){if(!Fi)return Fi=await async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=Object.assign({},{powerPreference:"high-performance"},t),n=await(null===(e=navigator)||void 0===e||null===(e=e.gpu)||void 0===e?void 0:e.requestAdapter(i));if(!n)return void console.warn("Couldn't request WebGPU adapter. WebGPU will not be available.");console.log(n.info);const r=await n.requestDevice({});return console.log(r.limits),r}(e),Fi}function Gi(){return Fi}let zi=1024*(F()?64:256)*1024,Hi=F()?2500:1e4,Wi=zi/2;function ji(e){Wi=e}let qi=1048576e3;const Ki=function(){Hi=4294967295};let Xi=!F();const Yi=336,Qi=.75;let Zi=!0;const $i=10;let Ji=!1,en=!0,tn=!1,nn=!1,rn=!1,on=!1,sn=!1;const an=!1,ln=!0,cn=15,un=.4,hn=1e4;let dn=!1,fn=!1,pn=1e3,mn=100;function gn(e,t){pn=e,mn=t}const vn=1048576,yn=1048576;function bn(){nn=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Xi=!nn}const xn={gpu_memory:2147483648,gpu_objects:512e3,model_memory:4294967296,consolidation_memory:1073741824};function _n(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xn;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&e&&(F()?console.warn("HLOD is not supported on mobile devices"):(rn=!0,bn(!0),tn=!0,Zi=!1,zi=e.gpu_memory,Hi=e.gpu_objects,qi=e.model_memory,Wi=e.consolidation_memory,console.log(`Using HLOD settings. Memory: ${zi}, Object Limit: ${Hi}, Consolidation Memory: ${Wi}`)))}function En(){rn&&(Ji=!0,on=!0,Zi=!0,console.log("Using dynamic GPU Memory Management"))}function Sn(){rn&&(fn=!0,dn=!0,console.log("Using UBOs for multi-material rendering"))}function An(e){Zi=e}async function wn(e){await Vi(e)?(sn=!0,rn||_n(!0)):alert("WebGPU beta option was enabled, but WebGPU is not supported in this browser. To get back to normal mode, please disable the WebGPU beta option in the viewer settings and reload the page.")}function Cn(){return null!==Gi()}const Tn=2*Math.pow(2,-24),Mn={VIEW_CUBE:"viewCube",VIEW_CUBE_COMPASS:"viewCubeCompass",VIEW_TYPE:"viewType",ALWAYS_USE_PIVOT:"alwaysUsePivot",ZOOM_TOWARDS_PIVOT:"zoomTowardsPivot",SELECTION_SETS_PIVOT:"selectionSetsPivot",REVERSE_HORIZONTAL_LOOK_DIRECTION:"reverseHorizontalLookDirection",REVERSE_VERTICAL_LOOK_DIRECTION:"reverseVerticalLookDirection",ORBIT_PAST_WORLD_POLES:"orbitPastWorldPoles",CLICK_TO_SET_COI:"clickToSetCOI",GHOSTING:"ghosting",OPTIMIZE_NAVIGATION:"optimizeNavigation",AMBIENT_SHADOWS:"ambientShadows",ANTIALIASING:"antialiasing",GROUND_SHADOW:"groundShadow",GROUND_REFLECTION:"groundReflection",LINE_RENDERING:"lineRendering",EDGE_RENDERING:"edgeRendering",LIGHT_PRESET:"lightPreset",ENV_MAP_BACKGROUND:"envMapBackground",FIRST_PERSON_TOOL_POPUP:"firstPersonToolPopup",BIM_WALK_TOOL_POPUP:"bimWalkToolPopup",BIM_WALK_NAVIGATOR_TYPE:"bimWalkNavigatorType",BIM_WALK_GRAVITY:"bimWalkGravity",DEFAULT_NAVIGATION_TOOL_3D:"defaultNavigationTool3D",SELECTION_MODE:"selectionMode",ENABLE_CUSTOM_ORBIT_TOOL_CURSOR:"enableCustomOrbitToolCursor",EXPLODE_STRATEGY:"explodeStrategy",FORCE_DOUBLE_SIDED:"forceDoubleSided",DISPLAY_SECTION_HATCHES:"displaySectionHatches",LARGE_MODEL_EXPERIENCE:"largeModelExperienceBeta"},In={GRAYSCALE:"grayscale",SWAP_BLACK_AND_WHITE:"swapBlackAndWhite",LOADING_ANIMATION:"loadingAnimation",FORCE_PDF_CALIBRATION:"forcePDFCalibration",FORCE_LEAFLET_CALIBRATION:"forceLeafletCalibration",DISABLE_PDF_HIGHLIGHT:"disablePdfHighlight",USE_PDF_VIEWPORT_INFO:"usePdfViewportInfo",VECTOR_VIEWING:"vectorViewing"},Pn={WEBGPU:"webgpu",PROGRESSIVE_RENDERING:"progressiveRendering",OPEN_PROPERTIES_ON_SELECT:"openPropertiesOnSelect",POINT_RENDERING:"pointRendering",BACKGROUND_COLOR_PRESET:"backgroundColorPreset",REVERSE_MOUSE_ZOOM_DIR:"reverseMouseZoomDir",LEFT_HANDED_MOUSE_SETUP:"leftHandedMouseSetup",FUSION_ORBIT:"fusionOrbit",FUSION_ORBIT_CONSTRAINED:"fusionOrbitConstrained",WHEEL_SETS_PIVOT:"wheelSetsPivot",RESTORE_SESSION_MEASUREMENTS:"restoreMeasurements",DISPLAY_UNITS:"displayUnits",DISPLAY_UNITS_PRECISION:"displayUnitsPrecision",KEY_MAP_CMD:"keyMapCmd",ZOOM_DRAG_SPEED:"zoomDragSpeed",ZOOM_SCROLL_SPEED:"zoomScrollSpeed"},Ln={DEFAULT:0,ORTHOGRAPHIC:1,PERSPECTIVE:2,PERSPECTIVE_ORTHO_FACES:3},Rn="escape",Dn="progress",On="fullScreenMode",Bn="navmode",Nn="viewerStateRestored",Un="viewerResize",kn="viewerInitialized",Fn="viewerUninitialized",Vn="loaderLoadFile",Gn="loaderLoadError",zn="loaderRepaint",Hn="svfLoaded",Wn="geometryLoaded",jn="texturesLoaded",qn="propertyDbLoaded",Kn="propertyDbUnavailable",Xn="propertyDbLoadProgress",Yn="modelUnloaded",Qn="beforeModelUnload",Zn="modelAdded",$n="modelRemoved",Jn="modelLayersLoaded",er="modelTransformChanged",tr="placementTransformChanged",ir="viewportBoundsChanged",nr="fragmentBoundingBoxesSet",rr="traversalControllerAdded",or="extensionPreLoaded",sr="extensionLoaded",ar="extensionPreUnloaded",lr="extensionUnloaded",cr="extensionPreActivated",ur="extensionActivated",hr="extensionPreDeactivated",dr="extensionDeactivated",fr="selection",pr="aggregateSelection",mr="isolate",gr="aggregateIsolation",vr="hide",yr="aggregateHidden",br="show",xr="showProperties",_r="showAll",Er="hideAll",Sr="cameraChanged",Ar="explodeChanged",wr="fitToView",Cr="aggregateFitToView",Tr="cutplanesChanged",Mr="toolChanged",Ir="renderOptionChanged",Pr="finalFrameRenderedChanged",Lr="renderPresented",Rr="layerVisibility",Dr="PrefChanged",Or="PrefReset",Br="restoreDefaultSettings",Nr="animationReady",Ur="cameraTransitionCompleted",kr="hyperlink",Fr="hyperlink_navigate",Vr="load_geometry",Gr="loadMissingGeometry",zr="webglcontextlost",Hr="webglcontextrestored",Wr="cancelLeafletScreenshot",jr="setView",qr="renderFirstPixel",Kr="newGeometryAdded",Xr="newMaterialAdded",Yr="profileChanged",Qr="renderScenePart",Zr="hoverObjectChanged",$r="animEnded",Jr="transitionStarted",eo="transitionEnded",to="fragmentsLoaded",io="fragmentsUnloaded",no="sceneUpdated",ro="refreshCustomProperties",oo="refreshCustomPropertiesValues",so="viewerVisibilityChanged";class ao{constructor(){this._window={inner:null,registeredEventListeners:new Map},this._document={inner:null,registeredEventListeners:new Map},this._window.inner=c(),this._document.inner=this._window.inner.document,this.addWindowEventListener=co.bind(this._window),this.removeWindowEventListener=uo.bind(this._window),this.addDocumentEventListener=co.bind(this._document),this.removeDocumentEventListener=uo.bind(this._document)}getWindow(){return this._window.inner}getDocument(){return this._document.inner}setWindow(e){if(e&&e!==this._window.inner){for(let[t,i]of this._window.registeredEventListeners.entries())for(let[n,r]of i.entries())e.addEventListener(t,n,...r),this._window.inner.removeEventListener(t,n,...r);for(let[t,i]of this._document.registeredEventListeners.entries())for(let[n,r]of i.entries())e.document.addEventListener(t,n,...r),this._document.inner.removeEventListener(t,n,...r);this._window.inner=e,this._document.inner=e.document}}}function lo(e){return!!e.opener}function co(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];lo(this.inner)||(this.registeredEventListeners.has(e)?this.registeredEventListeners.get(e).set(t,n):this.registeredEventListeners.set(e,new Map([[t,n]]))),this.inner.addEventListener(e,t,...n)}function uo(e,t){lo(this.inner)||this.registeredEventListeners.has(e)&&this.registeredEventListeners.get(e).has(t)&&this.registeredEventListeners.get(e).delete(t);for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];this.inner.removeEventListener(e,t,...n)}const ho=new ao;function fo(){this.globalManager=ho,this.setGlobalManager=function(e){this.globalManager=e,this.onSetGlobalManager(this.globalManager)},this.onSetGlobalManager=function(e){},this.getWindow=function(){return this.globalManager.getWindow()},this.getDocument=function(){return this.globalManager.getDocument()},this.setWindow=function(e){return this.globalManager.setWindow(e)},this.addWindowEventListener=function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];this.globalManager.addWindowEventListener(e,t,...n)},this.removeWindowEventListener=function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];this.globalManager.removeWindowEventListener(e,t,...n)},this.addDocumentEventListener=function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];this.globalManager.addDocumentEventListener(e,t,...n)},this.removeDocumentEventListener=function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];this.globalManager.removeDocumentEventListener(e,t,...n)}}Autodesk.Viewing.GlobalManager=ao,Autodesk.Viewing.GlobalManagerMixin=fo;let po={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2},mo=1,go=0,vo=1,yo={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Field:[202,226,252,202,201,190],Boardwalk:[216,230,248,230,228,220],Custom:[230,230,230,150,150,150]};var bo=yo;let xo=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:bo["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:vo,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:bo["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:vo,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:bo["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:vo,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:bo["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:vo,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:bo["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:vo,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:bo.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:vo,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:bo["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:bo.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:vo,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:vo,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:vo,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:bo["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:vo,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:bo["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:vo,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:bo["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:vo,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:bo["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:vo,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:bo["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:vo,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:bo.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:vo,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:bo.Snow,darkerFade:!1,rotation:0},{name:"Field",path:"field",type:"logluv",tonemap:vo,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo.Field,useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:vo,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo.Boardwalk,useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Flat Shading",path:null,tonemap:0,E_bias:0,directLightColor:[0,0,0],ambientColor:[0,0,0],lightMultiplier:0,bgColorGradient:bo["Fusion Grey"],darkerFade:!1,rotation:0}],_o=[{name:"Harbor",path:"Harbor",type:"logluv",tonemap:vo,E_bias:1.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo["Sky Blue"],useIrradianceAsBackground:!0,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"Night",path:"Night",type:"logluv",tonemap:1,E_bias:4,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0},{name:"Parking",path:"Parking",type:"logluv",tonemap:vo,E_bias:2.8,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo["Sky Blue"],useIrradianceAsBackground:!1,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"River Road",path:"RiverRoad",type:"logluv",tonemap:vo,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo["Fusion Grey"],useIrradianceAsBackground:!1,saoIntensity:.7,darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:vo,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:vo,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:vo,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo.Midnight,darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:bo["RaaS SBS"],darkerFade:!1,rotation:0},{name:"City Night",path:"CityNight",type:"logluv",tonemap:vo,E_bias:1.6,directLightColor:[1,1,1],lightMultiplier:.2,bgColorGradient:bo.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0}];function Eo(e,t){Object.assign(t,e),t.name=e.name+" (copy)"}function So(e){return So="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},So(e)}function Ao(e){var t=function(e,t){if("object"!=So(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=So(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==So(t)?t:t+""}function wo(e,t,i){return(t=Ao(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Co(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),n.forEach((function(t){wo(e,t,i[t])}))}return e}function To(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mo(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ao(n.key),n)}}function Io(e,t,i){return t&&Mo(e.prototype,t),i&&Mo(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Po(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lo(e,t){if(t&&("object"===So(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Po(e)}function Ro(e){return Ro=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ro(e)}function Do(e,t){return Do=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Do(e,t)}function Oo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Do(e,t)}c().ENABLE_DEBUG&&Array.prototype.push.apply(xo,_o);var Bo={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},No=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};To(this,e),this.init(t,i)}return Io(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||Bo,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,i,n){return n&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(i).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,Co({},{prefix:"".concat(this.prefix,":").concat(t,":")},this.options))}}]),e}(),Uo=new No,ko=function(){function e(){To(this,e),this.observers={}}return Io(e,[{key:"on",value:function(e,t){var i=this;return e.split(" ").forEach((function(e){i.observers[e]=i.observers[e]||[],i.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,i)}));this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(i))}))}}]),e}();function Fo(){var e,t,i=new Promise((function(i,n){e=i,t=n}));return i.resolve=e,i.reject=t,i}function Vo(e){return null==e?"":""+e}function Go(e,t,i){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function r(){return!e||"string"==typeof e}for(var o="string"!=typeof t?[].concat(t):t.split(".");o.length>1;){if(r())return{};var s=n(o.shift());!e[s]&&i&&(e[s]=new i),e=Object.prototype.hasOwnProperty.call(e,s)?e[s]:{}}return r()?{}:{obj:e,k:n(o.shift())}}function zo(e,t,i){var n=Go(e,t,Object);n.obj[n.k]=i}function Ho(e,t){var i=Go(e,t),n=i.obj,r=i.k;if(n)return n[r]}function Wo(e,t,i){var n=Ho(e,i);return void 0!==n?n:Ho(t,i)}function jo(e,t,i){for(var n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?"string"==typeof e[n]||e[n]instanceof String||"string"==typeof t[n]||t[n]instanceof String?i&&(e[n]=t[n]):jo(e[n],t[n],i):e[n]=t[n]);return e}function qo(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var Ko={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function Xo(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return Ko[e]})):e}var Yo="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1;function Qo(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var n=t.split(i),r=e,o=0;o<n.length;++o){if(!r)return;if("string"==typeof r[n[o]]&&o+1<n.length)return;if(void 0===r[n[o]]){for(var s=2,a=n.slice(o,o+s).join(i),l=r[a];void 0===l&&n.length>o+s;)s++,l=r[a=n.slice(o,o+s).join(i)];if(void 0===l)return;if("string"==typeof l)return l;if(a&&"string"==typeof l[a])return l[a];var c=n.slice(o+s).join(i);return c?Qo(l,c,i):void 0}r=r[n[o]]}return r}}var Zo=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return To(this,t),i=Lo(this,Ro(t).call(this)),Yo&&ko.call(Po(i)),i.data=e||{},i.options=n,void 0===i.options.keySeparator&&(i.options.keySeparator="."),void 0===i.options.ignoreJSONStructure&&(i.options.ignoreJSONStructure=!0),i}return Oo(t,e),Io(t,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,o=void 0!==n.ignoreJSONStructure?n.ignoreJSONStructure:this.options.ignoreJSONStructure,s=[e,t];i&&"string"!=typeof i&&(s=s.concat(i)),i&&"string"==typeof i&&(s=s.concat(r?i.split(r):i)),e.indexOf(".")>-1&&(s=e.split("."));var a=Ho(this.data,s);return a||!o||"string"!=typeof i?a:Qo(this.data&&this.data[e]&&this.data[e][t],i,r)}},{key:"addResource",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},o=this.options.keySeparator;void 0===o&&(o=".");var s=[e,t];i&&(s=s.concat(o?i.split(o):i)),e.indexOf(".")>-1&&(n=t,t=(s=e.split("."))[1]),this.addNamespaces(t),zo(this.data,s,n),r.silent||this.emit("added",e,t,i,n)}},{key:"addResources",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var r in i)"string"!=typeof i[r]&&"[object Array]"!==Object.prototype.toString.apply(i[r])||this.addResource(e,t,r,i[r],{silent:!0});n.silent||this.emit("added",e,t,i)}},{key:"addResourceBundle",value:function(e,t,i,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},s=[e,t];e.indexOf(".")>-1&&(n=i,i=t,t=(s=e.split("."))[1]),this.addNamespaces(t);var a=Ho(this.data,s)||{};n?jo(a,i,r):a=Co({},a,i),zo(this.data,s,a),o.silent||this.emit("added",e,t,i)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?Co({},{},this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"toJSON",value:function(){return this.data}}]),t}(ko),$o={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,i,n,r){var o=this;return e.forEach((function(e){o.processors[e]&&(t=o.processors[e].process(t,i,n,r))})),t}},Jo={},es=function(e){function t(e){var i,n,r,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return To(this,t),i=Lo(this,Ro(t).call(this)),Yo&&ko.call(Po(i)),n=["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],r=e,o=Po(i),n.forEach((function(e){r[e]&&(o[e]=r[e])})),i.options=s,void 0===i.options.keySeparator&&(i.options.keySeparator="."),i.logger=Uo.create("translator"),i}return Oo(t,e),Io(t,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var i=this.resolve(e,t);return i&&void 0!==i.res}},{key:"extractFromKey",value:function(e,t){var i=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===i&&(i=":");var n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,r=t.ns||this.options.defaultNS;if(i&&e.indexOf(i)>-1){var o=e.match(this.interpolator.nestingRegexp);if(o&&o.length>0)return{key:e,namespaces:r};var s=e.split(i);(i!==n||i===n&&this.options.ns.indexOf(s[0])>-1)&&(r=s.shift()),e=s.join(n)}return"string"==typeof r&&(r=[r]),{key:e,namespaces:r}}},{key:"translate",value:function(e,i,n){var r=this;if("object"!==So(i)&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),i||(i={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var o=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,s=this.extractFromKey(e[e.length-1],i),a=s.key,l=s.namespaces,c=l[l.length-1],u=i.lng||this.language,h=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&"cimode"===u.toLowerCase()){if(h){var d=i.nsSeparator||this.options.nsSeparator;return c+d+a}return a}var f=this.resolve(e,i),p=f&&f.res,m=f&&f.usedKey||a,g=f&&f.exactUsedKey||a,v=Object.prototype.toString.apply(p),y=void 0!==i.joinArrays?i.joinArrays:this.options.joinArrays,b=!this.i18nFormat||this.i18nFormat.handleAsObject;if(b&&p&&("string"!=typeof p&&"boolean"!=typeof p&&"number"!=typeof p)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(v)<0&&("string"!=typeof y||"[object Array]"!==v)){if(!i.returnObjects&&!this.options.returnObjects)return this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,p,Co({},i,{ns:l})):"key '".concat(a," (").concat(this.language,")' returned an object instead of string.");if(o){var x="[object Array]"===v,_=x?[]:{},E=x?g:m;for(var S in p)if(Object.prototype.hasOwnProperty.call(p,S)){var A="".concat(E).concat(o).concat(S);_[S]=this.translate(A,Co({},i,{joinArrays:!1,ns:l})),_[S]===A&&(_[S]=p[S])}p=_}}else if(b&&"string"==typeof y&&"[object Array]"===v)(p=p.join(y))&&(p=this.extendTranslation(p,e,i,n));else{var w=!1,C=!1,T=void 0!==i.count&&"string"!=typeof i.count,M=t.hasDefaultValue(i),I=T?this.pluralResolver.getSuffix(u,i.count):"",P=i["defaultValue".concat(I)]||i.defaultValue;!this.isValidLookup(p)&&M&&(w=!0,p=P),this.isValidLookup(p)||(C=!0,p=a);var L=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&C?void 0:p,R=M&&P!==p&&this.options.updateMissing;if(C||w||R){if(this.logger.log(R?"updateKey":"missingKey",u,c,a,R?P:p),o){var D=this.resolve(a,Co({},i,{keySeparator:!1}));D&&D.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var O=[],B=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if("fallback"===this.options.saveMissingTo&&B&&B[0])for(var N=0;N<B.length;N++)O.push(B[N]);else"all"===this.options.saveMissingTo?O=this.languageUtils.toResolveHierarchy(i.lng||this.language):O.push(i.lng||this.language);var U=function(e,t,n){r.options.missingKeyHandler?r.options.missingKeyHandler(e,c,t,R?n:L,R,i):r.backendConnector&&r.backendConnector.saveMissing&&r.backendConnector.saveMissing(e,c,t,R?n:L,R,i),r.emit("missingKey",e,c,t,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&T?O.forEach((function(e){r.pluralResolver.getSuffixes(e).forEach((function(t){U([e],a+t,i["defaultValue".concat(t)]||P)}))})):U(O,a,P))}p=this.extendTranslation(p,e,i,f,n),C&&p===a&&this.options.appendNamespaceToMissingKey&&(p="".concat(c,":").concat(a)),(C||w)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(p))}return p}},{key:"extendTranslation",value:function(e,t,i,n,r){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,i,n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init(Co({},i,{interpolation:Co({},this.options.interpolation,i.interpolation)}));var s,a=i.interpolation&&i.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;if(a){var l=e.match(this.interpolator.nestingRegexp);s=l&&l.length}var c=i.replace&&"string"!=typeof i.replace?i.replace:i;if(this.options.interpolation.defaultVariables&&(c=Co({},this.options.interpolation.defaultVariables,c)),e=this.interpolator.interpolate(e,c,i.lng||this.language,i),a){var u=e.match(this.interpolator.nestingRegexp);s<(u&&u.length)&&(i.nest=!1)}!1!==i.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return r&&r[0]===n[0]&&!i.context?(o.logger.warn("It seems you are nesting recursively key: ".concat(n[0]," in key: ").concat(t[0])),null):o.translate.apply(o,n.concat([t]))}),i)),i.interpolation&&this.interpolator.reset()}var h=i.postProcess||this.options.postProcess,d="string"==typeof h?[h]:h;return null!=e&&d&&d.length&&!1!==i.applyPostProcessor&&(e=$o.handle(d,e,t,this.options&&this.options.postProcessPassResolved?Co({i18nResolved:n},i):i,this)),e}},{key:"resolve",value:function(e){var t,i,n,r,o,s=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!s.isValidLookup(t)){var l=s.extractFromKey(e,a),c=l.key;i=c;var u=l.namespaces;s.options.fallbackNS&&(u=u.concat(s.options.fallbackNS));var h=void 0!==a.count&&"string"!=typeof a.count,d=void 0!==a.context&&("string"==typeof a.context||"number"==typeof a.context)&&""!==a.context,f=a.lngs?a.lngs:s.languageUtils.toResolveHierarchy(a.lng||s.language,a.fallbackLng);u.forEach((function(e){s.isValidLookup(t)||(o=e,!Jo["".concat(f[0],"-").concat(e)]&&s.utils&&s.utils.hasLoadedNamespace&&!s.utils.hasLoadedNamespace(o)&&(Jo["".concat(f[0],"-").concat(e)]=!0,s.logger.warn('key "'.concat(i,'" for languages "').concat(f.join(", "),'" won\'t get resolved as namespace "').concat(o,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach((function(i){if(!s.isValidLookup(t)){r=i;var o,l,u=c,f=[u];if(s.i18nFormat&&s.i18nFormat.addLookupKeys)s.i18nFormat.addLookupKeys(f,c,i,e,a);else h&&(o=s.pluralResolver.getSuffix(i,a.count)),h&&d&&f.push(u+o),d&&f.push(u+="".concat(s.options.contextSeparator).concat(a.context)),h&&f.push(u+=o);for(;l=f.pop();)s.isValidLookup(t)||(n=l,t=s.getResource(i,e,l,a))}})))}))}})),{res:t,usedKey:i,exactUsedKey:n,usedLng:r,usedNS:o}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,i,n):this.resourceStore.getResource(e,t,i,n)}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,12)&&void 0!==e[i])return!0;return!1}}]),t}(ko);function ts(e){return e.charAt(0).toUpperCase()+e.slice(1)}var is=function(){function e(t){To(this,e),this.options=t,this.whitelist=this.options.supportedLngs||!1,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Uo.create("languageUtils")}return Io(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],i=e.split("-");return this.options.lowerCaseLng?i=i.map((function(e){return e.toLowerCase()})):2===i.length?(i[0]=i[0].toLowerCase(),i[1]=i[1].toUpperCase(),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=ts(i[1].toLowerCase()))):3===i.length&&(i[0]=i[0].toLowerCase(),2===i[1].length&&(i[1]=i[1].toUpperCase()),"sgn"!==i[0]&&2===i[2].length&&(i[2]=i[2].toUpperCase()),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=ts(i[1].toLowerCase())),t.indexOf(i[2].toLowerCase())>-1&&(i[2]=ts(i[2].toLowerCase()))),i.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isWhitelisted",value:function(e){return this.logger.deprecate("languageUtils.isWhitelisted",'function "isWhitelisted" will be renamed to "isSupportedCode" in the next major - please make sure to rename it\'s usage asap.'),this.isSupportedCode(e)}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,i=this;return e?(e.forEach((function(e){if(!t){var n=i.formatLanguageCode(e);i.options.supportedLngs&&!i.isSupportedCode(n)||(t=n)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var n=i.getLanguagePartFromCode(e);if(i.isSupportedCode(n))return t=n;t=i.options.supportedLngs.find((function(e){if(0===e.indexOf(n))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}},{key:"toResolveHierarchy",value:function(e,t){var i=this,n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],o=function(e){e&&(i.isSupportedCode(e)?r.push(e):i.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&o(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&o(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&o(this.getLanguagePartFromCode(e))):"string"==typeof e&&o(this.formatLanguageCode(e)),n.forEach((function(e){r.indexOf(e)<0&&o(i.formatLanguageCode(e))})),r}}]),e}(),ns=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],rs={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}};var os=function(){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};To(this,e),this.languageUtils=t,this.options=n,this.logger=Uo.create("pluralResolver"),this.rules=(i={},ns.forEach((function(e){e.lngs.forEach((function(t){i[t]={numbers:e.nr,plurals:rs[e.fc]}}))})),i)}return Io(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=this.getRule(e);return t&&t.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){return this.getSuffixes(e).map((function(e){return t+e}))}},{key:"getSuffixes",value:function(e){var t=this,i=this.getRule(e);return i?i.numbers.map((function(i){return t.getSuffix(e,i)})):[]}},{key:"getSuffix",value:function(e,t){var i=this,n=this.getRule(e);if(n){var r=n.noAbs?n.plurals(t):n.plurals(Math.abs(t)),o=n.numbers[r];this.options.simplifyPluralSuffix&&2===n.numbers.length&&1===n.numbers[0]&&(2===o?o="plural":1===o&&(o=""));var s=function(){return i.options.prepend&&o.toString()?i.options.prepend+o.toString():o.toString()};return"v1"===this.options.compatibilityJSON?1===o?"":"number"==typeof o?"_plural_".concat(o.toString()):s():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===n.numbers.length&&1===n.numbers[0]?s():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}return this.logger.warn("no plural rule found for: ".concat(e)),""}}]),e}(),ss=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};To(this,e),this.logger=Uo.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return Io(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:Xo,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?qo(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?qo(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?qo(t.nestingPrefix):t.nestingPrefixEscaped||qo("$t("),this.nestingSuffix=t.nestingSuffix?qo(t.nestingSuffix):t.nestingSuffixEscaped||qo(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var i="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(i,"g")}},{key:"interpolate",value:function(e,t,i,n){var r,o,s,a=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function c(e){return e.replace(/\$/g,"$$$$")}var u=function(e){if(e.indexOf(a.formatSeparator)<0){var r=Wo(t,l,e);return a.alwaysFormat?a.format(r,void 0,i,Co({},n,t,{interpolationkey:e})):r}var o=e.split(a.formatSeparator),s=o.shift().trim(),c=o.join(a.formatSeparator).trim();return a.format(Wo(t,l,s),c,i,Co({},n,t,{interpolationkey:s}))};this.resetRegExp();var h=n&&n.missingInterpolationHandler||this.options.missingInterpolationHandler,d=n&&n.interpolation&&n.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return c(e)}},{regex:this.regexp,safeValue:function(e){return a.escapeValue?c(a.escape(e)):c(e)}}].forEach((function(t){for(s=0;r=t.regex.exec(e);){if(void 0===(o=u(r[1].trim())))if("function"==typeof h){var i=h(e,r,n);o="string"==typeof i?i:""}else{if(d){o=r[0];continue}a.logger.warn("missed to pass in variable ".concat(r[1]," for interpolating ").concat(e)),o=""}else"string"==typeof o||a.useRawValueToEscape||(o=Vo(o));var l=t.safeValue(o);if(e=e.replace(r[0],l),d?(t.regex.lastIndex+=l.length,t.regex.lastIndex-=r[0].length):t.regex.lastIndex=0,++s>=a.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var i,n,r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=Co({},o);function a(e,t){var i=this.nestingOptionsSeparator;if(e.indexOf(i)<0)return e;var n=e.split(new RegExp("".concat(i,"[ ]*{"))),r="{".concat(n[1]);e=n[0],r=(r=this.interpolate(r,s)).replace(/'/g,'"');try{s=JSON.parse(r),t&&(s=Co({},t,s))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(i).concat(r)}return delete s.defaultValue,e}for(s.applyPostProcessor=!1,delete s.defaultValue;i=this.nestingRegexp.exec(e);){var l=[],c=!1;if(-1!==i[0].indexOf(this.formatSeparator)&&!/{.*}/.test(i[1])){var u=i[1].split(this.formatSeparator).map((function(e){return e.trim()}));i[1]=u.shift(),l=u,c=!0}if((n=t(a.call(this,i[1].trim(),s),s))&&i[0]===e&&"string"!=typeof n)return n;"string"!=typeof n&&(n=Vo(n)),n||(this.logger.warn("missed to resolve ".concat(i[1]," for nesting ").concat(e)),n=""),c&&(n=l.reduce((function(e,t){return r.format(e,t,o.lng,Co({},o,{interpolationkey:i[1].trim()}))}),n.trim())),e=e.replace(i[0],n),this.regexp.lastIndex=0}return e}}]),e}();var as=function(e){function t(e,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return To(this,t),r=Lo(this,Ro(t).call(this)),Yo&&ko.call(Po(r)),r.backend=e,r.store=i,r.services=n,r.languageUtils=n.languageUtils,r.options=o,r.logger=Uo.create("backendConnector"),r.state={},r.queue=[],r.backend&&r.backend.init&&r.backend.init(n,o.backend,o),r}return Oo(t,e),Io(t,[{key:"queueLoad",value:function(e,t,i,n){var r=this,o=[],s=[],a=[],l=[];return e.forEach((function(e){var n=!0;t.forEach((function(t){var a="".concat(e,"|").concat(t);!i.reload&&r.store.hasResourceBundle(e,t)?r.state[a]=2:r.state[a]<0||(1===r.state[a]?s.indexOf(a)<0&&s.push(a):(r.state[a]=1,n=!1,s.indexOf(a)<0&&s.push(a),o.indexOf(a)<0&&o.push(a),l.indexOf(t)<0&&l.push(t)))})),n||a.push(e)})),(o.length||s.length)&&this.queue.push({pending:s,loaded:{},errors:[],callback:n}),{toLoad:o,pending:s,toLoadLanguages:a,toLoadNamespaces:l}}},{key:"loaded",value:function(e,t,i){var n=e.split("|"),r=n[0],o=n[1];t&&this.emit("failedLoading",r,o,t),i&&this.store.addResourceBundle(r,o,i),this.state[e]=t?-1:2;var s={};this.queue.forEach((function(i){var n,a,l,c,u,h;n=i.loaded,a=o,c=Go(n,[r],Object),u=c.obj,h=c.k,u[h]=u[h]||[],l&&(u[h]=u[h].concat(a)),l||u[h].push(a),function(e,t){for(var i=e.indexOf(t);-1!==i;)e.splice(i,1),i=e.indexOf(t)}(i.pending,e),t&&i.errors.push(t),0!==i.pending.length||i.done||(Object.keys(i.loaded).forEach((function(e){s[e]||(s[e]=[]),i.loaded[e].length&&i.loaded[e].forEach((function(t){s[e].indexOf(t)<0&&s[e].push(t)}))})),i.done=!0,i.errors.length?i.callback(i.errors):i.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,i){var n=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:350,s=arguments.length>5?arguments[5]:void 0;return e.length?this.backend[i](e,t,(function(a,l){a&&l&&r<5?setTimeout((function(){n.read.call(n,e,t,i,r+1,2*o,s)}),o):s(a,l)})):s(null,{})}},{key:"prepareLoading",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var o=this.queueLoad(e,t,n,r);if(!o.toLoad.length)return o.pending.length||r(),null;o.toLoad.forEach((function(e){i.loadOne(e)}))}},{key:"load",value:function(e,t,i){this.prepareLoading(e,t,{},i)}},{key:"reload",value:function(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}},{key:"loadOne",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.split("|"),r=n[0],o=n[1];this.read(r,o,"read",void 0,void 0,(function(n,s){n&&t.logger.warn("".concat(i,"loading namespace ").concat(o," for language ").concat(r," failed"),n),!n&&s&&t.logger.log("".concat(i,"loaded namespace ").concat(o," for language ").concat(r),s),t.loaded(e,n,s)}))}},{key:"saveMissing",value:function(e,t,i,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(i,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=i&&""!==i&&(this.backend&&this.backend.create&&this.backend.create(e,t,i,n,null,Co({},o,{isUpdate:r})),e&&e[0]&&this.store.addResource(e[0],t,i,n))}}]),t}(ko);function ls(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&(e.whitelist&&e.whitelist.indexOf("cimode")<0&&(e.whitelist=e.whitelist.concat(["cimode"])),e.supportedLngs=e.whitelist),e.nonExplicitWhitelist&&(e.nonExplicitSupportedLngs=e.nonExplicitWhitelist),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function cs(){}var us=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(To(this,t),e=Lo(this,Ro(t).call(this)),Yo&&ko.call(Po(e)),e.options=ls(i),e.services={},e.logger=Uo,e.modules={external:[]},n&&!e.isInitialized&&!i.isClone){if(!e.options.initImmediate)return e.init(i,n),Lo(e,Po(e));setTimeout((function(){e.init(i,n)}),0)}return e}return Oo(t,e),Io(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;function n(e){return e?"function"==typeof e?new e:e:null}if("function"==typeof t&&(i=t,t={}),t.whitelist&&!t.supportedLngs&&this.logger.deprecate("whitelist",'option "whitelist" will be renamed to "supportedLngs" in the next major - please make sure to rename this option asap.'),t.nonExplicitWhitelist&&!t.nonExplicitSupportedLngs&&this.logger.deprecate("whitelist",'options "nonExplicitWhitelist" will be renamed to "nonExplicitSupportedLngs" in the next major - please make sure to rename this option asap.'),this.options=Co({},{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===So(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===So(e[2])||"object"===So(e[3])){var i=e[3]||e[2];Object.keys(i).forEach((function(e){t[e]=i[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,i,n){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!1}},this.options,ls(t)),this.format=this.options.interpolation.format,i||(i=cs),!this.options.isClone){this.modules.logger?Uo.init(n(this.modules.logger),this.options):Uo.init(null,this.options);var r=new is(this.options);this.store=new Zo(this.options.resources,this.options);var o=this.services;o.logger=Uo,o.resourceStore=this.store,o.languageUtils=r,o.pluralResolver=new os(r,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),o.interpolator=new ss(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new as(n(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",(function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e.emit.apply(e,[t].concat(n))})),this.modules.languageDetector&&(o.languageDetector=n(this.modules.languageDetector),o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=n(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new es(this.services,this.options),this.translator.on("*",(function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e.emit.apply(e,[t].concat(n))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var s=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);s.length>0&&"dev"!==s[0]&&(this.options.lng=s[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var i;return(i=e.store)[t].apply(i,arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var i;return(i=e.store)[t].apply(i,arguments),e}}));var a=Fo(),l=function(){var t=function(t,n){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),a.resolve(n),i(t,n)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?l():setTimeout(l,0),a}},{key:"loadResources",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cs,n="string"==typeof e?e:this.language;if("function"==typeof e&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(n&&"cimode"===n.toLowerCase())return i();var r=[],o=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){r.indexOf(e)<0&&r.push(e)}))};if(n)o(n);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return o(e)}));this.options.preload&&this.options.preload.forEach((function(e){return o(e)})),this.services.backendConnector.load(r,this.options.ns,i)}else i(null)}},{key:"reloadResources",value:function(e,t,i){var n=Fo();return e||(e=this.languages),t||(t=this.options.ns),i||(i=cs),this.services.backendConnector.reload(e,t,(function(e){n.resolve(),i(e)})),n}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&$o.addPostProcessor(e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"changeLanguage",value:function(e,t){var i=this;this.isLanguageChangingTo=e;var n=Fo();this.emit("languageChanging",e);var r=function(r){e||r||!i.services.languageDetector||(r=[]);var o="string"==typeof r?r:i.services.languageUtils.getBestMatchFromCodes(r);o&&(i.language||(i.language=o,i.languages=i.services.languageUtils.toResolveHierarchy(o)),i.translator.language||i.translator.changeLanguage(o),i.services.languageDetector&&i.services.languageDetector.cacheUserLanguage(o)),i.loadResources(o,(function(e){!function(e,r){r?(i.language=r,i.languages=i.services.languageUtils.toResolveHierarchy(r),i.translator.changeLanguage(r),i.isLanguageChangingTo=void 0,i.emit("languageChanged",r),i.logger.log("languageChanged",r)):i.isLanguageChangingTo=void 0,n.resolve((function(){return i.t.apply(i,arguments)})),t&&t(e,(function(){return i.t.apply(i,arguments)}))}(e,o)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(r):r(e):r(this.services.languageDetector.detect()),n}},{key:"getFixedT",value:function(e,t,i){var n=this,r=function e(t,r){var o;if("object"!==So(r)){for(var s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];o=n.options.overloadTranslationOptionHandler([t,r].concat(a))}else o=Co({},r);o.lng=o.lng||e.lng,o.lngs=o.lngs||e.lngs,o.ns=o.ns||e.ns;var c=n.options.keySeparator||".",u=i?"".concat(i).concat(c).concat(t):t;return n.t(u,o)};return"string"==typeof e?r.lng=e:r.lngs=e,r.ns=t,r.keyPrefix=i,r}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var n=this.languages[0],r=!!this.options&&this.options.fallbackLng,o=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;var s=function(e,i){var n=t.services.backendConnector.state["".concat(e,"|").concat(i)];return-1===n||2===n};if(i.precheck){var a=i.precheck(this,s);if(void 0!==a)return a}return!!this.hasResourceBundle(n,e)||(!this.services.backendConnector.backend||!(!s(n,e)||r&&!s(o,e)))}},{key:"loadNamespaces",value:function(e,t){var i=this,n=Fo();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){i.options.ns.indexOf(e)<0&&i.options.ns.push(e)})),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var i=Fo();"string"==typeof e&&(e=[e]);var n=this.options.preload||[],r=e.filter((function(e){return n.indexOf(e)<0}));return r.length?(this.options.preload=n.concat(r),this.loadResources((function(e){i.resolve(),t&&t(e)})),i):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.languages&&this.languages.length>0?this.languages[0]:this.language),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr"}},{key:"createInstance",value:function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}},{key:"cloneInstance",value:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cs,r=Co({},this.options,i,{isClone:!0}),o=new t(r);return["store","services","language"].forEach((function(t){o[t]=e[t]})),o.services=Co({},this.services),o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o.translator=new es(o.services,o.options),o.translator.on("*",(function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];o.emit.apply(o,[e].concat(i))})),o.init(r,n),o.translator.options=o.options,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages}}}]),t}(ko);const hs=new us,ds=[{name:"File units",type:""},{name:"Millimeters",type:"mm",matches:["millimeter","millimeters"]},{name:"Centimeters",type:"cm",matches:["centimeter","centimeters"]},{name:"Meters",type:"m"},{name:"Inches",type:"in",matches:["inch","inches"]},{name:"Feet",type:"ft",matches:["foot"]},{name:"Feet and fractional inches",type:"ft-and-fractional-in"},{name:"Feet and decimal inches",type:"ft-and-decimal-in"},{name:"Decimal inches",type:"decimal-in"},{name:"Decimal feet",type:"decimal-ft"},{name:"Fractional inches",type:"fractional-in"},{name:"Meters and centimeters",type:"m-and-cm"},{name:"Points",type:"pt",matches:["point","points"]}],fs=[{name:"File precision",value:""},{name:"0 (1)",value:0},{name:"0.1 (1/2)",value:1},{name:"0.01 (1/4)",value:2},{name:"0.001 (1/8)",value:3},{name:"0.0001 (1/16)",value:4},{name:"0.00001 (1/32)",value:5},{name:"0.000001 (1/64)",value:6}],ps=ds.map((e=>e.name)),ms=ds.map((e=>e.type)),gs=fs.map((e=>e.name)),vs=fs.map((e=>e.value));ds.forEach((e=>{if(e.matches){const t=e.matches.map((e=>hs.t(e)));e.matches=e.matches.concat(t)}}));const ys=new Set(ms);function bs(e){if(e=e&&e.toLocaleLowerCase(),ys.has(e))return e;for(let t in ds){const i=ds[t],n=i.matches;if(n&&n.indexOf(e)>-1)return i.type}return null}class xs{constructor(e,t){if(!Array.isArray(e)||0===e.length)throw new Error(`Invalid ${e}`);this.values=new Set(e),this.current=e.includes(t)?t:e[0]}get value(){return this.current}set value(e){this.values.has(e)&&(this.current=e)}clone(){return xs.deSerialize(JSON.parse(this.toString()))}toString(){return JSON.stringify({type:"__enum",values:Array.from(this.values),current:this.current})}static deSerialize(e){if("__enum"===e.type)return new xs(e.values,e.current)}}const _s={};_s[Mn.AMBIENT_SHADOWS]=!0,_s[Mn.ANTIALIASING]=!F(),_s[Mn.GROUND_SHADOW]=!0,_s[Mn.GROUND_REFLECTION]=!1,_s[Mn.GHOSTING]=!0,_s[Mn.VIEW_CUBE]=!F(),_s[Mn.VIEW_CUBE_COMPASS]=!1,_s[Mn.VIEW_TYPE]=Ln.DEFAULT,_s[Mn.LINE_RENDERING]=!0,_s[Mn.LIGHT_PRESET]=mo,_s[Mn.EDGE_RENDERING]=!1,_s[Mn.REVERSE_HORIZONTAL_LOOK_DIRECTION]=!1,_s[Mn.REVERSE_VERTICAL_LOOK_DIRECTION]=!1,_s[Mn.ALWAYS_USE_PIVOT]=!1,_s[Mn.ZOOM_TOWARDS_PIVOT]=!1,_s[Mn.ORBIT_PAST_WORLD_POLES]=!0,_s[Mn.CLICK_TO_SET_COI]=!1,_s[Mn.OPTIMIZE_NAVIGATION]=F(),_s[Mn.ENV_MAP_BACKGROUND]=!1,_s[Mn.FIRST_PERSON_TOOL_POPUP]=!0,_s[Mn.BIM_WALK_TOOL_POPUP]=!0,_s[Mn.BIM_WALK_NAVIGATOR_TYPE]="default",_s[Mn.BIM_WALK_GRAVITY]=!0,_s[Mn.DEFAULT_NAVIGATION_TOOL_3D]="default",_s[Mn.SELECTION_MODE]=po.LEAF_OBJECT,_s[Mn.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR]=!0,_s[Mn.EXPLODE_STRATEGY]="hierarchy",_s[Mn.SELECTION_SETS_PIVOT]=!1,_s[Mn.FORCE_DOUBLE_SIDED]=!1,_s[Mn.DISPLAY_SECTION_HATCHES]=!0,_s[Mn.LARGE_MODEL_EXPERIENCE]=!1,_s[In.GRAYSCALE]=!1,_s[In.SWAP_BLACK_AND_WHITE]=!1,_s[In.LOADING_ANIMATION]=!1,_s[In.FORCE_PDF_CALIBRATION]=!1,_s[In.FORCE_LEAFLET_CALIBRATION]=!0,_s[In.DISABLE_PDF_HIGHLIGHT]=!1,_s[In.USE_PDF_VIEWPORT_INFO]=!1,_s[In.VECTOR_VIEWING]=!0,_s[Pn.WEBGPU]=!1,_s[Pn.PROGRESSIVE_RENDERING]=!0,_s[Pn.OPEN_PROPERTIES_ON_SELECT]=!1,_s[Pn.POINT_RENDERING]=!0,_s[Pn.BACKGROUND_COLOR_PRESET]=null,_s[Pn.REVERSE_MOUSE_ZOOM_DIR]=!1,_s[Pn.LEFT_HANDED_MOUSE_SETUP]=!1,_s[Pn.FUSION_ORBIT]=!0,_s[Pn.FUSION_ORBIT_CONSTRAINED]=!0,_s[Pn.WHEEL_SETS_PIVOT]=!1,_s[Pn.RESTORE_SESSION_MEASUREMENTS]=!0,_s[Pn.DISPLAY_UNITS]=new xs(ms),_s[Pn.DISPLAY_UNITS_PRECISION]=new xs(vs),_s[Pn.KEY_MAP_CMD]=!0;const Es=_s,Ss={name:"Default",label:"Manufacturing (Default)",description:"Default Viewer settings"};Ss.settings=_s,Ss.persistent=[Mn.ALWAYS_USE_PIVOT,Mn.ZOOM_TOWARDS_PIVOT,Mn.REVERSE_HORIZONTAL_LOOK_DIRECTION,Mn.REVERSE_VERTICAL_LOOK_DIRECTION,Mn.ORBIT_PAST_WORLD_POLES,Mn.CLICK_TO_SET_COI,Mn.GHOSTING,Mn.OPTIMIZE_NAVIGATION,Mn.AMBIENT_SHADOWS,Mn.ANTIALIASING,Mn.GROUND_SHADOW,Mn.GROUND_REFLECTION,Mn.FIRST_PERSON_TOOL_POPUP,Mn.BIM_WALK_TOOL_POPUP,Mn.BIM_WALK_GRAVITY,Mn.VIEW_TYPE,Mn.SELECTION_MODE,In.SWAP_BLACK_AND_WHITE,In.VECTOR_VIEWING,In.LOADING_ANIMATION,Pn.OPEN_PROPERTIES_ON_SELECT,Pn.REVERSE_MOUSE_ZOOM_DIR,Pn.LEFT_HANDED_MOUSE_SETUP,Pn.WHEEL_SETS_PIVOT,Pn.KEY_MAP_CMD,Pn.DISPLAY_UNITS,Pn.DISPLAY_UNITS_PRECISION],Ss.sharedStorage=[Mn.LARGE_MODEL_EXPERIENCE,Pn.WEBGPU],Ss.extensions={load:[],unload:[]};const As=Ts(Ss);As.name="AEC",As.label="Construction (AEC)",As.description="A common set of preferences designed for the Construction industry",As.settings[Pn.REVERSE_MOUSE_ZOOM_DIR]=!0,As.settings[In.VECTOR_VIEWING]=!0,As.settings[Mn.EDGE_RENDERING]=!F(),As.settings[Mn.LIGHT_PRESET]=c().DefaultLightPresetAec||"Boardwalk",As.settings[Mn.ENV_MAP_BACKGROUND]=!0,As.settings[Mn.VIEW_CUBE_COMPASS]=!0,As.settings[Mn.SELECTION_SETS_PIVOT]=!0,As.extensions={load:[],unload:[]};const ws=Ts(As);ws.name="Fluent",ws.label="Design Collaboration",ws.description="User experience that matches Design Collaboration",ws.settings[Pn.WHEEL_SETS_PIVOT]=!0,ws.settings[Pn.RESTORE_SESSION_MEASUREMENTS]=!1,ws.settings[In.FORCE_PDF_CALIBRATION]=!0,ws.settings[Mn.ALWAYS_USE_PIVOT]=!0,ws.settings[Mn.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR]=!1,ws.extensions={load:[],unload:[]},ws.persistent.splice(ws.persistent.indexOf(Mn.VIEW_TYPE),1);const Cs=Ts(As);function Ts(e){var t,i;e||(rt.log("ProfileSettings.clone: missing profileSettings, using DefaultProfileSettings..."),e=Ss);const n={};return n.settings=Object.assign({},e.settings),n.extensions={},Object.prototype.hasOwnProperty.call(e,"extensions")?(n.extensions.load=Object.prototype.hasOwnProperty.call(e.extensions,"load")?e.extensions.load.slice():[],n.extensions.unload=Object.prototype.hasOwnProperty.call(e.extensions,"unload")?e.extensions.unload.slice():[]):n.extensions={load:[],unload:[]},n.persistent=e.persistent.slice(),n.sharedStorage=null===(t=e.sharedStorage)||void 0===t?void 0:t.slice(),null===(i=e.sharedStorage)||void 0===i||i.forEach((e=>{delete n.settings[e]})),n}Cs.name="Navis",Cs.label="Navisworks",Cs.description="Provides a user experience similar to Autodesk Navisworks desktop application",Cs.settings[Mn.BIM_WALK_TOOL_POPUP]=!1,Cs.settings[Mn.BIM_WALK_NAVIGATOR_TYPE]="aec",Cs.settings[Mn.DEFAULT_NAVIGATION_TOOL_3D]="extractor_defined";const Ms={Default:Ss,AEC:As,Fluent:ws,Navis:Cs,clone:Ts};var Is,Ps=c();function Ls(){this.isSupported()||(this._data={})}Ls.prototype.getItem=function(e){return this.isSupported()?Ps.localStorage.getItem(e):Object.prototype.hasOwnProperty.call(this._data,e)?this._data[e]:null},Ls.prototype.setItem=function(e,t){if(this.isSupported())try{Ps.localStorage.setItem(e,t)}catch(e){rt.debug("avp.LocalStorage: Failed to setItem()")}else this._data[e]=String(t)},Ls.prototype.removeItem=function(e){this.isSupported()?Ps.localStorage.removeItem(e):delete this._data[e]},Ls.prototype.clear=function(){this.isSupported()?Ps.localStorage.clear():this._data={}},Ls.prototype.isSupported=function(){return void 0===Is&&(Is=(()=>{if("undefined"==typeof window)return!1;try{const e="lmv_viewer_test_localStorage",t=Ps.localStorage;return!!t&&(t.setItem(e,"1"),t.removeItem(e),!0)}catch(e){return!1}})()),Is},Ls.prototype.getAllKeys=function(){return Is?Object.keys(Ps.localStorage):Object.keys(this._data)};const Rs=new Ls;class Ds{constructor(e){this.options={},this.storageCache={},"string"==typeof e&&(this.options={prefix:e}),this.options={...e},this.options.prefix||(this.options.prefix="Autodesk.Viewing.Preferences."),Object.prototype.hasOwnProperty.call(this.options,"localStorage")||(this.options.localStorage=!0),this.defaults={},this.callbacks={},this.tags={},this.useLocalStorage=this.options.localStorage&&Rs.isSupported();return new Proxy(this,{get:function(e,t){return t in e?e[t]:e.storageCache[t]}})}setWebStorageKey(e){this.storageKey=e}_getPrefixedStorageKey(e,t){return t??this.hasTag(e,"shared-storage")?"___Shared":this.getLocalStoragePrefix()+this.storageKey}webStorage(e,t,i){if(this.useLocalStorage){if(this.hasTag(e,"no-storage"))return;const n=this._getPrefixedStorageKey(e,i);let r=Rs.getItem(n);if(r=JSON.parse(r||"{}"),void 0!==t)t instanceof xs&&(t=t.toString()),r[e]=t,Rs.setItem(n,JSON.stringify(r));else if(void 0!==(t=r[e]))try{"__enum"===(t=JSON.parse(t)).type&&(t=xs.deSerialize(t))}catch(e){rt.log("Preferences: Cannot deserialize value ="+t),t=void 0}return t}}getPrefFromLocalStorage(e){return this.webStorage(e)}setPrefInLocalStorage(e,t){return this.webStorage(e,t)}addPref(e,t,i){if("string"!=typeof e||"function"==typeof this.storageCache[e])return void rt.log("Preferences: invalid name="+e);t instanceof xs&&(t=t.clone()),this.tags[e]={},i&&(this.tags[e]["shared-storage"]=!0);const n=this.webStorage(e);this.storageCache[e]=void 0!==n?n:t}load(e){for(var t in this.defaults=e,this.defaults)Object.prototype.hasOwnProperty.call(this.defaults,t)&&this.addPref(t,this.defaults[t])}addTags(e,t){if(!t||!e)return!1;t=Array.isArray(t)?t:[t];for(var i=0;i<t.length;++i)this.tag(t[i],e);return!0}tag(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(this.defaults);for(var i=0;i<t.length;++i)this.tags[t[i]]&&(this.tags[t[i]][e]=!0)}}untag(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(this.defaults);for(var i=0;i<t.length;++i)this.tags[t[i]]&&(this.tags[t[i]][e]=!1)}}hasTag(e,t){var i=this.tags[e];return!!i&&!0===i[t]}add(e,t,i,n){return!Object.prototype.hasOwnProperty.call(this.defaults,e)||n?(this.setDefault(e,t),this.addPref(e,t,null==i?void 0:i.includes("shared-storage")),this.addTags(e,i),n&&this.dispatchEvent(e,Dr),!0):(rt.log("Preferences: "+e+" already exists"),!1)}setDefault(e,t){e&&null!=t&&(this.defaults[e]=t instanceof xs?t.clone():t)}remove(e,t){return!!Object.prototype.hasOwnProperty.call(this.defaults,e)&&(delete this.defaults[e],delete this.tags[e],this.storageCache&&delete this.storageCache[e],t&&this.deleteFromWebStorage(e),!0)}deleteFromWebStorage(e){if(this.useLocalStorage){const t=this._getPrefixedStorageKey(e);let i=Rs.getItem(t);i=JSON.parse(i||"{}"),delete i[e],Rs.setItem(t,JSON.stringify(i))}}clearWebStorage(){const e=this.getLocalStoragePrefix();if(this.useLocalStorage)for(let t of Rs.getAllKeys())-1!==t.indexOf(e)&&Rs.removeItem(t)}reset(e,t){for(var i in e&&void 0===t&&(t=!0),this.defaults)if(Object.prototype.hasOwnProperty.call(this.defaults,i)){if(e){var n=!!this.tags[i][e];if(t&&!n||!t&&n)continue}this.set(i,this.defaults[i],!1)&&this.dispatchEvent(i,Or),this.deleteFromWebStorage(i)}}getLocalStoragePrefix(){return this.options.prefix}get(e){return this.storageCache[e]instanceof xs?this.storageCache[e].value:this.storageCache[e]}set(e,t,i){const n=t instanceof xs?t.value:t;function r(e,t){const i=e=>"object"==typeof e?JSON.stringify(e):e;return i(e)===i(t)}if(!r(this.get(e),n)){this.storageCache[e]instanceof xs?this.storageCache[e].value=n:this.storageCache[e]=t instanceof xs?t.clone():n;const o=this.defaults[e]instanceof xs?this.defaults[e].value:this.defaults[e];return r(this.get(e),o)&&e!==Mn.SELECTION_MODE?this.deleteFromWebStorage(e):this.webStorage(e,this.storageCache[e]),(void 0===i||i)&&this.dispatchEvent(e,Dr),!0}return!1}dispatchEvent(e,t){}addListeners(e,t,i){this.callbacks[e]||(this.callbacks[e]=[]),i||(i=t),this.callbacks[e].push({changed:t,reset:i})}removeListeners(e,t,i){if(void 0!==this.callbacks[e])if(t||i){i||(i=t);for(let n=0;n<this.callbacks[e].length;++n)if(this.callbacks[e][n].changed===t&&this.callbacks[e][n].reset===i){this.callbacks[e].splice(n,1);break}}else delete this.callbacks[e]}clearListeners(){this.callbacks={}}setUseLocalStorage(e){this.useLocalStorage=!!e}}function Os(e){if(!e)return;const t=Autodesk.Viewing,i=t.ProfileSettings.Default;let n=[];if(this.name=Object.prototype.hasOwnProperty.call(e,"name")?e.name:"Custom",this.label=e.label,this.description=e.description,this.storageVersion="2.0",this.persistent=Array.isArray(e.persistent)?e.persistent:i.persistent,this.sharedStorage=Array.isArray(e.sharedStorage)?e.sharedStorage:i.sharedStorage,this.settings=Object.assign({},i.settings),Object.prototype.hasOwnProperty.call(e,"settings")){const t=e.settings;n=Object.keys(t),this.settings=Object.assign(this.settings,t)}let r=[],o=[];if(Object.prototype.hasOwnProperty.call(e,"extensions")){const t=e.extensions.load,i=e.extensions.unload;r=t?t.slice():r,o=i?i.slice():o}this.extensions={load:r,unload:o},this.apply=function(e){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return!1;const r=e.getLocalStoragePrefix()+"StorageVersion",o="Autodesk.Viewing.ProfileName";!e.useLocalStorage||Rs.getItem(r)||!Rs.getItem(o)||(()=>{const t={},i=Rs.getItem(o),n=e.getLocalStoragePrefix();for(let e of Rs.getAllKeys())if(-1!==e.indexOf(n))try{t[e.split(".").pop()]=JSON.parse(Rs.getItem(e)),Rs.removeItem(e)}catch{console.log(`Cound't convert preference to new format: ${e}`)}Rs.setItem(n+i,JSON.stringify(t)),Rs.removeItem(o)})();const s=e.getLocalStoragePrefix()+"StorageVersion";Rs.setItem(s,this.storageVersion);const a=e.getLocalStoragePrefix()+"CurrentProfile";Rs.setItem(a,this.name),e.setWebStorageKey(this.name);const l=this.settings,c=[t.ProfileSettings.Default.name,t.ProfileSettings.AEC.name],u=Object.values(Mn),h=Object.values(In);for(let t in l)if(Object.prototype.hasOwnProperty.call(l,t)){var d,f,p;const r=l[t],o=-1!==n.indexOf(t)&&-1===c.indexOf(this.name)?["ignore-producer"]:[];-1!==u.indexOf(t)?o.push("3d"):-1!==h.indexOf(t)?o.push("2d"):(o.push("2d"),o.push("3d"));let s=(null===(d=this.sharedStorage)||void 0===d||null===(f=(p=d).indexOf)||void 0===f?void 0:f.call(p,t))>=0;s&&o.push("shared-storage"),-1!==this.persistent.indexOf(t)||s||o.push("no-storage");const a=e.webStorage(t,void 0,s),m=e.get(t);if(void 0!==a){a!=m&&(e.add(t,a,o,!0),e.setDefault(t,r));continue}if(void 0!==m){e.addTags(t,o),m!==r&&i&&e.set(t,r);continue}e.add(t,r,o,!0)}return!0}}fo.call(Ds.prototype);class Bs{static#i=new Map;static#n=null;static _add(e,t){this.#n?console.warn("Feature flags cannot be added after initialization."):this.#i.has(e)?console.warn(`Feature flag '${e}' already exists.`):this.#i.set(e,{value:t,initializationCB:void 0,changeListener:void 0})}static _registerInitializationCallback(e,t){const i=this.#i.get(e);void 0!==i?i.initializationCB=t:console.warn(`Feature flag '${e}' not found; callback registration is skipped.`)}static _registerChangeListener(e,t){const i=this.#i.get(e);void 0!==i?i.changeListener=t:console.warn(`Feature flag '${e}' not found; callback registration is skipped.`)}static set(e,t){const i=this.#i.get(e);if(this.#n)console.warn(`Feature flag '${e}' is immutable and cannot be modified after initialization.`);else if(void 0===i)console.warn(`Feature flag '${e}' not found; modification is skipped.`);else{const e=i.value!==t;i.value!==t&&(i.value=t),void 0!==i.changeListener&&e&&i.changeListener(i.value)}}static isEnabled(e){const t=this.#i.get(e);return null==t?void 0:t.value}static _setInitializationData(e,t){const i=this.#i.get(e);void 0!==i?this.#n?console.warn(`Feature flag '${e}' has already been initialized. Ignoring initialization data.`):i.initializationData=t:console.warn(`Feature flag '${e}' not found; modification is skipped.`)}static _getInitializationData(e){const t=this.#i.get(e);if(void 0!==t)return t.initializationData;console.warn(`Feature flag '${e}' not found; returning undefined.`)}static async _initialize(){if(this.#n)return this.#n;const e=new Os(Autodesk.Viewing.ProfileSettings.Default),t=new Ds;e.apply(t);const i=new Array;for(const[,e]of this.#i){Object.freeze(e);const n=e.initializationCB;n&&i.push(n(e.value,{preferences:t,customInitializationData:e.initializationData}))}return this.#n=Promise.all(i),this.#n}static print(){console.log("Feature Flags:"+(0===this.#i.size?" none":""));for(const[e,{value:t}]of this.#i)Object.values(Us).includes(e)||console.log(`  - ${e}: ${t}`)}}const Ns=Object.freeze({LargeModelExperience:"LARGE_MODEL_EXPERIENCE",LargeModelExperienceOptOut:"HIDE_LARGE_MODEL_EXPERIENCE",EnableSpotMeasurement:"ENABLE_LOCATION_MEASUREMENT"});Bs._add(Ns.LargeModelExperience,!1),Bs._registerInitializationCallback(Ns.LargeModelExperience,((e,t)=>{var i;if(Bs.isEnabled(Ns.LargeModelExperienceOptOut))return;const n=t.preferences.getPrefFromLocalStorage(Mn.LARGE_MODEL_EXPERIENCE);let r=(null===(i=t.customInitializationData)||void 0===i?void 0:i.overridePreferenceValue)??n??e;return void 0!==n&&e===n&&t.preferences.deleteFromWebStorage(Mn.LARGE_MODEL_EXPERIENCE),Autodesk.Viewing.DefaultSettings[Mn.LARGE_MODEL_EXPERIENCE]=e,r?Autodesk.Viewing.Private.useHLOD():void 0})),Bs._add(Ns.LargeModelExperienceOptOut,!1),Bs._add(Ns.EnableSpotMeasurement,!1);const Us=Object.freeze({OutOfCoreGpuMemoryManagement:"OUT_OF_CORE_GPU_MEMORY_MANAGEMENT",WebGLUBOs:"WEBGL_UBOS",WebGPUBackend:"ENABLE_WEBGPU"}),ks=(e,t)=>{let{preferences:i,customInitializationData:n}=t;const r=null==n?void 0:n.overridePreferenceValue;return e&&(r??i.get(Pn.WEBGPU))};Bs._add(Us.WebGPUBackend,!1),Bs._registerInitializationCallback(Us.WebGPUBackend,(async(e,t)=>{if(ks(e,t))return await Autodesk.Viewing.Private.useWebGPU()})),Bs._add(Us.OutOfCoreGpuMemoryManagement,!0),Bs._registerInitializationCallback(Us.OutOfCoreGpuMemoryManagement,((e,t)=>{const i=Bs.isEnabled(Us.WebGPUBackend);if(i&&!an){const e=t.preferences,n=Bs._getInitializationData(Us.WebGPUBackend);if(ks(i,{preferences:e,customInitializationData:n}))return}e&&Autodesk.Viewing.Private.USE_HLOD&&Autodesk.Viewing.Private.enableOutOfCoreTileManager()})),Bs._add(Us.WebGLUBOs,!1),Bs._registerInitializationCallback(Us.WebGLUBOs,(async(e,t)=>{var i;if((null===(i=t.customInitializationData)||void 0===i?void 0:i.overridePreferenceValue)??e)return Autodesk.Viewing.Private.enableUBOs()}));var Fs=c();const Vs=Fs;var Gs={accessToken:null,getAccessToken:null,tokenRefreshInterval:null};let zs=Gs,Hs=null;function Ws(){return Hs}var js={local:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},qs="",Ks="";if(c().location){var Xs=c().location;Ks=Xs.protocol+"//"+Xs.hostname,qs=Xs.protocol+"//"+Xs.host}var Ys={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},Qs="https://us.otgs-dev.autodesk.com",Zs="https://us.otgs-stg.autodesk.com",$s="https://us.otgs.autodesk.com",Js="https://eu.otgs-stg.autodesk.com",ea="https://eu.otgs.autodesk.com",ta="https://cdn-dev.derivative.autodesk.com",ia="https://cdn-dev.derivative.autodesk.com/regions/eu",na="https://cdn-stg.derivative.autodesk.com",ra="https://cdn-stg.derivative.autodesk.com/regions/eu",oa="https://cdn.derivative.autodesk.com",sa="https://cdn.derivative.autodesk.com/regions/eu",aa="https://cdn-dev.derivative.autodesk.com",la="https://cdn-stg.derivative.autodesk.com",ca="https://cdn.derivative.autodesk.com",ua="https://cdn-stg-fips.derivative.autodesk.com",ha="https://cdn-fips.derivative.autodesk.com",da="https://api-stg.afg.us.autodesk.com",fa="https://api.afg.us.autodesk.com",pa={stg:"https://cdn-stg.derivative.aus.autodesk.com",prod:"https://cdn.derivative.aus.autodesk.com"},ma="derivativeV2",ga="derivativeV2_EU",va="derivativeV2_Fedramp";let ya=Object.freeze({Local:{ROOT:"",LMV:js.local},Development:{ROOT:aa,LMV:js.dev,bubbleManifest:!0},Staging:{ROOT:la,LMV:js.stg,bubbleManifest:!0},Production:{ROOT:ca,LMV:js.prod,bubbleManifest:!0},AutodeskDevelopment:{ROOT:aa,LMV:js.dev},AutodeskStaging:{ROOT:la,LMV:js.stg},AutodeskProduction:{ROOT:ca,LMV:js.prod},AutodeskDevelopment2:{ROOT:aa,LMV:js.dev,UPSTREAM:Ys.dev,UPSTREAM_API_DATA:ma},AutodeskStaging2:{ROOT:la,LMV:js.stg,UPSTREAM:Ys.stg,UPSTREAM_API_DATA:ma},AutodeskProduction2:{ROOT:ca,LMV:js.prod,UPSTREAM:Ys.prod,UPSTREAM_API_DATA:ma},FluentLocal:{ROOT:qs,LMV:qs},FluentDev:{ROOT:Qs,LMV:js.dev,UPSTREAM:Ys.stg,UPSTREAM_API_DATA:ma},FluentStaging:{ROOT:Zs,LMV:js.stg,UPSTREAM:Ys.stg,UPSTREAM_API_DATA:ma},FluentProduction:{ROOT:$s,LMV:js.prod,UPSTREAM:Ys.prod,UPSTREAM_API_DATA:ma},FluentStagingEU:{ROOT:Js,LMV:js.stg,UPSTREAM:Ys.stg,UPSTREAM_API_DATA:ga},FluentProductionEU:{ROOT:ea,LMV:js.prod,UPSTREAM:Ys.prod,UPSTREAM_API_DATA:ga},MD20DevUS:{ROOT:ta,LMV:js.dev,UPSTREAM:Ys.dev,UPSTREAM_API_DATA:ma},MD20DevEU:{ROOT:ia,LMV:js.dev,UPSTREAM:Ys.dev,UPSTREAM_API_DATA:ga},MD20StgUS:{ROOT:na,LMV:js.stg,UPSTREAM:Ys.stg,UPSTREAM_API_DATA:ma},MD20StgEU:{ROOT:ra,LMV:js.stg,UPSTREAM:Ys.stg,UPSTREAM_API_DATA:ga},MD20ProdUS:{ROOT:oa,LMV:js.prod,UPSTREAM:Ys.prod,UPSTREAM_API_DATA:ma},MD20ProdEU:{ROOT:sa,LMV:js.prod,UPSTREAM:Ys.prod,UPSTREAM_API_DATA:ga},D3SLocalUS:{ROOT:qs,LMV:qs,UPSTREAM:qs,UPSTREAM_API_DATA:ma},D3SLocalEU:{ROOT:qs,LMV:qs,UPSTREAM:qs,UPSTREAM_API_DATA:ga},Test:{ROOT:`${Ks}:3000`,LMV:js.dev},FedrampStaging2:{ROOT:ua,LMV:js.stg,UPSTREAM:da,UPSTREAM_API_DATA:va},FedrampProduction2:{ROOT:ha,LMV:js.prod,UPSTREAM:fa,UPSTREAM_API_DATA:va}});function ba(e,t){return e.endsWith("EU")?ya[e].UPSTREAM_API_DATA:t.endsWith("_EU")?ya[e].UPSTREAM_API_DATA+"_EU":t.endsWith("_APAC")?ya[e].UPSTREAM_API_DATA+"_APAC":t.endsWith("_AUS")?ya[e].UPSTREAM_API_DATA+"_AUS":ya[e].UPSTREAM_API_DATA}function xa(e){var t;if(e&&e.env&&(t=e.env),t||(t=fe("env")),Ne(e&&e.offlineResourcePrefix||""),Oe(e&&"true"===e.offline),!t)switch(Vs.location.hostname){case"developer-dev.api.autodesk.com":t="AutodeskDevelopment";break;case"developer-stg.api.autodesk.com":t="AutodeskStaging";break;case"developer.api.autodesk.com":default:t="AutodeskProduction";break;case"localhost.autodesk.com":case"":case"127.0.0.1":t="Local"}Le(t),"undefined"!=typeof window&&rt.info("Host name : "+window.location.hostname),rt.info("Environment initialized as : "+t)}function _a(e){if(e.lmvResourceRoot)Fs.LMV_RESOURCE_ROOT=e.lmvResourceRoot;else{var t,i,n=["viewer3D.js","viewer3D.min.js"];e&&Object.prototype.hasOwnProperty.call(e,"libraryName")&&n.push(e.libraryName);var r=!1;for(let e=0;e<n.length;e++){var o=le(n[e]),s=(i=o?o.src:"").indexOf(n[e]);if(s>=0){t=i.substr(0,s),(i.indexOf("&v=",s)>0||i.indexOf("?v=",s)>0)&&(r=!0);break}}if(Fs.LMV_RESOURCE_ROOT=t||Fs.LMV_RESOURCE_ROOT,r){var a=!1,l=["dev","stg","prod"];for(let e=0;e<l.length;++e){var c=Ys[l[e]];if(-1!==Fs.LMV_RESOURCE_ROOT.indexOf(c)){a=!0;break}}a&&(Fs.LMV_RESOURCE_ROOT+=Fs.LMV_VIEWER_VERSION+"/")}}}function Ea(e){var t=e.endpoint;t||(t=ya[Pe()].ROOT);var i=e.api||t.ENDPOINT_API_DERIVATIVE_SERVICE_V2;if(ke.setEndpointAndApi(t,i),void 0!==e.escapeOssObjects&&ke.setEscapeOssObjects(e.escapeOssObjects),!S())return _a(e),Promise.resolve()}function Sa(e,t,i){t=t||function(){},ei.rawGet(ke.getApiEndpoint(),null,"/auth/settoken",t,i,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0,postData:"access-token="+e})}function Aa(e){e?ke.HTTP_REQUEST_HEADERS.Authorization="Bearer "+e:delete ke.HTTP_REQUEST_HEADERS.Authorization}function wa(e,t,i){if(Gs.accessToken=e,Qe.shouldTrack&&Qe.trackClientInfo(Gs.accessToken),ke.getUseCookie()){Sa(e,t,(function(t){rt.warn("Failed to set token in cookie. Will use header instead."),ke.setUseCookie(!1),Aa(e),i&&i(t)}))}else Aa(e),t&&t()}function Ca(e,t){var i,n=t?t.shouldInitializeAuth:void 0;void 0===n&&(n="false"!==fe("auth").toLowerCase());if(n||Aa(null),"Local"==Pe()||!n)return setTimeout(e,0),void ke.setUseCredentials(void 0!==t.useCredentials&&t.useCredentials);ke.setUseCredentials(void 0===t.useCredentials||t.useCredentials),ke.setUseCookie(t.useCookie),Gs.tokenRefreshInterval&&(clearTimeout(Gs.tokenRefreshInterval),Gs.tokenRefreshInterval=null),t&&t.getAccessToken?(Gs.getAccessToken=t.getAccessToken,i=t.getAccessToken((function n(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3599;if(i=r,Gs.tokenRefreshInterval?wa(i):wa(i,e,e),"number"!=typeof o){const e=new Date(o);o=Boolean(+e)&&e.toISOString()===o?(e-Date.now())/1e3:3599}var s=o-((null==t?void 0:t.tokenExpirationBuffer)||5);s<=0&&(s=o),Gs.tokenRefreshInterval=setTimeout((function(){t.getAccessToken(n)}),1e3*s)})),"string"==typeof i&&i&&wa(i,e)):t&&t.accessToken?wa(i=t.accessToken,e):((i=fe("accessToken"))||rt.error("No access token is provided, but authorization requested. This is a problem."),wa(i,e))}function Ta(e){rt.initialize(e);var t=fe("logLevel");t&&rt.setLevel(parseInt(t))}function Ma(e){e&&"Local"===e.env||ke.getCdnRedirectUrl()&&ei.rawGet(ke.getCdnRedirectUrl(),null,null,(function(e){e&&e.length&&(ke.setCdnUrl(e),rt.info("CDN_ROOT is: "+e))}),(function(){}),{withCredentials:!1,responseType:"text"})}function Ia(e,t){if(S())return xa(e),Ea(e),Ta(e),Ma(e),void Ca(t,e);e.webGLHelpLink&&(Hs=e.webGLHelpLink),xa(e);var i=Ea(e);Ta(e),Ma(e);const n=ki(e);X(),function(e){const t=!(-1!==["Production","fluent"].indexOf(Fs.LMV_BUILD_TYPE)&&Z);(e.optOutTrackingByDefault||t)&&(Qe.shouldTrack=!1);const i=e.productId?e.productId:"Local"===Pe()?"Local":"NOT_SET";Qe.superProps={productId:i,clientId:"NOT_SET",lmvBuildType:Fs.LMV_BUILD_TYPE,lmvViewerVersion:Fs.LMV_VIEWER_VERSION}}(e),pi();const r=Bs._initialize();var o=function(e){return new Promise((t=>{Ca(t,e)}))}(e);return Promise.all([i,o,r,n]).then(t)}function Pa(){rt.shutdown(),Autodesk.Viewing.Private.shutdownPropWorker()}const La={};let Ra={registerFileLoader:function(e,t,i,n){return La[e]?La[e].loader===i&&(La[e].count++,!0):(La[e]={loader:i,extensions:t,mimeType:n,count:1},!0)},getFileLoader:function(e){return La[e]?La[e].loader:null},getFileLoaderForExtension:function(e,t){e=e?e.toLowerCase():"";const i=new Array;for(const t in La){const n=La[t];if(n)for(let t=0;t<n.extensions.length;t++)n.extensions[t].toLowerCase()===e&&i.push(n.loader)}if(0===i.length)return null;if(t&&i.length>1)for(let e of i)if(e.acceptsMimeType&&e.acceptsMimeType(t))return e;return i[0]},unregisterFileLoader:function(e){return!!La[e]&&(La[e].count--,0===La[e].count&&delete La[e],!0)}},Da=1;class Oa{static MODEL_NODE={role:"3d",type:"geometry"};static GEOMETRY_SVF_NODE={role:"graphics",mime:"application/autodesk-svf"};static SHEET_NODE={role:"2d",type:"geometry"};static LEAFLET_NODE={role:"leaflet"};static PDF_PAGE_NODE={role:"pdf-page"};static IMAGE_NODE={role:"image"};static GEOMETRY_F2D_NODE={role:"graphics",mime:"application/autodesk-f2d"};static VIEWABLE_NODE={role:"viewable"};static AEC_MODEL_DATA={role:"Autodesk.AEC.ModelData"};static MASTER_VIEW_NODE={name:"08f99ae5-b8be-4f8d-881b-128675723c10"};parent=void 0;id=void 0;data=void 0;isLeaf=!1;children=[];sharedPropertyDbPath=void 0;lodNode=void 0;lmvDocument=void 0;constructor(e,t){this.parent=t,this.id=Da++,this.data=e,this.isLeaf="geometry"===e.type&&("3d"===e.role||"2d"===e.role||"lod"===e.role),this.children=new Array;this.#r().forEach((e=>{const t=new Oa(e,this);this.children.push(t);const i="application/autodesk-db"==(n=e).mime&&n.urn?0===n.urn.indexOf("urn:adsk.objects:os.object")?n.urn.substr(0,n.urn.lastIndexOf("%2F")+3):n.urn.substr(0,n.urn.lastIndexOf("/")+1):null;var n;i&&(this.sharedPropertyDbPath=i),"lod"===e.role&&(this.lodNode=t)})),this.children.length>1&&this.children.sort(((e,t)=>Object.prototype.hasOwnProperty.call(e.data,"order")&&Object.prototype.hasOwnProperty.call(t.data,"order")?e.data.order-t.data.order:0))}#r(){return this.is3DTilesFormat()?[]:Array.isArray(this.data.children)?this.data.children:Array.isArray(this.data.derivatives)?this.data.derivatives:new Array}setDocument(e){this.lmvDocument=e}getDocument(){let e=this;for(;e.parent;)e=e.parent;return e.lmvDocument}isOtg(){return!!this._getOtgManifest()}_getOtgManifest(){if("undefined"!=typeof DISABLE_OTG&&DISABLE_OTG)return null;const e=this.findViewableParent();if(!e)return null;return e.data.otg_manifest}isSVF2(){var e,t=this._getOtgManifest();return Boolean("cacheable"===(null==t||null===(e=t.paths)||void 0===e?void 0:e.pharos_type))}getOtgGraphicsNode(){if(this.isViewPreset())return this.findParentGeom2Dor3D().getOtgGraphicsNode();const e=this._getOtgManifest();return e&&e.views&&e.views[this.guid()]}getPropertyDbManifest(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.guid();var t,i=this._getOtgManifest();if(i&&i.pdb_manifest){var n=e&&i.pdb_manifests?i.pdb_manifests.find((t=>t.views.indexOf(e)>=0))??i.pdb_manifest:i.pdb_manifest;t={propertydb:{},isOtg:!0};for(var r=0;r<n.assets.length;r++){var o,s=n.assets[r];o=s.isShared?i.paths.shared_root+n.pdb_shared_rel_path:i.paths.version_root+n.pdb_version_rel_path,t.propertydb[s.tag]=[{path:o+s.uri,isShared:s.isShared}]}this.getOtgGraphicsNode()||(t.needsDbIdRemap=!0)}else{let e=this.findPropertyDbPath();null===e&&(console.warn("Missing property database entry in manifest."),e=""),0===e.indexOf("$file$")&&(console.warn("Bubble local path given for shared property DB files. Assuming that sharedPropertyDbPath is specified correctly by loadDocumentNode()."),e="");const i=this.getDocument();i&&0===e.indexOf("urn")&&(e=i.getFullPath(e)),t={propertydb:{attrs:[{path:e+"objects_attrs.json.gz"}],values:[{path:e+"objects_vals.json.gz"}],avs:[{path:e+"objects_avs.json.gz"}],offsets:[{path:e+"objects_offs.json.gz"}],ids:[{path:e+"objects_ids.json.gz"}]}}}return t}getRootNode(){return this.parent?this.parent.getRootNode():this}isForgeManifest(){return"manifest"===this.getRootNode().data.type}is3DTilesFormat(){return!!this.data.asset}findPropertyDbPath(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.guid();if(this.is3DTilesFormat())return null;const t=this._getOtgManifest(),i=t&&t.pdb_manifest;if(null!=t&&t.pdb_manifests){const i=t.pdb_manifests.find((t=>{var i;return(null===(i=t.views)||void 0===i?void 0:i.indexOf(e))>-1}));if(null!=i&&i.pdb_version_rel_path)return t.paths.version_root+i.pdb_version_rel_path}if(i&&i.assets&&i.assets.length){const e=t.pdb_manifest.pdb_version_rel_path;return t.paths.version_root+e}return t&&console.warn("Unexpected: OTG manifest exists, but it has no property database manifest."),this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null}_raw(){return this.data}name(){return this.data.name||""}guid(){return this.data.guid}type(){return this.data.type}extensions(){if(this.data.extensions)return Array.isArray(this.data.extensions)?this.data.extensions:[this.data.extensions]}urn(e){let t=this.data.urn;if(!e)return t;let i=this.parent;for(;!t&&i;)t=i.data.urn,i=i.parent;return t}lineageUrn(e){const t=this.getRootNode().urn();let i=Oa.parseLineageUrnFromEncodedUrn(t);return e&&(i=Autodesk.Viewing.toUrlSafeBase64(i)),i}static parseLineageUrnFromEncodedUrn(e){if(!e)return null;const t=e.split("/");let i=null;for(let e=t.length-1;e>=0;e--){var n;try{i=Autodesk.Viewing.fromUrlSafeBase64(t[e])}catch(e){}if(-1!=(null===(n=i)||void 0===n?void 0:n.indexOf("file:")))break;i=null}return Oa.parseLineageUrnFromDecodedUrn(i)}static parseLineageUrnFromDecodedUrn(e){if(!e)return null;const t=(e=e.replace("fs.file:vf.","dm.lineage:")).indexOf("?version");return-1===t?e:e.substring(0,t)}isGeomLeaf(){return this.isLeaf}isViewable(){if("viewable"===this.data.role)return!0;return!("svf"!==this.data.outputType)}getLodNode(){return this.lodNode}isGeometry(){return"geometry"===this.data.type}isViewPreset(){return"view"===this.data.type}is2D(){return"2d"===this.data.role}is3D(){return"3d"===this.data.role}is2DGeom(){return this.isGeometry()&&this.is2D()}is3DGeom(){return this.isGeometry()&&this.is3D()}useAsDefault(){return!0===this.data.useAsDefault}getDefaultGeometry(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.is3DTilesFormat())return this;let i=[];if(e){const e=this.search(Oa.MASTER_VIEW_NODE);e.length&&(i=e[0].search({type:"geometry"}))}0==i.length&&(i=this.search({type:"geometry"})),t&&i.sort((function(e,t){return t.data.size-e.data.size}));for(let e=0;e<i.length;++e)if(i[e].useAsDefault())return i[e];return i[0]}getPlacementTransform(){return console.warn("BubbleNode.getPlacementTransform is deprecated. Sheet placement information is stored in AECModelData.json"),null}getHash(){return console.warn("BubbleNode.getHash is deprecated and will be removed in a future release."),null}getViewBox(){return this.data.viewbox}isMetadata(){if(this.data.role){if(-1!==this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription"))return!0;if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1}findViewableParent(){let e=null,t=this;for(;t;)t.isViewable()&&(e=t),t=t.parent;if(!e&&!this.parent&&this.children)for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.isViewable()){e=i;break}}return e}findParentGeom2Dor3D(e){let t=this;for(;t&&!t.is2DGeom()&&!t.is3DGeom();)t=t.parent;if(!t&&this.isViewPreset()){t=this.findGeometryFromSiblings()[0],e&&e.fallbackParent&&(t=e.fallbackParent)}return t}findGeometryFromSiblings(){const e=this.parent;if(!e)return[];const t=[];for(let i=0,n=e.children.length;i<n;++i){const n=e.children[i];if(n===this)continue;let r;n.traverse((e=>{if(e.isGeometry()&&(e.is2D()||e.is3D()))return r=e,!0})),r&&t.push(r)}return t}findAllViewables(){if(this.is3DTilesFormat())return this.data.root.children;let e=[];this.isForgeManifest()&&(e=this.search({outputType:"svf"}));const t=this.search({role:"viewable"});return e.concat(t)}getViewableRootPath(e){var t=this.getOtgGraphicsNode();if(t&&t.urn&&!t.error)return this._getOtgManifest().paths.version_root+t.urn;if(!this.isGeomLeaf())return this.urn();if(this.is2D()){if(!e){var i=this.search({role:"leaflet"});if(i&&i.length)return i[0].urn()}const t=this.search(Oa.PDF_PAGE_NODE);if(null!=t&&t.length)return t[0].urn()}var n=this.is2D()?"application/autodesk-f2d":"application/autodesk-svf",r=this.search({mime:n});return r&&r.length?r[0].urn():null}getNamedViews(){var e=this.search({type:"view"});return e=e.filter((function(e){return!!e.data.name&&!!Array.isArray(e.data.camera)}))}findByGuid(e){var t=null;return this.traverse((function(i){if(i.data.guid===e)return t=i,!0})),t}search(e){const t=[];return this.traverse((function(i){let n=!0;for(let t in e)if(!Object.prototype.hasOwnProperty.call(i.data,t)||i.data[t]!==e[t]){n=!1;break}n&&t.push(i)})),t}traverse(e){if(e(this))return!0;if(this.children)for(let t=0;t<this.children.length;t++)if(this.children[t].traverse(e))return!0;return!1}getShallowCopySource(e){if(!this.isViewable())return console.error("getShallowCopySource must be called with a viewable node."),null;e||(e=this.parent.urn());var t=this.urn();return t!==e&&(t?(console.log(`Redirecting shallow copied URN ${e} to ${t}`),e=t):console.warn(`Unexpected: manifest viewable node does not have a urn property.\n${JSON.stringify(this._raw())}`)),e}getAecModelData(){const e=this.findViewableParent();if(!e)return null;if(!e.data.aec_model_data){var t=this.getRootNode().search({role:"Autodesk.AEC.ModelData"})[0];return Boolean(t)&&console.warn("Use Document.getAecModelData(bubbleNode) instead of BubbleNode.getAecModelData(), or make sure Document.downloadAecModelData is loaded before using this API"),null}return e.data.aec_model_data}extractRefPointTransform(){var e=this.getAecModelData();return e&&e.refPointTransformation&&Oa.readMatrixFromArray12(e.refPointTransformation)}extractCamera(){if(this.data.camera)return Oa.readCameraFromArray(this.data.camera);var e=this.isGeometry()&&this.search({type:"view"})[0];return e?e.extractCamera():null}getLevel(){const e=this.data.levelNumber;return Array.isArray(e)?e[0]:e}getLevelName(){return this.data.levelName||this.getLevel()}isSheet(){let e=this.parent;for(;e;){if("Sheets"===e.name())return!0;e=e.parent}return!1}isMasterView(){const e=Oa.MASTER_VIEW_NODE.name;let t=this;for(;t;){if(t.name()===e)return!0;t=t.parent}return!1}getModelName(){const e=this.getRootNode().children[0];return null==e?void 0:e.name()}getInputFileType(){var e;const t=null===(e=this.getRootNode().children)||void 0===e?void 0:e[0];return null==t?void 0:t.data.inputFileType}isRevitPdf(){return!(!this.data.isVectorPDF||"rvt"!==this.getInputFileType())}isSmartPdf(){return!(!this.data.isVectorPDF||"pdf"===this.getInputFileType())}getModelKey(){const e=`${this.getViewableRootPath()}${this.originModel}${this.guid()}`;return decodeURIComponent(e)}static readCameraFromArray(e,t){if(!Array.isArray(e))return null;if(t&&!t.elements){t instanceof THREE.Vector3||(t=(new THREE.Vector3).copy(t));var i=new THREE.Matrix4;i.setPosition(t),t=i}const n={position:new THREE.Vector3(e[0],e[1],e[2]),target:new THREE.Vector3(e[3],e[4],e[5]),up:new THREE.Vector3(e[6],e[7],e[8]),aspect:e[9],fov:THREE.Math.radToDeg(e[10]),orthoScale:e[11],isPerspective:!e[12]};return t&&(n.position.applyMatrix4(t),n.target.applyMatrix4(t),n.up.transformDirection(t)),0===e[10]&&1===e[11]&&1===e[12]&&(n.orthoScale=n.position.distanceTo(n.target)),n}static readMatrixFromArray12(e){return(new THREE.Matrix4).fromArray([e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,e[9],e[10],e[11],1])}getSourceFileUnits(){return this.data.units}getMasterViews(){const e=this.getRootNode().search({name:"08f99ae5-b8be-4f8d-881b-128675723c10"});return e&&e.length>0&&e[0].children||[]}getMasterView(e){return this.getMasterViews().find((t=>t.data.phaseNames===e))}get3DModelNodes(){return this.search(Oa.MODEL_NODE)}getSheetNodes(){return this.search(Oa.SHEET_NODE)}}let Ba=function(){};Ba.prototype={constructor:Ba,apply:function(e){e.addEventListener=Ba.prototype.addEventListener,e.hasEventListener=Ba.prototype.hasEventListener,e.removeEventListener=Ba.prototype.removeEventListener,e.clearListeners=Ba.prototype.clearListeners,e.fireEvent=Ba.prototype.fireEvent,e.dispatchEvent=Ba.prototype.fireEvent,e.debugEvents=Ba.prototype.debugEvents},addEventListener:function(e,t,i){if(e){void 0===this.listeners&&(this.listeners={}),void 0===this.listeners[e]&&(this.listeners[e]=[]);for(var n=i&&i.priority||0,r=this.listeners[e].length,o=this.listeners[e].length-1;o>=0&&n>this.listeners[e][o].priority;o--)r--;this.listeners[e].splice(r,0,{callbackFn:t,once:!!i&&!!i.once,priority:n})}},hasEventListener:function(e,t){if(!e)return!1;if(void 0===this.listeners)return!1;var i=this.listeners[e];if(!i||0===i.length)return!1;for(var n=0,r=i.length;n<r;++n)if(i[n].callbackFn===t)return!0;return!1},removeEventListener:function(e,t){if(e)if(void 0!==this.listeners){var i=this.listeners[e];if(i)for(var n=0,r=i.length;n<r;++n)if(i[n].callbackFn===t){i.splice(n,1);break}}else this.listeners={}},clearListeners:function(){this.listeners=void 0},dispatchEvent:function(e){if(void 0!==this.listeners){if("string"==typeof e&&(e={type:e}),!e.target)try{e.target=this}catch(e){}if(!e.type)throw new Error("event type unknown.");if(this._doDebug&&console.log("Event: "+e.type),Array.isArray(this.listeners[e.type])){for(var t=this.listeners[e.type].slice(),i=[],n=0,r=t.length;n<r;++n)t[n].callbackFn.call(this,e),t[n].once&&i.push(t[n].callbackFn);for(var o=0;o<i.length;++o)this.removeEventListener(e.type,i[o])}}else this.listeners={}},debugEvents:function(e){this._doDebug=e}},Ba.prototype.fireEvent=Ba.prototype.dispatchEvent,"undefined"!=typeof Autodesk&&(Autodesk.Viewing.EventDispatcher=Ba);var Na=function(e,t){this.viewer=e,fo.call(this),this.setGlobalManager(e.globalManager),this.options=t||{},this.id="",this.modes=[],this.mode="",this.name="",this.activeStatus=!1};Na.prototype.load=function(){return!0},Na.prototype.unload=function(){return!0},Na.prototype.activate=function(e){return!0},Na.prototype.deactivate=function(){return!0},Na.prototype.setActive=function(e,t){e?this.activate(t):this.deactivate()},Na.prototype.getName=function(){return this.name},Na.prototype.getModes=function(){return this.modes},Na.prototype.isActive=function(e){return e?this.activeStatus&&this.mode===e:this.activeStatus},Na.prototype.getState=function(e){},Na.prototype.restoreState=function(e,t){return!0},Na.prototype.extendLocalization=function(e){return Ni(e)},Na.prototype.getCache=function(){this.viewer.extensionCache||(this.viewer.extensionCache={});var e=this.viewer.extensionCache[this.id];return e||(e=this.viewer.extensionCache[this.id]={}),e},Na.prototype.onToolbarCreated=function(e){},"undefined"!=typeof Autodesk&&(Autodesk.Viewing.Extension=Na);const Ua=c(),ka=Ua.document;const Fa=new class{constructor(){this.loadPromises={}}getResourceUrl(e){return e.indexOf("://")>0?e:de(e)}loadScriptIntoDom(e,t,i){const n=ka.createElement("SCRIPT");n.src=e;const r=function(){n.onerror=null,n.onload=null};n.onload=function(){r(),t()},n.onerror=function(t){r(),i&&i(new Error(`Error loading script ${e}, with error ${t}`))},ka.head.appendChild(n)}loadScript(e,t){if(t&&void 0!==Ua[t])return Promise.resolve();const i=(e=this.getResourceUrl(e)).toLowerCase();if(i in this.loadPromises)return this.loadPromises[i];const n=le(e);return this.loadPromises[i]=n?Promise.resolve():new Promise(((t,i)=>{this.loadScriptIntoDom(e,t,i)})),this.loadPromises[i]}_getLink(e){const t=ka.getElementsByTagName("link");for(let i=0,n=t.length;i<n;i++)if(t[i].href===e)return t[i];return null}};function Va(e,t,i,n){Fa.loadScript(t,e).then((()=>{i&&i()})).catch((e=>{n&&n(e)}))}Object.freeze(Fa);const Ga=Autodesk.Viewing;const za=new class{constructor(){this.registeredExtensions=new Map}registerExtension(e,t){if(this.registeredExtensions.has(e)){const i=this.registeredExtensions.get(e);if(i.EXTENSION_CLASS)return!1;i.EXTENSION_CLASS=t}else this.registeredExtensions.set(e,{EXTENSION_CLASS:t});return!0}getExtensionClass(e){return this.registeredExtensions.has(e)?this.registeredExtensions.get(e).EXTENSION_CLASS:null}unregisterExtension(e){return!!this.registeredExtensions.has(e)&&(this.registeredExtensions.delete(e),!0)}registerExternalExtension(e,t,i){return!this.registeredExtensions.has(e)&&(this.registeredExtensions.set(e,{EXTENSION_CLASS:null,externalPathOrCallback:t,dependencies:i}),!0)}getExternalPath(e){return this.registeredExtensions.has(e)?this.registeredExtensions.get(e).externalPathOrCallback:null}getRegisteredExtensions(){return Array.from(this.registeredExtensions).map((e=>{let[t,i]=e;return{id:t,inMemory:!!i.EXTENSION_CLASS,isAsync:!!i.externalPathOrCallback}}))}downloadExtension(e){if(!this.registeredExtensions.has(e))return Promise.reject("Extension not found: "+e+". Has it been registered(1)?");const t=this.registeredExtensions.get(e);if(!t.externalPathOrCallback)return Promise.reject("Extension not found: "+e+". Has it been registered(2)?");if(t.downloadPromise)return t.downloadPromise;const i=(t.dependencies||[]).map((e=>this.downloadExtension(e))),n=Promise.all(i);return t.downloadPromise=n.then((()=>"string"==typeof t.externalPathOrCallback?Fa.loadScript(t.externalPathOrCallback,e):t.externalPathOrCallback())).then((()=>{if(delete t.downloadPromise,!t.EXTENSION_CLASS)throw new Error("Extension not found: "+e+". Has it been registered(3)?");return t.EXTENSION_CLASS})),t.downloadPromise}popuplateOptions(e){this.registeredExtensions.forEach((t=>{t.EXTENSION_CLASS.populateDefaultOptions(e)}))}isDownloading(e){return!!this.registeredExtensions.has(e)&&!!this.registeredExtensions.get(e).downloadPromise}isAvailable(e){return!!this.getExtensionClass(e)}},Ha=function(){};function Wa(e){this.viewer=e}Ha.prototype={loadExtension:function(e,t){return this.loadedExtensions=this.loadedExtensions||{},za.isAvailable(e)?this.loadExtensionLocal(e,t):(this.cancelledExtensions&&delete this.cancelledExtensions[e],this.loadExtensionPromises=this.loadExtensionPromises||{},e in this.loadExtensionPromises||(this.loadExtensionPromises[e]=za.downloadExtension(e).then((()=>{if(delete this.loadExtensionPromises[e],this.loadedExtensions){if(this.cancelledExtensions&&e in this.cancelledExtensions)throw delete this.cancelledExtensions[e],new Error(`Abort loadExtension('${e}') - extension has been unloaded`);return this.loadExtensionLocal(e,t)}rt.info(`Abort loadExtension('${e}') - teardown in progress`)}))),this.loadExtensionPromises[e])},getExtension:function(e,t){var i=this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e]:null;return i&&t&&t(i),i},getExtensionAsync:function(e){let t=this.getExtension(e);return t?Promise.resolve(t):new Promise((i=>{this.addEventListener(sr,(function n(r){r.extensionId===e&&(this.removeEventListener(sr,n),t=this.getExtension(e),i(t))}))}))},unloadExtension:function(e){if(this.cancelledExtensions=this.cancelledExtensions||{},za.isDownloading(e))return this.cancelledExtensions[e]=!0,!1;let t=!1;const i=this.getExtension(e);return i?(t=i.unload(),rt.info("Extension unloaded: "+e),delete this.loadedExtensions[e],Qe.track("viewer.extensionManager.extensionUnloaded",{extensionId:e}),this.dispatchEvent({type:lr,extensionId:e})):rt.warn("Extension not found: "+e),t},loadExtensionLocal:function(e,t){const i=za.getExtensionClass(e);if(!i)return Promise.reject("Extension not found : "+e);let n=this.getExtension(e);if(n)return Promise.resolve(n);if(this.loadingExtensions&&e in this.loadingExtensions)return this.loadingExtensions[e];n=function(e){function t(t,i,n){const r=e[t];r?e[t]=function(){i&&i.call(e,...arguments);const t=r.call(e,...arguments);return n&&n.call(e,...arguments),t}:console.warn(t," not implemented in ",e)}return t("load",(function(){this.viewer.dispatchEvent({type:Ga.EXTENSION_PRE_LOADED_EVENT,extensionId:this.id})})),t("unload",(function(){this.viewer.dispatchEvent({type:Ga.EXTENSION_PRE_UNLOADED_EVENT,extensionId:this.id})})),t("activate",(function(e){this.viewer.dispatchEvent({type:Ga.EXTENSION_PRE_ACTIVATED_EVENT,extensionId:this.id,mode:e})}),(function(e){this.viewer.dispatchEvent({type:Ga.EXTENSION_ACTIVATED_EVENT,extensionId:this.id,mode:e}),Qe.track("viewer.extension.activate",{extensionId:this.id,mode:e})})),t("deactivate",(function(){this.viewer.dispatchEvent({type:Ga.EXTENSION_PRE_DEACTIVATED_EVENT,extensionId:this.id})}),(function(){this.viewer.dispatchEvent({type:Ga.EXTENSION_DEACTIVATED_EVENT,extensionId:this.id}),Qe.track("viewer.extension.deactivate",{extensionId:this.id})})),e}(new i(this,t)),n.id=e;const r=()=>Promise.reject("Extension failed to .load() : "+e),o=n.load();if(!o)return r();const s=()=>(this.loadedExtensions[e]=n,this.onPostExtensionLoad(n),rt.info("Extension loaded: "+e),Qe.track("viewer.extensionManager.extensionLoaded",{extensionId:e}),setTimeout((()=>{this.getExtension(e)&&this.dispatchEvent({type:sr,extensionId:e})}),0),Promise.resolve(n));return"function"==typeof o.then?(this.loadingExtensions=this.loadingExtensions||{},this.loadingExtensions[e]=o.then((t=>this.loadedExtensions?t?s():r():(rt.info(`Abort loadExtensionLocal('${e}') - teardown in progress`),Promise.resolve()))).finally((()=>{delete this.loadingExtensions[e]})),this.loadingExtensions[e]):s()},onPostExtensionLoad:function(e){},forEachExtension:function(e){const t=this.loadedExtensions||{};for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&e(t[i])},apply:function(e){var t=Ha.prototype;e.loadExtension=t.loadExtension,e.getExtension=t.getExtension,e.getExtensionAsync=t.getExtensionAsync,e.unloadExtension=t.unloadExtension,e.loadExtensionLocal=t.loadExtensionLocal,e.forEachExtension=t.forEachExtension,e.onPostExtensionLoad=t.onPostExtensionLoad}},Wa.prototype.constructor=Wa,Wa.prototype.loadFile=function(e,t,i,n){return!1},Wa.prototype.is3d=function(){return!1};let ja=!1,qa=!1;class Ka{static isRightClick(e){if(!(e instanceof Xa(e).MouseEvent))return!1;let t=e.button;"buttons"in e&&(!qa||1&e.buttons?2===t&&1&e.buttons&&(t=0,qa=!0):(qa=!1,t=0));return t===(ja?0:2)}static isMiddleClick(e){return e instanceof Xa(e).MouseEvent&&1===e.button}static setUseLeftHandedInput(e){ja=e}static async waitUntilTransitionEnded(e){if(e.navigation.getRequestTransition()||e.navigation.getTransitionActive())return new Promise((t=>{setTimeout((()=>{e.navigation.getRequestTransition()||e.navigation.getTransitionActive()?e.addEventListener(Autodesk.Viewing.CAMERA_TRANSITION_COMPLETED,t,{once:!0}):t()}))}))}static async waitUntilGeometryLoaded(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.model;if(!t||!t.isLoadDone())return new Promise((i=>{const n=r=>{t&&t!==r.model||(i(),e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,n))};e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,n)}))}static async waitUntilModelAdded(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.model;if(!t)return new Promise((i=>{const n=r=>{t&&t!==r.model||(i(),e.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,n))};e.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,n)}))}}function Xa(e){const t=e.target&&e.target.ownerDocument;return t?t.defaultView||t.parentWindow:c()}Autodesk.Viewing.isRightClick=Ka.isRightClick,Autodesk.Viewing.isMiddleClick=Ka.isMiddleClick;var Ya=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];function Qa(e,t){for(var i=0;i<Ya.length;++i)t.addDocumentEventListener(Ya[i],e,!1)}function Za(e,t){for(var i=0;i<Ya.length;++i)t.removeDocumentEventListener(Ya[i],e,!1)}const $a={kNormal:0,kFullBrowser:1,kFullScreen:2};function Ja(e){this.viewer=e,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===$a.kFullScreen&&Qa(this.bindFullscreenEventListener,this.viewer.globalManager)}function el(e){Ja.call(this,e)}Ja.prototype.uninitialize=function(){Za(this.bindFullscreenEventListener,this.viewer.globalManager),this.viewer=null},Ja.prototype.isModeSupported=function(e){return!0},Ja.prototype.setMode=function(e){var t=this.getMode();return!(e===t||!this.isModeSupported(e))&&(this.doScreenModeChange(t,e),this.onScreenModeChanged(t,e),!0)},Ja.prototype.getMode=function(){throw"Implement getMode() in derived class"},Ja.prototype.getNextMode=function(){var e,t=this.getMode(),i=$a;return t===i.kNormal&&this.isModeSupported(i.kFullBrowser)?e=i.kFullBrowser:t===i.kNormal&&this.isModeSupported(i.kFullScreen)||t===i.kFullBrowser&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kNormal)||t===i.kFullScreen&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kFullBrowser)&&(e=i.kFullBrowser),e},Ja.prototype.getEscapeMode=function(){return this.getMode()!==$a.kNormal?$a.kNormal:void 0},Ja.prototype.fullscreenEventListener=function(){M(this.viewer.globalManager.getDocument())?this.viewer.resize():(this.doScreenModeChange($a.kFullScreen,$a.kNormal),this.onScreenModeChanged($a.kFullScreen,$a.kNormal))},Ja.prototype.doScreenModeChange=function(e,t){throw"Implement doScreenModeChange() in derived class"},Ja.prototype.onScreenModeChanged=function(e,t){e===$a.kFullScreen?Za(this.bindFullscreenEventListener,this.viewer.globalManager):t===$a.kFullScreen&&Qa(this.bindFullscreenEventListener,this.viewer.globalManager),this.viewer.resize(),this.viewer.dispatchEvent({type:On,mode:t})},el.prototype=Object.create(Ja.prototype),el.prototype.constructor=el,el.prototype.isModeSupported=function(e){return e!==$a.kFullBrowser},el.prototype.getMode=function(){return M(this.viewer.globalManager.getDocument())?$a.kFullScreen:$a.kNormal},el.prototype.doScreenModeChange=function(e,t){var i=this.viewer.container;t===$a.kNormal?(i.classList.remove("viewer-fill-browser"),T(this.viewer.globalManager.getDocument())):t===$a.kFullScreen&&(i.classList.add("viewer-fill-browser"),C(i))};let tl=el;function il(e){Ja.call(this,e)}function nl(){}il.prototype=Object.create(Ja.prototype),il.prototype.constructor=Ja,il.prototype.isModeSupported=function(){return!1},il.prototype.getMode=function(){return $a.kNormal},nl.prototype={setScreenModeDelegate:function(e){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.screenModeDelegateClass=e||(null===e?il:el)},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(e){return this.getScreenModeDelegate().isModeSupported(e)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(e){var t={category:"screen_mode",value:e};return rt.track(t),this.getScreenModeDelegate().setMode(e)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var e=this.getScreenModeDelegate().getNextMode();return void 0!==e&&this.setScreenMode(e)},escapeScreenMode:function(){var e=this.getScreenModeDelegate().getEscapeMode();return void 0!==e&&this.setScreenMode(e)},apply:function(e){var t=nl.prototype;e.setScreenModeDelegate=t.setScreenModeDelegate,e.getScreenModeDelegate=t.getScreenModeDelegate,e.isScreenModeSupported=t.isScreenModeSupported,e.canChangeScreenMode=t.canChangeScreenMode,e.setScreenMode=t.setScreenMode,e.getScreenMode=t.getScreenMode,e.nextScreenMode=t.nextScreenMode,e.escapeScreenMode=t.escapeScreenMode}};let rl=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0};var ol,sl;rl.prototype={constructor:rl,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12],this.y=r[1]*t+r[5]*i+r[9]*n+r[13],this.z=r[2]*t+r[6]*i+r[10]*n+r[14],this},applyProjection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*n-s*i,c=a*i+s*t-r*n,u=a*n+r*i-o*t,h=-r*t-o*i-s*n;return this.x=l*a+h*-r+c*-s-u*-o,this.y=c*a+h*-o+u*-r-l*-s,this.z=u*a+h*-s+l*-o-c*-r,this},transformDirection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(i,n){return void 0===e&&(e=new rl,t=new rl),e.set(i,i,i),t.set(n,n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=n*a-r*s,this.y=r*o-i*a,this.z=i*s-n*o,this},projectOnVector:function(e){return void 0===ol&&(ol=new rl),ol.copy(e).normalize(),sl=this.dot(ol),this.copy(ol).multiplyScalar(sl)},projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new rl),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new rl),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),n=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=n,this},setFromMatrixColumn:function(e,t){var i=4*e,n=t.elements;return this.x=n[i],this.y=n[i+1],this.z=n[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}};let al=function(e){this.elements=e?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.isDoublePrecision=!!e};al.prototype={constructor:al,set:function(e,t,i,n,r,o,s,a,l,c,u,h,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,s=i+i,a=n+n,l=r+r,c=i*s,u=i*a,h=i*l,d=n*a,f=n*l,p=r*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(d+p),t[4]=u-v,t[8]=h+g,t[1]=u+v,t[5]=1-(c+p),t[9]=f-m,t[2]=h-g,t[6]=f+m,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},multiply:function(e){return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],f=i[2],p=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],x=i[15],_=n[0],E=n[4],S=n[8],A=n[12],w=n[1],C=n[5],T=n[9],M=n[13],I=n[2],P=n[6],L=n[10],R=n[14],D=n[3],O=n[7],B=n[11],N=n[15];return r[0]=o*_+s*w+a*I+l*D,r[4]=o*E+s*C+a*P+l*O,r[8]=o*S+s*T+a*L+l*B,r[12]=o*A+s*M+a*R+l*N,r[1]=c*_+u*w+h*I+d*D,r[5]=c*E+u*C+h*P+d*O,r[9]=c*S+u*T+h*L+d*B,r[13]=c*A+u*M+h*R+d*N,r[2]=f*_+p*w+m*I+g*D,r[6]=f*E+p*C+m*P+g*O,r[10]=f*S+p*T+m*L+g*B,r[14]=f*A+p*M+m*R+g*N,r[3]=v*_+y*w+b*I+x*D,r[7]=v*E+y*C+b*P+x*O,r[11]=v*S+y*T+b*L+x*B,r[15]=v*A+y*M+b*R+x*N,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-n*l*u-r*s*h+i*l*h+n*s*d-i*a*d)+e[7]*(+t*a*d-t*l*h+r*o*h-n*o*d+n*l*c-r*a*c)+e[11]*(+t*l*u-t*s*d-r*o*u+i*o*d+r*s*c-i*l*c)+e[15]*(-n*s*c-t*a*u+t*s*h+n*o*u-i*o*h+i*a*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},invert:function(e){const t=this.elements,i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],v=t[15],y=h*g*c-m*d*c+m*l*f-a*g*f-h*l*v+a*d*v,b=p*d*c-u*g*c-p*l*f+s*g*f+u*l*v-s*d*v,x=u*m*c-p*h*c+p*a*f-s*m*f-u*a*v+s*h*v,_=p*h*l-u*m*l-p*a*d+s*m*d+u*a*g-s*h*g,E=i*y+n*b+r*x+o*_;if(0===E)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/E;return t[0]=y*S,t[1]=(m*d*o-h*g*o-m*r*f+n*g*f+h*r*v-n*d*v)*S,t[2]=(a*g*o-m*l*o+m*r*c-n*g*c-a*r*v+n*l*v)*S,t[3]=(h*l*o-a*d*o-h*r*c+n*d*c+a*r*f-n*l*f)*S,t[4]=b*S,t[5]=(u*g*o-p*d*o+p*r*f-i*g*f-u*r*v+i*d*v)*S,t[6]=(p*l*o-s*g*o-p*r*c+i*g*c+s*r*v-i*l*v)*S,t[7]=(s*d*o-u*l*o+u*r*c-i*d*c-s*r*f+i*l*f)*S,t[8]=x*S,t[9]=(p*h*o-u*m*o-p*n*f+i*m*f+u*n*v-i*h*v)*S,t[10]=(s*m*o-p*a*o+p*n*c-i*m*c-s*n*v+i*a*v)*S,t[11]=(u*a*o-s*h*o-u*n*c+i*h*c+s*n*f-i*a*f)*S,t[12]=_*S,t[13]=(u*m*r-p*h*r+p*n*d-i*m*d-u*n*g+i*h*g)*S,t[14]=(p*a*r-s*m*r-p*n*l+i*m*l+s*n*g-i*a*g)*S,t[15]=(s*h*r-u*a*r+u*n*l-i*h*l-s*n*d+i*a*d)*S,this},getInverse:function(e,t){if(console.warn("LmvMatrix4.getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert(),0===this.determinant()){const e="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(e);console.warn(e),this.identity()}return this},scale:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,n)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,s=e.y,a=e.z,l=r*o,c=r*s;return this.set(l*o+i,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+i,c*a-n*o,0,l*a-n*s,c*a+n*o,r*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},lookAt:function(){var e=new rl,t=new rl,i=new rl;return function(n,r,o){var s=this.elements;return i.subVectors(n,r).normalize(),0===i.length()&&(i.z=1),e.crossVectors(o,i).normalize(),0===e.length()&&(i.x+=1e-4,e.crossVectors(o,i).normalize()),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new rl,t=new al(!0);return function(i,n,r){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var c=1/s,u=1/a,h=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,n.setFromRotationMatrix(t),r.x=s,r.y=a,r.z=l,this}}(),transformPoint:function(e){var t=e.x,i=e.y,n=e.z,r=this.elements;return e.x=r[0]*t+r[4]*i+r[8]*n+r[12],e.y=r[1]*t+r[5]*i+r[9]*n+r[13],e.z=r[2]*t+r[6]*i+r[10]*n+r[14],e},transformDirection:function(e){var t=e.x,i=e.y,n=e.z,r=this.elements;e.x=r[0]*t+r[4]*i+r[8]*n,e.y=r[1]*t+r[5]*i+r[9]*n,e.z=r[2]*t+r[6]*i+r[10]*n;var o=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(o>0){var s=1/o;e.x*=s,e.y*=s,e.z*=s}return e},equals(e){const t=this.elements,i=e.elements;for(var n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return new al(this.isDoublePrecision).fromArray(this.elements)}};let ll={MESH_VISIBLE:1,MESH_HIGHLIGHTED:2,MESH_HIDE:4,MESH_ISLINE:8,MESH_MOVED:16,MESH_RENDERFLAG:32,MESH_NOTLOADED:64,MESH_ISPOINT:128,MESH_ISWIDELINE:256,MESH_TRAVERSED:512,MESH_DRAWN:1024,MESH_NOT_FOR_DISPLAY:2048};function cl(e,t){return t<=255?new Uint8Array(e):t<=65535?new Uint16Array(e):new Uint32Array(e)}var ul=2*Math.PI;function hl(e){var t;this.vb=e.vb.buffer,this.stride=e.vbstride,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.vbs=new Uint16Array(this.vb),this.ib=e.ib,this.vcount=this.vbf.length/this.stride,this.useInstancing=e.numInstances>0,this.useCompactBuffers=e.unpackXform,this.texData=this.useCompactBuffers&&(null===(t=e.tIdColor)||void 0===t||null===(t=t.image)||void 0===t?void 0:t.data)&&new Uint32Array(e.tIdColor.image.data.buffer),this.isInterleavedVb=(()=>{const t=e.attributes;if(!t)return!1;const i=t.layerVp4b,n=t.flags4b;if(this.useCompactBuffers){return t.uvIdColor&&i&&n}{const e=t.color4b,r=t.dbId4b;return e&&r&&i&&n}})()}hl.prototype.getDbIdAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+7]]:this.vbi[e*this.stride+7]},hl.prototype.getColorAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+6]]:this.vbi[e*this.stride+6]},hl.prototype.getVertexFlagsAt=function(e){return this.texData?this.vbi[e*this.stride+4]:this.vbi[e*this.stride+8]},hl.prototype.getLayerIndexAt=function(e){return this.texData?65535&this.vbi[e*this.stride+5]:65535&this.vbi[e*this.stride+9]},hl.prototype.getViewportIndexAt=function(e){return this.texData?this.vbi[e*this.stride+5]>>16&65535:this.vbi[e*this.stride+9]>>16&65535},hl.prototype.decodeLineAt=function(e,t,i,n){if(n.onLineSegment){if(this.useCompactBuffers)var r=this.stride*e*2,o=this.useCompactBuffers.x*this.vbs[r]/65535+this.useCompactBuffers.z,s=this.useCompactBuffers.y*this.vbs[r+1]/65535+this.useCompactBuffers.w,a=this.vbs[r+2]/65535*ul-Math.PI,l=this.vbs[r+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),c=this.vbs[r+4]/32767*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y)*2;else{var u=this.stride*e;o=this.vbf[u],s=this.vbf[u+1],a=this.vbf[u+2]*ul-Math.PI,l=this.vbf[u+3],c=2*this.vbf[u+4]}var h=o+l*Math.cos(a),d=s+l*Math.sin(a);n.onLineSegment(o,s,h,d,i,c)}},hl.prototype.decodeCircularArcAt=function(e,t,i,n){if(n.onCircularArc){if(this.useCompactBuffers)var r=this.stride*e*2,o=this.useCompactBuffers.x*this.vbs[r]/65535+this.useCompactBuffers.z,s=this.useCompactBuffers.y*this.vbs[r+1]/65535+this.useCompactBuffers.w,a=this.vbs[r+2]/65535*ul,l=this.vbs[r+3]/65535*ul,c=this.vbs[r+5]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var u=this.stride*e;o=this.vbf[u],s=this.vbf[u+1],a=this.vbf[u+2]*ul,l=this.vbf[u+3]*ul,c=this.vbf[u+5]}n.onCircularArc(o,s,a,l,c,i)}},hl.prototype.decodeEllipticalArcAt=function(e,t,i,n){if(n.onEllipticalArc){var r=this.stride*e,o=this.vbf[r],s=this.vbf[r+1],a=this.vbf[r+2]*ul,l=this.vbf[r+3]*ul,c=this.vbf[r+5],u=this.vbf[r+10],h=this.vbf[r+11];n.onEllipticalArc(o,s,a,l,c,u,h,i)}},hl.prototype.decodeTexQuadAt=function(e,t,i,n){if(n.onTexQuad){if(this.useCompactBuffers)var r=this.stride*e*2,o=this.useCompactBuffers.x*this.vbs[r]/65535+this.useCompactBuffers.z,s=this.useCompactBuffers.y*this.vbs[r+1]/65535+this.useCompactBuffers.w,a=this.vbs[r+2]/65535*ul,l=this.vbs[r+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),c=this.vbs[r+4]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var u=this.stride*e;o=this.vbf[u],s=this.vbf[u+1],a=this.vbf[u+2]*ul,l=this.vbf[u+3],c=this.vbf[u+4]}n.onTexQuad(o,s,l,c,a,i)}},hl.prototype.decodeOneTriangleAt=function(e,t,i,n){if(n.onOneTriangle){if(this.useCompactBuffers)var r=this.stride*e*2,o=this.useCompactBuffers.x*this.vbs[r]/65535+this.useCompactBuffers.z,s=this.useCompactBuffers.y*this.vbs[r+1]/65535+this.useCompactBuffers.w,a=this.useCompactBuffers.x*this.vbs[r+2]/65535+this.useCompactBuffers.z,l=this.useCompactBuffers.y*this.vbs[r+3]/65535+this.useCompactBuffers.w,c=this.useCompactBuffers.x*this.vbs[r+4]/65535+this.useCompactBuffers.z,u=this.useCompactBuffers.y*this.vbs[r+5]/65535+this.useCompactBuffers.w;else{var h=this.stride*e;o=this.vbf[h],s=this.vbf[h+1],a=this.vbf[h+2],l=this.vbf[h+3],c=this.vbf[h+4],u=this.vbf[h+5]}n.onOneTriangle(o,s,a,l,c,u,i)}},hl.prototype.decodeTriangleIndexed=function(e,t,i,n,r,o){if(o.onOneTriangle){if(this.useCompactBuffers){var s=this.stride*e*2,a=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,l=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w;s=this.stride*t*2;var c=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,u=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w;s=this.stride*i*2;var h=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,d=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w}else{var f=this.stride*e;a=this.vbf[f],l=this.vbf[f+1];f=this.stride*t;c=this.vbf[f],u=this.vbf[f+1];f=this.stride*i;h=this.vbf[f],d=this.vbf[f+1]}o.onOneTriangle(a,l,c,u,h,d,r)}},hl.prototype.decodeByType=function(e,t,i,n,r){switch(e){case 11:case 8:case 9:case 10:case 1:this.decodeLineAt(t,i,n,r);break;case 2:this.decodeCircularArcAt(t,i,n,r);break;case 3:this.decodeEllipticalArcAt(t,i,n,r);break;case 4:this.decodeTexQuadAt(t,i,n,r);break;case 5:this.decodeOneTriangleAt(t,i,n,r)}},hl.prototype.enumGeomsForObject=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var n=this.getVertexFlagsAt(i)>>8&255,r=this.getLayerIndexAt(i),o=this.getViewportIndexAt(i);(a=this.getDbIdAt(i)===e)&&this.decodeByType(n,i,r,o,t),i+=1}else for(i=0;i<this.ib.length;){var s=this.ib[i],a=(n=this.getVertexFlagsAt(s)>>8&255,r=this.getLayerIndexAt(s),o=this.getViewportIndexAt(s),this.getDbIdAt(s)===e);0===n?(a&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],r,o,t),i+=3):(a&&this.decodeByType(n,s,r,o,t),i+=6)}},hl.prototype.enumGeomsForVisibleLayer=function(e,t){this.enumGeoms((function(t,i,n){return!e||0!==i&&-1!==e.indexOf(i)}),t)},hl.prototype.enumGeoms=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var n=this.getVertexFlagsAt(i)>>8&255,r=this.getLayerIndexAt(i),o=this.getViewportIndexAt(i),s=this.getDbIdAt(i);(l=!e||e(s,r,o))&&this.decodeByType(n,i,r,o,t),i+=1}else for(i=0;i<this.ib.length;){var a=this.ib[i],l=(n=this.getVertexFlagsAt(a)>>8&255,r=this.getLayerIndexAt(a),o=this.getViewportIndexAt(a),s=this.getDbIdAt(a),!e||e(s,r,o));0===n?(l&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],r,o,t),i+=3):(l&&this.decodeByType(n,a,r,o,t),i+=6)}};var dl=new Uint32Array(1);function fl(e){var t;this.geometry=e,this.vb=e.vb.buffer,this.stride=e.vbstride,this.vbi=new Int32Array(this.vb),this.vbs=new Uint16Array(this.vb),this.vcount=this.vbi.length/this.stride,this.useCompactBuffers=e.unpackXform,this.texData=this.useCompactBuffers&&(null===(t=e.tIdColor)||void 0===t||null===(t=t.image)||void 0===t?void 0:t.data)&&new Uint32Array(e.tIdColor.image.data.buffer),this.texColMap=(()=>{if(!this.texData)return null;const e={},t=new Set;for(let i=0;i<this.vcount;++i){const n=this.vbs[i*this.stride*2+6];t.has(n)||(e[this.texData[n]]=n,t.add(n))}return e})()}fl.prototype.setColorAt=function(e,t){if(this.texData){if(n=t,dl[0]=n,!((t=dl[0])in this.texColMap)){const e=this.texData;if(e.length+1>65536)return void rt.warn("setColorAt() cannot add new color as size limit reached");const n=new Uint32Array(e.length+1);n.set(e,0),n[e.length]=t,this.texColMap[t]=e.length;var i=new THREE.DataTexture(new Uint8Array(n.buffer),n.length,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);i.generateMipmaps=!1,i.flipY=!1,i.needsUpdate=!0,this.geometry.tIdColor.dispose(),this.geometry.tIdColor=i,this.texData=new Uint32Array(i.image.data.buffer),this.geometry.vIdColorTexSize=new THREE.Vector2(n.length,1)}this.vbs[e*this.stride*2+6]=this.texColMap[t]}else this.vbi[e*this.stride+6]=t;var n},fl.prototype.setVertexFlagsAt=function(e,t){this.texData?this.vbi[e*this.stride+4]=t:this.vbi[e*this.stride+8]=t};const pl=new(v().Matrix4),ml=new(v().Box3),gl=new(v().Quaternion),vl=new(v().Vector3),yl=new(v().Vector3),bl=new(v().Vector4)(0,0,0,0),xl=new(v().Matrix4),_l=new(v().Color),El=new(v().Color);class Sl{is2d;modelId;fragments;geoms;isFixedSize;vizflags;useThreeMesh;vizMeshes;allVisible=!0;allVisibleDirty=!0;vizflagsDirty=!0;movedFragments=0;linesHidden=!1;pointsHidden=!1;matrix=null;viewBounds=null;materialmap={};materialIdMap={};nextMaterialId=1;materialIdMapOriginal=null;db2ThemingColor=[];originalColors=[];themingOrGhostingNeedsUpdate={};themingOrGhostingNeedsUpdateByDbId={};dbIdOpacity=[];themeingOrGhostingIsDirty=!0;dbIdIsGhosted=[];animxforms=null;nextAvailableFragID;meshSetCallbacks=[];transformChangedCallbacks=[];materialChangedCallbacks=[];objectFlagsChangedCallbacks=[];themingColorChangedCallbacks=[];visibilityDirtyCallbacks=[];highlightingChangedCallbacks=[];constructor(e,t,i,n,r,o){this.is2d=o.is2d,this.modelId=i,this.fragments=e,this.geoms=t,this.isFixedSize=this.fragments.length>0,this.isFixedSize?(this.boxes=this.fragments.boxes,this.transforms=this.fragments.transforms,this.useThreeMesh=!1):(this.boxes=null,this.transforms=null,this.useThreeMesh=!0);const s=this.fragments.length;var a;(this.useThreeMesh&&(this.vizmeshes=new Array(s)),o.isOTG)?(this.materialids=cl(s,n),this.geomids=this.fragments.geomDataIndexes,this.vizflags=this.fragments.visibilityFlags):(this.geomids=new Int32Array(s),this.materialids=new Int32Array(s),this.vizflags=new Uint16Array(s),null!==(a=this.fragments)&&void 0!==a&&a.visibilityFlags?this.vizflags.set(this.fragments.visibilityFlags):this.vizflags.fill(ll.MESH_VISIBLE));this.vizflagsDirty=!0,this.nextAvailableFragID=s}getNextAvailableFragmentId(){return this.nextAvailableFragID++}fragmentsHaveBeenAdded(){return this.vizflags.length>this.fragments.length}getSvfMaterialId(e){var t=this.getMaterial(e);return t?t.svfMatId:void 0}setMesh(e,t,i,n){if(this.vizmeshes){const t=this.vizmeshes[e];t&&t.parent&&t.parent.remove(t)}if(this.vizflags.length<=e){this.isFixedSize&&(rt.warn("Attempting to resize a fragments list that was initialized with fixed data. This will have a performance impact."),this.isFixedSize=!1);let t=Math.ceil(1.5*Math.max(this.vizflags.length,e))||1;this.useThreeMesh&&t<this.vizmeshes.length&&(t=this.vizmeshes.length);const i=new Uint16Array(t);if(i.set(this.vizflags),this.vizflags=i,this.transforms){const e=new Float32Array(12*t);e.set(this.transforms),this.transforms=e}if(this.boxes){const e=new Float32Array(6*t);e.set(this.boxes),this.boxes=e}if(this.geomids){const e=new Int32Array(t);e.set(this.geomids),this.geomids=e}if(this.materialids){const e=new Int32Array(t);e.set(this.materialids),this.materialids=e}}if(this.useThreeMesh){let i;n&&t instanceof v().Mesh?(i=t,t.matrix&&i.matrixWorld.copy(t.matrix),i.dbId=i.dbId||0):(i=new(v().Mesh)(t.geometry,t.material),t.matrix&&(i.matrix&&i.matrix.copy(t.matrix),i.matrixWorld.copy(t.matrix)),i.is2d=t.is2d,i.isLine=t.isLine,i.isWideLine=t.isWideLine,i.isPoint=t.isPoint,i.dbId=0|this.fragments.fragId2dbId[e]),i.matrixAutoUpdate=!1,i.frustumCulled=!1,i.fragId=e,i.modelId=this.modelId,this.matrix&&i.matrixWorld.multiplyMatrices(this.matrix,i.matrix),this.vizmeshes[e]=i}else t.geometry.hash||(this.geomids[e]=t.geometry.svfid),this.setMaterial(e,t.material,!0);let r=0;if(t.isLine?r=ll.MESH_ISLINE:t.isWideLine?r=ll.MESH_ISWIDELINE:t.isPoint&&(r=ll.MESH_ISPOINT),this.isFixedSize?this.vizflags[e]|=r:this.vizflags[e]|=ll.MESH_VISIBLE|r,this.vizflagsDirty=!0,i&&this.transforms&&this.boxes){const i=t.matrix,n=12*e,r=i.elements,o=this.transforms;if(o[n]=r[0],o[n+1]=r[1],o[n+2]=r[2],o[n+3]=r[4],o[n+4]=r[5],o[n+5]=r[6],o[n+6]=r[8],o[n+7]=r[9],o[n+8]=r[10],o[n+9]=r[12],o[n+10]=r[13],o[n+11]=r[14],!this.fragments.dontComputeBoxes){t.bbox?ml.copy(t.bbox):(t.geometry&&t.geometry.boundingBox?ml.copy(t.geometry.boundingBox):this.geoms.getModelBox(this.geomids[e],ml),ml.isEmpty()||ml.applyMatrix4(i));const n=6*e,r=this.boxes;r[n]=ml.min.x,r[n+1]=ml.min.y,r[n+2]=ml.min.z,r[n+3]=ml.max.x,r[n+4]=ml.max.y,r[n+5]=ml.max.z}}this.#o(e);for(const t of this.meshSetCallbacks)t(e)}isFlagSet(e,t){return!!(this.vizflags[e]&t)}setFlagFragment(e,t,i){var n=this.vizflags[e];return!!(n&t)!=i&&(this.vizflags[e]=i?n|t:n&~t,this.vizflagsDirty=!0,t&ll.MESH_MOVED&&(this.movedFragments+=i?1:-1),!0)}setFlagGlobal(e,t){var i=this.vizflags,n=0,r=i.length;if(t)for(;n<r;n++)i[n]=i[n]|e;else for(var o=~e;n<r;n++)i[n]=i[n]&o;this.vizflagsDirty=!0}hideLines(e){if(e!==this.linesHidden)for(const e of this.visibilityDirtyCallbacks)e();this.linesHidden=e}hidePoints(e){if(e!==this.pointsHidden)for(const e of this.visibilityDirtyCallbacks)e();this.pointsHidden=e}hideFragments(e,t){var i=ll.MESH_HIDE,n=this.vizflags,r=0,o=n.length;if(t)for(;r<o;r++)n[r]&e&&(n[r]=n[r]|i);else for(var s=~i;r<o;r++)n[r]&e&&(n[r]=n[r]&s);this.allVisibleDirty=!0,this.vizflagsDirty=!0;for(const e of this.visibilityDirtyCallbacks)e()}isFragVisible(e){var t=this.linesHidden&&(this.isLine(e)||this.isWideLine(e)),i=this.pointsHidden&&this.isPoint(e);return!!(3&this.vizflags[e])&&!t&&!i}isFragOff(e){return!!(this.vizflags[e]&ll.MESH_HIDE)}isVisible(e){return!!(this.vizflags[e]&ll.MESH_VISIBLE)}isNotLoaded(e){return!!(this.vizflags[e]&ll.MESH_NOTLOADED)}isLine(e){return!!(this.vizflags[e]&ll.MESH_ISLINE)}isWideLine(e){return this.isFlagSet(e,ll.MESH_ISWIDELINE)}isPoint(e){return this.isFlagSet(e,ll.MESH_ISPOINT)}unload(e,t){if(this.useThreeMesh)return 0;let i=0;for(const n of e)this.setFlagFragment(n,ll.MESH_NOTLOADED,!0)&&(this.setFragOff(n,!0),this.geoms.removeInstance(this.geomids[n],t),++i);return i}areAllVisible(){if(this.allVisibleDirty){for(var e=this.vizflags,t=!0,i=0,n=e.length;i<n;i++)if(!(1&e[i]&&4&~e[i])){t=!1;break}this.allVisible=t,this.allVisibleDirty=!1}return this.allVisible}vizFlagsChanged(){const e=this.vizflagsDirty;return this.vizflagsDirty=!1,e}themeingOrGhostingChanged(){const e=this.themeingOrGhostingIsDirty;return this.themeingOrGhostingIsDirty=!1,e}static#s(e){const t=e.r;return e.r=e.b,e.b=t,e}#a(e,t){return _l.set(16777215&e),Sl.#s(_l),t&&(El.setRGB(t.x,t.y,t.z),_l.lerp(El,t.w)),Sl.#s(_l).getHex()|4278190080&e}#l(e){var t=this.originalColors[e],i=this.getGeometry(e);if(!i.vb)return void console.error("Unexpected non-interleaved vertex buffer");const n=new hl(i),r=new fl(i);if(n.isInterleavedVb){for(var o=!1,s=n.vcount,a=0;a<s;a++){var l=n.getDbIdAt(a),c=t?t[a]:n.getColorAt(a),u=n.getLayerIndexAt(a),h=-1===(l=l<<8>>8)&&0===u,d=this.db2ThemingColor[l],f=0===this.dbIdOpacity[l];if(d||f){if(!t){t=new Uint32Array(s);for(var p=0;p<s;p++)t[p]=n.getColorAt(p);this.originalColors[e]=t}c=f?0:this.#a(c,d),o=!0}else t&&(c=t[a]);if(!f){let e=this.dbIdOpacity[l];if(!isNaN(e)){e=255*e<<24,c=c&parseInt("00FFFFFF",16)|e}}r.setColorAt(a,c);var m=this.dbIdIsGhosted[l]&&!h,g=n.getVertexFlagsAt(a);m?g|=255<<24:g&=16777215,r.setVertexFlagsAt(a,g)}o||(this.originalColors[e]=null),i.vbNeedsUpdate=!0}}#c(e){this.themingOrGhostingNeedsUpdate[e]&&(this.#l(e),this.themingOrGhostingNeedsUpdate[e]=!1)}#o(e){if(this.is2d&&!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(this.themingOrGhostingNeedsUpdateByDbId)){let t=this.getDbIds(e);t=Array.isArray(t)?t:[t],t=t.filter((e=>this.themingOrGhostingNeedsUpdateByDbId[e])),t.length&&(this.#l(e),t.forEach((e=>{delete this.themingOrGhostingNeedsUpdateByDbId[e]})))}}getVizmesh(e){if(this.is2d&&this.#c(e),this.useThreeMesh){const t=this.vizmeshes[e];return t&&(t.themingColor=this.db2ThemingColor[t.dbId]),t}const t=this.scratchMesh=this.scratchMesh||function(){var e=new(v().Mesh);return e.isTemp=!0,e.dbId=0,e.modelId=0,e.fragId=-1,e.hide=!1,e.isLine=!1,e.isWideLine=!1,e.isPoint=!1,e.frustumCulled=!1,e}();return t.geometry=this.getGeometry(e),t.material=this.getMaterial(e),t.dbId=this.getDbIds(e),t.modelId=this.modelId,t.fragId=e,t.visible=!0,t.isLine=this.isLine(e),t.isWideLine=this.isWideLine(e),t.isPoint=this.isPoint(e),t.hide=this.isFragOff(e),t.themingColor=this.db2ThemingColor[t.dbId],this.getWorldMatrix(e,t.matrixWorld),t}getMaterialId(e){var t=this.getMaterial(e);return t?t.id:0}getMaterial(e){return this.useThreeMesh?this.vizmeshes[e].material:this.materialIdMap[this.materialids[e]]}hasMaterial(e){return this.useThreeMesh?this.vizmeshes[e].material:0!==this.materialids[e]}storeOriginalMaterials(){let e,t;this.materialIdMapOriginal=[];for(let i=0;i<this.fragments.length;i++)e=this.getMaterial(i),t=e.id,this.materialIdMapOriginal.push(t)}restoreOriginalMaterials(){if(!this.materialIdMapOriginal)return;let e;for(let t=0;t<this.materialIdMapOriginal.length;t++)e=this.materialIdMapOriginal[t],this.setMaterial(t,this.materialIdMap[this.materialmap[e]])}getGeometry(e){var t;return this.useThreeMesh?(null===(t=this.vizmeshes[e])||void 0===t?void 0:t.geometry)||null:this.geoms.getGeometry(this.geomids[e])}hasGeometry(e){var t;return this.useThreeMesh?!(null===(t=this.vizmeshes[e])||void 0===t||!t.geometry):this.geoms.hasGeometry(this.geomids[e])}isFragmentActive(e){return this.hasGeometry(e)&&this.hasMaterial(e)}getGeometryId(e){return this.useThreeMesh?e:this.geomids[e]}setMaterial(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.useThreeMesh)this.vizmeshes[e].material=t;else{var n=this.materialmap[t.id];n||(n=this.nextMaterialId++,this.materialids=function(e,t){if(t<=255)return e;if(t<=65535&&e instanceof Uint8Array){let t=new Uint16Array(e.length);return t.set(e),t}if(!(e instanceof Uint32Array)){let t=new Uint32Array(e.length);return t.set(e),t}return e}(this.materialids,n),this.materialIdMap[n]=t,this.materialmap[t.id]=n),this.materialids[e]=n}for(const n of this.materialChangedCallbacks)n(e,t,i)}getCount(){return this.vizmeshes?this.vizmeshes.length:this.vizflags.length}getDbIds(e){return this.fragments.fragId2dbId[e]}setObjectFlagsCB=function(e){this.objectFlagsCB=e;for(const e of this.objectFlagsChangedCallbacks)e()};getThemingColor(e){return this.db2ThemingColor[this.fragments.fragId2dbId[e]]}dispose(){if(this.useThreeMesh)for(var e={type:"dispose"},t={type:"removed"},i=0;i<this.vizmeshes.length;i++){var n=this.vizmeshes[i];n&&(n.dispatchEvent(t),n.geometry.dispatchEvent(e))}else this.geoms.dispose()}dtor(e){this.dispose(),this.scratchMesh=null,this.fragments=null,this.geoms.dtor(e),this.geoms=null,this.boxes=null,this.transforms=null,this.vizflags=null,this.vizmeshes=null,this.geomids=null,this.materialids=null,this.materialmap=null,this.materialIdMap=null,this.db2ThemingColor=null,this.originalColors=null,this.themingOrGhostingNeedsUpdate=null,this.themingOrGhostingNeedsUpdateByDbId=null,this.dbIdOpacity=null,this.dbIdIsGhosted=null,this.animxforms=null,this.matrix=null,this.viewBounds=null}setVisibility(e,t){const i=this.setFlagFragment(e,ll.MESH_VISIBLE,t);if(i){this.allVisibleDirty=!0;for(const t of this.visibilityDirtyCallbacks)t(e)}return i}setFragOff(e,t){const i=this.setFlagFragment(e,ll.MESH_HIDE,t);if(i){this.allVisibleDirty=!0;for(const t of this.visibilityDirtyCallbacks)t(e)}return i}setHighlighted(e,t){const i=this.setFlagFragment(e,ll.MESH_HIGHLIGHTED,t);if(i)for(const t of this.highlightingChangedCallbacks)t(e);return i}setAllVisibility(e){if(this.is2d){var t=this.fragments;if(t&&t.dbId2fragId)for(var i in t.dbId2fragId)this.setObject2DGhosted(parseInt(i),!e)}else this.setFlagGlobal(ll.MESH_VISIBLE,e);if(this.allVisible!==e)for(const e of this.visibilityDirtyCallbacks)e();this.allVisible=e,this.allVisibleDirty=!1}updateAnimTransform(e,t,i,n){var r,o=this.animxforms;if(!o){var s=this.getCount();o=this.animxforms=new Float32Array(10*s);for(var a=0;a<s;a++)o[r=10*a]=1,o[r+1]=1,o[r+2]=1,o[r+3]=0,o[r+4]=0,o[r+5]=0,o[r+6]=1,o[r+7]=0,o[r+8]=0,o[r+9]=0}r=10*e;var l=!1;t&&(o[r]=t.x,o[r+1]=t.y,o[r+2]=t.z,l=!0),i&&(o[r+3]=i.x,o[r+4]=i.y,o[r+5]=i.z,o[r+6]=i.w,l=!0),n&&(o[r+7]=n.x,o[r+8]=n.y,o[r+9]=n.z,l=!0),this.setFlagFragment(e,ll.MESH_MOVED,l),l||(o[r]=1,o[r+1]=1,o[r+2]=1,o[r+3]=0,o[r+4]=0,o[r+5]=0,o[r+6]=1,o[r+7]=0,o[r+8]=0,o[r+9]=0);for(const t of this.transformChangedCallbacks)t(e)}getAnimTransform(e,t,i,n){if(!this.animxforms)return!1;if(!this.isFlagSet(e,ll.MESH_MOVED))return!1;var r=10*e,o=this.animxforms;return t&&(t.x=o[r],t.y=o[r+1],t.z=o[r+2]),i&&(i.x=o[r+3],i.y=o[r+4],i.z=o[r+5],i.w=o[r+6]),n&&(n.x=o[r+7],n.y=o[r+8],n.z=o[r+9]),!0}getOriginalWorldMatrix(e,t){var i=12*e,n=t.elements,r=this.transforms;if(r)n[0]=r[i],n[1]=r[i+1],n[2]=r[i+2],n[3]=0,n[4]=r[i+3],n[5]=r[i+4],n[6]=r[i+5],n[7]=0,n[8]=r[i+6],n[9]=r[i+7],n[10]=r[i+8],n[11]=0,n[12]=r[i+9],n[13]=r[i+10],n[14]=r[i+11],n[15]=1;else if(this.useThreeMesh){var o=this.vizmeshes[e];o?t.copy(o.matrix):t.identity()}else t.identity()}getWorldMatrix(e,t){this.getOriginalWorldMatrix(e,t),this.isFlagSet(e,ll.MESH_MOVED)&&(this.getAnimTransform(e,yl,gl,vl),xl.compose(vl,gl,yl),t.multiplyMatrices(xl,t)),this.matrix&&t.multiplyMatrices(this.matrix,t)}setModelMatrix(e){e?(this.matrix=this.matrix||new(v().Matrix4),this.matrix.copy(e),this.useThreeMesh&&this.vizmeshes.forEach((e=>{e.matrixWorld.multiplyMatrices(this.matrix,e.matrix)}))):(this.matrix=null,this.useThreeMesh&&this.vizmeshes.forEach((e=>{e.matrixWorld.copy(e.matrix)}))),this.invMatrix=null}getInverseModelMatrix(){return this.matrix?(this.invMatrix||(this.invMatrix=this.matrix.clone().invert()),this.invMatrix):null}getWorldBounds(e,t){if(this.boxes&&!this.isFlagSet(e,ll.MESH_MOVED)){var i=this.boxes,n=6*e;return t.min.x=i[n],t.min.y=i[n+1],t.min.z=i[n+2],t.max.x=i[n+3],t.max.y=i[n+4],t.max.z=i[n+5],void(this.matrix&&t.applyMatrix4(this.matrix))}if(this.useThreeMesh){var r=this.vizmeshes[e];r&&r.geometry&&t.copy(r.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[e],t);this.viewBounds&&t.intersect(this.viewBounds),t.isEmpty()?t.makeEmpty():(this.getWorldMatrix(e,pl),t.applyMatrix4(pl))}getOriginalWorldBounds(e,t){if(this.boxes){var i=this.boxes,n=6*e;return t[0]=i[n],t[1]=i[n+1],t[2]=i[n+2],t[3]=i[n+3],t[4]=i[n+4],void(t[5]=i[n+5])}if(this.useThreeMesh){var r=this.vizmeshes[e];r&&r.geometry&&ml.copy(r.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[e],ml);ml.isEmpty()||(this.getOriginalWorldMatrix(e,pl),ml.applyMatrix4(pl)),t[0]=ml.min.x,t[1]=ml.min.y,t[2]=ml.min.z,t[3]=ml.max.x,t[4]=ml.max.y,t[5]=ml.max.z}#u(e){if(this.is2d){var t=this.fragments.dbId2fragId[e];if(Array.isArray(t))for(var i=0;i<t.length;i++)this.themingOrGhostingNeedsUpdate[t[i]]=!0;else"number"==typeof t?this.themingOrGhostingNeedsUpdate[t]=!0:this.themingOrGhostingNeedsUpdateByDbId[e]=!0;this.themeingOrGhostingIsDirty=!0}}setThemingColor(e,t){var i=this.db2ThemingColor[e];if(!(i===t||i&&t&&i.equals(t))&&(this.db2ThemingColor[e]=t||void 0,this.#u(e),this.themeingOrGhostingIsDirty=!0,this.themingColorChangedCallbacks.length)){t||(t=bl);const i=this.fragments.dbId2fragId[e];if(Array.isArray(i))for(const e of i)for(const i of this.themingColorChangedCallbacks)i(e,t);else if("number"==typeof i)for(const e of this.themingColorChangedCallbacks)e(i,t)}}clearThemingColors(){if(this.is2d){for(var e in this.fragments.dbId2fragId)this.#u(parseInt(e));delete this.db2ThemingColor[-1]}this.db2ThemingColor.length=0,this.themeingOrGhostingIsDirty=!0}setObject2DGhosted(e,t){!!t!=!!this.dbIdIsGhosted[e]&&(this.dbIdIsGhosted[e]=t,this.#u(e))}setObject2DOpacity(e,t){t!==this.dbIdOpacity[e]&&(this.dbIdOpacity[e]=t,this.#u(e))}setObject2DVisible(e,t){t!==(0!==this.dbIdOpacity[e])&&(this.dbIdOpacity[e]=0|t,this.#u(e))}getViewBounds(){return this.viewBounds}setViewBounds(e){e?(this.viewBounds=this.viewBounds||new(v().Box3),this.viewBounds.copy(e),Object.prototype.hasOwnProperty.call(e.max,"z")||(this.viewBounds.max.z=1/0,this.viewBounds.min.z=-1/0)):this.viewBounds=null}getDoNotCut(){return this.doNotCut}setDoNotCut(e){this.doNotCut=e}registerMeshSetCallback(e){this.meshSetCallbacks.push(e)}removeMeshSetCallback(e){const t=this.meshSetCallbacks.indexOf(e);-1!==t&&this.meshSetCallbacks.splice(t,1)}registerTransformChangedCallback(e){this.transformChangedCallbacks.push(e)}removeTransformChangedCallback(e){const t=this.transformChangedCallbacks.indexOf(e);-1!==t&&this.transformChangedCallbacks.splice(t,1)}registerMaterialChangedCallback(e){this.materialChangedCallbacks.push(e)}removeMaterialChangedCallback(e){const t=this.materialChangedCallbacks.indexOf(e);-1!==t&&this.materialChangedCallbacks.splice(t,1)}registerObjectFlagsChangedCallback(e){this.objectFlagsChangedCallbacks.push(e)}removeObjectFlagsChangedCallback(e){const t=this.objectFlagsChangedCallbacks.indexOf(e);-1!==t&&this.objectFlagsChangedCallbacks.splice(t,1)}registerThemingColorChangedCallback(e){this.themingColorChangedCallbacks.push(e)}removeThemingColorChangedCallback(e){const t=this.themingColorChangedCallbacks.indexOf(e);-1!==t&&this.themingColorChangedCallbacks.splice(t,1)}registerHighlightingChangedCallback(e){this.highlightingChangedCallbacks.push(e)}removeHighlightingChangedCallback(e){const t=this.highlightingChangedCallbacks.indexOf(e);-1!==t&&this.highlightingChangedCallbacks.splice(t,1)}registerVisibilityDirtyCallback(e){this.visibilityDirtyCallbacks.push(e)}removeVisibilityDirtyCallback(e){const t=this.visibilityDirtyCallbacks.indexOf(e);-1!==t&&this.visibilityDirtyCallbacks.splice(t,1)}}class Al{frags;fragId;scale=null;quaternion=null;position=null;constructor(e,t){this.frags=e,this.fragId=t}getWorldMatrix(e){this.frags.getWorldMatrix(this.fragId,e)}getOriginalWorldMatrix(e){this.frags.getOriginalWorldMatrix(this.fragId,e)}getWorldBounds(e){return this.frags.getWorldBounds(this.fragId,e)}getAnimTransform(){return this.scale||(this.scale=new(v().Vector3)(1,1,1),this.quaternion=new(v().Quaternion)(0,0,0,1),this.position=new(v().Vector3)(0,0,0)),this.frags.getAnimTransform(this.fragId,this.scale,this.quaternion,this.position)}updateAnimTransform(){this.scale||(this.scale=new(v().Vector3)(1,1,1),this.quaternion=new(v().Quaternion)(0,0,0,1),this.position=new(v().Vector3)(0,0,0)),this.frags.updateAnimTransform(this.fragId,this.scale,this.quaternion,this.position)}getMaterial(){return this.frags.getMaterial(this.fragId)}setMaterial(e){return this.frags.setMaterial(this.fragId,e)}}class wl{static geomMemory=0;static geomCount=0;static gpuGeomMemory=0;static gpuGeomCount=0;static geomListStats=new WeakMap;static#h(e){let t=this.geomListStats.get(e);return t||(t={geomMemory:0,geomCount:0,gpuGeomMemory:0,gpuGeomCount:0},this.geomListStats.set(e,t)),t}static printStats(){console.log("MemoryTracker Global Stats:"),console.log("--------------------------"),this.#d(this),this.#f||console.log("Available GPU resources are tracked per model.")}static printModelStats(e){console.log("MemoryTracker Model Stats:"),console.log("--------------------------");const t=e.getGeometryList(),i=this.geomListStats.get(t);i?(this.#d(i),this.#f||(console.log("gpuGeomMemory remaining (low/high):",zi-i.gpuGeomMemory,2*zi-i.gpuGeomMemory),console.log("gpuGeomCount remaining:",Hi-i.gpuGeomCount))):console.log("No stats tracked for this model yet.")}static#d(e){console.log("geomMemory:",e.geomMemory),console.log("geomCount:",e.geomCount),console.log("gpuGeomMemory:",e.gpuGeomMemory),console.log("gpuGeomCount:",e.gpuGeomCount),this.#f&&(console.log("gpuGeomMemory remaining (low/high):",zi-this.gpuGeomMemory,2*zi-this.gpuGeomMemory),console.log("gpuGeomCount remaining:",Hi-this.gpuGeomCount))}static#f=!1;static setMemoryType(e,t,i,n){const r=void 0!==t.streamingDraw,o=this.#p(e,t,i,n);r&&!!t.streamingDraw===o?t.modelRefCount>1&&r&&!o&&this.#m(e,t,!0):(t.streamingDraw=t.streamingIndex=o,o?r&&this.untrackGeometry(e,t,!1,!0,!0):this.#m(e,t))}static#p(e,t,i,n){if(Ji&&!n)return void 0===t.streamingDraw||t.streamingDraw;if(0===this.GPU_MEMORY_LOW)return!0;let r,o;if(this.#f)r=this.gpuGeomMemory,o=this.gpuGeomCount;else{const t=this.#h(e);r=t.gpuGeomMemory,o=t.gpuGeomCount}return!(e.disableStreaming||r<this.GPU_MEMORY_LOW&&o<Hi)&&(r>=this.GPU_MEMORY_HIGH||o>=Hi||(e.is2d?100001:t.byteSize*(i||1))<1e5)}static#g(e){if(!nn)return 1;let t=0,i=0;e.ib&&(i+=e.ib.byteLength),e.iblines&&(i+=e.iblines.byteLength);let n=e.byteSize-i;return t+=i/yn,t+=n/vn,0===t&&(t=1),t}static#m(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.#h(e);F()&&(i||(this.geomMemory+=t.byteSize),n.geomMemory+=t.byteSize);let r=this.#g(t);i||(this.gpuGeomMemory+=t.byteSize,this.gpuGeomCount+=r),n.gpuGeomMemory+=t.byteSize,n.gpuGeomCount+=r}static trackGeometry(e,t){const i=t.byteSize+Yi;void 0!==t.modelRefCount&&1!==t.modelRefCount||(this.geomMemory+=i,this.geomCount++);const n=this.#h(e);n.geomMemory+=i,n.geomCount++}static untrackGeometry(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=0;const s=this.geomListStats.get(e);if(void 0===n&&(n=!1===t.streamingDraw),i&&(o=t.byteSize+Yi,s.geomMemory-=o,s.geomCount--,!t.modelRefCount||r?(this.geomMemory-=o,this.geomCount--,t.streamingDraw=void 0,t.streamingIndex=void 0):o=0),n){let e=this.#g(t);s.gpuGeomMemory-=t.byteSize,s.gpuGeomCount-=e,F()&&(t.modelRefCount&&!r||(o+=t.byteSize,this.geomMemory-=t.byteSize),s.geomMemory-=t.byteSize),t.modelRefCount&&!r||(this.gpuGeomMemory-=t.byteSize,this.gpuGeomCount-=e)}return o}static getGeometrySize(e){return e.byteSize+Yi}static get GPU_MEMORY_LOW(){return zi}static get GPU_MEMORY_HIGH(){return 2*zi}}function Cl(e,t,i,n){this.geoms=[null],this.geomPolyCount=0,this.instancePolyCount=0,this.is2d=t,this.geomBoxes=n?null:new Float32Array(6*Math.max(1,e+1)),this.numObjects=e,this.disableStreaming=!!i,this.instanceCount=[null]}function Tl(e){return e.vb?e.vb.length/e.vbstride:e.attributes.position?e.attributes.position.array.length/3:0}function Ml(e){const t=zl(e);if(t){var i=e.groups;if(!i||0===i.length)return t.length;let o=0;for(var n=0,r=i.length;n<r;++n)o+=i[n].count;return o}return Tl(e)}var Il,Pl,Ll,Rl,Dl,Ol,Bl,Nl,Ul,kl,Fl;function Vl(e){const t=e.attributes;let i,n,r;if(e.vblayout){if(!e.vblayout.position)return{positions:void 0,poffset:void 0};r=e.vblayout.position.offset}else{if(!t.position)return{positions:void 0,poffset:void 0};r=t.position.offset||0}return i=e.vb||t.position.array,n=e.vb?e.vbstride:3,{positions:i,stride:n,poffset:r}}function Gl(e){const t=e.attributes;let i=0,n=e.vb||t.normal&&t.normal.array,r=e.vblayout?e.vblayout.normal:t.normal||null;return r?(i=r.offset||0,i*=1):n=null,!r||r.array||3===r.itemSize&&4===r.bytesPerItem||(n=null),{normals:n,noffset:i}}function zl(e){return e.ib||e.indices||(e.index?e.index.array:null)}function Hl(e,t,i){e.attributes;Il||(Il=new rl,Pl=new rl,new rl),i&&(Ll||(Ll=new THREE.Matrix3),Ll.getNormalMatrix(i));const{positions:n,stride:r,poffset:o}=Vl(e),{normals:s,noffset:a}=Gl(e);if(n)for(var l=Tl(e),c=o,u=a,h=0;h<l;h++,c+=r,u+=r)Il.set(n[c],n[c+1],n[c+2]),i&&Il.applyMatrix4(i),s&&(Pl.set(s[u],s[u+1],s[u+2]),i&&Pl.applyMatrix3(Ll)),t(Il,s?Pl:null,null,h)}function Wl(e,t){const i=zl(e);if(i){let n=e.groups;n&&0!==n.length||(n=[{start:0,count:i.length,index:0}]);for(let e=0,r=n.length;e<r;++e){let r=n[e].start,o=n[e].count,s=n[e].index;for(let e=r,n=r+o;e<n;e+=3){t(s+i[e],s+i[e+1],s+i[e+2])}}}else{let i=Tl(e);for(let e=0;e<i;e++){t(3*e,3*e+1,3*e+2)}}}function jl(e,t){var i,n,r;Rl||(Rl=new rl,Dl=new rl,Ol=new rl,Bl=new rl,Nl=new rl,Ul=new rl);const{positions:o,stride:s,poffset:a}=Vl(e),{normals:l,noffset:c}=Gl(e),u=zl(e);if(o)if(u){var h=e.groups;h&&0!==h.length||(h=[{start:0,count:u.length,index:0}]);for(var d=0,f=h.length;d<f;++d)for(var p=h[d].start,m=h[d].count,g=h[d].index,v=p,y=p+m;v<y;v+=3){var b=(i=g+u[v])*s+a,x=(n=g+u[v+1])*s+a,_=(r=g+u[v+2])*s+a;if(Rl.x=o[b],Rl.y=o[b+1],Rl.z=o[b+2],Dl.x=o[x],Dl.y=o[x+1],Dl.z=o[x+2],Ol.x=o[_],Ol.y=o[_+1],Ol.z=o[_+2],l){var E=i*s+c,S=n*s+c,A=r*s+c;Bl.x=l[E],Bl.y=l[E+1],Bl.z=l[E+2],Nl.x=l[S],Nl.y=l[S+1],Nl.z=l[S+2],Ul.x=l[A],Ul.y=l[A+1],Ul.z=l[A+2],t(Rl,Dl,Ol,i,n,r,Bl,Nl,Ul,v/3)}else t(Rl,Dl,Ol,i,n,r,null,null,null,v/3)}}else{var w=Tl(e);for(v=0;v<w;v+=3){b=(i=v)*s+a,x=(n=v+1)*s+a,_=(r=v+2)*s+a;if(Rl.x=o[b],Rl.y=o[b+1],Rl.z=o[b+2],Dl.x=o[x],Dl.y=o[x+1],Dl.z=o[x+2],Ol.x=o[_],Ol.y=o[_+1],Ol.z=o[_+2],l){E=i*s+c,S=n*s+c,A=r*s+c;Bl.x=l[E],Bl.y=l[E+1],Bl.z=l[E+2],Nl.x=l[S],Nl.y=l[S+1],Nl.z=l[S+2],Ul.x=l[A],Ul.y=l[A+1],Ul.z=l[A+2],t(Rl,Dl,Ol,i,n,r,Bl,Nl,Ul,v/3)}else t(Rl,Dl,Ol,i,n,r,null,null,null,v/3)}}}function ql(e,t){var i,n,r=e.attributes;kl||(kl=new rl,Fl=new rl);var o=2;e.lineWidth&&(o=6);const s=zl(e);if(s){let g,v;g=e.vb?e.vb:r.position.array,v=e.vb?e.vbstride:3;var a=e.groups;a&&0!==a.length||(a=[{start:0,count:s.length,index:0}]);for(var l=0,c=a.length;l<c;++l)for(var u=a[l].start,h=a[l].count,d=a[l].index,f=u,p=u+h,m=u/o;f<p;f+=o,m++)i=d+s[f],n=d+s[f+1],kl.x=g[i*v],kl.y=g[i*v+1],kl.z=g[i*v+2],Fl.x=g[n*v],Fl.y=g[n*v+1],Fl.z=g[n*v+2],t(kl,Fl,i,n,m)}else{const s=e.vb?e.vb:r.position.array,a=e.vb?e.vbstride:3;for(f=0,p=s.length/a,m=0;f<p;f+=o,m++)i=f,n=f+1,kl.x=s[i*a],kl.y=s[i*a+1],kl.z=s[i*a+2],Fl.x=s[n*a],Fl.y=s[n*a+1],Fl.z=s[n*a+2],t(kl,Fl,i,n,m)}}function Kl(e,t){var i,n;kl||(kl=new rl,Fl=new rl);const r=e.iblines;if(!r)return;const o=e.vb?e.vb:attributes.position.array,s=e.vb?e.vbstride:3;var a=e.groups;a&&0!==a.length||(a=[{start:0,count:r.length,index:0}]);for(var l=0,c=a.length;l<c;++l)for(var u=a[l].start,h=a[l].count,d=a[l].index,f=u,p=u+h;f<p;f+=2)i=d+r[f],n=d+r[f+1],kl.x=o[i*s],kl.y=o[i*s+1],kl.z=o[i*s+2],Fl.x=o[n*s],Fl.y=o[n*s+1],Fl.z=o[n*s+2],t(kl,Fl,i,n)}Ba.prototype.apply(wl),Cl.prototype._getMemoryStat=function(e){const t=wl.geomListStats.get(this);return t?t[e]:0},Object.defineProperty(Cl.prototype,"numGeomsInMemory",{get(){return this._getMemoryStat("geomCount")}}),Object.defineProperty(Cl.prototype,"geomMemory",{get(){return this._getMemoryStat("geomMemory")}}),Object.defineProperty(Cl.prototype,"gpuNumMeshes",{get(){return this._getMemoryStat("gpuGeomCount")}}),Object.defineProperty(Cl.prototype,"gpuMeshMemory",{get(){return this._getMemoryStat("gpuGeomMemory")}}),Cl.prototype.getGeometry=function(e){return this.geoms[e]},Cl.prototype.hasGeometry=function(e){return!!this.geoms[e]},Cl.prototype.getCount=function(){return this.geoms.length},Cl.prototype._addBbox=function(e,t){if(this.geomBoxes){var i=this.geomBoxes.length/6|0;if(i<this.getCount()){var n=3*this.getCount()/2|0,r=new Float32Array(6*n);r.set(this.geomBoxes);var o=new(v().Box3);for(o.makeEmpty();i<n;)r[6*i]=o.min.x,r[6*i+1]=o.min.y,r[6*i+2]=o.min.z,r[6*i+3]=o.max.x,r[6*i+4]=o.max.y,r[6*i+++5]=o.max.z;this.geomBoxes=r}this.geomBoxes[6*e]=t.min.x,this.geomBoxes[6*e+1]=t.min.y,this.geomBoxes[6*e+2]=t.min.z,this.geomBoxes[6*e+3]=t.max.x,this.geomBoxes[6*e+4]=t.max.y,this.geomBoxes[6*e+5]=t.max.z}},Cl.prototype._getPolygonCount=function(e){const t=e.ib;var i=e.isLines?2:3;return t?t.length/i:e.vb?e.vb.length/(i*e.vbstride):e.attributes.position.array.length/(3*i)},Cl.prototype.addGeometry=function(e,t,i,n){return e.hash&&e.setModelRefCount(e.modelRefCount+1,n),wl.trackGeometry(this,e),wl.setMemoryType(this,e,t,this.is2d),(void 0===i||i<=0)&&(i=this.geoms.length),this.geoms[i]=e,e.boundingBox||e.hash||console.error("Mesh without bbox and without hash should not be."),this._addBbox(i,e.boundingBox),this.is2d||(e.boundingBox=null,e.boundingSphere=null),e.polyCount=this._getPolygonCount(e),this.instanceCount[i]=t||1,this.geomPolyCount+=e.polyCount,this.instancePolyCount+=e.polyCount*this.instanceCount[i],e.svfid=i,i},Cl.prototype.addInstance=function(e){const t=this.getGeometry(e);t&&(this.instancePolyCount+=t.polyCount||0,++this.instanceCount[e])},Cl.prototype.removeInstance=function(e,t){const i=this.getGeometry(e);i&&(this.instancePolyCount-=i.polyCount||0,0==--this.instanceCount[e]&&this.removeGeometry(e,t))},Cl.prototype.getInstanceCount=function(e){return this.instanceCount[e]},Cl.prototype.removeGeometry=function(e,t){var i=this.getGeometry(e);if(!i)return 0;i.hash?(1===i.modelRefCount&&i.dispose(),i.setModelRefCount(i.modelRefCount-1,t)):i.dispose();const n=wl.untrackGeometry(this,i);return this.geoms[e]=null,this.geomPolyCount-=i.polyCount,this.instancePolyCount-=this.instanceCount[e]*i.polyCount,this.instanceCount[e]=0,n},Cl.prototype.getModelBox=function(e,t){if(this.geomBoxes)if(0===e||this.geomBoxes.length/6<=e)t.makeEmpty();else{var i=6*e,n=this.geomBoxes;t.min.x=n[i],t.min.y=n[i+1],t.min.z=n[i+2],t.max.x=n[i+3],t.max.y=n[i+4],t.max.z=n[i+5]}else e>=1&&e<=this.numObjects?(t.min.x=-.5,t.min.y=-.5,t.min.z=-.5,t.max.x=.5,t.max.y=.5,t.max.z=.5):t.makeEmpty()},Cl.prototype.dispose=function(){let e;for(var t=0,i=this.geoms.length;t<i;t++)e=this.geoms[t],e&&(e.hash?1===e.modelRefCount&&e.dispose():e.dispose())},Cl.prototype.dtor=function(e){for(var t=1;t<this.geoms.length;t++)this.removeGeometry(t,e);this.geoms=null,this.instanceCount=null,this.geomBoxes=null},Cl.prototype.printStats=function(){console.log("Total geometry size: "+this.geomMemory/1048576+" MB"),console.log("Number of meshes: "+(this.getCount()-1)),console.log("Num Meshes on GPU: "+this.gpuNumMeshes),console.log("Net GPU geom memory used: "+this.gpuMeshMemory)};let Xl={getVertexCount:Tl,enumMeshVertices:Hl,enumMeshIndices:Wl,enumMeshTriangles:jl,enumMeshLines:ql,enumMeshEdges:Kl};var Yl,Ql,Zl,$l;function Jl(){Yl||(Yl=new(v().Matrix4),Ql=new(v().Ray),new(v().Vector3),new(v().Vector3),new(v().Vector3),Zl=new(v().Vector3),$l=new(v().Vector3))}function ec(e,t,i){Jl();var n=e.geometry;if(n){var r=e.material,o=r?r.side:v().FrontSide;Yl.copy(e.matrixWorld).invert(),Ql.copy(t.ray).applyMatrix4(Yl);var s,a,l=t.precision||1e-4;jl(n,(function(n,r,c,u,h,d,f,p,m,g){null!==(s=o===v().BackSide?Ql.intersectTriangle(c,r,n,!0,Zl):Ql.intersectTriangle(n,r,c,o!==v().DoubleSide,Zl))&&(s.applyMatrix4(e.matrixWorld),(a=t.ray.origin.distanceTo(s))<l||a<t.near||a>t.far||(v().Triangle.getNormal(n,r,c,$l),i.push({distance:a,point:s.clone(),face:new(v().Face3)(u,h,d,$l.clone()),faceIndex:g,fragId:e.fragId,dbId:e.dbId,object:e,modelId:e.modelId})))}))}}function tc(e,t,i,n){Jl();var r=e.geometry;if(r){var o=t.params.Line.threshold;e.isWideLine&&(e.material.linewidth?o=e.material.linewidth:e.geometry.lineWidth&&(o=e.geometry.lineWidth));var s=o*o;Yl.copy(e.matrixWorld).invert(),Ql.copy(t.ray).applyMatrix4(Yl);var a=new(v().Vector3),l=new(v().Vector3);r instanceof v().BufferGeometry&&ql(r,(function(r,o,c,u,h){var d,f;if(Ql.distanceSqToSegment(r,o,l,a),a.applyMatrix4(e.matrixWorld),l.applyMatrix4(e.matrixWorld),(f=a.distanceToSquared(l))>s)return;if((d=t.ray.origin.distanceTo(a))<t.near||d>t.far)return;let p={distance:d,point:a.clone(),face:{a:c,b:u},faceIndex:h,fragId:e.fragId,dbId:e.dbId,object:e,distanceToRay:Math.sqrt(f)};n&&n.filter&&!n.filter(p)||i.push(p)}))}}function ic(e,t,i,n){e.isLine||e.isWideLine?null!=n&&n.skipLines||tc(e,t,i,n):e.isPoint?null!=n&&n.skipPoints||function(e,t,i){Jl();var n=e.geometry;if(n){Yl.copy(e.matrixWorld).invert(),Ql.copy(t.ray).applyMatrix4(Yl);var r=t.precision||1e-4,o=t.params.PointCloud.threshold;o||(o=1),o*=Math.max(3,n.pointSize),o/=4,n instanceof v().BufferGeometry&&Hl(n,(function(n,s,a,l){if(!(Ql.distanceToPoint(n)>o)){var c=Ql.closestPointToPoint(n);if(null!==c){c.applyMatrix4(e.matrixWorld);var u=t.ray.origin.distanceTo(c);u<r||u<t.near||u>t.far||i.push({distance:u,point:n,face:{a:l},faceIndex:l,fragId:e.fragId,dbId:e.dbId,object:e})}}}))}}(e,t,i):null!=n&&n.skipMeshes||ec(e,t,i)}function nc(e,t,i,n){if(e instanceof v().Mesh?ic(e,t,i):e.raycast(t,i),!0===n)for(var r=e.children,o=0,s=r.length;o<s;o++)nc(r[o],t,i,!0)}var rc=function(e,t){return e.distance-t.distance};let oc={meshRayCast:ec,lineRayCast:tc,rayCast:ic,intersectObject:function(e,t,i,n){nc(e,t,i,n),i.sort(rc)}};var sc=[[1,5,4,7,3,2,6],[0,3,2,1,5,4,6],[0,3,2,6,5,4,6],[0,4,7,3,2,1,6],[0,3,2,1,-1,-1,4],[0,3,2,6,5,1,6],[0,4,7,6,2,1,6],[0,3,7,6,2,1,6],[0,3,7,6,5,1,6],[0,1,5,4,7,3,6],[0,1,5,4,-1,-1,4],[0,1,2,6,5,4,6],[0,4,7,3,-1,-1,4],[-1,-1,-1,-1,-1,-1,0],[1,2,6,5,-1,-1,4],[0,4,7,6,2,3,6],[2,3,7,6,-1,-1,4],[1,2,3,7,6,5,6],[0,1,5,6,7,3,6],[0,1,5,6,7,4,6],[0,1,2,6,7,4,6],[0,4,5,6,7,3,6],[4,5,6,7,-1,-1,4],[1,2,6,7,4,5,6],[0,4,5,6,2,3,6],[2,3,7,4,5,6,6],[1,2,3,7,4,5,6]];function ac(){this.frustum=new(v().Frustum),this.viewProj=new(v().Matrix4),this.viewDir=[0,0,1],this.ar=1,this.viewport=new(v().Vector3)(1,1,1),this.areaConv=1,this.areaCullThreshold=1,this.eye=new(v().Vector3),this.perspective=!1,this.projScale=1}const lc=0,cc=1,uc=2,hc=-1;var dc,fc;function pc(e,t,i){return i.x=1&t?e.max.x:e.min.x,i.y=2&t?e.max.y:e.min.y,i.z=4&t?e.max.z:e.min.z,i}ac.OUTSIDE=lc,ac.INTERSECTS=cc,ac.CONTAINS=uc,ac.CONTAINMENT_UNKNOWN=hc,ac.prototype.reset=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.viewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.perspective=e.isPerspective,this.frustum.setFromProjectionMatrix(this.viewProj);var n=e.matrixWorldInverse.elements;this.ar=e.aspect,this.viewDir[0]=-n[2],this.viewDir[1]=-n[6],this.viewDir[2]=-n[10],this.eye.x=e.position.x,this.eye.y=e.position.y,this.eye.z=e.position.z,this.areaConv=e.clientWidth*e.clientHeight/4,this.cutPlanes=t,this.cutplanesHideInterior=i,this.perspective?this.projScale=e.clientHeight/(2*Math.tan(v().Math.degToRad(e.fov/2))):this.projScale=e.clientHeight/e.orthoScale},ac.prototype.projectedArea=function(){var e=[new(v().Vector3),new(v().Vector3),new(v().Vector3),new(v().Vector3),new(v().Vector3),new(v().Vector3),new(v().Vector3),new(v().Vector3)],t=new(v().Box2);function i(e,t){var i=e.x,n=e.y,r=e.z,o=t.elements,s=o[3]*i+o[7]*n+o[11]*r+o[15];s<0&&(s=-s);var a=1/s;e.x=(o[0]*i+o[4]*n+o[8]*r+o[12])*a,e.y=(o[1]*i+o[5]*n+o[9]*r+o[13])*a}return function(n){if(n.isEmpty())return 0;var r=this.viewProj;e[0].set(n.min.x,n.min.y,n.min.z),e[1].set(n.min.x,n.min.y,n.max.z),e[2].set(n.min.x,n.max.y,n.min.z),e[3].set(n.min.x,n.max.y,n.max.z),e[4].set(n.max.x,n.min.y,n.min.z),e[5].set(n.max.x,n.min.y,n.max.z),e[6].set(n.max.x,n.max.y,n.min.z),e[7].set(n.max.x,n.max.y,n.max.z);for(var o=0;o<8;o++)i(e[o],r);return t.makeEmpty(),t.setFromPoints(e),t.min.x<-1&&(t.min.x=-1),t.min.x>1&&(t.min.x=1),t.min.y<-1&&(t.min.y=-1),t.min.y>1&&(t.min.y=1),t.max.x>1&&(t.max.x=1),t.max.x<-1&&(t.max.x=-1),t.max.y>1&&(t.max.y=1),t.max.y<-1&&(t.max.y=-1),(t.max.x-t.min.x)*(t.max.y-t.min.y)}}(),ac.prototype.projectedBoxArea=function(){for(var e,t=[],i=[],n=0;n<10;n++)t.push(new(v().Vector3)),i.push(new(v().Vector3));function r(e,t){var i=e.x,n=e.y,r=e.z,o=t.elements,s=o[3]*i+o[7]*n+o[11]*r+o[15];s<0&&(s=-s);var a=1/s;e.x=(o[0]*i+o[4]*n+o[8]*r+o[12])*a,e.y=(o[1]*i+o[5]*n+o[9]*r+o[13])*a}return function(n,o){if(n.isEmpty())return 0;var s,a=this.viewProj;if(this.perspective?(s=this.eye.x>=n.min.x?this.eye.x>n.max.x?2:1:0,this.eye.y>=n.min.y&&(s+=this.eye.y>n.max.y?6:3),this.eye.z>=n.min.z&&(s+=this.eye.z>n.max.z?18:9)):(s=this.viewDir[0]<=0?this.viewDir[0]<0?2:1:0,this.viewDir[1]<=0&&(s+=this.viewDir[1]<0?6:3),this.viewDir[2]<=0&&(s+=this.viewDir[2]<0?18:9)),13===s)return 4;var l,c=sc[s][6];for(l=0;l<c;l++){var u=sc[s][l];t[l].set((u+1)%4<2?n.min.x:n.max.x,u%4<2?n.min.y:n.max.y,u<4?n.min.z:n.max.z),r(t[l],a)}var h=0;if(o)for(h=(t[c-1].x-t[0].x)*(t[c-1].y+t[0].y),l=0;l<c-1;l++)h+=(t[l].x-t[l+1].x)*(t[l].y+t[l+1].y);else{var d=function(t,n){var r,o,s,a,l,c,u,h,d=t,f=i,p=function(e){switch(u){case 0:return e.x>=-1;case 1:return e.x<=1;case 2:return e.y>=-1;case 3:return e.y<=1}},m=function(e){f[h].x=e.x,f[h++].y=e.y},g=function(){var e,t;switch(u){case 0:e=-1,t=o.y+(s.y-o.y)*(e-o.x)/(s.x-o.x);break;case 1:e=1,t=o.y+(s.y-o.y)*(e-o.x)/(s.x-o.x);break;case 2:t=-1,e=o.x+(s.x-o.x)*(t-o.y)/(s.y-o.y);break;case 3:t=1,e=o.x+(s.x-o.x)*(t-o.y)/(s.y-o.y)}f[h].x=e,f[h++].y=t};for(u=0;u<4&&n>2;u++){for(h=0,a=p(o=d[n-1]),c=0;c<n;c++)l=p(s=d[c]),a?l?m(s):g():l&&(g(),m(s)),o=s,a=l;n=h,r=d,d=f,f=r}return e=n,d}(t,c);if(e>=3)for(h=(d[e-1].x-d[0].x)*(d[e-1].y+d[0].y),l=0;l<e-1;l++)h+=(d[l].x-d[l+1].x)*(d[l].y+d[l+1].y)}return Math.abs(.5*h)}}(),ac.prototype.estimateDepth=function(e){var t=this.viewProj.elements,i=(e.min.x+e.max.x)/2,n=(e.min.y+e.max.y)/2,r=(e.min.z+e.max.z)/2,o=1/(t[3]*i+t[7]*n+t[11]*r+t[15]);return(t[2]*i+t[6]*n+t[10]*r+t[14])*o},ac.prototype.estimateProjectedDiameter=function(e){const t=(e.min.x+e.max.x)/2,i=(e.min.y+e.max.y)/2,n=(e.min.z+e.max.z)/2,r=Math.max(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z);return this.estimateProjectedDiameterCenterDiameter(t,i,n,r)},ac.prototype.estimateProjectedDiameterCenterDiameter=function(e,t,i,n){if(this.perspective){const r=(e-this.eye.x)*this.viewDir[0]+(t-this.eye.y)*this.viewDir[1]+(i-this.eye.z)*this.viewDir[2];return n<r?n*this.projScale/r:this.projScale}return n*this.projScale},ac.prototype.intersectsBox=(dc=new(v().Vector3),fc=new(v().Vector3),function(e){for(var t=this.frustum.planes,i=0,n=0;n<6;n++){var r=t[n];dc.x=r.normal.x>0?e.min.x:e.max.x,fc.x=r.normal.x>0?e.max.x:e.min.x,dc.y=r.normal.y>0?e.min.y:e.max.y,fc.y=r.normal.y>0?e.max.y:e.min.y,dc.z=r.normal.z>0?e.min.z:e.max.z,fc.z=r.normal.z>0?e.max.z:e.min.z;var o=r.distanceToPoint(dc),s=r.distanceToPoint(fc);if(o<0&&s<0)return ac.OUTSIDE;o>0&&s>0&&i++}return 6==i?ac.CONTAINS:ac.INTERSECTS});var mc=function(){var e;return function(t,i){e||(e=new(v().Vector3));for(var n=0;n<8;n++){var r=pc(t,n,e);if(s=i,!((o=r).x*s.x+o.y*s.y+o.z*s.z+s.w>1e-6))return!1}var o,s;return!0}}();let gc;ac.prototype.boxOutsideCutPlanes=function(e){if(this.cutplanesHideInterior||!this.cutPlanes)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];gc||(gc=new(v().Vector4));let i=0;for(let n=0;n<t.length;n++)gc.copy(t[n]).negate(),mc(e,gc)&&i++;return t.length>3&&i===t.length}(e,this.cutPlanes);for(var t=0;t<this.cutPlanes.length;t++){var i=this.cutPlanes[t];if(mc(e,i))return!0}return!1};var vc={RENDER_NORMAL:0,RENDER_HIGHLIGHTED:1,RENDER_HIDDEN:2,RENDER_SHADOWMAP:3,RENDER_FINISHED:4};let yc=function(e,t){this.min=void 0!==e?e:new rl(1/0,1/0,1/0),this.max=void 0!==t?t:new rl(-1/0,-1/0,-1/0)};var bc,xc;yc.prototype={constructor:yc,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromArray:function(e,t){return this.min.x=e[t],this.min.y=e[t+1],this.min.z=e[t+2],this.max.x=e[t+3],this.max.y=e[t+4],this.max.z=e[t+5],this},copyToArray:function(e,t){e[t]=this.min.x,e[t+1]=this.min.y,e[t+2]=this.min.z,e[t+3]=this.max.x,e[t+4]=this.max.y,e[t+5]=this.max.z},setFromCenterAndSize:function(){var e=new rl;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},isEmpty:function(){return this.empty()},center:function(e){return console.warn("LmvBox3.center() is deprecated. Use LmvBox3.getCenter() instead."),this.getCenter(e)},getCenter:function(e){return(e||new rl).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new rl).subVectors(this.max,this.min)},getSize:function(e){return(e||new rl).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new rl).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsBox:function(e){return this.isIntersectionBox(e)},clampPoint:function(e,t){return(t||new rl).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new rl;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(bc=new rl,xc=new rl,function(e){for(var t=e.elements,i=0;i<3;i++){let e=t[12+i],s=e;for(var n=0;n<3;n++){var r=t[i+4*n]*this.min.getComponent(n),o=t[i+4*n]*this.max.getComponent(n);e+=Math.min(r,o),s+=Math.max(r,o)}bc.setComponent(i,e),xc.setComponent(i,s)}return this.min.copy(bc),this.max.copy(xc),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};var _c=new yc,Ec=null;class Sc{creatorIterator;frags;start;count;lastItem;overrideMaterial=null;sortDone=!1;numAdded=0;numAddedTotal=0;avgFrameTime=void 0;nodeIndex=void 0;bboxes=new Array(12);sortObjects=!1;sortByShaderDone=!1;fragOrderChangedCallbacks=[];frustumCulled=!0;forceVisible=!1;renderImmediate;renderImportance=0;isComplete=!1;useRenderBundles=!1;#v;deadline=void 0;interruptedAtIndex=void 0;interruptedInvocationCounter=void 0;interruptedSortByShaderPossibleFlag=void 0;invocationCounter=void 0;allowInterruption=!sn||Ji;constructor(e,t,i,n,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;this.creatorIterator=e,this.frags=t,this.start=i,this.count=n,this.lastItem=i,this.indices=r,this.largestFragSize=o,this.sizeType=s,this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,this.renderImmediate=!t.useThreeMesh,this.lastGPUTimes=[0,0,0,0,0],this.lastGPUTimesCounter=0,this.lastGPUTimesChanged=!1}get avgGPUTimeMS(){let e=0,t=0;for(let i=0;i<this.lastGPUTimes.length;i++)0!==this.lastGPUTimes[i]&&(e+=this.lastGPUTimes[i],t++);return 0===t?0:e/t}clone(){const e=new Sc(this.creatorIterator,this.frags,this.start,this.count,this.indices);return e.sortDone=this.sortDone,e.sortByShaderDone=this.sortByShaderDone,e.lastItem=this.lastItem,e.visibleStats=this.visibleStats,e.numAdded=this.numAdded,e.numAddedTotal=this.numAddedTotal,e.bboxes=this.bboxes.slice(),e}setDeadline(e){this.deadline=e,this.invocationCounter=0}hasBeenInterrupted(){return void 0!==this.interruptedAtIndex}resetInterrupted(){this.interruptedAtIndex=void 0,this.interruptedInvocationCounter=void 0,this.interruptedSortByShaderPossibleFlag=void 0}getIndices(){return this.indices??this.creatorIterator.getFragOrder()}registerFragOrderChangedCallback=function(e){this.fragOrderChangedCallbacks.push(e)};removeFragOrderChangedCallback=function(e){const t=this.fragOrderChangedCallbacks.indexOf(e);-1!==t&&this.fragOrderChangedCallbacks.splice(t,1)};sortByMaterial(){if(!(this.numAdded<this.count)){var e=this.frags,t=this.getIndices();if(t){var i=t.subarray(this.start,this.start+this.count);Array.prototype.sort.call(i,(function(t,i){var n=e.getMaterialId(t),r=e.getMaterialId(i);return void 0===n?r?1:0:void 0===r?-1:n-r})),this.numAdded=0,this.sortDone=!0;for(const e of this.fragOrderChangedCallbacks)e(this.start,this.lastItem-this.start,this)}else rt.warn("Only indexed RenderSubsets can be sorted.")}}sortByShader(){if(this.sortDone&&!this.sortByShaderDone){var e=this.frags,t=this.getIndices().subarray(this.start,this.start+this.count);Array.prototype.sort.call(t,(function(t,i){var n=e.getMaterial(t),r=e.getMaterial(i),o=n.program.id-r.program.id;return o||n.id-r.id})),this.numAdded=0,this.sortByShaderDone=!0}}sortByVertexBuffer(e,t){if(this.sortByVBDone)return;let i=this.frags,n=this.getIndices().subarray(e,t);Array.prototype.sort.call(n,(function(e,t){var n,r,o,s,a,l;let c=i.getGeometry(e),u=i.getGeometry(t),h=c?null===(n=c.__gpuvb)||void 0===n?void 0:n.id:Number.MAX_SAFE_INTEGER,d=u?null===(r=u.__gpuvb)||void 0===r?void 0:r.id:Number.MAX_SAFE_INTEGER;if(void 0!==h&&void 0!==d||console.log("sorting too early"),h<d)return-1;if(h>d)return 1;let f=c?null===(o=c.__gpuib)||void 0===o?void 0:o.id:Number.MAX_SAFE_INTEGER,p=u?null===(s=u.__gpuib)||void 0===s?void 0:s.id:Number.MAX_SAFE_INTEGER;return f<p?-1:f>p?1:((null===(a=i.getMaterial(e))||void 0===a?void 0:a.id)??Number.MAX_SAFE_INTEGER)-((null===(l=i.getMaterial(t))||void 0===l?void 0:l.id)??Number.MAX_SAFE_INTEGER)})),this.numAdded=0,this.sortByVBDone=!0,this.sortDone=!0;for(const e of this.fragOrderChangedCallbacks)e(this.start,this.lastItem-this.start,this)}sortByDepth(e){var t=this.frags,i=this.getIndices(),n=e,r=_c;if(i){(!Ec||Ec.length<this.count)&&(Ec=new Float32Array(this.count));var o,s,a=Ec,l=this.start;this.forEachNoMesh(((e,i)=>{t.hasGeometry(e)?(t.getWorldBounds(e,r),a[i]=n.estimateDepth(r)):a[i]=-1/0}));for(var c=1;c<this.count;c++)for(var u=c;u>0&&a[u-1]<a[u];)o=a[u-1],a[u-1]=a[u],a[u]=o,s=i[l+u-1],i[l+u-1]=i[l+u],i[l+u]=s,u--;for(const e of this.fragOrderChangedCallbacks)e(this.start,this.lastItem-this.start,this)}else rt.warn("Only indexed RenderSubsets can be sorted.")}addToBox(e,t){var i=t?6:0,n=this.bboxes;n[0+i]=Math.min(n[0+i],e.min.x),n[1+i]=Math.min(n[1+i],e.min.y),n[2+i]=Math.min(n[2+i],e.min.z),n[3+i]=Math.max(n[3+i],e.max.x),n[4+i]=Math.max(n[4+i],e.max.y),n[5+i]=Math.max(n[5+i],e.max.z)}getBoundingBox(e){e=e||_c;var t=this.bboxes;return e.min.x=t[0],e.min.y=t[1],e.min.z=t[2],e.max.x=t[3],e.max.y=t[4],e.max.z=t[5],e}getBoundingBoxHidden(e){e=e||_c;var t=this.bboxes;return e.min.x=t[6],e.min.y=t[7],e.min.z=t[8],e.max.x=t[9],e.max.y=t[10],e.max.z=t[11],e}onFragmentAdded(e){this.frags.getWorldBounds(e,_c),this.addToBox(_c,!1),this.sortDone=!1,this.lastItem<=e&&(this.lastItem=e+1,void 0!==this.visibleStats&&(this.visibleStats=0)),this.numAdded++,this.numAddedTotal++}forEach(e,t,i){this.invocationCounter++;const n=void 0!==this.deadline?this.interruptedAtIndex:void 0;if(void 0===n||this.interruptedInvocationCounter===this.invocationCounter){this.interruptedAtIndex=void 0,this.numFragsStreamingDraw=0;var r,o,s,a,l=this.getIndices(),c=this.frags,u=!this.sortByShaderDone;if(t||i||u){const h=Object.prototype.hasOwnProperty.call(this,"drawStart");for(void 0!==this.interruptedSortByShaderPossibleFlag&&(u=this.interruptedSortByShaderPossibleFlag),r=void 0!==n?n:t===ll.MESH_RENDERFLAG&&h?this.drawStart:this.start,o=this.lastItem;r<o;r++)if(s=l?l[r]:r,a=c.getVizmesh(s),!u||a&&a.material&&a.material.program||(u=!1),!(i||a&&a.geometry&&a.material)||t&&!c.isFlagSet(s,t)||(a.geometry.streamingDraw&&this.numFragsStreamingDraw++,e(a,s)),this.shouldInterrupt(r,!1))return void(this.interruptedSortByShaderPossibleFlag=u)}else{for(r=void 0!==n?n:this.start,o=this.lastItem;r<o;r++)if(s=l?l[r]:r,(a=c.getVizmesh(s))&&a.geometry&&a.material&&(a.geometry.streamingDraw&&this.numFragsStreamingDraw++,e(a,s)),this.shouldInterrupt(r,!1))return}u&&this.sortByShader()}}is2d(){return this.frags.is2d}shouldInterrupt(e,t){return!!this.allowInterruption&&(!!(t||void 0!==this.deadline&&e%10==0&&performance.now()>this.deadline)&&(this.interruptedAtIndex=e,this.interruptedInvocationCounter=this.invocationCounter,!0))}forEachWGPU(e,t,i){const n=0|(this.forceVisible?ll.MESH_VISIBLE:ll.MESH_RENDERFLAG),r=this.getIndices(),o=this.frags;let s=!0,a=e||this.start;this.allowInterruption&&(a=this.interruptedAtIndex||a,this.interruptedAtIndex=void 0);let l=this.lastItem;t&&(l=Math.min(l,a+t));const c=o.geoms.geoms,u=o.vizflags,h=o.geomids,d=o.materialIdMap,f=o.materialids;let p;this.numFragsStreamingDraw=0;let m=this.is2d();const g=this.numAddedTotal==this.count;if(this.isComplete)for(this.sortByVBDone||Ji||this.sortByVertexBuffer(a,l),p=a;p<l;p++){const e=r[p];if(!(u[e]&n))continue;let t,s=!1;if(m){let n=o.vizmeshes[e];t=n.geometry,n&&(s=i(n))}else t=c[h[e]],s=i(t,d[f[e]],p,e);if(!s&&t.streamingDraw&&this.numFragsStreamingDraw++,this.shouldInterrupt(p,s))return-1}else{for(p=a;p<l;p++){var v;const e=0|r[p];if(!o.isFragmentActive(e)){!m&&0===h[e]||(s=!1);continue}const t=m?null===(v=o.vizmeshes[e])||void 0===v?void 0:v.geometry:c[h[e]];t.__gpuvb||(s=!1);if(!(u[e]&n))continue;let a=!1;if(m){let t=o.vizmeshes[e];t&&(a=i(t))}else a=i(t,d[f[e]],p,e);if(!a&&t.streamingDraw&&this.numFragsStreamingDraw++,this.shouldInterrupt(p,a))return-1}s&&g&&!Ji&&(this.isComplete=!0,this.allowInterruption||(this.useRenderBundles=!this.sortObjects))}return p===this.lastItem?-1:p}forEachNoMesh(e,t,i){for(var n=this.getIndices(),r=this.frags,o=this.start,s=this.lastItem;o<s;o++){var a=n?n[o]:o;!i&&!r.hasGeometry(a)||t&&!r.isFlagSet(a,t)||e(a,o-this.start)}}raycast(e,t,i,n){!1!==e.ray.intersectsBox(this.getBoundingBox())&&this.forEach(((r,o)=>{if(!this.frags.isFlagSet(o,ll.MESH_HIDE)){if(i&&i.length){var s=0|this.frags.getDbIds(o);if(-1===i.indexOf(s))return}this.frags.getWorldBounds(o,_c),_c.expandByScalar(.5),e.ray.intersectsBox(_c)&&oc.rayCast(r,e,t,n)}}),ll.MESH_VISIBLE)}intersectFrustum(e,t,i){if(!i){let t=e.intersectsBox(this.getBoundingBox());if(t===ac.OUTSIDE)return;t===ac.CONTAINS&&(i=!0)}this.forEach(((n,r)=>{if(this.frags.isFlagSet(r,ll.MESH_HIDE))return;if(i)return void t(r,i);this.frags.getWorldBounds(r,_c);let o=e.intersectsBox(_c);o!==ac.OUTSIDE&&t(r,o===ac.CONTAINS)}),ll.MESH_VISIBLE)}calculateBounds(){this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,this.forEachNoMesh((e=>{this.frags.getWorldBounds(e,_c);var t=this.frags.vizflags[e];this.addToBox(_c,!(1&t))}),0,!0)}applyVisibility(e,t){let i,n,r,o,s,a,l,c;function u(e){var t=!1;return i.getWorldBounds(e,_c),s&&!r.intersectsBox(_c)&&(t=!0),Zi&&!t&&r.estimateProjectedDiameter(_c)<r.areaCullThreshold&&(t=!0),t||l||!r.boxOutsideCutPlanes(_c)||(t=!0),t}function h(e,t,i){let r=!1;const s=ll.MESH_RENDERFLAG,a=n[e]&~s;switch(o){case vc.RENDER_HIDDEN:r=!(a&ll.MESH_VISIBLE);break;case vc.RENDER_HIGHLIGHTED:r=a&ll.MESH_HIGHLIGHTED;break;default:r=1==(a&(ll.MESH_VISIBLE|ll.MESH_HIGHLIGHTED|ll.MESH_HIDE))}if(t){const e=a&(ll.MESH_ISLINE|ll.MESH_ISWIDELINE);r=r&&!e}if(i){const e=a&ll.MESH_ISPOINT;r=r&&!e}return n[e]=a|(r?s:0),r}a=!0,r=t,o=e;var d=o===vc.RENDER_HIDDEN?this.getBoundingBoxHidden():this.getBoundingBox(),f=r.intersectsBox(d);if(f===ac.OUTSIDE)return a;if(Zi&&r.estimateProjectedDiameter(d)<r.areaCullThreshold)return a;if(Ji&&Zi&&this.largestFragSize){const e=r.eye.clone().clamp(d.min,d.max);let t=0;t=this.sizeType===Autodesk.Viewing.Private.BVHSortFuncType.DIAMETER?this.largestFragSize:this.largestFragSize/2;const i=Math.sqrt(t);if(r.estimateProjectedDiameterCenterDiameter(e.x,e.y,e.z,i)<r.areaCullThreshold)return a}return l=this.frags.doNotCut,!l&&t.boxOutsideCutPlanes(d)?a:(n=this.frags.vizflags,i=this.frags,s=f!==ac.CONTAINS,c=this.useRenderBundles,i.useThreeMesh?this.forEach((function(e,t){if(!e&&i.useThreeMesh||!e.geometry)return;if(u(t))return e?e.visible=!1:rt.warn("Unexpected null mesh"),void(n[t]=n[t]&~ll.MESH_RENDERFLAG);const r=h(t,i.linesHidden,i.pointsHidden);e&&(e.visible=!!r),a=a&&!r}),null):this.forEachNoMesh((function(e){if(!c&&u(e))return void(n[e]=n[e]&~ll.MESH_RENDERFLAG);const t=h(e,i.linesHidden,i.pointsHidden);a=a&&!t}),0,!1),i=null,!(Ji&&this instanceof Ac)&&a)}render(e){e(this)}addTimestamp(e){this.lastGPUTimes[this.lastGPUTimesCounter]=e,this.lastGPUTimesCounter=(this.lastGPUTimesCounter+1)%this.lastGPUTimes.length,this.lastGPUTimesChanged=!0}}class Ac extends Sc{constructor(e,t,i){var n;const r=new Int32Array(null===(n=i.nodeId2SingleFragIds)||void 0===n?void 0:n[t.nodeIndex]);super(e,t.frags,0,r.length,r),this.lastItem=this.count,this.bboxes=t.bboxes,this.consolidatedScene=new THREE.Scene,this.sortDone=!1,this.nodeIndex=t.nodeIndex,this._modelId=void 0,this.largestFragSize=t.largestFragSize,this.originalRenderBatch=t}render(e){this.hasBeenInterrupted()?e(this):(e(this,this.consolidatedScene),this.creatorIterator.onRenderBatchComplete(this))}set modelId(e){this._modelId=e,this.consolidatedScene.modelId=e}get modelId(){return this._modelId}}var wc={};function Cc(e,t,i){var n,r=t.normalize||t.normalized;if(t.array)n=new(v().BufferAttribute)(t.array,t.itemSize);else{var o=e+"|"+t.bytesPerItem+"|"+r+"|"+t.isPattern+"|"+t.divisor+"|"+t.offset;if(n=wc[o])return n;n=new(v().BufferAttribute)(void 0,t.itemSize),wc[o]=n}return n.normalized=r,n.bytesPerItem=t.bytesPerItem,n.isPattern=t.isPattern,i&&(n.divisor=t.divisor),t.array||(Object.prototype.hasOwnProperty.call(t,"offset")?n.offset=t.offset:rt.warn("VB attribute is neither interleaved nor separate. Something is wrong with the buffer specificaiton.")),n}var Tc,Mc,Ic={};var Pc=1,Lc=function(){this.id=Pc++,this.attributes={},this.__webglInit=void 0,Ji&&(this.streamingDraw=this.streamingIndex=!0)};function Rc(e){return Tc||((Tc=new(v().BufferAttribute)(void 0,1)).bytesPerItem=2,(Mc=new(v().BufferAttribute)(void 0,1)).bytesPerItem=4),new Lc}function Dc(e){var t=e.mesh,i=Rc(t.numInstances);for(var n in S()&&(i.packId=e.packId,i.meshIndex=e.meshIndex),i.byteSize=0,i.vb=t.vb,i.vbbuffer=void 0,i.vbNeedsUpdate=!0,i.vbstride=t.vbstride,i.byteSize+=t.vb.byteLength,i.hash=e.hash,t.isLines&&(i.isLines=t.isLines),t.isWideLines&&(i.isWideLines=!0,i.lineWidth=t.lineWidth),t.isPoints&&(i.isPoints=t.isPoints,i.pointSize=t.pointSize),e.is2d&&(i.is2d=!0),i.numInstances=t.numInstances,t.vblayout){var r=t.vblayout[n];i.attributes[n]=Cc(n,r,t.numInstances)}return i.index=t.indices instanceof Uint32Array?Mc:Tc,i.ib=t.indices,i.ibbuffer=void 0,t.iblines&&(i.attributes.indexlines=t.iblines instanceof Uint32Array?Mc:Tc,i.iblines=t.iblines,i.iblinesbuffer=void 0),i.attributesKeys=function(e){var t="";for(var i in e.attributes)t+=i+"|";var n=Ic[t];return n||(n=Object.keys(e.attributes),Ic[t]=n,n)}(i),i.byteSize+=t.indices.byteLength,t.boundingBox&&(i.boundingBox=(new(v().Box3)).copy(t.boundingBox),i.boundingSphere=(new(v().Sphere)).copy(t.boundingSphere)),i}Lc.prototype=Object.create(v().BufferGeometry.prototype),Lc.prototype.clone=function(){const e=new Lc;e.ib=this.ib,e.vb=this.vb,e.vbstride=this.vbstride,e.byteSize=this.byteSize,e.isLines=this.isLines,e.isWideLines=this.isWideLines,e.lineWidth=this.lineWidth,e.isPoints=this.isPoints,e.pointSize=this.pointSize,e.index=this.index;for(const t in this.attributes){const i=this.attributes[t],n=i.array?new i.array.constructor(this.array):void 0,r=new(v().BufferAttribute)(n,i.itemSize);r.itemOffset=i.itemOffset,r.bytesPerItem=i.bytesPerItem,r.normalized=i.normalized,e.setAttribute(t,r)}if(this.groups)for(var t=0,i=this.groups.length;t<i;t++){var n=this.groups[t];e.groups.push({start:n.start,index:n.index,count:n.count})}return e},Lc.prototype.constructor=Lc,Lc.prototype.isLeanBufferGeometry=!0,Lc.prototype.getAccurateByteSize=function(){var e,t,i;let n=0;n+=(null===(e=this.vb)||void 0===e?void 0:e.byteLength)??(void 0!==this.vbLength?4*this.vbLength:0),n+=(null===(t=this.ib)||void 0===t?void 0:t.byteLength)??(void 0!==this.ibLength?this.ibLength*this.ibByteSize:0),n+=(null===(i=this.iblines)||void 0===i?void 0:i.byteLength)??(void 0!==this.iblinesLength?this.iblinesLength*iblinesByteSize:0);for(let e of Object.values(this.attributes)){var r;n+=(null===(r=e.array)||void 0===r?void 0:r.byteLength)??(e.arrayLength?e.arrayLength*e.arrayByteSize:0)}return n};let Oc={meshToGeometry:Dc,createBufferGeometry:Rc,findBufferAttribute:Cc,interleaveGeometry:function(e,t){if(e.vb&&!e.vbNeedsUpdate)return;let i={},n=0,r=e.attributes,o=r.position;o&&(i.position=Cc("position",{offset:n,bytesPerItem:4,itemSize:3}),n+=3);let s=r.normal;s&&(t||2===s.bytesPerItem?(i.normal=Cc("normal",{offset:n,bytesPerItem:2,itemSize:2}),n+=1):(i.normal=Cc("normal",{offset:n,bytesPerItem:4,itemSize:3}),n+=3));let a=r.uv;a&&(i.uv=Cc("uv",{offset:n,bytesPerItem:4,itemSize:2}),n+=2);let l,c,u=n,h=o.array.length/(o.array.itemSize||3),d=new Float32Array(h*u),f=new Uint16Array(d.buffer);if(o){let e=0,t=o.array;for(let i=0;i<h;i++,e+=u)d[e]=t[3*i],d[e+1]=t[3*i+1],d[e+2]=t[3*i+2]}if(s)if(2===s.itemSize){let e=2*i.normal.itemOffset,t=s.array;for(let i=0;i<h;i++,e+=2*u)f[e]=t[2*i],f[e+1]=t[2*i+1]}else if(t){let e=2*i.normal.itemOffset,t=s.array;for(let i=0;i<h;i++,e+=2*u){let n=t[3*i],r=t[3*i+1],o=t[3*i+2];f[e]=.5*(Math.atan2(r,n)/Math.PI+1)*65535|0,f[e+1]=.5*(o+1)*65535|0}}else{let e=i.normal.itemOffset,t=s.array;for(let i=0;i<h;i++,e+=u)d[e]=t[3*i],d[e+1]=t[3*i+1],d[e+2]=t[3*i+2]}if(a){let e=i.uv.itemOffset,t=a.array;for(let i=0;i<h;i++,e+=u)d[e]=t[2*i],d[e+1]=t[2*i+1]}if(e.attributes.index)l=r.index.array,i.index=Tc;else{l=new Uint16Array(h);for(let e=0;e<h;e++)l[e]=e;i.index=Tc}e.attributes.indexlines&&(c=r.indexlines.array,i.indexlines=Tc),e.vbstride=u,e.vb=d,e.ib=l,e.iblines=c,e.attributesInterleaved=i,e.vbNeedsUpdate=!1}};function Bc(e){var t;if(!e)return 0;return((null===(t=e.attributes.index)||void 0===t?void 0:t.array)||e.ib).length/3||0}function Nc(e){var t,i,n;return((null===(t=e.vb)||void 0===t?void 0:t.byteLength)||0)+((null===(i=e.ib)||void 0===i?void 0:i.byteLength)||0)+((null===(n=e.iblines)||void 0===n?void 0:n.byteLength)||0)}var Uc=1;function kc(){this.vb=null,this.vbstride=0,this.posOffset=0,this.normalOffset=0,this.matrices=null,this.ranges=null,this.dbIds=null,this.id=Uc++}function Fc(e){e.x=.5*(1+Math.atan2(e.y,e.x)/Math.PI),e.y=.5*(1+e.z),e.z=0}function Vc(e){var t=2*e.x-1,i=2*e.y-1,n=Math.sin(t*Math.PI),r=Math.cos(t*Math.PI),o=Math.sqrt(1-i*i),s=i;e.x=r*o,e.y=n*o,e.z=s}function Gc(e,t,i){t[i++]=255&e,t[i++]=e>>8&255,t[i++]=e>>16&255,t[i]=0}var zc=function(e,t,i,n,r,o,s){for(var a=e.posOffset,l=n;l<r;l++){var c=l*e.vbstride+a;s.set(e.vb[c],e.vb[c+1],e.vb[c+2]),s.applyMatrix4(i),e.vb[c]=s.x,e.vb[c+1]=s.y,e.vb[c+2]=s.z}if(-1!==e.normalOffset){var u=2*e.vbstride,h=2*e.normalOffset,d=function(e,t){return t.copy(e),t[12]=0,t[13]=0,t[14]=0,t.invert().transpose()}(i,o);for(l=n;l<r;l++){var f=l*u+h;s.set(t[f],t[f+1],0),s.divideScalar(65535),Vc(s),s.applyMatrix4(d),s.normalize(),Fc(s),s.multiplyScalar(65535),t[f]=s.x,t[f+1]=s.y}}};function Hc(e,t,i){for(var n=16*e,r=0;r<16;r++)i.elements[r]=t[r+n]}function Wc(e){for(var t=new Uint16Array(e.length+1),i=0,n=0;n<e.length;n++)t[n]=i,i+=Tl(e[n]);return t[n]=i,t}function jc(e,t,i,n){var r=Wc(e),o=new kc;return o.vb=t.vb,o.vbstride=t.vbstride,o.posOffset=t.attributes.position.offset,o.normalOffset=t.attributes.normal?t.attributes.normal.offset:-1,o.matrices=i,o.ranges=r,o.dbIds=n,o}function qc(e,t){t.vb=e.vb,t.attributes.id.array=e.vertexIds,t.needsUpdate=!0}function Kc(e){var t=0,i={},n=[],r=e,o=new Array(2);function s(e){for(var n=e.data,s=0;s<n.length;s++){var a=n[s],l=a.taskId;qc(a,i[l]),delete i[l]}if(0===--t)for(r.inProgress=!1,s=0;s<o.length;s++)o[s].terminate(),o[s]=null}this.addMergeTask=function(e,t,r,o){var s=jc(e,t,r,o);n.push(s),i[s.id]=t},this.runTasks=function(){for(var e=0;e<2;e++)o[e]=Kc.createWorker(),o[e].addEventListener("message",s);for(var i=n.length,a=Math.floor(i/2),l=0;l<2;l++){var c=l*a,u=1===l?i:c+a,h=[],d=new Array(4*(u-c)),f=0;for(e=c;e<u;e++){var p=n[e];d[f++]=p.vb.buffer,d[f++]=p.matrices.buffer,d[f++]=p.ranges.buffer,d[f++]=p.dbIds.buffer,h.push(p)}var m={operation:"MERGE_GEOMETRY",tasks:h};o[l].doOperation(m,d),t++}r.inProgress=!0}}function Xc(e,t,i){if(!e||!e.colors)return new(v().Color)(1,0,0);var n=e.colors[t];if(!n)return new(v().Color)(0,0,0);var r=n.values;if(!r||!r.length)return new(v().Color)(1,0,0);var o=r[0];return new(v().Color)(o.r,o.g,o.b)}function Yc(e,t,i){if(!e||!e.scalars)return i;var n=e.scalars[t];return n?n.values[0]:i}function Qc(e,t,i){if(!e||!e.booleans)return i;var n=e.booleans[t];return void 0===n?i:n}function Zc(e,t,i,n){if(!e||!e[t])return n;var r=e[t][i];return r?r.values[0]:n}function $c(e){var t=e;return t<=.0031308?t*=12.92:t=1.055*Math.pow(t,1/2.4)-.055,t}function Jc(e){var t,i,n;return t=$c(e.r),i=$c(e.g),n=$c(e.b),new(v().Color)(t,i,n)}function eu(e){var t=e;return t<=.04045?t/=12.92:t=Math.pow((t+.055)/1.055,2.4),t}function tu(e){var t,i,n;return t=eu(e.r),i=eu(e.g),n=eu(e.b),new(v().Color)(t,i,n)}function iu(e){var t=Yc(e,"texture_UScale",1),i=Yc(e,"texture_VScale",1),n=Yc(e,"texture_UOffset",0),r=Yc(e,"texture_VOffset",0),o=Yc(e,"texture_WAngle",0);return{elements:[Math.cos(o)*t,Math.sin(o)*i,0,-Math.sin(o)*t,Math.cos(o)*i,0,n,r,1]}}kc.prototype.run=function(e,t){for(var i=this.vb,n=i.length/this.vbstride,r=e.clone(),o=new Uint8Array(3*n),s=-1!==this.normalOffset?new Uint16Array(i.buffer,i.byteOffset,2*i.length):null,a=this.ranges,l=this.matrices,c=a.length-1,u=0;u<c;u++){var h=a[u],d=a[u+1];Hc(u,l,e),zc(this,s,e,h,d,r,t);for(var f=3*h,p=d-h,m=this.dbIds[u],g=0;g<p;g++)Gc(m,o,f),f+=3}return{taskId:this.id,vb:this.vb,vertexIds:o}},Kc.createWorker=fi;let nu={parseMaterialColor:Xc,parseMaterialScalar:Yc,parseMaterialBoolean:Qc,parseMaterialGeneric:Zc,SRGBToLinearFloat:eu,SRGBToLinear:tu,linearToSRGBFloat:$c,linearToSRGB:Jc,Get2DSimpleMapTransform:iu};const ru=Autodesk.Viewing;let ou={convertMaterial:function(e,t,i,n){if(au(e))return i=sn?ou.convertPrismMaterialToFallback(e,t,i,n):ou.convertPrismMaterial(e,t,i,n),e.transparent=i.transparent,i;n=n||e.userassets;var r,o,s=e.materials,a=s[n],l=a.properties;if(i){if(!(i instanceof v().MeshPhongMaterial))return null;i.needsUpdate=!0}else i=new(v().MeshPhongMaterial);if(i.proteinMat=e,i.proteinCategories=a.categories,i.packedNormals=!0,a&&"SimplePhong"===a.definition){i.tag=a.tag,i.proteinType=a.proteinType,void 0===i.proteinType&&(i.proteinType=null);var c=Qc(l,"generic_baked_lighting",!1);i.disableEnvMap=c;var u=i.ambient=Xc(l,"generic_ambient"),h=i.color=Xc(l,"generic_diffuse"),d=i.specular=Xc(l,"generic_specular"),f=i.emissive=Xc(l,"generic_emissive");i.shininess=Yc(l,"generic_glossiness",30),i.opacity=1-Yc(l,"generic_transparency",0),i.reflectivity=Yc(l,"generic_reflectivity_at_0deg",0);var p=Qc(l,"generic_bump_is_normal"),m=Yc(l,"generic_bump_amount",0);null==m&&(m=1),p?(m>1&&(m=1),i.normalScale=new(v().Vector2)(m,m)):(m>=1&&(m=.03),i.bumpScale=m);var g=Qc(l,"generic_is_metal");void 0!==g&&(i.metal=g);var y=Qc(l,"generic_backface_cull");void 0===y||y||(i.side=v().DoubleSide),i.transparent=a.transparent,i.textureMaps={};var b=a.textures;for(var x in b)if((r={}).textureObj=s[b[x].connections[0]],o=r.textureObj.properties,r.textureObj.matrix=su(r.textureObj),r.uriPointer=o.uris.unifiedbitmap_Bitmap.values,r.uri=r.uriPointer[0],r.uri){if("generic_diffuse"==x)r.mapName="map",(!i.color||0===i.color.r&&0===i.color.g&&0===i.color.b)&&i.color.setRGB(1,1,1);else if("generic_bump"==x)r.mapName=p?"normalMap":"bumpMap";else if("generic_specular"==x)r.mapName="specularMap";else{if("generic_alpha"!=x)continue;r.mapName="alphaMap",i.side=v().DoubleSide,i.transparent=!0}i.textureMaps[r.mapName]=r}0===h.r&&0===h.g&&0===h.b&&0===d.r&&0===d.g&&0===d.b&&0===u.r&&0===u.g&&0===u.b&&0===f.r&&0===f.g&&0===f.b&&(h.r=h.g=h.b=.4),i.extraDepthOffset=Yc(l,"generic_depth_offset"),i.extraDepthOffset&&(i.polygonOffset=!0,i.polygonOffsetFactor=i.extraDepthOffset,i.polygonOffsetUnits=0)}else i.ambient=new(v().Color)(197379),i.color=new(v().Color)(7829367),i.specular=new(v().Color)(3355443),i.shininess=30,i.shading=v().SmoothShading;return e.transparent=i.transparent,i},convertTexture:function(e,t,i,n){"bumpMap"==e.mapName||"normalMap"==e.mapName?t.anisotropy=0:t.anisotropy=n||0;t.flipY=void 0===e.flipY||e.flipY,t.invert=!1,t.wrapS=v().RepeatWrapping,t.wrapT=v().RepeatWrapping,t.offset=e.offset??t.offset,t.rotation=e.rotation??t.rotation??0,t.repeat=e.repeat??t.repeat,e.isPrism?ou.convertPrismTexture(e.textureObj,t,i):function(e,t){if(!e)return;var i=e.properties;t.invert=Qc(i,"unifiedbitmap_Invert"),t.clampS=!Qc(i,"texture_URepeat",!0),t.clampT=!Qc(i,"texture_VRepeat",!0),t.wrapS=t.clampS?v().ClampToEdgeWrapping:v().RepeatWrapping,t.wrapT=t.clampT?v().ClampToEdgeWrapping:v().RepeatWrapping,t.matrix=e.matrix||(e.matrix=iu(i))}(e.textureObj,t)},isPrismMaterial:au,convertMaterialGltf:function(e,t){var i=new(v().MeshPhongMaterial)({name:e.name??""});i.packedNormals=!0,i.textureMaps={},i.reflectivity=0;var n=e.pbrMetallicRoughness||{},r=n.baseColorTexture||n.baseColorFactor;if(r)if(Array.isArray(r))i.color=new(v().Color)(r[0],r[1],r[2]),i.opacity=r[3];else if("object"==typeof r){i.color=new(v().Color)(1,1,1);var o={mapName:"map"},s=t.gltf.textures[r.index];o.uri=t.gltf.images[s.source].uri,o.flipY=!1,i.textureMaps[o.mapName]=o,cu(r,o)}var a=n.metallicRoughnessTexture;if(a){o={mapName:"metallicRoughnessTexture"},s=t.gltf.textures[a.index];o.uri=t.gltf.images[s.source].uri,o.flipY=!1,i.textureMaps[o.mapName]=o,cu(a,o)}else i.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,i.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1;!0===e.doubleSided&&(i.side=v().DoubleSide);var l=e.alphaMode||lu.OPAQUE;l===lu.BLEND?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,l===lu.MASK&&(i.alphaTest=void 0!==e.alphaCutoff?e.alphaCutoff:.5));if(void 0!==e.normalTexture){o={mapName:"normalTexture"},s=t.gltf.textures[e.normalTexture.index];o.uri=s.source,o.flipY=!1,o.uri=t.gltf.images[s.source].uri,cu(e.normalTexture,o),i.normalScale=o.repeat,void 0!==e.normalTexture.scale&&i.normalScale.set(e.normalTexture.scale,e.normalTexture.scale)}if(void 0!==e.occlusionTexture){o={mapName:"occlusionTexture"},s=t.gltf.textures[e.occlusionTexture.index];o.uri=t.gltf.images[s.source].uri,o.flipY=!1,i.textureMaps[o.mapName]=o,void 0!==e.occlusionTexture.strength&&(i.aoMapIntensity=e.occlusionTexture.strength),cu(e.occlusionTexture,o)}void 0!==e.emissiveFactor&&(i.emissive=(new(v().Color)).fromArray(e.emissiveFactor));if(void 0!==e.emissiveTexture){o={mapName:"emissiveTexture"},s=t.gltf.textures[e.emissiveTexture.index];o.uri=t.gltf.images[s.source].uri,o.flipY=!1,i.textureMaps[o.mapName]=o,cu(e.emissiveTexture,o)}return i},applyAppearanceHeuristics:function(e,t,i){var n=e.proteinMat?e.proteinMat:null,r=e.prismType&&-1!==e.prismType.indexOf("Prism");r&&e.transparent&&(e.side===v().FrontSide&&"PrismGlazing"!==e.prismType&&(e.side=v().DoubleSide),e.side===v().DoubleSide&&e.depthTest&&(e.twoPassTransparency=!0));var o=e.textureMaps||{};if(!t){var s,a=e.proteinType&&-1!==e.proteinType.indexOf("Prism");if(e.metal)e.reflectivity||(e.reflectivity=uu(e.specular)),n&&(1===e.reflectivity&&(e.reflectivity=uu(e.specular)),0===e.color.r&&0===e.color.g&&0===e.color.b||(e.color.r*=.1,e.color.g*=.1,e.color.b*=.1));else if(a){var l=!1;if("PrismLayered"===e.proteinType){e.clearcoat=!0,e.reflectivity=.06;var c=e.proteinCategories;c&&c.length&&-1!=c[0].indexOf("Metal")&&(l=!0)}e.reflectivity=Math.sqrt(e.reflectivity),l?e.specular.copy(e.color):(e.specular.r=e.reflectivity,e.specular.g=e.reflectivity,e.specular.b=e.reflectivity)}else e.reflectivity?e.reflectivity>.3?(e.metal=!0,e.specular.r=e.color.r,e.specular.g=e.color.g,e.specular.b=e.color.b,e.color.r*=.1,e.color.g*=.1,e.color.b*=.1):(e.specular.r*=e.reflectivity,e.specular.g*=e.reflectivity,e.specular.b*=e.reflectivity):1!==e.color.r||1!==e.color.g||1!==e.color.b||1!==e.specular.r||1!==e.specular.g||1!==e.specular.b||o.map||o.specularMap?(e.reflectivity=.01+.06*uu(e.specular),e.specular.r*=e.reflectivity,e.specular.g*=e.reflectivity,e.specular.b*=e.reflectivity):(e.metal=!0,e.reflectivity=.7,e.color.r*=.1,e.color.g*=.1,e.color.b*=.1),e.opacity<1&&(e.reflectivity=1);(e.transparent||-1!==(null===(s=o.map)||void 0===s||null===(s=s.uri)||void 0===s?void 0:s.toLowerCase().indexOf(".png"))||o.alphaMap)&&(e.alphaTest=.01)}if(o.normalMap){var u=e.bumpScale;(void 0===u||u>=1)&&(u=1),e.normalScale=new(v().Vector2)(u,u)}else(void 0===e.bumpScale&&(o.map||o.bumpMap)||e.bumpScale>=1)&&(e.bumpScale=.03);if((!t||r)&&e.transparent){if(r)e.lmv_depthWriteTransparent=!0,e.depthWrite=!!i;else if(e.opacity>=1)o.alphaMap||(e.transparency=!1);else e.lmv_depthWriteTransparent=!0,e.depthWrite=!!i}void 0!==e.shininess&&(e.shininess*=.25)},applyGeometryFlagsToMaterial:function(e,t){t.attributes.color&&(e.vertexColors=v().VertexColors,e.needsUpdate=!0);if(!e.proteinType&&t.attributes.uv&&t.attributes.uv.isPattern){var i=!1;e.map&&!e.bumpMap&&(e.bumpMap=e.map,e.needsUpdate=!0,i=!0),e.textureMaps&&e.textureMaps.map&&!e.textureMaps.bumpMap&&(e.textureMaps.bumpMap=e.textureMaps.map,e.needsUpdate=!0,i=!0),i&&void 0===e.bumpScale&&(e.bumpScale=.03)}},hasTiling:function(e){var t=e.materials[e.userassets[0]];if(t){if("TilingPattern"===t.definition)return!0}return!1},loadMaterialConverterPrismLibrary:async function(){ru.MaterialConverterPrism&&ru.MaterialConverterPrism.convertPrismMaterial||await ru.theExtensionManager.downloadExtension("Autodesk.Viewing.MaterialConverterPrism");if(!ou.convertPrismMaterial)for(let e in ru.MaterialConverterPrism)ou[e]=ru.MaterialConverterPrism[e]}};function su(e){return e.matrix||(e.matrix=iu(e.properties)),e.matrix}function au(e){var t=e.materials,i=t[e.userassets[0]];if(i){var n=i.definition;if("TilingPattern"===n)(i=t[i.properties.references.grout_material.connections[0]])&&(n=i.definition);return"PrismLayered"===n||"PrismMetal"===n||"PrismOpaque"===n||"PrismTransparent"===n||"PrismGlazing"===n||"PrismWood"===n}return!1}var lu={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function cu(e,t){var i;t.offset=new(v().Vector2)(0,0),t.repeat=new(v().Vector2)(1,1),t.rotation=0;const n=null===(i=e.extensions)||void 0===i?void 0:i.KHR_texture_transform;if(n&&"object"==typeof n){const{scale:e,offset:i,rotation:r}=n;i&&(t.offset=new(v().Vector2)(i[0],i[1])),e&&(t.repeat=new(v().Vector2)(e[0],e[1])),r&&(t.rotation=r)}}function uu(e){return.299*e.r+.587*e.g+.114*e.b}var hu=new Float32Array(1),du=new Uint32Array(hu.buffer),fu=new Uint16Array(1),pu=new Uint16Array(1);let mu=function(e){hu[0]=e;var t=du[0],i=0;if(2147483647&t){var n=2147483648&t,r=2139095040&t,o=8388607&t;if(0===r)pu[i++]=n>>16;else if(2139095040==r)pu[i++]=0===o?n>>16|31744:65024;else{var s,a,l=n>>16,c=(r>>23)-127+15;c>=31?pu[i++]=n>>16|31744:c<=0?(14-c>24?s=0:(s=(o|=8388608)>>14-c,fu[0]=s,s=fu[0],o>>13-c&1&&(s+=1)),pu[i++]=l|s):(a=c<<10,fu[0]=a,a=fu[0],s=o>>13,fu[0]=s,s=fu[0],pu[i++]=4096&o?1+(l|a|s):l|a|s)}}else pu[i++]=t>>16;return pu[0]},gu=function(e){var t,i=65535&e;if(32767&i){var n=32768&i,r=31744&i,o=1023&i;if(0===r){var s=-1;do{s++,o<<=1}while(!(1024&o));var a=n<<16,l=(r<<16>>26)-15+127-s,c=l<<23,u=(1023&o)<<13;t=a|c|u}else t=31744==r?0===o?n<<16|2139095040:4290772992:(a=n<<16)|(c=(l=(r<<16>>26)-15+127)<<23)|(u=o<<13)}else t=i<<16;return du[0]=t,hu[0]},vu=59390,yu=function(e){if(e>vu-1||e<0)return console.log("out of range"),mu(NaN);if(0===e)return 0;var t=!1;e>vu/2-1&&(t=!0,e-=vu/2-1);var i=0|Math.abs(e/1024),n=Math.pow(2,i-13),r=n+(e-1024*i)*n/1024;return t&&(r=-r),mu(r)},bu=function(e){if(0===e)return 0;var t=gu(e),i=!1;t<0&&(i=!0,t=-t);var n=0|Math.floor(Math.log(t)/Math.log(2)),r=Math.pow(2,n),o=(t-r)/r*1024+1024*(n+13);return i&&(o+=vu/2-1),o},xu=function(){for(var e=[-1/255,-.17,-75,-1789,-.005],t=0;t<e.length;t++)console.log("input",e[t],"encoded",mu(e[t]),"decoded",gu(mu(e[t])));for(let e=0;e<vu;e++){var i=bu(yu(e));i!==e&&console.log("Roundtrip failed for",e,i)}};function _u(e,t){for(var i=255*e.x,n=255*e.y,r=255*e.z,o=255*t.x,s=255*t.y,a=255*t.z,l=new Uint8Array(16),c=new Uint8Array(16),u=new Uint8Array(16),h=0;h<4;h++)l[4*h]=i,l[4*h+1]=n,l[4*h+2]=r,l[4*h+3]=255,c[4*h]=o,c[4*h+1]=s,c[4*h+2]=a,c[4*h+3]=255,h>1?(u[4*h]=i,u[4*h+1]=n,u[4*h+2]=r,u[4*h+3]=255):(u[4*h]=o,u[4*h+1]=s,u[4*h+2]=a,u[4*h+3]=255);var d=new(v().DataTexture)(u,2,2,v().RGBAFormat),f=new(v().DataTexture)(u,2,2,v().RGBAFormat),p=new(v().DataTexture)(c,2,2,v().RGBAFormat),m=new(v().DataTexture)(l,2,2,v().RGBAFormat),g=new(v().DataTexture)(u,2,2,v().RGBAFormat),y=new(v().DataTexture)(u,2,2,v().RGBAFormat),b=new(v().Texture)(null,v().CubeReflectionMapping,v().RepeatWrapping,v().RepeatWrapping,v().LinearFilter,v().LinearFilter,v().RGBAFormat);return b.image=[f,d,m,p,y,g],b.needsUpdate=!0,b}var Eu=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268];function Su(e,t){var i=255*t[2]+t[3],n=Math.pow(2,(i-127)/2),r=n/t[1],o=t[0]*r,s=Eu[0]*o+Eu[3]*n+Eu[6]*r,a=Eu[1]*o+Eu[4]*n+Eu[7]*r,l=Eu[2]*o+Eu[5]*n+Eu[8]*r;s<0&&(s=0),a<0&&(a=0),l<0&&(l=0),e[0]=s,e[1]=a,e[2]=l}function Au(e,t,i){var n=.0625*Math.sqrt(t[0]*i),r=.0625*Math.sqrt(t[1]*i),o=.0625*Math.sqrt(t[2]*i),s=Math.max(Math.max(n,r),Math.max(o,1e-6));s>1&&(s=1);var a=Math.ceil(255*s)/255;n>1&&(n=1),r>1&&(r=1),o>1&&(o=1),e[3]=a;var l=1/a;e[0]=n*l,e[1]=r*l,e[2]=o*l}function wu(e,t,i){var n=Math.sqrt(t[0]*i),r=Math.sqrt(t[1]*i),o=Math.sqrt(t[2]*i),s=65504;n>s&&(n=s),r>s&&(r=s),o>s&&(o=s),e[0]=n,e[1]=r,e[2]=o}var Cu=new Float32Array(4),Tu=new Float32Array(4);function Mu(e,t,i,n){if(e.LogLuv){for(var r=Math.pow(2,t),o=Array.isArray(e.image)?e.image:[e.image],s=0;s<o.length;s++)for(var a=o[s],l=0;l<a.mipmaps.length;l++){var c,u=a.mipmaps[l],h=u.data;i?(c=new Uint16Array(h.length/4*3),u.data=c):c=h.buffer;for(var d=0,f=0;f<h.length;f+=4)Cu[0]=h[f]/255,Cu[1]=h[f+1]/255,Cu[2]=h[f+2]/255,Cu[3]=h[f+3]/255,Su(Tu,Cu),i?(wu(Cu,Tu,r),c[d++]=mu(Cu[0]),c[d++]=mu(Cu[1]),c[d++]=mu(Cu[2])):(Au(Cu,Tu,r),h[f]=Math.round(255*Cu[0]),h[f+1]=Math.round(255*Cu[1]),h[f+2]=Math.round(255*Cu[2]),h[f+3]=Math.round(255*Cu[3]))}e.LogLuv=!1,i?(e.type=v().HalfFloatType,e.format=v().RGBFormat,e.RGBM=!1,e.GammaEncoded=!0):e.RGBM=!0,n&&n(e)}else rt.warn("Environment map expected to be in LogLuv format.")}var Iu=function(){this._parser=Iu.parse};Iu.prototype=Object.create(v().CompressedTextureLoader.prototype),Iu.prototype.constructor=Iu,Iu.parse=function(e,t){var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e,t,i,n){for(var r=i*n*4,o=new Uint8Array(e,t,r),s=new Uint8Array(r),a=0,l=0,c=0;c<n;c++)for(var u=0;u<i;u++){var h=o[l],d=o[++l],f=o[++l],p=o[++l];l++,s[a]=f,s[++a]=d,s[++a]=h,s[++a]=p,a++}return s}var o=n("DXT1"),s=n("DXT3"),a=n("DXT5");if(e.byteLength<124)return console.error("THREE.DDSLoader.parse: File is empty or incomplete."),i;var l,c=new Int32Array(e,0,31);if(542327876!==c[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),i;if(4&!c[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),i;var u,h=c[21],d=!1;switch(h){case o:l=8,i.format=v().RGB_S3TC_DXT1_Format;break;case s:l=16,i.format=v().RGBA_S3TC_DXT3_Format;break;case a:l=16,i.format=v().RGBA_S3TC_DXT5_Format;break;default:if(!(32==c[22]&&16711680&c[23]&&65280&c[24]&&255&c[25]&&4278190080&c[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(u=h,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))),i;d=!0,l=64,i.format=v().RGBAFormat}i.mipmapCount=1,c[7]>0&&!1!==t&&(i.mipmapCount=Math.max(1,c[7])),i.isCubemap=!!(512&c[28]),i.width=c[4],i.height=c[3];for(var f=c[1]+4,p=i.width,m=i.height,g=i.isCubemap?6:1,y=0;y<g;y++){for(var b=0;b<i.mipmapCount;b++){if(d)var x=(_=r(e,f,p,m)).length;else{x=Math.max(4,p)/4*Math.max(4,m)/4*l;var _=new Uint8Array(e,f,x)}var E={data:_,width:p,height:m};i.mipmaps.push(E),f+=x,p=Math.max(.5*p,1),m=Math.max(.5*m,1)}p=i.width,m=i.height}return i};var Pu=function(e){this.manager=void 0!==e?e:v().DefaultLoadingManager,this._parser=Pu.parse};Pu.prototype=Object.create(v().CompressedTextureLoader.prototype),Pu.prototype.constructor=Pu,Pu.parse=function(e,t){var i=new Uint32Array(e,0,13),n={buffer:e,header:i,loadMipmaps:t};if(55727696===i[0])return Pu._parseV3(n);if(559044176===i[11])return Pu._parseV2(n);throw new Error("[THREE.PVRLoader] Unknown PVR format")},Pu._parseV3=function(e){var t,i,n=e.header,r=n[12],o=n[2],s=n[6],a=n[7],l=(n[9],n[10]),c=n[11];switch(o){case 0:t=2,i=v().RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,i=v().RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,i=v().RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,i=v().RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+o)}return e.dataPtr=52+r,e.bpp=t,e.format=i,e.width=a,e.height=s,e.numSurfaces=l,e.numMipmaps=c,e.isCubemap=6===l,Pu._extract(e)},Pu._parseV2=function(e){var t,i=e.header,n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],l=(i[5],i[6]),c=(i[7],i[8],i[9],i[10]),u=(i[11],i[12]),h=255&a,d=c>0;if(25===h)t=d?v().RGBA_PVRTC_4BPPV1_Format:v().RGB_PVRTC_4BPPV1_Format,l=4;else{if(24!==h)throw new Error("pvrtc - unknown format "+h);t=d?v().RGBA_PVRTC_2BPPV1_Format:v().RGB_PVRTC_2BPPV1_Format,l=2}return e.dataPtr=n,e.bpp=l,e.format=t,e.width=o,e.height=r,e.numSurfaces=u,e.numMipmaps=s+1,e.isCubemap=6===u,Pu._extract(e)},Pu._extract=function(e){var t,i={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},n=e.buffer,r=e.dataPtr,o=e.bpp,s=e.numSurfaces,a=0,l=0,c=0,u=0,h=0;2===o?(l=8,c=4):(l=4,c=4),t=l*c*o/8,i.mipmaps.length=e.numMipmaps*s;for(var d=0;d<e.numMipmaps;){var f=e.width>>d,p=e.height>>d;(u=f/l)<2&&(u=2),(h=p/c)<2&&(h=2),a=u*h*t;for(var m=0;m<s;m++){var g={data:new Uint8Array(n,r,a),width:f,height:p};i.mipmaps[m*e.numMipmaps+d]=g,r+=a}d++}return i};let Lu=c(),Ru=Lu.document,Du=new(Jt());Du.max=F()?4:6;let Ou=0,Bu=F()?32:1/0;Bu*=1048576;let Nu=0,Uu=1/0;const ku=(e,t,i,n)=>{v().ImageUtils.loadTexture(e,t,i,n)};function Fu(e,t,i){var n=t.getData();let r;return e.startsWith("embed:")?r=n.loadedBuffers[e.charAt(e.length-1)]:(e=e.replace(/\\/g,"/"),r=t.isOTG()?function(e){var t=ke.initLoadContext({});return n.makeSharedResourcePath(t.otg_cdn,"textures",e)}(e):function(e){for(var t=null,i=0;i<n.manifest.assets.length;++i){var r=n.manifest.assets[i];if(r.id.toLowerCase()==e.toLowerCase()){let e=r.URI;-1===e.indexOf("://")&&(e=n.basePath+e),t=ni(e);break}}return t||(t=ni(n.basePath+e)),t}(e)),Hu.loadTextureWithSecurity(r,v().UVMapping,i,null,n.acmSessionId)}function Vu(e,t,i){if(t.textureMaps&&!t.texturesLoaded){t.texturesLoaded=!0;var n=e.getData(),r=t.textureMaps;for(var o in r){var s=r[o];if(!i.matman().loadTextureFromCache(e,t,s,o))Fu(s.uri,e,function(r){return function(o){if(o){var s=n.materials.scene.SceneUnit,a=i.renderer()?i.renderer().getMaxAnisotropy():0;(r.converter||ou.convertTexture)(r,o,s,a)}var l=i.matman();l&&(l.setTextureInCache(e,t,r,o),n.loadOptions.onTextureReceived&&n.loadOptions.onTextureReceived(l,r,o,!Gu()),!Gu()&&i&&n.loadDone&&!n.texLoadDone&&(n.texLoadDone=!0,i.onTextureLoadComplete(e)))}}(s))}}}function Gu(){return Ou}function zu(e){e>=0&&(Nu=e,Uu=Math.max(16384,Bu/(4*Nu)))}const Hu={loadTextureWithSecurity:function(e,t,i,n,r,o,s){var a=ke.getUseCredentials(),l=ke.getUseCookie();a&&l?v().ImageUtils.crossOrigin="use-credentials":ke.getUseCredentials()?v().ImageUtils.crossOrigin="anonymous":v().ImageUtils.crossOrigin="";var c="";a&&r&&(c="acmsession="+r),s&&s.queryParams&&(c=c?c+"&":"",c+=s.queryParams);const u=ke.initLoadContext({queryParams:c});e.startsWith("blob:")&&(u.queryParams=void 0),Ou++,Du.go((function(r){var c=function(e,t){Ou--,t&&n?n(t):i(e),r()},h=o?c:function(e){function t(t){e&&(e.image=t),Ou--,i(e),r()}e&&e.image?function(e,t){let i,n,r=e.width,o=e.height;if(r&r-1||o&o-1){for(i=1;1.5*i<r;)i*=2;for(n=1;1.5*n<o;)n*=2}else{if(r*o<=Uu)return void t(e);i=r,n=o}for(;i*n>Uu;)i=Math.max(i/2,1),n=Math.max(n/2,1);let s=Ru.createElement("canvas"),a=s.getContext("2d");s.width=i,s.height=n,a.drawImage(e,0,0,i,n);const l=new Image;l.src=s.toDataURL(),l.onload=function(){t(l),l.onload=null,l.onerror=null},l.onerror=function(e){rt.error(e,at(st.UNKNOWN_FAILURE)),t(null),l.onload=null,l.onerror=null}}(e.image,t):t()},d=function(e){Ou--,rt.error("Texture load error",e),i(null),r()};if(S())return void function(e,t,i,n,r){var o=new(v().DataTexture)(void 0,i);function s(e){r&&r.extractImage&&(e=r.extractImage(e)),o.image={data:e,width:void 0,height:void 0},o.needsUpdate=!0,n&&n(o)}function a(e,t){var i="Error: "+e+" ("+t+")";rt.error(i,at(st.NETWORK_SERVER_ERROR)),n&&n(null,{msg:t,args:e})}ei.getItem(t,e,s,a)}(e,u,t,c,s);const f=u.queryParams?`?${u.queryParams}`:"";let p=`${e}${f}`;if(e.toLocaleLowerCase().endsWith(".dds"))N()?(p=`${e.slice(0,e.length-4)}.pvr${f}`,(new Pu).load(p,c,d)):(new Iu).load(p,c,d);else if(a&&!l||s&&(s.rawData||s.extractImage))!function(e,t,i,n,r){var o=new(v().Texture)(void 0,i);function s(e){r&&r.extractImage&&(e=r.extractImage(e));var t=new Image;o.image=t,t.onload=function(){o.needsUpdate=!0,n&&n(o),Lu.URL.revokeObjectURL(t.src),t.onload=null,t.onerror=null},t.onerror=function(e){rt.error(e,at(st.UNKNOWN_FAILURE)),n&&n(null),t.onload=null,t.onerror=null},t.src=function(e){var t=new Uint8Array(e),i=new Blob([t],{type:"image/jpeg"});return(Lu.URL||Lu.webkitURL).createObjectURL(i)}(e)}function a(e,t){var i="Error: "+e+" ("+t+")";rt.error(i,at(st.NETWORK_SERVER_ERROR)),n&&n(null,{msg:t,args:e})}r&&r.rawData?s(r.rawData):ei.getItem(t,e,s,a,r)}(e,u,t,h,s);else if(e.startsWith("data:"))ku(e,t,h,d);else{/(\w+):\/\//gi.exec(e)&&!/^(https?|file|blob:\w+):\/\//gi.test(e)?Autodesk.Viewing.Private.ViewingService.rawGet("","",e,(function(i){let n=/\.(\w+)$/gi.exec(e);n=n?n[1]:"png";var r,o,s=`data:image/${n};base64, `+(r=i,o=Array.prototype.map.call(r,(function(e){return String.fromCharCode(e)})).join(""),btoa(o));ku(s,t,h,d)}),console.error):ku(p,t,h,d)}}))},loadMaterialTextures:Vu,loadModelTextures:function(e,t){var i=t.matman(),n=i._getModelHash(e),r=e.isOTG(),o=0;if(r)o=e.getData().metadata.stats.num_textures||0;else for(let e in i._materials){if(-1===e.indexOf(n))continue;let t=i._materials[e];t.textureMaps&&(o+=Object.keys(t.textureMaps).length)}zu(o);for(let o in i._materials){if(!r&&-1===o.indexOf(n))continue;Vu(e,i._materials[o],t)}var s=e.getData();!Gu()&&t&&s.loadDone&&!s.texLoadDone&&(s.texLoadDone=!0,t.onTextureLoadComplete(e))},loadCubeMap:function(e,t,i){var n,r=function(n){n?(n.mapping=v().CubeReflectionMapping,n.LogLuv=-1!==e.indexOf("logluv"),n.RGBM=-1!==e.indexOf("rgbm"),Mu(n,t,!1/*!isMobileDevice()*/,i)):i&&i(n)};return v().ImageUtils.crossOrigin="",Array.isArray(e)?(n=v().ImageUtils.loadTextureCube(e,v().CubeReflectionMapping,r)).format=v().RGBFormat:"string"==typeof e?-1!==e.toLowerCase().indexOf(".dds")?(n=(new Iu).load(e,r)).mipmaps=n.mipmaps||[]:(n=ku(e,v().SphericalReflectionMapping,i)).format=v().RGBFormat:e?i&&i(e):i&&i(null),n},requestsInProgress:Gu,calculateTextureSize:function(e){var t=4;switch(e.format){case v().AlphaFormat:t=1;break;case v().RGBFormat:t=3;break;case v().LuminanceFormat:t=1;break;case v().LuminanceAlphaFormat:t=2}switch(e.type){case v().ShortType:case v().UnsignedShortType:case v().HalfFloatType:t*=2;break;case v().IntType:case v().UnsignedIntType:case v().FloatType:t*=4;break;case v().UnsignedShort4444Type:case v().UnsignedShort5551Type:case v().UnsignedShort565Type:t=2}var i=t*e.image.width;return i+=e.unpackAlignment-1,i-=i%e.unpackAlignment,e.image.height*i},imageToCanvas:function(e,t,i){let n=e.width,r=e.height,o=Ru.createElement("canvas"),s=o.getContext("2d");return s.globalCompositeOperation="copy",o.width=n,o.height=r,t&&(s.fillStyle=i||"#FFFFFF",s.fillRect(0,0,n,r)),s.drawImage(e,0,0,n,r),o}};var Wu=r(49965),ju=r.n(Wu),qu=r(24314),Ku=r.n(qu),Xu=r(35496),Yu=r.n(Xu),Qu=r(96900),Zu=r.n(Qu),$u=r(99607),Ju=r.n($u),eh=r(1221),th=r.n(eh),ih=r(90002),nh=r.n(ih),rh=r(9641),oh=r.n(rh),sh=r(22826),ah=r.n(sh),lh=r(1081),ch=r.n(lh),uh=r(31371),hh=r.n(uh),dh=r(91952),fh=r.n(dh),ph=r(14804),mh=r.n(ph),gh=r(11255),vh=r.n(gh),yh=r(26750),bh=r.n(yh),xh=r(95898),_h=r.n(xh),Eh=r(15373),Sh=r.n(Eh),Ah=r(78148),wh=r.n(Ah),Ch=r(21787),Th=r.n(Ch),Mh=r(74490),Ih=r.n(Mh),Ph=r(25424),Lh=r.n(Ph),Rh=r(30133),Dh=r.n(Rh),Oh=r(40947),Bh=r.n(Oh),Nh=r(79317),Uh=r.n(Nh),kh=r(40304),Fh=r.n(kh),Vh=r(53634),Gh=r.n(Vh),zh=r(76332),Hh=r.n(zh),Wh=r(6147),jh=r.n(Wh),qh=r(77019),Kh=r.n(qh),Xh=r(72373),Yh=r.n(Xh),Qh=r(92070),Zh=r.n(Qh),$h=r(50433),Jh=r.n($h),ed=r(97713),td=r.n(ed),id=r(80862),nd=r.n(id),rd=r(17028),od=r.n(rd),sd=r(45631),ad=r.n(sd),ld=r(1179),cd=r.n(ld),ud=r(20990),hd=r.n(ud),dd=r(40444),fd=r.n(dd),pd=r(13353),md=r.n(pd);let gd={cutplanes:{type:"v4v",value:[]},cutplanesHideInterior:{type:"i",value:0},hatchParams:{type:"v2",value:new(v().Vector2)(1,10)},hatchTintColor:{type:"c",value:new(v().Color)(16777215)},hatchTintIntensity:{type:"f",value:1}},vd={dbId:{type:"v3",value:new(v().Vector3)(0,0,0)},modelId:{type:"v3",value:new(v().Vector3)(0,0,0)}},yd={themingColor:{type:"v4",value:new(v().Vector4)(0,0,0,0)}},bd={shadowESMConstant:{type:"f",value:0}},xd=v().UniformsUtils.merge([{shadowMap:{type:"t",value:null},shadowMapSize:{type:"v2",value:new(v().Vector2)(0,0)},shadowBias:{type:"f",value:0},shadowDarkness:{type:"f",value:0},shadowMatrix:{type:"m4",value:new(v().Matrix4)},shadowLightDir:{type:"v3",value:new(v().Vector3)}},bd]),_d={point_size:{type:"f",value:1}},Ed={view_size:{type:"v2",value:new(v().Vector2)(640,480)}},Sd={tDepth:{type:"t",value:null},projInfo:{type:"v4",value:new(v().Vector4)},isOrtho:{type:"f",value:0},worldMatrix_mainPass:{type:"m4",value:new(v().Matrix4)}},Ad={tDepthTest:{type:"t",value:null},tDepthResolution:{type:"v2",value:new(v().Vector2)(1/1024,1/1024)}};var wd={};for(var Cd in v().ShaderChunk)wd[Cd]=v().ShaderChunk[Cd];wd.pack_depth=Yu(),wd.depth_texture=Zu(),wd.tonemap=Ju(),wd.ordered_dither=th(),wd.cutplanes=nh(),wd.pack_normals=oh(),wd.hatch_pattern=ah(),wd.env_sample=ch(),wd.id_decl_vert=hh(),wd.id_vert=fh(),wd.id_decl_frag=mh(),wd.id_frag=vh(),wd.final_frag=bh(),wd.theming_decl_vert=_h(),wd.theming_decl_frag=Sh(),wd.theming_frag=wh(),wd.theming_vizflag_vert=Th(),wd.instancing_decl_vert=Ih(),wd.shadowmap_decl_common=Lh(),wd.shadowmap_decl_vert=Dh(),wd.shadowmap_vert=Bh(),wd.shadowmap_decl_frag=Uh(),wd.float3_average=Fh(),wd.line_decl_common=Gh(),wd.prism_wood=Hh(),wd.prism_glazing=jh(),wd.prism_transparency=Kh(),wd.normal_map=Yh(),wd.decl_point_size=Zh(),wd.point_size=Jh(),wd.wide_lines_decl=td(),wd.wide_lines_vert=nd(),wd.hsv=od(),wd.importance_sampling=ad(),wd.logdepthbuf_decl_frag=cd(),wd.logdepthbuf_frag=hd(),wd.logdepthbuf_decl_vert=fd(),wd.logdepthbuf_vert=md();var Td={},Md={};for(Cd in Td)Md[Cd]=new RegExp("#"+Cd+" *<([\\w\\d., ]*)>","g");let Id=function(e){for(var t in Td){var i=Md[t];e=e.replace(i,(function(e,i){var n=i.split(",").map((function(e){return e.trim()}));return Td[t].apply(null,n)}))}return e.replace(/#include *<([\w\d.]+)>/g,(function(e,t){if(!wd[t])throw new Error("Cannot resolve #include<"+t+">");return Id(wd[t])}))},Pd=wd.pack_depth,Ld=wd.tonemap,Rd=wd.ordered_dither,Dd=wd.cutplanes,Od=wd.pack_normals,Bd=wd.hatch_pattern,Nd=wd.env_sample,Ud=wd.id_decl_vert,kd=wd.id_vert,Fd=wd.id_decl_frag,Vd=wd.id_frag,Gd=wd.final_frag,zd=wd.theming_decl_frag,Hd=wd.theming_frag,Wd=wd.instancing_decl_vert,jd=wd.shadowmap_decl_common,qd=wd.shadowmap_decl_vert,Kd=wd.shadowmap_vert,Xd=wd.shadowmap_decl_frag,Yd=wd.decl_point_size,Qd=wd.point_size,Zd={IdUniforms:vd,ThemingUniform:yd,CutPlanesUniforms:gd,ShadowMapCommonUniforms:bd,ShadowMapUniforms:xd,PointSizeUniforms:_d,WideLinesUniforms:Ed,DepthTextureUniforms:Sd,DepthTextureTestUniforms:Ad,PackDepthShaderChunk:Pd,TonemapShaderChunk:Ld,OrderedDitheringShaderChunk:Rd,CutPlanesShaderChunk:Dd,PackNormalsShaderChunk:Od,HatchPatternShaderChunk:Bd,EnvSamplingShaderChunk:Nd,IdVertexDeclaration:Ud,IdVertexShaderChunk:kd,IdFragmentDeclaration:Fd,IdOutputShaderChunk:Vd,FinalOutputShaderChunk:Gd,ThemingFragmentDeclaration:zd,ThemingFragmentShaderChunk:Hd,InstancingVertexDeclaration:Wd,ShadowMapDeclareCommonUniforms:jd,ShadowMapVertexDeclaration:qd,ShadowMapVertexShaderChunk:Kd,ShadowMapFragmentDeclaration:Xd,PointSizeDeclaration:Yd,PointSizeShaderChunk:Qd,...wd,resolve:Id},$d={uniforms:v().UniformsUtils.merge([Zd.CutPlanesUniforms,{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:.5},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new(v().Vector2)(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new(v().Vector2)(4096,1)},displayPixelRatio:{type:"f",value:1},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new(v().Vector4)(0,0,1,1)},modelId:{type:"v3",value:new(v().Vector3)(0,0,0)},viewportId:{type:"f",value:0},swap:{type:"f",value:0},grayscale:{type:"f",value:0},viewportBounds:{type:"v4",value:new(v().Vector4)(0,0,1,1)},unpackXform:{type:"v4",value:new(v().Vector4)(1,1,0,0),perObject:!0},tIdColor:{type:"t",value:null,perObject:!0},vIdColorTexSize:{type:"v2",value:new(v().Vector2)(256,1),perObject:!0},meshAnimTime:{type:"f",value:0,perObject:!0}}]),vertexShader:ju(),fragmentShader:Ku()};var Jd=r(97431),ef=r.n(Jd),tf=r(65144),nf=r.n(tf),rf=2*Math.PI,of=[0,1,3,0,3,2];const sf=6,af=1023,lf=65536;function cf(e,t,i,n){var r=t||65536;this.FULL_COUNT=0|(i||32767),this.useInstancing=e,this.useCompactBuffers=n,this.stride=10,this.allocVcount=4*(this.useInstancing?r/4:r),this.vb=new ArrayBuffer(this.stride*this.allocVcount),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=this.useInstancing?null:new Uint16Array(r),this.minLineWidth=Number.MAX_VALUE,this.reset(0)}cf.FORCE_BUTT_CAPS_FOR_TESTING=!1,cf.prototype.reset=function(e){this.vcount=e,this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-1/0,this.dbIds={},this.lastDbId=null,this.colors={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0,this.numMiterLines=0,this.hasLineStyles=!1,this.changeTracking={},this.stride=10},cf.prototype.expandStride=function(){var e=this.stride;if(!(e>=12)){for(var t=this.stride+2,i=new ArrayBuffer(t*this.allocVcount),n=new Uint8Array(this.vb),r=new Uint8Array(i),o=0,s=this.vcount;o<s;o++)for(var a=o*e*4,l=o*t*4,c=0;c<4*e;c++)r[l+c]=n[a+c];this.vb=i,this.vbf=new Float32Array(i),this.vbi=new Int32Array(i),this.stride=t}},cf.prototype.addToBounds=function(e,t){e<this.minx&&(this.minx=e),e>this.maxx&&(this.maxx=e),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)},cf.prototype.addToBoundsWithLineWidth=function(e,t,i,n,r){if(r<0)return this.addToBounds(e,t),void this.addToBounds(i,n);const o=[Math.min(e,i)-.5*r,Math.max(e,i)+.5*r],s=[Math.min(t,n)-.5*r,Math.max(t,n)+.5*r];this.addToBounds(o[0],s[0]),this.addToBounds(o[1],s[1])};var uf=new Int32Array(1);function hf(e){return uf[0]=e,uf[0]}cf.prototype.trackChanges=function(e,t,i,n,r,o){if(i!==this.lastDbId&&(this.dbIds[hf(i)]=1,this.lastDbId=i),o&&(this.hasLineStyles=!0),this.useCompactBuffers){var s=this.changeTracking;a("geomType",e),a("color",t),a("dbId",i),a("layerId",n),a("viewportId",r),a("linePattern",o),this.colors[hf(t)]=1}function a(t,i){void 0===s[t]?s[t]=e:s[t]===i&&(s[t+"Varies"]=!0)}},cf.prototype.setCommonVertexAttribs=function(e,t,i,n,r,o,s,a){this.trackChanges(i,n,r,o,s,a),t&=255,i&=255,a&=255,o&=65535,s&=65535,this.vbi[e+8]=t|i<<8|a<<16,this.vbi[e+6]=n,this.vbi[e+7]=r,this.vbi[e+9]=o|s<<16},cf.prototype.addVertexTriangleGeom=function(e,t,i,n,r,o,s,a,l,c){for(var u=this.vcount,h=this.vbf,d=this.useInstancing?1:4,f=0;f<d;f++){var p=(u+f)*this.stride;h[p]=e,h[p+1]=t,h[p+2]=i,h[p+3]=n,h[p+4]=r,h[p+5]=o,this.setCommonVertexAttribs(p,0+f,5,s,a,l,c,0),this.vcount++}return u},cf.prototype.addVertexLine=function(e,t,i,n,r,o,s,a,l,c,u,h,d){var f=this.vcount,p=this.vbf;a>=0&&o>0&&n>0&&(this.minLineWidth=Math.min(this.minLineWidth,o)),cf.FORCE_BUTT_CAPS_FOR_TESTING&&(h=!0,d=!0);var m=1;h&&d?m=8:h?m=9:d&&(m=10);for(var g=this.useInstancing?1:4,v=0;v<g;v++){var y=(f+v)*this.stride;p[y]=e,p[y+1]=t,p[y+2]=(i+Math.PI)/rf,p[y+3]=n,p[y+4]=.5*o,p[y+5]=r,this.setCommonVertexAttribs(y,0+v,m,s,a,l,c,u),this.vcount++}return f},cf.prototype.addVertexMiterLine=function(e,t,i,n,r,o,s,a,l,c,u,h,d){var f=this.vcount,p=this.vbf;c>=0&&a>0&&(this.minLineWidth=Math.min(this.minLineWidth,a));for(var m=this.useInstancing?1:4,g=0;g<m;g++){var v=(f+g)*this.stride;p[v]=e,p[v+1]=t,p[v+2]=(i+Math.PI)/rf,p[v+3]=o,p[v+4]=.5*a,p[v+5]=(n+Math.PI)/rf,p[v+10]=(r+Math.PI)/rf,p[v+11]=s,this.setCommonVertexAttribs(v,0+g,11,l,c,u,h,d),this.vcount++}return f},cf.prototype.addVertexTexQuad=function(e,t,i,n,r,o,s,a,l){for(var c=this.vcount,u=this.vbf,h=this.useInstancing?1:4,d=0;d<h;d++){var f=(c+d)*this.stride;u[f]=e,u[f+1]=t,u[f+2]=r/rf,u[f+3]=i,u[f+4]=n,this.setCommonVertexAttribs(f,0+d,4,o,s,a,l,0),this.vcount++}return c},cf.prototype.addVertexArc=function(e,t,i,n,r,o,s,a,l,c,u,h){for(var d=this.vcount,f=this.vbf,p=r==o?2:3,m=this.useInstancing?1:4,g=0;g<m;g++){var v=(d+g)*this.stride;f[v]=e,f[v+1]=t,f[v+2]=i/rf,f[v+3]=n/rf,f[v+4]=.5*a,f[v+5]=r,3===p&&(f[v+10]=o,f[v+11]=s),this.setCommonVertexAttribs(v,0+g,p,l,c,u,h,0),this.vcount++}return d},cf.prototype.addVertex=function(e,t,i,n,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(!this.useInstancing){var a=this.vcount,l=this.stride*a,c=this.vbf;return c[l]=e,c[l+1]=t,this.setCommonVertexAttribs(l,0,s,i,n,r,o,0),this.vcount++,a}},cf.prototype.addVertexPolytriangle=function(e,t,i,n,r,o){this.useInstancing||(this.addVertex(e,t,i,n,r,o),this.addToBounds(e,t))},cf.prototype.addVertexMSDFPolytriangle=function(e,t,i,n,r,o,s,a){this.addVertexTexPolytriangle(e,t,i,n,r,o,s,a,6)},cf.prototype.addIndices=function(e,t){if(!this.useInstancing){var i=this.ib,n=this.icount;if(n+e.length>=i.length){var r=new Uint16Array(2*Math.max(e.length,i.length));for(let e=0;e<n;++e)r[e]=i[e];this.ib=i=r}for(let r=0;r<e.length;++r)i[n+r]=t+e[r];this.icount+=e.length}},cf.prototype.finalizeQuad=function(e){this.useInstancing||this.addIndices(of,e)},cf.prototype.addSegment=function(e,t,i,n,r,o,s,a,l,c,u,h,d){var f=i-e,p=n-t,m=f||p?Math.atan2(p,f):0,g=f||p?Math.sqrt(f*f+p*p):0,v=this.addVertexLine(e,t,m,g,r,o,s,a,l,c,u,h,d);this.finalizeQuad(v),this.addToBoundsWithLineWidth(e,t,i,n,o)},cf.prototype.addMiterSegment=function(e,t,i,n,r,o,s,a,l,c,u,h,d,f,p,m,g){if(this.useCompactBuffers)this.addSegment(i,n,r,o,l,c,u,h,d,f,p,m,g);else{this.numMiterLines++,this.expandStride();var v=r-i,y=o-n,b=v||y?Math.atan2(y,v):0,x=v||y?Math.sqrt(v*v+y*y):0,_=i-e,E=n-t,S=_||E?Math.atan2(E,_):b,A=_||E?Math.sqrt(_*_+E*E):1,w=s-r,C=a-o,T=w||C?Math.atan2(C,w):b,M=w||C?Math.sqrt(w*w+C*C):1,I=Math.floor(Math.min(64,A)*af),P=Math.floor(Math.min(64,M)*af)*lf+I,L=this.addVertexMiterLine(i,n,b,S,T,x,P,c,u,h,d,f,p);this.finalizeQuad(L),this.addToBoundsWithLineWidth(i,n,r,o,c)}},cf.prototype.addTriangleGeom=function(e,t,i,n,r,o,s,a,l,c){this.numTriangleGeoms++;var u=this.addVertexTriangleGeom(e,t,i,n,r,o,s,a,l,c);this.finalizeQuad(u),this.addToBounds(e,t),this.addToBounds(i,n),this.addToBounds(r,o)},cf.prototype.addArc=function(e,t,i,n,r,o,s,a,l,c,u,h){r==o?this.numCirculars++:(this.numEllipticals++,this.expandStride());var d=df(i,n);i=d.start,n=d.end,0==i&&0==n&&(n=rf);{var f=Math.abs(i-n);if(f>1e-4&&Math.abs(f-rf)>1e-4){var p=e+r*Math.cos(i),m=t+o*Math.sin(i);this.addSegment(p,m,p,m,0,a,l,c,u,h);var g=e+r*Math.cos(n),v=t+o*Math.sin(n);this.addSegment(g,v,g,v,0,a,l,c,u,h)}else this.addToBoundsWithLineWidth(e-r,t-o,e+r,t+o,a);const s=33554431;var y=this.addVertexLine(e,t,0,1e-4,0,0,s,c,u,h);this.finalizeQuad(y)}var b=this.addVertexArc(e,t,i,n,r,o,s,a,l,c,u,h);this.finalizeQuad(b)},cf.prototype.addTexturedQuad=function(e,t,i,n,r,o,s,a,l){var c=this.addVertexTexQuad(e,t,i,n,r,o,s,a,l);this.finalizeQuad(c);var u=.5*Math.cos(r),h=.5*Math.sin(r),d=Math.abs(i*u)+Math.abs(n*h),f=Math.abs(i*h)+Math.abs(n*u);this.addToBounds(e-d,t-f),this.addToBounds(e+d,t+f)},cf.prototype.addVertexImagePolytriangle=function(e,t,i,n,r,o,s,a){return this.addVertexTexPolytriangle(e,t,i,n,r,o,s,a,7)},cf.prototype.addVertexTexPolytriangle=function(e,t,i,n,r,o,s,a,l){if(this.useInstancing)return;let c=this.vcount,u=this.vbf;this.addVertex(e,t,r,o,s,a,l),u[c*this.stride+2]=i,u[c*this.stride+3]=n,this.addToBounds(e,t)},cf.prototype.isFull=function(e){e=e||3;var t=this.useInstancing?4:1;return this.vcount*t+e>this.FULL_COUNT},cf.prototype.makeCompactVertexLayout=function(){var e=Object.keys(this.colors),t=Object.keys(this.dbIds);if(10!==this.stride)return null;var i=e.length+t.length;if(e.length+t.length>65536)return null;var n=new Int32Array(i+1);n[0]=0;var r=1;for(let t=0;t<e.length;t++,r++)n[r]=parseInt(e[t]),this.colors[e[t]]=r;for(let e=0;e<t.length;e++,r++)n[r]=parseInt(t[e]),this.dbIds[t[e]]=r;var o=new ArrayBuffer(24*this.vcount),s=new Int32Array(o),a=new Uint16Array(o),l=this.maxx-this.minx||1,c=this.maxy-this.miny||1,u=this.minx,h=this.miny,d=Math.max(l,c);function f(e){return 0|Math.round((e-u)/l*65535)}function p(e){return 0|Math.round((e-h)/c*65535)}function m(e){return 0|Math.round(e/d*65535)}function g(e){return 0|65535*e}function v(e){return e<0?32768+32767*Math.min(1,-e/1024):e?0|Math.round(e/d*32767)||1:e}for(var y=0;y<this.vcount;y++){var b=this.stride*y,x=6*y,_=2*x;switch(this.vbi[b+8]>>8&255){case 0:a[_]=f(this.vbf[b]),a[_+1]=p(this.vbf[b+1]);break;case 1:case 8:case 9:case 10:a[_]=f(this.vbf[b]),a[_+1]=p(this.vbf[b+1]),a[_+2]=g(this.vbf[b+2]),a[_+3]=m(this.vbf[b+3]),a[_+4]=v(this.vbf[b+4]);break;case 2:a[_]=f(this.vbf[b]),a[_+1]=p(this.vbf[b+1]),a[_+2]=g(this.vbf[b+2]),a[_+3]=g(this.vbf[b+3]),a[_+4]=v(this.vbf[b+4]),a[_+5]=m(this.vbf[b+5]);break;case 3:case 11:break;case 4:a[_]=f(this.vbf[b]),a[_+1]=p(this.vbf[b+1]),a[_+2]=g(this.vbf[b+2]),a[_+3]=m(this.vbf[b+3]),a[_+4]=m(this.vbf[b+4]);break;case 5:a[_]=f(this.vbf[b]),a[_+1]=p(this.vbf[b+1]),a[_+2]=f(this.vbf[b+2]),a[_+3]=p(this.vbf[b+3]),a[_+4]=f(this.vbf[b+4]),a[_+5]=p(this.vbf[b+5]);break;default:console.error("Unknown geometry type")}a[_+6]=this.colors[this.vbi[b+6]]||0,a[_+7]=this.dbIds[this.vbi[b+7]]||0,s[x+4]=this.vbi[b+8],s[x+5]=this.vbi[b+9]}var E={};E.vb=new Float32Array(o),E.vbstride=6;var S=this.useInstancing?1:0;return E.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:2,divisor:S,normalized:!0},fields2:{offset:1,itemSize:4,bytesPerItem:2,divisor:S,normalized:!0},uvIdColor:{offset:3,itemSize:2,bytesPerItem:2,divisor:S,normalized:!1},flags4b:{offset:4,itemSize:4,bytesPerItem:1,divisor:S,normalized:!1},layerVp4b:{offset:5,itemSize:4,bytesPerItem:1,divisor:S,normalized:!1}},E.unpackXform={x:l,y:c,z:u,w:h},E.texData=n,E},cf.prototype.makeWideVertexLayout=function(){var e={};e.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),e.vbstride=this.stride;var t=this.useInstancing?1:0;return e.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:4,divisor:t,normalized:!1},fields2:{offset:2,itemSize:4,bytesPerItem:4,divisor:t,normalized:!1},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:t,normalized:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:t,normalized:!1},flags4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:t,normalized:!1},layerVp4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:t,normalized:!1}},e.vblayout.extraParams={offset:this.stride-2,itemSize:2,bytesPerItem:4,divisor:t,normalized:!1},e},cf.prototype.toMesh=function(){var e=null;if(this.useCompactBuffers&&(e=this.makeCompactVertexLayout()),e||(e=this.makeWideVertexLayout()),this.useInstancing){e.numInstances=this.vcount;var t=new Int32Array([0,1,2,3]);e.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalized:!1},e.vblayout.instFlags4b.array=t.buffer,e.indices=new Uint16Array(of)}else e.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));e.dbIds=this.dbIds;var i=this.maxx-this.minx,n=this.maxy-this.miny,r=Math.max(i,n);return e.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-r},max:{x:this.maxx,y:this.maxy,z:.001*r}},e.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(i*i+n*n)},e};var df=function(e,t){function i(){function i(e,t){return Math.abs(e-t)<.001}i(e,0)&&(e=0),i(t,0)&&(t=0),i(e,rf)&&(e=rf),i(t,rf)&&(t=rf)}if(i(),e>t)for(;e>rf;)e-=rf,t-=rf;else for(;t>rf;)e-=rf,t-=rf;return i(),e<0&&t>0&&(e+=rf),{start:e,end:t}};let ff={uniforms:v().UniformsUtils.merge([$d.uniforms,{aaRange:{type:"f",value:1},size:{type:"v2",value:new(v().Vector2)(1024,768)},cameraPos:{type:"v3",value:new(v().Vector3)},tanHalfFov:{type:"f",value:0},miterLimit:{type:"f",value:sf},miterScaleFactor:{type:"f",value:af},miterCP:{type:"f",value:lf}}]),vertexShader:ef(),fragmentShader:nf()};class pf extends v().ShaderMaterial{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e.isScreenSpace?{uniforms:v().UniformsUtils.clone(ff.uniforms),vertexShader:ff.vertexShader,fragmentShader:ff.fragmentShader}:{uniforms:v().UniformsUtils.clone($d.uniforms),vertexShader:$d.vertexShader,fragmentShader:$d.fragmentShader}),this.isScreenSpace=!!e.isScreenSpace,e.hasLineStyles&&(this.hasLineStyles=!0),this.is2d=!0,this.supportsViewportBounds=!0,this.depthWrite=!1,this.depthTest=!1,this.side=v().DoubleSide,this.transparent=!0,this.blending=v().NormalBlending,this.type="LMVLineMaterial"+(this.isScreenSpace?"SS":""),"multiply"==e.compositeOperation?this.blending=v().MultiplyBlending:"min"==e.compositeOperation||"darken"==e.compositeOperation?(this.blending=v().CustomBlending,this.blendEquation=v().MinEquation,this.blendEquationAlpha=v().AddEquation,this.blendSrcAlpha=v().SrcAlphaFactor,this.blendDstAlpha=v().DstAlphaFactor):"max"!=e.compositeOperation&&"lighten"!=e.compositeOperation||(this.blending=v().CustomBlending,this.blendEquation=v().MaxEquation,this.blendEquationAlpha=v().AddEquation,this.blendSrcAlpha=v().SrcAlphaFactor,this.blendDstAlpha=v().DstAlphaFactor)}}let mf=[{id:"SOLID",name:"Solid",ascii_art:"_______________________________________",def:[1]},{id:"BORDER",name:"Border",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.5,-.25,.5,-.25,0,-.25]},{id:"BORDER2",name:"Border (.5x)",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.25,-.125,.25,-.125,0,-.125]},{id:"BORDERX2",name:"Border (2x)",ascii_art:"____  ____  .  ____  ____  .  ___",def:[1,-.5,1,-.5,0,-.5]},{id:"CENTER",name:"Center",ascii_art:"____ _ ____ _ ____ _ ____ _ ____ _ ____",def:[1.25,-.25,.25,-.25]},{id:"CENTER2",name:"Center (.5x)",ascii_art:"___ _ ___ _ ___ _ ___ _ ___ _ ___",def:[.75,-.125,.125,-.125]},{id:"CENTERX2",name:"Center (2x)",ascii_art:"________  __  ________  __  _____",def:[2.5,-.5,.5,-.5]},{id:"DASHDOT",name:"Dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . __",def:[.5,-.25,0,-.25]},{id:"DASHDOT2",name:"Dash dot (.5x)",ascii_art:"_._._._._._._._._._._._._._._.",def:[.25,-.125,0,-.125]},{id:"DASHDOTX2",name:"Dash dot (2x)",ascii_art:"____  .  ____  .  ____  .  ___",def:[1,-.5,0,-.5]},{id:"DASHED",name:"Dashed",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ _",def:[.5,-.25]},{id:"DASHED2",name:"Dashed (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.25,-.125]},{id:"DASHEDX2",name:"Dashed (2x)",ascii_art:"____  ____  ____  ____  ____  ___",def:[1,-.5]},{id:"DIVIDE",name:"Divide",ascii_art:"____ . . ____ . . ____ . . ____ . . ____",def:[.5,-.25,0,-.25,0,-.25]},{id:"DIVIDE2",name:"Divide (.5x)",ascii_art:"__..__..__..__..__..__..__..__.._",def:[.25,-.125,0,-.125,0,-.125]},{id:"DIVIDEX2",name:"Divide (2x)",ascii_art:"________  .  .  ________  .  .  _",def:[1,-.5,0,-.5,0,-.5]},{id:"DOT",name:"Dot",ascii_art:". . . . . . . . . . . . . . . . . . . . . . . .",def:[0,-.25]},{id:"DOT2",name:"Dot (.5x)",ascii_art:"........................................",def:[0,-.125]},{id:"DOTX2",name:"Dot (2x)",ascii_art:".  .  .  .  .  .  .  .  .  .  .  .  .  .",def:[0,-.5]},{id:"HIDDEN",name:"Hidden",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ __",def:[.25,-.125]},{id:"HIDDEN2",name:"Hidden (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.125,-.0625]},{id:"HIDDENX2",name:"Hidden (2x)",ascii_art:"____ ____ ____ ____ ____ ____ ____",def:[.5,-.25]},{id:"PHANTOM",name:"Phantom",ascii_art:"______  __  __  ______  __  __  ______",def:[1.25,-.25,.25,-.25,.25,-.25]},{id:"PHANTOM2",name:"Phantom (.5x)",ascii_art:"___ _ _ ___ _ _ ___ _ _ ___ _ _",def:[.625,-.125,.125,-.125,.125,-.125]},{id:"PHANTOMX2",name:"Phantom (2x)",ascii_art:"____________    ____    ____   _",def:[2.5,-.5,.5,-.5,.5,-.5]},{id:"ACAD_ISO02W100",name:"ISO dash",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __",def:[12,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO03W100",name:"ISO dash space",ascii_art:"__    __    __    __    __    __",def:[12,-18],pen_width:1,unit:"mm"},{id:"ACAD_ISO04W100",name:"ISO long-dash dot",ascii_art:"____ . ____ . ____ . ____ . _",def:[24,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO05W100",name:"ISO long-dash double-dot",ascii_art:"____ .. ____ .. ____ .",def:[24,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO06W100",name:"ISO long-dash triple-dot",ascii_art:"____ ... ____ ... ____",def:[24,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO07W100",name:"ISO dot",ascii_art:". . . . . . . . . . . . . . . . . . . .",def:[.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO08W100",name:"ISO long-dash short-dash",ascii_art:"____ __ ____ __ ____ _",def:[24,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO09W100",name:"ISO long-dash double-short-dash",ascii_art:"____ __ __ ____",def:[24,-3,6,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO10W100",name:"ISO dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . ",def:[12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO11W100",name:"ISO double-dash dot",ascii_art:"__ __ . __ __ . __ __ . __ _",def:[12,-3,12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO12W100",name:"ISO dash double-dot",ascii_art:"__ . . __ . . __ . . __ . .",def:[12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO13W100",name:"ISO double-dash double-dot",ascii_art:"__ __ . . __ __ . . _",def:[12,-3,12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO14W100",name:"ISO dash triple-dot",ascii_art:"__ . . . __ . . . __ . . . _",def:[12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO15W100",name:"ISO double-dash triple-dot",ascii_art:"__ __ . . . __ __ . .",def:[12,-3,12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"FENCELINE1",name:"Fenceline circle",ascii_art:"----0-----0----0-----0----0-----0--",def:[.25,-.1,["CIRC1","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"FENCELINE2",name:"Fenceline square",ascii_art:"----[]-----[]----[]-----[]----[]---",def:[.25,-.1,["BOX","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"TRACKS",name:"Tracks",ascii_art:"-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-",def:[.15,["TRACK1","ltypeshp.shx","s=.25"],.15]},{id:"BATTING",name:"Batting",ascii_art:"SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS",def:[1e-4,-.1,["BAT","ltypeshp.shx","x=-.1","s=.1"],-.2,["BAT","ltypeshp.shx","r=180","x=.1","s=.1"],-.1]},{id:"HOT_WATER_SUPPLY",name:"Hot water supply",ascii_art:"---- HW ---- HW ---- HW ----",def:[.5,-.2,["HW","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.2]},{id:"GAS_LINE",name:"Gas line",ascii_art:"----GAS----GAS----GAS----GAS----GAS----GAS--",def:[.5,-.2,["GAS","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.25]},{id:"ZIGZAG",name:"Zig zag",ascii_art:"/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/",def:[1e-4,-.2,["ZIG","ltypeshp.shx","x=-.2","s=.2"],-.4,["ZIG","ltypeshp.shx","r=180","x=.2","s=.2"],-.2]}],gf=function(e,t){for(var i=e+3,n=t,r=1;r<i;)r*=2;for(i=r,r=1;r<n;)r*=2;n=r;var o=new Uint8Array(i*n),s=new(v().DataTexture)(o,i,n,v().LuminanceFormat,v().UnsignedByteType,v().UVMapping,v().ClampToEdgeWrapping,v().ClampToEdgeWrapping,v().NearestFilter,v().NearestFilter,0);return s.generateMipmaps=!1,s.flipY=!1,s.needsUpdate=!0,{tex:o,pw:i,ph:n,lineStyleTex:s}},vf=function(e){for(var t=e.length,i=0,n=0;n<t;n++){var r=e[n];r.def.length>i&&(i=r.def.length)}let{tex:o,pw:s,lineStyleTex:a}=gf(i,t);for(var l=0;l<t;l++){let t=e[l];bf(t,o,l,s)}return a},yf=function(){return vf(mf)},bf=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:96;for(var o=i*n,s=e.unit&&"mm"==e.unit?1/25.4:1,a=e.pen_width||0,l=e.def,c=0,u=0;u<l.length;u++){var h=Math.abs(l[u]);h<=.5*a&&(h=0);var d=0|h*r*s;c+=d,t[o+u+2]=d||1}t[o]=c%256,t[o+1]=c/256,t[o+l.length+2]=0};function xf(e,t,i){e.x=t.r,e.y=t.g,e.z=t.b,e.w=i}var _f=new(v().Color)("#0000FF"),Ef=.6;const Sf={INSTANCED:0,VERTEX_IDS:1},Af=(e,t,i)=>{e[t]=i,e.needsUpdate=!0};function wf(e){this._renderer=e,this._textures={},this._texturesToUpdate=[],this._materials={},this._materialsNonHDR={},this._exposureBias=0,this._tonemapMethod=0,this._envMapExposure=1,this._envRotationSin=0,this._envRotationCos=1,this._reflectionMap=null,this._irradianceMap=null,this._cutplanes=[],this.cutplanesHideInterior=0,this._mrtNormals=!1,this._mrtIdBuffer=void 0,this._polygonOffsetOn=!1,this._pixelsPerUnit=1,this._lineStyleTex=null,this._swapBlackAndWhite=0,this._grayscaleLines=0,this._depthWriteTransparent=!0,this._needsTwoSided=!1,this._hasTransparentMaterial=!1,this.hasPrism=!1,this._forceDoubleSided=!1,this._layerMaskTextures={},this._layerMaps={},this._selectionTextures={},this._prismWoodTextures=void 0,this.defaultMaterial=new(v().MeshPhongMaterial)({color:7829367,specular:3355443,shininess:30,reflectivity:0}),this.addMaterial("__defaultMaterial__",this.defaultMaterial),this.initLineStyleTexture(),this.refCount=0}wf.prototype.dtor=function(){this.cleanup(),v().Cache.clear(),this._renderer=null},wf.prototype._getModelHash=function(e){const t=e&&("number"==typeof e?e:e.id);return"model:"+(t||"")+"|"},wf.prototype._getMaterialHash=function(e,t){return e&&e.isOTG()?t:this._getModelHash(e)+"mat:"+t},wf.prototype._getTextureHash=function(e,t,i,n){return`${e.isOTG()?"":this._getModelHash(e)}mat:${n}|tex:${t}|map:${i}`},wf.prototype.addNonHDRMaterial=function(e,t){t.doNotCut||(t.cutplanes=this._cutplanes),this._applyMRTFlags(t),this._materialsNonHDR[e]=t},wf.prototype.removeNonHDRMaterial=function(e){delete this._materialsNonHDR[e]},wf.prototype.addMaterialNonHDR=function(e,t){this.addNonHDRMaterial(e,t)},wf.prototype.addHDRMaterial=function(e,t){this._reflectionMap&&!t.disableEnvMap&&(t.envMap=this._reflectionMap),this._irradianceMap&&(t.irradianceMap=this._irradianceMap),t.exposureBias=Math.pow(2,this._exposureBias),t.tonemapOutput=this._tonemapMethod,t.envMapExposure=this._envMapExposure,t.envRotationSin=this._envRotationSin,t.envRotationCos=this._envRotationCos,this._applyCutPlanes(t),this._applyMRTFlags(t),this._applyPolygonOffset(t,this._polygonOffsetOn),this._materials[e]=t},wf.prototype._applyCutPlanes=function(e){e.doNotCut?e.cutplanes=null:(e.cutplanes=this._cutplanes,e.cutplanesHideInterior=this.cutplanesHideInterior,e.needsUpdate=!0,this._cutplanes&&this._cutplanes.length>0?e.side=v().DoubleSide:this._needsTwoSided||e.is2d||this._forceDoubleSided||(e.side=v().FrontSide))},wf.prototype.addMaterial=function(e,t,i){var n=t.prismType&&-1!==t.prismType.indexOf("Prism");this.hasPrism=n||this.hasPrism,ou.applyAppearanceHeuristics(t,n||i,this.isDepthWriteTransparentEnabled()),t.side===v().DoubleSide&&(this._needsTwoSided=!0),this.addHDRMaterial(e,t)},wf.prototype.addLineMaterial=function(e,t,i){var n=i&&this._layerMaskTextures[i];n&&(t.defines.HAS_LAYERS=1,t.uniforms.tLayerMask.value=n),t.hasLineStyles&&(t.defines.HAS_LINESTYLES=1,t.defines.MAX_LINESTYLE_LENGTH=this._lineStyleTex.image.width,t.uniforms.tLineStyle.value=this._lineStyleTex,t.uniforms.vLineStyleTexSize.value.set(this._lineStyleTex.image.width,this._lineStyleTex.image.height)),t.uniforms.swap.value=this._swapBlackAndWhite,t.uniforms.grayscale.value=this._grayscaleLines,t.doNotCut||(t.cutplanes=this._cutplanes),this._updatePixelScaleForMaterial(t),this._materials[e]=t,this._applyMRTFlags(t)},wf.prototype.addOverrideMaterial=function(e,t){if(this.addNonHDRMaterial(e,t),t.variants)for(var i=0;i<t.variants.length;i++){var n=t.variants[i];if(n){var r=e+"_variant_"+i;this.addNonHDRMaterial(r,n)}}},wf.prototype.getMaterialVariant=function(e,t,i){var n=!!e.hash,r=(n?e.hash:this._getModelHash(i)+e.id)+"|"+t,o=this._materials[r]??this._materialsNonHDR[r];return o||(o=this.cloneMaterial(e,i),t===Sf.INSTANCED?(o.useInstancing=!0,o.vertexIds=!0):t===Sf.VERTEX_IDS&&(o.vertexIds=!0),o instanceof v().LineBasicMaterial?this.addNonHDRMaterial(r,o):o instanceof pf?this.addLineMaterial(r,o):this.addHDRMaterial(r,o)),n&&this._addMaterialRef(o,i.id),o},wf.prototype.addInstancingSupport=function(e){var t=e.clone();t.useInstancing=!0,t.packedNormals=e.packedNormals,t.disableTheming=e.disableTheming;var i=e.clone();i.wideLines=!0,i.packedNormals=e.packedNormals,e.variants=[t,i],e.getCustomOverrideMaterial=function(e){return e.useInstancing?this.variants[0]:e.wideLines?(this.variants[1].linewidth=e.linewidth,this.variants[1]):null}},wf.prototype.addCompactLayoutSupport=function(e){var t=function(t){var i=t.clone();return e.uniforms.tSelectionTexture.value&&(i.uniforms.tSelectionTexture.value=e.uniforms.tSelectionTexture.value),e.uniforms.tLayerMask.value&&(i.uniforms.tLayerMask.value=e.uniforms.tLayerMask.value),i.is2d=e.is2d,i.supportsViewportBounds=e.supportsViewportBounds,i.modelScale=e.modelScale,i.defines=Object.assign({},e.defines),i.attributes=Object.assign({},e.attributes),i},i=t(e);i.defines.UNPACK_POSITIONS=1;var n=t(e);n.defines.USE_INSTANCING=1;var r=t(e);r.defines.UNPACK_POSITIONS=1,r.defines.USE_INSTANCING=1,e.variants=[i,n,r],e.getCustomOverrideMaterial=function(e){if(e.defines){var t=(e.defines.UNPACK_POSITIONS?1:0)+(e.defines.USE_INSTANCING?2:0);if(t>0)return this.variants[t-1]}return null}},wf.prototype.removeMaterial=function(e){delete this._materials[e]},wf.prototype.findMaterial=function(e,t){var i=this._getMaterialHash(e,t);return this._materials[i]},wf.prototype.convertSharedMaterial=function(e,t,i){var n=this.findMaterial(e,i);return n||((n=this.convertOneMaterial(e,t,i)).hash=i),this._addMaterialRef(n,e.id),n},wf.prototype.convertOneMaterial=function(e,t,i){var n=e.getData(),r=n&&n.materials?n.materials.scene.SceneUnit:"inch",o=ou.isPrismMaterial(t),s=o&&ou.swapPrismWoodTextures(this._prismWoodTextures);s&&rt.warn("Unexpected wood textures converting a material");var a=ou.convertMaterial(t,r);if(n.doubleSided&&(a.side=v().DoubleSide),this.addMaterial(i,a),this._hasTransparentMaterial=this._hasTransparentMaterial||a.transparent,ou.hasTiling(t)){a.decals=[];var l=t.materials,c=l[t.userassets[0]];let e=c.properties.references.base_materials.connections,n=c.properties.references.tiles.connections,o=[];for(let s=0;s<n.length;s++){let c=l[n[s]];o.push(c),(f=ou.convertMaterial(t,r,null,e[s])).useTiling=!0,f.transparent=!0,a.decals.push({uv:0,material:f}),this.addMaterial(i+"|tile|"+s,f)}ou.materialTilingPattern(t,c,o,a.decals,r)}if(t.decals){a.decals||(a.decals=[]);for(var u=0,h=t.decals.length;u<h;u++){var d=t.decals[u],f=ou.convertMaterial(d.material,r);a.decals.push({uv:d.uv||0,material:f}),this.addMaterial(i+"|decal|"+u,f)}}return this._prismWoodTextures=o&&ou.swapPrismWoodTextures(s),a},wf.prototype.forEach=function(e,t,i,n){for(var r in n=n||this._materials){var o=n[r];t&&o.is2d||(e(o,r),i&&o.variants&&o.variants.forEach((function(t){t&&e(t)})))}},wf.prototype.forEachInModel=function(e,t,i){const n=this._getModelHash(e),r=(e,t)=>{-1!==t.indexOf(n)&&i(e)};this.forEach(r,!1,t),this.forEach(r,!1,t,this._materialsNonHDR)};var Cf={needsClear:!1,needsRender:!1,overlayDirty:!1};function Tf(e,t,i){let n=e.slots[i];n?-1==n.indexOf(t)&&n.push(t):e.slots[i]=[t]}function Mf(e,t){var i,n;this.bytes_per_node=t?32:40,e instanceof ArrayBuffer?(i=e.byteLength/this.bytes_per_node,n=e,this.nodeCount=i):(i=0|e,n=new ArrayBuffer(this.bytes_per_node*i),this.nodeCount=0),this.nodeCapacity=i,this.nodesRaw=n,this.is_lean_node=t,this.node_stride=this.bytes_per_node/4,this.node_stride_short=this.bytes_per_node/2,this.nodesF=new Float32Array(this.nodesRaw),this.nodesI=new Int32Array(this.nodesRaw),this.nodesS=new Uint16Array(this.nodesRaw)}wf.prototype.updateMaterials=function(){for(Cf.needsRender=!1;this._texturesToUpdate.length;){var e=this._texturesToUpdate.pop();for(let i in e.slots){let n=e.slots[i];for(var t=0;t<n.length;t++)n[t][i]=e.tex,n[t].needsUpdate=!0,Cf.needsRender=!0}}return Cf},wf.prototype.setTextureInCache=function(e,t,i,n){var r=this._getTextureHash(e,i.uri,i.mapName,t.id),o=this._textures[r];if(o){for(var s in o.tex||(o.tex=n),o.slots)for(var a=o.slots[s],l=0;l<a.length;l++)a[l][s]=n;this._texturesToUpdate.push(o)}},wf.prototype.loadTextureFromCache=function(e,t,i,n){var r=this._getTextureHash(e,i.uri,i.mapName,t.id),o=this._textures[r];if(o)o.tex?(t[n]=o.tex,t.needsUpdate=!0):(o.slots[n]||(o.slots[n]=[]),o.slots[n].push(t));else{var s={};s[n]=[t],this._textures[r]={slots:s,tex:null}}return!!o},wf.prototype.getOtgMaterials=function(e){const t=(e,t)=>{const i=t.indexOf(e);if(-1!==i)return{hash:e,idx:i};const n=e+"|"+Sf.INSTANCED,r=t.indexOf(n);if(-1!==r)return{hash:n,idx:r};const o=e+"|"+Sf.VERTEX_IDS,s=t.indexOf(o);return-1!==s?{hash:o,idx:s}:void 0};let i={};const n=e.getData(),r=n.fragments.materials,o=Object.keys(this._materials);for(let e=0;e<r.length;e++){const s=r[e],a=t(n.getMaterialHash(s),o);a&&(i[a.hash]=this._materials[a.hash],o.splice(a.idx,1))}return i},wf.prototype.getModelMaterials=function(e,t){var i=this._getModelHash(e);let n={};const r={};t&&e.isOTG()&&(n=this.getOtgMaterials(e));for(let e in this._materials)if(-1!==e.indexOf(i)){var o=this._materials[e];o.defines&&o.defines.hasOwnProperty("SELECTION_RENDERER")?r[e]=o:n[e]=o}var s={};for(let e in this._materialsNonHDR)-1!==e.indexOf(i)&&(s[e]=this._materialsNonHDR[e]);var a={};for(let e in this._textures)-1!==e.indexOf(i)&&(a[e]=this._textures[e]);return{mats:n,selectionMats:r,matsNonHDR:s,textures:a}},wf.prototype.exportModelMaterials=function(e,t){const i=this.getModelMaterials(e);return this.cleanup(e),i},wf.prototype.importModelMaterials=function(e,t){for(var i in e.mats){var n=e.mats[i];n.is2d?this.addLineMaterial(i,n,t):this.addHDRMaterial(i,n)}for(var i in e.matsNonHDR)this.addMaterialNonHDR(i,e.matsNonHDR[i]);for(var r in e.textures)this._textures[r]=e.textures[r]},wf.prototype.cloneMaterial=function(e,t){var i=e.clone();if(e.defines&&(i.defines=Object.assign({},e.defines)),(i instanceof v().MeshPhongMaterial||i.isPrismMaterial)&&(i.packedNormals=e.packedNormals,i.exposureBias=e.exposureBias,i.irradianceMap=e.irradianceMap,i.envMapExposure=e.envMapExposure,i.envRotationSin=e.envRotationSin,i.envRotationCos=e.envRotationCos,i.proteinType=e.proteinType,i.proteinMat=e.proteinMat,i.proteinCategories=e.proteinCategories,i.tonemapOutput=e.tonemapOutput,i.cutplanes=e.cutplanes,i.textureMaps=e.textureMaps,i.texturesLoaded=e.texturesLoaded),e.doNotCut&&(i.doNotCut=!0),e.is2d&&(i.is2d=!0),e.disableEnvMap&&(i.disableEnvMap=!0),e.supportsViewportBounds&&(i.supportsViewportBounds=!0),void 0!==e.wideLines&&(i.wideLines=e.wideLines),e.textureMaps)for(var n in e.textureMaps)if(e[n])i[n]=e[n];else if(t){var r=i.textureMaps[n],o=r.uri,s=r.mapName,a=this._getTextureHash(t,o,s,e.id),l=this._textures[a];l?Tf(l,i,n):rt.error("Missing texture receiver",a)}else rt.error("Cannot connect pending texture maps because cloneMaterial was called without a model");return this._applyMRTFlags(i),i},wf.prototype.setupMaterial=function(e,t,i){var n=e.getData(),r=this.findMaterial(e,i);if(!r){r=this.cloneMaterial(this.defaultMaterial,e);var o=this._getMaterialHash(e,i);this._materials[o]=r,rt.warn("Material ("+i+") missing, using default material instead.")}if(t.isLines||t.isWideLines||t.isPoints){var s=!!t.attributes.color,a=r;if(a||(a=this.defaultMaterial.clone()),t.isPoints)r=new(v().PointCloudMaterial)({vertexColors:s,size:t.pointSize});else{var l=s?"cachedLineMaterialVC":"cachedLineMaterial";r=a[l],t.isWideLines?(r||((r=a[l]=new(v().MeshBasicMaterial)({vertexColors:s})).wideLines=!0),t.isLines=!1,r.polygonOffset=a.polygonOffset,r.polygonOffsetFactor=a.polygonOffsetFactor,r.polygonOffsetUnits=a.polygonOffsetUnits,r.linewidth=a.linewidth):r||(r=a[l]=new(v().LineBasicMaterial)({vertexColors:s}))}s||(r.color=a.color),r.svfMatId=i;var c=this._getMaterialHash(e,i+"_line_"+r.id);this.addMaterialNonHDR(c,r),n.hasLines=!0}else r.svfMatId=i,ou.applyGeometryFlagsToMaterial(r,t);return r},wf.prototype._addMaterialRef=function(e,t){e._sharedBy||(e._sharedBy=[]);var i=e._sharedBy;return-1===i.indexOf(t)&&(i.push(t),!0)},wf.prototype._removeMaterialRef=function(e,t){var i=e._sharedBy,n=i?i.indexOf(t):-1;-1!==n&&i.splice(n,1)},wf.prototype.cleanup=function(e){var t=this._getModelHash(e),i={};for(var n in this._textures){var r=this._textures[n];-1===n.indexOf(t)?i[n]=r:r.tex&&(r.tex.dispose(),r.tex.needsUpdate=!0)}this._textures=i;var o={},s={type:"dispose"};for(var a in this._materials){var l=this._materials[a],c=!e||-1!==a.indexOf(t);let i=!1;if(l._sharedBy&&(c?l._sharedBy.length=0:(this._removeMaterialRef(l,e.id),0===l._sharedBy.length&&(c=!0,i=!0))),c){if((l=this._materials[a]).dispatchEvent(s),l.needsUpdate=!0,l.envMap=null,l.is2d){l.uniforms.tLayerMask.value=null,l.uniforms.tLineStyle.value=null;var u=l.uniforms.tRaster;u&&u.value instanceof v().Texture&&(u.value.dispose(),u.value.needsUpdate=!0)}if(i){var h=l.textureMaps;for(var d in h){var f=h[d],p=this._getTextureHash(e,f.uri,f.mapName,l.id);(r=this._textures[p])&&(r.tex&&(r.tex.dispose(),r.tex.needsUpdate=!0),delete this._textures[p])}}}else o[a]=this._materials[a]}this._materials=o;var m={};for(var a in this._materialsNonHDR){if(e&&-1===a.indexOf(t))m[a]=this._materialsNonHDR[a];else(l=this._materialsNonHDR[a]).dispatchEvent(s),l.needsUpdate=!0}this._materialsNonHDR=m;var g=(e,t)=>{var i=this._selectionTextures[e];i&&(i.dispose(),i.needsUpdate=!0,t&&delete this._selectionTextures[e])},y=(e,t)=>{const i=this._layerMaskTextures[e];void 0!==i&&(i.dispose(),i.needsUpdate=!0,t&&delete this._layerMaskTextures[e])};if(this._prismWoodTextures&&ou.disposePrismWoodTextures(this._prismWoodTextures),this._prismWoodTextures=void 0,e)g(e.id,!0),y(e.id,!0),delete this._layerMaps[e.id];else{for(var b in this._selectionTextures)this._selectionTextures.hasOwnProperty(b)&&g(b,!1);for(var b in this._selectionTextures={},this._layerMaskTextures)this._layerMaskTextures.hasOwnProperty(b)&&y(b,!1);this._layerMaskTextures={},this._layerMaps={},this._reflectionMap=null,this._irradianceMap=null}},wf.prototype.toggleDepthWriteTransparent=function(e){this._depthWriteTransparent!=e&&(this._depthWriteTransparent=e,this.forEach((function(t){t.lmv_depthWriteTransparent&&(t.depthWrite=e)}),!1,!0))},wf.prototype.isDepthWriteTransparentEnabled=function(){return this._depthWriteTransparent},wf.prototype.hasTwoSidedMaterials=function(){return this._needsTwoSided},wf.prototype.hasTransparentMaterial=function(){return this._hasTransparentMaterial},wf.prototype.texturesLoaded=function(){return 0===this._texturesToUpdate.length},wf.prototype.renderer=function(){return this._renderer},wf.prototype.setTonemapExposureBias=function(e){this._exposureBias=e;var t=Math.pow(2,e);this.forEach((function(e){Af(e,"exposureBias",t)}),!0,!0)},wf.prototype.setTonemapMethod=function(e){this._tonemapMethod=e,this.forEach((function(t){t.tonemapOutput=e,t.needsUpdate=!0}),!0,!0)},wf.prototype.setEnvExposure=function(e){var t=Math.pow(2,e);this._envMapExposure=t,this.forEach((function(e){Af(e,"envMapExposure",t)}),!0,!0)},wf.prototype.setEnvRotation=function(e){var t=this._envRotationSin=Math.sin(e),i=this._envRotationCos=Math.cos(e);this.forEach((function(e){e.envRotationSin=t,e.envRotationCos=i,e.needsUpdate=!0}),!0,!0)},wf.prototype.setReflectionMap=function(e){this._reflectionMap=e,this.forEach((function(t){t.disableEnvMap||Af(t,"envMap",e)}),!0,!0)},wf.prototype.setIrradianceMap=function(e){this._irradianceMap=e,this.forEach((function(t){Af(t,"irradianceMap",e)}),!0,!0)},wf.prototype.setDoubleSided=function(e,t){this._forceDoubleSided=e;let i={};i=t?this.getModelMaterials(t,!0).mats:this._materials,this.forEach((function(t){t.side=e?v().DoubleSide:v().FrontSide,t.needsUpdate=!0}),!0,!0,i)},wf.prototype.setCutPlanes=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i=!1;const n=this._cutplanes.length!==(e&&e.length||0),r=t!==this.cutplanesHideInterior,o=n||r;for(;this._cutplanes.length>0;)this._cutplanes.pop();if(this.cutplanesHideInterior=t,e)for(var s=0;s<e.length;s++)this._cutplanes.push(e[s].clone());if(o)for(var a in this.forEach((e=>{this._applyCutPlanes(e),i=i||e.side==v().DoubleSide}),!1,!0),this._materialsNonHDR)this._materialsNonHDR[a].doNotCut||(this._materialsNonHDR[a].needsUpdate=!0);return i||this._needsTwoSided},wf.prototype.getCutPlanes=function(){return this._cutplanes.slice()},wf.prototype.getCutPlanesRaw=function(){return this._cutplanes},wf.prototype._applyPolygonOffset=function(e){(e instanceof v().MeshPhongMaterial||e.isPrismMaterial)&&(e.polygonOffset=this._polygonOffsetOn,e.polygonOffsetFactor=this._polygonOffsetFactor,e.polygonOffsetUnits=this._polygonOffsetUnits,e.extraDepthOffset&&(e.polygonOffsetFactor+=e.extraDepthOffset),e.needsUpdate=!0)},wf.prototype.getPolygonOffsetOn=function(){return this._polygonOffsetOn},wf.prototype.getPolygonOffsetFactor=function(){return this._polygonOffsetFactor},wf.prototype.getPolygonOffsetUnits=function(){return this._polygonOffsetUnits},wf.prototype.togglePolygonOffset=function(e,t,i){this._polygonOffsetOn=e,this._polygonOffsetFactor=e?t||1:0,this._polygonOffsetUnits=e?i||.1:0;var n=this;this.forEach((function(e){n._applyPolygonOffset(e)}),!1,!0)},wf.prototype._applyMRTFlags=function(e){var t=e.supportsMrtNormals||e instanceof v().MeshPhongMaterial||e.isPrismMaterial||e instanceof v().MeshBasicMaterial||e instanceof v().LineBasicMaterial||e instanceof v().PointCloudMaterial||e instanceof v().PointsMaterial,i=e.mrtNormals,n=e.mrtIdBuffer;e.skipMrtNormals||(e.mrtNormals=t&&this._mrtNormals),e.mrtIdBuffer=this._mrtIdBuffer,e.mrtNormals===i&&e.mrtIdBuffer===n||(e.needsUpdate=!0)},wf.prototype.toggleMRTSetting=function(e){this._mrtNormals=e.mrtNormals,this._mrtIdBuffer=e.mrtIdBuffer;var t=this;function i(e){t._applyMRTFlags(e)}this.forEach(i,!1,!0),this.forEach(i,!1,!0,this._materialsNonHDR)},wf.prototype.adjustMaterialMRTSetting=function(e){this._applyMRTFlags(e)},wf.prototype.initLineStyleTexture=function(){this._lineStyleTex=yf()},wf.prototype.setLineStyleTexture=function(e){this._lineStyleTex=e},wf.prototype.initLayersTexture=function(e,t,i){for(var n=this._layerMaskTextures[i],r=n?n.image.data:new Uint8Array(65536),o=0,s=e;o<s;o++)r[o]=255;(n=n||new(v().DataTexture)(r,256,256,v().LuminanceFormat,v().UnsignedByteType,v().UVMapping,v().ClampToEdgeWrapping,v().ClampToEdgeWrapping,v().NearestFilter,v().NearestFilter,0)).generateMipmaps=!1,n.flipY=!1,n.needsUpdate=!0,this._layerMaskTextures[i]=n,this._layerMaps[i]=t},wf.prototype.setLayerVisible=function(e,t,i){for(var n=this._layerMaskTextures[i],r=n.image.data,o=this._layerMaps[i],s=t?255:0,a=0;a<e.length;++a){r[o[e[a]]]=s}n.needsUpdate=!0,this.forEach((function(e){e.is2d&&(e.needsUpdate=!0)}))},wf.prototype.initSelectionTexture=function(e,t){if(this._selectionTextures[t])return this._selectionTextures[t];for(var i=e||1,n=4096,r=0|Math.ceil(i/n),o=1;o<r;)o*=2;r=o;for(var s=new Uint8Array(n*r),a=0;a<i;a++)s[a]=0;var l=new(v().DataTexture)(s,n,r,v().LuminanceFormat,v().UnsignedByteType,v().UVMapping,v().ClampToEdgeWrapping,v().ClampToEdgeWrapping,v().NearestFilter,v().NearestFilter,0);return l.generateMipmaps=!1,l.flipY=!1,l.needsUpdate=!0,this._selectionTextures[t]=l,l},wf.prototype.highlightObject2D=function(e,t,i){var n=this._selectionTextures[i];n&&(n.image.data[e]=t?255:0,n.needsUpdate=!0)},wf.prototype._updatePixelScaleForMaterial=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._camera,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._deviceWidth,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._deviceHeight,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._pixelsPerUnit,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(e.is2d){if(e.isScreenSpace)if(e.uniforms.size.value.set(i,n),e.uniforms.aaRange.value=.5,null!=t&&t.isPerspective){e.uniforms.cameraPos.value.copy(t.position);const i=t.fov*Math.PI/180;e.uniforms.tanHalfFov.value=Math.tan(.5*i)}else e.uniforms.tanHalfFov.value=0;else e.uniforms.aaRange.value=.5/(r*e.modelScale*o);e.uniforms.pixelsPerUnit.value=r*e.modelScale*o}},wf.prototype.updatePixelScale=function(e,t,i,n){this._pixelsPerUnit=e,this._deviceWidth=t,this._deviceHeight=i,this._camera=n,this.forEach((r=>this._updatePixelScaleForMaterial(r,n,t,i,e)))},wf.prototype.updatePixelScaleForModel=function(e,t,i,n,r,o){const s=this.getModelMaterials(e),a=e=>this._updatePixelScaleForMaterial(e,o,i,n,t,r);Object.values(s.mats).forEach(a),Object.values(s.matsNonHDR).forEach(a),Object.values(s.selectionMats).forEach(a)},wf.prototype.updateSwapBlackAndWhite=function(e){var t=this._swapBlackAndWhite=e?1:0;this.forEach((function(e){e.is2d&&(e.uniforms.swap.value=t)}))},wf.prototype.setGrayscale=function(e){var t=this._grayscaleLines=e?1:0;this.forEach((function(e){e.is2d&&(e.uniforms.grayscale.value=t)}))},wf.prototype.updateViewportId=function(e){this.forEach((function(t){t.is2d&&(t.uniforms.viewportId.value=e,t.needsUpdate=!0)}))},wf.prototype.create2DMaterial=function(e,t,i,n,r){var o=e?e.getData():null,s="__lineMaterial__";t.image&&(s+="|image:"+t.image.name),t.clip&&(s+="|clip:"+JSON.stringify(t.clip)),i&&(s+="|id"),n&&(s+="|selection"),t.skipEllipticals&&(s+="|skipEllipticals"),t.skipCircles&&(s+="|skipCircles"),t.skipTriangleGeoms&&(s+="|skipTriangleGeoms"),t.skipMiterLines&&(s+="|skipMiterLines"),t.useInstancing&&(s+="|useInstancing"),t.isScreenSpace&&(s+="|isScreenSpace"),t.unpackPositions&&(s+="|unpackPositions"),t.hasLineStyles&&(s+="|hasLineStyles"),t.compositeOperation&&(s+="|"+t.compositeOperation),t.hasOpacity&&(s+="|hasOpacity"),t.noIdOutput&&(s+="|noIdOutput");var a=this._getMaterialHash(e,s);if(!this._materials.hasOwnProperty(a)){var l=new pf(t);if(i?(l.defines.ID_COLOR=1,l.blending=v().NoBlending):n?(l.uniforms.tSelectionTexture.value=n,l.uniforms.vSelTexSize.value.set(n.image.width,n.image.height),l.defines.SELECTION_RENDERER=1,this.get2dSelectionColor(l.uniforms.selectionColor)):(this.get2dSelectionColor(l.uniforms.selectionColor),l.mrtIdBuffer=this._mrtIdBuffer),t.skipEllipticals||(l.defines.HAS_ELLIPTICALS=1),t.skipCircles||(l.defines.HAS_CIRCLES=1),t.skipTriangleGeoms||(l.defines.HAS_TRIANGLE_GEOMS=1),t.skipMiterLines||(l.defines.HAS_MITER_LINES=1),t.noIdOutput&&(l.defines.NO_ID_OUTPUT=1),t.useInstancing&&(l.defines.USE_INSTANCING=1),t.unpackPositions&&!i&&(l.defines.UNPACK_POSITIONS=1),t.msdfFontTexture&&(l.defines.MSDF_TEXTURE_FONT=1),t.imageUVTexture&&(l.defines.IMAGE_UV_TEXTURE=1),t.viewportBounds&&(l.uniforms.viewportBounds.value=t.viewportBounds.clone(),l.defines.VIEWPORT_CLIPPING=1),"number"==typeof t.opacity&&(l.uniforms.opacity.value=t.opacity),t.image){var c=function(i,n){i?(i.wrapS=v().ClampToEdgeWrapping,i.wrapT=v().ClampToEdgeWrapping,i.minFilter=n?v().LinearFilter:v().LinearMipMapLinearFilter,i.magFilter=v().LinearFilter,i.anisotropy=1,i.flipY=!0,i.generateMipmaps=!0,i.needsUpdate=!0,t.msdfFontTexture||t.imageUVTexture||(l.defines.HAS_RASTER_QUADS=1),l.uniforms.tRaster.value=i,l.needsUpdate=!0,r&&r(i,e)):r&&r(i,e,t)};if("undefined"!=typeof HTMLCanvasElement&&t.image instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&t.image instanceof HTMLImageElement)c(new(v().Texture)(Hu.imageToCanvas(t.image,"multiply"==t.compositeOperation,t.compositeCanvasColor),v().UVMapping),!0);else Hu.loadTextureWithSecurity(t.image.dataURI,v().UVMapping,c,null,o.acmSessionId)}l.modelScale=t.modelScale||1,t.doNotCut&&(l.doNotCut=!0),l.textureMaps={},this.addLineMaterial(a,l,e&&e.id),(i||n)&&this.addCompactLayoutSupport(l)}return s},wf.prototype.set2dSelectionColor=function(e,t){_f=new(v().Color)(e),Ef=null==t?Ef:t,this.forEach((function(e){if(e.is2d&&e.uniforms){var t=e.uniforms.selectionColor;t&&(xf(t.value,_f,Ef),e.needsUpdate=!0)}}))},wf.prototype.get2dSelectionColor=function(e){return e&&xf(e.value,_f,Ef),_f},wf.prototype.get2dSelectionOpacity=function(){return Ef},wf.prototype.setMaterialViewportBounds=function(e,t){e.supportsViewportBounds&&(t?e.defines.VIEWPORT_CLIPPING?e.uniforms.viewportBounds.value.set(t.min.x,t.min.y,t.max.x,t.max.y):(e.uniforms.viewportBounds.value=new(v().Vector4)(t.min.x,t.min.y,t.max.x,t.max.y),e.defines.VIEWPORT_CLIPPING=1,e.needsUpdate=!0):e.defines.VIEWPORT_CLIPPING&&(delete e.defines.VIEWPORT_CLIPPING,e.needsUpdate=!0))},wf.prototype.setViewportBoundsForModel=function(e,t){this.forEachInModel(e,!1,(e=>{this.setMaterialViewportBounds(e,t)}))},Mf.prototype.setLeftChild=function(e,t){this.nodesI[e*this.node_stride+6]=t},Mf.prototype.getLeftChild=function(e){return this.nodesI[e*this.node_stride+6]},Mf.prototype.setPrimStart=function(e,t){this.is_lean_node?this.nodesI[e*this.node_stride+6]=t:this.nodesI[e*this.node_stride+8]=t},Mf.prototype.getPrimStart=function(e){return this.is_lean_node?this.nodesI[e*this.node_stride+6]:this.nodesI[e*this.node_stride+8]},Mf.prototype.setPrimCount=function(e,t){this.nodesS[e*this.node_stride_short+14]=t},Mf.prototype.getPrimCount=function(e){return this.nodesS[e*this.node_stride_short+14]},Mf.prototype.setFlags=function(e,t,i,n){this.nodesS[e*this.node_stride_short+15]=n<<3|i<<2|3&t},Mf.prototype.getFlags=function(e){return this.nodesS[e*this.node_stride_short+15]},Mf.prototype.setBox0=function(e,t){var i=e*this.node_stride,n=this.nodesF;n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],n[i+4]=t[4],n[i+5]=t[5]},Mf.prototype.getBoxThree=function(e,t){var i=e*this.node_stride,n=this.nodesF;t.min.x=n[i],t.min.y=n[i+1],t.min.z=n[i+2],t.max.x=n[i+3],t.max.y=n[i+4],t.max.z=n[i+5]},Mf.prototype.getBoxArray=function(e,t,i){var n=e*this.node_stride,r=this.nodesF;t[0+(i=i||0)]=r[n],t[1+i]=r[n+1],t[2+i]=r[n+2],t[3+i]=r[n+3],t[4+i]=r[n+4],t[5+i]=r[n+5]},Mf.prototype.setBoxThree=function(e,t){var i=e*this.node_stride,n=this.nodesF;n[i]=t.min.x,n[i+1]=t.min.y,n[i+2]=t.min.z,n[i+3]=t.max.x,n[i+4]=t.max.y,n[i+5]=t.max.z},Mf.prototype.getLargestPrimitiveSize=function(e){return this.nodesF[e*this.node_stride+9]},Mf.prototype.setLargestPrimitiveSize=function(e,t){const i=e*this.node_stride;this.nodesF[i+9]=t},Mf.prototype.makeEmpty=function(e){var t=e*this.node_stride,i=this.nodesI;i[t+6]=-1,i[t+7]=0,this.is_lean_node||(i[t+8]=-1)},Mf.prototype.realloc=function(e){if(this.nodeCount+e>this.nodeCapacity){var t=0|3*this.nodeCapacity/2;t<this.nodeCount+e&&(t=this.nodeCount+e);var i=new ArrayBuffer(t*this.bytes_per_node),n=new Int32Array(i);n.set(this.nodesI),this.nodeCapacity=t,this.nodesRaw=i,this.nodesF=new Float32Array(i),this.nodesI=n,this.nodesS=new Uint16Array(i)}},Mf.prototype.nextNodes=function(e){this.realloc(e);var t=this.nodeCount;this.nodeCount+=e;for(var i=0;i<e;i++)this.makeEmpty(t+i);return t},Mf.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};var If=3,Pf=1e-5,Lf=function(){function e(e,t,i,n){e[t]=.5*(i[n]+i[n+3]),e[t+1]=.5*(i[n+1]+i[n+4]),e[t+2]=.5*(i[n+2]+i[n+5])}function t(e,t,i){e[0]>t[i]&&(e[0]=t[i]),e[3]<t[i]&&(e[3]=t[i]),e[1]>t[i+1]&&(e[1]=t[i+1]),e[4]<t[i+1]&&(e[4]=t[i+1]),e[2]>t[i+2]&&(e[2]=t[i+2]),e[5]<t[i+2]&&(e[5]=t[i+2])}function i(e,t,i){e[0]>t[i]&&(e[0]=t[i]),e[1]>t[i+1]&&(e[1]=t[i+1]),e[2]>t[i+2]&&(e[2]=t[i+2]),e[3]<t[i+3]&&(e[3]=t[i+3]),e[4]<t[i+4]&&(e[4]=t[i+4]),e[5]<t[i+5]&&(e[5]=t[i+5])}function n(e,t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5])}function r(e,t,i,n){for(var r=0;r<3;r++)e[t+r]=i[n+3+r]-i[n+r]}function o(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]}var s=1/0;function a(e){e[0]=s,e[1]=s,e[2]=s,e[3]=-s,e[4]=-s,e[5]=-s}function l(e,t,i){return e<0||t<0||i<0?0:2*(e*t+t*i+i*e)}function c(e){var t=e[3]-e[0],i=e[4]-e[1],n=e[5]-e[2];return t<0||i<0||n<0?0:2*(t*i+i*n+n*t)}function u(){this.vb_left=new Float32Array(6),this.vb_right=new Float32Array(6),this.cb_left=new Float32Array(6),this.cb_right=new Float32Array(6),this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1}function h(){this.box_bbox=new Float32Array(6),this.box_centroid=new Float32Array(6),this.num_prims=0}function d(){this.BL=new Float32Array(6),this.CL=new Float32Array(6),this.NL=0,this.AL=0}u.prototype.reset=function(){this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1},h.prototype.reset=function(){this.num_prims=0,a(this.box_bbox),a(this.box_centroid)},d.prototype.reset=function(){this.NL=0,this.AL=0,a(this.BL),a(this.CL)};var f,p=[];for(f=0;f<16;f++)p.push(new h);var m=[];for(f=0;f<15;f++)m.push(new d);var g=new Float32Array(6),v=new Float32Array(6);function y(e,r,s,a,l,u,h){var d,f,y=16;for(y>s-r+1&&(y=s-r+1),d=0;d<y;d++)p[d].reset();for(d=0;d<y-1;d++)m[d].reset();for(h.num_bins=y,function(e,n,r,o,s,a,l){for(var c=e.centroids,u=e.primitives,h=e.finfo.boxes,d=e.finfo.boxStride,f=.99999*l/a[o],m=s[o],g=e.sort_prims,v=n;v<=r;v++){var y=0|u[v],b=0|f*(c[3*y+o]-m);b<0?b=0:b>=l&&(b=l-1),g[v]=b,p[b].num_prims++,i(p[b].box_bbox,h,y*d),t(p[b].box_centroid,c,3*y)}}(e,r,s,a,l,u,y),o(m[0].BL,p[0].box_bbox),o(m[0].CL,p[0].box_centroid),m[0].AL=c(m[0].BL),m[0].NL=p[0].num_prims,d=1;d<y-1;d++){f=p[d];var b=m[d];o(b.BL,m[d-1].BL),n(b.BL,f.box_bbox),b.AL=c(b.BL),o(b.CL,m[d-1].CL),n(b.CL,f.box_centroid),b.NL=m[d-1].NL+f.num_prims}o(g,p[d=y-1].box_bbox),o(v,p[d].box_centroid);var x=c(g),_=p[d].num_prims,E=d,S=x*_+m[d-1].AL*m[d-1].NL;for(o(h.vb_right,g),o(h.cb_right,p[d].box_centroid),o(h.vb_left,m[d-1].BL),o(h.cb_left,m[d-1].CL),h.num_left=m[d-1].NL,d-=1;d>=1;d--){f=p[d],n(g,f.box_bbox),n(v,f.box_centroid);var A=(x=c(g))*(_+=f.num_prims)+m[d-1].AL*m[d-1].NL;A<=S&&(S=A,E=d,o(h.vb_right,g),o(h.cb_right,v),o(h.vb_left,m[d-1].BL),o(h.cb_left,m[d-1].CL),h.num_left=m[d-1].NL)}h.best_split=E,h.best_cost=S}function b(e,n,r,s){const a=e.centroids,l=e.primitives,c=e.finfo.boxes,u=e.finfo.boxStride,h=e.sort_prims;for(let e=0;e<2;e++)p[e].reset();const d=r-n+1,f=Math.floor(d/2);for(let e=n;e<n+f;++e){const n=l[e];h[n]=0,i(p[0].box_bbox,c,n*u),t(p[0].box_centroid,a,3*n)}for(let e=n+f;e<=r;e++){const n=l[e];h[n]=1,i(p[1].box_bbox,c,n*u),t(p[1].box_centroid,a,3*n)}o(s.vb_right,p[1].box_bbox),o(s.cb_right,p[1].box_centroid),o(s.vb_left,p[0].box_bbox),o(s.cb_left,p[0].box_centroid),s.num_left=f,s.best_split=1,s.best_cost=0,s.num_bins=2}var x=new Float32Array(3);return{bvh_subdivide:function(e,i,n,o,s,l,c,h){r(x,0,l,0);var d=e.nodes,f=c?e.frags_per_leaf_node_transparent:e.frags_per_leaf_node,p=c?e.frags_per_inner_node_transparent:e.frags_per_inner_node,m=e.max_polys_per_node,g=0;x[1]>x[0]&&(g=1),x[2]>x[g]&&(g=2),d.setBox0(i,s);var v=0,_=0;let E=o-n+1,S=!1;if(e.finfo.hasPolygonCounts&&e.frags_per_inner_node){let t=new Set;var A=E<=e.frags_per_inner_node?o:n+e.frags_per_inner_node-1;const i=e.prim_sizes[e.primitives[n]];let r,s=n;for(;s<=A;s++){const n=e.primitives[s];if(S=(v+=e.finfo.getPolygonCount(n))>m,r=i/e.prim_sizes[n],S||=i>Pf&&r>e.max_size_ratio,e.per_tile_consolidation&&(t.add(e.finfo.getDrawCallId(n)),S||=t.size>=e.max_drawcalls_per_node),_++,S){++s;break}}if(e.per_tile_consolidation&&t.size>=e.max_drawcalls_per_node){const n=s;let o=[],a=[],l=!1;for(;s<=A;s++){const n=e.primitives[s],c=e.finfo.getPolygonCount(n);if(t.has(e.finfo.getDrawCallId(n))){if(l||=v+c>m,r=i/e.prim_sizes[n],l||=i>Pf&&r>e.max_size_ratio,l)break;o.push(n),_++,v+=c}else a.push(n)}if(o.length>0){s=n;for(let t=0;t<o.length;t++,s++)e.primitives[s]=o[t];for(let t=0;t<a.length;t++,s++)e.primitives[s]=a[t]}S||=l}}if(E<=f&&v<m&&!S||E<=1)return d.setLeftChild(i,-1),d.setPrimStart(i,n),d.setPrimCount(i,E),d.setFlags(i,0,0,c?1:0),void d.setLargestPrimitiveSize(i,e.prim_sizes[e.primitives[n]]);if(p&&(g=function(e,i,n,o,s,l,c,u){var h=e.primitives,d=e.centroids,f=s-o+1;f>e.frags_per_inner_node&&(f=e.frags_per_inner_node),f>u&&(f=u),i.setPrimStart(n,o),i.setPrimCount(n,f),i.setLargestPrimitiveSize(n,e.prim_sizes[e.primitives[o]]),o+=f,a(l);for(var p=o;p<=s;p++)t(l,d,3*h[p]);r(c,0,l,0);var m=0;return c[1]>c[0]&&(m=1),c[2]>c[m]&&(m=2),m}(e,d,i,n,o,l,x,_),E=o-(n+=d.getPrimCount(i))+1,0==E))return d.setLeftChild(i,-1),void d.setFlags(i,0,0,c?1:0);var w=new u;if(1==E)b(e,n,o,w);else{y(e,n,o,g,l,x,w);const t=o-(n+w.num_left)+1;0!=w.num_left&&0!=t||b(e,n,o,w)}!function(e,t,i,n,r,o,s){var a,l,c=e.primitives,u=e.sort_prims,h=0,d=0|t,f=0|s.best_split;for(a=t;a<=i;a++){var p=0|c[a];u[a]<f?c[d++]=p:u[h++]=p}for(l=0;l<h;l++)c[d+l]=u[l]}(e,n,o,0,0,0,w);var C=d.nextNodes(2),T=.5*(w.vb_left[3+g]+w.vb_left[g]),M=.5*(w.vb_right[3+g]+w.vb_right[g]);d.setFlags(i,g,T<M?0:1,c?1:0),d.setLeftChild(i,C),e.recursion_stack.push([e,C+1,n+w.num_left,o,w.vb_right,w.cb_right,c,h+1]),e.recursion_stack.push([e,C,n,n+w.num_left-1,w.vb_left,w.cb_left,c,h+1])},compute_boxes:function(n){var o=n.boxv_o,s=n.boxc_o,l=n.boxv_t,c=n.boxc_t;a(o),a(s),a(l),a(c);for(var u=n.centroids,h=n.finfo.boxes,d=n.finfo.boxStride,f=0,p=n.prim_count;f<p;f++){var m=n.primitives[f];e(u,3*m,h,d*m),f>=n.first_transparent?(t(c,u,3*m),i(l,h,d*m)):(t(s,u,3*m),i(o,h,d*m))}r(x,0,n.boxv_o,0)},box_area:function(e,t){return l(e[t+3]-e[t],e[t+4]-e[t+1],e[t+5]-e[t+2])},sqr_diag_len:function(e,t){var i=e[t+3]-e[t],n=e[t+4]-e[t+1],r=e[t+5]-e[t+2];return i*i+n*n+r*r},box_area_three:function(e){return l(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z)}}}();function Rf(e,t){this.boxes=e.boxes,this.polygonCounts=e.polygonCounts,this.hasPolygonCounts=!!this.polygonCounts,this.geomIds=e.geomids,this.flags=e.flags,this.materials=e.materials,this.materialDefs=t,this.count=e.length,this.boxStride=6,this.wantSort=e.wantSort??!0}Rf.prototype.getCount=function(){return this.count},Rf.prototype.isTransparent=function(e){return this.flags?!!(this.flags[e]&Df.IS_TRANSPARENT):!(!this.materialDefs||!this.materialDefs[this.materials[e]])&&this.materialDefs[this.materials[e]].transparent},Rf.prototype.getPolygonCount=function(e){return this.polygonCounts[e]},Rf.prototype.getGeometryId=function(e){return this.geomIds[e]},Rf.prototype.getCanBeConsolidated=function(e){return!!(this.flags[e]&Df.IS_CONSOLIDATED)},Rf.prototype.getDrawCallId=function(e){return`${this.materials[e]}${this.getCanBeConsolidated(e)?"":"_"+this.getGeometryId(e)}`},Rf.prototype.supportsPerTileConsolidation=function(){return!!this.materials&&!!this.flags&&!!this.geomIds};const Df=Object.freeze({IS_CONSOLIDATED:1,IS_TRANSPARENT:2}),Of=Object.freeze({BOX_AREA:"box_area",DIAMETER:"sqr_diag_len"});function Bf(e,t,i){this.finfo=i||new Rf(e,t),this.prim_count=this.finfo.getCount(),this.frags_per_leaf_node=-1,this.frags_per_inner_node=-1,this.nodes=null,this.work_buf=new ArrayBuffer(4*this.prim_count),this.sort_prims=new Int32Array(this.work_buf),this.primitives=new Int32Array(this.prim_count),this.centroids=new Float32Array(If*this.prim_count),this.boxv_o=new Float32Array(6),this.boxc_o=new Float32Array(6),this.boxv_t=new Float32Array(6),this.boxc_t=new Float32Array(6),this.recursion_stack=[]}Bf.prototype.sortPrimitives=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Of.BOX_AREA;var i=new Float32Array(this.max_size_ratio===1/0?this.work_buf:this.prim_count),n=this.primitives,r=0,o=e;const s=Lf[t];var a,l;for(a=0,l=this.prim_count;a<l;a++){n[a]=a;var c=this.finfo.isTransparent(a);c&&r++,o?(i[a]=s(this.finfo.boxes,this.finfo.boxStride*a),c&&(i[a]=-i[a])):i[a]=c?-1:1}if(o)Array.prototype.sort.call(this.primitives,(function(e,t){return i[t]-i[e]}));else if(r&&r<this.prim_count){var u=new Int32Array(r),h=0,d=0;for(a=0,l=this.prim_count;a<l;a++)i[a]>=0?n[h++]=n[a]:u[d++]=n[a];n.set(u,this.prim_count-r)}this.prim_sizes=i,this.first_transparent=this.prim_count-r},Bf.prototype.build=function(e){var t=e&&!!e.useSlimNodes,i=this;function n(t,n,r){Object.prototype.hasOwnProperty.call(e,t)?i[t]=e[t]:i[t]=n,void 0!==r&&i[t]>r&&(i[t]=r)}if(n("max_size_ratio",1/0),n("per_tile_consolidation",!1),e.sortFuncType===Of.DIAMETER&&(this.max_size_ratio*=this.max_size_ratio),t)n("frags_per_leaf_node",1,65535),n("frags_per_inner_node",0,0),n("frags_per_leaf_node_transparent",1,65535),n("frags_per_inner_node_transparent",0,0),n("max_polys_per_node",1/0);else{var r=e.isWeakDevice?.5:1;n("frags_per_leaf_node",0|256*r,65535),n("frags_per_inner_node",0|this.frags_per_leaf_node,65535),n("frags_per_leaf_node_transparent",this.frags_per_leaf_node,65535),n("frags_per_inner_node_transparent",0,65535),n("max_polys_per_node",0|2e4*r),n("max_drawcalls_per_node",1/0),n("want_sort",this.finfo.wantSort)}if(this.per_tile_consolidation=this.per_tile_consolidation&&this.finfo.supportsPerTileConsolidation()&&this.want_sort,this.nodes&&this.nodes.is_lean_node==t)this.nodes.nodeCount=0;else{for(var o=this.prim_count/this.frags_per_leaf_node,s=1;s<o;)s*=2;this.nodes=new Mf(s,!!e&&e.useSlimNodes)}this.sortPrimitives(this.want_sort,e.sortFuncType),Lf.compute_boxes(this);var a,l=this.nodes.nextNodes(2);for(Lf.bvh_subdivide(this,l,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);this.recursion_stack.length;)a=this.recursion_stack.pop(),Lf.bvh_subdivide(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7]);for(Lf.bvh_subdivide(this,l+1,this.first_transparent,this.prim_count-1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)a=this.recursion_stack.pop(),Lf.bvh_subdivide(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7]);this.prim_sizes.buffer!==this.work_buf&&delete this.prim_sizes};class Nf{nodes;primitives;options;constructor(e,t,i,n){this.nodes=new Mf(e,t),this.primitives=i,this.options=n}traverseBreadthFirst(e){const t=[];let i=0,n=0;t[n++]=0;let r=!1,o=!1;for(;!r;){for(;i!==n;){const r=t[i++];e(r);const o=this.nodes.getLeftChild(r);-1!==o&&(t[n++]=o,t[n++]=o+1)}o?r=!0:(t[n++]=1,o=!0)}}}const Uf={NODE_TYPE_ASSEMBLY:0,NODE_TYPE_INSERT:1,NODE_TYPE_LAYER:2,NODE_TYPE_COLLECTION:3,NODE_TYPE_COMPOSITE:4,NODE_TYPE_MODEL:5,NODE_TYPE_GEOMETRY:6,NODE_TYPE_BITS:7};var kf=1073741824,Ff=2147483648;function Vf(e,t,i){this.nodeAccess=e,this.maxDepth=i,this.objectCount=t,this.numHidden=0,this.numOff=0,this.fragList=null}Vf.prototype.dtor=function(){this.nodeAccess.dtor(),this.nodeAccess=null,this.fragList=null},Vf.prototype.setFlagNode=function(e,t,i){var n=this.nodeAccess.getNodeFlags(e);return!!(n&t)!=i&&(i?this.nodeAccess.setNodeFlags(e,n|t):this.nodeAccess.setNodeFlags(e,n&~t),!0)},Vf.prototype.setFlagGlobal=function(e,t){var i=this.nodeAccess,n=0,r=i.numNodes;if(t)for(;n<r;n++)i.setNodeFlags(n,i.getNodeFlags(n)|e);else for(var o=~e;n<r;n++)i.setNodeFlags(n,i.getNodeFlags(n)&o)},Vf.prototype.setNodeOff=function(e,t){var i=this.setFlagNode(e,kf,t);return i&&(t?this.numOff++:this.numOff--),i},Vf.prototype.isNodeOff=function(e){return!!(this.nodeAccess.getNodeFlags(e)&kf)},Vf.prototype.setNodeHidden=function(e,t){var i=this.setFlagNode(e,Ff,t);return i&&(t?this.numHidden++:this.numHidden--),i},Vf.prototype.isNodeHidden=function(e){return!!(this.nodeAccess.getNodeFlags(e)&Ff)},Vf.prototype.lockNodeSelection=function(e,t){return this.setFlagNode(e,16384,t)},Vf.prototype.isNodeSelectionLocked=function(e){return!!(16384&this.nodeAccess.getNodeFlags(e))},Vf.prototype.lockNodeVisible=function(e,t){return this.setFlagNode(e,4096,t)},Vf.prototype.isNodeVisibleLocked=function(e){return!!(4096&this.nodeAccess.getNodeFlags(e))},Vf.prototype.isNodeExplodeLocked=function(e){return!!(8192&this.nodeAccess.getNodeFlags(e))},Vf.prototype.lockNodeExplode=function(e,t){return this.setFlagNode(e,8192,t)},Vf.prototype.getNodeType=function(e){return this.nodeAccess.getNodeFlags(e)&Uf.NODE_TYPE_BITS},Vf.prototype.isNodeSelectable=function(e){return!(536870912&this.nodeAccess.getNodeFlags(e))},Vf.prototype.getNodeParentId=function(e){return this.nodeAccess.getParentId(e)},Vf.prototype.getRootId=function(){return this.nodeAccess.rootId},Vf.prototype.getNodeName=function(e,t){return this.nodeAccess.name(e,t)},Vf.prototype.getChildCount=function(e){return this.nodeAccess.getNumChildren(e)};var Gf=new Array(6);Vf.prototype.getNodeBox=function(e,t){if(!this.nodeAccess.nodeBoxes)return this.fragList?(t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0,void this.enumNodeFragments(e,(e=>{this.fragList.getOriginalWorldBounds(e,Gf),t[0]=Math.min(t[0],Gf[0]),t[1]=Math.min(t[1],Gf[1]),t[2]=Math.min(t[2],Gf[2]),t[3]=Math.max(t[3],Gf[3]),t[4]=Math.max(t[4],Gf[4]),t[5]=Math.max(t[5],Gf[5])}),!0)):void rt.error("getNodeBox() requires fragBoxes or nodeBoxes");this.nodeAccess.getNodeBox(e,t)},Vf.prototype.getNodeIndex=function(e){return this.nodeAccess.getIndex(e)},Vf.prototype.enumNodeFragments=function(e,t,i){var n;"number"==typeof e?n=e:e&&(n=e.dbId);const r=e=>{var n=this.nodeAccess.enumNodeFragments(e,t);return n||(i&&(n=this.enumNodeChildren(e,(e=>r(e))))?n:void 0)};return r(n)},Vf.prototype.enumNodeChildren=function(e,t,i){var n;if("number"==typeof e?n=e:e&&(n=e.dbId),i&&t(n))return n;const r=e=>{var n=this.nodeAccess.enumNodeChildren(e,(n=>t(n,e)?n:i?r(n):void 0));if(n)return n};return r(n)},Vf.prototype.findNodeForSelection=function(e,t){if(t===po.LEAF_OBJECT)return e;var i,n,r=e;if(t===po.FIRST_OBJECT){var o=[];for(i=e;i;)o.push(i),i=this.getNodeParentId(i);for(var s=o.length-1;s>=0;s--)if((n=this.getNodeType(o[s]))!==Uf.NODE_TYPE_MODEL&&n!==Uf.NODE_TYPE_LAYER&&n!==Uf.NODE_TYPE_COLLECTION){r=o[s];break}}else if(t===po.LAST_OBJECT)for(i=e;i;){if((n=this.getNodeType(i))===Uf.NODE_TYPE_COMPOSITE){r=i;break}i=this.getNodeParentId(i)}return r},Vf.prototype.setFragmentList=function(e){this.fragList=e},Vf.prototype.search=function(e){const t=e.toLowerCase();let i=[];return this.enumNodeChildren(this.getRootId(),((e,n)=>{var r;((null===(r=this.getNodeName(e))||void 0===r?void 0:r.toLowerCase())||"").indexOf(t)>-1&&i.push(e)}),!0),i};class zf{constructor(e){e?(this.buf=e.buf,this.idx=e.idx,this.next=e.next):(this.buf=new Uint8Array(256),this.next=0,this.idx=[0])}allocate(e){if(this.buf.length-this.next<e){var t=Math.max(3*this.buf.length/2,this.buf.length+e),i=new Uint8Array(t);i.set(this.buf),this.buf=i}}add(e){if(null==e)return 0;if(!e.length)return this.idx.push(this.next),this.idx.length-1;var t=ut(e,null);return this.allocate(t),this.next+=ut(e,this.buf,this.next),this.idx.push(this.next),this.idx.length-1}get(e){if(e){var t=this.idx[e-1],i=this.idx[e];return t===i?"":ct(this.buf,t,i-t)}}flatten(){this.idx=jf(this.idx)}}var Hf=5;function Wf(){this.nodes=[],this.nextNode=0,this.children=[],this.nextChild=0,this.dbIdToIndex={},this.names=[],this.s2i={},this.strings=new zf,this.nameSuffixes=[],this.getIndex(0)}function jf(e){var t=new Int32Array(e.length);return t.set(e),t}function qf(e,t,i){this.nodes=e.nodes,this.children=e.children,this.dbIdToIndex=e.dbIdToIndex,this.names=e.names,this.nameSuffixes=e.nameSuffixes,this.strings=new zf(e.strings),this.rootId=t,this.numNodes=this.nodes.length/Hf,this.visibleIds=null,this.nodeBoxes=i}Wf.prototype.getIndex=function(e){var t=this.dbIdToIndex[e];if(t)return t;t=this.nextNode++,this.nodes.push(e);for(var i=1;i<Hf;i++)this.nodes.push(0);return this.dbIdToIndex[e]=t,t},Wf.prototype.setNode=function(e,t,i,n,r,o){var s,a=this.getIndex(e),l=a*Hf,c=r.length,u=o&&o.length;for(u&&(c+=o.length),this.nodes[l+1]=t,this.nodes[l+2]=this.nextChild,this.nodes[l+3]=u?-c:c,this.nodes[l+4]=n,s=0;s<r.length;s++)this.children[this.nextChild++]=this.getIndex(r[s]);if(u)for(s=0;s<o.length;s++)this.children[this.nextChild++]=-o[s]-1;this.nextChild>this.children.length&&console.error("Child index out of bounds -- should not happen"),this.processName(a,i)},Wf.prototype.processName=function(e,t){var i,n,r=-1,o=-1;if(t&&(o=t.lastIndexOf("]"),-1!==(r=t.lastIndexOf("["))&&-1!==o||(r=t.lastIndexOf(":"),o=t.length)),r>=0&&o>r){i=t.slice(0,r+1);var s=t.slice(r+1,o);(n=parseInt(s,10))&&n+""===s||(i=t,n=0)}else i=t,n=0;var a=this.s2i[i];void 0===a&&(a=this.strings.add(i),this.s2i[i]=a),this.names[e]=a,this.nameSuffixes[e]=n},Wf.prototype.flatten=function(){this.nodes=jf(this.nodes),this.children=jf(this.children),this.names=jf(this.names),this.nameSuffixes=jf(this.nameSuffixes),this.strings.flatten(),this.s2i=null},qf.prototype.dtor=function(){this.nodes=null,this.children=null,this.dbIdToIndex=null,this.names=null,this.nameSuffixes=null,this.strings=null,this.visibleIds=null,this.nodeBoxes=null},qf.prototype.getNumNodes=function(){return this.numNodes},qf.prototype.getIndex=function(e){return this.dbIdToIndex[e]},qf.prototype.name=function(e,t){var i,n=this.dbIdToIndex[e],r=this.strings.get(this.names[n]),o=this.nameSuffixes[n];o?i="["===r.charAt(r.length-1)?r+o+"]":r+o:i=r;return t&&(this.childCounts||this.computeChildCounts(),this.childCounts[e]>0&&(i+=" ("+this.childCounts[e]+")")),i},qf.prototype.getParentId=function(e){var t=this.dbIdToIndex[e];return this.nodes[t*Hf+1]},qf.prototype.getNodeFlags=function(e){var t=this.dbIdToIndex[e];return this.nodes[t*Hf+4]},qf.prototype.setNodeFlags=function(e,t){var i=this.dbIdToIndex[e];i&&(this.nodes[i*Hf+4]=t)},qf.prototype.getNumChildren=function(e){var t=this.dbIdToIndex[e],i=this.nodes[t*Hf+3];if(i>=0)return i;var n=this.nodes[t*Hf+2];i=Math.abs(i);for(var r=0,o=0;o<i;o++){if(this.children[n+o]<0)break;r++}return r},qf.prototype.getNumFragments=function(e){var t=this.dbIdToIndex[e],i=this.nodes[t*Hf+3];if(i>=0)return 0;for(var n=this.nodes[t*Hf+2],r=0,o=(i=Math.abs(i))-1;o>=0;o--){if(this.children[n+o]>=0)break;r++}return r},qf.prototype.getNodeBox=function(e,t){for(var i=6*this.getIndex(e),n=0;n<6;n++)t[n]=this.nodeBoxes[i+n]},qf.prototype.getVisibleIds=function(){return this.visibleIds||(this.visibleIds=Object.keys(this.dbIdToIndex).map((function(e){return parseInt(e)}))),this.visibleIds},qf.prototype.enumNodeChildren=function(e,t){var i=this.dbIdToIndex[e],n=this.nodes[i*Hf+2],r=this.nodes[i*Hf+3];r=Math.abs(r);for(var o=0;o<r;o++){var s=this.children[n+o];if(s<0)break;if(t(this.nodes[s*Hf+0],e,i))return e}},qf.prototype.enumNodeFragments=function(e,t){var i=this.dbIdToIndex[e],n=this.nodes[i*Hf+2],r=this.nodes[i*Hf+3];if(r<0){r=-r;for(var o=0;o<r;o++){var s=this.children[n+o];if(!(s>0)&&t(-s-1,e,i))return e}}},qf.prototype.computeBoxes=function(e){this.nodeBoxes||(this.nodeBoxes=new Float32Array(6*this.numNodes));var t=this,i=t.getIndex(t.rootId),n=t.nodeBoxes;function r(e,i,r){var o=t.getIndex(e);s(e,o);for(var a=6*r,l=6*o,c=0;c<3;c++)n[a+c]>n[l+c]&&(n[a+c]=n[l+c]),n[a+c+3]<n[l+c+3]&&(n[a+c+3]=n[l+c+3])}function o(t,i,r){for(var o=6*t,s=6*r,a=0;a<3;a++)n[s+a]>e[o+a]&&(n[s+a]=e[o+a]),n[s+a+3]<e[o+a+3]&&(n[s+a+3]=e[o+a+3])}function s(e,i){var s=6*i;n[s]=n[s+1]=n[s+2]=1/0,n[s+3]=n[s+4]=n[s+5]=-1/0,t.getNumChildren(e)&&t.enumNodeChildren(e,r,!0),t.getNumFragments(e)&&t.enumNodeFragments(e,o)}s(t.rootId,i)},qf.prototype.computeChildCounts=function(){this.childCounts||(this.childCounts={});const e=this,t=e.childCounts;!function i(n){t[n]=0;let r=0;return 4===e.getNodeFlags(n)?r=1:(e.getNumChildren(n)&&e.enumNodeChildren(n,(e=>{t[n]+=i(e)}),!0),e.getNumFragments(n)&&(r=1)),t[n]+r}(e.rootId)},qf.prototype.dbIdToIndexFiltered=function(e){const t={},i=this,n=r=>{let o=e(r);return i.enumNodeChildren(r,(e=>{n(e)&&(o=!0)})),o&&(t[r]=i.dbIdToIndex[r]),o};return n(this.rootId),t};const Kf="GET_PROPERTIES",Xf="UNLOAD_PROPERTYDB";let Yf,Qf=1;const Zf={};function $f(e){const t=e.data;if(t&&t.debug)return void rt.debug(t.message);const i=t&&t.cbId&&Zf[t.cbId];i&&(t.progress?i[2]&&i[2](t.progress):(t.error?i[1]&&i[1](t.error):i[0]&&i[0](t.result),delete Zf[t.cbId]))}function Jf(e,t,i){const n=Qf++;return Zf[n]=[e,t,i],n}function ep(){return Yf}function tp(){Yf&&(Yf.terminate(),Yf=void 0)}function ip(){Yf&&Yf.doOperation({operation:Xf,clearCaches:!0})}const np=Object.freeze({NotLoaded:0,Available:1,Loading:2,Failed:3});class rp{static useCustomProperties=!1;constructor(e,t,i){var n,r;this.eventTarget=i||new Ba,this.model=t,this.svf=t&&t.getData(),this.dbPath="",this.sharedDbPath=!1;const o=this.svf&&this.svf.loadOptions.bubbleNode&&this.svf.loadOptions.bubbleNode.findViewableParent()._getOtgManifest(),s=o&&this.svf&&this.svf.is2d;if(this.svf&&!s&&this.svf.propertydb&&this.svf.propertydb.avs.length){this.dbFiles=this.svf.propertydb;for(let e in this.dbFiles)this.dbFiles[e][0]&&(this.dbFiles[e][0].path=this.dbFiles[e][0].path.replace(/\\/g,"/"));const t=ni(this.svf.basePath);if(e){let i=ei.simplifyPath(t+this.svf.propertydb.avs[0].path);if(i=i.slice(0,i.lastIndexOf("/")+1),i===e){const i={};for(let n in this.dbFiles){const{path:r,isShared:o}=this.dbFiles[n][0];let s=ei.simplifyPath(t+r);0===s.indexOf(e)&&(s=s.slice(e.length)),i[n]=[{path:s,isShared:o}]}this.dbFiles=i,this.dbPath=e,this.sharedDbPath=!0}else this.dbPath=t,this.sharedDbPath=!1}else this.dbPath=t,this.sharedDbPath=!1}else{if(this.sharedDbPath=!0,this.svf&&this.svf.loadOptions.bubbleNode){this.dbPath=e;let t=this.svf.loadOptions.bubbleNode.getPropertyDbManifest();this.dbFiles=t.propertydb,this.needsDbIdRemap=t.needsDbIdRemap}else rt.warn("Deprecated shared property database initialization without bubbleNode in Model load options."),this.dbPath=e,this.dbFiles={attrs:[],avs:[],ids:[],values:[],offsets:[]};rt.log("Using shared db path "+e)}o&&(this.needsDbIdRemap=this.svf.loadOptions.needsDbIdRemap||this.needsDbIdRemap),this.queryParams="";let a=null===(n=this.model)||void 0===n||null===(n=n.getDocumentNode())||void 0===n||null===(n=n.getDocument())||void 0===n?void 0:n.getAcmSessionId(this.dbPath);a=a||(null===(r=this.svf)||void 0===r?void 0:r.acmSessionId),this.svf&&a&&(this.queryParams="acmsession="+a),this.loadProgress=0,this.cbId=void 0,this.idLoadState=np.NotLoaded,this.waitingForExternalIds=[]}dtor(){this.asyncPropertyOperation({operation:Xf},(function(){}),(function(){}));const e=Boolean(this.cbId),t=this.instanceTree||this.propertyDbError;var i;e&&!t&&(i=this.cbId,delete Zf[i],this.propertyDbError={propDbWasUnloaded:!0},this.eventTarget.dispatchEvent({type:Kn,svf:this.svf,model:this.model,target:this})),this.model=null,this.svf=null}processLoadResult(e){if(e.instanceTreeStorage){const i=new qf(e.instanceTreeStorage,e.rootId,e.instanceBoxes);this.instanceTree=new Vf(i,e.objectCount,e.maxTreeDepth),this.svf&&((t=this).svf.instanceTree=t.instanceTree,this.instanceTree.setFragmentList(this.model.getFragmentList()))}var t;e.objectCount&&(this.hasObjectProperties=e.objectCount,this.svf&&(this.svf.hasObjectProperties=e.objectCount)),e.dbidOldToNew&&this.model.setDbIdRemap(e.dbidOldToNew),this.onLoadProgress(100),this.eventTarget.dispatchEvent({type:qn,svf:this.svf,model:this.model,target:this})}processLoadError(e){const t=this;t.propertyDbError=e,t.onLoadProgress(100),t.eventTarget.dispatchEvent({type:Kn,svf:t.svf,model:t.model,target:t})}load(e){const t=this;e=rp.useCustomProperties?Object.assign({useCustomProperties:!0},e):e||{},Yf||(Yf=fi("PropWorker",!0),Yf.addEventListener("message",$f));this.cbId=Jf((function(e){t.processLoadResult(e)}),(function(e){t.processLoadError(e)}),(function(e){t.onLoadProgress(e.percent)}));const i=this.svf&&this.svf.loadOptions,n=!(i&&i.disablePrecomputedNodeBoxes),r=!(!i||!i.skipExternalIds);let o;r||(this.idLoadState=np.Available),o=this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes?"CREATE_TREE":"LOAD_PROPERTYDB";const s={operation:o,dbPath:this.dbPath,sharedDbPath:this.sharedDbPath,propertydb:this.dbFiles,fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:n&&this.svf&&this.svf.fragments.boxes,needsDbIdRemap:this.needsDbIdRemap,is2d:this.svf&&this.svf.is2d,cbId:this.cbId,queryParams:this.queryParams,skipExternalIds:r,gltfTree:this.svf.instanceTree,dbToFragId:this.svf&&this.svf.fragments.dbToFragId,...e};Yf.doOperation(Fe(s))}asyncPropertyOperation(e,t,i,n){const r=this;if(e.dbPath=this.dbPath,r.instanceTree||r.hasObjectProperties)e.cbId=Jf(t,i,n),Yf.doOperation(e);else if(r.propertyDbError)i&&i(r.propertyDbError);else{const o=function(s){r.model===s.model&&(r.eventTarget.removeEventListener(qn,o),r.eventTarget.removeEventListener(Kn,o),r.instanceTree||r.hasObjectProperties||r.propertyDbError?r.asyncPropertyOperation(e,t,i,n):i&&i({code:st.UNKNOWN_FAILURE,msg:"Failed to load properties"}))};r.eventTarget.addEventListener(qn,o),r.eventTarget.addEventListener(Kn,o)}}getProperties(e,t,i){this.idLoadState===np.NotLoaded&&rt.warn("Calling getProperties() will cause loading of the potentially large externalIDs file. Use getProperties2() to avoid this warning."),this.getProperties2(e,t,i,{needsExternalId:!0})}getProperties2(e,t,i,n){const r=()=>{this.asyncPropertyOperation({operation:Kf,dbId:e,gltfTree:this.svf&&this.svf.instanceTreeBackup},t,i)};n&&n.needsExternalId?this.loadExternalIds().then(r).catch(i):r()}getBulkProperties(e,t,i,n,r){const o={ignoreHidden:r,propFilter:t,needsExternalId:!t||t.includes("externalId")};o.needsExternalId&&this.idLoadState===np.NotLoaded&&rt.warn("Calling getProperties() will cause loading of the potentially large externalIDs file. Use getProperties2() to avoid this warning."),this.getBulkProperties2(e,o,i,n)}getBulkProperties2(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const r=()=>{this.asyncPropertyOperation({operation:Kf,dbIds:e,propFilter:t.propFilter,categoryFilter:t.categoryFilter,ignoreHidden:t.ignoreHidden},i,n)};t&&t.needsExternalId?this.loadExternalIds().then(r).catch(n):r()}getPropertySet(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const r=()=>{this.asyncPropertyOperation({operation:"GET_PROPERTY_SET",dbIds:e,propFilter:t.propFilter,ignoreHidden:t.ignoreHidden,fileType:t.fileType},i,n)};t&&t.needsExternalId?this.loadExternalIds().then(r).catch(n):r()}searchProperties(e,t,i,n,r){this.asyncPropertyOperation({operation:"SEARCH_PROPERTIES",searchText:e,attributeNames:t,searchOptions:r},i,n)}findProperty(e){const t=this;return new Promise((function(i,n){t.asyncPropertyOperation({operation:"FIND_PROPERTY",propertyName:e},i,n)}))}diffProperties(e,t,i,n,r){this.asyncPropertyOperation({operation:"DIFF_PROPERTIES",dbPath2:e,diffOptions:n},t,i,r)}findLayers(){const e=this;return new Promise((function(t,i){e.asyncPropertyOperation({operation:"FIND_LAYERS"},t,i)}))}getExternalIdMapping(e,t,i){return this.loadExternalIds().then((()=>{this.asyncPropertyOperation({operation:"BUILD_EXTERNAL_ID_MAPPING",extIdFilter:i},e,t)}))}getLayerToNodeIdMapping(e,t){this.asyncPropertyOperation({operation:"BUILD_LAYER_TO_NODE_ID_MAPPING"},e,t)}executeUserFunction(e,t){if("function"==typeof e)e=e.toString();else if("string"!=typeof e)return Promise.reject("Expected Function or string.");let i;try{i=new Blob([e],{type:"application/javascript"})}catch(t){let n=new BlobBuilder;n.append(e),i=n.getBlob()}let n=URL.createObjectURL(i);return new Promise(((e,i)=>{this.asyncPropertyOperation({operation:"USER_FUNCTION",userFunction:n,userData:t},e,i)}))}isObjectTreeLoaded(){return!!this.instanceTree}getObjectTree(e,t){const i=this;if(i.instanceTree)e(i.instanceTree);else if(i.propertyDbError)t&&t(i.propertyDbError);else if("hasObjectProperties"in i)i.svf&&i.svf.is2d&&t?t("F2D files do not have an InstanceTree."):e(null);else{const n=function(){i.eventTarget.removeEventListener(qn,n),i.eventTarget.removeEventListener(Kn,n),i.getObjectTree(e,t)};i.eventTarget.addEventListener(qn,n),i.eventTarget.addEventListener(Kn,n)}}onLoadProgress(e){this.eventTarget.dispatchEvent({type:Xn,percent:e,svf:this.svf,model:this.model,target:this}),this.loadProgress=e}getLoadProgress(){return this.loadProgress}isLoadDone(){return 100==this.loadProgress}loadExternalIds(){switch(this.idLoadState){case np.Available:return Promise.resolve();case np.Failed:return Promise.reject();case np.NotLoaded:{this.idLoadState=np.Loading;const e=()=>{this.idLoadState=np.Available,this.waitingForExternalIds.forEach((e=>e.resolve()))},t=()=>{this.idLoadState=np.Failed,this.waitingForExternalIds.forEach((e=>e.reject()))},i={operation:"LOAD_EXTERNAL_IDS",idsFile:this.dbFiles.ids[0],queryParams:this.queryParams};Fe(i),this.asyncPropertyOperation(i,e,t);break}}return new Promise(((e,t)=>{this.waitingForExternalIds.push({resolve:e,reject:t})}))}refreshCustomProperties(e){return new Promise(((t,i)=>{e.operation="REFRESH_CUSTOM_PROPERTIES",e.cbId=Jf(t,i),e.dbPath=this.dbPath,Yf.doOperation(e)}))}applyCustomProperties(e){return new Promise(((t,i)=>{e.operation="APPLY_CUSTOM_PROPERTIES",e.cbId=Jf(t,i),e.dbPath=this.dbPath,Yf.doOperation(e)}))}refreshCustomPropertiesValues(e){return new Promise(((t,i)=>{e.operation="REFRESH_CUSTOM_PROPERTIES_VALUES",e.dbPath=this.dbPath;e.cbId=Jf((n=>{if(this.instanceTree||"hasObjectProperties"in this)t(n);else{const n=this.eventTarget,r=()=>{n.removeEventListener(qn,r),n.removeEventListener(Kn,r),e.cbId=Jf(t,i),Yf.doOperation(e)};n.addEventListener(qn,r),n.addEventListener(Kn,r)}}),i),Yf.doOperation(e)}))}setCustomPropertiesValues(e){return new Promise(((t,i)=>{e.operation="SET_CUSTOM_PROPERTIES_VALUES",e.dbPath=this.dbPath;e.cbId=Jf((n=>{if(this.instanceTree||"hasObjectProperties"in this)t(n);else{const n=this.eventTarget,r=()=>{n.removeEventListener(qn,r),n.removeEventListener(Kn,r),e.cbId=Jf(t,i),Yf.doOperation(e)};n.addEventListener(qn,r),n.addEventListener(Kn,r)}}),i),Yf.doOperation(e)}))}}function op(e){switch(e){case"meter":case"meters":case"m":default:return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001}}function sp(e,t){if(e.metadata){var i=e.metadata["world bounding box"],n=new rl(i.minXYZ[0],i.minXYZ[1],i.minXYZ[2]),r=new rl(i.maxXYZ[0],i.maxXYZ[1],i.maxXYZ[2]);e.bbox=new yc(n,r),e.modelSpaceBBox=e.bbox.clone();var o=function(e,t){var i=e.metadata["custom values"];if(e.placementTransform=t.placementTransform,t.applyScaling){var n="m";e.metadata["distance unit"]&&(n=e.metadata["distance unit"].value),e.scalingUnit=n,"object"==typeof t.applyScaling?(t.applyScaling.from&&(n=t.applyScaling.from),t.applyScaling.to&&(e.scalingUnit=t.applyScaling.to)):e.scalingUnit=t.applyScaling;var r=op(n)/op(e.scalingUnit);if(1!=r){var o=new al(!0),s=new al(!0);s.elements[0]=r,s.elements[5]=r,s.elements[10]=r,t.placementTransform&&o.copy(t.placementTransform),t.applyPlacementInModelUnits?t.placementTransform=s.multiply(o):t.placementTransform=o.multiply(s),e.placementTransform=t.placementTransform,e.scalingFactor=r}}if(i&&i.refPointTransform){e.refPointTransform=new al(!0);var a=e.refPointTransform.elements,l=i.refPointTransform;a[0]=l[0],a[1]=l[1],a[2]=l[2],a[4]=l[3],a[5]=l[4],a[6]=l[5],a[8]=l[6],a[9]=l[7],a[10]=l[8],a[12]=l[9],a[13]=l[10],a[14]=l[11]}else{var c=e.metadata.georeference,u=c&&c.refPointLMV,h=0;if(i&&Object.prototype.hasOwnProperty.call(i,"angleToTrueNorth")&&(h=Math.PI/180*i.angleToTrueNorth),u||h){var d=new al(!0),f=d.elements;f[0]=f[5]=Math.cos(h),f[1]=-Math.sin(h),f[4]=Math.sin(h);var p=new al(!0);f=p.elements,u&&(f[12]=-u[0],f[13]=-u[1],f[14]=-u[2]),e.refPointTransform=d.multiply(p)}}if(t.applyRefPoint&&e.refPointTransform){var m=new al(!0);t.placementTransform&&m.copy(t.placementTransform),m.multiply(e.refPointTransform),e.placementTransform=t.placementTransform=m}else!t.applyRefPoint&&t.placementTransform&&(e.placementTransform=new al(!0).copy(t.placementTransform));return e.placementTransform&&function(e){for(var t=e.elements,i=0;i<4;i++)for(var n=0;n<4;n++)if(i===n){if(1!==t[4*i+n])return!1}else if(0!==t[4*i+n])return!1;return!0}(e.placementTransform)&&(e.placementTransform=null),e.placementTransform}(e,t);o&&!e.bbox.isEmpty()&&e.bbox.applyMatrix4(o),t.globalOffset?e.globalOffset=t.globalOffset:e.globalOffset=e.bbox.getCenter(new rl),function(e,t){var i=e.globalOffset;if(i.x||i.y||i.z){if(t){var n=new al(!0);n.copy(t),(t=n).elements[12]-=i.x,t.elements[13]-=i.y,t.elements[14]-=i.z}else(t=new al(!0)).makeTranslation(-i.x,-i.y,-i.z);e.placementWithOffset=t}else e.placementWithOffset=t}(e,o),e.bbox.isEmpty()||(e.bbox.min.sub(e.globalOffset),e.bbox.max.sub(e.globalOffset)),Object.prototype.hasOwnProperty.call(e.metadata,"double sided geometry")&&e.metadata["double sided geometry"].value&&(e.doubleSided=!0)}}function ap(e,t){e[0]-=t.x,e[1]-=t.y,e[2]-=t.z}function lp(e,t){if(t&&(t.transformPoint(e.position),t.transformPoint(e.target),t.transformDirection(e.up),isFinite(e.orthoScale))){const i=t.getMaxScaleOnAxis();e.orthoScale*=i}}function cp(e,t){let i,n,r,o,s,a,l=0;let c,u,h=new Array,d=0,f=new Uint8Array(4),p=0,m=0;this.onData=function(g){for(g&&(c?h.push(g):(c=g,d=0));c;){let g=Math.min(f.length-p,c.length-d);if(g>0&&(f.set(c.subarray(d,d+g),p),d+=g,p+=g),l)if(u>0)p===f.length&&(u=0,r=new Uint8Array(1024*i),o=new Float32Array(r.buffer),s=new Uint32Array(r.buffer),a=new Uint16Array(r.buffer),f=r,p=0);else{for(;m+i<=p;){if(!e(this,m,l))return;m+=i,l++}p===f.length&&(m=0,p=0)}else p===f.length&&(i=f[1]<<8|f[0],i||(i=t||0),i||rt.error("Unknown byte stride."),i%4&&rt.error("Expected byte size to be multiple of 4, but got "+i),n=f[3]<<8|f[2],u=i-4,f=new Uint8Array(u),p=0,l++);d===c.length&&(c=h.shift(),d=0)}},this.flush=function(){this.onData(null),g(),p%i>0&&rt.warn("unexpected extra bytes at end of stream")},this.idata=function(){return s},this.i16data=function(){return a},this.fdata=function(){return o},this.bdata=function(){return r},this.version=function(){return n},this.byteStride=function(){return i};let g=()=>null;this.done=new Promise((e=>g=e))}var up,hp,dp,fp=new ArrayBuffer(8),pp=new Uint8Array(fp),mp=new Uint16Array(fp),gp=new Int32Array(fp),vp=new Uint32Array(fp),yp=new Float32Array(fp),bp=new Float64Array(fp);function xp(e){this.buffer=e,this.offset=0,this.byteLength=e.length}function _p(e){var t=this.stream=new xp(e),i=t.getInt32();this.type=t.getString(i),this.version=t.getInt32(),this.types=null,this.entryOffsets=[];var n=t.offset;t.seek(t.byteLength-8);var r=t.getUint32();this.typesOffset=t.getUint32(),t.seek(this.typesOffset);var o=this.readU32V();this.types=[];for(var s=0;s<o;++s)this.types.push({entryClass:this.readString(),entryType:this.readString(),version:this.readU32V()});t.seek(r);var a=this.readU32V(),l=this.entryOffsets;for(let e=0;e<a;++e)l.push(t.getUint32());t.seek(n)}xp.prototype.seek=function(e){this.offset=e},xp.prototype.getBytes=function(e){var t=new Uint8Array(this.buffer.buffer,this.offset,e);return this.offset+=e,t},xp.prototype.getVarints=function(){var e,t=0,i=0;do{t|=(127&(e=this.buffer[this.offset++]))<<i,i+=7}while(128&e);return t},xp.prototype.getUint8=function(){return this.buffer[this.offset++]},xp.prototype.getUint16=function(){return pp[0]=this.buffer[this.offset++],pp[1]=this.buffer[this.offset++],mp[0]},xp.prototype.getInt16=function(){var e=this.getUint16();return e>32767&&(e|=4294901760),e},xp.prototype.getInt32=function(){var e=this.buffer,t=pp,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,gp[0]},xp.prototype.getUint32=function(){var e=this.buffer,t=pp,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,vp[0]},xp.prototype.getFloat32=function(){var e=this.buffer,t=pp,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,yp[0]},xp.prototype.getIndicesArray=function(e,t,i){for(var n=this.buffer,r=new Uint8Array(e,t,2*i),o=this.offset,s=0,a=2*i;s<a;s+=2)r[s]=n[o],r[s+1]=n[o+1],o+=4;this.offset=o},xp.prototype.getVector3Array=function(e,t,i,n){var r=this.buffer,o=this.offset,s=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(3===n&&0===i){var a=12*t;s.set(r.subarray(o,o+a)),this.offset+=a}else{n*=4;for(var l=4*i,c=0;c<t;c++){for(var u=0;u<12;u++)s[l+u]=r[o++];l+=n}this.offset=o}},xp.prototype.getVector2Array=function(e,t,i,n){var r=this.buffer,o=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s=this.offset;n*=4;for(var a=4*i,l=0;l<t;l++){for(var c=0;c<8;c++)o[a+c]=r[s++];a+=n}this.offset=s},xp.prototype.getVector4=function(e,t){for(var i=this.buffer,n=pp,r=this.offset,o=yp,s=0;s<4;s++)n[0]=i[r],n[1]=i[r+1],n[2]=i[r+2],n[3]=i[r+3],e[t+s]=o[0],r+=4;this.offset=r},xp.prototype.getFloat64=function(){for(var e=this.buffer,t=pp,i=this.offset,n=0;n<8;n++)t[n]=e[i+n];return this.offset+=8,bp[0]},xp.prototype.getString=function(e){var t=ft(this.buffer,this.offset,e);return this.offset+=e,t},xp.prototype.reset=function(e){this.buffer=e,this.offset=0,this.byteLength=e.length},_p.prototype.readVarint=function(){var e,t=0,i=0;do{t|=(127&(e=this.stream.getUint8()))<<i,i+=7}while(128&e);return t},_p.prototype.readU32V=_p.prototype.readVarint,_p.prototype.readU16=function(){return this.stream.getUint16()},_p.prototype.readU8=function(){return this.stream.getUint8()},_p.prototype.readString=function(){return this.stream.getString(this.readU32V())},_p.prototype.readVector3f=function(){var e=this.stream;return{x:e.getFloat32(),y:e.getFloat32(),z:e.getFloat32()}},_p.prototype.readF32=function(){return this.stream.getFloat32()},_p.prototype.readF64=function(){return this.stream.getFloat64()},_p.prototype.readVector3d=(up={x:0,y:0,z:0},function(){var e=this.stream;return up.x=e.getFloat64(),up.y=e.getFloat64(),up.z=e.getFloat64(),up}),_p.prototype.readQuaternionf=(hp={x:0,y:0,z:0,w:0},function(){var e=this.stream;return hp.x=e.getFloat32(),hp.y=e.getFloat32(),hp.z=e.getFloat32(),hp.w=e.getFloat32(),hp}),_p.prototype.readMatrix3f=(dp=new al,function(e){e||(e=dp);var t=this.stream;e.identity();for(var i=0;i<3;++i)for(var n=0;n<3;++n)e.elements[4*i+n]=t.getFloat32();return e}),_p.prototype.readTransform=function(){var e={x:1,y:1,z:1},t=new al(!0);return function(i,n,r,o,s,a){var l,c,u=this.stream;switch(u.getUint8()){case 4:t.identity();break;case 0:l=this.readVector3d(),t.makeTranslation(l.x,l.y,l.z);break;case 1:c=this.readQuaternionf(),l=this.readVector3d(),e.x=1,e.y=1,e.z=1,t.compose(l,c,e);break;case 2:var h=u.getFloat32();c=this.readQuaternionf(),l=this.readVector3d(),e.x=h,e.y=h,e.z=h,t.compose(l,c,e);break;case 3:this.readMatrix3f(t),l=this.readVector3d(),t.setPosition(l)}if(a&&(a[0]=t.elements[12],a[1]=t.elements[13],a[2]=t.elements[14]),o&&t.multiplyMatrices(o,t),s&&(t.elements[12]-=s.x,t.elements[13]-=s.y,t.elements[14]-=s.z),void 0===i)return(new al).copy(t);var d=t.elements;n&&(n[r+0]=d[0],n[r+1]=d[1],n[r+2]=d[2],n[r+3]=d[4],n[r+4]=d[5],n[r+5]=d[6],n[r+6]=d[8],n[r+7]=d[9],n[r+8]=d[10],n[r+9]=d[12],n[r+10]=d[13],n[r+11]=d[14])}}(),_p.prototype.getEntryCounts=function(){return this.entryOffsets.length},_p.prototype.seekToEntry=function(e){if(e>=this.getEntryCounts())return null;this.stream.seek(this.entryOffsets[e]);var t=this.stream.getUint32();return t>=this.types.length?null:this.types[t]},_p.prototype.readPathID=function(){let e,t=this.stream;if(this.version<2){let i=t.getUint16();if(!i)return null;if(t.getUint16(),1==i)return"";e=t.getUint16();for(let n=2;n<i;++n)e+="/"+t.getUint16()}else{let t=this.readU32V();if(!t)return null;if(this.readU32V(),1==t)return"";e=this.readU32V();for(let i=2;i<t;++i)e+="/"+this.readU32V()}return e};const Ep=1,Sp=2,Ap=4,wp=8,Cp=16,Tp=32;function Mp(e,t,i){if(!e.seekToEntry(i))return null;const n={},r=e.readVarint();if(r&Ep){n.cameraEntry=e.readVarint();const i={definition:n.cameraEntry};n.camera=function(e,t){var i=t.definition,n=e.seekToEntry(i);if(!n)return null;if(n.version>2)return null;var r=e.stream,o={isPerspective:!r.getUint8(),position:e.readVector3f(),target:e.readVector3f(),up:e.readVector3f(),aspect:r.getFloat32(),fov:r.getFloat32()*(180/Math.PI)};return n.version<2&&(r.getFloat32(),r.getFloat32()),o.orthoScale=r.getFloat32(),o}(t,i)}if(r&Sp&&(n.cameraTransform=e.readTransform(),n.camera&&n.cameraTransform&&lp(n.camera,n.cameraTransform)),r&Ap&&(n.renderMode=e.readU8()),r&wp&&(n.primitiveDisplayFlags=e.readU8()),r&Tp&&(n.overrideSet=e.readVarint()),r&Cp)if(n.clipPlaneMode=e.readU8(),0===n.clipPlaneMode){n.sectionCount=e.readU8(),n.clipData={},n.sectionPlane=[];for(let t=0;t<n.sectionCount;t++){const t=Object.assign({},e.readVector3f()),i=e.readF64();n.sectionPlane.push(-t.x,-t.y,-t.z,i)}}else{n.clipData={};const t=Object.assign({},e.readVector3d()),i=Object.assign({},e.readVector3d()),r=Object.assign({},e.readQuaternionf());n.sectionBox={min:t,max:i},n.sectionBoxTransform=r,n.isFromViewpoint=!0}return n}const Ip=1,Pp=2,Lp=4,Rp=8;function Dp(e,t){const i=e.readVarint();let n=0;for(let r=0;r<i;++r){n+=e.readVarint(),t(n)}}function Op(e,t){if(!e.seekToEntry(t))return null;const i={},n=e.stream.getUint32();if(n&Ip&&(i.defaultMaterialIndex=e.readVarint(),i.defaultMaterialFlags=e.readU8()),n&Pp&&(i.defaultFlags=e.readVarint()),n&Lp){i.materialOverrides=[];const t=e.readVarint();for(let n=0;n<t;++n){let t=e.readVarint();Dp(e,(function(e){i.materialOverrides.push({dbId:e,materialIndex:t})}))}}if(n&Rp){i.flagOverrides=[];const t=e.readVarint();for(let n=0;n<t;++n){let t=e.readVarint();Dp(e,(function(e){i.flagOverrides.push({dbId:e,flags:t})}))}}return i}const Bp={NI_Inner:0,NI_Leaf:1};function Np(e){const t=e.readString();let i=function(e){let t="";for(let i=0;i<16;i++)t+=e.readU8();return t}(e);const n=e.readU8();if(n===Bp.NI_Leaf){return{name:t,entry:e.readVarint(),uuid:i}}if(n===Bp.NI_Inner){const i=e.readVarint(),n=[];for(let t=0;t<i;t++){const t=Np(e);n.push(t)}return{name:t,children:n}}return{}}function Up(e){return e.seekToEntry&&e.seekToEntry(0),Np(e)}const kp="urn:adsk.fluent:",Fp="$otg_cdn$";function Vp(){this.materials=null,this.fragments=null,this.geompacks=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[],dbid:[]},this.bbox=null,this.animations=null,this.globalOffset={x:0,y:0,z:0},this.pendingRequests=0,this.initialLoadProgress=0,this.viewpointProgress=0,this.abortController=new AbortController,this.viewpoints=[],this.overrideSets=[],this.extraMatHashes={},this.geometryInstanceCounts=null,this.extraFragInfo=null}Vp.prototype.getMaterialHash=function(e){var t;if(null===(t=this.materialHashes)||void 0===t||!t.hashes)return null;var i=this.materialHashes.hashes[e];return null!=i&&i.length?i:null},Vp.prototype.getExtraMaterialHashes=async function(){var e;let t=new Set;null===(e=this.overrideSets)||void 0===e||e.forEach((e=>{const{defaultMaterialIndex:i,materialOverrides:n}=e;i&&t.add(i),null==n||n.forEach((e=>{t.add(e.materialIndex)}))})),await this.materialHashes.initialized,t.size>0&&(this.needExtraMaterials=!0);for(const e of t){const t=this.getMaterialHash(e);t&&(this.extraMatHashes[e]=t)}},Vp.prototype.getGeometryHash=function(e){var t;if(null===(t=this.geomMetadata)||void 0===t||!t.hashes)return null;var i=this.geomMetadata.hashes[e];return null!=i&&i.length?i:null},Vp.prototype.getFragInstanceCount=function(e){if(!this.geometryInstanceCounts){this.geometryInstanceCounts=cl(this.fragments.geomDataIndexes.length,this.metadata.stats.num_geoms);for(let e=0;e<this.fragments.geomDataIndexes.length;e++)this.geometryInstanceCounts[this.fragments.geomDataIndexes[e]]+=1}return this.geometryInstanceCounts[this.fragments.geomDataIndexes[e]]},Vp.prototype.initEmptyLists=function(e){var t=this,i=t.fragments={};i.length=t.metadata.stats.num_fragments,i.numLoaded=0,i.boxes=e.fragmentTransformsDouble?new Float64Array(6*i.length):new Float32Array(6*i.length),i.transforms=e.fragmentTransformsDouble?new Float64Array(12*i.length):new Float32Array(12*i.length),i.materials=cl(i.length,t.metadata.stats.num_materials),i.geomDataIndexes=cl(i.length,t.metadata.stats.num_geoms),i.fragId2dbId=new Int32Array(i.length),i.visibilityFlags=new Uint16Array(i.length),i.visibilityFlags.fill(ll.MESH_VISIBLE),i.topoIndexes=null,e.buildDbId2FragIdMap&&(i.dbId2fragId={}),t.geomMetadata={hashes:null,byteStride:0,version:0,numLoaded:0,hashToIndex:new Map},this._materialHashesInitializedResolve=null,t.materialHashes={hashes:null,byteStride:0,version:0,numLoaded:0,initialized:new Promise((e=>this._materialHashesInitializedResolve=e))},t.materials={name:"LMVTK Simple Materials",version:"1.0",scene:{SceneUnit:8215,YIsUp:0},materials:{}}},Vp.prototype.loadAsyncResource=function(e,t,i,n){var r=this;this.pendingRequests++,t=ni(t,e.basePath),ei.getItem(e,t,(function(e){r.pendingRequests--,n(e)}),e.onFailureCallback,{responseType:i||"arraybuffer"})},Vp.prototype.loadAsyncProgressive=function(e,t,i,n,r){var o=this;t=ni(t,e.basePath),ei.getItem(e,t,(function(){o.postLoad(e,n)}),r||e.onFailureCallback,{responseType:"arraybuffer",ondata:function(e){i.onData(e)},abortSignal:o.abortController.signal,useFetch:!0})},Vp.prototype.loadMetadata=function(e,t){var i=this;return new Promise((n=>{this.loadAsyncResource(e,t,"json",(function(r){i.metadata=r,i.manifest=i.metadata.manifest,i.numGeoms=i.metadata.stats.num_geoms,i.processViewPointData(e),i.processMetadata(e),i.initEmptyLists(e);var o=i.metadata.manifest,s=o.shared_assets.pdb;for(let e in s)i.propertydb[e]&&i.propertydb[e].push({path:s[e],isShared:!0});var a=o.assets.pdb;for(let e in a)i.propertydb[e]&&i.propertydb[e].push({path:a[e],isShared:!1});o.assets.animations&&i.loadAsyncResource(e,o.assets.animations,"json",(function(e){i.animations=e,function(e){if(e.animations){var t=e.animations.animations;if(t)for(var i=e.globalOffset,n=(new al).makeTranslation(i.x,i.y,i.z),r=(new al).makeTranslation(-i.x,-i.y,-i.z),o=new al,s=new al,a=0;a<t.length;a++){var l=t[a];if(l.hierarchy)for(var c=0;c<l.hierarchy.length;c++){var u=l.hierarchy[c].keys;if(u)for(var h=0;h<u.length;h++){var d=u[h].pos;if(d){var f=i,p=u[h].rot;p&&(o.makeRotationFromQuaternion({x:p[0],y:p[1],z:p[2],w:p[3]}),s.multiplyMatrices(n,o).multiply(r),f={x:s.elements[12],y:s.elements[13],z:s.elements[14]}),ap(d,f)}var m=u[h].target;m&&ap(m,i);var g=u[h].points;if(g)for(var v=0;v<g.length;v++)ap(g[v],i)}}}}}(i)})),o.assets.topology&&i.loadAsyncResource(e,t,"json",(function(e){i.topology=e})),e.onLoaderEvent("otg_root"),i.postLoad(e,"metadata"),n()}))}))},Vp.prototype.addDbIdReference=function(e,t){const i=this.fragments;let n=i.dbId2fragId[t];void 0===n?i.dbId2fragId[t]=e:"number"==typeof n?i.dbId2fragId[t]=[n,e]:n.push(e)},Vp.prototype.loadFragmentList=function(e,t){var i=this,n=new rl,r=new rl,o={x:0,y:0,z:0,w:1},s=new al(!0),a={x:0,y:0,z:0};let l=new cp((function(t,l,c){if(c-=1,!i.metadata)return!1;var u=t.idata(),h=t.fdata();l/=4;var d=i.fragments,f=d.geomDataIndexes[c]=u[l],p=d.materials[c]=u[l+1],m=d.fragId2dbId[c]=u[l+2],g=u[l+3];if(e.buildDbId2FragIdMap&&i.addDbIdReference(c,m),f>i.geomMetadata.numLoaded||p>i.materialHashes.numLoaded)return!1;1&g&&(d.visibilityFlags[c]|=ll.MESH_NOT_FOR_DISPLAY,d.visibilityFlags[c]&=~ll.MESH_VISIBLE);var v=i.metadata.fragmentTransformsOffset||a,y=l+4;n.set(h[y+0]+v.x,h[y+1]+v.y,h[y+2]+v.z),o.x=h[y+3],o.y=h[y+4],o.z=h[y+5],o.w=h[y+6],r.set(h[y+7],h[y+8],h[y+9]),s.compose(n,o,r),i.placementWithOffset&&s.multiplyMatrices(i.placementWithOffset,s);var b=s.elements,x=d.transforms,_=12*c;if(x[_+0]=b[0],x[_+1]=b[1],x[_+2]=b[2],x[_+3]=b[4],x[_+4]=b[5],x[_+5]=b[6],x[_+6]=b[8],x[_+7]=b[9],x[_+8]=b[10],x[_+9]=b[12],x[_+10]=b[13],x[_+11]=b[14],!d.dontComputeBoxes){let e=d.boxes,t=6*c;for(let i=0;i<3;i++){let n=Math.abs(b[i]);n+=Math.abs(b[i+4]),n+=Math.abs(b[i+8]),n*=.5;let r=b[12+i];e[t+i]=r-n,e[t+i+3]=r+n}}return d.numLoaded=c+1,e.onLoaderEvent("fragment",c),!0}));return this.loadAsyncProgressive(e,t,l,"all_fragments"),l},Vp.prototype.handleHashListRequestFailures=function(e){this.metadata&&(this.geomHashListFailure&&this.metadata.stats.num_geoms>0&&e.onFailureCallback.apply(e,this.geomHashListFailure),this.matHashListFailure&&this.metadata.stats.num_materials>0&&e.onFailureCallback.apply(e,this.matHashListFailure),this.geomHashListFailure=null,this.matHashListFailure=null)},Vp.prototype.loadGeometryHashList=function(e,t){var i=this;let n=new cp((function(e,t,n){return!!i.metadata&&(i.initializeGeometryHashList(e.byteStride(),e.version()),i.geomMetadata.hashes[n]=je(e.i16data(),t/2),i.geomMetadata.numLoaded=n,!0)}),20);return this.loadAsyncProgressive(e,t,n,"geometry_ptrs",(function(){i.geomHashListFailure=arguments,i.handleHashListRequestFailures(e),i.postLoad(e,"geometry_ptrs",n)})),n},Vp.prototype.initializeGeometryHashList=function(e,t){this.geomMetadata.hashes||(this.geomMetadata.hashes=new Array(this.numGeoms+1),this.geomMetadata.byteStride=e,this.geomMetadata.version=t)},Vp.prototype.loadMaterialHashList=function(e,t){var i=this;let n=new cp((function(e,t,n){return!!i.metadata&&(i.initializeMaterialHashList(e.byteStride(),e.version()),i.materialHashes.hashes[n]=je(e.i16data(),t/2),i.materialHashes.numLoaded=n,!0)}),20);return this.loadAsyncProgressive(e,t,n,"material_ptrs",(function(){i.matHashListFailure=arguments,i.handleHashListRequestFailures(e),i.postLoad(e,"material_ptrs",n)})),n},Vp.prototype.initializeMaterialHashList=function(e,t){this.materialHashes.hashes||(this.numMaterials=this.metadata.stats.num_materials,this.materialHashes.hashes=new Array(this.numMaterials+1),this.materialHashes.byteStride=e,this.materialHashes.version=t,this._materialHashesInitializedResolve())},Vp.prototype.processMetadata=function(e){var t=this,i=t.metadata;sp(t,e);var n=t.placementWithOffset;if(i.cameras){t.cameras=i.cameras;for(var r=0;r<t.cameras.length;r++){var o=t.cameras[r];o.position=new rl(o.position.x,o.position.y,o.position.z),o.target=new rl(o.target.x,o.target.y,o.target.z),o.up=new rl(o.up.x,o.up.y,o.up.z),n&&lp(o,n)}}},Vp.prototype.initializeDbIdFilter=function(e){if(e){this.dbIdFilter={};for(let t=0,i=e.length;t<i;t++)this.dbIdFilter[e[t]]=1}},Vp.prototype.loadData=function(e){this.materialsCtx=this.loadMaterialHashList(e,"materials_ptrs.hl"),this.geometryCtx=this.loadGeometryHashList(e,"geometry_ptrs.hl"),this.fragmentsCtx=this.loadFragmentList(e,"fragments.fl")},Vp.prototype.makeSharedResourcePath=function(e,t,i){if(10===i.length&&(i=qe(i)),e){let o=this.manifest.shared_assets.global_sharding||0,s=i,a="";o&&(a="/"+i.slice(0,o),s=i.slice(o));var n=this.manifest.shared_assets[t];if(0===n.indexOf(kp)||0===n.indexOf(Fp))n=n.slice(n.indexOf("/"));else{var r=n.split("/");n="/"+(r[r.length-1]||r[r.length-2])+"/"}return e+a+n+s}{let e=this.manifest.shared_assets.global_sharding||2,n=i,r="";return e&&(r="/"+i.slice(0,e)+"/",n=i.slice(e)),ni(this.basePath)+this.manifest.shared_assets[t]+r+n}},Vp.prototype.postLoad=function(e,t){t&&this.initialLoadProgress++,4===this.initialLoadProgress?(this.materialsCtx&&(this.materialsCtx.flush(),this.geometryCtx.flush(),this.fragmentsCtx.flush(),this.materialsCtx=null,this.geometryCtx=null,this.fragmentsCtx=null),this.fragments.numLoaded<this.metadata.stats.num_fragments&&rt.warn("Fragments actually loaded fewer than expected."),e.onLoaderEvent("all_fragments")):"metadata"===t&&this.materialsCtx&&(this.materialsCtx.onData(null),this.geometryCtx.onData(null),this.fragmentsCtx.onData(null))},Vp.prototype.processViewPointData=function(e){var t=this;const i=t.manifest.assets.viewpoints;i?("camera_definitions"in i&&t.loadCameraDefinition(e,i.camera_definitions),"override_sets"in i&&t.loadOverrideSets(e,i.override_sets),"viewpoint_tree"in i&&t.loadViewpointTree(e,i.viewpoint_tree),"viewpoints"in i&&t.loadViewpoints(e,i.viewpoints)):e.onOperationComplete()},Vp.prototype.postLoadViewpointData=async function(e){this.viewpointProgress++,4===this.viewpointProgress&&(this.materialsCtx&&await this.materialsCtx.done,this.processViewpoints(),await this.getExtraMaterialHashes(),e.onLoaderEvent("viewpointData"))},Vp.prototype.loadCameraDefinition=function(e,t){let i=this;i.loadAsyncResource(e,t,null,(function(t){i.cameraDef=new _p(t),i.postLoadViewpointData(e)}))},Vp.prototype.loadOverrideSets=function(e,t){let i=this;i.loadAsyncResource(e,t,null,(function(t){if(i.overrideSetsPack=new _p(t),i.overrideSetsPack){for(let e=0,t=i.overrideSetsPack.getEntryCounts();e<t;e++){const t=Op(i.overrideSetsPack,e);t&&i.overrideSets.push(t)}i.overrideSetsPack=null,i.postLoadViewpointData(e)}}))},Vp.prototype.loadViewpointTree=function(e,t){let i=this;i.loadAsyncResource(e,t,null,(function(t){if(i.viewpointTreePack=new _p(t),i.viewpointTreePack){const t=Up(i.viewpointTreePack);i.viewpointTreeRoot=t,function(){const e=i.viewpointTreeRoot;if(e&&(e.name=e.name||"Saved Viewpoints"),null==e||!e.children)return;let t=0;function n(e){if(e.children){for(let t=0;t<e.children.length;t++)n(e.children[t]);e.type="folder",e.role="viewable",e.guid=t+++""}else isNaN(e.entry)||(e.order=t,e.type="view",e.role="3d",e.guid=t+++"",e.isViewpoint=!0)}for(let t=0;t<e.children.length;t++)n(e.children[t])}(),i.viewpointTreePack=null,i.postLoadViewpointData(e)}}))},Vp.prototype.loadViewpoints=function(e,t){let i=this;i.loadAsyncResource(e,t,null,(function(t){i.viewpointsDefPack=new _p(t),i.postLoadViewpointData(e)}))},Vp.prototype.processViewpoints=function(){if(this.viewpointsDefPack&&this.cameraDef){for(let e=0,t=this.viewpointsDefPack.getEntryCounts();e<t;e++){const t=Mp(this.viewpointsDefPack,this.cameraDef,e);t&&this.viewpoints.push(t)}this.viewpointsDefPack=null,this.cameraDef=null}},Vp.prototype.abort=function(){this.abortController.abort()};let Gp={ROOT_LOADED:0,LOADING:1,RENDERING:2,OPTIMIZING:3};const zp=[new(v().Vector3)(1,0,0),new(v().Vector3)(0,1,0),new(v().Vector3)(0,0,1),new(v().Vector3)(-1,0,0),new(v().Vector3)(0,-1,0),new(v().Vector3)(0,0,-1)];let Hp=new(v().Plane);new(v().Vector3);function Wp(e,t,i,n){var r=e;r.z=-1;var o=new(v().Vector3)(r.x,r.y,1);r=r.unproject(t),(o=o.unproject(t)).sub(r).normalize();var s,a=o;if(Math.abs(a[i])<1e-6)return null;s=t.isPerspective?t.position:r;var l=((n?n.min[i]:0)-s[i])/a[i];return a.multiplyScalar(l),a.add(s),a}function jp(e,t,i){var n=e.clone();return n.max(t),n.min(i),n.distanceToSquared(e)}function qp(e,t){return jp(e,t.min,t.max)}let Kp={box2CutPlanes:function(e,t){let i=[];for(let n=0;n<zp.length;n++){Hp.normal.copy(zp[n]);const r=n<3?e.max:e.min;Hp.constant=-Hp.normal.dot(r),t&&Hp.applyMatrix4(t),i.push(new(v().Vector4)(Hp.normal.x,Hp.normal.y,Hp.normal.z,Hp.constant))}return i},getPixelsPerUnit:function(e,t,i,n,r,o){if(!e.isPerspective)return n/e.orthoScale;let s,a=i.getCenter(new(v().Vector3));if(t)if(o)s=Math.sqrt(qp(e.position,o));else{const t="z",i=Wp(new(v().Vector3)(0,0,1),e,t);i&&(a=i),s=e.position.distanceTo(a)}else{if(r){const t=r,n=e.target.clone().sub(e.position).normalize(),o=n.dot(t);if(0!==o){const r=-(e.position.clone().dot(t)+t.w)/o;a=i.clampPoint(n.multiplyScalar(r).add(e.position),a)}}s=e.position.distanceTo(a)}return n/(2*s*Math.tan(v().Math.degToRad(.5*e.fov)))},intersectGroundViewport:Wp,getNormalizingMatrix:function(e,t){t=t||e.getData().bbox;var i=new(v().Matrix4);i.makeTranslation(-t.min.x,-t.min.y,-t.min.z);var n=new(v().Vector3)(0,0,0).subVectors(t.max,t.min),r=new(v().Matrix4);r.makeScale(1/n.x,1/n.y,1);var o=new(v().Matrix4);return o.multiplyMatrices(r,i),o},pointToMinMaxBoxDistance2:jp,pointToBoxDistance2:qp};function Xp(e,t,i){return Math.abs(e.x-t.x)<i&&Math.abs(e.y-t.y)<i&&Math.abs(e.z-t.z)<i}function Yp(e,t){return t.importance-e.importance}var Qp=new yc;function Zp(e,t,i){var n=function(e,t,i){var n=6*t;return i.min.y=e[n+1],i.min.z=e[n+2],i.min.x=e[n+0],i.max.x=e[n+3],i.max.y=e[n+4],i.max.z=e[n+5],i}(t,e,Qp),r=i.intersectsBox(n);if(r===lc)return 0;var o=r===uc,s=i.projectedBoxArea(n,o),a=Kp.pointToBoxDistance2(i.eye,n);return s/(a=Math.max(a,.01))}class $p{constructor(){this.viewers=[],this.waitingTasks=[],this.waitingTasksHead=0,this.urgentHashes={},this.prevNumTasks=0,this.fullSortDone=!1,this.lastCamPos={},this.lastCamTarget={},this.lastVisibleModelIds={}}addViewer(e){this.viewers.push(e),this.lastCamPos[e.id]=new rl,this.lastCamTarget[e.id]=new rl,this.lastVisibleModelIds[e.id]=[]}removeViewer(e){const t=this.viewers.indexOf(e);-1!==t&&(delete this.lastCamPos[e.id],delete this.lastCamTarget[e.id],delete this.lastVisibleModelIds[e.id],this.viewers.splice(t,1))}checkCameraChanged(){for(var e=!1,t=0;t<this.viewers.length;t++){var i=this.viewers[t],n=i.impl.camera,r=n.position,o=n.target;Xp(this.lastCamPos[i.id],r,.01)&&Xp(this.lastCamTarget[i.id],o,.01)||(this.lastCamPos[i.id].copy(r),this.lastCamTarget[i.id].copy(o),e=!0)}return e}checkModelsChanged(){for(var e=!1,t=0;t<this.viewers.length;t++){var i=this.viewers[t],n=i.impl.modelQueue().getModels();n.length!==this.lastVisibleModelIds[i.id].length&&(this.lastVisibleModelIds[i.id].length=n.length,e=!0);for(var r=0;r<n.length;r++){var o=this.lastVisibleModelIds[i.id][r],s=n[r].id;o!==s&&(this.lastVisibleModelIds[i.id][r]=s,e=!0)}}return e}validateRequestPriorities(){var e=this.checkCameraChanged(),t=this.checkModelsChanged();if(e||t)for(var i=this.waitingTasksHead;i<this.waitingTasks.length;i++)this.waitingTasks[i].importanceNeedsUpdate=!0}updateRequestPriorities(){var e=performance.now();this.validateRequestPriorities();var t={},i=[];for(let e=0;e<this.viewers.length;e++){let o=this.viewers[e];var n=o.impl.modelQueue(),r=n.frustum();i=i.concat(n.getModels()),r.reset(o.impl.camera),t[o.id]=r}var o=!1,s=0===this.prevNumTasks||this.waitingTasks.length-this.prevNumTasks>3e3||!this.fullSortDone;this.fullSortDone=!s,this.prevNumTasks=this.waitingTasks.length;for(let n=this.waitingTasksHead;n<this.waitingTasks.length;n++){var a=this.waitingTasks[n];if(a.importanceNeedsUpdate)if(this.urgentHashes[a.hash])a.importance=1/0;else{if(n%10==0)if(performance.now()-e>10){o=!0;break}a.importanceNeedsUpdate=!1,a.importance=0;var l=0,c=a.hash;for(const e of i)if(e.isOTG()){var u=e.myData.geomMetadata.hashToIndex.get(c);if(u){var h=e.loader.pendingMeshes[u];if(h){var d=e.myData.fragments.boxes;for(const i of this.viewers)if(-1!==i.impl.modelQueue().getModels().indexOf(e))for(const e of h)l+=Zp(e,d,t[i.id])}}}if(a.importance=l,!s){for(var f=n;f>this.waitingTasksHead&&l>this.waitingTasks[f-1].importance;)this.waitingTasks[f]=this.waitingTasks[f-1],f--;this.waitingTasks[f]=a}}}return s&&!o&&(this._sortTasks(),this.fullSortDone=!0),!o}makeUrgent(e){var t=0;for(var i in e)!0!==e[i]&&"number"!=typeof e[i]||(this.urgentHashes[i]=!0,t++);if(0===t)return 0;for(var n=this.waitingTasksHead;n<this.waitingTasks.length;n++){var r=this.waitingTasks[n];this.urgentHashes[r.hash]&&("number"!=typeof e[r.hash]?r.importance=1/0:r.importance=1e5+e[r.hash])}return this._sortTasks(),t}_removeGarbage(){this.waitingTasks.splice(0,this.waitingTasksHead),this.waitingTasksHead=0}_sortTasks(){this._removeGarbage(),this.waitingTasks.sort(Yp)}removeUrgent(e){delete this.urgentHashes[e]}filterTasks(e){const t=[];for(let i=this.waitingTasksHead;i<this.waitingTasks.length;i++){const n=this.waitingTasks[i];e(n.hash)&&t.push(n)}this.waitingTasks=t,this.waitingTasksHead=0}addTask(e){this.waitingTasks.push(e)}takeTask(){return this.waitingTasksHead>1e4&&this._removeGarbage(),this.waitingTasks[this.waitingTasksHead++]}isEmpty(){return this.waitCount()<=0}waitCount(){return this.waitingTasks.length-this.waitingTasksHead}}const Jp="otg",em="otg-content",tm="otg-lru";class im{constructor(e){this.db=null,this.readTransaction=null,this.loaded=!1,this.opening=!1,this.dbDisabled=this._isDbDisabled(e),!S()&&this.dbDisabled&&console.log("IndexedDb disabled"),this.storeName=em,this.storeNameTimestamp=tm,this.bothStoreNames=[this.storeName,this.storeNameTimestamp],this.pendingTimestampUpdates={},this.pendingTimestampCount=0,this.pendingStores=[],this._pendingCallbacks=[]}_isDbDisabled(e){return e||S()||G()||F()||"undefined"==typeof indexedDB}notifyPendingCallbacks(e){this._pendingCallbacks.forEach((t=>t(e,this.db))),this._pendingCallbacks=[]}open(e){if(this.dbDisabled)return void(e&&e());if(this.loaded)return void(e&&e(null,this.db));if(e&&this._pendingCallbacks.push(e),this.opening)return;this.opening=!0;let t=indexedDB.open(Jp,1);t.onerror=e=>{console.error("Failed to open or create cache database."),this.dbDisabled=!0,this.notifyPendingCallbacks(e)},t.onsuccess=e=>{this.opening=!1,this.db=e.target.result,this.db.onerror=function(e){console.error("Database error",e)},this.loaded=!0,this.notifyPendingCallbacks()},t.onupgradeneeded=e=>{console.log("Db upgrade",this.storeName);let t=e.target.result;t.createObjectStore(em),t.createObjectStore(tm).createIndex(tm+"-index","t",{unique:!1})}}deleteOld(e){if(!this.db)return void e();if(this.deleteInProgress)return;this.deleteInProgress=!0;let t=IDBKeyRange.upperBound(Date.now()-3e5,!0),i=[];this.db.transaction([this.storeNameTimestamp]).objectStore(this.storeNameTimestamp).index(this.storeNameTimestamp+"-index").openCursor(t).onsuccess=t=>{let n=t.target.result;if(n&&i.length<200)return i.push(n.primaryKey),void n.continue();if(i.length){console.log("Deleting old objects.",i.length);let t=this.db.transaction(this.bothStoreNames,"readwrite");t.oncomplete=t=>{this.deleteInProgress=!1,console.log("Delete done"),e&&e()},t.onerror=e=>{this.deleteInProgress=!1,console.error("Transaction error.",e)},t.onabort=e=>{this.deleteInProgress=!1;let t=e.target.error;console.log("Failed to delete cached objects",t)};let n=t.objectStore(this.storeName),r=t.objectStore(this.storeNameTimestamp);for(let e=0;e<i.length;e++)n.delete(i[e]),r.delete(i[e])}}}flush(e){if(this.pendingStores.length){if(!this.writeTransaction){let t=this.db.transaction(this.bothStoreNames,"readwrite");e&&(t.oncomplete=t=>{e()}),t.onerror=t=>{console.error("Transaction error.",t),e&&e(t.target.error)},t.onabort=t=>{"QuotaExceededError"===t.target.error.name&&this.deleteOld((()=>{})),e&&e(t.target.error)},this.writeTransaction=t}for(var t=0;t<this.pendingStores.length;t+=2){var i=this.pendingStores[t],n=this.pendingStores[t+1];this.writeTransaction.objectStore(this.storeName).put(n,i).onerror=e=>{console.error("Object store error.",e)},this.writeTransaction.objectStore(this.storeNameTimestamp).put({t:Date.now()},i)}this.pendingStores=[],this.writeTransaction=null}else e&&e()}store(e,t,i){this.db?(t=t.slice(),this.pendingStores.push(e),this.pendingStores.push(t),this.pendingStores.length<200||this.deleteInProgress?i&&i():this.flush(i)):i&&i()}flushTimestamps(e){let t=this.db.transaction([this.storeNameTimestamp],"readwrite");e&&(t.oncomplete=t=>{e()}),t.onerror=t=>{console.error("Transaction error.",t),e&&e(t.target.error)},t.onabort=t=>{"QuotaExceededError"===t.target.error.name&&(console.log("Quota exceeded"),this.deleteOld((()=>{}))),e&&e(t.target.error)};let i=t.objectStore(this.storeNameTimestamp);for(let e in this.pendingTimestampUpdates)i.put({t:this.pendingTimestampUpdates[e]},e);this.pendingTimestampUpdates={},this.pendingTimestampCount=0}_createReadTransaction(){let e=this.readTransaction=this.db.transaction(this.storeName);e.oncomplete=e=>{this.readTransaction=null},e.onerror=e=>{console.error("Transaction error.",e),this.readTransaction=null},e.onabort=e=>{console.warn("Transaction abort",e),this.readTransaction=null}}get(e,t){if(this.opening)return console.error("Tried to get IndexedDb resource while database was still opening"),void t(-1,null);if(!this.db)return void t(-1,null);let i;this.readTransaction||this._createReadTransaction();try{i=this.readTransaction.objectStore(this.storeName).get(e)}catch(t){this._createReadTransaction(),i=this.readTransaction.objectStore(this.storeName).get(e)}i.onsuccess=i=>{if(!i.target.result)return void t(-1,null);let n=i.target.result;t(null,n),this.pendingTimestampUpdates[e]=Date.now(),this.pendingTimestampCount++},i.onerror=e=>{t(e.target.errorCode)}}flushStoresAndTimestamps(){this.db&&this.flush((e=>{e||this.flushTimestamps()}))}size(e){if(!this.db)return void e();let t=0,i=0,n=this.db.transaction([this.storeName]).objectStore(this.storeName).openCursor();n.onsuccess=n=>{let r=n.target.result;if(r){let e=r.value;t+=e.length,i++,r.continue()}else e(null,{size:t,items:i})},n.onerror=function(t){e(t)}}estimateCachedHashCount(e){if(this.opening)return console.error("Tried to get IndexedDb resource while database was still opening"),void e(void 0);if(!this.db)return void e(void 0);let t,i=this.db.transaction(this.storeNameTimestamp);try{t=i.objectStore(this.storeNameTimestamp).openKeyCursor()}catch(t){return void e(void 0)}let n=2;const r=1e3;t.onsuccess=t=>{const o=t.target.result;if(o)if(--n>0)o.advance(999);else{const t=o.key.charCodeAt(0);e(65536e3/t),i.abort()}else e(2==n?0:1==n?r:void 0)},t.onerror=t=>{e(void 0)}}readAllCachedHashes(e){if(this.opening)return console.error("Tried to get IndexedDb resource while database was still opening"),void e([]);if(!this.db)return void e([]);let t,i=this.db.transaction(this.storeNameTimestamp);try{t=i.objectStore(this.storeNameTimestamp).getAllKeys()}catch(t){return void e([])}t.onsuccess=t=>{e(t.target.result)},t.onerror=t=>{e([])}}}const nm=0,rm=1,om={ws:{min:2,max:16},size:{min:500,max:4096}};class sm{static FALLBACK_FLIGHT=3e3;static MIN_FLIGHT=1500;static MAX_FLIGHT=3e4;static THROTTLED_FLIGHT=100;#y;CWND_DEVIATION=30;BETA=.8;FAST_CONVERGENCE=.7;wMax=0;lastReductionTs=performance.now();SCALING=.25;cwnd=0;initialAssetEstimate;#b=0;#x=1e3;#_=new am(1e3);#E=new am(20);wasReset=!1;#S=om.ws.min;#A={count:0,totalBytes:0};constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>null;this.onFlightSizeUpdated=n,this.onConnectionCountUpdated=r,this.#b=e,this.#A.totalBytes=i,this.#A.count=Math.round(i/t),this.initialAssetEstimate=t,this.wMax=this.#A.totalBytes,this.cwnd=this.wMax*this.BETA,this.#w()}hasCongestionEvent(){if(this.#_.count<3)return!1;const e=this.#_.tail.data,t=this.#_.head.data;if(this.cwnd<e.receivedBytes)return!1;if(e.receivedBytes/(t.receivedBytes||1)<1)return!0;const i=this.deviation(this.cwnd,t.cwnd),n=this.deviation(e.receivedBytes,t.receivedBytes);return Math.abs(i-n)>this.CWND_DEVIATION}shouldTimeout(){if(this.#E.count<this.#E.MAX_SIZE/2)return!1;let e=this.#E.tail||this.#E.head,t=0;for(;e&&t++<this.#E.MAX_SIZE/2;){if(e.data.receivedCount>0)return!1;e=e.prev}return t>=this.#E.MAX_SIZE/2}getMode(){return this.cwnd>this.wMax?rm:nm}#w(){if(this.shouldTimeout())return this.onFlightSizeUpdated(sm.FALLBACK_FLIGHT),clearInterval(this.#y),void this.#C();const e=this.#T();let t=0,i=0,n=0;for(let{data:e}of this.#E){if(3==t++)break;i+=e.receivedBytes,n+=e.receivedCount}const r=Math.round(i/n||e.fragmentSize);let o;const s=e=>e/1e6,a=Math.cbrt(s(this.wMax)*(1-this.BETA)/this.SCALING),l=(performance.now()-this.lastReductionTs)/1e3;if(o=this.cwnd=1e6*(this.SCALING*Math.pow(l-a,3)+s(this.wMax)),this.hasCongestionEvent()){const e=this.getMode()===rm?this.BETA:this.FAST_CONVERGENCE;this.lastReductionTs=performance.now(),this.wMax=this.#_.tail.prev.data.receivedBytes,this.#_.clear(),o=e*this.wMax}let c=Math.round(o/r);this.#b=c=Math.min(sm.MAX_FLIGHT,Math.max(sm.MIN_FLIGHT,c)),rt.debug(`${this.#_.head?"Increase":"Congestion"}: CWND=${(o/1e6).toFixed(2)}Mb RX=${(e.receivedBytes/1e6).toFixed(2)}Mb FLIGHT=${c} ( Average Size: ${r} )`),this.onFlightSizeUpdated(c),this.updateConnectionCount()}updateConnectionCount(){const{ws:e,size:t}=om;let i=1;let n=0;for(let{data:e}of this.#E){if(++n>6)break;i=Math.max(e.fragmentSize,i,t.min)}if(i>t.max)return;const r=(t.max-t.min)/(e.max-e.min),o=Math.round((t.max-i)/r);let s=0;for(let{data:e}of this.#E)if(6==++s||e.fragmentSize>i)break;let a=e.min+Math.round(o*Math.pow(s/6,3));a>this.#S&&(this.#S=a,this.onConnectionCountUpdated(a),rt.debug(`Updating connection count: ${a}`))}#C(){let e=0,t=0;for(let{data:i}of this.#E)t++<this.#E.MAX_SIZE/2||(e+=i.cwnd);const i=e/this.#E.count;this.wMax=i*(1-this.BETA+1),this.cwnd=i,this.#_.clear(),this.#E.clear(),this.wasReset=!0}#T(){var e;const t={fragmentSize:this.#A.count&&this.#A.totalBytes?this.#A.totalBytes/this.#A.count:(null===(e=this.#_.tail||this.#_.head)||void 0===e?void 0:e.data.fragmentSize)||this.initialAssetEstimate,receivedCount:this.#A.count,receivedBytes:this.#A.totalBytes,cwnd:this.cwnd};return this.#_.onReceived(t),this.#E.onReceived(t),this.#A.count=0,this.#A.totalBytes=0,t}onResourceReceived(e,t){this.#A.totalBytes+=t,this.#A.count+=e,this.wasReset&&(this.wasReset=!1,this.lastReductionTs=performance.now(),this.#y=setInterval((()=>{this.#w()}),this.#x))}deviation(e,t){return Math.abs(e-t)/((e+t)/2)*100}static createAndStart(e,t,i,n,r){const o=new sm(e,t,i,n,r);return o.#y=setInterval((()=>{o.#w()}),o.#x),o}}class am{MAX_SIZE=2e3;#M=0;totalBytes=0;head;tail;get count(){return this.#M}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>this.count>this.MAX_SIZE;this.MAX_SIZE=e,this.trimEval=t}clear(){this.#M=0,this.totalBytes=0,this.head=null,this.tail=null}onReceived(e,t){this.addNode(new lm(e),t)}addNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(0===this.#M?this.head=e:1===this.#M?(this.tail=e,this.head.setNext(e)):(this.tail.setNext(e),this.tail=e),this.#M+=t;this.trimEval(this.head,this.tail);){var i;const e=this.head.next;this.head.unlink(),this.totalBytes-=this.head.size,this.#M-=(null===(i=this.head.data)||void 0===i?void 0:i.count)||1,this.head=e}this.totalBytes+=e.size}}am.prototype[Symbol.iterator]=function*(){let e=this.tail;for(;e;)yield e,e=e.prev};class lm{data;size=0;prev;next;timestamp;constructor(e){this.data=e,e.size&&(this.size=e.size),this.timestamp=Date.now()}setNext(e){return this.next=e,e&&(this.next.prev=this),this}setPrev(e){return this.prev=e,e&&(this.prev.next=this),this}unlink(){var e,t;null===(e=this.prev)||void 0===e||e.setNext(this.next),null===(t=this.next)||void 0===t||t.setPrev(this.prev),this.prev=null,this.next=null}}const cm="consolidationEnabled",um="consolidationDisabled";var hm=r(36119),dm=r.n(hm);class fm{outOfCoreTileManager;constructor(e){this.outOfCoreTileManager=e}execute(){return 0}freeMemory(){return 0}getMemoryCost(){return 0}getFreeableMemory(e){return 0}}class pm extends fm{#I;constructor(e,t,i){super(e),this.fragList=t,this.bvhNodeId=i}#P(){if(sn)return!0;const e=this.outOfCoreTileManager.model.getConsolidation();return Boolean(e)}getGeometries(){}execute(){if(!this.#P())return 0;let e=this.outOfCoreTileManager.getRenderer(),t=this.getGeometries(),i=0;for(let n of t){let t=km.geomRefCounts.get(n)??0;!0===n.streamingDraw&&(n.streamingDraw=!1,n.streamingIndex=!1,e.uploadGeometry(n),i+=n.getAccurateByteSize()),km.geomRefCounts.set(n,t+1)}return i}freeMemory(){if(!this.#P())return 0;let e=this.getGeometries(),t=0;for(let i of e){let e=(km.geomRefCounts.get(i)??0)-1;0===e?(km.geomRefCounts.delete(i),!0!==i.streamingDraw&&(i.dispose(),i.streamingDraw=!0,i.streamingIndex=!0,t+=i.getAccurateByteSize())):km.geomRefCounts.set(i,e)}return t}getMemoryCost(){if(void 0===this.#I){if(!this.#P())return 0;let e=this.getGeometries();this.#I=0;for(let t of e)this.#I+=t.getAccurateByteSize()}return this.#I}getFreeableMemory(e){if(!this.#P())return 0;let t=0,i=this.getGeometries();for(let n of i){e.freedRemainingGeometriesCounts=e.freedRemainingGeometriesCounts??new Map;let i=e.freedRemainingGeometriesCounts.get(n)??0;i++,e.freedRemainingGeometriesCounts.set(n,i),0===km.geomRefCounts.get(n)-i&&(t+=n.getAccurateByteSize())}return t}}class mm extends pm{constructor(e,t,i,n){super(e,t,i),this.remainingFragmentIndices=n}getGeometries(){const e=this.remainingFragmentIndices.length,t=new Array(e);for(let i=0;i<e;i++)t[i]=this.fragList.getGeometry(this.remainingFragmentIndices[i]);return t}}class gm extends pm{constructor(e,t,i,n){super(e,i,n);const r=this.outOfCoreTileManager.model.getConsolidation();r&&(this.geometries=[r.meshes[t].geometry])}getGeometries(){return this.geometries}addGeometry(e){const t=this.outOfCoreTileManager.model.getConsolidation();if(!t)return;const i=t.meshes[e].geometry;-1===this.geometries.indexOf(i)&&this.geometries.push(i)}}class vm{nodeId;iteratorStates=[];lockedCounter=0;transparent=!1;initialized=!1;remainingTasks=[];processedTasks=[];model;#L=0;constructor(e,t,i){this.nodeId=e,this.model=t,this.completelyLoaded=!1,this.outOfCoreTileManager=i,this.initialized=!1}getRemainingFragmentsTask(){return this.remainingTasks.find((e=>e instanceof mm))??this.processedTasks.find((e=>e instanceof mm))}getInstancedMeshUploadTask(){return this.remainingTasks.find((e=>e instanceof gm))??this.processedTasks.find((e=>e instanceof gm))}addTask(e){this.remainingTasks.push(e),e.isResourceIndependent&&(this.#L++,km.numResourceIndependentTasks++)}hasTask(e){return this.remainingTasks.some((t=>t.meshIndex===e))}hasInstanceTask(e){return this.remainingTasks.some((t=>t.geom===e))||this.processedTasks.some((t=>t.geom===e))}hasNextTask(){return this.remainingTasks.length>0}processNextTask(){const e=this.remainingTasks.shift(),t=e.execute();return e.isOneShot||this.processedTasks.push(e),e.isResourceIndependent&&(this.#L--,km.numResourceIndependentTasks--),[t,e]}hasResourceIndependentTasks(){return this.#L>0}processNextResourceIndependentTask(){for(let e=0;e<this.remainingTasks.length;e++){const t=this.remainingTasks[e];if(t.isResourceIndependent)return t.execute(),this.remainingTasks.splice(e),t.isOneShot||this.processedTasks.push(t),this.#L--,void km.numResourceIndependentTasks--}}nextTaskWillFit(){if(!sn)return!0;if(!this.remainingTasks.length)return!0;const e=this.remainingTasks[0].getMemoryCost();return this.outOfCoreTileManager.getRenderer().canUpload(e)}getTotalMemoryCost(){return this.getRemainingMemoryCost()+this.getCurrentMemoryCost()}getRemainingMemoryCost(){return dm()(this.remainingTasks.map((e=>e.getMemoryCost())))}getCurrentMemoryCost(){return dm()(this.processedTasks.map((e=>e.getMemoryCost())))}getFreeableMemory(e){let t=0;for(let i of this.processedTasks)t+=i.getFreeableMemory(e);return t}freeMemory(){let e=0;for(let t of this.processedTasks)e+=t.freeMemory();return this.remainingTasks.push(...this.processedTasks),this.processedTasks=[],e}getCurrentScreenSpaceError(){let e=-1/0;for(let t=0;t<this.iteratorStates.length;t++)e=Math.max(e,this._getIteratorScreenSpaceError(t));return e}_getIteratorScreenSpaceError(e){const t=this.outOfCoreTileManager.getFrameCount(e),i=this.iteratorStates[e];if(!i)return-1/0;const n=i.screenSpaceError;if(t-i.lastRendered<10)return n;return t-i.lastUpdated<10?n:0}updateScreenSpaceError(e,t,i){void 0===this.iteratorStates[e]&&(this.iteratorStates[e]={screenSpaceError:t,lastUpdated:i,lastRendered:i}),this.iteratorStates[e].screenSpaceError=t,this.iteratorStates[e].lastUpdated=i}updateLastRendered(e,t){void 0===this.iteratorStates[e]&&(this.iteratorStates[e]={screenSpaceError:1/0,lastUpdated:t,lastRendered:t}),this.iteratorStates[e].lastRendered=t}compare(e){return this.completelyLoaded!==e.completelyLoaded?this.completelyLoaded?-1:1:this.transparent!=e.transparent?this.transparent?1:-1:e.getCurrentScreenSpaceError()-this.getCurrentScreenSpaceError()}}class ym extends fm{#I;constructor(e,t,i,n){super(e),this.meshIndex=t,this.fragList=i,this.bvhNodeId=n}execute(){const e=this.outOfCoreTileManager.model.getConsolidation();if(!e)return;const t=this.outOfCoreTileManager.getRenderer(),i=!(Autodesk.Viewing.Private.isFirefox()&&Autodesk.Viewing.Private.isMac()||sn)&&ln,n=yv(e,this.meshIndex,this.fragList,i,t);return t.uploadGeometry(n),Zg(),this.getMemoryCost()}freeMemory(){const e=this.outOfCoreTileManager.model.getConsolidation();return e?(e.freeMeshGeometry(this.meshIndex),this.getMemoryCost()):0}getMemoryCost(){if(void 0===this.#I){const e=this.outOfCoreTileManager.model.getConsolidation();if(!e)return 0;this.#I=e.getMemoryCostForConsolidatedMesh(this.meshIndex,this.fragList)}return this.#I}getFreeableMemory(e){return this.getMemoryCost()}}const bm=new(v().Box3),xm=new(v().Box3),_m=(new(v().Sphere),new(v().Vector3)),Em=Math.sqrt(3);class Sm{#R;#D;#O;#B;#N;#U;#k;#F;#V;#G;#z;#H;#W;#j;#q;#K;#X;#Y;#Q;#Z;#$;#J;#ee=1;constructor(){this.#R=null,this.#D=null,this.#O=null,this.#B=null,this.#N=null,this.#U=null,this.#k=null,this.#F=0,this.#V=0,this.#G=1,this.#z=!0,this.#H=!1,this.#j=!1,this.#q=!1,this.#K=null,this.#X=!1,this.#Y=null,this.#Q=!0,this.#Z=null,this.#$=null,this.#J=null}initialize(e,t){this.#Z=e,this.#$=t.options,this.#R=e.getFragmentList(),this.#Y=e.RenderBatch,this.#$&&this.#$.hasOwnProperty("prioritize_screen_size")&&(this.#z=this.#$.prioritize_screen_size),this.#O=t.primitives;const i=t.nodes;this.#D=i,this.#B=new Array(i.nodeCount),this.#N=new Int8Array(i.nodeCount),this.#U=new Int32Array(i.nodeCount+1),this.#k=new Float32Array(i.nodeCount),Ji&&!this.#$.raycasting_only&&([this.#W,this.#J]=km.getManagerForIterator(this,e));for(let e=0;e<i.nodeCount;e++){var n;const t=i.getPrimCount(e);if(0===t)continue;const r=i.getLargestPrimitiveSize(e);this.#B[e]=new this.#Y(this,this.#R,i.getPrimStart(e),t,void 0,r,null===(n=this.#$)||void 0===n?void 0:n.sortFuncType);const o=this.#B[e];o.lastItem=o.start+t,o.numAdded=t,o.numAddedTotal=t,o.nodeIndex=e,8&i.getFlags(e)&&(o.sortObjects=!0),i.getBoxArray(e,o.bboxes)}}dtor(){var e;this.#Y=null,this.#R=null,this.#Z=null,null===(e=this.#W)||void 0===e||e.releaseIterator(this.#J)}_initializeNodes(){var e;if(Ji&&null!==(e=this.#Z.loader.svf)&&void 0!==e&&e.loadDone)for(let e=0;e<this.#D.nodeCount;++e){this.#D.getPrimCount(e)>0&&(this.#W.bvhNodeInitialized(e)||this.#W.initializeNode(e))}}reset(e,t){var i;if(this.#K=e,this.#ee=e.projScale,this.#F=0,this.#V=0,this.#N[0]=this.#N[1]=ac.CONTAINMENT_UNKNOWN,this.#U[this.#V++]=0,this.#H=!1,this.#j=!1,this.#X=!1,this.#Q){let e=this.#B,t=e.length;for(let i=0;i<t;++i){let t=e[i];t&&t.resetVisStatus&&t.resetVisStatus()}this.#Q=!1}null===(i=this.#W)||void 0===i||i.incrementFrameCount(this.#J),rn&&(this.updateNodeArea(0),this.updateTransparentNodeArea(1))}#te(e){const t=this.#k[e];let i=this.#V;if(this.#G)for(;i>this.#F&&this.#k[this.#U[i-1]]>t;)this.#U[i]=this.#U[i-1],i--;else for(;i>this.#F&&this.#k[this.#U[i-1]]<t;)this.#U[i]=this.#U[i-1],i--;this.#U[i]=e,this.#V++}nextBatch(){for(this.#j||this.#H||this.#F!==this.#V||(this.#q||(this.#U[this.#V++]=1),this.#H=!0);this.#F!==this.#V;){const e=this.#G||this.#H?this.#U[--this.#V]:this.#U[this.#F++];let t=this.#N[e];if(t!==ac.CONTAINS&&(this.#D.getBoxThree(e,bm),t=this.#K.intersectsBox(bm)),t!==ac.OUTSIDE){const i=this.#D.getLeftChild(e);let n,r;if(-1!==i){const o=this.#D.getFlags(e),s=this.#K.viewDir[3&o]<0?1:0;let a=o>>2&1,l=o>>3&1;const c=this.#G||this.#H?1:0;let u=0,h=0;this.#z&&!this.#H?(n=i+a,r=i+1-a,rn&&this.#$.sortFuncType?(u=this.updateNodeArea(n),h=this.updateNodeArea(r)):(this.#D.getBoxThree(n,bm),this.#k[n]=u=this.#K.projectedBoxArea(bm,t===ac.CONTAINS),this.#D.getBoxThree(r,bm),this.#k[r]=h=this.#K.projectedBoxArea(bm,t===ac.CONTAINS)),this.#N[n]=this.#N[r]=t,u>0&&this.#te(n),h>0&&this.#te(r)):(s^c^l&&(a=1-a),n=i+a,r=i+1-a,this.#U[this.#V++]=n,this.#U[this.#V++]=r,this.#N[n]=this.#N[r]=t,this.#W?(this.updateTransparentNodeArea(n),this.updateTransparentNodeArea(r)):(this.#k[n]=-1,this.#k[r]=-1))}if(0!==this.#D.getPrimCount(e)){const i=this.#B[e];return i.renderImportance=Ji?this.#k[e]:this.#K.projectedBoxArea(i.getBoundingBox(),t===ac.CONTAINS),i}}this.#H||this.#j||this.#F!==this.#V||(this.#q||(this.#U[this.#V++]=1),this.#H=!0)}return this.#X=!0,null}updateTransparentNodeArea(e){var t;this.#D.getBoxThree(e,bm);let i=bm.getBoundingSphere().center.distanceTo(this.#K.eye);return this.#k[e]=-1/i,null===(t=this.#W)||void 0===t||t.updateBvhNodeScreenSpaceError(this.#J,e,this.#ee*i),i}updateNodeArea(e){var t;let i,n=this.#B[e];if(!n)return-1;if(this.#$.sortFuncType===Autodesk.Viewing.Private.BVHSortFuncType.DIAMETER){const t=this.#D.getLargestPrimitiveSize(e),r=.5*Math.sqrt(t);if(i=r,this.#K.perspective){n.getBoundingBox(bm);const e=-r/Em;bm.expandByVector(_m.set(e,e,e)),bm.max.x<bm.min.x&&(bm.max.x=bm.min.x=.5*(bm.max.x+bm.min.x)),bm.max.y<bm.min.y&&(bm.max.y=bm.min.y=.5*(bm.max.y+bm.min.y)),bm.max.z<bm.min.z&&(bm.max.z=bm.min.z=.5*(bm.max.z+bm.min.z)),i=r/Math.max(1,bm.distanceToPoint(this.#K.eye))}}else{let t=this.#B[e];if(i=this.#D.getLargestPrimitiveSize(e),this.#K.perspective){t.getBoundingBox(bm);let e=bm.distanceToPoint(this.#K.eye);e*=e,i/=Math.max(1,e)}}return this.#k[e]=i,null===(t=this.#W)||void 0===t||t.updateBvhNodeScreenSpaceError(this.#J,e,this.#ee*i),i}skipOpaqueShapes(){this.#H||this.#j||(this.#F=0,this.#V=0,this.#U[this.#V++]=1,this.#j=!0)}setIgnoreTransparency(e){this.#q=e}#ie(e){const t=this.#D.getLeftChild(e);-1!==t&&(this.#ie(t),this.#ie(t+1)),bm.makeEmpty(),-1!==t&&(this.#D.getBoxThree(t,xm),bm.union(xm),this.#D.getBoxThree(t+1,xm),bm.union(xm));this.#D.getPrimCount(e)&&(bm.union(this.#B[e].getBoundingBox()),bm.union(this.#B[e].getBoundingBoxHidden())),this.#D.setBoxThree(e,bm)}getVisibleBounds(e,t){for(let i=0;i<this.#B.length;i++){let n=this.#B[i];if(!n)continue;n.calculateBounds();let r=n.getBoundingBox();e.union(r),t.union(r),t.union(n.getBoundingBoxHidden())}this.#ie(0),this.#ie(1)}rayCast(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=e.ray.origin;let o=[1,0],s=new(v().Vector3),a=new(v().Box3);for(;o.length>0;){const l=o.pop();if(this.#D.getBoxThree(l,a),a.expandByScalar(.5),null!=n.maxDistance){if(a.distanceToPoint(r)>n.maxDistance)continue}if(null===e.ray.intersectBox(a,s))continue;const c=this.#D.getLeftChild(l);-1!==c&&(o.push(c),o.push(c+1));if(0!==this.#D.getPrimCount(l)){this.#B[l].raycast(e,t,i,n)}}}intersectFrustum(e,t){let i=[1,ac.CONTAINMENT_UNKNOWN,0,ac.CONTAINMENT_UNKNOWN];for(;i.length;){const n=i.pop(),r=i.pop();let o;if(n===ac.CONTAINS?o=ac.CONTAINS:(this.#D.getBoxThree(r,bm),o=e.intersectsBox(bm)),o===ac.OUTSIDE)continue;const s=this.#D.getLeftChild(r);-1!==s&&(i.push(s),i.push(o),i.push(s+1),i.push(o));if(0!==this.#D.getPrimCount(r)){let i=this.#B[r];i&&i.intersectFrustum(e,t,o===ac.CONTAINS)}}}getSceneCount(){return this.#B.length}getGeomScenes(){return this.#B}getOutOfCoreTileManager(){return this.#W}getBVH(){return new Nf(this.#D.nodesRaw,this.#D.is_lean_node,this.#O,this.#$)}getFragOrder(){return this.#O}done(){return this.#X}resetVisStatus(){this.#Q=!0}clone(){const e=new Sm,t=new Int32Array(this.#O),i=new Nf(this.#D.nodesRaw,this.#D.is_lean_node,t,this.#$);return e.initialize(this.#Z,i),e}getIteratorOutOfCoreManagerId(){return this.#J}isNodeTransparent(e){return!!(8&this.#D.getFlags(e))}}class Am extends fm{constructor(e,t){super(e),this.callback=t}execute(){const e=this.callback();return"number"==typeof e?e:0}}const wm=/#([^\s]*)(\s*)/gm;class Cm{elseIsValid=!0;branches=[];constructor(e){this.pushBranch("if",e)}pushBranch(e,t){if(!this.elseIsValid)throw new Error(`#${e} not preceeded by an #if or #elif`);this.elseIsValid="if"===e||"elif"===e,this.branches.push({expression:!!t,string:""})}appendStringToCurrentBranch(...e){for(const t of e)this.branches[this.branches.length-1].string+=t}resolve(){for(const e of this.branches)if(e.expression)return e.string;return""}}function Tm(e,...t){const i=[];let n=new Cm(!0);n.elseIsValid=!1;const r=(e,t)=>{if(e.index+e[0].length!=t.length)throw new Error(`#${e[1]} must be immediately followed by a template expression (ie: \${value})`)};for(let o=0;o<e.length;++o){const s=e[o],a=s.matchAll(wm);let l=0,c=!1;for(const e of a){switch(n.appendStringToCurrentBranch(s.substring(l,e.index)),e[1]){case"if":r(e,s),c=!0,i.push(n),n=new Cm(t[o]);break;case"elif":r(e,s),c=!0,n.pushBranch(e[1],t[o]);break;case"else":n.pushBranch(e[1],!0),n.appendStringToCurrentBranch(e[2]);break;case"endif":if(!i.length)throw new Error(`#${e[1]} not preceeded by an #if`);const a=n.resolve();n=i.pop(),n.appendStringToCurrentBranch(a,e[2]);break;default:n.appendStringToCurrentBranch(e[0])}l=e.index+e[0].length}l!=s.length&&n.appendStringToCurrentBranch(s.substring(l,s.length)),!c&&t.length>o&&n.appendStringToCurrentBranch(t[o])}if(i.length)throw new Error("Mismatched #if/#endif count");return n.resolve()}function Mm(e,t){if(!t||t.length<e.length){const i=e.slice((null==t?void 0:t.length)||0).map((e=>`"$${e}"`)).join(", ");throw new Error(`[wgpu] Missing values for: ${i}`)}return t}function Im(e,t){const i=/\$\w+/,n=e.match(/(?<=\$)(\w+)/g);if(!n||!n.length)return e;if(Array.isArray(t))return Tm(e.split(i),...Mm(n,t));if(t&&!Array.isArray(t)&&"object"==typeof t)return Tm(e.split(i),...n.map((e=>{if(!Object.hasOwn(t,e))throw new Error(`[wgpu] Missing value for "$${e}"`);const i=t[e];if("object"==typeof i&&null!==i||"function"==typeof i)throw new Error(`[wgpu] Unsupported value type "${typeof i}"`);return i})));for(var r=arguments.length,o=new Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];return Tm(e.split(i),...Mm(n,[t,...o]))}const Pm="struct ObjectUniforms {\n    modelMatrix: mat4x4f,\n\n    dbId: u32,\n    modelId: u32,\n    objectFlags: u32,\n    themeColor: u32,\n\n    materialIndex: u32,\n    pad: u32,\n    pad2: u32,\n    pad3: u32\n}\n\nstruct CommonMaterialUniforms {\n    edgeColor: u32,\n    doNotCutOverride: u32,\n    pad: u32,\n    pad2: u32\n}\n\nstruct MaterialUniforms {\n    renderFlags: u32,\n    diffuse: u32,\n    specular: u32,\n    shininess: f32,\n\n    hatchParams: vec2f,\n    hatchTintIntensity: f32,\n    heatmapSensorCountAndOffset: u32\n}\n\n@group($bindGroup) @binding(0) var<storage> objectUniformsArr : array<ObjectUniforms>;\n//@group($bindGroup) @binding(0) var<uniform> objectUniformsArr : array<ObjectUniforms, ${MAX_BATCH}>;\n@group($bindGroup) @binding(1) var<storage> materialUniformsArr : array<MaterialUniforms>;\n@group($bindGroup) @binding(2) var<uniform> commonMaterialUniforms : CommonMaterialUniforms;\n\n\nfn getObjectUniforms(instance: u32) -> ObjectUniforms {\n    return objectUniformsArr[instance];\n}\n\nfn getMaterialUniforms(materialIndex: u32) -> MaterialUniforms {\n    return materialUniformsArr[materialIndex];\n}\n\nfn intToVec(v : u32) -> vec4u {\n    return vec4u(v & 0xff, (v >> 8) & 0xff, (v >> 16) & 0xff, (v >> 24) & 0xff);\n}\n\nfn intToVecf(v : u32) -> vec4f {\n    return vec4f(intToVec(v)) / 255.0;\n}\n",Lm=96,Rm=24;function Dm(e){return Im(Pm,{bindGroup:e})}const Om={transform:0,dbId:16,modelId:17,flags:18,themingColor:19,materialReference:20};class Bm{#ne;#re;#oe;#se=new al(!1);constructor(e){this.#ne=new Float32Array(Rm*e),this.#re=new Int32Array(this.#ne.buffer),this.#oe=new Uint8Array(this.#ne.buffer)}length(){return this.#ne.length/Rm}#ae(e,t,i){const n=t.vizflags[i]&ll.MESH_MOVED,r=Boolean(t.matrix);if(n||r)return t.getWorldMatrix(i,this.#se),void this.setTransform(e,this.#se);const o=t.transforms,s=12*i,a=e*Rm;this.#ne[a]=o[s],this.#ne[a+1]=o[s+1],this.#ne[a+2]=o[s+2],this.#ne[a+3]=0,this.#ne[a+4]=o[s+3],this.#ne[a+5]=o[s+4],this.#ne[a+6]=o[s+5],this.#ne[a+7]=0,this.#ne[a+8]=o[s+6],this.#ne[a+9]=o[s+7],this.#ne[a+10]=o[s+8],this.#ne[a+11]=0,this.#ne[a+12]=o[s+9],this.#ne[a+13]=o[s+10],this.#ne[a+14]=o[s+11],this.#ne[a+15]=1}setTransform(e,t){const i=e*Rm;this.#ne.set(t.elements,i)}#le(e,t,i,n,r,o){const s=e*Rm;this.#re[s+Om.dbId]=t,this.#re[s+Om.modelId]=i,this.#re[s+Om.objectFlags]=n,this.#re[s+Om.themingColor]=r,this.#re[s+Om.materialReference]=o}setFromFragment(e,t,i,n){const r=t.fragments.fragId2dbId[i],o=t.modelId,s=function(e,t){const i=e.getThemingColor(t),n=i&&i.w>0;return n?Nm(i):0}(t,i);this.#ae(e,t,i),this.#le(e,r,o,0,s,n)}setFromObject(e,t,i){this.setTransform(t,e.matrixWorld);const n=e.themingColor;let r=0;n&&n.w>0&&(r=Nm(e.themingColor)),this.#le(t,e.dbId,e.modelId,e.objectFlags||0,r,i)}setObjectDataFromInstanceBuffer(e,t,i){const n=e.attributes.instanceUniforms.array,r=this.#oe,o=t*Lm;r.set(n,o);for(let n=0;n<e.numInstances;n++){const e=(t+n)*Rm;this.setMaterialReference(e,i)}}setMaterialReference(e,t){this.#re[e+Om.materialReference]=t}uploadIntValue(e,t,i,n,r){this.#re[0]=r;const o=i*Lm+4*n;e.queue.writeBuffer(t,o,this.#ne.buffer,0,4)}uploadTransform(e,t,i,n,r){this.#ae(0,n,r);const o=4*Om.transform,s=o,a=i*Lm+o;e.queue.writeBuffer(t,a,this.#ne.buffer,s,64)}uploadThemingColor(e,t,i,n){const r=n.w>0?Nm(n):0;this.#re[Om.themingColor]=r;const o=4*Om.themingColor,s=o,a=i*Lm+o;e.queue.writeBuffer(t,a,this.#ne.buffer,s,4)}upload(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length(),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const r=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)*Lm;let o=i*Lm;arguments.length>5&&void 0!==arguments[5]&&arguments[5]&&(o=o+255&4294967040),e.queue.writeBuffer(t,r,this.#ne.buffer,n*Lm,o)}}function Nm(e){return 255*e.x|255*e.y<<8|255*e.z<<16|255*e.w<<24}class Um extends fm{#ce;#ue=0;constructor(e,t){super(e),this.#ce=t}execute(){const e=this.#ce,t=this.outOfCoreTileManager.getRenderer();return e.sortByVertexBuffer(e.start,e.lastItem),t.uploadUniforms(e),e.uniformsNeedUpdate=!1,this.#ue=this.getMemoryCost(),e.sortObjects||(e.allowInterruption=!1,e.useRenderBundles=!0),e.isComplete=!0,this.#ue}freeMemory(){const e=this.#ue,t=this.#ce,i=this.outOfCoreTileManager.getRenderer();return i.freeUniforms(t),this.#ue=0,t.sortObjects||(t.allowInterruption=!0,i.getMainPass().clearRenderBundles(t),t.useRenderBundles=!1),t.isComplete=!1,e}getMemoryCost(){const e=this.#ce.count;return Math.round(e*Lm*1.1)}getFreeableMemory(){return this.#ue}}class km{static#he=0;static#de=0;static#fe={uploadedThisFrame:0,removedThisFrame:0,uploadedLastSecond:0,removedLastSecond:0,uploadedThisSecond:0,removedThisSecond:0};static#pe=[];static#me=[];static#ge;static notYetAddedManagers=new Set;static pendingNodes=[];static geomRefCounts=new Map;static modelManagerRegistry=new Map;static globalTasks=[];static recurringTasks=[];static onlyGlobalTasksExecuted=!1;#ve=[];model;bvhNodes=[];iteratorLockedTiles=new Map;#ye=[];iteratorIdRegistry=[];static#be=void 0;static#xe=void 0;static numResourceIndependentTasks=0;constructor(e){this.model=e,km.setMemoryLimit(zi)}getBvhNode(e){let t=this.bvhNodes[e];return t||(t=new vm(e,this.model,this),this.bvhNodes[e]=t),t}bvhNodeInitialized(e){var t;return null===(t=this.bvhNodes[e])||void 0===t?void 0:t.initialized}addTask(e,t,i){const n=this.model.getConsolidation();if(!n)return null;let r=this.getBvhNode(e);if(!n.meshGeometryAvailable(t)&&!r.hasTask(t)){let n=new ym(this,t,i,e);r.addTask(n),this.#_e(r)}if(n.meshes[t].geometry.numInstances>1){let n=r.getInstancedMeshUploadTask();n?n.addGeometry(t):(n=new gm(this,t,i,e),r.addTask(n),this.#_e(r))}}addCallbackTask(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=this.getBvhNode(e),o=new Am(this,t);o.isOneShot=i,o.isResourceIndependent=n,r.addTask(o),this.#_e(r)}requestGeometryForNode(e){if(!this.model.getIterator().getGeomScenes()[e])return!1;const t=this.getBvhNode(e);km.pendingNodes.push(t)}initializeNode(e){var t,i;if(this.bvhNodeInitialized(e))return void console.warn("Node already initialized");const n=this.model.getFragmentList(),r=this.model.getIterator();let o=this.getBvhNode(e);if(!(r instanceof Sm))return void console.error("ModelIterator is not a BVH iterator");const s=r.getGeomScenes()[e];if(!s)return void console.error("No render batch for node");if(o.transparent=r.isNodeTransparent(e),o.initialized=!0,sn){let t=s.getIndices().subarray(s.start,s.lastItem);t=t.filter((e=>n.isFragmentActive(e))),t.length>0&&this.setRemainingFragmentsForNode(e,n,t);const i=new Um(this,s);o.addTask(i);return void(-1!==km.#pe.indexOf(o)||km.#pe.push(o))}const a=this.model.getConsolidation();null===(t=a.consolidationMap.bvhNodeToRanges[e])||void 0===t||t.forEach((e=>{const t=this.model.loader.viewer3DImpl.matman();a.consolidationMap._buildConsolidationMesh(e,n,t,this.model,!0,!1,a)})),null===(i=a.consolidationMap.bvhNodeToInstancingRanges[e])||void 0===i||i.forEach((e=>{let[t,i]=e;if(-1!==a.fragId2MeshIndex[a.consolidationMap.fragOrder[t]])return;const n=this.model.loader.viewer3DImpl.matman();Ov(this.model,n,a.consolidationMap.fragOrder,t,i,a)}));let l=s.getIndices();for(let t=s.start;t<s.lastItem;t++){let i=l[t],r=a.fragId2MeshIndex[i];r!==kg&&(a.meshes[r].geometry&&(o.transparent||this.addTask(e,r,n)))}const c=a.nodeId2SingleFragIds&&a.nodeId2SingleFragIds[e];c&&c.length>0&&this.setRemainingFragmentsForNode(e,n,c)}releaseIterator(e){this.resetScreenSpaceErrors(e),this.resetLockedTiles(e),this.iteratorIdRegistry[e]=void 0,this.iteratorIdRegistry.every((e=>void 0===e))&&this.freeAllNodes()}activateIterator(e,t){this.iteratorIdRegistry[e]=t}freeAllNodes(){this.bvhNodes.forEach((e=>{let t=e.freeMemory();km.#de-=t,e.remainingTasks.splice(0,e.remainingTasks.length),e.initialized=!1})),km.#me=km.#me.filter((e=>e.outOfCoreTileManager!==this)),km.#pe=km.#pe.filter((e=>e.outOfCoreTileManager!==this))}getConsolidationMesh(e,t,i,n,r,o){const s=this.model.getConsolidation();if(!s)return null;if(this.getBvhNode(t).updateLastRendered(e,this.getFrameCount(e)),!s.meshGeometryAvailable(i))return null;let a=s.meshes[i].geometry;return a.numInstances>1&&!0===a.streamingDraw?null:s.applyAttributes(i,n,r,o)}updateBvhNodeScreenSpaceError(e,t,i){this.getBvhNode(t).updateScreenSpaceError(e,i,this.getFrameCount(e))}setRemainingFragmentsForNode(e,t,i){let n=this.getBvhNode(e);if(n.getRemainingFragmentsTask())throw new Error("setRemainingFragmentsForNode invoked twice");{const r=100;for(let o=0;o<i.length;o+=r)n.addTask(new mm(this,t,e,i.slice(o,o+r)));this.#_e(n)}}#_e(e){1===e.remainingTasks.length&&-1===km.#pe.indexOf(e)&&km.#pe.push(e)}resetLockedTiles(e){let t=this.iteratorLockedTiles.get(e);if(t)for(let i of t)this.unlockTile(e,i)}unlockTile(e,t){let i=this.getBvhNode(t),n=this.iteratorLockedTiles.get(e);n.delete(t)&&i.lockedCounter--,console.assert(n&&i.lockedCounter>=0)}lockTile(e,t){this.getBvhNode(t).lockedCounter++;let i=this.iteratorLockedTiles.get(e);i||(i=new Set,this.iteratorLockedTiles.set(e,i)),i.add(t)}incrementFrameCount(e){this.#ve[e]=(this.#ve[e]??0)+1}resetScreenSpaceErrors(e){this.bvhNodes.forEach((t=>{t.updateScreenSpaceError(e,-1/0,0),t.updateLastRendered(e,0)}))}getIteratorId(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.iteratorIdRegistry,n=i.indexOf(e);if(-1!==n)return n;if(!t)for(let t=0;;t++)if(void 0===i[t])return i[t]=e,t}#Ee(e){this.#ye.push(e)}#Se(e,t){let i=this.#ye.indexOf(e);-1!==i&&this.#ye.splice(i,1);const n=t.getIterator(),r=this.iteratorIdRegistry.indexOf(n);-1!==r&&this.releaseIterator(r)}getViewer(){return this.#ye[0]}getRenderer(){return this.#ye[0].glrenderer()}static getNextBVHNodeToPrefetchGeometryFor(){for(km.pendingNodes.sort(((e,t)=>e.model.getConsolidation()?t.model.getConsolidation()?-e.compare(t):-1:1));km.pendingNodes.length>0;){const e=km.pendingNodes.pop(),t=e.outOfCoreTileManager.model;if(!t.getConsolidation()&&!sn)return km.pendingNodes.push(e),null;const i=t.getFragmentList(),n=t.getIterator().getGeomScenes()[e.nodeId],r=n.getIndices(),o=new Set;let s=!1;for(let e=n.start;e<n.lastItem;e++){const n=r[e];if(i.isNotLoaded(n)){s=!0;continue}const a=i.getGeometryId(n);if(0===a||i.geoms.hasGeometry(a)||o.add(t.loader.svf.getGeometryHash(a)),!i.hasMaterial(n)){const e=t.loader.svf.fragments.materials[n],i=t.loader.svf.getMaterialHash(e);t.loader.pendingMaterials.has(i)&&o.add(i)}}if(0===o.size&&!s){e.outOfCoreTileManager.initializeNode(e.nodeId);continue}let a=o.size;return{hashes:o,callback:t=>{t?0!=--a||s||e.outOfCoreTileManager.initializeNode(e.nodeId):s=!0}}}return null}static addGlobalTask(e){km.globalTasks.push(e)}static addRecurringTask(e){km.recurringTasks.push(e)}static removeRecurringTask(e){const t=km.recurringTasks.indexOf(e);-1!==t&&km.recurringTasks.splice(t,1)}static executeTasks(e){for(const t of km.recurringTasks)t(e);if(!km.onlyGlobalTasksExecuted||0===km.#pe.length)for(;km.globalTasks.length>0;){if((0,km.globalTasks[0])(e)&&km.globalTasks.shift(),performance.now()>=e)return void(km.onlyGlobalTasksExecuted=!0)}if(km.onlyGlobalTasksExecuted=!1,km.notYetAddedManagers.size>0)return;let t;for(km.#fe.uploadedThisFrame=0,km.#fe.removedThisFrame=0,km.#pe.length>0&&km.#pe[0].processedTasks.length>0&&(t=km.#pe.shift()),km.#pe.sort(((e,t)=>e.compare(t))),t&&km.#pe.unshift(t),km.#me.sort(((e,t)=>-e.compare(t)));km.#pe.length>0;){const t=km.#pe[0];if(!t.hasNextTask()){km.#pe.shift();continue}let i=km.#he-km.#de;i<0&&(km.tryToFreeMemory(null,-i),i=km.#he-km.#de);let n=t.getRemainingMemoryCost();if(n>i&&(this.#Ae(t.model),!km.tryToFreeMemory(t,n))){if(km.numResourceIndependentTasks>0)for(const t of km.#pe)for(;t.hasResourceIndependentTasks();)if(t.processNextResourceIndependentTask(),performance.now()>=e)return;break}let r=!1;for(;t.hasNextTask();){if(!t.nextTaskWillFit())return;const[i,n]=t.processNextTask();if(null!=n&&n.isResourceIndependent||(r=!0),km.#de+=i,t.hasNextTask()||(km.#pe.shift(),r&&-1===km.#me.indexOf(t)&&(km.#fe.uploadedThisSecond++,km.#fe.uploadedThisFrame++,km.#me.push(t))),performance.now()>=e)return}}}static tryToFreeMemory(e,t){let i=0,n=0,r=!1,o={};for(;n<km.#me.length;n++){let s=km.#me[n];if(0!==s.lockedCounter||!(null===e||e.compare(s)<0))break;if(i+=s.getFreeableMemory(o),i>t){r=!0;break}}if(!r)return!1;let s=0;for(let e=0;e<=n;e++){let e=km.#me.shift(),t=e.freeMemory();s+=t,km.#de-=t,km.#pe.push(e),km.#fe.removedThisSecond++,km.#fe.removedThisFrame++}return console.assert(s===i),!0}static setMemoryLimit(e){let t=km.#he;km.#he=.9*e,km.#he<t&&this.tryToFreeMemory(null,t-km.#he)}getFrameCount(e){return this.#ve[e]??0}static getStats(){return km.#ge||(km.#ge=setInterval(km.updateStats,1e3)),{consolidationMemoryConsumed:km.#de,consolidationMemoryLimit:km.#he,tilesInQueue:km.#pe.length,tilesOnGpu:km.#me.length,uploadedLastSecond:km.#fe.uploadedLastSecond,removedLastSecond:km.#fe.removedLastSecond,uploadedThisFrame:km.#fe.uploadedThisFrame,removedThisFrame:km.#fe.removedThisFrame}}static updateStats(){km.#fe.uploadedLastSecond=km.#fe.uploadedThisSecond,km.#fe.removedLastSecond=km.#fe.removedThisSecond,km.#fe.uploadedThisSecond=0,km.#fe.removedThisSecond=0}static registerViewer(e){e.api.addEventListener(Zn,km.#we.bind(void 0,e)),e.api.addEventListener($n,km.#Ce.bind(void 0,e)),e.api.addEventListener(so,km.#Te.bind(void 0,e)),e.api.addEventListener(cm,km.#Me.bind(void 0,e))}static unregisterViewer(e){e.api.removeEventListener(Zn,km.#we.bind(void 0,e)),e.api.removeEventListener($n,km.#Ce.bind(void 0,e)),e.api.removeEventListener(so,km.#Te.bind(void 0,e)),e.api.removeEventListener(cm,km.#Me.bind(void 0,e))}static#Me(e,t){var i;null===(i=e.geomCache(!1))||void 0===i||i.startProcessing(),t.model.getIterator()._initializeNodes()}static#Te(e,t){if(!t.visible)for(let t of e.api.getAllModels()){let[e,i]=km.getManagerForIterator(t.getIterator(),t,!0);e&&i&&e.resetScreenSpaceErrors(i)}}static#we(e,t){let i;km._updateLeechViewerKeysInModelRegistry(),void 0!==t.model.leechViewerKey&&(i=km.modelManagerRegistry.get(t.model.leechViewerKey)),i||(i=km.modelManagerRegistry.get(t.model)),km.notYetAddedManagers.delete(i),i||(i=new km(t.model),void 0!==t.model.leechViewerKey&&km.modelManagerRegistry.set(t.model.leechViewerKey,i)),km.modelManagerRegistry.set(t.model,i),km.#xe=void 0,i.#Ee(e)}static#Ce(e,t){let i=km.modelManagerRegistry.get(t.model);if(i&&i.#Se(e,t.model),km.modelManagerRegistry.delete(t.model),void 0!==t.model.leechViewerKey){0===Array.from(km.modelManagerRegistry.keys()).filter((e=>e.leechViewerKey===t.model.leechViewerKey)).length&&km.modelManagerRegistry.delete(t.model.leechViewerKey)}}static getManagerForIterator(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];km._updateLeechViewerKeysInModelRegistry();let n=km.modelManagerRegistry.get(t.leechViewerKey)??km.modelManagerRegistry.get(t);if(!n){if(i)return[void 0,0];n=new km(t),void 0!==t.leechViewerKey&&km.modelManagerRegistry.set(t.leechViewerKey,n),km.modelManagerRegistry.set(t,n),km.notYetAddedManagers.add(n)}let r=n.getIteratorId(e,i);return[n,r]}static _updateLeechViewerKeysInModelRegistry(){for(let[e,t]of km.modelManagerRegistry.entries())e.leechViewerKey&&!km.modelManagerRegistry.has(e.leechViewerKey)&&km.modelManagerRegistry.set(e.leechViewerKey,t)}static resetAfterContextLoss(){for(let e of km.modelManagerRegistry.values())e.freeAllNodes()}static#Ae(e){var t;if(km.#xe)return;this.#xe=performance.now();const i=km.getStats(),n={memory_limit_time:this.#xe-this.#be,consolidation_memory_consumed:i.consolidationMemoryConsumed,consolidation_memory_limit:i.consolidationMemoryLimit,tiles_in_queue:i.tilesInQueue,tiles_on_gpu:i.tilesOnGpu,urn:(null==e||null===(t=e.getData())||void 0===t?void 0:t.urn)??"NOT_SET"};Qe.track("viewer.model.gpu_out_of_core",n)}static setModelLoadStartedTimestamp(){this.#be=performance.now()}}var Fm="meshReceived",Vm="meshFailed",Gm="materialReceived",zm="materialFailed";let Hm=Autodesk.Viewing.Private,Wm="false"!==fe("useOPFS")&&!1!==c().USE_OPFS;const jm=fe("useAdaptiveStreaming")||c().USE_ADAPTIVE_STREAMING,qm="false"!==jm&&!1!==jm,Km="true"===fe("disableIndexedDb").toLowerCase()||c().DISABLE_INDEXED_DB,Xm="true"===fe("disableWebSocket").toLowerCase()||c().DISABLE_WEBSOCKET;let Ym=Km||Wm||!H();const Qm={dummy_value:"error"},Zm={dummy_value:"error"};function $m(e){var t=Fe(e);return t.disableIndexedDb=Km,t.disableWebSocket=Xm,t}function Jm(e,t){return e.importance-t.importance}function eg(e){var t,i=new Map,n=new Map;this._customOpfsCallbacks=new Map;var r=new Map,o="OPFS"===(null==e||null===(t=e.cache)||void 0===t?void 0:t.type);(Wm||o)&&(Wm=!0,Ym=!0);var s=fi("OtgLoadWorker");s.addEventListener("message",P);for(var a=F()?2:4,l=[],c=[],u=0,h=0;h<a;h++){l.push(fi("OtgDecodeWorker")),l[h].addEventListener("message",P);const e=new MessageChannel;l[h].doOperation({operation:"INSTALL_INPUT_PORT",port:e.port2},[e.port2]),c.push(e.port1)}const d=$m({operation:"INIT_WORKER_OTG",ports:c,useOpfs:Wm,clearIndexedDbIfItsLarge:o});let f,p,m=c.slice();s.doOperation(d,m),this.initialized=!0,this.bandwidthOptimizer=()=>{if(f||p||(p=Date.now()),f||this.requestsReceived<2*y)return f;const e=this.byteSize/this.requestsReceived*.9,t=this.byteSize/((Date.now()-p)/1e3);return qm&&(f=sm.createAndStart(v+g,e,t,(e=>y=e),(e=>{_.waitingTasks.length/(this.requestsSent+_.waitingTasks.length)*100>5&&s.doOperation({operation:"SET_OTGWS_COUNT",count:e})}))),f},this.byteSize=0,this.refCount=0,this.cachedHashesDb=void 0,this.cachedHashes=null,this.cachedHashesPending=!1,this.cachedHashesEstimate=void 0,this.cachedHashesEstimatePending=!1,this.fromCacheCount=0,this.fromRemoteCount=0,this.requestsSent=0,this.requestsReceived=0;var g=0,v=0;var y=qm?sm.MIN_FLIGHT:sm.FALLBACK_FLIGHT,b=null,x=!1,_=new $p,E=this,A=1048576;this._maxMemory=100*A,this._minCleanup=50*A;var w=new Map,C=[];this._numActiveLoaders=0;var T=[];function M(e,t){return!e.cachedHashes||e.cachedHashes.has(t)}function I(e,t){const i=r.get(e);null==i||i.callbacks.forEach((e=>e(t))),r.delete(e)}function P(e){let t=!1,r=0,o=function(){var o,s,a;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;if(null===i)return!0;if(!t){if(e.data.event&&e.data.properties)return Hm.analytics.track(e.data.event,e.data.properties),!0;if("number"==typeof e.data.customOpfsMessageId)return E._customOpfsCallbacks.get(e.data.customOpfsMessageId)(e.data.result),E._customOpfsCallbacks.delete(e.data.customOpfsMessageId),E.flushCacheAndDisconnect(),!0;if(Ji||_.isEmpty()||b||(b=setTimeout(L,0)),e.data.error){var c=e.data.error,u=c.args.hash;return"m"===c.args.resourceType?(g--,n.set(u,Zm),E.fireEvent({type:zm,hash:u}),console.error("Error loading material.",c.msg,c.args)):(v--,i.set(u,Qm),E.fireEvent({type:Vm,hash:u}),console.error("Error loading mesh.",c.msg,c.args)),I(u,!1),E.requestsReceived++,!0}t=!0}let h=0;if(e.data.materials)(async()=>{for(let t=0;t<e.data.materials.length;t++){const i=e.data.hashes[t],r=e.data.materials[t],o=pt(r);ou.isPrismMaterial(o)&&await ou.loadMaterialConverterPrismLibrary(),g--,E.requestsReceived++,n.set(i,o),E.fireEvent({type:Gm,material:o,hash:i}),h+=r.byteLength,I(i,!0)}})();else if(e.data.mdatas){const t=e.data.mdatas;for(;r<t.length;r++){v--,E.requestsReceived++;var d=t[r];if(d.hash&&d.mesh){var f=Oc.meshToGeometry(d);E.addGeometry(d.hash,f),E.cleanup(),E.fireEvent({type:Fm,geom:f}),I(d.hash,!0),d.fromCache?++E.fromCacheCount:++E.fromRemoteCount,h+=f.byteSize}if(r%20==0&&performance.now()>=l)return r++,!1}}return null===(o=E.bandwidthOptimizer())||void 0===o||o.onResourceReceived((null===(s=e.data.materials)||void 0===s?void 0:s.length)||(null===(a=e.data.mdatas)||void 0===a?void 0:a.length),h),E._handleCache(),!0};Ji?km.addGlobalTask(o):o()}function L(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=y;Ji&&u>0&&(t=Math.min(t,sm.THROTTLED_FLIGHT));var o=t-(v+g);if(o<=.01*t)return void(Ji||(b=setTimeout(L,30)));let a=[];if(Ji)for(;a.length<o&&performance.now()<e;){const e=km.getNextBVHNodeToPrefetchGeometryFor();if(!e)break;for(const t of e.hashes){let i=r.get(t);n.has(t)?setTimeout(e.callback,0):(i.callbacks.push(e.callback),i.requested||(i.requested=!0,a.push(i)))}}for(Ji&&0!==a.length||_.updateRequestPriorities();!_.isEmpty()&&a.length<o;){var l=_.takeTask();l.requested||(i.has(l.hash)||(a.push(l),l.requested=!0))}var c=null;for(let e of a)c?(c.urls.push(e.url),c.hashes.push(e.hash),c.lineageUrns.push(e.lineageUrn),c.couldBeInCache.push(M(E,e.hash))):c={operation:"LOAD_CDN_RESOURCE_OTG",type:"g",urls:[e.url],lineageUrns:[e.lineageUrn],hashes:[e.hash],queryParams:e.queryParams,couldBeInCache:[M(E,e.hash)]};c&&(s.doOperation($m(c)),v+=c.urls.length,E.requestsSent+=c.urls.length),Ji?0===r.size&&E.stopProcessing():b=_.isEmpty()?void 0:setTimeout(L,30)}this._nextMessageId=0,this.addViewer=function(e){C.push(e),_.addViewer(e)},this.removeViewer=function(e){const t=C.indexOf(e);-1!==t&&(_.removeViewer(e),C.splice(t,1)),0===C.length&&this.dtor()},this.dtor=function(){C=[],s.terminate(),s=null;for(const e of l)e.terminate();l=[],this.cleanup(!0),i=null,n=null,this._clearHashCache(),this.initialized=!1,b&&(clearTimeout(b),b=null),this.stopProcessing()},this._loadHashCache=function(){this.cachedHashesPending||(this.cachedHashesPending=!0,this.cachedHashesDb.open((()=>{this.cachedHashesDb.readAllCachedHashes((e=>{this.cachedHashes=new Set(e),this.cachedHashesPending=!1})),this.cachedHashesDb=void 0})))},this._clearHashCache=function(){this.cachedHashes=null},this._getHashCacheEstimate=function(){this.cachedHashesEstimatePending||(this.cachedHashesDb=new im(Km,!1),this.cachedHashesDb.open(null),this.cachedHashesEstimatePending=!0,this.cachedHashesDb.open((()=>{this.cachedHashesDb.estimateCachedHashCount((e=>{this.cachedHashesEstimate=e,this.cachedHashesEstimatePending=void 0===e}))})))},this._handleCache=function(){if(this.cachedHashes||Ym)return;const e=this.fromCacheCount+this.fromRemoteCount;if(e<200)return;const t=_.waitCount()*this.fromRemoteCount/e;null!=this.cachedHashesEstimate?this.cachedHashesEstimate<50*t&&this._loadHashCache():t>1e3&&this._getHashCacheEstimate()},this.modelAdded=function(e,t){var i={operation:"ADD_MODEL_OTG",modelUrn:e,lineageUrn:t,useOpfs:Wm};s.doOperation($m(i)),this.fromCacheCount=0,this.fromRemoteCount=0},this.loaderAdded=function(e){this._numActiveLoaders++,T.push(e)},this.loaderRemoved=function(e){this._numActiveLoaders--;const t=T.indexOf(e);-1!==t&&T.splice(t,1),this.flushCacheAndDisconnect()},this.flushCacheAndDisconnect=function(){if(!(0!==this._numActiveLoaders||this._customOpfsCallbacks.size>0)){this._clearHashCache();s.doOperation({operation:"FLUSH_CACHE_AND_DISCONNECT_OTG"})}},this.requestGeometry=function(e,t,n,o,s,a){let l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];var c=i.get(n);if(c!==Qm)if(c)S()?setTimeout((()=>this.fireEvent({type:Fm,geom:c})),0):this.fireEvent({type:Fm,geom:c});else{var u=r.get(n);if(u&&u.refcount)return u.importanceNeedsUpdate=!0,void u.refcount++;var h={operation:"LOAD_CDN_RESOURCE_OTG",type:"g",url:e,lineageUrn:a,hash:n,queryParams:s,importance:0,importanceNeedsUpdate:!0,refcount:1,requested:!1,callbacks:new Array};l&&_.addTask(h),r.set(n,h),Ji?this.startProcessing():b||(b=setTimeout(L,0))}else S()?setTimeout((()=>this.fireEvent({type:Vm,hash:n})),0):this.fireEvent({type:Vm,hash:n})},this.requestMaterial=function(e,t,i,o,a,l){var c=n.get(i);if(c!==Zm)if(c)setTimeout((()=>this.fireEvent({type:Gm,material:c,hash:i})));else{var u=r.get(i);if(u&&u.refcount)u.refcount++;else{var h={operation:"LOAD_CDN_RESOURCE_OTG",type:"m",urls:[e],lineageUrns:[l],hashes:[i],queryParams:a,refcount:1,couldBeInCache:[M(this,i)],requested:!0,callbacks:new Array};r.set(i,h),s.doOperation($m(h)),g++,this.requestsSent++}}else setTimeout((()=>this.fireEvent({type:zm,error:c,hash:i,repeated:!0})),0)},this.startProcessing=function(){x||(km.addRecurringTask(L),x=!0)},this.stopProcessing=function(){x&&(km.removeRecurringTask(L),x=!1)},this.cancelRequests=function(e){for(var t of e){var i=r.get(t);i&&i.refcount--}_.filterTasks((e=>{const t=r.get(e),i=t&&t.refcount;return i||r.delete(e),i}))},this.updateGeomImportance=function(e,t){return function(e,t){var i=e.getFragmentList(),n=i.getGeometry(t);if(i.getWorldBounds(t,Qp),n){var r,o,s,a,l=n.importance||0,c=2*((o=(r=Qp).max.x-r.min.x)*(s=r.max.y-r.min.y)+s*(a=r.max.z-r.min.z)+a*o);n.importance=Math.max(l,c)}}(e,t)},this.cleanup=function(e){if(!(0===w.size||!e&&this.byteSize<this._maxMemory)){var t=[];for(let e of w.values())t.push(e);t.sort(Jm);for(var n=e?0:this._maxMemory-this._minCleanup,r=0;r<t.length&&this.byteSize>=n;r++){var o=t[r];i.delete(o.hash),w.delete(o.id),this.byteSize-=o.byteSize,o.dispose()}}},this.waitForGeometry=function(e,t){var n=0,r=_.makeUrgent(e);if(0===r&&e)t(e);else{L(),this.addEventListener(Fm,a),this.addEventListener(Vm,l);for(let t in e){var o=i.get(t);o&&s(t,o)}}function s(i,o){_.removeUrgent(i),!0==!e[i]&&"number"!=typeof e[i]||(e[i]=o,++n<r||(E.removeEventListener(Fm,a),E.removeEventListener(Vm,l),t(e)))}function a(e){s(e.geom.hash,e.geom)}function l(e){s(e.hash,void 0)}},this.getGeometry=function(e){return i.get(e)},this.addGeometry=function(e,t){if(i.set(e,t),E.byteSize+=t.byteSize,Object.prototype.hasOwnProperty.call(t,"_modelRefCount"))return;t._modelRefCount=0;const n=Object.getPrototypeOf(t);Object.prototype.hasOwnProperty.call(n,"modelRefCount")||(Object.defineProperty(n,"modelRefCount",{get:tg}),n.setModelRefCount=ng)},this.setGeomRefCount=function(e,t){if(0===e._modelRefCount&&t>=1){w.get(e.id)&&w.delete(e.id)}else 0===t&&w.set(e.id,e);e._modelRefCount=t},this.addMaterialData=function(e,t){n.set(e,pt(t))},this.clearOpfsCache=function(){s.doOperation({operation:"CLEAR_OPFS_CACHE"})},this.reportLoadingState=function(){console.log("OtgResourceCache:",{sent:this.requestsSent,received:this.requestsReceived});s.doOperation({operation:"REPORT_LOADING_STATE"})},this.opfsStore=function(e,t,i){return new Promise((n=>{const r=this._nextMessageId++;this._customOpfsCallbacks.set(r,n);const o={operation:"OPFS_CACHE_STORE",customOpfsMessageId:r,bucketName:e,identifiers:t,datas:i};s.doOperation(o,i.map((e=>e.buffer)))}))},this.throttleDownload=function(){u++},this.stopThrottleDownload=function(){u--},this.opfsGet=function(e,t){return new Promise((i=>{const n=this._nextMessageId++;this._customOpfsCallbacks.set(n,i);const r={operation:"OPFS_CACHE_READ",customOpfsMessageId:n,bucketName:e,identifiers:t};s.doOperation(r)}))}}function tg(){return this._modelRefCount}Ba.prototype.apply(eg.prototype);let ig=!1;function ng(e,t){t?t.setGeomRefCount(this,e):(ig||(console.warn("geometry_setModelRefCount: geomCache is not defined"),ig=!0),this._modelRefCount=1)}function rg(e,t){this.min.x=e[t],this.min.y=e[t+1],this.min.z=e[t+2],this.max.x=e[t+3],this.max.y=e[t+4],this.max.z=e[t+5]}function og(e,t){e[t]=this.min.x,e[t+1]=this.min.y,e[t+2]=this.min.z,e[t+3]=this.max.x,e[t+4]=this.max.y,e[t+5]=this.max.z}function sg(e,t){var i=e[1]<<8|e[0];i||(i=28),this.boxStride=i/4,this.count=e.byteLength/i-1;let n=t.globalOffset||{x:0,y:0,z:0},r=t.fragmentTransformsOffset||{x:0,y:0,z:0};if(this.count){this.boxes=new Float32Array(e.buffer,i),this.flags=new Int32Array(e.buffer,i);var o=this.boxes;if(t.placementTransform){var s=new yc,a=0;for(let e=0;e<this.count;e++,a+=this.boxStride)rg.call(s,o,a),s.min.x+=r.x,s.min.y+=r.y,s.min.z+=r.z,s.max.x+=r.x,s.max.y+=r.y,s.max.z+=r.z,s.applyMatrix4(t.placementWithOffset),og.call(s,o,a)}else{var l=r.x-n.x,c=r.y-n.y,u=r.z-n.z;for(let e=0,t=0;e<this.count;e++,t+=this.boxStride)o[t]+=l,o[t+1]+=c,o[t+2]+=u,o[t+3]+=l,o[t+4]+=c,o[t+5]+=u}}else this.boxes=new Float32Array(0),this.flags=new Int32Array(0);this.hasPolygonCounts=!0,this.wantSort=!!t.wantSort}sg.prototype.getCount=function(){return this.count},sg.prototype.isTransparent=function(e){return!!(16777216&this.flags[e*this.boxStride+6])},sg.prototype.getPolygonCount=function(e){return 16777215&this.flags[e*this.boxStride+6]};const ag=new g.Box3;class lg{static _buildNotCondition(e){const t=this._parse(e);return(e,i)=>!t(e,i)}static _buildOrCondition(e){const t=new Array;if(e instanceof Array)for(let i=0;i<e.length;++i)t.push(this._parse(e[i]));return(e,i)=>{for(const n of t)if(n(e,i))return!0;return!1}}static _buildAndCondition(e){const t=new Array;if(e instanceof Array)for(let i=0;i<e.length;++i)t.push(this._parse(e[i]));return(e,i)=>{let n=!0;for(const r of t)n&=r(e,i);return n}}static _buildEnclosesClause(e){const t=e[0];let i;for(i in t)break;const n=new g.Box3;[n.min.x,n.min.y,n.min.z,n.max.x,n.max.y,n.max.z]=t[i];const r=e.length>1&&"number"==typeof e[2]?e[2]:1e-8;return 0!==r&&n.expandByScalar(r),(e,t)=>(e.getFragmentList().getWorldBounds(t,ag),n.containsBox(ag))}static _buildIntersectsClause(e){const t=e[0];let i;for(i in t)break;const n=new g.Box3;return[n.min.x,n.min.y,n.min.z,n.max.x,n.max.y,n.max.z]=t[i],(e,t)=>(e.getFragmentList().getWorldBounds(t,ag),n.intersectsBox(ag))}static _buildExtentClause(e){return(t,i)=>{const n=new g.Box3;t.getFragmentList().getWorldBounds(i,n);const r=new g.Vector3;n.getSize(r);return r.x*r.y*r.z>e}}static _parse(e){let t;for(t in e)break;switch(t){case"$not":return this._buildNotCondition(e[t]);case"$or":return this._buildOrCondition(e[t]);case"$and":return this._buildAndCondition(e[t]);case"$encloses":return this._buildEnclosesClause(e[t]);case"$intersects":return this._buildIntersectsClause(e[t]);case"$extent":return this._buildExtentClause(e[t]);default:return void console.warn("Spatial Query Parser: condition type not supported, given",t)}}static parse(e){return this._parse(e)}}class cg{_source;_predicate;static validate(e){return!0}fromString(e){if(this._source!==e){if(this._predicate=void 0,void 0!==e&&0!==e.length)return cg.validate(e)?void(this._source=e):(console.warn("Validation of spatial query failed, given:",e),void(this._source=void 0));this._source=void 0}}fromObject(e){if(void 0===e||0===Object.keys(e).length)return this._source=void 0,void(this._predicate=void 0);const t=JSON.stringify(e);this.fromString(t)}isEmpty(){return void 0===this._source}isReady(){return!!this._predicate}initialize(){if(this.isEmpty()||this.isReady())return;const e=JSON.parse(this._source,((e,t)=>"number"==typeof t?parseFloat(t):t));this._predicate=lg.parse(e)}get isFragmentPassing(){return this._predicate}}const ug=/(?<quote>["'])\?(.*?)\k<quote>/g;class hg{_source;_fragmentIDs;_extension;_initializing=!1;static validate(e){return!0}static async preprocessAttributeLookups(e,t,i){const n=await e.getAttributeDefinitions(t)||new Array,r=i.matchAll(ug);for(const e of r){const t=e[2].trim();let r=n.filter((e=>e.name===t)).map((t=>`${e[0][0]}s.props.${t.propertyHash}${e[0][0]}`));if(1===r.length)i=i.replace(e[0],r[0]);else console.error(`Expected unique property from hash lookup, found ${r.length}, given`,e[2]),i=i.replace(e[0],'"s.props.unresolved"')}return i}fromString(e){if(this._source!==e){if(this._fragmentIDs=void 0,void 0!==e&&0!==e.length)return hg.validate(e)?void(this._source=e):(console.warn("Validation of property query failed, given:",e),void(this._source=void 0));this._source=void 0}}fromObject(e){if(void 0===e||0===Object.keys(e).length)return this._source=void 0,void(this._fragmentIDs=void 0);const t=JSON.stringify(e);this.fromString(t)}fromDbIDs(e,t){if(void 0===e||void 0===t)return void(this._fragmentIDs=void 0);const i=e.getInstanceTree(),n=new Array;t.forEach((e=>i.enumNodeFragments(e,(e=>{n.push(e)}),!0))),this._fragmentIDs=new Set(n)}isEmpty(){return void 0===this._source}isReady(){return!!this._fragmentIDs}isInitializing(){return this._initializing}async initialize(e){var t;if(this.isEmpty()||this.isReady())return;if(this._initializing=!0,void 0===this._extension){const t=e.loader.viewer3DImpl.api;this._extension=await t.loadExtension("Autodesk.Filter")}if(void 0===this._extension)return void console.warn("Expected loading Autodesk.Filter extension to succeed.");const i=await hg.preprocessAttributeLookups(this._extension,e,this._source),n=JSON.parse(i,((e,t)=>"number"==typeof t?parseFloat(t):t)),r=await this._extension.getModelIdsWithFilter(e,n,void 0,void 0,!1),o=null===(t=r.ids)||void 0===t?void 0:t.concat(r.ids2??[]);this.fromDbIDs(e,o),this._initializing=!1}isFragmentPassing(e,t){return this._fragmentIDs.has(t)}}class dg{_asyncInit;_match;_initializing=!1;_initialized=!1;fromObjects(e,t){this._asyncInit===e&&this._match===t||(this._asyncInit=e,this._match=t,this._initialized=!1)}isEmpty(){return void 0===this._match}isReady(){return!(void 0!==this._asyncInit)||!this._initializing&&this._initialized}needsInitializing(){return!(void 0!==this._asyncInit&&(this._initializing||this._initialized))}isInitializing(){return this._initializing}async initialize(e){if(!this.needsInitializing())return;this._initializing=!0;const t=e.loader.viewer3DImpl.api;await this._asyncInit(e,t),this._initializing=!1,this._initialized=!0}isFragmentPassing(e,t){return this._match(e,t)}}const fg=Object.freeze({FRAGMENT_LIST_READY:1,BOUNDING_VOLUME_HIERARCHY_READY:2,PROPERTIES_READY:4}),pg=Object.freeze({ON_FRAGMENT_READY:"immediate",ON_FRAGMENT_LIST_READY:"fast",ON_BOUNDING_VOLUME_HIERARCHY_READY:"exact"}),mg=pg.ON_BOUNDING_VOLUME_HIERARCHY_READY,gg=Object.freeze({ANY:0,ALL:1}),vg=gg.ALL;class yg{_model;_rootCondition=vg;_active=!1;_spatialQuery=new cg;_spatialQueryLoadTimeBehavior=mg;_propertyQuery=new hg;_lambdaQuery=new dg;_state=0;constructor(e){this.evaluate=e,this._state=0,this._isFragmentPassingImpl=this._isFragmentPassing_true}onModelRootReady(e){this._model=e}onFragmentReady(e){this._isFragmentPassingImpl===this._isFragmentPassing_spatial&&this.evaluate(e)}onFragmentListReady(){this.update(fg.FRAGMENT_LIST_READY)}onBoundingVolumeHierarchyReady(){this.update(fg.BOUNDING_VOLUME_HIERARCHY_READY)}onPropertiesReady(){this.update(fg.PROPERTIES_READY)}setRootCondition(e){void 0!==e&&this._rootCondition!==e&&(this._rootCondition=e)}setSpatialQueryBehavior(e){void 0!==e&&this._spatialQueryLoadTimeBehavior!==e&&(this._spatialQueryLoadTimeBehavior=e)}setSpatialQuery(e){this._spatialQuery.fromObject(e),this._active||=!this._spatialQuery.isEmpty()}setPropertyQuery(e){this._propertyQuery.fromObject(e),this._active||=!this._propertyQuery.isEmpty()}setLambdaQuery(e,t){this._lambdaQuery.fromObjects(e,t),this._active||=!this._lambdaQuery.isEmpty()}prepare(e){var t,i,n,r,o,s;this.setSpatialQuery(null===(t=e.filter)||void 0===t?void 0:t.spatial_query),this.setPropertyQuery(null===(i=e.filter)||void 0===i?void 0:i.property_query),this.setLambdaQuery(null===(n=e.filter)||void 0===n?void 0:n.asyncInit,null===(r=e.filter)||void 0===r?void 0:r.match);switch(null===(o=e.filter)||void 0===o?void 0:o.root_condition){case"or":this.setRootCondition(gg.ANY);break;case"and":this.setRootCondition(gg.ALL);break;default:this.setRootCondition(vg)}const a=null===(s=e.filter)||void 0===s?void 0:s.spatial_behavior;switch(a){case pg.ON_FRAGMENT_READY:case pg.ON_FRAGMENT_LIST_READY:case pg.ON_BOUNDING_VOLUME_HIERARCHY_READY:this.setSpatialQueryBehavior(a);break;default:this.setSpatialQueryBehavior(mg)}const l=!this._spatialQuery.isEmpty(),c=this._propertyQuery.isEmpty(),u=this._rootCondition===gg.ANY||c,h=this._spatialQueryLoadTimeBehavior===pg.ON_FRAGMENT_READY;l&&h&&u&&(this._spatialQuery.initialize(),this._isFragmentPassingImpl=this._isFragmentPassing_spatial)}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&this._state&e)return;this._state|=e;if(this._spatialQuery.isEmpty()&&this._propertyQuery.isEmpty()&&this._lambdaQuery.isEmpty()){if(this._isFragmentPassingImpl=this._isFragmentPassing_true,!this._active)return;return void this.evaluate()}this._state|=void 0!==e?e:0;const i=!this._lambdaQuery.isEmpty(),n=!this._lambdaQuery.needsInitializing()||!!(this._state&fg.FRAGMENT_LIST_READY);let r=!i;switch(this._spatialQueryLoadTimeBehavior){case pg.ON_FRAGMENT_READY:r&&=!0;break;case pg.ON_FRAGMENT_LIST_READY:r&&=!!(this._state&fg.FRAGMENT_LIST_READY);break;case pg.ON_BOUNDING_VOLUME_HIERARCHY_READY:r&&=!!(this._state&fg.BOUNDING_VOLUME_HIERARCHY_READY)}const o=!i&&!!(this._state&fg.FRAGMENT_LIST_READY)&&!!(this._state&fg.PROPERTIES_READY),s=!this._spatialQuery.isEmpty();s&&r&&!this._spatialQuery.isReady()?(this._spatialQuery.initialize(),t=!0):!s||i||r||(t=!1);const a=!this._propertyQuery.isEmpty();if(a&&o&&!this._propertyQuery.isReady()&&!this._propertyQuery.isInitializing()){const e=this;return void this._propertyQuery.initialize(this._model).then((()=>e.update(void 0,!0)))}if(!a||i||o&&!this._propertyQuery.isInitializing()||(t=!1),i&&n&&!this._lambdaQuery.isReady()&&!this._lambdaQuery.isInitializing()){const e=this;return void this._lambdaQuery.initialize(this._model).catch((e=>{rt.warn("Filter initialization failed, falling back to load the whole model",e),this.setLambdaQuery(void 0)})).then((()=>e.update(void 0,!0)))}if(i&&n&&this._lambdaQuery.isReady())console.warn("Lambda queries are currently disabled."),this._isFragmentPassingImpl=this._isFragmentPassing_lambda,t=!0;else{const e=s&&r&&this._spatialQuery.isReady(),t=a&&o&&this._propertyQuery.isReady();switch(this._rootCondition|s<<1|e<<2|a<<3|t<<4){case 6:case 14:case 7:this._isFragmentPassingImpl=this._isFragmentPassing_spatial;break;case 24:case 26:case 25:this._isFragmentPassingImpl=this._isFragmentPassing_property;break;case 30:this._isFragmentPassingImpl=this._isFragmentPassing_any;break;case 31:this._isFragmentPassingImpl=this._isFragmentPassing_all;break;default:this._isFragmentPassingImpl=this._isFragmentPassing_false}}this._isFragmentPassingImpl!==this._isFragmentPassing_false&&t&&this.evaluate()}evaluate(){throw new TypeError("Method expected to be replaced.")}_isFragmentPassing_true(){return!0}_isFragmentPassing_false(){return!1}_isFragmentPassing_spatial(e){return this._spatialQuery.isFragmentPassing(this._model,e)}_isFragmentPassing_property(e){return this._propertyQuery.isFragmentPassing(this._model,e)}_isFragmentPassing_all(e){return this._spatialQuery.isFragmentPassing(this._model,e)&&this._propertyQuery.isFragmentPassing(this._model,e)}_isFragmentPassing_any(e){return this._spatialQuery.isFragmentPassing(this._model,e)||this._propertyQuery.isFragmentPassing(this._model,e)}_isFragmentPassing_lambda(e){return this._lambdaQuery.isFragmentPassing(this._model,e)}_isFragmentPassingImpl(e){throw new TypeError("This method must be set to a specific evaluation.")}isFragmentPassing(e){if(this._isFragmentPassingImpl===this._isFragmentPassing_true||this._isFragmentPassingImpl===this._isFragmentPassing_false||this._isFragmentPassingImpl===this._isFragmentPassing_lambda)return this._isFragmentPassingImpl(e);return this._isFragmentPassingImpl(e)}get isActive(){return this._active}}const bg=Autodesk.Viewing,xg=Autodesk.Viewing.Private;function _g(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new al,this.tmpBox=new yc,this.logger=rt,this.loadTime=0,this.pendingMaterials=new Map,this.pendingMeshes=new Array,this.pendingMeshesBvh=new Array,this.pendingRequests=0,this.operationsDone=0,this.viewpointMatHashes=new Set,this.notifiesFirstPixel=!0,this._selectiveLoadingController=new yg(_g.prototype.evaluate.bind(this)),this._lineageUrn=null,this._notLoadedGeomHashes={},this.loadFromCache=!1,this.consolidationMapLoadedFromCache=!1,this._extraMaterialHashesLoadedFromCache=!1}function Eg(e){var t="",i=e.lastIndexOf("/");return-1!=i&&(t=e.substr(0,i+1)),t}function Sg(e){return e.acmSessionId?"acmsession="+e.acmSessionId:""}function Ag(e,t,i){var n={basePath:t,objectIds:e.ids,globalOffset:e.globalOffset,fragmentTransformsDouble:e.fragmentTransformsDouble,placementTransform:e.placementTransform,applyRefPoint:e.applyRefPoint,queryParams:i,bvhOptions:e.bvhOptions||{isWeakDevice:F()},applyScaling:e.applyScaling,applyPlacementInModelUnits:e.applyPlacementInModelUnits,loadInstanceTree:e.loadInstanceTree};return Fe(n)}function wg(e){return Math.floor(100*e.fragsLoaded/e.metadata.stats.num_fragments)}_g.prototype.dtor=function(){this.bvhWorker&&(this.bvhWorker.terminate(),this.bvhWorker=null,rt.debug("SVF loader dtor: on svf worker.")),this.svf&&(this.svf.loadDone||console.log("stopping load before it was complete"),this.svf.abort(),this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null)),this.viewer3DImpl.geomCache()&&this.model&&(this.loading&&this.viewer3DImpl.geomCache().cancelRequests(this.svf.geomMetadata.hashToIndex.keys()),this.pendingRequests=0,this.removeMeshReceiveListener()),this.consolidationEventHandler&&(this.viewer3DImpl.api.removeEventListener(cm,this.consolidationEventHandler),this.consolidationEventHandler=null),this.viewer3DImpl=null,this.model=null,this.svf=null,this.logger=null,this.tmpMatrix=null,this.loading=!1,this.loadTime=0},_g.prototype.isValid=function(){return null!=this.viewer3DImpl},_g.prototype.removeMeshReceiveListener=function(){this.meshReceivedListener&&(this.viewer3DImpl.geomCache().loaderRemoved(this),this.viewer3DImpl.geomCache().removeEventListener(Fm,this.meshReceivedListener),this.viewer3DImpl.geomCache().removeEventListener(Vm,this.meshFailedListener),this.viewer3DImpl.geomCache().removeEventListener(Gm,this.materialReceiveListener),this.viewer3DImpl.geomCache().removeEventListener(zm,this.materialReceiveListener),this.meshReceivedListener=null,this.meshFailedListener=null)},_g.prototype.loadFile=function(e,t,i,n){if(!this.viewer3DImpl)return rt.log("SVF loader was already destructed. So no longer usable."),!1;if(this.viewer3DImpl._signalNoMeshes(),this.loading)return rt.log("Loading of SVF already in progress. Ignoring new request."),!1;if(this.loading=!0,t.acmSessionId)this.svfUrn=t.acmSessionId.split(",")[0];else{console.warn("DEPRECATED: Automatic derivation of URN will be removed in a future release. Please set the acmSessionId parameter when loading OTG data.");var r=e.indexOf(kp);if(-1===r&&(r=e.indexOf(Fp)),-1!==r){var o=e.split("/"),s=o[1]+"?version="+o[2],a=bg.toUrlSafeBase64(s);this.svfUrn=a}}return this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.basePath=Eg(e),this.acmSessionId=t.acmSessionId,this.options=t,this.queryParams=Sg(t),this.loadContext=Ag(t,this.basePath,this.queryParams),this.loadContext.raiseError=function(e,t,n){i&&i({code:e,msg:t,args:n})},this.loadContext.onFailureCallback=ei.defaultFailureCallback.bind(this.loadContext),(this.viewer3DImpl.isWebGPU()||fn)&&(this.loadContext.buildDbId2FragIdMap=!0),this._selectiveLoadingController.prepare(t),this.loadModelRoot(this.loadContext,i),n&&n(),!0},_g.prototype._requestRepaint=function(){var e;null!==(e=this.viewer3DImpl)&&void 0!==e&&e.modelVisible(this.model.id)&&this.viewer3DImpl.api.dispatchEvent({type:bg.LOADER_REPAINT_REQUEST_EVENT,loader:this,model:this.model})},_g.prototype.loadModelRoot=async function(e,t){var i;this.t0=(new Date).getTime(),this.firstPixelTimestamp=null;var n=this,r=this.svf=new Vp;r.basePath=e.basePath,e.onLoaderEvent=function(e,i){if(n.svf)if("otg_root"===e){n.onModelRootLoadDone(r),t&&t(null,n.model);const e=n.viewer3DImpl.geomCache();e.modelAdded(n.options.acmSessionId,n._lineageUrn),n.meshReceivedListener=e=>n.onMeshReceived(e.geom),n.meshFailedListener=e=>n.onMeshError(e.hash),e.addEventListener(Fm,n.meshReceivedListener),e.addEventListener(Vm,n.meshFailedListener),n.materialReceiveListener=e=>n.onMaterialLoaded(e.material,e.hash),e.addEventListener(Gm,n.materialReceiveListener),e.addEventListener(zm,n.materialReceiveListener),n.svf.loadDone=!1}else if("fragment"===e){if(!n.options.skipMeshLoad){const e=i;n._selectiveLoadingController.isActive?n._selectiveLoadingController.onFragmentReady(e):n.tryToActivateFragment(e,"fragment")}n.options.onFragmentListLoadProgress&&n.trackFragmentListLoadProgress()}else"all_fragments"===e?(n.options.skipPropertyDb||(n.loadPropertyDb(),n._selectiveLoadingController.onPropertiesReady()),n.fragmentDataLoaded=!0,n._selectiveLoadingController.onFragmentListReady(),n.viewer3DImpl.api.fireEvent({type:Hn,svf:r,model:n.model}),n.options.skipMeshLoad||!n.svf.fragments.length?n.onGeomLoadDone():n.onOperationComplete(),n.loadFromCache&&n.model.boxesLoadingDone(),Ji&&n.tryEarlyConsolidation()):"viewpointData"===e&&(n.svf.needExtraMaterials?n.tryToLoadExtraMaterials():n.onOperationComplete(),n.svf.viewpointTreeRoot&&n.options.addViews&&n.options.addViews(n.svf.viewpointTreeRoot,n.model));else console.error("load callback called after load was aborted")},e.onOperationComplete=function(){n.onOperationComplete()};const o=this.viewer3DImpl.geomCache();o.loaderAdded(n);const s=this.svf.loadMetadata(this.loadContext,ni(this.currentLoadPath));this.svf.initializeDbIdFilter(this.loadContext.objectIds),(!on||null!==(i=this.options)&&void 0!==i&&i.disableCache||this._selectiveLoadingController.isActive||(await this.tryLoadFromCache(e,s),null!==n.svf))&&(this.loadFromCache||(this.svf.loadData(this.loadContext),Ji&&o.throttleDownload(),await s,null!==n.svf&&n.makeBVHInWorker()))},_g.prototype.tryLoadFromCache=async function(e,t){this.hlodCacheIdentifier=this.getHLODCacheIdentifier();if(this.hlodCacheBucket="hlod_cache_v3_"+Autodesk.Viewing.fromUrlSafeBase64(this.options.bubbleNode.getRootNode().urn()),this.fragListHashIdentifier=new Uint8Array(await Xe("SHA-1",`${this.hlodCacheIdentifier}_frag_list`)),!this.getHLODCachedFlag())return void(this.loadFromCache=!1);const i=await this.getCachedBVH();if(!i)return this.setHLODCachedFlag(!1),void(this.loadFromCache=!1);await t,this.setBVH(i),this.onOperationComplete(),this.model.getFragmentList().fragments.dontComputeBoxes=!0,this.svf.initializeGeometryHashList(20,1),this.svf.initializeMaterialHashList(20,1),this.loadFromCache=!0,this.getCachedFragList(e)},_g.prototype.makeBVHInWorker=function(){var e=this,t=Object.assign({},e.loadContext);if(t.operation="LOAD_OTG_BVH",t.raiseError=null,t.onFailureCallback=null,t.onLoaderEvent=null,t.onOperationComplete=null,t.fragments_extra=ni(e.basePath)+e.svf.manifest.assets.fragments_extra,t.placementTransform=e.svf.placementTransform,t.placementWithOffset=e.svf.placementWithOffset,t.fragmentTransformsOffset=e.svf.metadata.fragmentTransformsOffset,t.globalOffset=e.svf.globalOffset,rn&&(t.wantSort=!0),t.fragments_extra)if(rn&&Ji)this.svf.loadAsyncResource(e.loadContext,t.fragments_extra,"",(function(i){null!==e.svf&&(e.svf.extraFragInfo=new sg(i,t),e.tryEarlyConsolidation())}));else{e.bvhWorker=fi("OtgBvhWorker");e.bvhWorker.addEventListener("message",(function(t){if(null!==e.svf){console.log("Received BVH from worker");var i=new Nf(t.data.bvh.nodes,t.data.bvh.useLeanNodes,t.data.bvh.primitives,e.options.bvhOptions);e.model.setFragmentBoundingBoxes(t.data.boxes,t.data.boxStride),e.setBVH(i),e.bvhWorker.terminate(),e.bvhWorker=null,e.onOperationComplete()}})),e.bvhWorker.doOperation(t)}else e.onOperationComplete()},_g.prototype.setBVH=function(e){this.svf.bvh=e,this.model.setBVH(e),this._selectiveLoadingController.onBoundingVolumeHierarchyReady(),this._requestRepaint()},_g.prototype.getHLODCacheIdentifier=function(){var e;const t={bvhOptions:this.options.bvhOptions,placementWithOffset:this.options.placementWithOffset,placementTransform:null===(e=this.options.placementTransform)||void 0===e?void 0:e.elements,globalOffset:this.options.globalOffset,byteLimit:this.options.consolidationMemoryLimit||Wi,viewGuid:this.options.bubbleNode.guid()};return sn&&(t.webgpu=!0),JSON.stringify(t)},_g.prototype.getCachedBVH=async function(){const e=this.viewer3DImpl.geomCache(),t=(await e.opfsGet(this.hlodCacheBucket,[`${this.hlodCacheIdentifier}_bvh`]))[0];if(!t)return null;const i=new Uint32Array(t.buffer,0,3),n=i.byteLength,r=i[0],o=i[1],s=t.slice(n,r).buffer,a=new Int32Array(t.slice(r,r+o).buffer);return new Nf(s,!1,a,this.options.bvhOptions.consolidation)},_g.prototype.getCachedFragList=async function(e){var t;const i=this.viewer3DImpl.geomCache(),n=this.svf.materialHashes.byteStride,r=null===(t=await i.opfsGet(this.hlodCacheBucket,[`${this.hlodCacheIdentifier}_extra_material_hashes`]))||void 0===t?void 0:t[0];if(!r)throw new Error("Failed to read extra material hashes from cache");const o=new Uint32Array(r.buffer,0,r.length/4),s=o[0],a=4+n;let l=4;for(let e=0;e<s;e++){const e=o[l/4];let t=We(r,l+4,n);this.svf.extraMatHashes[e]=t,this.svf.materialHashes.hashes[e]=t,l+=a}this._extraMaterialHashesLoadedFromCache=!0,s>0&&this.tryToLoadExtraMaterials(),this.svf.cachedPolygonCounts=new Uint32Array(this.svf.metadata.stats.num_fragments);const c=this.model.getIterator(),u=c.getBVH(),h=km.getManagerForIterator(c,this.model)[0];let d=0;u.traverseBreadthFirst((t=>{h.addCallbackTask(t,(async()=>{const i=await this.loadCachedFragListChunk(t);i&&h.addCallbackTask(t,(()=>{this.parseFragListChunk(t,i,e),h.requestGeometryForNode(t),++d===u.nodes.nodeCount&&(this.model.boxesLoadingDone(),this.svf.postLoad(e,"geometry_ptrs"),this.svf.postLoad(e,"material_ptrs"),this.svf.postLoad(e,"all_fragments"),this.viewer3DImpl.geomCache().startProcessing())}),!0,!0)}),!0,!0)}))},_g.prototype.getCachedConsolidationMap=async function(){if(this.consolidationMapLoadedFromCache)return;const e=this.viewer3DImpl.geomCache(),t=(await e.opfsGet(this.hlodCacheBucket,[`${this.hlodCacheIdentifier}_consolidation_map`]))[0];t&&(this.model.setCachedConsolidationBlob(t),this.consolidationMapLoadedFromCache=!0)},_g.prototype.cacheBVH=async function(){const e=this.viewer3DImpl.geomCache();const t=this.model.getIterator().getBVH(),i=12+t.nodes.nodesRaw.byteLength,n=new Uint8Array(i+t.primitives.byteLength),r=new Uint32Array(n.buffer);return r[0]=i,r[1]=t.primitives.buffer.byteLength,n.set(new Uint8Array(t.nodes.nodesRaw),12),n.set(Qv(t.primitives),i),e.opfsStore(this.hlodCacheBucket,[`${this.hlodCacheIdentifier}_bvh`],[n])},_g.prototype.cacheFragList=async function(){const e=this.viewer3DImpl.geomCache(),t=this.model.getIterator().getBVH(),i=t.nodes,n=t.primitives,r=this.model.getFragmentList().fragments,o=this.svf.geomMetadata.byteStride,s=this.svf.materialHashes.byteStride,a=new Uint8Array(this.fragListHashIdentifier),l=new Uint16Array(a.buffer),c=new Uint32Array(a.buffer),u=[],h=[],d=Object.keys(this.svf.extraMatHashes??{}).length,f=new Uint8Array(d*(s+4)+4),p=new Uint32Array(f.buffer),m=4+s;p[0]=d;let g=Object.keys(this.svf.extraMatHashes),v=4;for(let e=0;e<d;e++)p[v/4]=g[e],Ke(this.svf.extraMatHashes[g[e]],f,v+4),v+=m;return u.push(`${this.hlodCacheIdentifier}_extra_material_hashes`),h.push(f),t.traverseBreadthFirst((e=>{const t=i.getPrimStart(e),a=i.getPrimCount(e),d=4*a,f=new ArrayBuffer(23*d+a*o+a*s),p=new Uint32Array(f,0,a),m=new Uint32Array(f,d,a),g=new Uint32Array(f,2*d,a),v=new Uint32Array(f,3*d,a),y=new Float32Array(f,4*d,6*a),b=new Float32Array(f,10*d,12*a),x=new Uint32Array(f,22*d,a),_=new Uint8Array(f,23*d,a*o),E=new Uint8Array(f,23*d+a*o,a*s);for(let e=0;e<a;e++){const i=n[t+e];p[e]=r.fragId2dbId[i],m[e]=r.geomDataIndexes[i],g[e]=r.materials[i],v[e]=r.visibilityFlags[i]&ll.MESH_NOT_FOR_DISPLAY,x[e]=this.svf.extraFragInfo.getPolygonCount(i);for(let t=0;t<6;t++)y[6*e+t]=r.boxes[6*i+t];for(let t=0;t<12;t++)b[12*e+t]=r.transforms[12*i+t];const a=m[e];if(0!==a){var S;Ke((null===(S=this.model.getGeometryList().getGeometry(a))||void 0===S?void 0:S.hash)??this.svf.getGeometryHash(a)??this._notLoadedGeomHashes[a],_,e*o)}Ke(this.svf.materialHashes.hashes[g[e]],E,e*s)}c[4]=e,u.push(je(l)),h.push(new Uint8Array(f))})),e.opfsStore(this.hlodCacheBucket,u,h)},_g.prototype.loadCachedFragListChunk=async function(e){const t=this.model.loader.viewer3DImpl.geomCache(),i=new Uint8Array(this.fragListHashIdentifier),n=new Uint16Array(i.buffer);return new Uint32Array(i.buffer)[4]=e,(await t.opfsGet(this.hlodCacheBucket,[je(n)],!0))[0]},_g.prototype.parseFragListChunk=function(e,t,i){const n=this.model,r=n.loader.svf,o=n.getFragmentList().fragments,s=r.geomMetadata.byteStride,a=r.materialHashes.byteStride,l=n.getIterator().getBVH(),c=l.nodes,u=l.primitives,h=c.getPrimStart(e),d=c.getPrimCount(e),f=4*d,p={fragId2dbId:new Uint32Array(t.buffer,0,d),geomDataIndexes:new Uint32Array(t.buffer,f,d),materials:new Uint32Array(t.buffer,2*f,d),flags:new Uint32Array(t.buffer,3*f,d),boxes:new Float32Array(t.buffer,4*f,6*d),transforms:new Float32Array(t.buffer,10*f,12*d),polygonCounts:new Uint32Array(t.buffer,22*f,d),geometryHashes:new Uint8Array(t.buffer,23*f,d*s),materialHashes:new Uint8Array(t.buffer,23*f+d*s,d*a)};for(let e=0;e<d;e++){const t=u[h+e];o.fragId2dbId[t]=p.fragId2dbId[e],o.geomDataIndexes[t]=p.geomDataIndexes[e],o.materials[t]=p.materials[e],r.cachedPolygonCounts[t]=p.polygonCounts[e],p.flags[e]&ll.MESH_NOT_FOR_DISPLAY&&(o.visibilityFlags[t]|=ll.MESH_NOT_FOR_DISPLAY,o.visibilityFlags[t]&=~ll.MESH_VISIBLE);for(let i=0;i<6;i++)o.boxes[6*t+i]=p.boxes[6*e+i];for(let i=0;i<12;i++)o.transforms[12*t+i]=p.transforms[12*e+i];r.geomMetadata.hashes[o.geomDataIndexes[t]]||(r.geomMetadata.hashes[o.geomDataIndexes[t]]=We(p.geometryHashes,e*s,s)),r.materialHashes.hashes[o.materials[t]]||(r.materialHashes.hashes[o.materials[t]]=We(p.materialHashes,e*a,a)),this.loadContext.buildDbId2FragIdMap&&r.addDbIdReference(t,o.fragId2dbId[t]),i.onLoaderEvent("fragment",t),this.svf.fragments.numLoaded++}},_g.prototype.cacheConsolidationMap=async function(){const e=this.model.getConsolidationBlobForCaching();if(!e)return;return this.viewer3DImpl.geomCache().opfsStore(this.hlodCacheBucket,[`${this.hlodCacheIdentifier}_consolidation_map`],[e])},_g.prototype.setHLODCachedFlag=function(e){const t=this.hlodCacheBucket+this.hlodCacheIdentifier;Rs.setItem(t,e)},_g.prototype.getHLODCachedFlag=function(){const e=this.hlodCacheBucket+this.hlodCacheIdentifier;return JSON.parse(Rs.getItem(e))},_g.prototype.tryToActivateFragment=function(e,t){var i=this.svf,n=this.model;if(!n)return;var r=i.fragments.geomDataIndexes[e];if(i.dbIdFilter&&!i.dbIdFilter[i.fragments.fragId2dbId[e]]||this._selectiveLoadingController.isActive&&!this._selectiveLoadingController.isFragmentPassing(e)||i.loadOptions.skipHiddenFragments&&i.fragments.visibilityFlags[e]&ll.MESH_NOT_FOR_DISPLAY)return n.getFragmentList().setFlagFragment(e,ll.MESH_NOTLOADED,!0),n.getFragmentList().setFragOff(e,!0),this.trackGeomLoadProgress(i,e,!1),void(this._notLoadedGeomHashes[r]=this.svf.getGeometryHash(r));var o=!1,s=null,a=i.fragments.materials[e],l=i.getMaterialHash(a);if(null!==l?null===(s=this.findOrLoadMaterial(n,l))?("fragment"===t&&(this.pendingMaterials.get(l).push(e),this.pendingRequests++),"material"!==t&&(o=!0)):"fragment"===t&&this.viewer3DImpl.matman()._addMaterialRef(s,this.model.id):console.warn("Material hash is null for fragment ",e),0!==r){var c=n.getGeometryList().getGeometry(r);if(c?"fragment"===t&&n.getGeometryList().addInstance(r):("fragment"===t&&this.loadGeometry(r,e),o=!0),!o){n.getFragmentList().getOriginalWorldMatrix(e,this.tmpMatrix);var u=this.viewer3DImpl.setupMesh(n,c,l,this.tmpMatrix);n.activateFragment(e,u,!!i.placementTransform),this.viewer3DImpl.geomCache().updateGeomImportance(n,e),this.trackGeomLoadProgress(i,e,!1)}}else(s||"material"===t)&&this.trackGeomLoadProgress(i,e,!1)},_g.prototype.tryToLoadExtraMaterials=function(){if(this.loadFromCache&&!this._extraMaterialHashesLoadedFromCache)return;var e=this.svf,t=this.model;if(!t)return;if(e.extraMaterialLoaded)return;e.extraMaterialLoaded=!0;let i=!0;for(const n of Object.values(e.extraMatHashes)){this.findOrLoadMaterial(t,n)||(this.viewpointMatHashes.add(n),i=!1)}i&&this.onOperationComplete()},_g.prototype.onModelRootLoadDone=function(e){var t;e.isOTG=!0,e.geomMetadata.hashToIndex=new Map,e.failedFrags={},e.failedMeshes={},e.failedMaterials={},e.fragsLoaded=0,e.fragsLoadedNoGeom=0,e.nextRepaintPolys=0,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=this.basePath,e.loadOptions=this.options||{};var i=Date.now();rt.log("SVF load: "+(i-this.t0));var n=this.model=new Dy(e);n.loader=this,n.initialize(),this._selectiveLoadingController.onModelRootReady(n),this.t1=i,rt.log("scene bounds: "+JSON.stringify(e.bbox));var r={category:"metadata_load_stats",urn:e.urn,has_topology:!!e.topology,has_animations:!!e.animations,materials:e.metadata.stats.num_materials,is_mobile:F()};rt.track(r),this.viewer3DImpl.signalProgress(5,Gp.ROOT_LOADED,this.model),e.handleHashListRequestFailures(this.loadContext),e.propDbLoader=new rp(this.sharedDbPath,this.model,this.viewer3DImpl.api),this._lineageUrn=null===(t=n.getDocumentNode())||void 0===t?void 0:t.lineageUrn(),this._lineageUrn||(this._lineageUrn=Oa.parseLineageUrnFromDecodedUrn(Autodesk.Viewing.fromUrlSafeBase64(e.urn)))},_g.prototype.trackGeomLoadProgress=function(e,t,i){if(i){if(e.failedFrags[t])return void console.log("Double fail",t);e.failedFrags[t]=1}var n=wg(e);e.fragsLoaded++;var r=wg(e);r>n&&this.viewer3DImpl.signalProgress(r,Gp.LOADING,this.model),this.model.getGeometryList().geomPolyCount>e.nextRepaintPolys&&(this.firstPixelTimestamp||(this.firstPixelTimestamp=Date.now()),e.numRepaints++,e.nextRepaintPolys+=1e5*Math.pow(1.5,e.numRepaints),this._requestRepaint()),e.fragsLoaded===e.metadata.stats.num_fragments&&this.onOperationComplete(),this.trackOnDemandLoadProgress()},_g.prototype.trackFragmentListLoadProgress=function(){var e=this.svf;function t(e){return Math.floor(100*e.fragsLoadedNoGeom/e.metadata.stats.num_fragments)}var i=t(e);e.fragsLoadedNoGeom++;var n=t(e);n>i&&this.options.onFragmentListLoadProgress(this.model,n)},_g.prototype.onOperationComplete=function(){this.operationsDone++,4===this.operationsDone&&this.onGeomLoadDone()},_g.prototype.onMaterialLoaded=function(e,t,i){if(this.loading){var n=this.pendingMaterials.get(t);if(n){var r=this.viewer3DImpl.matman();if(e){e.hash=t;try{var o=r.convertSharedMaterial(this.model,e,t);Hu.loadMaterialTextures(this.model,o,this.viewer3DImpl),r.hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0)}catch(e){this.svf.failedMaterials[t]=1}}else this.svf.failedMaterials[t]=1;this.pendingMaterials.delete(t);for(var s=0;s<n.length;s++)this.pendingRequests--,this.tryToActivateFragment(n[s],"material");this.viewer3DImpl._signalNewMaterialAdded(e,this.model),this.viewpointMatHashes.has(t)&&(this.viewpointMatHashes.delete(t),0===this.viewpointMatHashes.size&&this.onOperationComplete())}}},_g.prototype.findOrLoadMaterial=function(e,t){if(!t)return console.error("findOrLoadMaterial called with invalid material hash (null)."),null;if(this.pendingMaterials.has(t))return null;var i=this.svf,n=this.viewer3DImpl.matman().findMaterial(e,t);if(n)return n;this.pendingMaterials.set(t,[]);var r=i.makeSharedResourcePath(this.loadContext.otg_cdn,"materials",t);return this.viewer3DImpl.geomCache().requestMaterial(r,void 0,t,void 0,this.queryParams,this._lineageUrn),null},_g.prototype.loadGeometry=function(e,t){var i=this.svf;++this.pendingRequests;var n=this.pendingMeshes[e];if(n)return void n.push(t);this.pendingMeshes[e]=[t];var r=i.getGeometryHash(e);i.geomMetadata.hashToIndex.set(r,e);let o=!(this.loadFromCache&&this.pendingRequests>1e3);var s=i.makeSharedResourcePath(this.loadContext.otg_cdn,"geometry",r);this.viewer3DImpl.geomCache().requestGeometry(s,void 0,r,void 0,this.queryParams,this._lineageUrn,o)},_g.prototype.onMeshError=function(e){this.svf.failedMeshes[e]=1;var t=this.svf.geomMetadata.hashToIndex.get(e),i=this.pendingMeshes[t];if(i){for(var n=0;n<i.length;n++)this.trackGeomLoadProgress(this.svf,i[n],!0),this.pendingRequests--;this.svf.geomMetadata.hashToIndex.delete(e),this.pendingMeshes[t]=null}},_g.prototype.onMeshReceived=function(e){var t=this.model;if(t){var i=t.getGeometryList(),n=this.svf.geomMetadata.hashToIndex.get(e.hash);if(void 0!==n){var r=i.hasGeometry(n),o=this.pendingMeshes[n];if(!r){if(i.addGeometry(e,o&&o.length||1,n,this.viewer3DImpl.geomCache()),!this.svf.loadDone||this.options.onDemandLoading||this._selectiveLoadingController.isActive||console.error("Geometry received after load was done"),this.svf.geomMetadata.hashToIndex.delete(e.hash),this.pendingMeshes[n]=null,o)for(var s=0;s<o.length;s++)this.pendingRequests--,this.tryToActivateFragment(o[s],"geom");this.viewer3DImpl.signalNewGeometryAdded(n,this.model)}}}else console.warn("Received geometry after loader was done. Possibly leaked event listener?",e.hash)},_g.prototype.onGeomLoadDone=async function(){var e;if(this.options.onDemandLoading||this._selectiveLoadingController.isActive||this.removeMeshReceiveListener(),this.svf.loadDone=!0,Hu.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipMeshLoad)return this.currentLoadPath=null,void this.viewer3DImpl.onLoadComplete(this.model);this.svf.fragments.entityIndexes=null,this.pendingMeshes=new Array,this.options.onDemandLoading||this._selectiveLoadingController.isActive||(this.svf.geomMetadata.hashes=null);var t=Date.now(),i="Fragments load time: "+(t-this.t1);this.loadTime=t-this.t0;var n=this.firstPixelTimestamp-this.t0;i+=" (first pixel time: "+n+")",rt.log(i),this.loadFromCache&&await this.getCachedConsolidationMap(),!Ji&&this.options.useConsolidation&&await this.viewer3DImpl.consolidateModel(this.model,this.options.consolidationMemoryLimit);var r={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.svf.metadata.stats.num_geoms,fragments_count:this.svf.metadata.stats.num_fragments,urn:this.svfUrn};n>0&&(r.first_pixel_time=n),rt.track(r,!0);const o=this.model.getGeometryList(),s={load_time:this.loadTime,polygons:o.geomPolyCount,fragments:this.model.getFragmentList().getCount(),mem_usage:o.gpuMeshMemory,time_to_first_pixel:n,viewable_type:"3d",url:this.currentLoadPath,urn:this.svfUrn,loaded_from_cache:this.loadFromCache};if(xg.analytics.track("viewer.model.loaded",s),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model),!this.loadFromCache&&on&&(null===(e=this.options)||void 0===e||!e.disableCache)&&!this._selectiveLoadingController.isActive){let e=async()=>{const e=[this.cacheBVH(),this.cacheFragList(),this.cacheConsolidationMap()];(await Promise.all(e)).every((e=>e))&&this.setHLODCachedFlag(!0)};this.model.isConsolidated()?e():(this.consolidationEventHandler=async t=>{t.model===this.model&&(e(),this.viewer3DImpl.api.removeEventListener(cm,this.consolidationEventHandler),this.consolidationEventHandler=null)},this.viewer3DImpl.api.addEventListener(cm,this.consolidationEventHandler))}},_g.prototype.loadPropertyDb=function(){this.svf.propDbLoader.load()},_g.prototype.is3d=function(){return!0},_g.loadOnlyOtgRoot=function(e,t){const i=Eg(e),n=Ag(t,i,Sg(t)),r=new Vp;r.basePath=i;const o=ni(e);return new Promise(((e,t)=>{n.onFailureCallback=()=>e(null),r.loadAsyncResource(n,o,"json",(function(t){r.metadata=t,r.manifest=t.manifest,r.numGeoms=r.metadata.stats.num_geoms,r.processMetadata(n),e(r)}))}))},_g.prototype.tryEarlyConsolidation=async function(){if(this.loadFromCache)await this.getCachedConsolidationMap(),await this.viewer3DImpl._consolidateModelInternal(this.model),this.viewer3DImpl.invalidate(!0,!0,!0);else if(this.fragmentDataLoaded&&this.svf.extraFragInfo){this.viewer3DImpl.geomCache().stopThrottleDownload(),this.model.setFragmentBoundingBoxes(this.svf.extraFragInfo.boxes,this.svf.extraFragInfo.boxStride),await this.viewer3DImpl._consolidateModelInternal(this.model);const e=this.model.getIterator("BVH"),t=e.getBVH(),i=km.getManagerForIterator(e,this.model)[0];t.traverseBreadthFirst((e=>{i.requestGeometryForNode(e)})),this._selectiveLoadingController.onBoundingVolumeHierarchyReady(),this._requestRepaint(),this.onOperationComplete()}},_g.prototype.waitForFragmentData=async function(){if(this.fragmentDataLoaded)return!0;const e=this.viewer3DImpl.api;return new Promise((t=>{const i=()=>{e.removeEventListener(bg.MODEL_ROOT_LOADED_EVENT,n),e.removeEventListener(bg.MODEL_UNLOADED_EVENT,r)},n=e=>{e.model.loader===this&&(i(),t(!0))},r=e=>{e.model.loader===this&&(i(),t(!1))};e.addEventListener(bg.MODEL_ROOT_LOADED_EVENT,n),e.addEventListener(bg.MODEL_UNLOADED_EVENT,r)}))},_g.prototype.trackOnDemandLoadProgress=function(){this.svf.loadDone&&!1===this.fragLoadingInProgress&&0===this.pendingRequests&&this.viewer3DImpl.api.dispatchEvent({type:bg.FRAGMENTS_LOADED_EVENT,loader:this,model:this.model})},_g.prototype.evaluate=function(e){if(!this.model||this.options.skipMeshLoad)return;if(void 0!==e)return void this.tryToActivateFragment(e,"fragment");const t=this.model.getFragmentList().fragments.length;for(let e=0;e<t;++e)this.tryToActivateFragment(e,"fragment")},_g.prototype.loadFragments=function(e){if(!this.svf.loadDone)return rt.warn("Trying to call loadFragments while model is not fully loaded yet."),0;this.svf.nextRepaintPolys=0,this.svf.numRepaints=0;let t=0;const i=this.model.getFragmentList();this.fragLoadingInProgress=!0;for(const n of e)i.isFlagSet(n,xg.MeshFlags.MESH_NOTLOADED)&&(i.setFlagFragment(n,xg.MeshFlags.MESH_NOTLOADED,!1),i.setFragOff(n,!1),i.setVisibility(n,!0),this.tryToActivateFragment(n,"fragment"),++t);return this.fragLoadingInProgress=!1,t&&this.trackOnDemandLoadProgress(),t},Ra.registerFileLoader("json",["json"],_g);var Cg=r(2404),Tg=r.n(Cg);let Mg=1e3;const Ig={MeshPhongMaterial:12,LineBasicMaterial:4};let Pg=0;const Lg={Common:new Set(["uuid","id","name","uniformsList","uniformsLists","program","programs","svfMatId","hash","tag","proteinMat","cachedLineMaterial","cachedLineMaterialVC"]),LineBasicMaterial:new Set(["opacity","color"]),MeshPhongMaterial:new Set(["opacity","color","specular","emissive","shininess","reflectivity"])};class Rg{#e;constructor(e,t){this.#e=e,this.setData(t)}dispose(){this.#e.deallocateUniformBufferObject(this),this.#e=null}setData(e){this.#e.setUniformBufferObject(this,e)}}class Dg{#e;#Ie=new Map;#Pe;#Le;constructor(e,t){this.#e=e,this.#Re(t)}dtor(){this.#Ie.clear()}prepareUBOs(e,t,i){const n=this.#De(e,t,i);let r=this.#Oe(n);i.ubos={materials:new Rg(this.#e,r),fragments:new Rg(this.#e,this.#Pe)},i.geometry.uboNeedsUpdate=!0,this.#Be(i,n)}updateMeshFragmentUBO(e,t,i){null!=e&&e.ubos&&(this.#De(t,i,e),e.ubos.fragments.setData(this.#Pe))}#De(e,t,i){let n=[],r=4*Mg;const o=new THREE.Vector4(0,0,0,0);for(let s=0;s<i.rangeCount;s++){let a=t[i.rangeBegin+s],l=e.getMaterial(a),c=n.indexOf(l);-1===c&&(n.push(l),c=n.length-1);let u=e.getDbIds(a);this.#Pe[4*s+0]=c,this.#Pe[4*s+1]=u,this.#Pe[4*s+2]=255&e.vizflags[a];const h=e.db2ThemingColor[u]??o;this.#Le[r+4*s+0]=h.x,this.#Le[r+4*s+1]=h.y,this.#Le[r+4*s+2]=h.z,this.#Le[r+4*s+3]=h.w}return n}#Be(e,t){let i;for(let e of t)if(this.#Ie.has(e)){i=this.#Ie.get(e);break}if(!i){let t=e.material;i=e.material.clone();for(let e in t)if(!i[e]){if("id"===e)continue;i[e]=t[e]}i.needsUpdate=!0,i.defines=Object.assign({},i.defines??{}),i.defines.MAX_UBO_MATERIALS=Og(t),i.defines.MAX_UBO_FRAGMENTS=Mg,i.defines.USE_UNIFORM_BUFFER_OBJECTS=!0,i.defines.EVAL_THEMING_VIZFLAGS_IN_SHADER=!0}e.material=i;for(let e of t)this.#Ie.set(e,i)}#Oe(e){const t=e[0].type,i=Og(t),n=new Float32Array(i*Ig[t]);switch(t){case"MeshPhongMaterial":this.#Ne(e,n,i);break;case"LineBasicMaterial":this.#Ue(e,n,i)}return n}#Ne(e,t,i){for(let n=0;n<e.length;n++){const r=e[n].color,o=e[n].shininess;t[4*n+0]=r.r,t[4*n+1]=r.g,t[4*n+2]=r.b,t[4*n+3]=o;const s=e[n].specular,a=e[n].opacity;let l=4*i;t[l+4*n+0]=s.r,t[l+4*n+1]=s.g,t[l+4*n+2]=s.b,t[l+4*n+3]=a;const c=e[n].emissive,u=e[n].reflectivity;l+=4*i,t[l+4*n+0]=c.r,t[l+4*n+1]=c.g,t[l+4*n+2]=c.b,t[l+4*n+3]=u}}#Ue(e,t,i){for(let i=0;i<e.length;i++){const n=e[i].color;t[4*i+0]=n.r,t[4*i+1]=n.g,t[4*i+2]=n.b,t[4*i+3]=e[i].opacity}}#Re(e){Pg=e,Mg=Math.min(Math.floor(Pg/8),Mg),this.#Pe=new Uint32Array(8*Mg),this.#Le=new Float32Array(this.#Pe.buffer)}}function Og(e){let t=Pg/Ig[(null==e?void 0:e.type)??e]??0;return Math.min(t,100)}function Bg(e){switch(e.type){case"MeshPhongMaterial":case"LineBasicMaterial":return!0;default:return!1}}function Ng(e,t,i){if(e.id!==t.id){var n;if(e.id>t.id){const i=e;e=t,t=i}let r=null===(n=i.get(e))||void 0===n?void 0:n.get(t);if(void 0!==r)return r;if(!Bg(e)||!Bg(t)||e.type!==t.type)return!1;r=function(e,t){let i=!0;const n=Lg[e.type];for(let r of Object.keys(e))if("_"!==r[0]&&!Lg.Common.has(r)&&!n.has(r)&&!Tg()(e[r],t[r])){i=!1;break}return i}(e,t);let o=i.get(e);return o||(o=new Map,i.set(e,o)),o.set(t,r),r}return!0}const Ug={},kg=-1,Fg=-2,Vg=Fg-1;function Gg(e){return Ji&&e.loader instanceof _g&&!e.loader.svf.loadDone}function zg(e){return Ji&&e.loader instanceof _g}function Hg(e){return!e.geometry.attributes}function Wg(e){return!!e.geometry.numInstances}function jg(e){return!Wg(e)&&!!e.geometry.attributes.id}var qg={UNKNOWN:0,TRIANGLES:1,LINES:2,WIDE_LINES:3,POINTS:4};const Kg=20971520;let Xg,Yg=0;function Qg(e,t){if(!Ji||Yg+t*e.BYTES_PER_ELEMENT>Kg)return new e(t);{let i=t+(t%4!=0?4-t%4:0);void 0===Xg&&(Xg=new ArrayBuffer(Kg));const n=new e(Xg,Yg,t);return Yg+=i*e.BYTES_PER_ELEMENT,n}}function Zg(){Yg=0}function $g(e){return e.isLines?qg.LINES:e.isPoints?qg.POINTS:e.isWideLines?qg.WIDE_LINES:qg.TRIANGLES}function Jg(e,t){switch(!0===e.isLines&&(e.isLines=void 0),!0===e.isWideLines&&(e.isWideLines=void 0),!0===e.isPoints&&(e.isPoints=void 0),t){case qg.LINES:e.isLines=!0;break;case qg.WIDE_LINES:e.isWideLines=!0;break;case qg.POINTS:e.isPoints=!0}}var ev=ll.MESH_HIGHLIGHTED,tv=ll.MESH_VISIBLE|ll.MESH_HIDE|ev,iv=ll.MESH_VISIBLE,nv=ll.MESH_VISIBLE|ll.MESH_HIDE,rv=0,ov=ll.MESH_HIGHLIGHTED|ll.MESH_HIDE,sv=ll.MESH_HIGHLIGHTED,av=vc.RENDER_HIDDEN,lv=vc.RENDER_HIGHLIGHTED;function cv(e,t){switch(t){case av:return(e&nv)===rv;case lv:return(e&ov)===sv}return(e&tv)==iv}const uv=new(v().Matrix4);function hv(e,t){this.geoms=[],this.matrices=[],this.vertexCount=0,this.materialId=e,this.fragIds=[],this.worldBox=new(v().Box3),this.cost=0,this.bvhNodeId=t}function dv(e,t){e.vb||rt.warn("copyVertexFormat() supports only interleaved buffers"),t.vbstride=e.vbstride;let i=new Set(Object.keys(t.attributes));for(var n in e.attributes)t.attributes[n]=e.attributes[n],i.delete(n);i.delete("id");for(let e of i)delete t.attributes[e];t.attributesKeys=e.attributesKeys.slice(0)}function fv(e,t){Jg(t,$g(e)),t.lineWidth=e.lineWidth,t.pointSize=e.pointSize}function pv(e){let t=e[0].vbstride;var i=0,n=0;let r,o=0;for(let t=0;t<e.length;t++){const s=e[t];n+=Tl(s);let a=s.ib.length;if(a-=a%(s.isLines?2:3),i+=a,r=s.iblines,r){let e=r.length;e-=e%2,o+=e}}var s=Rc();s.byteSize=0,s.vb=Qg(Float32Array,n*t),s.ib=Qg(Uint16Array,i),o>0&&(r=Qg(Uint16Array,o),s.byteSize+=r.byteLength,s.iblines=r),s.byteSize+=s.vb.byteLength+s.ib.byteLength,fv(e[0],s),dv(e[0],s);var a=s.attributes.id||new(v().BufferAttribute)(new Float32Array,3);a.normalized=!0,a.bytesPerItem=1,s.setAttribute("id",a);var l=e[0];return Jg(s,$g(l)),l.isPoints&&(s.pointSize=l.pointSize),l.isWideLines&&(s.lineWidth=l.lineWidth),s}function mv(e,t){for(var i=0,n=0,r=0,o=0,s=0;s<e.length;s++){var a=e[s],l=Tl(a);const c=a.vb,u=a.ib;let h=u.length;const d=t.vb,f=t.ib,p=a.iblines;let m=(null==p?void 0:p.length)??0;const g=t.iblines;h-=h%(a.isLines?2:3);for(let e=0;e<h;e++)f[r+e]=u[e]+n;m-=m%2;for(let e=0;e<m;e++)g[o+e]=p[e]+n;o+=m,d.set(c,i),i+=c.length,n+=l,r+=h}}function gv(e,t,i,n,r){var o=pv(e);return o.boundingBox?o.boundingBox.copy(n):o.boundingBox=n.clone(),mv(e,o),r?r.addMergeTask(e,o,t,i):function(e,t,i,n){var r=jc(e,t,i,n),o=new rl,s=new al;qc(r.run(s,o),t)}(e,o,t,i),o}function vv(e,t){if(e.vbstride!=t.vbstride)return!1;if($g(e)!==$g(t))return!1;if(e.isPoints&&e.pointSize!==t.pointSize)return!1;if(e.isWideLines&&e.lineWidth!==t.lineWidth)return!1;if(e.attributesKeys.length!=t.attributesKeys.length)return!1;for(var i=0,n=e.attributesKeys.length;i<n;i++){var r=e.attributesKeys[i],o=e.attributes[r],s=t.attributes[r];if(!s)return!1;if(o===s)continue;const n=o.bytesPerItem!==s.bytesPerItem;if(o.offset!==s.offset||o.normalized!==s.normalized||o.itemSize!==s.itemSize||n||o.isPattern!==s.isPattern)return!1}return!0}function yv(e,t,i){var n;let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const s=e.meshes[t],a=e.consolidationMap,l=a.fragOrder,c=s.rangeBegin,u=s.rangeCount,h=!!function(e,t){let i=fn&&Bg(e);return i&&=Mg>=t,i}(i.getMaterial(l[c]),u);if(!r){const n=void 0,r=e.createMeshGeometry(t,i,n,h);return h&&o.getUBOManager().prepareUBOs(i,a.fragOrder,r),r.geometry}const d=s.geometry;if(d.attributes)return d;s.proxyGeometry=s.geometry,a.tmpGeoms.length=u;const f=new Float32Array(16*u),p=new Uint32Array(u);let m;for(let e=0;e<u;e++)m=l[c+e],a.tmpGeoms[e]=i.getGeometry(m),i.getOriginalWorldMatrix(m,a.tmpMatrix),f.set(a.tmpMatrix.elements,16*e),p[e]=h?e:i.getDbIds(m);const g=pv(a.tmpGeoms),v=a.boxes[s.oldRangeIndex];g.boundingBox?g.boundingBox.copy(v):g.boundingBox=v.clone(),mv(a.tmpGeoms,g);const y=Wc(a.tmpGeoms),b=new Uint8Array(3*g.vb.length/g.vbstride);for(let e=0;e<u;e++){const t=y[e+0],i=y[e+1]-t,n=p[e];let r=3*t;for(let e=0;e<i;e++)Gc(n,b,r),r+=3}g.attributes.id.array=b,g.streamingDraw=Ug,g.streamingIndex=!1;const x=o.createConsolidatedBuffer(g,f,a.tmpGeoms);return g.vbbuffer=x,g.needsUpdate=!1,g.ibNeedsUpdate=!0,g.vbNeedsUpdate=!1,g.vbLength=g.vb.length,g.vb=null,g.discardAfterUpload=!0,g.__webglContextId=null===(n=o.lostContextRecovery)||void 0===n?void 0:n.webglContextId,s.geometry=g,s.geometry.streamingDraw=d.streamingDraw,s.geometry.streamingIndex=d.streamingIndex,s.geometry.discardAfterUpload=d.discardAfterUpload,h&&o.getUBOManager().prepareUBOs(i,l,s),g}function bv(e,t){this.meshes=[],this.fragId2MeshIndex=new Int32Array(e);for(var i=0;i<this.fragId2MeshIndex.length;i++)this.fragId2MeshIndex[i]=kg;this.byteSize=0,this.modelId=t,this.consolidationMap=null,rn?(this.addSingleFragment=this._addSingleFragmentAsRenderBatch,this.nodeId2SingleFragIds=[]):this.addSingleFragment=this._addSingleFragmentAsTHREEMesh}function xv(){this.buckets=new Map,this.bucketCount=0,this.costs=0}function _v(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;n?(this.fragOrder=n.fragOrder,this.ranges=n.ranges,this.boxes=n.boxes,this.numConsolidated=n.numConsolidated,this.bvhNodeIndices=n.bvhNodeIndices):(this.fragOrder=new Uint32Array(e),this.ranges=new Uint32Array(t),this.bvhNodeIndices=new Uint32Array(t),this.boxes=new Array(t),this.numConsolidated=-1),this.tmpGeoms=[],this.tmpMatrix=new(v().Matrix4),this.fragIdToNodeIdx=i,this._compatibleMaterialLUT=new Map}function Ev(e,t){const i=Rc();if(i.ib=e.ib,i.vb=e.vb,i.iblines=e.iblines,dv(e,i),fv(e,i),sn)this.objectUniformBuilder=new Mv(t);else{var n=3,r=3;this.offsets=new Float32Array(3*t),this.rotations=new Float32Array(4*t),this.scalings=new Float32Array(3*t),this.ids=new Uint8Array(r*t),fn&&(this.themingColor=new Uint8Array(4*t),this.flags=new Uint8Array(t));var o=new(v().Vector3),s=new(v().Quaternion),a=new(v().Vector3),l=new(v().Matrix4)}var c=0,u=t;this.addInstance=function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ll.MESH_VISIBLE;return c>=u?(rt.warn("Instance buffer is already full."),!1):sn?(this.objectUniformBuilder.addInstance(e,t),c++,!0):(e.decompose(o,s,a),!!function(e,t,i,n){l.compose(t,i,n);for(var r=e.elements,o=l.elements,s=0;s<16;s++){var a=r[s],c=o[s];if(Math.abs(c-a)>1e-4*Math.max(1,Math.min(Math.abs(a),Math.abs(c))))return!1}return!0}(e,o,s,a)&&(this.offsets[3*c]=o.x,this.offsets[3*c+1]=o.y,this.offsets[3*c+2]=o.z,this.rotations[4*c]=s.x,this.rotations[4*c+1]=s.y,this.rotations[4*c+2]=s.z,this.rotations[4*c+3]=s.w,this.scalings[r*c]=a.x,this.scalings[r*c+1]=a.y,this.scalings[r*c+2]=a.z,fn&&(i&&(this.themingColor[4*c]=255*i.x,this.themingColor[4*c+1]=255*i.y,this.themingColor[4*c+2]=255*i.z,this.themingColor[4*c+3]=255*i.w),this.flags[c]=n),Gc(t,this.ids,r*c),c++,!0))},this.finish=function(){if(0==c)return null;if(sn){const e=this.objectUniformBuilder.finish();return i.setAttribute("instanceUniforms",e),i.numInstances=c,i.byteSize=e.array.byteLength,i}let e,t,o,s,a,l;return c<u&&(this.offsets=new Float32Array(this.offsets.buffer,0,3*c),this.rotations=new Float32Array(this.rotations.buffer,0,4*c),this.scalings=new Float32Array(this.scalings.buffer,0,3*c),this.ids=new Uint8Array(this.ids.buffer,0,r*c),fn&&(this.themingColor=new Uint8Array(this.themingColor.buffer,0,4*c),this.flags=new Uint8Array(this.flags.buffer,0,c))),e=new(v().BufferAttribute)(this.offsets,3),t=new(v().BufferAttribute)(this.rotations,4),o=new(v().BufferAttribute)(this.scalings,3),s=new(v().BufferAttribute)(this.ids,n),s.normalized=!0,s.bytesPerItem=1,e.divisor=1,t.divisor=1,o.divisor=1,s.divisor=1,i.setAttribute("instOffset",e),i.setAttribute("instRotation",t),i.setAttribute("instScaling",o),i.setAttribute("id",s),i.numInstances=c,i.byteSize=i.vb.byteLength+i.ib.byteLength+this.offsets.byteLength+this.rotations.byteLength+this.scalings.byteLength+this.ids.byteLength,fn&&(a=new(v().BufferAttribute)(this.themingColor,4),a.normalized=!0,a.bytesPerItem=1,a.divisor=1,i.setAttribute("instThemingColor",a),l=new(v().BufferAttribute)(this.flags,1),l.bytesPerItem=1,l.gpuType=v().IntType,l.divisor=1,i.setAttribute("instFlags",l),i.byteSize+=this.themingColor.byteLength+this.flags.byteLength),i}}hv.prototype={constructor:hv,addGeom:function(e,t,i){if(this.fragIds.push(i),this.worldBox.union(t),null===e)return 0;this.geoms.push(e),this.vertexCount+=Tl(e);var n=this.geoms.length;if(1==n)return 0;void 0===e.byteSize&&rt.warn("Error in consolidation: Geometry must contain byteSize.");let r=e.byteSize+(2==n?this.geoms[0].byteSize:0);return this.cost+=r,r}},bv.prototype={constructor:bv,addContainerMesh:function(e,t,i,n,r,o){var s=new(v().Mesh)(e,t);s.modelId=this.modelId,this.meshes.push(s),this.byteSize+=e.byteSize;var a=n||0,l=a+(r||i.length);s.frustumCulled=!1,s.rangeBegin=n,s.rangeCount=r,s.oldRangeIndex=o;for(var c=this.meshes.length-1,u=a;u<l;u++){var h=i[u];this.fragId2MeshIndex[h]=c}},addSingleMesh:function(e,t,i,n,r){var o=new(v().Mesh)(e,t);o.matrix.copy(n),o.matrixAutoUpdate=!1,o.dbId=r,o.fragId=i,o.modelId=this.modelId,this.meshes.push(o),o.frustumCulled=!1,this.fragId2MeshIndex[i]=this.meshes.length-1},_addSingleFragmentAsTHREEMesh:function(e,t){const i=t.getGeometry(e),n=t.getMaterial(e),r=t.getDbIds(e);t.getOriginalWorldMatrix(e,uv),this.addSingleMesh(i,n,e,uv,r)},_addSingleFragmentAsRenderBatch:function(e){const t=this.consolidationMap.fragIdToNodeIdx[e];let i=this.nodeId2SingleFragIds[t];i||(this.nodeId2SingleFragIds[t]=i=[]),i.push(e),this.fragId2MeshIndex[e]=this.meshes.length,this.meshes.push({fragId:e})},createMeshGeometry:function(e,t,i,n){var r=this.meshes[e],o=r.geometry,s=this.consolidationMap;if(!o.attributes){if(void 0!==i&&performance.now()>i)return null;r.proxyGeometry=r.geometry,s._buildConsolidationGeometry(r,this,e,t,n),r.geometry.streamingDraw=o.streamingDraw,r.geometry.streamingIndex=o.streamingIndex,r.geometry.discardAfterUpload=!!Ji||o.discardAfterUpload,o=r.geometry}return r},freeMeshGeometry:function(e){var t=this.meshes[e],i=t.geometry;if(void 0!==i&&i.attributes){let e=t.parent;if(e&&t.parent.remove(t),t.geometry.dispose(),t.ubos){for(const e in t.ubos)t.ubos[e].dispose();delete t.ubos}t.geometry=t.proxyGeometry,i.vb=null,i.ib=null,i.iblines=null;for(let e in i.attributes)i.attributes[e].array&&(i.attributes[e].array=null);e&&e.add(t)}},meshGeometryAvailable:function(e){var t;return void 0!==(null===(t=this.meshes[e])||void 0===t||null===(t=t.geometry)||void 0===t?void 0:t.attributes)},getMemoryCostForConsolidatedMesh:function(e,t){const i=this.meshes[e];if(i.geometry.numInstances>1||void 0!==i.fragId)throw new Error("getMemoryCostForConsolidatedMesh() is only valid for consolidated meshes");let n=0,r=this.meshes[e];const o=r.rangeBegin,s=r.rangeBegin+r.rangeCount,a=this.consolidationMap.fragOrder;for(let e=o;e<s;e++){const i=a[e],r=t.getGeometry(i);n+=r.getAccurateByteSize();n+=3*(r.vb.length/r.vbstride)}return n},getBvhNodeIdForRange:function(e){return this.consolidationMap.bvhNodeIndices[e]},applyAttributes:function(e,t,i,n,r){var o,s=this.meshes[e];if(Ji)o=s.geometry;else{const i=this.createMeshGeometry(e,t,r);o=(null==i?void 0:i.geometry)||null}if(null===o)return null;var a,l,c,u=this.consolidationMap,h=t.vizflags,d=u.fragOrder,f=o.numInstances,p=t.db2ThemingColor.length>0||void 0;if(f)l=(a=s.rangeStart)+s.geometry.numInstances;else if(o.attributes.id)if(Ji){let t=this.meshes[e];a=t.rangeBegin,l=t.rangeBegin+t.rangeCount}else a=u.ranges[e],l=e+1>=u.ranges.length?u.numConsolidated:u.ranges[e+1];else c=s.fragId;if(!n||void 0!==c)return o.groups&&void 0===c&&(o.groups=void 0),s.visible=!(void 0!==c||!fn)||cv(h[void 0===c?d[a]:c],i),s.themingColor=p&&t.getThemingColor(c),s;var m,g,v=0,y=0,b=0,x=0,_=0;function E(){if(m){o.groups=o.groups||[];var e=o.groups[_]||{index:0};o.groups[_++]=e,f?(e.start=0,e.count=o.ib?o.ib.length:o.ibLength,(o.iblines||o.iblinesLength)&&(e.edgeStart=0,e.edgeCount=o.iblines?o.iblines.length:o.iblinesLength),e.instanceStart=v,e.numInstances=y-v):(e.start=v,e.count=y-v,(o.iblines||o.iblinesLength)&&(e.edgeStart=b,e.edgeCount=x-b)),e.themingColor=g}}for(var S=a;S<l;++S){var A=cv(h[c=d[S]],i),w=p&&t.getThemingColor(c);if((A!==m||A&&w!==g)&&(y>v&&E(),v=y,b=x,m=A,g=w),f)y+=1;else{var C=t.getGeometry(c);y+=C.ib?C.ib.length:C.ibLength,(C.iblines||C.iblinesLength)&&(x+=C.iblines?C.iblines.length:C.iblinesLength)}}return 0===v?(s.themingColor=g,s.visible=m,s.material=Array.isArray(s.material)?s.material[0]:s.material):(s.visible=!0,E()),o.groups&&(o.groups.length=_),s},dispose:function(){for(var e={type:"dispose"},t={type:"removed"},i=0;i<this.meshes.length;i++){var n,r=this.meshes[i],o=null===(n=r)||void 0===n?void 0:n.geometry;o&&(r.dispatchEvent(t),o.dispatchEvent(e),o.needsUpdate=!0)}}},xv.prototype={addGeom:function(e,t,i,n,r){var o=null;let s;s=fn?r?`${r[n]}`:t:r?`${t}_${r[n]}`:t;var a=this.buckets.get(s);if(a)for(var l=0;l<a.length;l++){var c=a[l],u=c.geoms[0];if(null!==e){if(!vv(u,e))continue;if(Tl(e)+c.vertexCount>65535)continue}o=c;break}o||(o=new hv(t,null==r?void 0:r[n]),this.bucketCount++,a?a.push(o):this.buckets.set(s,[o])),this.costs+=o.addGeom(e,i,n)},createConsolidationMap:function(e,t,i){var n=new _v(e.length,this.bucketCount,i),r=0,o=0;this.buckets.forEach((e=>{for(var t=0;t<e.length;t++){var i=e[t];n.ranges[o]=r,n.bvhNodeIndices[o]=i.bvhNodeId,n.boxes[o]=i.worldBox,n.fragOrder.set(i.fragIds,r),r+=i.fragIds.length,o++}})),n.numConsolidated=t;for(var s=t;s<e.length;s++)n.fragOrder[s]=e[s];return n}},_v.prototype={buildConsolidation:function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=new bv(e.getCount(),i.getModelId());if(r.consolidationMap=this,Gg(i))return r;var o=null;n||Kc.createWorker&&(o=new Kc(r));for(let s=0;s<this.ranges.length;s++)this._buildConsolidationMesh(s,e,t,i,n,o,r);return o&&o.runTasks(),r},_buildConsolidationMesh:function(e,t,i,n,r,o,s){var a=this.fragOrder,l=this.ranges.length,c=this.ranges[e],u=e===l-1?this.numConsolidated:this.ranges[e+1],h=u-c;if(1===h){const e=a[c];return void s.addSingleFragment(e,t)}const d=[];if(Ji){let e=[];for(let i=c;i<u;i++){const n=a[i];if(!t.isFragmentActive(n))continue;const r=t.getGeometry(n),o=t.getMaterial(n);let s=null,l=Tl(r);for(let t=0;t<e.length;t++){const i=e[t];if(vv(i.geoms[0],r)&&((!fn||!Bg(i.material)||!(i.fragIDs.length>=Mg||i.materialIds.size>=Og(i.material))&&Ng(i.material,o,this._compatibleMaterialLUT))&&!(l+i.vertexCount>65535))){s=i;break}}s?(s.geoms.push(r),s.fragIDs.push(n),s.vertexCount+=l,s.materialIds.add(o.id)):e.push({geoms:[r],fragIDs:[n],vertexCount:l,material:o,materialIds:new Set([o.id])})}let i=c;for(let t=0;t<e.length;t++)a.set(e[t].fragIDs,i),d.push([i,e[t].fragIDs.length]),i+=e[t].fragIDs.length}else d.push([c,h]);for(const l of d){let c=null;c=r?this._buildConsolidationPlaceholder(l[0],l[1],a,t):this._buildConsolidationGeometryImpl(s,e,l[0],l[1],a,t,o),c.nodeIdx=this.bvhNodeIndices[e];var f=a[l[0]],p=t.getMaterial(f),m=i.getMaterialVariant(p,Sf.VERTEX_IDS,n);s.addContainerMesh(c,m,a,l[0],l[1],e)}},_buildConsolidationGeometry:function(e,t,i,n,r,o){var s=this.fragOrder;let a=e.rangeBegin,l=e.rangeCount;(Ji||1!==l)&&(e.geometry=this._buildConsolidationGeometryImpl(t,e.oldRangeIndex,a,l,s,n,r,o))},_buildConsolidationGeometryImpl:function(e,t,i,n,r,o,s){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.tmpGeoms.length=n;var l=new Float32Array(16*n),c=new Uint32Array(n);let u;for(var h=0;h<n;h++)u=r[i+h],this.tmpGeoms[h]=o.getGeometry(u),o.getOriginalWorldMatrix(u,this.tmpMatrix),l.set(this.tmpMatrix.elements,16*h),c[h]=a?h:o.getDbIds(u);var d=this.boxes[t],f=gv(this.tmpGeoms,l,c,d,s);return Ji&&(f.streamingDraw=!1,f.streamingIndex=!1),f},_buildConsolidationPlaceholder:function(e,t,i,n){let r=0;for(let o=0;o<t;o++){const t=i[e+o];r+=Nc(n.getGeometry(t))}return{byteSize:r,dispatchEvent:function(){}}}},bv.applyBVHDefaults=function(e){e.frags_per_leaf_node=512,e.max_polys_per_node=1e5};const Sv=16,Av=17,wv=18,Cv=19,Tv=20;class Mv{#ke;#Fe;#Ve;constructor(e){this.#ke=new Float32Array(24*e),this.#Fe=new Int32Array(this.#ke.buffer),this.#Ve=0}addInstance(e,t){const i=24*this.#Ve;this.#ke.set(e.elements,i),this.#Fe[i+Sv]=t,this.#Fe[i+Av]=1,this.#Fe[i+wv]=0,this.#Fe[i+Cv]=0,this.#Fe[i+Tv]=0,this.#Ve++}finish(){const e=new Uint8Array(this.#ke.buffer);return new(v().BufferAttribute)(e,this.FLOATS_PER_ITEM)}}const Iv=Object.freeze({BVH_SORTING:{name:"Sorting fragments for BVH computation",progress:10},BVH:{name:"Computing Consolidation BVH",progress:30},SORTING:{name:"Sorting Fragments by Consolidation Costs",progress:50},MAP_CREATION:{name:"Creating Consolidation Map",progress:50},INSTANCING:{name:"Applying Instancing to Fragments",progress:70},FINAL_PROCESSING:{name:"Finalizing Consolidation",progress:95}}),Pv=dn?0:5e4,Lv=1e4;let Rv=0;var Dv,Ov=(Dv=null,function(e,t,i,n,r,o){var s=e.getFragmentList();Dv||(Dv=new(v().Matrix4));var a=i[n];const l=e.loader instanceof _g;var c=s.getGeometry(a);let u,h;if(l){let i=e.loader.svf.fragments.materials[a];h=e.loader.svf.materialHashes.hashes[i],u=t.findMaterial(e,h)}else u=s.getMaterial(a);var d=r-n,f=r-1;const p=s.getMaterial(i[n]);if(d<=1||p&&p.transparent)for(let e=n;e<=f;e++)o.addSingleFragment(i[e],s);else{var m=new Ev(c,d);for(let e=n;e<=f;e++){var g=i[e];s.getOriginalWorldMatrix(g,Dv);var y=s.fragments.fragId2dbId[g];if(!m.addInstance(Dv,y,s.getThemingColor(g),s.vizflags[g])){var b=i[f];i[f]=g,i[e]=b,--e,--f}}var x=m.finish();if(x){var _=t.getMaterialVariant(u,Sf.INSTANCED,e);fn&&(_.defines=Object.assign({},_.defines??{}),_.defines.EVAL_THEMING_VIZFLAGS_IN_SHADER=!0),o.addContainerMesh(x,_,i,n,d),o.meshes[o.meshes.length-1].rangeStart=n}for(let e=f+1;e<r;e++)g=i[e],o.addSingleFragment(g,s)}});function Bv(e,t,i,n,r,o){if(dn)return function(e,t,i,n,r,o){const s=e.loader instanceof _g;let a,l,c,u;s&&(e.loader.svf.getFragInstanceCount(t),a=e.loader.svf.fragments.geomDataIndexes,l=e.loader.svf.fragments.materials);if(Gg(e))c=e.loader.svf.extraFragInfo.getPolygonCount(t);else{const e=i.getGeometryId(t);c=n.getGeometry(e).polyCount}u=s?e=>{let t,i;return t=a[e],i=dn&&r?r[e]:0,`${t}_${i}`}:e=>i.getGeometryId(e);const h=s?e=>l[e]:e=>i.getMaterialId(e);if(!o.geometryInstanceCounts||o.nodeIdsAvailable!==(void 0!==r)){const e=i.fragments.length;o.geometryInstanceCounts=new Map,o.nodeIdsAvailable=void 0!==r;for(let t=0;t<e;t++){const e=u(t),i=h(t);let n=o.geometryInstanceCounts.get(i);o.geometryInstanceCounts.has(i)||(n=new Map,o.geometryInstanceCounts.set(i,n));const r=n.get(e)??0;n.set(e,r+1)}}const d=u(t),f=o.geometryInstanceCounts.get(h(t));return c*((null==f?void 0:f.get(d))??0)}(e,t,i,n,r,o);let s,a;if(Gg(e))s=e.loader.svf.extraFragInfo.getPolygonCount(t),a=e.loader.svf.getFragInstanceCount(t);else{const e=i.getGeometryId(t);a=n.getInstanceCount(e),s=n.getGeometry(e).polyCount}return s*a}async function Nv(e,t,i,n){const r=e.getFragmentList(),o=e.getGeometryList();var s=0,a=r.getCount(),l=t&&t.length===a?t:new Int32Array(a);const c=new Uint32Array(a),u=Math.pow(2,32)-1;for(var h=0;h<a;h++){if(Gg(e)){if(0===e.loader.svf.fragments.geomDataIndexes[h])continue;let t=Bv(e,h,r,o,i,n);l[s]=h,c[h]=e.loader.svf.extraFragInfo.isTransparent(h)?u:t}else{if(!r.isFragmentActive(h))continue;l[s]=h;const e=r.getGeometry(h),t=r.getGeometryId(h),i=o.getInstanceCount(t);c[h]=r.getMaterial(h).transparent?u:i*e.byteSize}s++}let d;s<a&&(l=new Int32Array(l.buffer,l.byteOffset,s));let{geomIds:f,materialIds:p}=Uv(e);return new Promise((e=>{const t=Rv++;d=i=>{i.data.jobId===t&&e(i.data.fragIds)},n.worker.addEventListener("message",d);const r={operation:"SORT_FRAGMENTS",fragIds:l,geomIds:f,memCosts:c,materialIds:p,fragIdToNodeIdx:i,jobId:t};n.worker.doOperation(r)})).finally((()=>{var e;null===(e=n.worker)||void 0===e||e.removeEventListener("message",d)}))}function Uv(e){const t=e.getFragmentList();let i,n;return Gg(e)?(i=e.loader.svf.fragments.geomDataIndexes,n=e.loader.svf.fragments.materials):(i=t.geomids,n=t.materialids),{geomIds:i,materialIds:n}}async function kv(e,t){if(!t.consolidationMap||t.forceConsolidationMapRecomputation){var i;const n=e.getFragmentList();let r=null,o=new Int32Array(n.getCount());null!==(i=t.bvhOptions)&&void 0!==i&&i.per_tile_consolidation&&(r=new Uint32Array(n.getCount()),await async function(e,t,i,n){var r;const o=e.getFragmentList();let{geomIds:s,materialIds:a}=Uv(e);const l={boxes:o.fragments.boxes,polygonCounts:new Uint32Array(s.length),flags:new Uint8Array(s.length),materials:a,length:s.length,geomids:s,wantSort:!0};i=await Nv(e,i,void 0,n),n.stopIfCanceled(Iv.BVH_SORTING),n.signalProgress(Iv.BVH_SORTING.progress);const c=(null===(r=n.bvhOptions)||void 0===r?void 0:r.consolidation_polycount_limit)??hn,u=e.getFragmentList().materialIdMap;let h,d=0;for(let t=0;t<i.length;++t){const r=i[t];if(Gg(e)){let t=e.loader.svf.fragments.geomDataIndexes[r];const i=e.loader.svf.extraFragInfo;l.polygonCounts[r]=0!==t?i.getPolygonCount(r):0,l.polygonCounts[r]<c&&(l.flags[r]=1),l.flags[r]|=i.isTransparent(r)?2:0}else{const e=o.getGeometry(r);l.polygonCounts[r]=e?e.polyCount:0,d+=e.byteSize,Ji?l.polygonCounts[r]<c&&(l.flags[r]=1):d<=n.byteLimit&&(l.flags[r]=1);const t=u&&u[l.materials[r]];l.flags[r]|=t&&t.transparent?2:0}}const f=await new Promise((t=>{const i=Rv++;h=e=>{if(e.data.jobId===i){const i=e.data.bvh;t(new Nf(i.nodes,i.useLeanNodes,i.primitives,n.bvhOptions))}},n.worker.addEventListener("message",h),n.worker.doOperation({operation:"COMPUTE_BVH",fragments:l,modelId:e.id,bvhOptions:n.bvhOptions,jobId:i},[l.polygonCounts.buffer,l.flags.buffer])})).finally((()=>{var e;null===(e=n.worker)||void 0===e||e.removeEventListener("message",h)}));n.consolidationBVH=f,n.stopIfCanceled(Iv.BVH),n.signalProgress(Iv.BVH.progress),Fv(f,t)}(e,r,o,t)),o=await Nv(e,o,r,t),t.stopIfCanceled(Iv.SORTING),t.signalProgress(Iv.SORTING.progress),t.consolidationMap=await async function(e,t,i,n){var r;const o=e.getFragmentList(),s=(null===(r=n.bvhOptions)||void 0===r?void 0:r.consolidation_polycount_limit)??hn;return new Promise((r=>{var a=new(v().Box3);const l=e.getGeometryList();var c=new xv,u=0;const h=()=>{n.stopIfCanceled(Iv.MAP_CREATION);const d=performance.now()+n.syncTimeSlice;for(;u<t.length;u++){let r,f,p=t[u];if(Ji){if(Bv(e,p,o,l,i,n)>s)break}else if(c.costs>=n.byteLimit)break;if(o.getWorldBounds(p,a),Gg(e)){if(f=null,r=e.loader.svf.fragments.materials[p],e.loader.svf.extraFragInfo.isTransparent(p))break}else{f=o.getGeometry(p);const e=o.getMaterial(p);if(e.transparent)break;r=e.id}if(c.addGeom(f,r,a,p,i),u%Lv==0){const e=Iv.INSTANCING.progress-Iv.MAP_CREATION.progress;if(n.signalProgress(Iv.MAP_CREATION.progress+e*Math.max(u/t.length,c.costs/n.byteLimit)),performance.now()>d)return++u,void setTimeout(h,0)}}r(c.createConsolidationMap(t,u,i))};h()}))}(e,o,r,t)}const n=t.consolidationMap.bvhNodeToRanges=new Array;return Gg(e)&&t.consolidationMap.bvhNodeIndices.forEach(((e,t)=>{n[e]||(n[e]=new Array),n[e].push(t)})),t.consolidationMap}function Fv(e,t){e.traverseBreadthFirst((i=>{const n=e.nodes.getPrimStart(i),r=n+e.nodes.getPrimCount(i);for(let o=n;o<r;++o)t[e.primitives[o]]=i}))}async function Vv(e,t,i){const n=e.getFragmentList(),r=(i.consolidationMap=await kv(e,i)).buildConsolidation(n,t,e,i.useDeferredConsolidation);return await async function(e,t,i,n){var r=e.getFragmentList();const o=n.consolidationMap.fragOrder,s=n.consolidationMap.numConsolidated,a=n.consolidationMap.bvhNodeToInstancingRanges=new Array;if(s>=o.length)return;var l=s,c=-1,u=-1;let h=-1,d=0;const f=n.consolidationMap.fragIdToNodeIdx;let{geomIds:p,materialIds:m}=Uv(e);i.fragId2InstancingRange=new Array;const g=(n,r)=>{if(Gg(e)){const e=new Set;for(let t=n;t<r;t++)e.add(f[o[t]]);for(const t of e)void 0===a[t]&&(a[t]=[]),a[t].push([n,r])}else Ov(e,t,o,n,r,i)};let v=performance.now()+n.syncTimeSlice;for(let t=s;t<o.length;t++){var y=o[t],b=p[y],x=m[y],_=f?f[y]:-1;if((b!=c||x!=u||_!=h&&d>Pv)&&(t!=s&&g(l,t),l=t,c=b,u=x,h=_,d=0),Gg(e))if(e.loader.svf.cachedPolygonCounts)d+=3*e.loader.svf.cachedPolygonCounts[y];else{var E;d+=3*(null===(E=e.loader.svf.extraFragInfo)||void 0===E?void 0:E.getPolygonCount(y))}else{const e=r.getGeometry(y);d+=e.ib?e.ib.length:0}if(t%Lv==0){const e=Iv.FINAL_PROCESSING.progress-Iv.INSTANCING.progress;n.signalProgress(Iv.INSTANCING.progress+e*t/o.length),performance.now()>v&&(await new Promise((e=>setTimeout(e,0))),v=performance.now()+n.syncTimeSlice,n.stopIfCanceled(Iv.INSTANCING))}}g(l,o.length)}(e,t,r,i),r}function Gv(e,t,i){let n=i;var r=e;let o=i.getOutOfCoreTileManager(),s=!1;null==o||o.activateIterator(n.getIteratorOutOfCoreManagerId(),n);var a=t,l=[],c=!1;const u=[];var h=[],d=new(v().Matrix4),f=new(v().Box3);function p(e){const t=r.matrix,i=e.consolidatedScene||e;t?(i.matrixWorld.copy(t),i.matrixAutoUpdate=!1):i.matrixWorld.identity()}function m(){const e=a.meshes;for(let t=0;t<e.length;t++)e[t].matrixWorldNeedsUpdate=!0}this.acquireSceneOrConsolidatedRenderBatch=function(e){const t=e.nodeIndex;let i;for(u[t]?i=u[t].consolidatedScene||u[t]:(u[t]=rn?new Ac(this,e,a):new(v().Scene),i=u[t].consolidatedScene||u[t],p(i));i.children.length>0;)i.remove(i.children[i.children.length-1]);return u[t]},m(),this.modelMatrixChanged=function(){for(let e=0;e<u.length;e++){const t=u[e];t&&p(t)}m()},this.getConsolidation=function(){return a},this.reset=function(){l.length=null;var t=r.getCount(),u=ll.MESH_VISIBLE,d=u|ll.MESH_HIDE|ll.MESH_HIGHLIGHTED,f=r.vizflags,p=a.fragId2MeshIndex;if(!s){if(o&&!zg(o.model))for(let e of i.getGeomScenes())e&&(null==o||o.initializeNode(e.nodeIndex));s=!0}if(c=r.movedFragments>0,!fn&&!c&&(r.vizFlagsChanged()||r.themeingOrGhostingChanged())){h.length=0;for(var m=r.db2ThemingColor.length>0,g=0;g<t;g++){if(f[g]&d^u||m&&e.getThemingColor(g)){var v=p[g];v>=0&&(h[v]=!0)}}}null==o||o.resetLockedTiles(n.getIteratorOutOfCoreManagerId())},this.dispose=function(){a.dispose(),null==o||o.releaseIterator(n.getIteratorOutOfCoreManagerId())},this.consolidateNextBatch=function(e,t,i,s){var u=e.nodeIndex;if(c||void 0===u)return e;if(a.inProgress)return e;const d=e.getIndices();if(Ji&&!o.bvhNodeInitialized(u))return e;let p,m=!1,g=this.acquireSceneOrConsolidatedRenderBatch(e);if(rn)p=g.consolidatedScene;else{p=g;const n=i===vc.RENDER_HIDDEN?e.getBoundingBoxHidden():e.getBoundingBox(),r=t.intersectsBox(n);if(r===ac.OUTSIDE)return null;if(Zi&&t.estimateProjectedDiameter(n)<t.areaCullThreshold)return null;m=r!==ac.CONTAINS}p.numFragsStreamingDraw=0;let y=!1,b=new Set;for(var x=e.start;x<e.lastItem;x++){var _;let c=d?d[x]:x,g=a.fragId2MeshIndex[c];var E=null;if(-1===g){if(!r.hasGeometry(c))continue;rt.warn("Warning: Missing fragment in consolidation. Consolidation disabled.");for(let e of b)l[e]=!1;return e}if(!l[g]&&void 0!==a.meshes[g].geometry){if(!rn){if(r.getWorldBounds(c,f),m&&!t.intersectsBox(f))continue;if(Zi&&t.estimateProjectedDiameter(f)<t.areaCullThreshold)continue}if(l[g]=!0,b.add(g),sn&&h[g])return e;if(Ji){if(null===(E=o.getConsolidationMesh(n.getIteratorOutOfCoreManagerId(),u,g,r,i,h[g]))){y=!0;continue}}else if(null===(E=a.applyAttributes(g,r,i,h[g],s))){for(let e of b)l[e]=!1;return e}if(E.visible){var S=E&&E.geometry,A=S&&(S.isLines||S.isWideLines),w=S&&S.isPoints;r.linesHidden&&A||r.pointsHidden&&w||(null!==(_=S)&&void 0!==_&&_.streamingDraw&&p.numFragsStreamingDraw++,p.add(E))}}}if(y){for(let e of b)l[e]=!1;return e}return null==o||o.lockTile(n.getIteratorOutOfCoreManagerId(),u),p.boundingBox||(p.boundingBox=new(v().Box3)),e.getBoundingBox(p.boundingBox),g.renderImportance=e.renderImportance,p.sortObjects=e.sortObjects,e.lights&&p.children.push(e.lights),g};var g={Merged:1,Instanced:2,Original:3};function y(e){if(e){if(e.numInstances)return g.Instanced;if(e.attributes)return g.Merged}return g.Original}this.updateRenderProxy=function(e,t){if(e.geometry&&e.geometry.attributes){var i=function(e){if(c)return g.Original;var t=a.fragId2MeshIndex[e],i=a.meshes[t];return y(null==i?void 0:i.geometry)}(t),n=y(e.geometry);if(e.needsUpdate||n!=i){var o=r.getGeometry(t),s=a.fragId2MeshIndex[t],l=a.meshes[s];if(i===g.Original)e.geometry=o,e.material=r.getMaterial(t),r.getWorldMatrix(t,e.matrix);else if(i===g.Instanced){r.getWorldMatrix(t,d);var u=r.fragments.fragId2dbId[t],h=new Ev(o,1);h.addInstance(d,u,r.getThemingColor(t),r.vizflags[t]),e.geometry=h.finish(),e.material=Array.isArray(l.material)?l.material[0]:l.material,e.matrix.identity()}else r.getWorldMatrix(t,d),r.getWorldBounds(t,f),u=r.fragments.fragId2dbId[t],e.geometry=gv([o],d.elements,[u],f),e.material=Array.isArray(l.material)?l.material[0]:l.material,e.matrix.identity();e.needsUpdate=!1,e.dispatchEvent({type:"removed"})}}},this.clone=function(e){return new Gv(r,a,e)},this.onRenderBatchComplete=function(e){Ji&&void 0!==e.nodeIndex&&o.unlockTile(n.getIteratorOutOfCoreManagerId(),e.nodeIndex)}}class zv{constructor(){}dtor(){}clone(){}nextBatch(){}reset(e,t){}getGeomScenes(){}getSceneCount(){}getVisibleBounds(e,t,i){}rayCast(e,t,i){}}class Hv extends zv{nextBatch(){return null}getGeomScenes(){return new Array}getSceneCount(){return 0}clone(){return new Hv}}class Wv{#Ge=new Map;#ze="NoOp";#He=null;#K=void 0;#We=void 0;#je;constructor(){this.addTraversalController("NoOp",new Hv)}addTraversalController(e,t){this.#Ge.has(e)&&this.#Ge.get(e).dtor(),this.#Ge.set(e,t),this.#qe()}getTraversalController(){return this.#Ge.get(this.#ze)}#qe(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]||!this.#Ge.has("BVH")?this.#Ge.has("Linear")?this.#ze="Linear":this.#Ge.has("Custom")?this.#ze="Custom":this.#ze="NoOp":this.#ze="BVH"}dtor(){this.#He&&(this.#He.dispose(),this.#He=null),this.#Ge.forEach((e=>{e.dtor()})),this.#Ge=null,this.#ze=null}nextBatch(e){const t=this.getTraversalController().nextBatch();if(!t)return null;if(this.#He&&t instanceof Sc){const i=this.#He.consolidateNextBatch(t,this.#K,this.#We,e);return i||t}return t}updateView(e,t,i,n){this.#K=t,this.#We=i,this.#qe(n),this.getTraversalController().reset(t,e),this.#He&&this.#He.reset()}getVisibleBounds(e,t,i){this.getTraversalController().getVisibleBounds(e,t,i)}getScenes(){const e=this.getTraversalController();return e.isModelIteratorTexQuad?[]:e.getGeomScenes()}getSceneCount(){return this.getTraversalController().getSceneCount()}getInnerAttributes(){return{currentIterator:this.getTraversalController(),linearIterator:this.#Ge.get("Linear"),bvhIterator:this.#Ge.get("BVH"),consolidationIterator:this.#He}}setInnerAttributes(e){var t;(this.#je=this.#je||{},e._linearIterator&&e._linearIterator!==this.#je._linearIterator&&(this.#Ge.set("Linear",e._linearIterator.clone()),this.#je._linearIterator=e._linearIterator,e._linearIterator===e._iterator&&(this.#ze="Linear")),e._bvhIterator&&e._bvhIterator!==this.#je._bvhIterator&&(this.#Ge.set("BVH",e._bvhIterator.clone()),this.#je._bvhIterator=e._bvhIterator,e._bvhIterator===e._iterator&&(this.#ze="BVH")),e._consolidationIterator&&e._consolidationIterator!==this.#je._consolidationIterator&&(this.#je._consolidationIterator=e._consolidationIterator,this.#He=e._consolidationIterator.clone(this.#Ge.get("BVH"))),this.#He&&!e._consolidationIterator&&(this.#He.dispose(),this.#He=null,this.#je._consolidationIterator=null),"NoOp"==!this.#ze)&&(this.#Ge.set("Custom",null!==(t=e._iterator)&&void 0!==t&&t.clone?e._iterator.clone():e._iterator),this.#ze="Custom")}addFragment(e){"Linear"==this.#ze&&this.getTraversalController().addFragment(e)}setVisibilityLeaflet(e){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().setVisibility(e)}needsRedrawLeaflet(e){return!!this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().update(e)}clearThemingColorsLeaflet(){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().clearThemingColor()}setThemingColorLeaflet(e){return!!this.getTraversalController().isModelIteratorTexQuad&&(this.getTraversalController().setThemingColor(e),!0)}getLeafletIterator(){return this.getTraversalController().isModelIteratorTexQuad?this.getTraversalController():null}setModelTransformLeaflet(e){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().setModelMatrix(e)}getModelTransformLeaflet(){if(this.getTraversalController().isModelIteratorTexQuad)return this.getTraversalController().getModelMatrix()}getInverseModelTransformLeaflet(){if(this.getTraversalController().isModelIteratorTexQuad)return this.getTraversalController().getInverseModelMatrix()}setViewportBoundsLeaflet(e){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().setViewBounds(e)}getViewportBoundsLeaflet(){if(this.getTraversalController().isModelIteratorTexQuad)return this.getTraversalController().getViewBounds()}setDoNotCutLeaflet(e){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().setDoNotCut(e)}updateModelTransformConsolidation(){this.#He&&this.#He.modelMatrixChanged()}enableConsolidation(e,t,i){this.#He=new Gv(e,t,i)}disableConsolidation(){this.#He.dispose(),this.#He=null}getConsolidation(){var e;return null===(e=this.#He)||void 0===e?void 0:e.getConsolidation()}isEnabledConsolidation(){return!!this.#He}updateRenderProxy(e,t){this.isEnabledConsolidation()&&this.#He.updateRenderProxy(e,t)}skipOpaqueShapes(){this.getTraversalController().skipOpaqueShapes&&this.getTraversalController().skipOpaqueShapes()}}const jv=Autodesk.Viewing.Private;let qv=null,Kv=null,Xv=null;class Yv{constructor(e){this.viewer=e,this.enabled=!1,this.onCameraChanged=this.onCameraChanged.bind(this);this.maxDistSq=1e8,this.setActive(!0)}setActive(e){e!=this.enabled&&(this.enabled=e,e?this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged):this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged))}static updateModelMatrix(e,t,i){qv=qv||new jv.LmvMatrix4(!0),Kv=Kv||new jv.LmvMatrix4(!0),Xv=Xv||new jv.LmvMatrix4(!0);const n=e.myData.placementWithOffset?qv.copy(e.myData.placementWithOffset).invert():qv.identity(),r=t?Kv.copy(t):Kv.identity();i&&(r.elements[12]-=i.x,r.elements[13]-=i.y,r.elements[14]-=i.z);const o=Xv.multiplyMatrices(r,n);e.setModelTransform(o)}onCameraChanged(){if(this.viewer.impl.is2d)return;if(this.blockEvents)return;const e=this.viewer.toolController.getTool("orbit");if(null!=e&&e.isDragging)return;if(this.viewer.impl.camera.position.lengthSq()<this.maxDistSq)return;this.blockEvents=!0;const t=this.viewer.impl.camera.getGlobalPosition();this.resetGlobalOffset(t),this.blockEvents=!1}resetGlobalOffset(e){this.viewer.getVisibleModels().forEach((t=>{t.setGlobalOffset(e),this.viewer.impl.onModelTransformChanged(t)})),this.viewer.impl.camera.setGlobalOffset(e),this.viewer.impl.syncCamera(),this.viewer.autocam&&this.viewer.autocam.onGlobalOffsetChanged(e),this.viewer.autocam.sync(this.viewer.impl.camera)}}function Qv(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}const Zv=Autodesk.Viewing,$v="Job canceled. While ";var Jv=(()=>{const e=new(v().Vector4);return(t,i)=>{e.copy(t);for(let t=0;t<i.length;t++)if(i[t].dot(e)>1e-6)return!0;return!1}})(),ey=1;class ty{#Ke=new(v().Box3);#Xe=new(v().Box3);#Ye=new(v().Box3);visibleBoundsDirty=!1;#Qe=0;id=ey++;#Ze=null;#R=null;#$e=new Wv;#Je=null;#et=[];#tt=null;#it=void 0;#nt=0;#K=null;#We=vc.RENDER_NORMAL;#rt=null;#ot=null;#st=null;#at;#lt;#ct;RenderBatch=Sc;#ut=!1;#ht;#dt;visibilityManager=null;#ft=new(v().Plane);#pt=new(v().Vector3);#mt;#gt;#vt;#yt;#bt={};#xt=null;#_t=null;_currentConsolidationOptions={};static _consolidationCounter=0;static _consolidationWorker=null;static _consolidationJobs=new Map;static _workerRefCount=0;static addJob(e){ty._consolidationWorker||(ty._consolidationWorker=fi("ConsolidationWorker"));let t=!1;return e.stopIfCanceled=function(){if(t)throw $v+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")},e.cancel=()=>{t=!0},e.signalProgress=t=>{e.model.loader.viewer3DImpl&&e.model.loader.viewer3DImpl.signalProgress(t,Gp.OPTIMIZING,e.model)},e.worker=ty._consolidationWorker,e.id=ty._consolidationCounter++,e.signalProgress(.1),this._consolidationJobs.set(e.id,e),e}static removeJob(e){var t;null===(t=e.model.loader)||void 0===t||t.viewer3DImpl.signalProgress(100,Gp.OPTIMIZING,this),ty._consolidationJobs.delete(e.id)}static _registerConsolidationWorker(){ty._workerRefCount++}static async _unregisterConsolidationWorker(){if(this._workerRefCount--,0===ty._workerRefCount&&ty._consolidationWorker){const e=[];this._consolidationJobs.forEach((t=>{t.cancel(),e.push(t.promise)})),Promise.all(e).then((()=>{0===this._consolidationJobs.size&&(rt.info("Shutting down consolidation worker"),ty._consolidationWorker.terminate(),ty._consolidationWorker=null)}))}}constructor(e){this.#yt=e,this.#mt=e.modelSpaceBBox,this.#gt=e.bbox,this.#vt=e.placementWithOffset,ty._registerConsolidationWorker()}dtor(){this.#Et()}setModelFormat(e){this.#bt=e}initialize(){var e,t;const i=this.#yt.numGeoms,n=!function(e,t,i){return!(e&&e-3*t*2<=zi&&i<Hi)}(this.#yt.packFileTotalSize,this.#yt.primitiveCount,i);this.#Ze=new Cl(i,this.#bt.is2d,n,this.#bt.isOTG);const r=(null===(e=this.#yt.metadata)||void 0===e||null===(e=e.stats)||void 0===e?void 0:e.num_materials)??0,o=(null===(t=this.#yt.metadata)||void 0===t||null===(t=t.stats)||void 0===t?void 0:t.num_geoms)??0,s=this.#yt.fragments;this.#R=new Sl(s,this.getGeometryList(),this.id,r,o,this.#bt);const a=this.getModelBounds();a&&(this.#Ke.copy(a),this.#Xe.copy(a))}addTraversalController(e,t){if(this.#$e.addTraversalController(e,t),"BVH"!==e)this.invalidateBBoxes();else{const e=t.getBVH();e.nodes.getBoxThree(0,this.#Ke),e.nodes.getBoxThree(0,this.#Xe)}for(const e of this.#et)e(t);this.#St({type:Autodesk.Viewing.MODEL_TRAVERSAL_CONTROLLER_ADDED,model:this,controllerType:e})}getGeometryList(){return this.#Ze}getFragmentList(){return this.#R}getModelId(){return this.id}getIterator(){return this.#$e.getTraversalController()}isIdRemapValid(){return null!=this.#ht}#At(e){if(!this.#it)return;return e-this.#it}#Et(){this.isConsolidated()&&this.untrackConsolidatedGeometry(),this._cancelConsolidationJob(),ty._unregisterConsolidationWorker(),this.#$e.dtor(),this.#Je=null,this.#Ze=null,this.#R&&(this.#R.dtor(this.loader.viewer3DImpl.geomCache(!1)),this.#R=null),this.#yt&&(this.#yt=null)}activateFragment(e,t,i){this.#R&&(this.#R.setMesh(e,t,i),this.#$e.addFragment(e),this.#R.getWorldBounds(e,this.#Ye),this.#Ke.union(this.#Ye),this.#Xe.union(this.#Ye))}setFragment(e,t,i){return void 0===e&&(e=this.getFragmentList().getNextAvailableFragmentId()),this.#R.setMesh(e,t,!0,i),this.#$e.addFragment(e),this.#R.getWorldBounds(e,this.#Ye),this.#Ke.union(this.#Ye),this.#Xe.union(this.#Ye),e}registerIteratorChangedCallback(e){this.#et.push(e)}removeIteratorChangedCallback=function(e){const t=this.#et.indexOf(e);-1!==t&&this.#et.splice(t,1)};setBVH(e){var t;const i=new Sm;i.initialize(this,e),this.addTraversalController("BVH",i),null===(t=this.loader)||void 0===t||t.viewer3DImpl.invalidate(!1,!0)}resetIterator(e,t,i){var n;this.#nt=0,this.#We=i,this.#K=t;const r=null===(n=this.#R)||void 0===n?void 0:n.fragmentsHaveBeenAdded();return this.#$e.updateView(e,t,i,r),this.getIterator()}setRaycastIterator(e){var t;this.#Je=e,null===(t=this.#Je)||void 0===t||t.getVisibleBounds(this.#Ke,this.#Xe,!0)}getRaycastIterator(){return this.#Je}nextBatch(e,t){for(;;){this.#nt++;const i=this.#$e.nextBatch(t);if(!i)return null;if(i.modelId=this.id,i instanceof v().Scene)return i;if(rn&&!Ji&&i instanceof Ac)return this.applyVisibility(i,this.#We,this.#K),i;if(this.applyVisibility(i,this.#We,this.#K))return i;if(performance.now()>e)return null}}applyVisibility(e,t,i){const n=!e.applyVisibility(t,i);return this.#bt.is2d?n:!!n&&(e.sortObjects&&!this.getFragmentList().useThreeMesh?(e.sortByDepth(i),!0):(e.sortDone||e.sortByMaterial(),!0))}trimPageShadowGeometry(e){if(this.hasPageShadow()){const t=Autodesk.Viewing.Private.F2dShadowRatio;e=e.clone();const i=this.getMetadata("page_dimensions","page_width");e.max.x-=i*t,e.min.y+=i*t}return e}getVisibleBounds(e,t){var i;this.visibleBoundsDirty&&(this.#Ke.makeEmpty(),this.#Xe.makeEmpty(),this.#$e.getVisibleBounds(this.#Ke,this.#Xe,e),null===(i=this.#Je)||void 0===i||i.getVisibleBounds(this.#Ke,this.#Xe,e),this.visibleBoundsDirty=!1);let n=e?this.#Xe:this.#Ke;return t&&(n=this.trimPageShadowGeometry(n)),n}rayIntersect2D(e,t,i,n){const r=this.getModelBounds(!0),o=r.getCenter(new(v().Vector3));let s=new(v().Vector3);this.#ft.normal.set(0,0,1),this.#ft.constant=-o.z;const a=this.getModelToViewerTransform();if(a&&this.#ft.applyMatrix4(a),s=e.ray.intersectPlane(this.#ft,s),s){this.#pt.copy(s);const a=this.getInverseModelToViewerTransform();if(a&&(this.#pt.applyMatrix4(a),this.#pt.z=o.z),r.containsPoint(this.#pt)){var l;const r=null===(l=this.#R)||void 0===l||null===(l=l.getMaterial(0))||void 0===l?void 0:l.cutplanes;if(r&&Jv(s,r))return;const o=e.ray.origin.distanceTo(s);if(o<e.near||o>e.far)return;let a,u;if(n){const e=n(s);if(a=e[0],t&&t.length>0&&!t.includes(a))return;const i=e[1];if(0!==i&&i!==this.id)return;var c;u=null===(c=this.#R)||void 0===c?void 0:c.fragments.dbId2fragId[a]}const h={intersectPoint:s,point:s,distance:o,dbId:a&&this.remapDbIdFor2D(a),fragId:u,model:this};return i&&i.push(h),h}}return null}rayIntersect(e,t,i,n,r,o){if(this.ignoreRayIntersect)return null;if(this.#bt.is2d)return this.rayIntersect2D(e,i,n,r);this.visibleBoundsDirty&&this.getVisibleBounds();var s,a=[];if(i&&i.length>0){var l=this.getInstanceTree(),c=[];if(l)for(s=0;s<i.length;s++)l.enumNodeFragments(i[s],(function(e){c.push(e)}),!0);else c=i;if(c.length>2){(this.#Je||this.getIterator()).rayCast(e,a,i)}else for(s=0;s<c.length;s++){var u=this.#R.getVizmesh(c[s]);if(u){var h=oc.rayCast(u,e,a,o);h&&a.push(h)}}}else{(this.#Je||this.getIterator()).rayCast(e,a,void 0,o)}if(!a.length)return null;a.sort((function(e,t){return e.distance-t.distance}));var d=!!n;for(n=n||[],s=0;s<a.length;s++){var f=a[s].fragId;if(this.isFragVisible(f)){var p=this.#R.getMaterial(f);if(t&&p.transparent)continue;var m=a[s],g=!1;if(p&&p.cutplanes&&(g=Jv(m.point,p.cutplanes)),g||n.push(m),m.model=this,!d&&n.length>0)break}}var v=n[0]||null;return v&&(v.model=this),v}setHighlighted(e,t){if(!this.#R)return!1;var i=this.#R.setHighlighted(e,t);return i&&(t?this.#Qe++:this.#Qe--),i}setVisibility(e,t){this.#R?this.#R.setVisibility(e,t):this.isLeaflet()&&this.#$e.setVisibilityLeaflet(t),this.invalidateBBoxes()}setAllVisibility(e){this.#R?this.#R.setAllVisibility(e):this.isLeaflet()&&this.#$e.setVisibilityLeaflet(e),this.invalidateBBoxes()}hideLines(e){this.#R&&this.#R.hideLines(e)}hidePoints(e){this.#R&&this.#R.hidePoints(e)}hasHighlighted(){return!!this.#Qe}isFragVisible(e){return this.#R.isFragVisible(e)}areAllVisible(){return!this.#R||this.#R.areAllVisible()}getGeomScenes(){return this.#$e.getScenes()}getRenderProgress(){const e=this.#nt/this.#$e.getSceneCount();return e>1?1:e}update(e){return this.#$e.needsRedrawLeaflet(e)}setThemingColor(e,t,i){if(this.#R){e=this.reverseMapDbIdFor2D(e);const n=this.getInstanceTree();return i&&n?void n.enumNodeChildren(e,(e=>{this.#R.setThemingColor(e,t)}),!0):void this.#R.setThemingColor(e,t)}this.#$e.setThemingColorLeaflet(t)||rt.warn("Theming colors are not supported by this model type.")}clearThemingColors(){this.#R?this.#R.clearThemingColors():this.#$e.clearThemingColorsLeaflet()}getLeaflet(){return this.#$e.getLeafletIterator()}chooseMemoryTypes(){if(Ji&&!this.#bt.is2d)return;const e=this.#$e.getConsolidation();var t=this.getGeometryList(),i=[];let n;for(o=1;o<t.getCount();o++)n=t.getGeometry(o),n&&(wl.untrackGeometry(t,n,!1,!n.streamingDraw,!0),n.streamingDraw=n.streamingIndex=void 0);const r=this.getFragmentList();if(e)for(var o=0;o<e.meshes.length;o++){var s,a=e.meshes[o];n=(null===(s=a)||void 0===s?void 0:s.geometry)||r.getGeometry(a.fragId),n.byteSize||(n.byteSize=Nc(n));var l=Number.isInteger(a.fragId);if(l){const e=void 0!==n.id?n.id:n.svfid;if(i[e])continue;i[e]=!0}wl.setMemoryType(t,n,n.numInstances||1,this.#bt.is2d),l||(n.streamingDraw?wl.trackGeometry(t,n):n.discardAfterUpload=!0)}for(o=1;o<t.getCount();o++){if(n=t.getGeometry(o),!n)continue;i[void 0!==n.id?n.id:o]||wl.setMemoryType(t,n,t.getInstanceCount(o),this.#bt.is2d),n.streamingDraw&&n.dispose()}}#wt(e,t){return!Ji&&this._currentConsolidationOptions.byteLimit!==e||!Tg()(this._currentConsolidationOptions.bvhOptions,t)}_cancelConsolidationJob(){this.#xt&&!this.#xt.canceled&&(rt.info("Canceling consolidation job.",this.#xt.id),this.#xt.cancel())}async consolidateAsync(e,t,i){var n;let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(sn&&Ji)t=0;else if(sn)return void console.warn("Skipping model consolidation, because it is not supported in WebGPU.");t=t||Wi,this.isConsolidating()&&this._cancelConsolidationJob();const s=null===(n=this.getData().loadOptions.bvhOptions)||void 0===n?void 0:n.consolidation;if(this.cachedConsolidationData&&!o){const e=this.getIterator().getBVH(),t=new Uint32Array(e.primitives.length);Fv(e,t),this.#tt=new _v(0,0,t,this.cachedConsolidationData),this.cachedConsolidationData=null,this._currentConsolidationOptions.bvhOptions=e.options}else o||=this.#wt(t,s);const a={byteLimit:t,forceConsolidationMapRecomputation:o,bvhOptions:s,syncTimeSlice:rn?20:1/0,consolidationMap:this.#tt,useDeferredConsolidation:r,model:this};return rt.info("Starting consolidation",a.id),this.#it=performance.now(),this.#xt=ty.addJob(a),this.#_t=this.#xt.promise=Vv(this,e,a).then((e=>{var i;if(a.canceled)return void rt.debug("Skipping results of canceled consolidation",a.id);this.isConsolidated()&&this.unconsolidate(!1,!1,!1),this.#tt=e.consolidationMap;const n=a.consolidationBVH;n&&this.setBVH(n),this.#$e.enableConsolidation(this.#R,e,this.#$e.getTraversalController("BVH")),this.#St({type:cm,model:this}),this.chooseMemoryTypes(),this._currentConsolidationOptions.byteLimit=t,this._currentConsolidationOptions.bvhOptions=s,rt.info("Consolidation finished",a.id);const r={urn:null===(i=this.getData())||void 0===i?void 0:i.urn,is_enabled_HLOD:rn,consolidation_time:this.#At(performance.now())};Autodesk.Viewing.Private.analytics.track("viewer.model.consolidation",r)})).finally((()=>{this.#_t=null,this.#xt=null,ty.removeJob(a)})).catch((e=>{var t;null!=e&&null!==(t=e.startsWith)&&void 0!==t&&t.call(e,$v)?rt.info("Consolidation canceled."):rt.error("Consolidation failed.",e)})),this.#_t}untrackConsolidatedGeometry(){const e=this.#$e.getConsolidation();for(let t=0;t<e.meshes.length;t++){const i=e.meshes[t];if(!Number.isInteger(i.fragId)){const e=i.geometry;wl.untrackGeometry(this.getGeometryList(),e,e.streamingDraw)}}}consolidate(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return console.warn("RenderModel.consolidate is deprecated. Use consolidateAsync instead."),this.consolidateAsync(e,t,i,n)}unconsolidate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.isConsolidating()&&this._cancelConsolidationJob(),this.isConsolidated()&&(this.untrackConsolidatedGeometry(),this.#$e.disableConsolidation(),this.#St({type:um,model:this}),t&&(this._currentConsolidationOptions={},this.#tt=null),e&&this.chooseMemoryTypes())}isConsolidated(){return this.#$e.isEnabledConsolidation()}isConsolidating(){return null!=this.#_t}getConsolidationPromise(){return this.#_t||Promise.resolve()}getConsolidation(){return this.#$e.getConsolidation()}getConsolidationBlobForCaching(){const e=this.#tt;if(!e)return null;const t=16+e.fragOrder.byteLength,i=t+e.ranges.byteLength,n=6*e.boxes.length*4,r=i+n,o=e.bvhNodeIndices.byteLength,s=new Uint8Array(r+o),a=new Uint32Array(s.buffer);a[0]=t,a[1]=i,a[2]=r,a[3]=e.numConsolidated,s.set(Qv(e.fragOrder),16),s.set(Qv(e.ranges),t),s.set(Qv(e.bvhNodeIndices),r);const l=new Float32Array(s.buffer,i,n/4);for(let t=0;t<e.boxes.length;t++){const i=e.boxes[t],n=6*t;l[n+0]=i.min.x,l[n+1]=i.min.y,l[n+2]=i.min.z,l[n+3]=i.max.x,l[n+4]=i.max.y,l[n+5]=i.max.z}return s}setCachedConsolidationBlob(e){const t=new Uint32Array(e.buffer,0,4),i=t.byteLength,n=t[0],r=t[1],o=t[2],s=t[3],a=new Uint32Array(e.buffer,i,(n-i)/4),l=new Uint32Array(e.buffer,n,(r-n)/4),c=new Float32Array(e.buffer,r,(o-r)/4),u=new Uint32Array(e.buffer,o,(e.byteLength-o)/4),h=[],d=new(v().Vector3),f=new(v().Vector3);for(let e=0;e<c.length;e+=6){d.set(c[e+0],c[e+1],c[e+2]),f.set(c[e+3],c[e+4],c[e+5]);const t=(new(v().Box3)).set(d,f);h.push(t)}this.cachedConsolidationData={fragOrder:a,ranges:l,boxes:h,numConsolidated:s,bvhNodeIndices:u}}setDbIdRemap(e){this.#ht=e}remapDbId(e){return this.#ht&&e>0&&e<this.#ht.length?this.#ht[e]:e}remapDbIdFor2D(e){return this.#bt.is2d?this.remapDbId(e):e}reverseMapDbId(e){if(!this.#ht||e<=0)return e;if(!this.#dt){this.#dt={};for(var t=0;t<this.#ht.length;t++)this.#dt[this.#ht[t]]=t}return this.#dt[e]}reverseMapDbIdFor2D(e){return this.#bt.is2d?this.reverseMapDbId(e):e}updateRenderProxy(e,t){this.#$e.updateRenderProxy(e,t)}skipOpaqueShapes(){this.#$e.skipOpaqueShapes()}invalidateBBoxes(){this.visibleBoundsDirty=!0}changePaperVisibility(e){var t;this.#bt.is2d&&(null===(t=this.#R)||void 0===t||t.setObject2DVisible(-1,e))}hasPaperTransparency(){var e;if(!this.#bt.is2d)return!1;const t=(null===(e=this.#R)||void 0===e?void 0:e.dbIdOpacity[-1])??1;return t>0&&t<1}setModelTransform(e){this.#$e.setModelTransformLeaflet(e),this.isLeaflet()||(this.#R.setModelMatrix(e),this.#$e.updateModelTransformConsolidation()),this.invalidateBBoxes(),this.getVisibleBounds(!0),this.#ot=null,this.#st=null}getModelTransform(){var e;const t=this.#$e.getModelTransformLeaflet();return t||(null===(e=this.#R)||void 0===e?void 0:e.matrix)}getModelBounds(e,t){if(!this.#mt&&!this.#gt)return null;const i=new(v().Box3);if(i.copy(this.#mt||this.#gt),t&&i.copy(this.trimPageShadowGeometry(i)),e)return i;this.#vt&&this.#mt&&i.applyMatrix4(this.#vt);const n=this.getModelTransform();return n&&i.applyMatrix4(n),i}updateModelBBoxOriginal(e){this.#mt=e}getInverseModelTransform(){var e;const t=this.#$e.getInverseModelTransformLeaflet();return t||(null===(e=this.#R)||void 0===e?void 0:e.getInverseModelMatrix())}getPlacementTransform(){return this.#rt=this.#rt||new al(!0),this.#at||this.getData().placementTransform||this.#rt}getGlobalOffset(){return this.#lt||this.getData().globalOffset}setPlacementTransform(e){this.#at=(this.#at||new al(!0)).copy(e),Yv.updateModelMatrix(this,e,this.getGlobalOffset())}setGlobalOffset(e){this.#lt=this.#lt||new(v().Vector3),this.#lt.copy(e);var t=this.getPlacementTransform();Yv.updateModelMatrix(this,t,e)}getModelToViewerTransform(){var e;if(this.#ot)return this.#ot;const t=this.getModelTransform(),i=null===(e=this.getData())||void 0===e?void 0:e.placementWithOffset;return(t||i)&&(this.#ot=new(v().Matrix4),t&&this.#ot.multiply(t),i&&this.#ot.multiply(i)),this.#ot}getInverseModelToViewerTransform(){if(this.#st)return this.#st;const e=this.getModelToViewerTransform();return e&&(this.#st=e.clone().invert()),this.#st}getInversePlacementWithOffset(){return this.myData.placementWithOffset?(this.#ct||(this.#ct=new al(!0).copy(this.myData.placementWithOffset).invert()),this.#ct):null}setInnerAttributes(e){this.id=e._id,this.#Ke=e._visibleBounds,this.#Xe=e._visibleBoundsWithHidden,this.#Ye=e._tmpBox,this.#Qe=e._numHighlighted,this.#Ze=e._geoms,this.#R=e._frags,this.#tt=e._consolidationMap,this.#nt=e._renderCounter,this.#K=e._frustum,this.#We=e._drawMode,this.#ht=e._idRemap,this.#dt=e._reverseMap;const t={_iterator:e._iterator,_linearIterator:e._linearIterator,_bvhIterator:e._bvhIterator,_consolidationIterator:e._consolidationIterator};this.#$e.setInnerAttributes(t)}getInnerAttributes(){const e=this.#$e.getInnerAttributes();return{_id:this.id,_visibleBounds:this.#Ke,_visibleBoundsWithHidden:this.#Xe,_tmpBox:this.#Ye,_numHighlighted:this.#Qe,_geoms:this.#Ze,_frags:this.#R,_linearIterator:e.linearIterator,_bvhIterator:e.bvhIterator,_iterator:e.currentIterator,_consolidationIterator:e.consolidationIterator,_consolidationMap:this.#tt,_renderCounter:this.#nt,_frustum:this.#K,_drawMode:this.#We,_idRemap:this.#ht,_reverseMap:this.#dt}}setDoNotCut(e,t){if(this.#ut===t)return;this.#ut=t,this.#R?this.#R.setDoNotCut(t):this.isLeaflet()&&this.#$e.setDoNotCutLeaflet(t);e.forEachInModel(this,!1,(i=>{var n;i.doNotCut=t;(null===(n=i.cutplanes)||void 0===n?void 0:n.length)>0===t&&(e._applyCutPlanes(i),i.needsUpdate=!0)}))}getDoNotCut(){return this.#ut}setViewportBounds(e,t){this.isLeaflet()?this.#$e.setViewportBoundsLeaflet(t):this.#R&&(t=t||this.isPdf()&&this.getModelBounds(!0,!0),this.#R.setViewBounds(t),e.setViewportBoundsForModel(this,t)),this.invalidateBBoxes()}getViewportBounds(){var e;return this.isLeaflet()?this.#$e.getViewportBoundsLeaflet():null===(e=this.#R)||void 0===e?void 0:e.getViewBounds()}load(e){let t=0;return(this.#bt.isSVF2||this.#bt.isOTG)&&(t=this.loader.loadFragments(e)),t}unload(e){let t=0;return(this.#bt.isSVF2||this.#bt.isOTG)&&(t=this.getFragmentList().unload(e,this.loader.viewer3DImpl.geomCache(!1)),t>0&&(this.getData().fragsLoaded-=t,this.#St({type:Zv.FRAGMENTS_UNLOADED_EVENT,model:this}))),t}#St(e){var t;null!==(t=this.loader)&&void 0!==t&&null!==(t=t.viewer3DImpl)&&void 0!==t&&t.api&&this.loader.viewer3DImpl.api.dispatchEvent(e)}}class iy{constructor(e){this._frags=e.getFragmentList(),this._RenderBatch=e.RenderBatch,this._model=e,this._is2d=this._model.is2d(),this._fragsPerScene=function(e){let t=500;return e&&(t/=6),F()&&(t/=3),t=Math.floor(t),t>0?t:500}(e.is2d()),this._fragOrder=null,this._geomScenes=[],this._secondPassIndex=null;const t=this._frags.getCount();this._currentScene=0,this._fragOrder=new Int32Array(t);for(let e=0;e<t;e++)this._fragOrder[e]=e;this.setFragmentOrder(t)}dtor(){this.model=null,this._RenderBatch=null,this._frags=null}setFragmentOrder(e){var t=Math.floor((e+this._fragsPerScene-1)/this._fragsPerScene);this._geomScenes.length=t;for(let i=0;i<t;i++){let t=i*this._fragsPerScene,n=this._geomScenes[i]=new this._RenderBatch(this,this._frags,t,this._fragsPerScene),r=t+this._fragsPerScene;r>e&&(r=e),n.lastItem=r,n.count=n.lastItem-t}}addFragment(e){if(this._fragOrder.length<=e){var t=2*this._fragOrder.length;t<=e&&(t=e+1);var i=new Int32Array(t);i.set(this._fragOrder),this._fragOrder=i,this.visibleBoundsDirty=!0}this._fragOrder[e]=e;var n=Math.floor(e/this._fragsPerScene);if(this._geomScenes){var r=this._geomScenes[n];r&&!r.isSecondPass||(r=new this._RenderBatch(this,this._frags,n*this._fragsPerScene,this._fragsPerScene),null===this._secondPassIndex?this._geomScenes[n]=r:this.insertSceneToSecondPass(n,r)),r&&(r.onFragmentAdded(e),null!==this._secondPassIndex&&this._geomScenes[this._secondPassIndex+n].onFragmentAdded(e))}}insertSceneToSecondPass(e,t){const i=this._geomScenes.slice(0,this._secondPassIndex),n=this._geomScenes.slice(this._secondPassIndex);i[e]=t,n[e]=this.cloneForSecondPass(t),this._secondPassIndex=i.length,this._geomScenes=i.concat(n)}reset(e,t){if(this._currentScene=0,this._is2d&&this._geomScenes[0]&&(this._geomScenes[0].drawEnd=0,null!==this._secondPassIndex&&(this._geomScenes[this._secondPassIndex].drawEnd=0)),this._resetVisStatus){let e=this._geomScenes,t=e.length;for(let n=0;n<t;++n){var i=e[n];i&&i.resetVisStatus&&i.resetVisStatus()}this._resetVisStatus=!1}}getSceneCount(){return this._geomScenes.length}getGeomScenes(){return this._geomScenes}getFragOrder(){return this._fragOrder}resetVisStatus(){this._resetVisStatus=!0}done(){return!(this._is2d&&!this._model.isLoadDone())&&(this._currentScene>=this._geomScenes.length-1&&(!(e=this._geomScenes[this._currentScene])||e.drawStart>=e.lastItem));var e}nextBatch(){if(this._currentScene>=this.getSceneCount())return null;let e=this._geomScenes[this._currentScene];if(this._is2d){const t=this.areTwoPassesNeeded();if(e.lastItem>=e.start+e.count&&(++this._currentScene,this._geomScenes[this._currentScene]&&(this._geomScenes[this._currentScene].drawEnd=this._geomScenes[this._currentScene].start)),e.drawStart=e.drawEnd,e.drawEnd=e.lastItem,e.hasOwnProperty("drawStart")&&e.lastItem<=e.drawStart){return t&&!this._isSecondPass?(this._currentScene=this._secondPassIndex,this.nextBatch()):null}const i=!this._model.areAllVisible()||this._isSecondPass;e.renderImportance=i?-1:1e20,e.needsTwoPasses=t}else e.renderImportance=0,++this._currentScene;return e}areTwoPassesNeeded(){const e=this._model.hasPaperTransparency();return e&&null===this._secondPassIndex&&this.addSecondPassScenes(),this._isSecondPass=!!(e&&this._currentScene>=this._secondPassIndex),e}cloneForSecondPass(e){if(!e)return;const t=e.clone();return t.isSecondPass=!0,t}addSecondPassScenes(){const e=this._geomScenes.length;e&&(this._geomScenes=this._geomScenes.concat(this._geomScenes.map(this.cloneForSecondPass)),this._secondPassIndex=e)}getVisibleBounds(e,t){for(var i=this.getSceneCount(),n=0;n<i;n++){this._geomScenes[n].calculateBounds();var r=this._geomScenes[n].getBoundingBox();e.union(r),t.union(r),t.union(this._geomScenes[n].getBoundingBoxHidden())}}rayCast(e,t,i){for(var n=this.getSceneCount(),r=0;r<n;r++)this._geomScenes[r].raycast(e,t,i)}intersectFrustum(e,t){for(let i of this._geomScenes){if(!i)continue;let n=e.intersectsBox(i.getBoundingBox());n!==ac.OUTSIDE&&i.intersectFrustum(e,t,n===ac.CONTAINS)}}clone(){const e=new iy(this._model);for(let t=0;t<this._geomScenes.length;t++)e._geomScenes[t].bboxes=this._geomScenes[t].bboxes.slice();return e}}class ny extends v().Camera{constructor(e,t){super(),this.fov=45,this.near=.1,this.far=1e5,this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.clientWidth=e,this.clientHeight=t,this.target=new(v().Vector3)(0,0,-1),this.worldup=new(v().Vector3)(0,1,0),this.viewInverseEnv=new(v().Matrix4),this.projScreenMatrix=new(v().Matrix4),this.orthographicCamera=new(v().OrthographicCamera)(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new(v().PerspectiveCamera)(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.globalOffset=new(v().Vector3),this.toPerspective()}get isOrthographicCamera(){return!this.isPerspective}clone(e){return e=e||new ny(2*this.right,2*this.top),v().Camera.prototype.clone.call(this,e),e.position.copy(this.position),e.up.copy(this.up),this.target&&(e.target=this.target.clone()),this.worldup&&(e.worldup=this.worldup.clone()),this.worldUpTransform&&(e.worldUpTransform=this.worldUpTransform.clone()),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.fov=this.fov,e.aspect=this.aspect,e.zoom=this.zoom,e.clientWidth=this.clientWidth,e.clientHeight=this.clientHeight,e.isPerspective=this.isPerspective,e.globalOffset=this.globalOffset.clone(),e.orthoScale=this.orthoScale,e.updateProjectionMatrix(),e}__computeFovPosition(e){if(Math.abs(this.fov-e)<=1e-4)return this.position.clone();var t,i,n=this.target.clone().sub(this.position),r=n.clone().normalize(),o=v().Math.degToRad(this.fov),s=v().Math.degToRad(e),a=Math.tan(.5*o)/Math.tan(.5*s);this.pivot?(t=(new(v().Plane)).setFromNormalAndCoplanarPoint(r.clone().negate(),this.pivot).distanceToPoint(this.position),i=r.clone().multiplyScalar(t).add(this.position)):(t=n.length(),i=this.target);t*=a;var l=r.multiplyScalar(-t);return i.clone().add(l)}toPerspective(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0}toOrthographic(){if(this.isPerspective){this.saveFov=this.fov;var e=ny.ORTHO_FOV;this.position.copy(this.__computeFovPosition(e)),this.fov=e}this.orthoScale=this.target.clone().sub(this.position).length();var t=.5*this.orthoScale,i=t*this.aspect;this.left=this.orthographicCamera.left=-i,this.right=this.orthographicCamera.right=i,this.top=this.orthographicCamera.top=t,this.bottom=this.orthographicCamera.bottom=-t,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1}updateProjectionMatrix(){this.isPerspective?this.toPerspective():this.toOrthographic()}setSize(e,t){this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2}setFov(e){this.fov=e,this.updateProjectionMatrix()}setLens(e,t){void 0===t&&(t=24);var i=2*v().Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(i),i}setViewFromBox(e,t){ny.getViewParamsFromBox(e,t,this.aspect,this.up,this.fov,this),this.updateCameraMatrices()}updateCameraMatrices(){this.lookAt(this.target),this.updateProjectionMatrix(),this.updateMatrixWorld()}setView(e){if(e.position&&this.position.copy(e.position),e.target&&this.target.copy(e.target),e.up&&this.up.copy(e.up),void 0!==e.isPerspective&&(this.isPerspective=e.isPerspective),void 0!==e.orthoScale){this.orthoScale=e.orthoScale;const t=this.target.clone().sub(this.position);this.isPerspective||t.length()===this.orthoScale||(t.normalize().multiplyScalar(this.orthoScale),this.target.copy(t.add(this.position)))}this.updateCameraMatrices()}pixelsPerUnitAtDistance(e){if(!this.isPerspective)return this.clientHeight/this.orthoScale;const t=2*e*Math.tan(v().Math.degToRad(.5*this.fov));return this.clientHeight/t}UnifpixelsPerUnitAtPoint(e){const t=this.position.distanceTo(e);return this.pixelsPerUnitAtDistance(t)}setGlobalOffset(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i;(e!==this.position&&e!==this.target&&e!==this.pivot||(e=e.clone()),t)&&(this.position.add(this.globalOffset).sub(e),this.target.add(this.globalOffset).sub(e),null===(i=this.pivot)||void 0===i||i.add(this.globalOffset).sub(e));this.globalOffset.copy(e)}getGlobalPosition(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new(v().Vector3)).copy(this.position).add(this.globalOffset)}viewportToRay(e,t){e.z=-1;var i=new(v().Vector3)(e.x,e.y,1);return e=e.unproject(this),(i=i.unproject(this)).sub(e).normalize(),t||(t=new(v().Ray)),t.set(this.isPerspective?this.position:e,i),t}transformCurrentView(e){ny.transformViewParams(this,e)}}ny.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,ny.getViewParamsFromBox=function(e,t,i,n,r,o){var s=o||{},a=e.getSize(new(v().Vector3));if(s.target=e.getCenter(new(v().Vector3)),s.position||(s.position=new(v().Vector3)),s.up||(s.up=new(v().Vector3)),t){s.isPerspective=!1;var l=a.x/a.y,c=i;s.orthoScale=c>l?a.y:a.x/c,s.up.set(0,1,0),s.position.copy(s.target),s.position.z+=s.orthoScale,s.target.y+=1e-6*a.y}else s.isPerspective=!0,s.fov=r,s.up.copy(n),s.position.copy(s.target),s.position.z+=1.5*Math.max(a.x,a.y,a.z);return s},ny.copyViewParams=function(e,t){return(t=t||{}).position=(t.position||new(v().Vector3)).copy(e.position),t.target=(t.target||new(v().Vector3)).copy(e.target),t.up=(t.up||new(v().Vector3)).copy(e.up),t.aspect=e.aspect,t.fov=e.fov,t.isPerspective=e.isPerspective,t.orthoScale=e.orthoScale,t},ny.transformViewParams=function(e,t){var i;e.position.applyMatrix4(t),e.target.applyMatrix4(t),null===(i=e.pivot)||void 0===i||i.applyMatrix4(t),e.up.transformDirection(t)},ny.adjustOrthoCamera=function(e,t){if(!e.isPerspective){var i=t.getSize(new(v().Vector3)),n=e.target.clone().sub(e.position),r=n.length();if(i>0&&r>1e3*i.length()){var o=e.position.distanceTo(t.getCenter(new(v().Vector3)));e.target.copy(e.position).add(n.normalize().multiplyScalar(o))}else{if(Math.abs(r-e.orthoScale)/r>1e-5)rt.warn("Ortho scale does not match eye-target distance. One of them is likely wrong, but which one?"),!(0===e.fov&&1===e.orthoScale)&&e.position.copy(e.target).add(n.normalize().multiplyScalar(-e.orthoScale))}}},ny.prototype.isUnifiedCamera=!0;const ry=JSON.parse('{"zA":{"1ToRatio":{"unitSystem":"Metric","parentUnits":{"ratioTo1":-1},"symbols":{"1Colon":{"text":"1:","placement":"Prefix","space":false}}},"acres":{"unitSystem":"Imperial","factor":4840,"parentUnits":{"squareYards":1},"symbols":{"acres":{"text":"acres","placement":"Suffix","space":true}}},"ampereHours":{"unitSystem":"Metric","parentUnits":{"amperes":1,"hours":1},"symbols":{"aDashH":{"text":"A-h","placement":"Suffix","space":true}}},"ampereSeconds":{"unitSystem":"Metric","parentUnits":{"amperes":1,"seconds":1},"symbols":{"aDashS":{"text":"A-s","placement":"Suffix","space":true}}},"amperes":{"unitSystem":"Metric","dimension":"electricCurrent","symbols":{"ampere":{"text":"A","placement":"Suffix","space":true}}},"atmospheres":{"unitSystem":"Imperial","factor":101325,"parentUnits":{"pascals":1},"symbols":{"atm":{"text":"atm","placement":"Suffix","space":true}}},"bars":{"unitSystem":"Metric","factor":100,"parentUnits":{"kilopascals":1},"symbols":{"bar":{"text":"bar","placement":"Suffix","space":true}}},"britishThermalUnits":{"unitSystem":"Imperial","factor":1055.05585262,"parentUnits":{"joules":1},"symbols":{"btu":{"text":"Btu","placement":"Suffix","space":true}}},"britishThermalUnitsPerDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"fahrenheitInterval":-1},"symbols":{"btuPerDegreeF":{"text":"BTU/F","placement":"Suffix","space":true}}},"britishThermalUnitsPerHour":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"hours":-1},"symbols":{"btuPerH":{"text":"Btu/h","placement":"Suffix","space":true}}},"britishThermalUnitsPerHourCubicFoot":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerHour":1,"cubicFeet":-1},"symbols":{"btuPerHFtSup3":{"text":"Btu/(hft)","placement":"Suffix","space":true}}},"britishThermalUnitsPerHourFootDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerHour":1,"feet":-1,"fahrenheitInterval":-1},"symbols":{"btuPerHFtDegreeF":{"text":"BTU/(hftF)","placement":"Suffix","space":true}}},"britishThermalUnitsPerHourSquareFoot":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerHour":1,"squareFeet":-1},"symbols":{"btuPerHFtSup2":{"text":"Btu/(hft)","placement":"Suffix","space":true}}},"britishThermalUnitsPerHourSquareFootDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerHourSquareFoot":1,"fahrenheitInterval":-1},"symbols":{"btuPerHFtSup2DegreeF":{"text":"BTU/(hftF)","placement":"Suffix","space":true}}},"britishThermalUnitsPerPound":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"poundsMass":-1},"symbols":{"btuPerLb":{"text":"BTU/lb","placement":"Suffix","space":true}}},"britishThermalUnitsPerPoundDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerPound":1,"fahrenheitInterval":-1},"symbols":{"btuPerLbDegreeF":{"text":"BTU/(lbF)","placement":"Suffix","space":true}}},"britishThermalUnitsPerSecond":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"seconds":-1},"symbols":{"btuPerS":{"text":"Btu/s","placement":"Suffix","space":true}}},"britishThermalUnitsPerSquareFootDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"squareFeet":-1,"fahrenheitInterval":-1},"symbols":{"btuPerFtSup2DegreeF":{"text":"BTU/(ftF)","placement":"Suffix","space":true}}},"calories":{"unitSystem":"Metric","factor":4.1868,"parentUnits":{"joules":1},"symbols":{"cal":{"text":"cal","placement":"Suffix","space":true}}},"caloriesPerSecond":{"unitSystem":"Metric","parentUnits":{"calories":1,"seconds":-1},"symbols":{"calPerS":{"text":"cal/s","placement":"Suffix","space":true}}},"candelas":{"unitSystem":"Metric","dimension":"luminousIntensity","symbols":{"cd":{"text":"cd","placement":"Suffix","space":true}}},"candelasPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"candelas":1,"squareFeet":-1},"symbols":{"cdPerFtSup2":{"text":"cd/ft","placement":"Suffix","space":true}}},"candelasPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"candelas":1,"squareMeters":-1},"symbols":{"cdPerMSup2":{"text":"cd/m","placement":"Suffix","space":true}}},"celsius":{"unitSystem":"Metric","parentUnit":"celsiusInterval","offset":273.15,"symbols":{"degreeC":{"text":"C","placement":"Suffix","space":true}}},"celsiusInterval":{"unitSystem":"Metric","parentUnits":{"kelvinInterval":1},"symbols":{"degreeCInterval":{"text":"C","placement":"Suffix","space":true},"deltaDegreeC":{"text":"deltaC","placement":"Suffix","space":true}}},"centimeters":{"unitSystem":"Metric","parentFactors":{"centi":1},"parentUnits":{"meters":1},"symbols":{"cm":{"text":"cm","placement":"Suffix","space":true}}},"centimetersPerMinute":{"unitSystem":"Metric","parentUnits":{"centimeters":1,"minutes":-1},"symbols":{"cmPerMin":{"text":"cm/min","placement":"Suffix","space":true}}},"centimetersToTheFourthPower":{"unitSystem":"Metric","parentUnits":{"centimeters":4},"symbols":{"cmSup4":{"text":"cm","placement":"Suffix","space":true}}},"centimetersToTheSixthPower":{"unitSystem":"Metric","parentUnits":{"centimeters":6},"symbols":{"cmSup6":{"text":"cm","placement":"Suffix","space":true}}},"centipoises":{"unitSystem":"Metric","parentFactors":{"centi":1},"parentUnits":{"poises":1},"symbols":{"cP":{"text":"cP","placement":"Suffix","space":true}}},"circularMils":{"unitSystem":"Imperial","factor":0.25,"parentFactors":{"pi":1},"parentUnits":{"squareMils":1},"symbols":{"cMil":{"text":"cmil","placement":"Suffix","space":true}}},"coulombs":{"unitSystem":"Metric","parentUnits":{"ampereSeconds":1},"symbols":{"coulomb":{"text":"C","placement":"Suffix","space":true}}},"cubicCentimeters":{"defaultSymbol":"cmSup3","unitSystem":"Metric","parentUnits":{"centimeters":3},"symbols":{"cmCaret3":{"text":"cm^3","placement":"Suffix","space":true},"cmSup3":{"text":"cm","placement":"Suffix","space":true}}},"cubicFeet":{"defaultSymbol":"ftSup3","unitSystem":"Imperial","parentUnits":{"feet":3},"symbols":{"cf":{"text":"CF","placement":"Suffix","space":true},"ftCaret3":{"text":"ft^3","placement":"Suffix","space":true},"ftSup3":{"text":"ft","placement":"Suffix","space":true}}},"cubicFeetPerHour":{"defaultSymbol":"ftSup3PerHour","unitSystem":"Imperial","parentUnits":{"cubicFeet":1,"hours":-1},"symbols":{"cfh":{"text":"CFH","placement":"Suffix","space":true},"ftSup3PerH":{"text":"ft/h","placement":"Suffix","space":true}}},"cubicFeetPerKip":{"unitSystem":"Imperial","parentUnits":{"cubicFeet":1,"kips":-1},"symbols":{"ftSup3PerKip":{"text":"ft/kip","placement":"Suffix","space":true}}},"cubicFeetPerMinute":{"defaultSymbol":"ftSup3PerMin","unitSystem":"Imperial","parentUnits":{"cubicFeet":1,"minutes":-1},"symbols":{"cfm":{"text":"CFM","placement":"Suffix","space":true},"ftSup3PerMin":{"text":"ft/min","placement":"Suffix","space":true}}},"cubicFeetPerMinuteCubicFoot":{"defaultSymbol":"cfmPerFtSup3","unitSystem":"Imperial","parentUnits":{"cubicFeetPerMinute":1,"cubicFeet":-1},"symbols":{"cfmPerCf":{"text":"CFM/CF","placement":"Suffix","space":true},"cfmPerFtSup3":{"text":"CFM/ft","placement":"Suffix","space":true}}},"cubicFeetPerMinutePerBritishThermalUnitPerHour":{"unitSystem":"Imperial","parentUnits":{"cubicFeetPerMinute":1,"britishThermalUnitsPerHour":-1},"symbols":{"ftSup3HPerMinBtu":{"text":"fth/(minBtu)","placement":"Suffix","space":true}}},"cubicFeetPerMinuteSquareFoot":{"defaultSymbol":"cfmPerFtSup2","unitSystem":"Imperial","parentUnits":{"cubicFeetPerMinute":1,"squareFeet":-1},"symbols":{"cfmPerFtSup2":{"text":"CFM/ft","placement":"Suffix","space":true},"cfmPerSf":{"text":"CFM/SF","placement":"Suffix","space":true}}},"cubicFeetPerMinuteSquareMeter":{"unitSystem":"Metric","parentUnits":{"cubicFeetPerMinute":1,"squareMeters":-1}},"cubicFeetPerMinuteTonOfRefrigeration":{"unitSystem":"Imperial","parentUnits":{"cubicFeetPerMinute":1,"tonsOfRefrigeration":-1},"symbols":{"cfmPerTon":{"text":"CFM/ton","placement":"Suffix","space":true}}},"cubicFeetPerPoundMass":{"unitSystem":"Imperial","parentUnits":{"cubicFeet":1,"poundsMass":-1},"symbols":{"ftSup3PerLbMass":{"text":"ft/lb","placement":"Suffix","space":true}}},"cubicInches":{"defaultSymbol":"inSup3","unitSystem":"Imperial","parentUnits":{"inches":3},"symbols":{"inCaret3":{"text":"in^3","placement":"Suffix","space":true},"inSup3":{"text":"in","placement":"Suffix","space":true}}},"cubicMeters":{"defaultSymbol":"mSup3","unitSystem":"Metric","parentUnits":{"meters":3},"symbols":{"mCaret3":{"text":"m^3","placement":"Suffix","space":true},"mSup3":{"text":"m","placement":"Suffix","space":true}}},"cubicMetersPerHour":{"defaultSymbol":"mSup3PerH","unitSystem":"Metric","parentUnits":{"cubicMeters":1,"hours":-1},"symbols":{"cmh":{"text":"CMH","placement":"Suffix","space":true},"mSup3PerH":{"text":"m/h","placement":"Suffix","space":true}}},"cubicMetersPerHourCubicMeter":{"unitSystem":"Metric","parentUnits":{"cubicMetersPerHour":1,"cubicMeters":-1},"symbols":{"mSup3PerHMSup3":{"text":"m/(hm)","placement":"Suffix","space":true}}},"cubicMetersPerHourSquareMeter":{"unitSystem":"Metric","parentUnits":{"cubicMetersPerHour":1,"squareMeters":-1},"symbols":{"mSup3PerHMSup2":{"text":"m/(hm)","placement":"Suffix","space":true}}},"cubicMetersPerKilogram":{"unitSystem":"Metric","parentUnits":{"cubicMeters":1,"kilograms":-1},"symbols":{"mSup3PerKg":{"text":"m/kg","placement":"Suffix","space":true}}},"cubicMetersPerKilonewton":{"unitSystem":"Metric","parentUnits":{"cubicMeters":1,"kilonewtons":-1},"symbols":{"mSup3PerKN":{"text":"m/kN","placement":"Suffix","space":true}}},"cubicMetersPerSecond":{"defaultSymbol":"mSup3PerS","unitSystem":"Metric","parentUnits":{"cubicMeters":1,"seconds":-1},"symbols":{"cms":{"text":"CMS","placement":"Suffix","space":true},"mSup3PerS":{"text":"m/s","placement":"Suffix","space":true}}},"cubicMetersPerWattSecond":{"unitSystem":"Metric","parentUnits":{"cubicMeters":1,"watts":-1,"seconds":-1},"symbols":{"mSup3PerWS":{"text":"m/(Ws)","placement":"Suffix","space":true}}},"cubicMillimeters":{"defaultSymbol":"mmSup3","unitSystem":"Metric","parentUnits":{"millimeters":3},"symbols":{"mmCaret3":{"text":"mm^3","placement":"Suffix","space":true},"mmSup3":{"text":"mm","placement":"Suffix","space":true}}},"cubicYards":{"unitSystem":"Imperial","parentUnits":{"yards":3},"symbols":{"cy":{"text":"CY","placement":"Suffix","space":true}}},"currency":{"defaultSymbol":"usDollar","unitSystem":"Imperial","dimension":"currency","symbols":{"baht":{"description":"Baht is the official currency of Thailand.","text":"","placement":"Prefix","space":false},"chineseHongKongDollar":{"description":"Hong Kong Dollar is the official currency of Hong Kong..","text":"HK$","placement":"Prefix","space":false},"dong":{"description":"Dong is the official currency of Vietnam.","text":"","placement":"Suffix","space":false},"euroPrefix":{"text":"","placement":"Prefix","space":false},"euroSuffix":{"text":"","placement":"Suffix","space":false},"krone":{"description":"Krone is the official currency of Denmark, Greenland, and the Faroe Islands.","text":"kr","placement":"Suffix","space":true},"shekel":{"description":"Shekel is the official currency of Israel.","text":"","placement":"Prefix","space":false},"ukPound":{"text":"","placement":"Prefix","space":false},"usDollar":{"text":"$","placement":"Prefix","space":false},"won":{"description":"Won is the official currency of South Korea.","text":"","placement":"Prefix","space":false},"yen":{"text":"","placement":"Prefix","space":false}}},"currencyPerBritishThermalUnit":{"unitSystem":"Imperial","parentUnits":{"currency":1,"britishThermalUnits":-1},"symbols":{"dollarPerBtu":{"text":"$/Btu","placement":"Suffix","space":true}}},"currencyPerBritishThermalUnitPerHour":{"unitSystem":"Imperial","parentUnits":{"currency":1,"britishThermalUnitsPerHour":-1},"symbols":{"dollarHPerBtu":{"text":"$h/Btu","placement":"Suffix","space":true}}},"currencyPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"currency":1,"squareFeet":-1},"symbols":{"dollarPerFtSup2":{"text":"$/ft","placement":"Suffix","space":true}}},"currencyPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"currency":1,"squareMeters":-1},"symbols":{"dollarPerMSup2":{"text":"$/m","placement":"Suffix","space":true}}},"currencyPerWatt":{"unitSystem":"Metric","parentUnits":{"currency":1,"watts":-1},"symbols":{"dollarPerW":{"text":"$/W","placement":"Suffix","space":true}}},"currencyPerWattHour":{"unitSystem":"Metric","parentUnits":{"currency":1,"watts":-1,"hours":-1},"symbols":{"dollarPerWH":{"text":"$/(Wh)","placement":"Suffix","space":true}}},"cyclesPerSecond":{"unitSystem":"Metric","parentUnits":{"seconds":-1},"symbols":{"cps":{"text":"cps","placement":"Suffix","space":true}}},"decimeters":{"unitSystem":"Metric","parentFactors":{"deci":1},"parentUnits":{"meters":1},"symbols":{"dm":{"text":"dm","placement":"Suffix","space":true}}},"degrees":{"defaultSymbol":"degree","unitSystem":"Metric","parentFactors":{"threeHundredSixty":-1},"parentUnits":{"turns":1},"symbols":{"degree":{"text":"","placement":"Suffix","space":false},"degreesMinutesSeconds":{"inherits":"symbol"}}},"dekanewtonMeters":{"unitSystem":"Metric","parentUnits":{"dekanewtons":1,"meters":1},"symbols":{"daNDashM":{"text":"daN-m","placement":"Suffix","space":true}}},"dekanewtonMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"dekanewtonMeters":1,"meters":-1},"symbols":{"daNDashMPerM":{"text":"daN-m/m","placement":"Suffix","space":true}}},"dekanewtons":{"unitSystem":"Metric","parentFactors":{"deka":1},"parentUnits":{"newtons":1},"symbols":{"daN":{"text":"daN","placement":"Suffix","space":true}}},"dekanewtonsPerMeter":{"unitSystem":"Metric","parentUnits":{"dekanewtons":1,"meters":-1},"symbols":{"daNPerM":{"text":"daN/m","placement":"Suffix","space":true}}},"dekanewtonsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"dekanewtons":1,"squareMeters":-1},"symbols":{"daNPerMSup2":{"text":"daN/m","placement":"Suffix","space":true}}},"dynes":{"unitSystem":"Metric","factor":10,"parentFactors":{"micro":1},"parentUnits":{"newtons":1},"symbols":{"dyn":{"text":"dyn","placement":"Suffix","space":true}}},"ergs":{"unitSystem":"Metric","parentFactors":{"ten":-7},"parentUnits":{"joules":1},"symbols":{"erg":{"text":"erg","placement":"Suffix","space":true}}},"fahrenheit":{"unitSystem":"Imperial","parentUnit":"fahrenheitInterval","offset":459.67,"symbols":{"degreeF":{"text":"F","placement":"Suffix","space":true}}},"fahrenheitInterval":{"defaultSymbol":"degreeFInterval","unitSystem":"Imperial","parentUnits":{"rankineInterval":1},"symbols":{"degreeFInterval":{"text":"F","placement":"Suffix","space":true},"deltaDegreeF":{"text":"deltaF","placement":"Suffix","space":true}}},"farads":{"unitSystem":"Metric","parentUnits":{"coulombs":1,"volts":-1},"symbols":{"farad":{"text":"F","placement":"Suffix","space":true}}},"feet":{"defaultSymbol":"feetAndInches","unitSystem":"Imperial","factor":12,"parentUnits":{"inches":1},"symbols":{"feetAndInches":{"inherits":"symbol"},"footSingleQuote":{"text":"\'","placement":"Suffix","space":false},"ft":{"text":"ft","placement":"Suffix","space":true},"lf":{"text":"LF","placement":"Suffix","space":true}}},"feetOfWater39.2DegreesFahrenheit":{"defaultSymbol":"feetOfWater","unitSystem":"Imperial","factor":2988.98,"parentUnits":{"pascals":1},"symbols":{"feetOfWater":{"text":"Feet","placement":"Suffix","space":true},"ftH2O":{"text":"ftH2O","placement":"Suffix","space":true},"ftOfWater":{"text":"FT","placement":"Suffix","space":true}}},"feetOfWater39.2DegreesFahrenheitPer100Feet":{"defaultSymbol":"feetOfWaterPer100ft","unitSystem":"Imperial","factor":0.01,"parentUnits":{"feetOfWater39.2DegreesFahrenheit":1,"feet":-1},"symbols":{"feetOfWaterPer100ft":{"text":"Feet/100ft","placement":"Suffix","space":true},"ftH2OPer100ft":{"text":"ftH2O/100ft","placement":"Suffix","space":true},"ftOfWaterPer100ft":{"text":"FT/100ft","placement":"Suffix","space":true}}},"feetPerKip":{"unitSystem":"Imperial","parentUnits":{"feet":1,"kips":-1},"symbols":{"ftPerKip":{"text":"ft/kip","placement":"Suffix","space":true}}},"feetPerKipFoot":{"unitSystem":"Imperial","parentUnits":{"feet":1,"kipFeet":-1},"symbols":{"ftPerKipDashFt":{"text":"ft/kip-ft","placement":"Suffix","space":true}}},"feetPerMinute":{"defaultSymbol":"fpm","unitSystem":"Imperial","parentUnits":{"feet":1,"minutes":-1},"symbols":{"fpm":{"text":"FPM","placement":"Suffix","space":true},"ftPerMin":{"text":"ft/min","placement":"Suffix","space":true}}},"feetPerSecond":{"defaultSymbol":"fps","unitSystem":"Imperial","parentUnits":{"feet":1,"seconds":-1},"symbols":{"fps":{"text":"FPS","placement":"Suffix","space":true},"ftPerS":{"text":"ft/s","placement":"Suffix","space":true}}},"feetPerSecondSquared":{"unitSystem":"Imperial","parentUnits":{"feetPerSecond":1,"seconds":-1},"symbols":{"ftPerSSup2":{"text":"ft/s","placement":"Suffix","space":true}}},"feetToTheFourthPower":{"unitSystem":"Imperial","parentUnits":{"feet":4},"symbols":{"ftSup4":{"text":"ft","placement":"Suffix","space":true}}},"feetToTheSixthPower":{"unitSystem":"Imperial","parentUnits":{"feet":6},"symbols":{"ftSup6":{"text":"ft","placement":"Suffix","space":true}}},"fixed":{"unitSystem":"Metric","parentUnits":{"ratioTo1":1}},"footcandles":{"defaultSymbol":"fc","unitSystem":"Imperial","parentUnits":{"lumens":1,"squareFeet":-1},"symbols":{"fc":{"text":"fc","placement":"Suffix","space":true},"ftc":{"text":"Ftc","placement":"Suffix","space":true}}},"footlamberts":{"defaultSymbol":"fL","unitSystem":"Imperial","parentFactors":{"pi":-1},"parentUnits":{"candelas":1,"squareFeet":-1},"symbols":{"fL":{"text":"fL","placement":"Suffix","space":true},"flLowercase":{"text":"fl","placement":"Suffix","space":true},"ftL":{"text":"ftL","placement":"Suffix","space":true}}},"gammas":{"unitSystem":"Metric","parentFactors":{"nano":1},"parentUnits":{"teslas":1},"symbols":{"gamma":{"text":"gamma","placement":"Suffix","space":true}}},"gauss":{"unitSystem":"Metric","parentFactors":{"ten":-4},"parentUnits":{"teslas":1},"symbols":{"gs":{"text":"Gs","placement":"Suffix","space":true}}},"general":{"unitSystem":"Metric","parentUnits":{"ratioTo1":1}},"gigajoules":{"unitSystem":"Metric","parentFactors":{"giga":1},"parentUnits":{"joules":1}},"gradians":{"unitSystem":"Metric","factor":0.9,"parentUnits":{"degrees":1},"symbols":{"grad":{"text":"grad","placement":"Suffix","space":true}}},"grains":{"unitSystem":"Imperial","factor":64.79891,"parentUnits":{"milligrams":1},"symbols":{"gr":{"text":"gr","placement":"Suffix","space":true}}},"grainsPerHourSquareFootInchMercury":{"unitSystem":"Imperial","parentUnits":{"grains":1,"hours":-1,"squareFeet":-1,"inchesOfMercury32DegreesFahrenheit":-1},"symbols":{"grPerHFtSup2InHg":{"text":"gr/(hftinHg)","placement":"Suffix","space":true}}},"grams":{"unitSystem":"Metric","factor":0.001,"parentUnits":{"kilograms":1},"symbols":{"gram":{"text":"g","placement":"Suffix","space":true}}},"hectares":{"unitSystem":"Metric","parentUnits":{"squareHectometers":1},"symbols":{"hectare":{"text":"hectare","placement":"Suffix","space":true}}},"hectometers":{"unitSystem":"Metric","parentFactors":{"hecto":1},"parentUnits":{"meters":1},"symbols":{"hm":{"text":"hm","placement":"Suffix","space":true}}},"henries":{"unitSystem":"Metric","parentUnits":{"ohms":1,"seconds":1},"symbols":{"henry":{"text":"H","placement":"Suffix","space":true}}},"hertz":{"unitSystem":"Metric","parentUnits":{"cyclesPerSecond":1},"symbols":{"hz":{"text":"Hz","placement":"Suffix","space":true}}},"horsepower":{"unitSystem":"Imperial","factor":33000,"parentUnits":{"poundForceFeet":1,"minutes":-1},"symbols":{"hp":{"text":"hp","placement":"Suffix","space":true}}},"hourSquareFootDegreesFahrenheitPerBritishThermalUnit":{"unitSystem":"Imperial","parentUnits":{"hours":1,"squareFeet":1,"fahrenheitInterval":1,"britishThermalUnits":-1},"symbols":{"hFtSup2DegreeFPerBtu":{"text":"(hftF)/BTU","placement":"Suffix","space":true}}},"hours":{"unitSystem":"Metric","factor":60,"parentUnits":{"minutes":1},"symbols":{"hour":{"text":"h","placement":"Suffix","space":true}}},"inches":{"defaultSymbol":"in","unitSystem":"Imperial","factor":2.54,"parentUnits":{"centimeters":1},"symbols":{"in":{"text":"in","placement":"Suffix","space":true},"inchDoubleQuote":{"text":"\\"","placement":"Suffix","space":false}}},"inchesOfMercury32DegreesFahrenheit":{"unitSystem":"Imperial","factor":3386.389,"parentUnits":{"pascals":1},"symbols":{"inHg":{"text":"inHg","placement":"Suffix","space":true}}},"inchesOfWater60DegreesFahrenheit":{"unitSystem":"Imperial","factor":248.84,"parentUnits":{"pascals":1},"symbols":{"inDashWg":{"text":"in-wg","placement":"Suffix","space":true}}},"inchesOfWater60DegreesFahrenheitPer100Feet":{"unitSystem":"Imperial","factor":0.01,"parentUnits":{"inchesOfWater60DegreesFahrenheit":1,"feet":-1},"symbols":{"inDashWgPer100ft":{"text":"in-wg/100ft","placement":"Suffix","space":true}}},"inchesPerSecond":{"unitSystem":"Imperial","parentUnits":{"inches":1,"seconds":-1},"symbols":{"inPerS":{"text":"in/s","placement":"Suffix","space":true}}},"inchesPerSecondSquared":{"unitSystem":"Imperial","parentUnits":{"inchesPerSecond":1,"seconds":-1},"symbols":{"inPerSSup2":{"text":"in/s","placement":"Suffix","space":true}}},"inchesToTheFourthPower":{"unitSystem":"Imperial","parentUnits":{"inches":4},"symbols":{"inSup4":{"text":"in","placement":"Suffix","space":true}}},"inchesToTheSixthPower":{"unitSystem":"Imperial","parentUnits":{"inches":6},"symbols":{"inSup6":{"text":"in","placement":"Suffix","space":true}}},"inverseDegreesCelsius":{"unitSystem":"Metric","parentUnits":{"celsiusInterval":-1},"symbols":{"invDegreeC":{"text":"1/C","placement":"Suffix","space":true}}},"inverseDegreesFahrenheit":{"unitSystem":"Imperial","parentUnits":{"fahrenheitInterval":-1},"symbols":{"invDegreeF":{"text":"1/F","placement":"Suffix","space":true}}},"inverseKilonewtons":{"unitSystem":"Metric","parentUnits":{"kilonewtons":-1},"symbols":{"invKN":{"text":"1/kN","placement":"Suffix","space":true}}},"inverseKips":{"unitSystem":"Imperial","parentUnits":{"kips":-1},"symbols":{"invKip":{"text":"1/kip","placement":"Suffix","space":true}}},"joules":{"unitSystem":"Metric","parentUnits":{"newtonMeters":1},"symbols":{"joule":{"text":"J","placement":"Suffix","space":true}}},"joulesPerGram":{"unitSystem":"Metric","parentUnits":{"joules":1,"grams":-1},"symbols":{"jPerG":{"text":"J/g","placement":"Suffix","space":true}}},"joulesPerGramDegreeCelsius":{"unitSystem":"Metric","parentUnits":{"joulesPerGram":1,"celsiusInterval":-1},"symbols":{"jPerGDegreeC":{"text":"J/(gC)","placement":"Suffix","space":true}}},"joulesPerKelvin":{"unitSystem":"Metric","parentUnits":{"joules":1,"kelvinInterval":-1},"symbols":{"jPerK":{"text":"J/K","placement":"Suffix","space":true}}},"joulesPerKilogram":{"unitSystem":"Metric","parentUnits":{"joules":1,"kilograms":-1},"symbols":{"jPerKg":{"text":"J/kg","placement":"Suffix","space":true}}},"joulesPerKilogramDegreeCelsius":{"unitSystem":"Metric","parentUnits":{"joulesPerKilogram":1,"celsiusInterval":-1},"symbols":{"jPerKgDegreeC":{"text":"J/(kgC)","placement":"Suffix","space":true}}},"joulesPerSquareMeterKelvin":{"unitSystem":"Metric","parentUnits":{"joules":1,"squareMeters":-1,"kelvinInterval":-1},"symbols":{"jPerMSup2K":{"text":"J/(mK)","placement":"Suffix","space":true}}},"kelvin":{"unitSystem":"Metric","parentUnit":"kelvinInterval","symbols":{"kelvin":{"text":"K","placement":"Suffix","space":true}}},"kelvinInterval":{"defaultSymbol":"deltaK","unitSystem":"Metric","dimension":"temperature","symbols":{"deltaK":{"text":"deltaK","placement":"Suffix","space":true},"kelvinInterval":{"text":"K","placement":"Suffix","space":true}}},"kiloamperes":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"amperes":1},"symbols":{"kA":{"text":"kA","placement":"Suffix","space":true}}},"kilocalories":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"calories":1},"symbols":{"kcal":{"text":"kcal","placement":"Suffix","space":true}}},"kilocaloriesPerSecond":{"unitSystem":"Metric","parentUnits":{"kilocalories":1,"seconds":-1},"symbols":{"kcalPerS":{"text":"kcal/s","placement":"Suffix","space":true}}},"kilogramForceMeters":{"unitSystem":"Metric","parentUnits":{"kilogramsForce":1,"meters":1},"symbols":{"kgfDashM":{"text":"kgf-m","placement":"Suffix","space":true}}},"kilogramForceMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"kilogramForceMeters":1,"meters":-1},"symbols":{"kgfDashMPerM":{"text":"kgf-m/m","placement":"Suffix","space":true}}},"kilogramKelvins":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"kelvinInterval":1},"symbols":{"kgK":{"text":"kgK","placement":"Suffix","space":true}}},"kilograms":{"unitSystem":"Metric","dimension":"mass","symbols":{"kg":{"text":"kg","placement":"Suffix","space":true}}},"kilogramsForce":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"standardGravity":1},"symbols":{"kgf":{"text":"kgf","placement":"Suffix","space":true}}},"kilogramsForcePerMeter":{"unitSystem":"Metric","parentUnits":{"kilogramsForce":1,"meters":-1},"symbols":{"kgfPerM":{"text":"kgf/m","placement":"Suffix","space":true}}},"kilogramsForcePerSquareMeter":{"unitSystem":"Metric","parentUnits":{"kilogramsForce":1,"squareMeters":-1},"symbols":{"kgfPerMSup2":{"text":"kgf/m","placement":"Suffix","space":true}}},"kilogramsPerCubicCentimeter":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"cubicCentimeters":-1}},"kilogramsPerCubicMeter":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"cubicMeters":-1},"symbols":{"kgPerMSup3":{"text":"kg/m","placement":"Suffix","space":true}}},"kilogramsPerHour":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"hours":-1},"symbols":{"kgPerH":{"text":"kg/h","placement":"Suffix","space":true}}},"kilogramsPerKilogramKelvin":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"kilogramKelvins":-1},"symbols":{"kgPerKgK":{"text":"kg/(kgK)","placement":"Suffix","space":true}}},"kilogramsPerMeter":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"meters":-1},"symbols":{"kgPerM":{"text":"kg/m","placement":"Suffix","space":true}}},"kilogramsPerMeterHour":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"meters":-1,"hours":-1},"symbols":{"kgPerMH":{"text":"kg/(mh)","placement":"Suffix","space":true}}},"kilogramsPerMeterSecond":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"meters":-1,"seconds":-1},"symbols":{"kgPerMS":{"text":"kg/(ms)","placement":"Suffix","space":true}}},"kilogramsPerMinute":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"minutes":-1},"symbols":{"kgPerMin":{"text":"kg/min","placement":"Suffix","space":true}}},"kilogramsPerSecond":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"seconds":-1},"symbols":{"kgPerS":{"text":"kg/s","placement":"Suffix","space":true}}},"kilogramsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"squareMeters":-1},"symbols":{"kgPerMSup2":{"text":"kg/m","placement":"Suffix","space":true}}},"kilojoules":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"joules":1},"symbols":{"kJ":{"text":"kJ","placement":"Suffix","space":true}}},"kilojoulesPerKelvin":{"unitSystem":"Metric","parentUnits":{"kilojoules":1,"kelvinInterval":-1},"symbols":{"kJPerK":{"text":"kJ/K","placement":"Suffix","space":true}}},"kilojoulesPerSquareMeterKelvin":{"unitSystem":"Metric","parentUnits":{"kilojoules":1,"squareMeters":-1,"kelvinInterval":-1},"symbols":{"kJPerMSup2K":{"text":"kJ/(mK)","placement":"Suffix","space":true}}},"kilometers":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"meters":1},"symbols":{"km":{"text":"km","placement":"Suffix","space":true}}},"kilometersPerHour":{"unitSystem":"Metric","parentUnits":{"kilometers":1,"hours":-1},"symbols":{"kmPerH":{"text":"km/h","placement":"Suffix","space":true}}},"kilometersPerSecond":{"unitSystem":"Metric","parentUnits":{"kilometers":1,"seconds":-1},"symbols":{"kmPerS":{"text":"km/s","placement":"Suffix","space":true}}},"kilometersPerSecondSquared":{"unitSystem":"Metric","parentUnits":{"kilometersPerSecond":1,"seconds":-1},"symbols":{"kmPerSSup2":{"text":"km/s","placement":"Suffix","space":true}}},"kilonewtonMeters":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"meters":1},"symbols":{"kNDashM":{"text":"kN-m","placement":"Suffix","space":true}}},"kilonewtonMetersPerDegree":{"unitSystem":"Metric","parentUnits":{"kilonewtonMeters":1,"degrees":-1},"symbols":{"kNDashMPerDegree":{"text":"kN-m/","placement":"Suffix","space":true}}},"kilonewtonMetersPerDegreePerMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtonMetersPerDegree":1,"meters":-1},"symbols":{"kNDashMPerDegreePerM":{"text":"kN-m//m","placement":"Suffix","space":true}}},"kilonewtonMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtonMeters":1,"meters":-1},"symbols":{"kNDashMPerM":{"text":"kN-m/m","placement":"Suffix","space":true}}},"kilonewtons":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"newtons":1},"symbols":{"kN":{"text":"kN","placement":"Suffix","space":true}}},"kilonewtonsPerCubicMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"cubicMeters":-1},"symbols":{"kNPerMSup3":{"text":"kN/m","placement":"Suffix","space":true}}},"kilonewtonsPerMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"meters":-1},"symbols":{"kNPerM":{"text":"kN/m","placement":"Suffix","space":true}}},"kilonewtonsPerSquareCentimeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"squareCentimeters":-1},"symbols":{"kNPerCmSup2":{"text":"kN/cm","placement":"Suffix","space":true}}},"kilonewtonsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"squareMeters":-1},"symbols":{"kNPerMSup2":{"text":"kN/m","placement":"Suffix","space":true}}},"kilonewtonsPerSquareMillimeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"squareMillimeters":-1},"symbols":{"kNPerMmSup2":{"text":"kN/mm","placement":"Suffix","space":true}}},"kilopascals":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"pascals":1},"symbols":{"kPa":{"text":"kPa","placement":"Suffix","space":true}}},"kilovoltAmperes":{"unitSystem":"Metric","parentUnits":{"kilovolts":1,"amperes":1},"symbols":{"kVA":{"text":"kVA","placement":"Suffix","space":true}}},"kilovolts":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"volts":1},"symbols":{"kV":{"text":"kV","placement":"Suffix","space":true}}},"kilowattHours":{"unitSystem":"Metric","parentUnits":{"kilowatts":1,"hours":1},"symbols":{"kWh":{"text":"kWh","placement":"Suffix","space":true}}},"kilowattHoursPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"kilowattHours":1,"squareMeters":-1},"symbols":{"kWhPerMSup2":{"text":"kWh/m","placement":"Suffix","space":true}}},"kilowatts":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"watts":1},"symbols":{"kW":{"text":"kW","placement":"Suffix","space":true}}},"kipFeet":{"unitSystem":"Imperial","parentUnits":{"kips":1,"feet":1},"symbols":{"kipDashFt":{"text":"kip-ft","placement":"Suffix","space":true}}},"kipFeetPerDegree":{"unitSystem":"Imperial","parentUnits":{"kipFeet":1,"degrees":-1},"symbols":{"kipDashFtPerDegree":{"text":"kip-ft/","placement":"Suffix","space":true}}},"kipFeetPerDegreePerFoot":{"unitSystem":"Imperial","parentUnits":{"kipFeetPerDegree":1,"feet":-1},"symbols":{"kipDashFtPerDegreePerFt":{"text":"kip-ft//ft","placement":"Suffix","space":true}}},"kipFeetPerFoot":{"unitSystem":"Imperial","parentUnits":{"kipFeet":1,"feet":-1},"symbols":{"kipDashFtPerFt":{"text":"kip-ft/ft","placement":"Suffix","space":true}}},"kips":{"unitSystem":"Imperial","parentFactors":{"kilo":1},"parentUnits":{"poundsForce":1},"symbols":{"kip":{"text":"kip","placement":"Suffix","space":true}}},"kipsPerCubicFoot":{"unitSystem":"Imperial","parentUnits":{"kips":1,"cubicFeet":-1},"symbols":{"kipPerFtSup3":{"text":"kip/ft","placement":"Suffix","space":true}}},"kipsPerCubicInch":{"unitSystem":"Imperial","parentUnits":{"kips":1,"cubicInches":-1},"symbols":{"kipPerInSup3":{"text":"kip/in","placement":"Suffix","space":true}}},"kipsPerFoot":{"unitSystem":"Imperial","parentUnits":{"kips":1,"feet":-1},"symbols":{"kipPerFt":{"text":"kip/ft","placement":"Suffix","space":true}}},"kipsPerInch":{"unitSystem":"Imperial","parentUnits":{"kips":1,"inches":-1},"symbols":{"kipPerIn":{"text":"kip/in","placement":"Suffix","space":true}}},"kipsPerSquareFoot":{"defaultSymbol":"kipPerFtSup2","unitSystem":"Imperial","parentUnits":{"kips":1,"squareFeet":-1},"symbols":{"kipPerFtSup2":{"text":"kip/ft","placement":"Suffix","space":true},"ksf":{"text":"ksf","placement":"Suffix","space":true}}},"kipsPerSquareInch":{"defaultSymbol":"kipPerInSup2","unitSystem":"Imperial","parentUnits":{"kips":1,"squareInches":-1},"symbols":{"kipPerInSup2":{"text":"kip/in","placement":"Suffix","space":true},"ksi":{"text":"ksi","placement":"Suffix","space":true}}},"liters":{"unitSystem":"Metric","parentUnits":{"decimeters":3},"symbols":{"liter":{"text":"L","placement":"Suffix","space":true}}},"litersPerHour":{"unitSystem":"Metric","parentUnits":{"liters":1,"hours":-1},"symbols":{"lPerH":{"text":"L/h","placement":"Suffix","space":true}}},"litersPerMinute":{"defaultSymbol":"lPerMin","unitSystem":"Metric","parentUnits":{"liters":1,"minutes":-1},"symbols":{"lPerMin":{"text":"L/min","placement":"Suffix","space":true},"lpm":{"text":"LPM","placement":"Suffix","space":true}}},"litersPerSecond":{"defaultSymbol":"lPerS","unitSystem":"Metric","parentUnits":{"liters":1,"seconds":-1},"symbols":{"lPerS":{"text":"L/s","placement":"Suffix","space":true},"lps":{"text":"LPS","placement":"Suffix","space":true}}},"litersPerSecondCubicMeter":{"unitSystem":"Metric","parentUnits":{"litersPerSecond":1,"cubicMeters":-1},"symbols":{"lPerSMSup3":{"text":"L/(sm)","placement":"Suffix","space":true}}},"litersPerSecondKilowatt":{"unitSystem":"Metric","parentUnits":{"litersPerSecond":1,"kilowatts":-1},"symbols":{"lPerSKw":{"text":"L/(skW)","placement":"Suffix","space":true}}},"litersPerSecondSquareMeter":{"defaultSymbol":"lPerSMSup2","unitSystem":"Metric","parentUnits":{"litersPerSecond":1,"squareMeters":-1},"symbols":{"lPerSMSup2":{"text":"L/(sm)","placement":"Suffix","space":true},"lpsPerMSup2":{"text":"LPS/m","placement":"Suffix","space":true}}},"lumens":{"unitSystem":"Metric","parentUnits":{"candelas":1,"steradians":1},"symbols":{"lm":{"text":"lm","placement":"Suffix","space":true}}},"lumensPerWatt":{"unitSystem":"Metric","parentUnits":{"lumens":1,"watts":-1},"symbols":{"lmPerW":{"text":"lm/W","placement":"Suffix","space":true}}},"lux":{"unitSystem":"Metric","parentUnits":{"lumens":1,"squareMeters":-1},"symbols":{"lx":{"text":"lx","placement":"Suffix","space":true}}},"maxwells":{"unitSystem":"Metric","parentFactors":{"ten":-8},"parentUnits":{"webers":1},"symbols":{"mx":{"text":"Mx","placement":"Suffix","space":true}}},"megajoules":{"unitSystem":"Metric","parentFactors":{"mega":1},"parentUnits":{"joules":1}},"megajoulesPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"megajoules":1,"squareMeters":-1}},"meganewtonMeters":{"unitSystem":"Metric","parentUnits":{"meganewtons":1,"meters":1},"symbols":{"mNDashM":{"text":"MN-m","placement":"Suffix","space":true}}},"meganewtonMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"meganewtonMeters":1,"meters":-1},"symbols":{"mNDashMPerM":{"text":"MN-m/m","placement":"Suffix","space":true}}},"meganewtons":{"unitSystem":"Metric","parentFactors":{"mega":1},"parentUnits":{"newtons":1},"symbols":{"mN":{"text":"MN","placement":"Suffix","space":true}}},"meganewtonsPerMeter":{"unitSystem":"Metric","parentUnits":{"meganewtons":1,"meters":-1},"symbols":{"mNPerM":{"text":"MN/m","placement":"Suffix","space":true}}},"meganewtonsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"meganewtons":1,"squareMeters":-1},"symbols":{"mNPerMSup2":{"text":"MN/m","placement":"Suffix","space":true}}},"megapascals":{"unitSystem":"Metric","parentFactors":{"mega":1},"parentUnits":{"pascals":1},"symbols":{"mPa":{"text":"MPa","placement":"Suffix","space":true}}},"megawattHours":{"unitSystem":"Metric","parentUnits":{"megawatts":1,"hours":1},"symbols":{"mWh":{"text":"mWh","placement":"Suffix","space":true}}},"megawatts":{"unitSystem":"Metric","parentFactors":{"mega":1},"parentUnits":{"watts":1}},"meters":{"defaultSymbol":"meter","unitSystem":"Metric","dimension":"length","symbols":{"meter":{"text":"m","placement":"Suffix","space":true},"metersAndCentimeters":{"inherits":"symbol"}}},"metersOfWaterColumn":{"unitSystem":"Metric","parentUnits":{"meters":1,"standardGravity":1,"waterDensity4DegreesCelsius":1},"symbols":{"mH2O":{"text":"mH2O","placement":"Suffix","space":true}}},"metersOfWaterColumnPerMeter":{"unitSystem":"Metric","parentUnits":{"metersOfWaterColumn":1,"meters":-1},"symbols":{"mH2OPerM":{"text":"mH2O/m","placement":"Suffix","space":true}}},"metersPerKilonewton":{"unitSystem":"Metric","parentUnits":{"meters":1,"kilonewtons":-1},"symbols":{"mPerKN":{"text":"m/kN","placement":"Suffix","space":true}}},"metersPerKilonewtonMeter":{"unitSystem":"Metric","parentUnits":{"meters":1,"kilonewtonMeters":-1},"symbols":{"mPerKNDashM":{"text":"m/kN-m","placement":"Suffix","space":true}}},"metersPerSecond":{"unitSystem":"Metric","parentUnits":{"meters":1,"seconds":-1},"symbols":{"mPerS":{"text":"m/s","placement":"Suffix","space":true}}},"metersPerSecondSquared":{"unitSystem":"Metric","parentUnits":{"metersPerSecond":1,"seconds":-1},"symbols":{"mPerSSup2":{"text":"m/s","placement":"Suffix","space":true}}},"metersToTheFourthPower":{"unitSystem":"Metric","parentUnits":{"meters":4},"symbols":{"mSup4":{"text":"m","placement":"Suffix","space":true}}},"metersToTheSixthPower":{"unitSystem":"Metric","parentUnits":{"meters":6},"symbols":{"mSup6":{"text":"m","placement":"Suffix","space":true}}},"mhos":{"unitSystem":"Metric","parentUnits":{"ohms":-1},"symbols":{"mho":{"text":"mho","placement":"Suffix","space":true}}},"microinches":{"unitSystem":"Imperial","parentFactors":{"micro":1},"parentUnits":{"inches":1},"symbols":{"uin":{"text":"in","placement":"Suffix","space":true}}},"microinchesPerInchDegreeFahrenheit":{"unitSystem":"Imperial","parentFactors":{"micro":1},"parentUnits":{"inverseDegreesFahrenheit":1},"symbols":{"uinPerInDegreeF":{"text":"in/(inF)","placement":"Suffix","space":true}}},"micrometersPerMeterDegreeCelsius":{"unitSystem":"Metric","parentFactors":{"micro":1},"parentUnits":{"inverseDegreesCelsius":1},"symbols":{"umPerMDegreeC":{"text":"m/(mC)","placement":"Suffix","space":true}}},"microns":{"unitSystem":"Metric","parentFactors":{"micro":1},"parentUnits":{"meters":1},"symbols":{"micron":{"text":"micron","placement":"Suffix","space":true}}},"miles":{"unitSystem":"Imperial","factor":1760,"parentUnits":{"yards":1},"symbols":{"mi":{"text":"mi","placement":"Suffix","space":true}}},"milesPerHour":{"unitSystem":"Imperial","parentUnits":{"miles":1,"hours":-1},"symbols":{"mph":{"text":"mph","placement":"Suffix","space":true}}},"milesPerSecond":{"unitSystem":"Imperial","parentUnits":{"miles":1,"seconds":-1},"symbols":{"miPerS":{"text":"mi/s","placement":"Suffix","space":true}}},"milesPerSecondSquared":{"unitSystem":"Imperial","parentUnits":{"milesPerSecond":1,"seconds":-1},"symbols":{"miPerSSup2":{"text":"mi/s","placement":"Suffix","space":true}}},"milliamperes":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"amperes":1},"symbols":{"mA":{"text":"mA","placement":"Suffix","space":true}}},"milligrams":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"grams":1},"symbols":{"mg":{"text":"mg","placement":"Suffix","space":true}}},"millimeters":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"meters":1},"symbols":{"mm":{"text":"mm","placement":"Suffix","space":true}}},"millimetersOfMercury":{"unitSystem":"Metric","factor":133.3224,"parentUnits":{"pascals":1},"symbols":{"mmHg":{"text":"mmHg","placement":"Suffix","space":true}}},"millimetersOfWaterColumn":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"metersOfWaterColumn":1},"symbols":{"mmH2O":{"text":"mmH2O","placement":"Suffix","space":true}}},"millimetersOfWaterColumnPerMeter":{"unitSystem":"Metric","parentUnits":{"millimetersOfWaterColumn":1,"meters":-1},"symbols":{"mmH2OPerM":{"text":"mmH2O/m","placement":"Suffix","space":true}}},"millimetersToTheFourthPower":{"unitSystem":"Metric","parentUnits":{"millimeters":4},"symbols":{"mmSup4":{"text":"mm","placement":"Suffix","space":true}}},"millimetersToTheSixthPower":{"unitSystem":"Metric","parentUnits":{"millimeters":6},"symbols":{"mmSup6":{"text":"mm","placement":"Suffix","space":true}}},"milliseconds":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"seconds":1},"symbols":{"ms":{"text":"ms","placement":"Suffix","space":true}}},"millivolts":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"volts":1},"symbols":{"mV":{"text":"mV","placement":"Suffix","space":true}}},"mils":{"unitSystem":"Imperial","parentFactors":{"milli":1},"parentUnits":{"inches":1},"symbols":{"mil":{"text":"mil","placement":"Suffix","space":true}}},"minutes":{"unitSystem":"Metric","factor":60,"parentUnits":{"seconds":1},"symbols":{"min":{"text":"min","placement":"Suffix","space":true}}},"nanograms":{"unitSystem":"Metric","parentFactors":{"nano":1},"parentUnits":{"grams":1},"symbols":{"ng":{"text":"ng","placement":"Suffix","space":true}}},"nanogramsPerPascalSecondSquareMeter":{"unitSystem":"Metric","parentUnits":{"nanograms":1,"seconds":-1,"squareMeters":-1,"pascals":-1},"symbols":{"ngPerPaSMSup2":{"text":"ng/(Pasm)","placement":"Suffix","space":true}}},"nanometers":{"unitSystem":"Metric","parentFactors":{"nano":1},"parentUnits":{"meters":1},"symbols":{"nm":{"text":"nm","placement":"Suffix","space":true}}},"nauticalMiles":{"unitSystem":"Imperial","factor":1852,"parentUnits":{"meters":1},"symbols":{"nauticalMile":{"text":"M","placement":"Suffix","space":true}}},"newtonMeters":{"unitSystem":"Metric","parentUnits":{"newtons":1,"meters":1},"symbols":{"nDashM":{"text":"N-m","placement":"Suffix","space":true}}},"newtonMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"newtonMeters":1,"meters":-1},"symbols":{"nDashMPerM":{"text":"N-m/m","placement":"Suffix","space":true}}},"newtonSecondsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"newtons":1,"seconds":1,"squareMeters":-1},"symbols":{"nSPerMSup2":{"text":"Ns/m","placement":"Suffix","space":true}}},"newtons":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"metersPerSecondSquared":1},"symbols":{"newton":{"text":"N","placement":"Suffix","space":true}}},"newtonsPerMeter":{"unitSystem":"Metric","parentUnits":{"newtons":1,"meters":-1},"symbols":{"nPerM":{"text":"N/m","placement":"Suffix","space":true}}},"newtonsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"newtons":1,"squareMeters":-1},"symbols":{"nPerMSup2":{"text":"N/m","placement":"Suffix","space":true}}},"newtonsPerSquareMillimeter":{"unitSystem":"Metric","parentUnits":{"newtons":1,"squareMillimeters":-1},"symbols":{"nPerMmSup2":{"text":"N/mm","placement":"Suffix","space":true}}},"oersteds":{"unitSystem":"Metric","factor":250,"parentFactors":{"pi":-1},"parentUnits":{"amperes":1,"meters":-1},"symbols":{"oe":{"text":"Oe","placement":"Suffix","space":true}}},"ohmMeters":{"unitSystem":"Metric","parentUnits":{"ohms":1,"meters":1},"symbols":{"ohmM":{"text":"ohmm","placement":"Suffix","space":true}}},"ohms":{"defaultSymbol":"omega","unitSystem":"Metric","parentUnits":{"volts":1,"amperes":-1},"symbols":{"ohm":{"text":"ohm","placement":"Suffix","space":true},"omega":{"text":"","placement":"Suffix","space":true}}},"ouncesForce":{"unitSystem":"Imperial","factor":0.0625,"parentUnits":{"poundsForce":1},"symbols":{"ozf":{"text":"ozf","placement":"Suffix","space":true}}},"ouncesMass":{"unitSystem":"Imperial","factor":0.0625,"parentUnits":{"poundsMass":1},"symbols":{"oz":{"text":"oz","placement":"Suffix","space":true}}},"pascalSeconds":{"unitSystem":"Metric","parentUnits":{"pascals":1,"seconds":1},"symbols":{"paDashS":{"text":"Pa-s","placement":"Suffix","space":true}}},"pascals":{"unitSystem":"Metric","parentUnits":{"newtonsPerSquareMeter":1},"symbols":{"pa":{"text":"Pa","placement":"Suffix","space":true}}},"pascalsPerMeter":{"unitSystem":"Metric","parentUnits":{"pascals":1,"meters":-1},"symbols":{"paPerM":{"text":"Pa/m","placement":"Suffix","space":true}}},"perMille":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"ratioTo1":1},"symbols":{"perMille":{"text":"","placement":"Suffix","space":false}}},"percentage":{"unitSystem":"Metric","parentFactors":{"centi":1},"parentUnits":{"ratioTo1":1},"symbols":{"percent":{"text":"%","placement":"Suffix","space":false}}},"pi":{"unitSystem":"Imperial","parentFactors":{"pi":1},"parentUnits":{"radians":1},"symbols":{"pi":{"text":"","placement":"Suffix","space":true}}},"poises":{"unitSystem":"Metric","parentUnits":{"grams":1,"centimeters":-1,"seconds":-1},"symbols":{"poise":{"text":"P","placement":"Suffix","space":true}}},"poundForceFeet":{"defaultSymbol":"lbForceDashFt","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"feet":1},"symbols":{"lbForceDashFt":{"text":"lb-ft","placement":"Suffix","space":true},"lbfDashFt":{"text":"lbf-ft","placement":"Suffix","space":true}}},"poundForceFeetPerFoot":{"defaultSymbol":"lbForceDashFtPerFt","unitSystem":"Imperial","parentUnits":{"poundForceFeet":1,"feet":-1},"symbols":{"lbForceDashFtPerFt":{"text":"lb-ft/ft","placement":"Suffix","space":true},"lbfDashFtPerFt":{"text":"lbf-ft/ft","placement":"Suffix","space":true}}},"poundForceSecondsPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"poundsForce":1,"seconds":1,"squareFeet":-1},"symbols":{"lbForceSPerFtSup2":{"text":"lbs/ft","placement":"Suffix","space":true}}},"poundMassDegreesFahrenheit":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"fahrenheitInterval":1},"symbols":{"lbMassDegreeF":{"text":"lbF","placement":"Suffix","space":true}}},"poundsForce":{"defaultSymbol":"lbForce","unitSystem":"Imperial","parentUnits":{"poundsMass":1,"standardGravity":1},"symbols":{"lbForce":{"text":"lb","placement":"Suffix","space":true},"lbf":{"text":"lbf","placement":"Suffix","space":true}}},"poundsForcePerCubicFoot":{"defaultSymbol":"lbForcePerFtSup3","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"cubicFeet":-1},"symbols":{"lbForcePerFtSup3":{"text":"lb/ft","placement":"Suffix","space":true},"lbfPerFtSup3":{"text":"lbf/ft","placement":"Suffix","space":true}}},"poundsForcePerFoot":{"defaultSymbol":"lbForcePerFt","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"feet":-1},"symbols":{"lbForcePerFt":{"text":"lb/ft","placement":"Suffix","space":true},"lbfPerFt":{"text":"lbf/ft","placement":"Suffix","space":true}}},"poundsForcePerSquareFoot":{"defaultSymbol":"lbForcePerFtSup2","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"squareFeet":-1},"symbols":{"lbForcePerFtSup2":{"text":"lb/ft","placement":"Suffix","space":true},"lbfPerFtSup2":{"text":"lbf/ft","placement":"Suffix","space":true},"psf":{"text":"psf","placement":"Suffix","space":true}}},"poundsForcePerSquareInch":{"defaultSymbol":"lbForcePerInSup2","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"squareInches":-1},"symbols":{"lbForcePerInSup2":{"text":"lb/in","placement":"Suffix","space":true},"lbfPerInSup2":{"text":"lbf/in","placement":"Suffix","space":true},"psi":{"text":"psi","placement":"Suffix","space":true},"psia":{"text":"psia","placement":"Suffix","space":true},"psig":{"text":"psig","placement":"Suffix","space":true}}},"poundsMass":{"defaultSymbol":"lbMass","unitSystem":"Imperial","factor":0.45359237,"parentUnits":{"kilograms":1},"symbols":{"lbMass":{"text":"lb","placement":"Suffix","space":true},"lbm":{"text":"lbm","placement":"Suffix","space":true}}},"poundsMassPerCubicFoot":{"defaultSymbol":"lbMassPerFtSup3","unitSystem":"Imperial","parentUnits":{"poundsMass":1,"cubicFeet":-1},"symbols":{"lbMassPerFtSup3":{"text":"lb/ft","placement":"Suffix","space":true},"lbmPerFtSup3":{"text":"lbm/ft","placement":"Suffix","space":true}}},"poundsMassPerCubicInch":{"defaultSymbol":"lbMassPerInSup3","unitSystem":"Imperial","parentUnits":{"poundsMass":1,"cubicInches":-1},"symbols":{"lbMassPerInSup3":{"text":"lb/in","placement":"Suffix","space":true},"lbmPerInSup3":{"text":"lbm/in","placement":"Suffix","space":true}}},"poundsMassPerFoot":{"defaultSymbol":"lbMassPerFt","unitSystem":"Imperial","parentUnits":{"poundsMass":1,"feet":-1},"symbols":{"lbMassPerFt":{"text":"lb/ft","placement":"Suffix","space":true},"lbmPerFt":{"text":"lbm/ft","placement":"Suffix","space":true}}},"poundsMassPerFootHour":{"defaultSymbol":"lbMassPerFtDashH","unitSystem":"Imperial","parentUnits":{"poundsMassPerFoot":1,"hours":-1},"symbols":{"lbMassPerFtDashH":{"text":"lb/ft-h","placement":"Suffix","space":true},"lbmPerFtDashH":{"text":"lbm/ft-h","placement":"Suffix","space":true}}},"poundsMassPerFootSecond":{"defaultSymbol":"lbMassPerFtDashS","unitSystem":"Imperial","parentUnits":{"poundsMassPerFoot":1,"seconds":-1},"symbols":{"lbMassPerFtDashS":{"text":"lb/ft-s","placement":"Suffix","space":true},"lbmPerFtDashS":{"text":"lbm/ft-s","placement":"Suffix","space":true}}},"poundsMassPerHour":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"hours":-1},"symbols":{"lbMassPerH":{"text":"lb/h","placement":"Suffix","space":true}}},"poundsMassPerMinute":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"minutes":-1},"symbols":{"lbMassPerMin":{"text":"lb/min","placement":"Suffix","space":true}}},"poundsMassPerPoundDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"poundMassDegreesFahrenheit":-1},"symbols":{"lbMassPerLbDegreeF":{"text":"lb/(lbF)","placement":"Suffix","space":true}}},"poundsMassPerSecond":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"seconds":-1},"symbols":{"lbMassPerS":{"text":"lb/s","placement":"Suffix","space":true}}},"poundsMassPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"squareFeet":-1},"symbols":{"lbMassPerFtSup2":{"text":"lb/ft","placement":"Suffix","space":true}}},"radians":{"unitSystem":"Metric","symbols":{"rad":{"text":"rad","placement":"Suffix","space":true}}},"radiansPerSecond":{"unitSystem":"Metric","parentUnits":{"radians":1,"seconds":-1},"symbols":{"radPerS":{"text":"rad/s","placement":"Suffix","space":true}}},"rankine":{"unitSystem":"Imperial","parentUnit":"rankineInterval","symbols":{"degreeR":{"text":"R","placement":"Suffix","space":true}}},"rankineInterval":{"defaultSymbol":"degreeRInterval","unitSystem":"Imperial","parentFactors":{"nineFifths":-1},"parentUnits":{"kelvinInterval":1},"symbols":{"degreeRInterval":{"text":"R","placement":"Suffix","space":true},"deltaDegreeR":{"text":"deltaR","placement":"Suffix","space":true}}},"ratioTo1":{"unitSystem":"Metric","symbols":{"colon1":{"text":":1","placement":"Suffix","space":false}}},"ratioTo10":{"unitSystem":"Metric","parentFactors":{"ten":-1},"parentUnits":{"ratioTo1":1},"symbols":{"colon10":{"text":":10","placement":"Suffix","space":false}}},"ratioTo12":{"unitSystem":"Imperial","parentFactors":{"twelve":-1},"parentUnits":{"ratioTo1":1},"symbols":{"colon12":{"text":":12","placement":"Suffix","space":false}}},"revolutionsPerMinute":{"unitSystem":"Imperial","parentUnits":{"turns":1,"minutes":-1},"symbols":{"rpm":{"text":"RPM","placement":"Suffix","space":true}}},"revolutionsPerSecond":{"unitSystem":"Metric","parentUnits":{"turns":1,"seconds":-1},"symbols":{"rps":{"text":"RPS","placement":"Suffix","space":true}}},"riseDividedBy1000Millimeters":{"unitSystem":"Metric","parentUnits":{"perMille":1}},"riseDividedBy10Feet":{"unitSystem":"Imperial","parentUnits":{"ratioTo10":1}},"riseDividedBy120Inches":{"unitSystem":"Imperial","parentFactors":{"ten":-1},"parentUnits":{"riseDividedBy12Inches":1}},"riseDividedBy12Inches":{"unitSystem":"Imperial","parentUnits":{"ratioTo12":1}},"riseDividedBy1Foot":{"unitSystem":"Imperial","parentUnits":{"ratioTo1":1}},"seconds":{"unitSystem":"Metric","dimension":"time","symbols":{"second":{"text":"s","placement":"Suffix","space":true}}},"siemens":{"unitSystem":"Metric","parentUnits":{"mhos":1},"symbols":{"siemens":{"text":"S","placement":"Suffix","space":true}}},"slugs":{"unitSystem":"Imperial","parentUnits":{"poundsForce":1,"seconds":2,"feet":-1},"symbols":{"slug":{"text":"slug","placement":"Suffix","space":true}}},"squareCentimeters":{"defaultSymbol":"cmSup2","unitSystem":"Metric","parentUnits":{"centimeters":2},"symbols":{"cmCaret2":{"text":"cm^2","placement":"Suffix","space":true},"cmSup2":{"text":"cm","placement":"Suffix","space":true}}},"squareCentimetersPerMeter":{"unitSystem":"Metric","parentUnits":{"squareCentimeters":1,"meters":-1},"symbols":{"cmSup2PerM":{"text":"cm/m","placement":"Suffix","space":true}}},"squareFeet":{"defaultSymbol":"ftSup2","unitSystem":"Imperial","parentUnits":{"feet":2},"symbols":{"ftCaret2":{"text":"ft^2","placement":"Suffix","space":true},"ftSup2":{"text":"ft","placement":"Suffix","space":true},"sf":{"text":"SF","placement":"Suffix","space":true}}},"squareFeetPer1000BritishThermalUnitsPerHour":{"defaultSymbol":"ftSup2HPerKbtu","unitSystem":"Imperial","factor":0.001,"parentUnits":{"squareFeet":1,"britishThermalUnitsPerHour":-1},"symbols":{"ftSup2HPerKbtu":{"text":"fth/kBtu","placement":"Suffix","space":true},"ftSup2PerMbh":{"text":"ft/MBh","placement":"Suffix","space":true},"sfHPerKbtu":{"text":"SFh/kBtu","placement":"Suffix","space":true},"sfPerMbh":{"text":"SF/MBh","placement":"Suffix","space":true}}},"squareFeetPerFoot":{"unitSystem":"Imperial","parentUnits":{"squareFeet":1,"feet":-1},"symbols":{"ftSup2PerFt":{"text":"ft/ft","placement":"Suffix","space":true}}},"squareFeetPerKip":{"unitSystem":"Imperial","parentUnits":{"squareFeet":1,"kips":-1},"symbols":{"ftSup2PerKip":{"text":"ft/kip","placement":"Suffix","space":true}}},"squareFeetPerKipFoot":{"unitSystem":"Imperial","parentUnits":{"squareFeet":1,"kipFeet":-1},"symbols":{"ftSup2PerKipDashFt":{"text":"ft/kip-ft","placement":"Suffix","space":true}}},"squareFeetPerSecond":{"unitSystem":"Imperial","parentUnits":{"squareFeet":1,"seconds":-1},"symbols":{"ftSup2PerS":{"text":"ft/s","placement":"Suffix","space":true}}},"squareFeetPerTonOfRefrigeration":{"defaultSymbol":"ftSup2PerTon","unitSystem":"Imperial","parentUnits":{"squareFeet":1,"tonsOfRefrigeration":-1},"symbols":{"ftSup2PerTon":{"text":"ft/ton","placement":"Suffix","space":true},"sfPerTon":{"text":"SF/ton","placement":"Suffix","space":true}}},"squareHectometers":{"unitSystem":"Metric","parentUnits":{"hectometers":2},"symbols":{"hmSup2":{"text":"hm","placement":"Suffix","space":true}}},"squareInches":{"defaultSymbol":"inSup2","unitSystem":"Imperial","parentUnits":{"inches":2},"symbols":{"inCaret2":{"text":"in^2","placement":"Suffix","space":true},"inSup2":{"text":"in","placement":"Suffix","space":true}}},"squareInchesPerFoot":{"unitSystem":"Imperial","parentUnits":{"squareInches":1,"feet":-1},"symbols":{"inSup2PerFt":{"text":"in/ft","placement":"Suffix","space":true}}},"squareMeterKelvinsPerWatt":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"kelvinInterval":1,"watts":-1},"symbols":{"mSup2KPerW":{"text":"(mK)/W","placement":"Suffix","space":true}}},"squareMeters":{"defaultSymbol":"mSup2","unitSystem":"Metric","parentUnits":{"meters":2},"symbols":{"mCaret2":{"text":"m^2","placement":"Suffix","space":true},"mSup2":{"text":"m","placement":"Suffix","space":true}}},"squareMetersPerKilonewton":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"kilonewtons":-1},"symbols":{"mSup2PerKN":{"text":"m/kN","placement":"Suffix","space":true}}},"squareMetersPerKilonewtonMeter":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"kilonewtonMeters":-1},"symbols":{"mSup2PerKNDashM":{"text":"m/kN-m","placement":"Suffix","space":true}}},"squareMetersPerKilowatt":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"kilowatts":-1},"symbols":{"mSup2PerKw":{"text":"m/kW","placement":"Suffix","space":true}}},"squareMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"meters":-1},"symbols":{"mSup2PerM":{"text":"m/m","placement":"Suffix","space":true}}},"squareMetersPerSecond":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"seconds":-1},"symbols":{"mSup2PerS":{"text":"m/s","placement":"Suffix","space":true}}},"squareMillimeters":{"defaultSymbol":"mmSup2","unitSystem":"Metric","parentUnits":{"millimeters":2},"symbols":{"mmCaret2":{"text":"mm^2","placement":"Suffix","space":true},"mmSup2":{"text":"mm","placement":"Suffix","space":true}}},"squareMillimetersPerMeter":{"unitSystem":"Metric","parentUnits":{"squareMillimeters":1,"meters":-1},"symbols":{"mmSup2PerM":{"text":"mm/m","placement":"Suffix","space":true}}},"squareMils":{"defaultSymbol":"milSup2","unitSystem":"Imperial","parentUnits":{"mils":2},"symbols":{"milCaret2":{"text":"mil^2","placement":"Suffix","space":true},"milSup2":{"text":"mil","placement":"Suffix","space":true}}},"squareYards":{"unitSystem":"Imperial","parentUnits":{"yards":2},"symbols":{"ydSup2":{"text":"yd","placement":"Suffix","space":true}}},"standardGravity":{"unitSystem":"Metric","factor":9.80665,"parentUnits":{"metersPerSecondSquared":1},"symbols":{"gravity":{"text":"","placement":"Suffix","space":true}}},"steradians":{"unitSystem":"Metric","symbols":{"sr":{"text":"sr","placement":"Suffix","space":true}}},"teslas":{"unitSystem":"Metric","parentUnits":{"webers":1,"meters":-2},"symbols":{"tesla":{"text":"T","placement":"Suffix","space":true}}},"therms":{"unitSystem":"Imperial","factor":100000,"parentUnits":{"britishThermalUnits":1},"symbols":{"therm":{"text":"therm","placement":"Suffix","space":true}}},"thousandBritishThermalUnits":{"unitSystem":"Imperial","parentFactors":{"kilo":1},"parentUnits":{"britishThermalUnits":1},"symbols":{"kBtu":{"text":"kBtu","placement":"Suffix","space":true}}},"thousandBritishThermalUnitsPerHour":{"unitSystem":"Imperial","factor":1000,"parentUnits":{"britishThermalUnitsPerHour":1},"symbols":{"mbh":{"text":"MBH","placement":"Suffix","space":true}}},"thousandBritishThermalUnitsPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"thousandBritishThermalUnits":1,"squareFeet":-1},"symbols":{"kBtuPerFtSup2":{"text":"kBtu/ft","placement":"Suffix","space":true}}},"tonneForceMeters":{"unitSystem":"Metric","parentUnits":{"tonnesForce":1,"meters":1},"symbols":{"tfDashM":{"text":"Tf-m","placement":"Suffix","space":true}}},"tonneForceMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"tonneForceMeters":1,"meters":-1},"symbols":{"tfDashMPerM":{"text":"Tf-m/m","placement":"Suffix","space":true}}},"tonnes":{"unitSystem":"Metric","factor":1000,"parentUnits":{"kilograms":1},"symbols":{"tonne":{"text":"t","placement":"Suffix","space":true}}},"tonnesForce":{"unitSystem":"Metric","parentUnits":{"tonnes":1,"standardGravity":1},"symbols":{"tf":{"text":"Tf","placement":"Suffix","space":true}}},"tonnesForcePerMeter":{"unitSystem":"Metric","parentUnits":{"tonnesForce":1,"meters":-1},"symbols":{"tfPerM":{"text":"Tf/m","placement":"Suffix","space":true}}},"tonnesForcePerSquareMeter":{"unitSystem":"Metric","parentUnits":{"tonnesForce":1,"squareMeters":-1},"symbols":{"tfPerMSup2":{"text":"Tf/m","placement":"Suffix","space":true}}},"tonsOfRefrigeration":{"defaultSymbol":"ton","unitSystem":"Imperial","factor":12000,"parentUnits":{"britishThermalUnitsPerHour":1},"symbols":{"ton":{"text":"ton","placement":"Suffix","space":true},"tonOfRefrigeration":{"text":"ton of refrigeration","placement":"Suffix","space":true}}},"turns":{"unitSystem":"Metric","factor":2,"parentFactors":{"pi":1},"parentUnits":{"radians":1},"symbols":{"tr":{"text":"tr","placement":"Suffix","space":true}}},"usGallons":{"unitSystem":"Imperial","factor":231,"parentUnits":{"cubicInches":1},"symbols":{"gal":{"text":"gal","placement":"Suffix","space":true}}},"usGallonsPerHour":{"defaultSymbol":"galPerH","unitSystem":"Imperial","parentUnits":{"usGallons":1,"hours":-1},"symbols":{"galPerH":{"text":"gal/h","placement":"Suffix","space":true},"gph":{"text":"GPH","placement":"Suffix","space":true},"usgph":{"text":"usgph","placement":"Suffix","space":true}}},"usGallonsPerMinute":{"defaultSymbol":"galPerMin","unitSystem":"Imperial","parentUnits":{"usGallons":1,"minutes":-1},"symbols":{"galPerMin":{"text":"gal/min","placement":"Suffix","space":true},"gpm":{"text":"GPM","placement":"Suffix","space":true},"usgpm":{"text":"usgpm","placement":"Suffix","space":true}}},"usSurveyFeet":{"unitSystem":"Imperial","factor":1200,"parentFactors":{"threeThousandNineHundredThirtySeven":-1},"parentUnits":{"meters":1},"symbols":{"usft":{"text":"USft","placement":"Suffix","space":true}}},"usTonnesForce":{"defaultSymbol":"stf","unitSystem":"Imperial","parentUnits":{"usTonnesMass":1,"standardGravity":1},"symbols":{"stf":{"text":"STf","placement":"Suffix","space":true},"tonsf":{"text":"Tonsf","placement":"Suffix","space":true},"usTonnesForceSt":{"text":"ST","placement":"Suffix","space":true},"usTonnesForceT":{"text":"T","placement":"Suffix","space":true},"usTonnesForceTons":{"text":"Tons","placement":"Suffix","space":true}}},"usTonnesMass":{"defaultSymbol":"usTonnesMassSt","unitSystem":"Imperial","factor":2000,"parentUnits":{"poundsMass":1},"symbols":{"usTonnesMassSt":{"text":"ST","placement":"Suffix","space":true},"usTonnesMassT":{"text":"T","placement":"Suffix","space":true},"usTonnesMassTons":{"text":"Tons","placement":"Suffix","space":true}}},"voltAmperes":{"unitSystem":"Metric","parentUnits":{"volts":1,"amperes":1},"symbols":{"vA":{"text":"VA","placement":"Suffix","space":true}}},"voltAmperesPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"voltAmperes":1,"squareFeet":-1},"symbols":{"vAPerFtSup2":{"text":"VA/ft","placement":"Suffix","space":true}}},"voltAmperesPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"voltAmperes":1,"squareMeters":-1},"symbols":{"vAPerMSup2":{"text":"VA/m","placement":"Suffix","space":true}}},"volts":{"unitSystem":"Metric","parentUnits":{"watts":1,"amperes":-1},"symbols":{"volt":{"text":"V","placement":"Suffix","space":true}}},"waterDensity4DegreesCelsius":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"liters":-1}},"watts":{"unitSystem":"Metric","parentUnits":{"joules":1,"seconds":-1},"symbols":{"watt":{"text":"W","placement":"Suffix","space":true}}},"wattsPerCubicFoot":{"unitSystem":"Imperial","parentUnits":{"watts":1,"cubicFeet":-1},"symbols":{"wPerFtSup3":{"text":"W/ft","placement":"Suffix","space":true}}},"wattsPerCubicFootPerMinute":{"unitSystem":"Imperial","parentUnits":{"watts":1,"cubicFeetPerMinute":-1},"symbols":{"wMinPerFtSup3":{"text":"Wmin/ft","placement":"Suffix","space":true}}},"wattsPerCubicMeter":{"unitSystem":"Metric","parentUnits":{"watts":1,"cubicMeters":-1},"symbols":{"wPerMSup3":{"text":"W/m","placement":"Suffix","space":true}}},"wattsPerCubicMeterPerSecond":{"unitSystem":"Metric","parentUnits":{"watts":1,"cubicMetersPerSecond":-1},"symbols":{"wSPerMSup3":{"text":"Ws/m","placement":"Suffix","space":true}}},"wattsPerFoot":{"unitSystem":"Imperial","parentUnits":{"watts":1,"feet":-1},"symbols":{"wPerFt":{"text":"W/ft","placement":"Suffix","space":true}}},"wattsPerMeter":{"unitSystem":"Metric","parentUnits":{"watts":1,"meters":-1},"symbols":{"wPerM":{"text":"W/m","placement":"Suffix","space":true}}},"wattsPerMeterKelvin":{"unitSystem":"Metric","parentUnits":{"watts":1,"meters":-1,"kelvinInterval":-1},"symbols":{"wPerMK":{"text":"W/(mK)","placement":"Suffix","space":true}}},"wattsPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"watts":1,"squareFeet":-1},"symbols":{"wPerFtSup2":{"text":"W/ft","placement":"Suffix","space":true}}},"wattsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"watts":1,"squareMeters":-1},"symbols":{"wPerMSup2":{"text":"W/m","placement":"Suffix","space":true}}},"wattsPerSquareMeterKelvin":{"unitSystem":"Metric","parentUnits":{"wattsPerSquareMeter":1,"kelvinInterval":-1},"symbols":{"wPerMSup2K":{"text":"W/(mK)","placement":"Suffix","space":true}}},"webers":{"unitSystem":"Metric","parentUnits":{"volts":1,"seconds":1},"symbols":{"wb":{"text":"Wb","placement":"Suffix","space":true}}},"yards":{"unitSystem":"Imperial","factor":3,"parentUnits":{"feet":1},"symbols":{"yd":{"text":"yd","placement":"Suffix","space":true}}},"feetFractionalInches":{"defaultSymbol":"feetAndInches","unitSystem":"Imperial","factor":12,"parentUnits":{"inches":1},"symbols":{"feetAndInches":{"inherits":"symbol"},"footSingleQuote":{"text":"\'","placement":"Suffix","space":false},"ft":{"text":"ft","placement":"Suffix","space":true},"lf":{"text":"LF","placement":"Suffix","space":true}}},"fractionalInches":{"defaultSymbol":"in","unitSystem":"Imperial","factor":2.54,"parentUnits":{"centimeters":1},"symbols":{"in":{"text":"in","placement":"Suffix","space":true},"inchDoubleQuote":{"text":"\\"","placement":"Suffix","space":false}}},"metersCentimeters":{"defaultSymbol":"meter","unitSystem":"Metric","dimension":"length","symbols":{"meter":{"text":"m","placement":"Suffix","space":true},"metersAndCentimeters":{"inherits":"symbol"}}},"degreesMinutes":{"defaultSymbol":"degree","unitSystem":"Metric","parentFactors":{"threeHundredSixty":-1},"parentUnits":{"turns":1},"symbols":{"degree":{"text":"","placement":"Suffix","space":false},"degreesMinutesSeconds":{"inherits":"symbol"}}},"slopeDegrees":{"defaultSymbol":"slopeDegree","unitSystem":"Metric","parentFactors":{"threeHundredSixty":-1},"parentUnits":{"turns":1},"symbols":{"slopeDegree":{"text":"","placement":"Suffix","space":false}}},"stationingFeet":{"defaultSymbol":"feetAndInches","unitSystem":"Imperial","factor":12,"parentUnits":{"inches":1},"symbols":{"feetAndInches":{"inherits":"symbol"},"footSingleQuote":{"text":"\'","placement":"Suffix","space":false},"ft":{"text":"ft","placement":"Suffix","space":true},"lf":{"text":"LF","placement":"Suffix","space":true}}},"stationingMeters":{"defaultSymbol":"meter","unitSystem":"Metric","dimension":"length","symbols":{"meter":{"text":"m","placement":"Suffix","space":true},"metersAndCentimeters":{"inherits":"symbol"}}},"stationingSurveyFeet":{"unitSystem":"Imperial","factor":1200,"parentFactors":{"threeThousandNineHundredThirtySeven":-1},"parentUnits":{"meters":1},"symbols":{"usft":{"text":"USft","placement":"Suffix","space":true}}},"dateTime":{"symbols":{"date":{"text":"Date"},"dateTime":{"text":"ISODate","description":"default"},"dateAndTime":{"text":"Date, Time"}}}}}');var oy={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in",POINT:"pt"};const sy={[oy.METER]:1,[oy.CENTIMETER]:.01,[oy.MILLIMETER]:.001,[oy.FOOT]:.3048,[oy.INCH]:.0254,[oy.POINT]:.0254/72};function ay(e){let t="";return 2===e?t=String.fromCharCode(178):3===e&&(t=String.fromCharCode(179)),t}function ly(e){var t=0<=e?Math.floor(e):Math.ceil(e);return{intPart:t,fracPart:e-t}}function cy(e,t,i){var n="";return i&&0===e&&(n+="-"),n+=0<t?e.toFixed(t):e.toFixed(0)}function uy(e,t,i,n){for(var r,o,s="",a=1,l=e<0,c=0;c<t;++c)a*=2;e>0?e+=.5/a:e-=.5/a,i?o=e:(s+=cy(r=ly(e/12).intPart,0,l)+n.feet+" ",(o=e-12*r)<0&&(o=-o));var u=ly(o).intPart,h=ly((o-u)*a).intPart;if(0!==h&&0===u||(s+=cy(u,0)),0!==h){for(u<0&&h<0&&(h=-h);h%2==0;)h/=2,a/=2;0!==u&&(s+="-"),s+=cy(h,0)+"/"+cy(a,0)}return s+=n.inches}function hy(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;var n="";e<0&&(n="-",e=Math.abs(e));var r=ly(e),o=r.intPart,s=r.fracPart*Math.pow(100,i);const a=ay(i);let l=cy(o,0),c=cy(s,t);return c.startsWith(Math.pow(100,i).toString())&&(l=cy(o+1,0),c=cy(0,t)),n+l+` m${a} `+c+` cm${a}`}function dy(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;var r="";e<0&&(r="-",e=Math.abs(e));var o=ly(e),s=o.intPart,a=o.fracPart*Math.pow(12,n);const l=ay(n);let c=cy(s,0),u=cy(a,t);return u.startsWith(Math.pow(12,n).toString())&&(c=cy(s+1,0),u=cy(0,t)),r+c+i.feet+l+" "+u+i.inches+l}const fy={feetFractionalInches:"ft-and-fractional-in",fractionalInches:"fractional-in",feet:"feet",inches:"inches",stationingFeet:"feet"};function py(e){if(!e||!e.startsWith("autodesk.unit.unit:"))return e;let t=e.split(":")[1].split("-")[0],i=ry.zA[t];if(!i)return console.warn("Failed to find Forge unit schema for",e),e;{let e=fy[t];if(e)return e;if(!i.symbols)return console.warn("Unit without symbols.",i),"";if(i.defaultSymbol&&i.symbols[i.defaultSymbol])return i.symbols[i.defaultSymbol];for(let e in i.symbols)return i.symbols[e]}}function my(e,t,i,n,r){var o;null==n&&(n=3);const s=(r=r||{}).preferLetters?{feet:" ft",inches:" in"}:{feet:"'",inches:'"'};t=py(t);try{if(1===i)o=hs.t(e?"Yes":"No");else if(24===i){var a=e.split(" ");o=[];for(var l=0;l<a.length;++l)o.push(my(parseFloat(a[l]),t,3,n));o=o.join(", ")}else if(2!==i&&3!==i||!isNaN(e))if("ft-and-fractional-in"===t)o=uy(12*e,n,!1,s);else if("ft-and-fractional-in^2"===t)o=r.noMixedArea?cy(e,n)+" ft"+ay(2):uy(12*e,n,!1,s)+" "+ay(2);else if("ft-and-fractional-in^3"===t)o=r.noMixedVolume?cy(e,n)+" ft"+ay(3):uy(12*e,n,!1,s)+" "+ay(3);else if("ft-and-decimal-in"===t)o=dy(e,n,s);else if("ft-and-decimal-in^2"===t)o=r.noMixedArea?cy(e,n)+" ft"+ay(2):dy(e,n,s,2);else if("ft-and-decimal-in^3"===t)o=r.noMixedVolume?cy(e,n)+" ft"+ay(3):dy(e,n,s,3);else if("decimal-in"===t||"in"===t||"inch"===t||"inches"===t)o=cy(e,n)+s.inches;else if("decimal-in^2"===t||"in^2"===t||"inch^2"===t)o=cy(e,n)+" in"+ay(2);else if("decimal-in^3"===t||"in^3"===t||"inch^3"===t)o=cy(e,n)+" in"+ay(3);else if("decimal-in-sq"===t||"fractional-in-sq"===t)o=cy(e,n)+" sq. in";else if("decimal-ft"===t||"ft"===t||"feet"===t||"foot"===t)o=cy(e,n)+s.feet;else if("decimal-ft^2"===t||"ft^2"===t||"feet^2"===t||"foot^2"===t)o=cy(e,n)+" ft"+ay(2);else if("decimal-ft^3"===t||"ft^3"===t||"feet^3"===t||"foot^3"===t)o=cy(e,n)+" ft"+ay(3);else if("decimal-ft-sq"===t||"ft-and-fractional-in-sq"===t||"ft-and-decimal-in-sq"===t)o=cy(e,n)+" sq. ft";else if("fractional-in"===t)o=uy(e,n,!0,s);else if("fractional-in^2"===t)o=uy(e,n,!0,s)+ay(2);else if("fractional-in^3"===t)o=uy(e,n,!0,s)+ay(3);else if("m-and-cm"===t)o=hy(e,n);else if("m-and-cm^2"===t)o=r.noMixedArea?cy(e,n)+" m"+ay(2):hy(e,n,2);else if("m-and-cm^3"===t)o=r.noMixedVolume?cy(e,n)+" m"+ay(3):hy(e,n,3);else if(t&&t.text){o=function(e,t){const i=t.space?" ":"";return"Prefix"===t.placement?t.text+i+e:e+i+t.text}(3===i?cy(e,n):e,t)}else 3===i&&t?(t=(t=t.replace("^2",ay(2))).replace("^3",ay(3)),o=cy(e,n)+" "+t):o=t?e+" "+t:3===i?cy(e,n):e;else o="NaN"}catch(i){o=t?e+" "+t:e}return o}function gy(e){var t;switch(e=null===(t=e)||void 0===t?void 0:t.toLowerCase()){case"meter":case"meters":case"m":return oy.METER;case"foot":case"feet":case"ft":return oy.FOOT;case"feet and inches":case"inch":case"inches":case"in":return oy.INCH;case"centimeter":case"centimeters":case"cm":return oy.CENTIMETER;case"millimeter":case"millimeters":case"mm":return oy.MILLIMETER;case"point":case"points":case"pt":return oy.POINT;default:return e}}function vy(e){let t=gy(e);return{unitString:t,unitScale:sy[t]||1}}function yy(e,t,i,n,r,o){if(i=i||1,o=o||72,(e=gy(e))===(t=gy(t))&&1===i)return n;const s=oy,a=sy;var l=1;switch(t){case s.MILLIMETER:l=1/a[s.MILLIMETER];break;case s.CENTIMETER:l=1/a[s.CENTIMETER];break;case s.METER:l=1;break;case s.INCH:l=1/a[s.INCH];break;case s.FOOT:case"ft-and-fractional-in":case"ft-and-decimal-in":l=1/a[s.FOOT];break;case"decimal-in":l=1/a[s.INCH];break;case"decimal-ft":l=1/a[s.FOOT];break;case"fractional-in":l=1/a[s.INCH];break;case"m-and-cm":l=1;break;case s.POINT:l=1/a[s.INCH]*o}var c=1;switch(e){case s.MILLIMETER:c=a[s.MILLIMETER];break;case s.CENTIMETER:c=a[s.CENTIMETER];break;case s.METER:c=a[s.METER];break;case s.INCH:c=a[s.INCH];break;case s.FOOT:case"ft-and-fractional-in":case"ft-and-decimal-in":c=a[s.FOOT];break;case"decimal-in":c=a[s.INCH];break;case"decimal-ft":c=a[s.FOOT];break;case"fractional-in":c=a[s.INCH];break;case"m-and-cm":c=1;break;case s.POINT:c=a[s.INCH]/o}return"square"===r?n?n*Math.pow(l*c*i,2):0:"cube"===r?n?n*Math.pow(l*c*i,3):0:n?n*l*c*i:0}function by(e){if(!e)return 0;var t=e.toString().split(".")[1];if(!t){var i=e.toString().split("/")[1],n=i&&i.match(/\d+/);if(n){var r=parseFloat(n);if(r&&!isNaN(r))return Math.floor(Math.log2(r))}return 0}return(t=t.match(/\d+/))&&t[0]&&t[0].length||0}function xy(e,t,i,n){if(!i||!n)return{displayValue:e,displayUnits:i};let r=i,o=n;const s=py(r);let a;if("object"==typeof s&&"text"in s&&(r=s.text),r&&(r=r.replace(/$/,"^2").replace(/$/,"^3")),/\^2$/.test(r)?(r=r.replace("^2",""),o+="^2",a="square"):/\^3$/.test(r)&&(r=r.replace("^3",""),o+="^3",a="cube"),r=bs(r),null===r)return{displayValue:e,displayUnits:i};if(2===t||3===t){return{displayValue:yy(r,n,1,e,a,null),displayUnits:o}}if(24===t){return{displayValue:e.split(" ").map((e=>yy(r,n,1,e,a,null))).join(" "),displayUnits:o}}return{displayValue:e,displayUnits:i}}function _y(e){switch(e){case"decimal-ft":case"ft-and-fractional-in":case"ft-and-decimal-in":return"ft";case"decimal-in":case"fractional-in":return"in";case"m-and-cm":return"m"}return e}var Ey={Unknown:0,Boolean:1,Integer:2,Double:3,Float:4,BLOB:10,DbKey:11,String:20,LocalizableString:21,DateTime:22,GeoLocation:23,Position:24},Sy={afHidden:1,afDontIndex:2,afDirectStorage:4,afReadOnly:8},Ay={Dimensions:["Perimeter","Volume","Area","Length","Width","Height"]},wy={Item:["Source File"]};const Cy=e=>[Ey.Integer,Ey.Double,Ey.Float].includes(e);class Ty{constructor(e){this.map=e}forEach(e){if(e)for(let t in this.map){if("__selected_dbIds__"===t)continue;e(t,this.map[t])}}getAggregation(e){if(!e)return null;if("string"==typeof e&&(e=this.map[e]),0===e.length)return null;const t=e[0].type;if(!Cy(t))return null;const i={average:0,count:0,max:0,median:0,min:0,mode:[],range:0,sum:0},n=e.map((e=>Number(e.displayValue)));n.sort(((e,t)=>e-t));const r={};let o=0,s=0;n.forEach((e=>{s+=e,Object.prototype.hasOwnProperty.call(r,e)?r[e]++:r[e]=1,o=Math.max(o,r[e]),i.sum+=e})),i.count=n.length,i.average=s/i.count,i.max=n[i.count-1],i.min=n[0];const a=Math.ceil(i.count/2);i.median=i.count%2&&i.count>1?(n[a]+n[a-1])/2:n[a-1];for(let e in r)r[e]===o&&i.mode.push(Number(e));return i.range=i.max-i.min,i.sum=function(e,t){var i=t.displayValue.toString().split(".");if(1===i.length)return e;const n=e.toString().split(".");if(1===n.length)return e;const r=n[1];let o=i[1];if(r===o)return e;o=o.match(/\d+/);const s=o&&o[0]&&o[0].length||t.precision||0;return Number(e.toFixed(s))}(i.sum,e[0]),i}getValue2PropertiesMap(e){if(!e)return null;if("string"==typeof e&&(e=this.map[e]),!e||0===e.length)return null;const t={};return e.forEach((e=>{Object.prototype.hasOwnProperty.call(t,e.displayValue)||(t[e.displayValue]=[]),t[e.displayValue].push(e.parentName)})),t}getValidIds(e,t){const i=Object.keys(this.map),n=[];for(let r=0;r<i.length;r++){const o=i[r];if(e){if(-1!==o.indexOf(e)){n.push(o);continue}}if(t){const e=o.split("/");if(e.length>=2&&e[0]===t){n.push(o);continue}}}return n}getDbIds(){return this.map.__selected_dbIds__}getVisibleKeys(){const e=[];return this.forEach(((t,i)=>{i[0].hidden||e.push(t)})),e}getKeysWithCategories(){const e=[];return this.forEach(((t,i)=>{const n=!!i[0].hidden;i[0].displayCategory&&!n&&e.push(t)})),e}merge(e){if(!(e instanceof Ty))return this;const t=e.map;for(let e in t){const i=t[e];if(!Object.prototype.hasOwnProperty.call(this.map,e)){this.map[e]=i;continue}const n=this.map[e];if("__selected_dbIds__"!==e)for(let e=0;e<i.length;e++){const t=i[e];let r=!0;for(let e=0;e<n.length;e++){const i=n[e];t.displayValue!==i.displayValue||t.dbId!==i.dbId||(r=!1)}r&&n.push(t)}else this.map[e]=[...n,...i]}return this}}var My=r(18211);const Iy=My.hp.from&&My.hp.alloc&&My.hp.allocUnsafe&&My.hp.allocUnsafeSlow?My.hp.from:e=>new My.hp(e);let Py=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(Py=new Int32Array(Py));const Ly=function(e,t){const i=(e,i)=>t(e,i)>>>0;return i.signed=t,i.unsigned=i,i.model=e,i}("crc-32",(function(e,t){My.hp.isBuffer(e)||(e=Iy(e));let i=0===t?0:~t;for(let t=0;t<e.length;t++){const n=e[t];i=Py[255&(i^n)]^i>>>8}return~i})),Ry=Ly;class Dy extends ty{myData;topology=null;topologyPromise=null;svfUUID=null;defaultCameraHash=null;loader=void 0;constructor(e){super(e),this.myData=e,Ba.prototype.apply(this);const t={};t.isSVF2=this.isSVF2(),t.isOTG=this.isOTG(),t.is2d=this.is2d(),super.setModelFormat(t)}initialize(){super.initialize();const e=new iy(this);this.addTraversalController("Linear",e)}getInstanceTree(){const e=this.getData();return e?e.instanceTree:null}getFuzzyBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=Boolean(e.ignoreTransforms),i=this.getFragmentList();if(!i||this.is2d())return this.getBoundingBox(t);var n=null;if(t){var r=new Array(6);const e=this.getData().placementWithOffset,t=e?e.clone().invert():void 0;n=function(e,n){i.getOriginalWorldBounds(e,r),n.min.fromArray(r),n.max.fromArray(r,3),t&&n.applyMatrix4(t)}}else n=function(e,t){i.getWorldBounds(e,t)};var o=e.center||function(){var t=new THREE.Box3,r=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3,a=0;function l(i){if(!e.allowlist||e.allowlist.includes(i)){n(i,t),t.getCenter(r);var l=t.getSize(o).length();s.add(r.multiplyScalar(l)),a+=l}}for(var c=0;c<i.getCount();c++)l(c);return s.multiplyScalar(1/a),s}(),s=e.quantil||.75,a=new THREE.Box3,l=[];const c=new THREE.Vector3;for(let t=0;t<i.getCount();t++)if((!e.allowlist||e.allowlist.includes(t))&&(n(t,a),!a.isEmpty())){var u=a.distanceToPoint(o);0===u&&(u=o.distanceTo(a.getCenter(c))),l.push({fragId:t,distance:u})}l.sort((function(e,t){return e.distance-t.distance}));var h=new THREE.Box3;for(let e=0;e<l.length*s;e++){var d=l[e];n(d.fragId,a),h.union(a)}return h}getBoundingBox(e,t){return super.updateModelBBoxOriginal(this.getData().modelSpaceBBox),super.getModelBounds(e,t)}is2d(){return!(!this.myData||!this.myData.is2d)}is3d(){return!this.is2d()}isOTG(){return this.myData&&!!this.myData.isOTG}isSVF2(){const e=this.getDocumentNode();return!!e&&e.isSVF2()}isPdf(e){return!(!this.myData||!this.myData.isPdf||e&&this.isSmartPdf())}isRevitPdf(){var e;return!(null===(e=this.getDocumentNode())||void 0===e||!e.isRevitPdf())}isSmartPdf(){var e;return!(null===(e=this.getDocumentNode())||void 0===e||!e.isSmartPdf())}isLeaflet(){return!(!this.myData||!this.myData.isLeaflet)}isPageCoordinates(){var e;return this.is2d()&&(!this.isLeaflet()||(null===(e=this.loader)||void 0===e?void 0:e.isPageCoordinates()))}isSceneBuilder(){return!(!this.myData||!this.myData.isSceneBuilder)}getData(){return this.myData}setUUID(e){this.svfUUID=btoa(encodeURI(ni(e)))}getDocumentNode(){var e;return(null===(e=this.getData())||void 0===e||null===(e=e.loadOptions)||void 0===e?void 0:e.bubbleNode)??null}getRoot(){const e=this.getInstanceTree();return e?e.root:null}getRootId(){const e=this.getInstanceTree();return e?e.getRootId():0}getUnitData(e){return console.warn("Model.getUnitData is deprecated and will be removed in a future release, use Autodesk.Viewing.Private.getUnitData() instead."),vy(e)}getUnitScale(){return yy(this.getUnitString(),oy.METER,1,1)}getUnitString(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.overriddenUnits?t.overriddenUnits:t&&t.scalingUnit?t.scalingUnit:this.getMetadata("distance unit","value",null)}return gy(e)}getDisplayUnit(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.scalingUnit?t.scalingUnit:this.getMetadata("default display unit","value",null)||this.getMetadata("distance unit","value",null)}return gy(e)}getSourceFileUnits(){const e=this.getDocumentNode();return null==e?void 0:e.getSourceFileUnits()}getMetadata(e,t,i){var n=this.getData();if(n){var r=n.metadata;if(r){var o=r[e];if(void 0!==o){if(!t)return o;var s=o[t];if(void 0!==s)return s}}}return i}getDefaultCamera(){var e=this.getData();if(!e)return null;var t=null,i=e.cameras?e.cameras.length:0;if(0<i){var n=this.getMetadata("default camera","index",null);if(null!==n&&e.cameras[n])t=e.cameras[n];else{for(var r=0;r<i;r++){var o=e.cameras[r];if(o.isPerspective){t=o;break}}t||(t=e.cameras[0])}}var s=this.getModelTransform();if(t&&s){const e=ny.copyViewParams(t);return ny.transformViewParams(e,s),ny.adjustOrthoCamera(e,this.getBoundingBox()),e}return t}isAEC(){return!!this.getData().loadOptions.isAEC}hasPageShadow(){return this.getData().hasPageShadow}getUpVector(){return this.getMetadata("world up vector","XYZ",null)}getNorthVector(){return this.getMetadata("world north vector","XYZ",null)}getFrontVector(){return this.getMetadata("world front vector","XYZ",null)}geomPolyCount(){var e=this.getGeometryList();return e?e.geomPolyCount:null}instancePolyCount(){var e=this.getGeometryList();return e?e.instancePolyCount:null}isLoadDone(e){const t=this.getData(),i=!e||!1!==t.texLoadDone;return!!(t&&t.loadDone&&i)}isObjectTreeCreated(){return!!this.getInstanceTree()}getPropertyDb(){const e=this.getData();return e&&e.propDbLoader}async getPropertyHashes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;function i(e,t,i,n){const r=(e+t+i+(n??"")).toUpperCase();return`p${Ry(r).toString(16).padStart(8,"0")}`}const n=this.getPropertyDb();if(void 0===n||!0!==n.isLoadDone())return;let r=await n.executeUserFunction("function userFunction(pdb) {\n                const properties = new Set();\n                pdb.enumAttributes((i, attribute, raw) => {\n                properties.add([ attribute.name, attribute.category, attribute.dataType, attribute.dataTypeContext ]);\n            });\n            return Array.from(properties); }");void 0!==e&&e instanceof RegExp&&(r=r.filter((t=>e.test(t[0])))),void 0!==t&&t instanceof RegExp&&(r=r.filter((e=>t.test(e[1]))));for(const e of r){const t=i(e[0],e[1],e[2],e[3]);e.unshift(t),e.pop(),e.pop()}return r}getProperties(e,t,i){var n=this.getPropertyDb();!n||e<=0?i&&i():n.getProperties(e,t,i)}getProperties2(e,t,i,n){var r=this.getPropertyDb();!r||e<=0?i&&i():r.getProperties2(e,t,i,n)}getBulkProperties(e,t,i,n){Array.isArray(t)&&(t={propFilter:t});var r=(t=t||{}).propFilter||null,o=t.ignoreHidden||!1,s=this.getPropertyDb();s?s.getBulkProperties(e,r,i,n,o):n&&n()}getBulkProperties2(e,t,i,n){var r=this.getPropertyDb();r?r.getBulkProperties2(e,t,i,n):n&&n()}getPropertySetAsync(e,t){return new Promise(((i,n)=>{this.getPropertySet(e,i,n,t)}))}getPropertySet(e,t,i,n){var r=this.getPropertyDb();r||i&&i("Properties failed to load."),r.getPropertySet(e,n,(e=>{t(new Ty(e))}),i)}getExternalIdMapping(e,t){var i=this.getPropertyDb();i?i.getExternalIdMapping(e,t):t&&t()}getLayerToNodeIdMapping(e,t){var i=this.getPropertyDb();i?i.getLayerToNodeIdMapping(e,t):t&&t()}getObjectTree(e,t){const i=this.getInstanceTree();if(i)e(i);else{var n=this.getPropertyDb();n?n.getObjectTree(e,t):t&&t()}}isObjectTreeLoaded(){var e=this.getPropertyDb();return!!e&&e.isObjectTreeLoaded()}search(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{searchHidden:!1};var o=this.getPropertyDb();o?o.searchProperties(e,n,t,i,r):i&&i()}findProperty(e){var t=this.getPropertyDb();return t?t.findProperty(e):Promise.reject("Model doesn't have any properties.")}static#Ct(e){var t=.001,i=e;if(Math.abs(i[0])<t)if(Math.abs(i[4])>t)for(var n=0;n<4;n++){var r=i[n];i[n]=i[n+4],i[n+4]=r}else for(let e=0;e<4;e++){const t=i[e];i[e]=i[e+8],i[e+8]=t}if(Math.abs(i[5])<t)for(let e=4;e<8;e++){const t=i[e];i[e]=i[e+4],i[e+4]=t}}static#Tt(e,t,i,n){var r,o,s,a,l,c,u=!1;s=n[i[i.length-1]].x,r=(a=n[i[i.length-1]].y)>=t;for(var h=0,d=i.length;h<d;++h)l=n[i[h]].x,r!=(o=(c=n[i[h]].y)>=t)&&(c-t)*(s-l)>=(l-e)*(a-c)==o&&(u=!u),r=o,s=l,a=c;return u}static#Mt(e,t,i,n){for(var r=!1,o=0;o<i.length;o++)Dy.#Tt(e,t,i[o],n)&&(r=!r);return r}getPageToModelTransform(e){var t,i=this.getData();if(i.pageToModelTransform)return i.pageToModelTransform;var n=i,r=n.metadata.page_dimensions,o=n.viewports&&n.viewports[e];if(!o)return new THREE.Matrix4;n.viewportTransforms||(n.viewportTransforms=new Array(n.viewports.length));var s=n.viewportTransforms[e];if(s)return s;var a=new al(!0).set(r.logical_width/r.page_width,0,0,r.logical_offset_x,0,r.logical_height/r.page_height,0,r.logical_offset_y,0,0,1,0,0,0,0,1),l=(null===(t=o.transform)||void 0===t?void 0:t.slice())||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Dy.#Ct(l);var c=new al(!0);c.elements.set(l);var u=new al(!0);return u.copy(c).invert(),u.multiply(a),n.viewportTransforms[e]=u,u}pageToModel(e,t,i,n){let r=this.getPageToModelTransform(i);function o(e){if(e){var t=(new THREE.Vector3).set(e.x,e.y,0).applyMatrix4(r);e.x=t.x,e.y=t.y,e.z=t.z}}n&&(r=r.clone().invert()),o(e),o(t)}pointInClip(e,t){for(var i=this.getData().clips,n=[],r=1;r<i.length;r++)if(r!==t){for(var o=[],s=[],a=i[r].contourCounts,l=i[r].points,c=0,u=[],h=0;h<a.length;h++){for(var d=0;d<a[h];d++)o.push(c),c++;s.push(o),o=[]}for(let e=0;e<l.length;e+=2){var f={x:l[e],y:l[e+1]};u.push(f)}Dy.#Mt(e.x,e.y,s,u)&&n.push(r)}return n}getClip(e){for(var t=this.getData().clips,i=[],n=[],r=t[e].contourCounts,o=t[e].points,s=0,a=[],l=0;l<r.length;l++){for(var c=0;c<r[l];c++)i.push(s),s++;n.push(i),i=[]}for(let e=0;e<o.length;e+=2){var u={x:o[e],y:o[e+1]};a.push(u)}return{contours:n,points:a}}getTopoIndex(e){var t=this.getData();if(t&&t.fragments){var i=t.fragments.topoIndexes;if(i)return i[e]}}getTopology(e){return this.topology?this.topology[e]:null}hasTopology(){return!!this.topology}fetchTopology(e){if(this.topology)return Promise.resolve(this.topology);var t=this.getData();if(!t.topologyPath)return Promise.reject({error:"no-topology"});var i=e||(F()?20:100);if(t.topologySizeMB>i)return Promise.reject({error:"topology-too-big",limitMB:i,topologyMB:t.topologySizeMB});if(!this.topologyPromise){var n=this;this.topologyPromise=new Promise((function(e,t){n.loader.fetchTopologyFile(n.getData().topologyPath,(function(i){i&&i.topology?(n.topology=i.topology,e(i.topology)):t(i)}))}))}return this.topologyPromise}hasGeometry(){var e=this.getData();return!!e&&(!!e.isLeaflet||(!!e.isSceneBuilder||e.fragments.length>0))}getFragmentPointer(e){return e?new Al(this.getFragmentList(),e):null}clone(){const e=new Dy(this.myData);return e.topology=this.topology,e.topologyPromise=this.topologyPromise,e.svfUUID=this.svfUUID,e.defaultCameraHash=this.defaultCameraHash,e.loader=this.loader,e.setInnerAttributes(this.getInnerAttributes()),e}getSeedUrn(){var e;return(null===(e=this.loader)||void 0===e?void 0:e.svfUrn)||""}isNodeExists(e){let t;const i=this.getInstanceTree();if(i)i.enumNodeChildren(e,(function(e){i.enumNodeFragments(e,(function(){t=!0}))}),!0);else{var n;null!==(n=this.getFragmentList().fragments.dbId2fragId)&&void 0!==n&&n[e]&&(t=!0)}return!!t}getModelKey(){const e=this.getDocumentNode();return e?e.getModelKey():this.getData().urn}dtor(){super.dtor(),this.#Et()}#Et(){const e=this.getInstanceTree();null==e||e.dtor(),this.myData=null,this.topology=null,this.topologyPromise=null}setFragmentBoundingBoxes(e,t){const i=this.getFragmentList().fragments.boxes,n=e.length/t;for(let r=0,o=0,s=0;r<n;r++,o+=t,s+=6)i[s+0]=e[o+0],i[s+1]=e[o+1],i[s+2]=e[o+2],i[s+3]=e[o+3],i[s+4]=e[o+4],i[s+5]=e[o+5];this.boxesLoadingDone()}boxesLoadingDone(){const e=this.getFragmentList().fragments;e.dontComputeBoxes=!0,e.boxesLoaded=!0,this.invalidateBBoxes(),this.fireEvent({type:Autodesk.Viewing.MODEL_FRAGMENT_BOUNDING_BOXES_SET_EVENT,model:this})}}var Oy=c(),By=Oy;const Ny=Object.freeze({Raster:"Raster",Vector:"Vector"});function Uy(e,t,i){this.myPath=t,this.myData=e,e&&(this.docRoot=new Oa(e),this.docRoot.setDocument(this)),this.myNumViews={},this.acmSessionId=i;var n=this;this.docRoot.traverse((function(e){if(e.isViewPreset()){const t=e.findParentGeom2Dor3D();if(t){let e=n.myNumViews[t.guid()]||0;n.myNumViews[t.guid()]=e+1}}}))}Uy.load=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const o=Uy.getDocumentPath(e);let s,a;function l(t){let i=e.split(":");i=i[1];const n=ve(i);for(let e=0;e<t.length;e++)if(n.indexOf(t[e])>-1)return!0;return!1}if(e.startsWith("urn")&&l(["urn:adsk.wipprodanz","urn:adsk.wipstganz"])||ke.getApiFlavor().match(/AUS/i)||ke.getApiFlavor().match(/APAC/i)){let e=ke.getApiFlavor();if(e.match(/AUS/i)||e.match(/APAC/i)||(e+="_AUS"),l(["wipstganz"]))ke.setEndpointAndApi(pa.stg,e);else if(l(["wipprodanz"]))ke.setEndpointAndApi(pa.prod,e);else{const t=Pe();null!==t.match(/prod/i)?ke.setEndpointAndApi(pa.prod,e):null!==t.match(/stag/i)&&ke.setEndpointAndApi(pa.stg,e)}}if(e.startsWith("urn")&&l(["urn:adsk.wipemea","urn:adsk.wipbimemea"])){var c=ke.getApiFlavor(),u=Pe(),h=c===ke.ENDPOINT_API_DERIVATIVE_SERVICE_V2&&!u.endsWith("EU"),d=u.endsWith("US")&&c===ke.ENDPOINT_API_D3S,f=c===ke.ENDPOINT_API_DERIVATIVE_STREAMING&&!c.endsWith("_EU");if(c+="_EU",h)ke.setEndpointAndApi(null,c);else if(d){Le(u=u.replace("US","EU"));var p=ya[u];ke.setEndpointAndApi(p.ROOT,c)}else f&&ke.setEndpointAndApi(null,c)}function m(e){(ke.isSVF2Backend()||ke.isOtgBackend())&&(s=s?e.urn+","+s:e.urn);const n=new Uy(e,o,s);a=n.getGlobalMessages();if(n.docRoot.findAllViewables().length>0)t&&t(n,a);else{const e=st.BAD_DATA_NO_VIEWABLE_CONTENT;i&&i(e,"No viewable content",a)}}function g(e,t,n){if(401===e&&void 0===Oy.LMV_THIRD_PARTY_COOKIE)Oy.LMV_THIRD_PARTY_COOKIE=!1,Aa(zs.accessToken),v();else if(i){var r="Error: "+e+" ("+t+")",o=lt(e);i(o,r,e,t,n)}}function v(){const e=!n||(ke.isSVF2Backend()||ke.isOtgBackend())&&!n["x-ads-acm-scopes"];if(!s&&!e)return n.oauth2AccessToken||(n.oauth2AccessToken=zs.accessToken),void ei.getACMSession(ke.getApiEndpoint(),n,(function(e){s=e,r.queryParams=s?"acmsession="+s:"",ke.setAcmSession(s),ei.getManifest(ke.initLoadContext(r),o,m,g)}),i);const t=ke.initLoadContext(r);ei.getManifest(t,o,m,g)}v()},Uy.getDocumentPath=function(e){if(-1===e.indexOf("urn:")){if(-1!==e.indexOf("://"))return e;var t=e;return"undefined"!=typeof window?(0!==t.indexOf("/")&&(t="/"+t),By.location.protocol+"//"+By.location.host+t):t}return e},Uy.requestThumbnailWithSecurity=function(e,t){var i={responseType:"blob",skipAssetCallback:!0,size:e.width,guid:e.guid,acmsession:e.acmsession},n="urn:"+e.urn,r=void 0;if(!c().USE_OTG_DS_PROXY){var o=Pe();r=ya[o].UPSTREAM;const e=ba(o,ke.getApiFlavor());i.apiData=e}ei.getThumbnail(ke.initLoadContext({endpoint:r}),n,(function(e){t(null,e)}),(function(){t("error",null)}),i)},Uy.prototype.getAcmSessionId=function(e){return this.acmSessionId?Uy.getAcmSessionId(e,this.acmSessionId):""},Uy.getAcmSessionId=function(e,t){if(!e)return"";let i=e.indexOf("urn:adsk.fluent")>=0;return c().USE_OTG_DS_PROXY||i||!ke.isSVF2Backend()&&!ke.isOtgBackend()?t:t.split(",")[1]||""},Uy.prototype.getPdfRenderingMode=function(){return this._pdfRenderingMode||Ny.Vector},Uy.prototype.setPdfRenderingMode=function(e){this._pdfRenderingMode=e},Uy.prototype.getFullPath=function(e){if(!e)return e;var t=e;if(De())-1==t.indexOf(Ue())&&(t=decodeURIComponent(Ue())+t.substr(t.indexOf("/")));else if(0===e.indexOf("urn")){if(0===e.indexOf("urn:adsk.fluent")||!ke.isSVF2Backend()&&!ke.isOtgBackend())t=ke.getItemApi(null,e),ke.ENDPOINT_API_MODEL_DERIVATIVE_V2===ke.getApiFlavor()&&(t=decodeURIComponent(t));else{const i=Pe(),n=ya[i],r=c().USE_OTG_DS_PROXY?null:n.UPSTREAM,o=ba(i,ke.getApiFlavor());t=ke.getItemApi(r,e,o)}}else 0===e.indexOf("$file$")&&(t=this.myPath.replace("/bubble.json",e.replace("$file$","")));return t},Uy.prototype.getThumbnailOptions=function(e,t,i){var n=t||200,r=i||200,o=e.urn||this.myData.urn;return{urn:o,width:n,height:r,guid:e.guid,acmsession:this.getAcmSessionId(o)}},Uy.prototype.getThumbnailPath=function(e,t,i){var n=this.getThumbnailOptions(e,t,i),r=ke.getThumbnailApi(null,n.urn)+"?width="+n.width+"&height="+n.height;n.guid&&(r+="&guid="+n.guid),n.acmsession&&(r+="&acmsession="+n.acmsession);var o=ke.getQueryParams();return o&&(r+="&"+o),r},Uy.prototype.getLeafletZipParams=function(e,t){for(var i,n,r=t.search({role:"leaflet-zip"},!1),o=0;o<r.length;o++){n={};var s=(i=r[o]._raw()).urn;n.urnZip=this.getFullPath(s),n.centralDirOffset=i.central_dir_offset,n.centralDirLength=i.central_dir_length,n.centralDirEntries=i.central_dir_entries,n.zipMaxLevel=i.max_level-e.levelOffset,n.loadFromZip=!!(n.urnZip&&n.centralDirOffset&&n.centralDirLength&&n.centralDirEntries),n.fileTable={},e.zips||(e.zips=[]),e.zips.push(n)}e.zips.sort((function(e,t){return e.zipMaxLevel-t.zipMaxLevel}))},Uy.prototype.getLeafletParams=function(e,t,i){e.tileSize=i.tileSize?i.tileSize:512,e.texWidth=i.resolution[0],e.texHeight=i.resolution[1],e.paperWidth=i.paperWidth,e.paperHeight=i.paperHeight,e.paperUnits=i.paperUnits,e.urlPattern=i.urn,e.mime=i.mime,e.isLeaflet=!0,e.levelOffset=function(e){for(var t=1,i=0,n=0;n<20;n++){if((t*=2)>e)return i;i++}return rt.log("unexpected leaflet tileSize"),0}(e.tileSize),this.getLeafletZipParams(e,t),e.loadFromZip=e.zips&&e.zips[0].loadFromZip,e.zips&&De()&&F()&&(e.zips=e.zips.slice(0,1),e.maxLevel=e.zips[0].zipMaxLevel)},Uy.prototype.derivePdfUrnHack=function(e,t){var i=e.parent.children.slice();i.sort(((e,t)=>e._raw().order-t._raw().order));let n;n=i.length<=75?i[i.length-1]:i[74];let r=n.search(Oa.GEOMETRY_F2D_NODE)[0];if(r){var o=r.urn().indexOf("/"),s=r.urn().slice(0,o),a=e._raw().order,l=0|a%75,c=1+(0|a/75),u=s+`/output/${l}/${l}.pdf`;return t.page=c,t.isPdf=!0,console.log("pdf path",u),u}return null},Uy.prototype.getViewableUrn=function(e,t){let i;if(e instanceof Oa)i=e;else{let t=this.docRoot.search(e);i=t.length>0?t[0]:new Oa(e)}const n=()=>{const e=i.search(Oa.GEOMETRY_F2D_NODE);if(e.length)return e[0].urn()},r=()=>{if(i.isRevitPdf()){const e=n();if(e)return e}var e=!0;try{const t=JSON.parse(localStorage.getItem("Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.AEC"));t&&(e=t[Autodesk.Viewing.Private.Prefs2D.VECTOR_VIEWING]??!0)}catch(e){console.warn("error reading PDF setting from localStorage",e)}var r="true"===fe("vectorPdf")||c().LMV_VECTOR_PDF||this.myData&&this.myData.isVectorPDF||!!i.data.isVectorPDF,o="false"===fe("vectorPdf")||c().LMV_RASTER_PDF;r?e=!0:o&&(e=!1);var s=i.search(Oa.PDF_PAGE_NODE),a=i.search(Oa.LEAFLET_NODE);if(e&&a.length>0&&t&&(this.getLeafletParams(t,i,a[0]._raw()),t.tempRasterPath=a[0].urn()),e&&s.length)return t&&(t.isPdf=!0,t.page=s[0].data.page||1),this.setPdfRenderingMode(Ny.Vector),s[0].urn();if(a.length>0&&t){if(r){var l=this.derivePdfUrnHack(i,t);if(l)return this.setPdfRenderingMode(Ny.Vector),l}return this.getLeafletParams(t,i,a[0]._raw()),this.setPdfRenderingMode(Ny.Raster),a[0].urn()}};if(i.isGeometry()){if(i.is3D())return i.getViewableRootPath();if(i.is2D()){const e=r()||(()=>{const e=i.search(Oa.IMAGE_NODE);if(e.length)return e[0].urn()})()||n();if(e)return e}}else if(i.isViewPreset()){var o=this.getViewGeometry(i,!0);if(o)return this.getViewableUrn(o,t)}return i.is3DTilesFormat()?this.myPath:""},Uy.prototype.getViewablePath=function(e,t){var i=this.getViewableUrn(e,t);return i?this.getFullPath(i):""},Uy.prototype.downloadAecModelData=function(e){const t=e?t=>{try{e(t)}catch(e){console.error("Document.downloadAecModelData() onFinished handler crashed",e)}return t}:e=>e;if(this.downloadAecModelDataPromise)return this.downloadAecModelDataPromise.then(t),this.downloadAecModelDataPromise;var i=this.docRoot.findViewableParent(),n=i&&i.data.aec_model_data;if(n)return t(n),Promise.resolve(n);var r=this.docRoot.search({role:"Autodesk.AEC.ModelData"})[0];if(!r)return t(),Promise.resolve(null);let o=r.getViewableRootPath();const s=this.getFullPath(o),a={headers:{}},l=this.getAcmSessionId(s);return-1!==s.indexOf(".api.autodesk.com")&&zs.accessToken&&(a.headers.Authorization="Bearer "+zs.accessToken),l&&(a.queryParams="acmsession="+l),this.downloadAecModelDataPromise=new Promise((e=>{var t=t=>{r.findViewableParent().data.aec_model_data=t,e(t)};ei.getItem(ke.initLoadContext(a),s,(e=>t(e)),(()=>t()),{responseType:"json"})})).then((e=>(delete this.downloadAecModelDataPromise,e))).then(t),this.downloadAecModelDataPromise},Uy.getAecModelData=function(e){if(Array.isArray(e)){let t=new Map,i=e.map((e=>{let i=e.getDocument(),n=t.get(i);if(n)return n;{let e=i.downloadAecModelData();return t[i]=e,e}}));return Promise.all(i)}return e.getDocument().downloadAecModelData()},Uy.prototype.getRoot=function(){return this.docRoot},Uy.prototype.getPath=function(){return this.myPath},Uy.prototype.getViewGeometry=function(e){return e.findParentGeom2Dor3D()},Uy.prototype.getNumViews=function(e){var t=e.guid;return e instanceof Oa&&(t=e.guid()),this.myNumViews[t]||0},Uy.prototype.getMessages=function(e,t){var i=[];if(!e)return i;for(var n=e;n&&(!t||n.parent);)n._raw().messages&&(i=i.concat(n._raw().messages)),n=n.parent;return i},Uy.prototype.getGlobalMessages=function(){var e=[],t=0,i=0;this.getRoot().traverse((function(n){var r=n._raw().messages||[];r.filter((function(e){return"error"===e.type})).length>0&&(t+=1),"inprogress"===n._raw().status&&(i+=1),e=e.concat(r)}));var n="translated";n=t>0?"failed":n,n=i>0?"processing":n;for(var r=e.length;r--;e[r].$translation=n);return e};class ky{constructor(){this.registered={};const e=Autodesk.Viewing.ProfileSettings;this.PROFILE_DEFAULT=new Os(e.Default),this.registerProfile("default",this.PROFILE_DEFAULT),this.PROFILE_AEC=new Os(e.AEC),this.registerProfile("rvt",this.PROFILE_AEC),this.registerProfile("ifc",this.PROFILE_AEC),this.PROFILE_NAVIS=new Os(e.Navis),this.registerProfile("nwc",this.PROFILE_NAVIS),this.registerProfile("nwd",this.PROFILE_NAVIS),this.PROFILE_FLUENT=new Os(e.Fluent),this.registerProfile("fluent",this.PROFILE_FLUENT)}registerProfile(e,t){t?(e=e||"default",this.registered[e]=t instanceof Os?t:new Os(t)):rt.log("ProfileManager: missing profileSettings when registering a profile.")}unregisterProfile(e){e?delete this.registered[e]:rt.log("ProfileManager: missing fileExt when unregistering a profile.")}getProfiles(){return Object.assign({},this.registered)}getProfileOrDefault(e){if(!e)return rt.log("ProfileManager: missing fileExt for getProfile. Returning the default Profile."),this.registered.default;const t=this.registered[e];return t||(rt.log(`ProfileManager: No profile registered for ${e}. Returning the default Profile.`),this.registered.default)}}const Fy=function(e,t){return e-t};function Vy(){var e=[],t=[],i=[],n=[],r=["hotkeys"];this.getNames=function(){return r},this.getName=function(){return r[0]},this.pushHotkeys=function(t,i,n){if(e.some((function(e){return e.id===t})))return!1;for(var r=0;r<i.length;r++)e.push({id:t,keys:i[r].keycodes.sort(Fy).join(),onPress:i[r].onPress,onRelease:i[r].onRelease,options:n||{}});return!0},this.popHotkeys=function(t){for(var i=!1,n=e.length-1;n>=0;n--)e[n].id===t&&(e.splice(n,1),i=!0);return i};const o=function(){var e,r=t.join();for(e=0;e<n.length;)n[e].keys===r?n.splice(e,1):e++;for(e=0;e<i.length;)i[e].keys!==r?i.splice(e,1):e++};this.handleKeyDown=function(r,s){if(-1===t.indexOf(s)){for(var a=t.join(),l=t.slice(0),c=0;c<t.length&&t[c]<s;)c++;t.splice(c,0,s);var u=t.join(),h=t.slice(0);o();var d,f=[],p=[];for(c=e.length-1;c>=0;c--)(d=e[c]).keys===a&&d.onRelease?f.unshift(d):d.keys===u&&d.onPress&&p.unshift(d);for(c=f.length-1;c>=0&&!(d=f[c]).onRelease(l);c--)d.options.tryUntilSuccess&&n.unshift(d);for(c=p.length-1;c>=0&&!(d=p[c]).onPress(h);c--)d.options.tryUntilSuccess&&i.unshift(d)}},this.handleKeyUp=function(r,s){var a=t.join(),l=t.slice(0),c=t.indexOf(s);c>-1&&t.splice(c,1);var u=t.join(),h=t.slice(0);o();var d,f=[],p=[];for(c=e.length-1;c>=0;c--)(d=e[c]).keys===a&&d.onRelease?f.unshift(d):d.keys===u&&d.onPress&&p.unshift(d);for(c=f.length-1;c>=0&&!(d=f[c]).onRelease(l);c--)d.options.tryUntilSuccess&&n.unshift(d);for(c=p.length-1;c>=0&&!(d=p[c]).onPress(h);c--)d.options.tryUntilSuccess&&i.unshift(d)},this.update=function(){var e,t;for(t=0;t<n.length;)!0===(e=n[t]).onRelease(e.keys.split())?n.splice(t,1):t++;for(t=0;t<i.length;)!0===(e=i[t]).onPress(e.keys.split())?i.splice(t,1):t++;return!1},this.handleBlur=function(){for(var e=t.length-1;e>=0;e--)this.handleKeyUp(null,t[e])},this.activate=function(){},this.deactivate=function(){}}const Gy={TRANSITION_ACTIVE_FLAG_CHANGED:"transitionActiveFlagChanged"};function zy(e){var t=6.88,i=1e-6;this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.FIT_TO_VIEW_VERTICAL_MARGIN=.05,this.FIT_TO_VIEW_VERTICAL_OFFSET=0,this.FIT_TO_VIEW_HORIZONTAL_MARGIN=.05,this.FIT_TO_VIEW_HORIZONTAL_OFFSET=0,this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=i,this.__minDistance=1e-5;var n=void 0,r=void 0,o=2,s=200,a=null,l={left:0,top:0,width:1,height:1},c=Number.MAX_VALUE;this.uninitialize=function(){this.setCamera(null)},this.setMinimumLineWidth=function(e){c=e||Number.MAX_VALUE},this.setCamera=function(e){e!==a&&(a=e,e&&(Object.prototype.hasOwnProperty.call(e,"target")||(e.target=new(v().Vector3)(0,0,0)),Object.prototype.hasOwnProperty.call(e,"pivot")||(e.pivot=new(v().Vector3)(0,0,0)),e.worldup=e.up.clone(),e.dirty=!0))},this.getCamera=function(){return a},this.setScreenViewport=function(e){l=e},this.getScreenViewport=function(){return l},this.__setUp=function(e){if(e&&a&&0!==e.clone().normalize().sub(a.worldup).lengthSq())return a.worldup.copy(e).normalize(),a.dirty=!0,!0;return!1},this.__getUp=function(){return a?a.worldup:new(v().Vector3)(0,1,0)},this.setView=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!a)return;e&&t&&(a.position.copy(e),a.target.copy(t),null!=i&&a.up.copy(i),a.dirty=!0)},this.orientCameraUp=function(e){a&&(this.isActionEnabled("roll")||e)&&(a.up.copy(this.getAlignedUpVector()),a.dirty=!0)},this.getPivotPoint=function(){return a?a.pivot.clone():new(v().Vector3)(0,0,0)},this.setPivotPoint=function(e){a&&e&&a.pivot.copy(e)},this.getPosition=function(){return a?a.position.clone():new(v().Vector3)(0,0,1)},this.setPosition=function(e){a&&e&&(a.position.copy(e),a.dirty=!0)},this.setTarget=function(e){a&&e&&(a.target.copy(e),a.dirty=!0)},this.getTarget=function(){return a?a.target.clone():new(v().Vector3)(0,0,0)},this.getEyeVector=function(){return a?a.target.clone().sub(a.position):new(v().Vector3)(0,0,-1)},this.getEyeToCenterOfBoundsVec=function(e){return a?e.getCenter(new(v().Vector3)).sub(a.position):new(v().Vector3)(0,0,-1)},this.getFovMin=function(){return t},this.getFovMax=function(){return 100},this.setZoomInLimitFactor=function(e){s=e},this.getZoomInLimitFactor=function(){return s},this.setZoomOutLimitFactor=function(e){o=e},this.getZoomOutLimitFactor=function(){return o},this.isPointVisible=function(e){return(new(v().Frustum)).setFromProjectionMatrix(a.projectionMatrix.clone().multiply(a.matrixWorldInverse)).containsPoint(e)},this.setVerticalFov=function(e,n){if((!a||a.isPerspective)&&(e<t?e=t:e>100&&(e=100),a&&this.isActionEnabled("fov"))){if(Math.abs(a.fov-e)<=i)return;if(n){var r=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),o=this.getPosition(),s=this.getEyeVector(),l=v().Math.degToRad(a.fov),c=v().Math.degToRad(e),u=r?this.getPivotPlaneDistance():s.length(),h=u*Math.tan(.5*l)/Math.tan(.5*c),d=s.normalize().multiplyScalar(u-h);this.setPosition(o.add(d)),r&&this.setTarget(this.getTarget().add(d))}a.setFov(e),a.dirty=!0}},this.applyRotation=(e,t,i,n)=>{e.sub(i),e.applyAxisAngle(n,t),e.add(i)},this.getSignedAngle=(e,t,i)=>{var n=e.angleTo(t),r=e.clone().cross(t).normalize();return n*(i.dot(r)>0?1:-1)},this.computeFit=function(t,i,n,r,o){if(!r||r.isEmpty())return{position:t,target:i,pivot:i};o=void 0===o?1:o;var s=r.getCenter(new(v().Vector3)),a=r.getSize(new(v().Vector3)),l=t.clone().sub(i).normalize(),c=Math.tan(v().Math.degToRad(.5*n)),u=0,h=this.computeOrthogonalUp(t,i),d=l.clone().cross(h).normalize();let f=0;for(var p=new(v().Vector3),m=0===a.z?4:8,g=0;g<m;g++){p.set(1&g?.5*a.x:-.5*a.x,2&g?.5*a.y:-.5*a.y,4&g?.5*a.z:-.5*a.z);var y=0;e.isPerspective&&f<(y=p.dot(l))&&(f=y);var b=Math.abs(p.dot(h)),x=Math.abs(p.dot(d)),_=y+(1+2*this.FIT_TO_VIEW_VERTICAL_MARGIN/(1-2*this.FIT_TO_VIEW_VERTICAL_MARGIN))*b/c;u<_&&(u=_),u<(_=y+(1+2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN/(1-2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN))*x/(o*c))&&(u=_)}s.add(h.multiplyScalar(-u*this.FIT_TO_VIEW_VERTICAL_OFFSET)),s.add(d.multiplyScalar(u*this.FIT_TO_VIEW_HORIZONTAL_OFFSET));let E=s;if(e.isPerspective){const e=l.clone().multiplyScalar(f);E=E.clone().add(e)}return l.multiplyScalar(u),{position:s.clone().add(l),target:E,pivot:s}},this.computeOrthogonalUp=function(e,t){var i=this.__getUp(),n=t.clone().sub(e);if(0===n.lengthSq())return n.copy(i);var r=n.clone().cross(i);return 0===r.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z-=1e-4,r.crossVectors(n,i)),r.cross(n).normalize()},this.fitBounds=function(e,t,i,n){const r=this.getTarget(),o=this.getPosition();if(!this.isActionEnabled("gotoview")&&!n||!t||t.isEmpty())return{position:o,target:r};const s=this.getVerticalFov();i||(t=this.rotateBoundsToCamera(t,o,r));const l=this.computeFit(o,r,s,t,a.aspect),c=i?this.computeOrthogonalUp(o,r):a.up;return e?(a.up.copy(c),this.setView(l.position,l.target)):this.setRequestTransitionWithUp(!0,l.position,l.target,s,c,void 0,l.pivot),this.setPivotPoint(l.pivot),this.setPivotSetFlag(!0),l},this.rotateBoundsToCamera=function(e,t,i){const n=(e=e.clone()).getCenter(new(v().Vector3)),r=t.clone().sub(i).normalize(),o=this.getSignedAngle(this.getCameraUpVector(),this.getAlignedUpVector(),r);return this.applyRotation(e.min,o,n,r),this.applyRotation(e.max,o,n,r),e.setFromPoints([e.min.clone(),e.max.clone()]),e},this.computeOverviewDistance=function(e){var t=e.getSize(new(v().Vector3));if(this.__is2D){var i=a.aspect,n=t.x/i,r=t.y;return Math.max(n,r)}var o=this.getVerticalFov(),s=t.length();return 0===s&&(s=2),a.isPerspective?.5*s/Math.tan(v().Math.degToRad(.5*o)):s},this.applyDollyConstraint=function(e,t){if(!(n||r||o)||!this.__is2D)return e;var i=e;if(n&&o&&t&&e>1){var l,u=a.isPerspective?this.getEyeToCenterOfBoundsVec(t):this.getEyeVector();l=n?o*this.computeOverviewDistance(n):o*this.computeOverviewDistance(t);var h=Math.abs(l/u.length());h=Math.max(h,1),i=Math.min(i,h)}if(r||s&&t){var d=(r?a.clientHeight/r:Math.min(c,this.computeOverviewDistance(t)/s))/-this.getEyeVector().z;d=Math.min(d,1),i=Math.max(i,d)}return i},this.applyPanningConstraint2D=function(e){if(this.__is2D&&n){var t=a.position.x+e.x,i=a.position.y+e.y;t=v().Math.clamp(t,n.min.x,n.max.x),i=v().Math.clamp(i,n.min.y,n.max.y);var r=t-a.position.x,o=i-a.position.y,s=Math.min(e.x,0),l=Math.min(e.y,0),c=Math.max(e.x,0),u=Math.max(e.y,0);r=v().Math.clamp(r,s,c),o=v().Math.clamp(o,l,u),e.x=r,e.y=o}},this.updateCamera=function(){a&&(a.updateProjectionMatrix(),this.orient(a,a.target,a.position,a.up),a.dirty=!1)},this.setCamera(e),this.setConstraints2D=function(e,t){n=e,r=t},this.getConstrains2D=function(){return{maxViewRegion:n,maxPixelPerUnit:r}}}zy.prototype.constructor=zy,zy.prototype.setIs2D=function(e){this.__is2D=!!e},zy.prototype.getIs2D=function(){return this.__is2D},zy.prototype.setIsTouchDevice=function(e){this.__isTouchDevice=!!e},zy.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},zy.prototype.orient=function(){var e,t,i,n;return function(r,o,s,a){e||(e=new(v().Matrix4),t=new(v().Vector3),i=new(v().Vector3),n=new(v().Vector3));var l=e.elements;n.subVectors(s,o).normalize(),0===n.lengthSq()&&(n.z=1),t.crossVectors(a,n).normalize(),0===t.lengthSq()&&(a.z>a.y?n.y-=1e-4:n.z+=1e-4,t.crossVectors(a,n).normalize()),i.crossVectors(n,t),l[0]=t.x,l[4]=i.x,l[8]=n.x,l[1]=t.y,l[5]=i.y,l[9]=n.y,l[2]=t.z,l[6]=i.z,l[10]=n.z,r.setRotationFromMatrix(e)}}(),zy.prototype.fov2fl=function(e){var t=v().Math.degToRad(e);return t<=0&&(t=1e-4),Math.round(12/Math.tan(.5*t))},zy.prototype.fl2fov=function(e){e<=0&&(e=1e-4);var t=2*Math.atan(12/e);return v().Math.radToDeg(t)},zy.prototype.setCameraUpVector=function(e,t){if(this.isActionEnabled("roll")||t){var i=this.getCamera();i.up.copy(e),i.dirty=!0}},zy.prototype.getCameraUpVector=function(){var e=this.getCameraRightVector(!1),t=this.getEyeVector();return e.cross(t).normalize()},zy.prototype.getAlignedUpVector=function(){var e=this.getCameraRightVector(!0),t=this.getEyeVector();return e.cross(t).normalize()},zy.prototype.getCameraRightVector=function(e){var t=new(v().Vector3),i=e?this.getWorldUpVector():this.getCamera().up,n=this.getEyeVector();return t.crossVectors(n,i),0===t.lengthSq()&&(Math.abs(n.z)>=Math.abs(n.y)?i.set(0,1,0):i.set(0,0,1),t.crossVectors(n,i)),t.normalize()},zy.prototype.setWorldUpVector=function(e,t,i){(this.isActionEnabled("roll")||i)&&(this.__setUp(e),t&&this.orientCameraUp(i))},zy.prototype.getWorldUpVector=function(){return this.__getUp().clone()},zy.prototype.getWorldRightVector=function(){var e=new(v().Vector3);return e.copy(this.__getUp()),Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},zy.prototype.getVerticalFov=function(){return this.getCamera().fov},zy.prototype.getHorizontalFov=function(){var e=this.getScreenViewport();return this.getCamera().fov*(e.width/e.height)},zy.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},zy.prototype.setFocalLength=function(e,t){this.setVerticalFov(this.fl2fov(e),t)},zy.prototype.setReverseZoomDirection=function(e){this.__options.reverseDolly=!!e},zy.prototype.setReverseHorizontalLookDirection=function(e){this.getIs2D()?rt.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"):this.__options.reverseHorizontalLookDirection=!!e},zy.prototype.setReverseVerticalLookDirection=function(e){this.getIs2D()?rt.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"):this.__options.reverseVerticalLookDirection=!!e},zy.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},zy.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(rt.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},zy.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(rt.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},zy.prototype.setZoomTowardsPivot=function(e){this.__options.dollyToPivot=!!e},zy.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},zy.prototype.setOrbitPastWorldPoles=function(e){this.getIs2D()?rt.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"):this.__options.orbitPastPoles=!!e},zy.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(rt.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},zy.prototype.setUsePivotAlways=function(e){this.__options.usePivotAlways=!!e},zy.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},zy.prototype.setUseLeftHandedInput=function(e){this.__options.useLeftHandedInput=!!e},zy.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},zy.prototype.setWheelSetsPivot=function(e){this.__options.wheelSetsPivot=!!e},zy.prototype.getWheelSetsPivot=function(){return this.__options.wheelSetsPivot},zy.prototype.setSelectionSetsPivot=function(e){this.__options.SelectionSetsPivot=!!e},zy.prototype.getSelectionSetsPivot=function(){return this.__options.SelectionSetsPivot},zy.prototype.setIsLocked=function(e){this.__options.lockNavigation=!!e},zy.prototype.getIsLocked=function(){return this.__options.lockNavigation},zy.prototype.setLockSettings=function(e){for(var t in this.__lockSettings)Object.prototype.hasOwnProperty.call(e,t)&&(this.__lockSettings[t]=e[t])},zy.prototype.getLockSettings=function(){var e={};for(var t in this.__lockSettings)e[t]=this.__lockSettings[t];return e},zy.prototype.isActionEnabled=function(e){return!this.__options.lockNavigation||!0===this.__lockSettings[e]},zy.prototype.setPivotSetFlag=function(e){this.__pivotIsSetFlag=!!e},zy.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},zy.prototype.setRequestFitToView=function(e){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!e)},zy.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},zy.prototype.setRequestHomeView=function(e){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!e)},zy.prototype.getRequestHomeView=function(){return this.__homeViewRequested},zy.prototype.setRequestTransition=function(e,t,i,n,r,o){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:n,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:r,pivot:o?o.clone():i.clone()}:null},zy.prototype.setRequestTransitionWithUp=function(e,t,i,n,r,o,s){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:n,up:r.clone(),worldUp:o||this.getWorldUpVector(),reorient:!1,pivot:s?s.clone():i.clone()}:null},zy.prototype.getRequestTransition=function(){return this.__destinationView},zy.prototype.setTransitionActive=function(e){const t=this.__transitionActive!=e;this.__transitionActive=!!e,t&&this.fireEvent({type:Gy.TRANSITION_ACTIVE_FLAG_CHANGED,transitionActive:!!e})},zy.prototype.getTransitionActive=function(){return this.__transitionActive},zy.prototype.getWorldSize=function(e){var t=this.getCamera(),i=t.aspect,n=2*e*Math.tan(v().Math.degToRad(.5*t.fov)),r=n*i;return new(v().Vector2)(r,n)},zy.prototype.screenToViewport=function(e,t){return e=2*e-1,t=2*(t=1-t)-1,new(v().Vector3)(e,t,1)},zy.prototype.viewportToScreen=function(e,t){return e=(e+1)/2,t=1-(t=(t+1)/2),new(v().Vector2)(e,t)},zy.prototype.getWorldPoint=function(e,t){var i=this.screenToViewport(e,t);e=i.x,t=i.y;var n,r=this.getCamera();r.isPerspective&&(n=(n=new(v().Vector3)(e,t,1)).unproject(r));var o,s,a=this.getEyeVector(),l=this.getPosition();if(!r.isPerspective||isNaN(n.x)){var c=this.getWorldSize(a.length()),u=this.getCameraRightVector(!1).multiplyScalar(.5*e*c.x),h=this.getCameraUpVector().multiplyScalar(.5*t*c.y);o=a.clone().add(u).add(h).normalize()}else o=n.sub(l).normalize();var d=this.getPivotPoint(),f=o.dot(a);return s=this.__pivotIsSetFlag&&(this.getIs2D()||r.isPerspective&&f>0)?0!==f?Math.abs(d.sub(l).dot(a))/f:d.sub(l).length():r.isPerspective?.5*(r.near+r.far):r.orthoScale,o.multiplyScalar(s).add(l)},zy.prototype.getPivotPlaneDistance=function(){var e=this.getPivotPoint(),t=this.getEyeVector(),i=this.getPosition();return e.sub(i).dot(t.normalize())},zy.prototype.panRelative=function(e,t,i){if(this.isActionEnabled("pan")){var n=this.getScreenViewport(),r=this.getCamera(),o=this.getWorldSize(i),s=e*o.x*n.width/r.clientWidth,a=t*o.y*n.height/r.clientHeight,l=this.getCameraRightVector(!1).multiplyScalar(s),c=this.getCameraUpVector().multiplyScalar(a),u=l.add(c);this.applyPanningConstraint2D(u),this.setView(this.getPosition().add(u),this.getTarget().add(u))}},zy.prototype.dollyFromPoint=function(e,t,i){if(this.isActionEnabled("zoom")&&!(Math.abs(e)<=this.__kEpsilon)){var n=this.getPosition(),r=this.getEyeVector();if(!this.getCamera().isPerspective){var o=r.lengthSq(),s=r.dot(this.getTarget().sub(t));t=r.clone().multiplyScalar(s/o).add(t)}var a=t.clone().sub(n),l=a.length(),c=l+e;c<this.__minDistance&&(c=this.__minDistance);var u=c/l;if(u=this.applyDollyConstraint(u,i),Math.abs(u-1)>this.__kEpsilon){a.multiplyScalar(u),a.set(-a.x,-a.y,-a.z);var h=a.add(t);r=this.getEyeVector(),this.getCamera().isPerspective||r.multiplyScalar(u),this.setView(h,r.add(h))}}},zy.prototype.toPerspective=function(){if(this.getIs2D())rt.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");else{var e=this.getCamera();e.isPerspective||(e.toPerspective(),e.dirty=!0)}},zy.prototype.toOrthographic=function(){var e=this.getCamera();e.isPerspective&&(e.toOrthographic(),e.dirty=!0)},zy.snapToAxis=function(e){var t=new(v().Vector3)(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));return t.x>t.y&&t.x>t.z?e.set(e.x>0?1:-1,0,0):t.y>t.x&&t.y>t.z?e.set(0,e.y>0?1:-1,0):e.set(0,0,e.z>0?1:-1),e},Ba.prototype.apply(zy.prototype),zy.Events=Gy;const Hy={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,PLUS:107,PLUSMOZ:171,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224};function Wy(e,t,i,n,r){this.setGlobalManager(t.globalManager),this.domElement=t.canvasWrap,this.selector=e.selector,this.autocam=i,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0,this.keyMapCmd=!0,this.propagateInputEventTypes=[];var o=-1!==navigator.userAgent.search("Mac OS"),s=-1!==navigator.userAgent.search("Firefox"),a=-1!==navigator.userAgent.search("Chrome"),l=-1!==navigator.userAgent.search("Safari")&&!a,c={},u={},h={},d=[],f=!1,p=-1,m=-1,g=!1,v=null,y=!1,b={},x=this;function _(e){return e.getPriority instanceof Function&&e.getPriority()||0}function E(e,i){return t.navigation.getUseLeftHandedInput()&&0===e||s&&1===e||o&&!l&&0===e&&i.ctrlKey}this.__registerToolByName=function(e,t){c[t]=e},this.registerTool=function(e,t){var i=e.getNames();if(!i||0===i.length)return rt.warn("Cannot register tool with no name."),!1;for(var r=!1,o=0;o<i.length;++o)if("default"!==i[o]){this.__registerToolByName(e,i[o]);const n=t=>{const i=e.getName();t?this.activateTool(i):this.deactivateTool(i)};h[i[o]]=t&&t instanceof Function?t:n,r=!0}return e.utilities=n,e.controller=this,e.register&&e.register(),r},this.deregisterTool=function(e){this.deactivateTool(e.getName());var t=e.getNames();if(!t||0===t.length)return!1;for(var i=t.length;--i>=0;)this.__deregisterToolName(t[i]);return e.deregister&&e.deregister(),e.utilities=null,e.controller=null,!0},this.__deregisterToolName=function(e){e in c&&(!function(e){for(var t=d.length;--t>=0;)d[t].activeName===e&&(c[e].deactivate(e),d.splice(t,1))}(e),delete c[e])},this.getTool=function(e){return c[e]},this.getActiveToolName=function(){var e=d.length;return e>0?d[e-1].activeName:"default"},this.getActiveTool=function(){var e=d.length;return e>0?d[e-1]:c.default},this.getActiveTools=function(){return d.slice()},this.isToolActivated=function(e){for(var t=0;t<d.length;t++)if(d[t].activeName===e)return!0;return!1},this.setToolActiveName=function(e){var t=c[e];t&&(t.activeName=e)},this.rearrangeByPriorities=function(){d.sort((function(e,t){return _(e)-_(t)}))},this.activateToolModality=function(e){const t=this.getToolModality(e);for(let e in t){const i=t[e],n=h[e];i!==this.isToolActivated(e)&&n&&n(i,e)}},this.activateTool=function(e){if(f)return!1;var i=c[e];if(this.activateToolModality(e),i){void 0===i.count&&(i.count=0);var n=null;d.length&&"intercept"===d[d.length-1].activeName&&(n=d.pop());for(var r=0,o=0;o<d.length;o++)d[o]===i&&i.count++,_(d[o])<=_(i)&&(r=o+1);return i.activeName=e,0===i.count&&(i.count++,d.splice(r,0,i)),i.activate(e,t),n&&d.push(n),t.dispatchEvent({type:Mr,toolName:e,tool:i,active:!0}),!0}return rt.warn("activateTool not found: "+e),!1},this.deactivateTool=function(e){if(f)return!1;for(var i=d.length;--i>=0;)if(d[i].activeName===e){const n=c[e];return(!n.count||n.count<=1)&&(1!=n.count&&console.warn("Deactivating tool without activation: "+e),d.splice(i,1)),n.count--,n.deactivate(e),t.dispatchEvent({type:Mr,toolName:e,tool:n,active:!1}),!0}return rt.warn("deactivateTool not found: "+e),!1},this.getToolNames=function(){return Object.keys(c)},this.setDefaultTool=function(e){var t=this.getDefaultTool();return!(!e||e===t)&&(this.__registerToolByName(e,"default"),t&&t.deactivate("default"),e.activate("default"),!0)},this.getDefaultTool=function(){return c.default},this.setDefaultTool(r),this.setIsLocked=function(e){var t=f;return f=!!e,t},this.getIsLocked=function(){return f},this.__checkCursor=function(){for(var e=null,i=d.length;--i>=0;){var n=d[i];if(n.getCursor&&(e=n.getCursor()))break}e||(e="auto"),v!=e&&(t.canvas.style.cursor=e,v=e)},this.update=function(e){this.__checkCursor();var i=!1;n&&n.update()&&(i=!0);for(var r=d.length;--r>=0;){var o=d[r];o.update&&o.update(e)&&(i=!0)}if(t.navigation.getCamera().dirty?(t.navigation.updateCamera(),i=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,i)t.navigation.updateCamera(),this.moveDelay=Date.now()+150;else if(0!==this.moveDelay){this.moveDelay-Date.now()>0?i=!0:this.moveDelay=0}return i},this.__clientToCanvasCoords=function(t,i,n){var r=e.getCanvasBoundingClientRect(),o=r.width,s=r.height,a=t.clientX-r.left,l=t.clientY-r.top;t.canvasX=a,t.canvasY=l,t.normalizedX=a/o*2-1,t.normalizedY=(s-l)/s*2-1,i&&i.set(a/o,l/s,0),n&&n.set(a,l)},this.__invokeStack=function(e,t,i){for(var n=d.length;--n>=0;){var r=d[n];if(r&&r[e]&&r[e](t,i))return!0}var o=this.getDefaultTool();return!(!o[e]||!o[e](t,i))},this.distributeEvent=function(e,t,i){return this.__invokeStack(e,t,i)},this.handleResize=function(){t.navigation.setScreenViewport(t.container.getBoundingClientRect());for(var e=d.length;--e>=0;){var i=d[e];i.handleResize&&i.handleResize()}},this.handleSingleClick=function(e){var t=this.applyButtonMappings(e);this.lastClickX=e.clientX,this.lastClickY=e.clientY,this.__invokeStack("handleSingleClick",e,t)&&this.__onEventHandled(e)},this.handleDoubleClick=function(e){var t=this.applyButtonMappings(e);this.__invokeStack("handleDoubleClick",e,t)&&this.__onEventHandled(e)},this.handleSingleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleSingleTap",e)&&this.__onEventHandled(e)},this.handleDoubleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleDoubleTap",e)&&this.__onEventHandled(e)},this.handleWheelInput=function(e,t){this.__invokeStack("handleWheelInput",e,t)&&this.__onEventHandled(t)},this.applyButtonMappings=function(e){var i=e.button;return"buttons"in e&&(e.firefoxSpoof?i=0:!g||1&e.buttons?2===i&&1&e.buttons&&(i=0,e.firefoxSpoof=g=!0):(e.firefoxSpoof=!0,g=!1,i=0)),t.navigation.getUseLeftHandedInput()&&(i=0===i?2:2===i?0:i),i},this.applyKeyMappings=function(e){switch(e.keyCode){case Hy.EQUALSMOZ:return Hy.EQUALS;case Hy.DASHMOZNEW:case Hy.DASHMOZ:return Hy.DASH}return e.keyCode},this.handleKeyDown=function(e){let t;!this.keyMapCmd||!o||"MetaLeft"!=e.code&&"MetaRight"!=e.code?(t=this.applyKeyMappings(e),t&&this.__invokeStack("handleKeyDown",e,t)&&this.__onEventHandled(e)):this.handleCmdKeyEvent(e,"keydown")},this.handleKeyUp=function(e){let t;!this.keyMapCmd||!o||"MetaLeft"!=e.code&&"MetaRight"!=e.code?(t=this.applyKeyMappings(e),t&&this.__invokeStack("handleKeyUp",e,t)&&this.__onEventHandled(e)):this.handleCmdKeyEvent(e,"keyup")},this.handleCmdKeyEvent=function(e,t){this.__onEventHandled(e);var i=new KeyboardEvent(t,{key:"Control",code:"MetaLeft"==e.code?"ControlLeft":"ControlRight",location:e.location,ctrlKey:!0,metaKey:!1,repeat:e.repeat,isComposing:e.isComposing,charCode:0,keyCode:17,which:17});window.dispatchEvent(i)},this.handleButtonDown=function(e,t){this.__invokeStack("handleButtonDown",e,t)&&this.__onEventHandled(e)},this.handleButtonUp=function(e,t){this.__invokeStack("handleButtonUp",e,t)&&this.__onEventHandled(e)},this.handleMouseMove=function(e){this.__invokeStack("handleMouseMove",e)&&this.__onEventHandled(e)},this.handleBlur=function(e){this.__invokeStack("handleBlur",e)&&this.__onEventHandled(e)},this.keydown=function(e){if(!Wy._lastTouchedElement||x.domElement.contains(Wy._lastTouchedElement)){var t=x.getDocument();if(!(t.activeElement instanceof HTMLInputElement||t.activeElement instanceof HTMLTextAreaElement||t.activeElement instanceof HTMLSelectElement)){if(t.activeElement){var i=t.activeElement.getAttribute("contenteditable");if("true"===i||""===i)return}x.handleKeyDown(e)}}},this.keyup=function(e){x.handleKeyUp(e)},this.mousedown=function(e){var t=x.getDocument();t.activeElement&&t.activeElement.blur&&t.activeElement.blur(),x.__clientToCanvasCoords(e);var i=x.applyButtonMappings(e);if(x.handleButtonDown(e,i),p=e.canvasX,m=e.canvasY,E(i,e)){var n=b,r=void 0!==n.time&&e.timeStamp-n.time<500,o=void 0!==n.x&&void 0!==n.y&&Math.abs(n.x-e.canvasX)<=2&&Math.abs(n.y-e.canvasY)<=2;(!r||!o||n.clickCount&&2<=n.clickCount)&&(n.clickCount=0),n.clickCount?1===n.clickCount&&(n.clickCount=2):(n.clickCount=1,n.x=e.canvasX,n.y=e.canvasY,n.time=e.timeStamp)}x.addDocumentEventListener("mouseup",(function e(t){x.applyButtonMappings(t)===i&&(x.removeDocumentEventListener("mouseup",e),x.mouseup(t))}),!1),x.registerWindowMouseMove()},this.mousemove=function(e){x.__clientToCanvasCoords(e);var t=p-e.canvasX,i=m-e.canvasY;(Math.abs(t)>2||Math.abs(i)>2)&&(p=-1,m=-1),x.handleMouseMove(e)},this.mouseup=function(e){x.__clientToCanvasCoords(e);var t=x.applyButtonMappings(e);x.handleButtonUp(e,t);var i=p-e.canvasX,n=m-e.canvasY;if(p=-1,m=-1,Math.abs(i)<=2&&Math.abs(n)<=2&&x.handleSingleClick(e),E(t,e)){var r=b;2===r.clickCount&&(x.handleDoubleClick(e),r.clickCount=0,r.x=void 0,r.y=void 0,r.time=void 0)}x.unregisterWindowMouseMove()},this.doubleclick=function(e){x.__clientToCanvasCoords(e),p=e.canvasX,m=e.canvasY,x.handleDoubleClick(e)},this.mousewheel=function(e){if(x.scrollInputEnabled){x.__clientToCanvasCoords(e);var t=0;if(e.wheelDelta)t=e.wheelDelta/40;else if(e.detail)t=-e.detail;else if(e.deltaY){var i=s?1:40;t=-e.deltaY/i}x.handleWheelInput(t,e)}},this.blur=function(e){x.handleBlur(e)},this.mouseover=function(e){Wy._lastTouchedElement=e.target},this.registerWindowMouseMove=function(){x.addWindowEventListener("mousemove",x.mousemove),x.addWindowEventListener("mouseover",x.mouseover),x.domElement.removeEventListener("mousemove",x.mousemove),x.domElement.removeEventListener("mouseover",x.mouseover)},this.unregisterWindowMouseMove=function(){x.removeWindowEventListener("mousemove",x.mousemove),x.removeWindowEventListener("mouseover",x.mouseover),x.domElement.addEventListener("mousemove",x.mousemove),x.domElement.addEventListener("mouseover",x.mouseover)},this.enableMouseButtons=function(e){e&&!y?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!e&&y&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var t=y;return y=e,t},this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),x.addWindowEventListener("keydown",this.keydown,!1),x.addWindowEventListener("keyup",this.keyup,!1),x.addWindowEventListener("blur",this.blur,!1),this.uninitialize=function(){for(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),this.removeWindowEventListener("mousemove",this.mousemove),this.removeWindowEventListener("mouseover",this.mouseover),this.removeWindowEventListener("keydown",this.keydown),this.removeWindowEventListener("keyup",this.keyup),this.removeWindowEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null,f=!1;d.length>0;)this.deactivateTool(d[d.length-1].activeName);c=null,d=null,x=null,n=null,t=null,e=null,Wy._lastTouchedElement=null},this.set2DMode=function(){},this.setAutocam=function(){},this.syncCamera=function(){},this.recordHomeView=function(){var e=t.navigation.getCamera();i.sync(e),i.setHomeViewFrom(e)},this.setMouseWheelInputEnabled=function(e){this.scrollInputEnabled=e},this.setModalityMap=function(e){u={};for(let t in e)this.setToolModality(t,e[t])},this.getModalityMap=function(){return Object.assign({},u)},this.getToolModality=function(e){return u[e]},this.setToolModality=function(e,t){e?t?u[e]=t:rt.warn("Cannot add tool modality. Missing tool map."):rt.warn("Cannot add tool modality. Missing tool name.")},this.__onEventHandled=function(e){this.propagateInputEventTypes.includes(e.type)||(e.preventDefault(),e.stopPropagation())}}function jy(e,t,i){this.autocam=t,this.viewerImpl=e,this.setGlobalManager(this.viewerImpl.globalManager);var n=i.getCamera(),r={},o={};var s=new function(e){var t=.6,i=0,n=new(v().SphereGeometry)(1),r=new(v().MeshPhongMaterial)({color:32512,opacity:t,transparent:!0}),o=new(v().Mesh)(n,r),s=e,a=1;s.createOverlayScene("pivot"),o.visible=!1,this.shown=function(){return o.visible},this.show=function(e,n,l){o.scale.x=n*a,o.scale.y=n*a,o.scale.z=n*a,o.position.set(e.x,e.y,e.z),r.opacity=t,o.visible=!0,s.addOverlay("pivot",o),s.invalidate(!1,!1,!0),i=l?Date.now()+500:0},this.hide=function(){o.visible&&(o.visible=!1,s.removeOverlay("pivot",o),s.invalidate(!1,!1,!0),i=0)},this.fade=function(){if(i>0){var e=i-Date.now();if(e<=0)return this.hide(),!0;var n=e/500*t;return r.opacity=n,!0}return!1},this.fading=function(){return i>0},this.setSize=function(e){a=e},this.setColor=function(e,i){r.color=new(v().Color)(e),void 0!==i&&(t=i,r.opacity=t)}}(this.viewerImpl);this.transitionView=function(e,r,o,s,a,l,c){a=a||i.getWorldUpVector();var u=l?function(e,t,i){var n=t.clone().sub(e);if(0===n.lengthSq())return n.copy(i);var r=n.clone().cross(i);return 0===r.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z-=1e-4,r.crossVectors(n,i)),r.cross(n).normalize()}(e,r,a):s;u||(u=n.up);var h={position:e,center:r,pivot:c=c||r,fov:o,up:u,worldUp:a,isOrtho:!1===n.isPerspective};t.goToView(h)},this.goHome=function(){this.viewerImpl.track({name:"navigation/home",aggregate:"count"}),t.goHome()},this.getHitPoint=function(e,t){var n=this.viewerImpl.hitTestViewport(i.screenToViewport(e,t),!1);return n?n.intersectPoint:null},this.activatePivot=function(e){if(this.viewerImpl.model&&!this.viewerImpl.model.is2d()){var t=n.isPerspective?i.getPivotPlaneDistance():i.getEyeVector().length(),r=i.getVerticalFov(),o=2*t*Math.tan(v().Math.degToRad(.5*r)),a=i.getScreenViewport(),l=this.getWindow().devicePixelRatio||1,c=5*o/(a.height*l);s.show(i.getPivotPoint(),c,e)}},this.pivotActive=function(e,t){t=t||!1,(e=e&&!i.getIs2D())||!s.shown()?e&&this.activatePivot(t):s.hide()},this.pivotUpdate=function(){s.shown()&&s.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(e,t,n){i.setPivotPoint(e),t||i.setTarget(e),n&&i.setPivotSetFlag(!0),this.setTemporaryPivot(null),i.getIs2D()||s.shown()&&this.activatePivot(s.fading())},this.savePivot=function(e){e||(e="default"),r[e]=i.getPivotPoint(),o[e]=i.getPivotSetFlag()},this.restorePivot=function(e){if(e||(e="default"),r[e]){var t=o[e];this.setPivotPoint(r[e],!0,t),t||i.setPivotSetFlag(!1),delete r[e],delete o[e]}},this.setTemporaryPivot=function(e){if(e){var t=i.getPivotPoint(),n=i.getPivotSetFlag();this.setPivotPoint(e,!0,n),r.TEMP=t,o.TEMP=n}else delete r.TEMP,delete o.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.setPivotSize=function(e){s.setSize(e)},this.setPivotColor=function(e,t){s.setColor(e,t)},this.getBoundingBox=function(e){return this.viewerImpl.getFitBounds(e)},this.fitToView=function(e){this.viewerImpl.track({name:"navigation/fit",aggregate:"count"}),this.viewerImpl.fitToView(this.viewerImpl.selector.getAggregateSelection(),e),this.activatePivot(!0)},this.update=function(){i.getRequestFitToView()&&!i.getTransitionActive()&&(i.setRequestFitToView(!1),this.fitToView()),i.getRequestHomeView()&&!i.getTransitionActive()&&(i.setRequestHomeView(!1),this.goHome());var e=i.getRequestTransition();return e&&!i.getTransitionActive()&&(i.setRequestTransition(!1),this.transitionView(e.position,e.coi,e.fov,e.up,e.worldUp,e.reorient,e.pivot)),!1}}function qy(e,t,i){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(e){this.clickConfig=e},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(e){},this.deactivate=function(e){},this.handleAction=function(t,n,r){for(var o=0;o<t.length;++o)switch(t[o]){case"selectOnly":e.selector&&n&&e.selector.setSelection([n.dbId],n.model,void 0,r);break;case"deselectAll":e.selector&&e.selector.setSelection([]);break;case"selectToggle":e.selector&&n&&e.selector.toggleSelection(n.dbId,n.model);break;case"isolate":n&&e.isolate(n.dbId);break;case"showAll":e.showAll();break;case"setCOI":n&&n.intersectPoint&&(i.setPivotPoint(n.intersectPoint,!0,!0),i.pivotActive(!0,!0));break;case"hide":n&&e.hide(n.dbId);break;case"show":n&&e.show(n.dbId);break;case"toggleVisibility":n&&e.toggleVisibility(n.dbId);break;case"focus":e.selector&&(n?e.selector.setSelection([n.dbId],n.model):e.selector.setSelection([]),i.fitToView())}},this.handleSingleClick=function(t,n){if(F())return!1;const r=e.isRightBtnSelectionEnabled();var o=t.ctrlKey||t.metaKey,s=t.shiftKey,a=t.altKey;if(0===n||2===n&&r){var l=e.clientToViewport(t.canvasX,t.canvasY),c="click";o&&(c+="Ctrl"),s&&(c+="Shift"),a&&(c+="Alt");var u=(h=e.hitTestViewport(l,!1))?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[c]&&this.clickConfig[c][u])return this.handleAction(this.clickConfig[c][u],h,n),!0}else if(1===n&&s&&!a&&!o){var h;l=e.clientToViewport(t.canvasX,t.canvasY);if((h=e.hitTestViewport(l,!1))&&h.intersectPoint)return i.setPivotPoint(h.intersectPoint,!0,!0),i.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(n,r){if(e.selector&&0===r){var o=e.clientToViewport(n.canvasX,n.canvasY),s=e.hitTestViewport(o,!1);return s?e.selector.setSelection([s.dbId],s.model):e.selector.clearSelection(),i.fitToView(),!0}return 1===r&&(t.fitBounds(!1,i.getBoundingBox(!0)),t.setPivotSetFlag(!1),!0)},this.handleSingleTap=function(i){if(i.clientX=i.pointers[0].clientX,i.clientY=i.pointers[0].clientY,e.api.triggerSingleTapCallback(i),i.hasOwnProperty("pointers")&&2===i.pointers.length)return t.setRequestHomeView(!0),!0;if(e.selector&&!e.selector.selectionDisabled){var n=e.clientToViewport(i.canvasX,i.canvasY),r=e.hitTestViewport(n,!1);return r?(e.selector.setSelection([r.dbId],r.model),e.api.triggerSelectionChanged([r.dbId])):(e.selector.clearSelection(),e.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(t){t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerDoubleTapCallback(t);var n=this.handleSingleTap(t,0);return i.fitToView(),n},this.handlePressHold=function(t){return"press"===t.type&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerContextMenu(t))},this.handleGesture=function(t){return!!t.type.includes("swipe")&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerSwipeCallback(t))}}Object.defineProperty(Wy,"_lastTouchedElement",{value:null,writable:!0}),fo.call(Wy.prototype),fo.call(jy.prototype);const Ky={};function Xy(e){var t=e.navigation,i=["gestures"],n=this,r=!0,o=!1,s=!0,a=null,l=!1,c=O();t.setIsTouchDevice(c),c&&((a=new ye.A.Manager(e.canvasWrap,{recognizers:[Ky.drag,Ky.doubletap,Ky.doubletap2,Ky.singletap,Ky.singletap2,Ky.press,Ky.drag3,Ky.swipe,Ky.pan,Ky.pinch,Ky.rotate],handlePointerEventMouse:!1,inputClass:ye.A.TouchInput})).get("pinch").recognizeWith([a.get("drag")]),e.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(e){e.preventDefault()},this.getNames=function(){return i},this.getName=function(){return i[0]},this.isActive=function(){return l},this.__clientToCanvasCoords=function(t){var i,n,r=e.impl.getCanvasBoundingClientRect(),o=r.width,s=r.height;t.hasOwnProperty("center")?(i=t.center.x-r.left,n=t.center.y-r.top):(i=t.pointers[0].clientX-r.left,n=t.pointers[0].clientY-r.top),t.canvasX=i,t.canvasY=n,t.normalizedX=i/o*2-1,t.normalizedY=(s-n)/s*2-1},this.distributeGesture=function(e){n.__clientToCanvasCoords(e),n.controller.distributeEvent("handleGesture",e)&&e.preventDefault()},this.onSingleTap=function(e){n.__clientToCanvasCoords(e),n.controller.distributeEvent("handleSingleTap",e)&&e.preventDefault()},this.onDoubleTap=function(e){n.__clientToCanvasCoords(e),n.controller.distributeEvent("handleDoubleTap",e)&&e.preventDefault()},this.onPressHold=function(e){n.__clientToCanvasCoords(e),n.controller.distributeEvent("handlePressHold",e)&&e.preventDefault()},this.onHammerInput=function(e){n.setMouseDisabledWhenTouching(e)},this.setMouseDisabledWhenTouching=function(e){e.isFirst&&!o?(r=n.controller.enableMouseButtons(!1),o=!0):e.isFinal&&setTimeout((function(){n.controller.enableMouseButtons(r),o=!1}),10)},this.activate=function(e){a&&!l&&(a.on("dragstart dragmove dragend",this.distributeGesture),a.on("singletap",this.onSingleTap),a.on("singletap2",this.onSingleTap),a.on("doubletap",this.onDoubleTap),a.on("doubletap2",this.onDoubleTap),a.on("press pressup",this.onPressHold),a.on("drag3start drag3move drag3end",this.distributeGesture),a.on("swipeleft swiperight swipeup swipedown",this.distributeGesture),s&&(a.on("panstart panmove panend",this.distributeGesture),a.on("pinchstart pinchmove pinchend",this.distributeGesture),a.on("rotatestart rotatemove rotateend",this.distributeGesture)),a.on("hammer.input",this.onHammerInput),a.get("doubletap2").recognizeWith("doubletap"),a.get("singletap2").recognizeWith("singletap"),a.get("singletap").requireFailure("doubletap"),a.get("swipe").recognizeWith("drag")),l=!0},this.deactivate=function(e){a&&l&&(a.off("dragstart dragmove dragend",this.distributeGesture),a.off("singletap",this.onSingleTap),a.off("singletap2",this.onSingleTap),a.off("doubletap",this.onDoubleTap),a.off("doubletap2",this.onDoubleTap),a.off("press pressup",this.onPressHold),a.off("drag3start drag3move drag3end",this.distributeGesture),a.off("swipeleft swiperight swipeup swipedown",this.distributeGesture),s&&(a.off("panstart panmove panend",this.distributeGesture),a.off("pinchstart pinchmove pinchend",this.distributeGesture),a.off("rotatestart rotatemove rotateend",this.distributeGesture)),a.off("hammer.input",this.onHammerInput)),l=!1},this.update=function(){return!1},this.handleBlur=function(e){return!1},this.disableTwoFingerSwipe=function(){s=!1,a&&(a.remove(ye.A.Pan),a.remove(ye.A.Pinch),a.remove(ye.A.Rotate),a.off("panstart panmove panend",this.distributeGesture),a.off("pinchstart pinchmove pinchend",this.distributeGesture),a.off("rotatestart rotatemove rotateend",this.distributeGesture))},this.setGestureParameter=function(e,t,i){const n=a&&a.get(e);return!!n&&(n.options[t]=i,!0)},this.restoreGestureParameterDefault=function(e,t){const i=a&&a.get(e);if(!i)return!1;const n=Ky[e][1];return i.options[t]=n.hasOwnProperty(t)?n[t]:i.defaults[t],!0}}function Yy(e){var t=!0;this.getVisibleModel=function(t){const i=e.getVisibleModels();for(let e=0;e<i.length;++e){const n=i[e];if(this.getSeedUrn(n)===t)return n}},this.createObjectSets=function(t){var i=t.objectSet;Array.isArray(i)||(t.objectSet=i=[]);for(var n=e.getVisibleModels(),r=0;r<n.length;r++){var o=n[r],s=this.getSeedUrn(o),a=this.getSelectedNodes(o);i[r]={id:a,idType:"lmv"},n.length>1&&(i[r].seedUrn=s),o.is2d()?(i[r].isolated=this.getVisibleLayers2d(o),i[r].allLayers=this.areAllLayersVisible(o),i[r].hidden=[]):(i[r].isolated=e.getIsolatedNodes(o),i[r].hidden=e.getHiddenNodes(o),i[r].explodeScale=e.getExplodeScale(),i[r].explodeOptions=e.getExplodeOptions())}},this.getState=function(i){var n=e.navigation,r={};r.seedURN=this.getSeedUrn(),this.createObjectSets(r);var o=r.viewport;o||(o=r.viewport={});var s=n.getCamera().isPerspective;o.name="",o.eye=n.getPosition().toArray(),o.target=n.getTarget().toArray(),o.up=n.getCameraUpVector().toArray(),o.worldUpVector=n.getWorldUpVector().toArray(),o.pivotPoint=n.getPivotPoint().toArray(),o.distanceToOrbit=n.getPivotPlaneDistance(),o.aspectRatio=this.getAspectRatio(),o.projection=s?"perspective":"orthographic",o.isOrthographic=!s,r.autocam={sceneUpDirection:e.autocam.sceneUpDirection.clone(),sceneFrontDirection:e.autocam.sceneFrontDirection.clone(),cubeFront:e.autocam.cubeFront.clone()},s?o.fieldOfView=n.getVerticalFov():o.orthographicHeight=this.getOrthographicHeight();var a=r.renderOptions;if(a||(a=r.renderOptions={}),a.environment=this.getEnvironmentName(),a.ambientOcclusion={enabled:e.impl.renderer().getAOEnabled(),radius:e.impl.renderer().getAORadius(),intensity:e.impl.renderer().getAOIntensity()},a.toneMap={method:e.impl.renderer().getToneMapMethod(),exposure:e.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},a.appearance={ghostHidden:e.impl.showGhosting,ambientShadow:e.prefs.get("ambientShadows"),antiAliasing:e.impl.renderer().settings.antialias,progressiveDisplay:e.prefs.get("progressiveRendering"),swapBlackAndWhite:e.prefs.get("swapBlackAndWhite"),displayLines:e.prefs.get("lineRendering"),displayPoints:e.prefs.get("pointRendering")},!e.impl.is2d)for(var l=r.cutplanes=[],c=e.impl.getCutPlaneSet("__set_view"),u=0;u<c.length;u++)l.push(c[u].toArray());for(var h in e.loadedExtensions){var d=e.loadedExtensions[h];d.getState&&d.getState(r)}return i&&i!==t&&this.applyFilter(r,i),r},this.restoreObjectSet=function(t){var i=t.objectSet;if(Array.isArray(i)&&0!==i.length){for(var n=[],r=[],o=e.model,s=0;s<i.length;++s){var a=i[s];if("lmv"===a.idType){var l=a.seedUrn;if(!l||(o=this.getVisibleModel(l))){var c=a.id;if(c&&(c=this.toIntArray(c),r.push({model:o,ids:c})),o.is2d()){var u=a.isolated;if(Array.isArray(u)&&u.length>0){e.setLayerVisible(null,!1);for(var h=0;h<u.length;++h)u[h]=parseInt(u[h]);e.impl.setLayerVisible(u,!0)}else a.allLayers||e.setLayerVisible(null,!1)}else{const e=this.toIntArray(a.isolated),t=this.toIntArray(a.hidden);n.push({model:o,isolatedIds:e,hiddenIds:t})}if("explodeScale"in a){var d=parseFloat(a.explodeScale),f=a.explodeOptions;e.explode&&e.explode(d,f)}}}}r.length>0&&e.impl.selector.setAggregateSelection(r),n.length&&e.impl.visibilityManager.aggregateRestore(n)}},this.restoreState=function(i,n,r){if(!i)return rt.warn("restoreState has no viewer state to restore from."),!1;if(!e||!e.model)return rt.warn("restoreState has no viewer or model to restore."),!1;n&&n!==t&&(i=JSON.parse(JSON.stringify(i)),this.applyFilter(i,n));var o=e.navigation,s=!e.impl.is2d;this.restoreObjectSet(i);const a=i.autocam;if(a){const t=e.autocam;t.sceneUpDirection.copy(a.sceneUpDirection),t.sceneFrontDirection.copy(a.sceneFrontDirection),t.cubeFront.copy(a.cubeFront),t.camera.worldup.copy(a.sceneUpDirection),t.cameraChangedCallback(!0)}var l=i.viewport;if(l){var c=this.getVector3FromArray(l.eye,o.getPosition()),u=this.getVector3FromArray(l.up,o.getCameraUpVector()),h=this.getVector3FromArray(l.target,o.getTarget()),d="fieldOfView"in l?parseFloat(l.fieldOfView):o.getVerticalFov(),f=this.getVector3FromArray(l.worldUpVector,null);if(!f){const t=e.getFirstModel(),i=null==t?void 0:t.getUpVector();f=i?(new THREE.Vector3).fromArray(i):new THREE.Vector3(0,1,0)}var p=this.getVector3FromArray(l.pivotPoint,o.getPivotPoint()),m=o.getCamera().isPerspective;"isOrthographic"in l&&(m=!l.isOrthographic);var g=this.getOrthographicHeight();"orthographicHeight"in l&&(g=Number(l.orthographicHeight));var v={position:c,target:h,up:u,worldup:f,aspect:e.impl.camera.aspect,fov:d,orthoScale:g,isPerspective:m,pivot:p};this.restoreCameraState(v,r)}var y=i.renderOptions;if(y){var b=e.impl.renderer(),x=e.prefs,_=x.get("ambientShadows"),E=x.get("antialiasing"),S=y.ambientOcclusion;if(S){"enabled"in S&&(_=S.enabled);var A="radius"in S?S.radius:null,w="intensity"in S?S.intensity:null;null!==A&&null!==w&&(A===b.getAORadius()&&w===b.getAOIntensity()||(b.setAOOptions(A,w),b.composeFinalFrame()))}if("environment"in y){var C=this.getLightPresetIndex(y.environment);-1!==C&&C!==x.get("lightPreset")&&s&&e.setLightPreset(C)}var T=y.toneMap;if(T){var M=!1,I="exposure"in T?T.exposure:null,P="lightMultiplier"in T?T.lightMultiplier:null;null!==I&&I!==b.getExposureBias()&&(b.setTonemapExposureBias(I),M=!0),null!==P&&e.impl.dir_light1&&P!==this.getToneMapIntensity()&&(e.impl.dir_light1.intensity=Math.pow(2,P),M=!0),M&&e.impl.invalidate(!0)}var L=y.appearance;L&&("antiAliasing"in L&&(E=L.antiAliasing),"progressiveDisplay"in L&&L.progressiveDisplay!==x.get("progressiveRendering")&&e.setProgressiveRendering(L.progressiveDisplay),"swapBlackAndWhite"in L&&L.swapBlackAndWhite!==x.get("swapBlackAndWhite")&&e.setSwapBlackAndWhite(L.swapBlackAndWhite),"ghostHidden"in L&&L.ghostHidden!==x.get("ghosting")&&s&&e.setGhosting(L.ghostHidden),"displayLines"in L&&L.displayLines!==x.get("lineRendering")&&e.hideLines(!L.displayLines),"displayPoints"in L&&L.displayPoints!==x.get("pointRendering")&&e.hidePoints(!L.displayPoints)),s&&_!==x.get("ambientShadows")&&E!==x.get("antialiasing")&&e.setQualityLevel(_,E)}if(Array.isArray(i.cutplanes)&&s){for(var R=[],D=0;D<i.cutplanes.length;D++){var O=i.cutplanes[D];Array.isArray(O)&&O.length>=4&&R.push(new THREE.Vector4(O[0],O[1],O[2],O[3]))}!function(t,i){if(e.getExtension("Autodesk.AEC.LevelsExtension")&&void 0===t.floorGuid){const e=i.length;if(3===e||8===e){const t=i[e-2],n=i[e-1];0===t.x&&0===t.y&&-1===t.z&&0===n.x&&0===n.y&&1===n.z&&i.splice(-2,2)}}}(i,R),e.impl.setCutPlaneSet("__set_view",R)}for(var B in e.loadedExtensions){var N=e.loadedExtensions[B];N.restoreState&&N.restoreState(i,r)}return!0},this.getEnvironmentName=function(){var t=xo[e.impl.currentLightPreset()];return t?t.name:"none"},this.restoreCameraState=function(t,i){e.impl.adjustOrthoCamera(t);var n=e.navigation;i?(t.isPerspective?n.toPerspective():n.toOrthographic(),n.setCameraUpVector(t.up),n.setWorldUpVector(t.worldup),n.setView(t.position,t.target),n.setPivotPoint(t.pivot),n.setVerticalFov(t.fov,!1),e.impl.syncCamera(!0)):(e.impl.camera.isPerspective=t.isPerspective,n.setRequestTransitionWithUp(!0,t.position,t.target,t.fov,t.up,t.worldup,t.pivot))},this.areEqual=function(e,t,i){var n,r,o,s;function a(e,t){if(t=t||[],(e=e||[]).length!==t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function l(e,t,i){return t=t||[],(e=e||[]).length===t.length&&(0!==e.length&&(c(e[0],t[0],i)||c(e[1],t[1],i)||c(e[2],t[2],i)))}function c(e,t,i){var n=e?parseFloat(e):null,r=e?parseFloat(t):null;return"number"===typeof n&&"number"===typeof r?Math.abs(e-t)<i:(e=e||null)===(t=t||null)}var u=e,h=t,d=1e-9;if(i&&!0!==i&&(u=this.applyFilter(u,i),h=this.applyFilter(h,i)),u.seedURN!==h.seedURN)return!1;var f=u.objectSet||[],p=h.objectSet||[];if(f.length!==p.length)return!1;var m=f[0]||{},g=p[0]||{};if(!(m.idType===g.idType&&c(m.explodeScale,g.explodeScale,d)&&c(null===(n=m.explodeOptions)||void 0===n?void 0:n.magnitude,null===(r=g.explodeOptions)||void 0===r?void 0:r.magnitude,d)&&c(null===(o=m.explodeOptions)||void 0===o?void 0:o.depthDampening,null===(s=g.explodeOptions)||void 0===s?void 0:s.depthDampening,d)&&a(m.id,g.id)&&a(m.isolated,g.isolated)&&a(m.hidden,g.hidden)))return!1;var v=u.viewport||{},y=h.viewport||{};return!!(v.name===y.name&&v.projection===y.projection&&v.isOrthographic===y.isOrthographic&&c(v.distanceToOrbit,y.distanceToOrbit,d)&&c(v.fieldOfView,y.fieldOfView,d)&&c(v.orthographicHeight,y.orthographicHeight,d)&&l(v.eye,y.eye,d)&&l(v.target,y.target,d)&&l(v.up,y.up,d)&&l(v.worldUpVector,y.worldUpVector,d)&&l(v.pivotPoint,y.pivotPoint,d))},this.toIntArray=function(e){var t=[];if(Array.isArray(e))for(var i=0,n=e.length;i<n;++i)t.push(parseInt(e[i]));return t},this.getVector3FromArray=function(e,t){return e instanceof Array&&e.length>2?(e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),e[2]=parseFloat(e[2]),(new THREE.Vector3).fromArray(e)):t},this.getSelectedNodes=function(t){return(t=t||e.model).selector?t.selector.getSelection():[]},this.getVisibleLayers2d=function(t){return t&&t!==e.model?(rt.warn("[getVisibleLayers2d] multiple models not yet supported."),[]):e.impl.getVisibleLayerIndices()},this.areAllLayersVisible=function(t){return t&&t!==e.model?(rt.warn("[areAllLayersVisible] multiple models not yet supported."),!0):e.impl.layers.allLayersVisible()},this.getAspectRatio=function(){var t=e.navigation.getScreenViewport();return t.width/t.height},this.getOrthographicHeight=function(){var t=e.navigation.getCamera();return t.isPerspective?0:Math.abs(2*t.orthographicCamera.top)},this.getSeedUrn=function(t){var i;return(null===(i=t=t||e.model)||void 0===i?void 0:i.getSeedUrn())||""},this.getToneMapIntensity=function(){var t=0;return e.impl.dir_light1&&(t=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),t},this.getLightPresetIndex=function(e){for(var t=0;t<xo.length;t++)if(xo[t].name===e)return t;return-1},this.applyFilter=function(e,t){if(!0!==t)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=t[i];void 0===n?delete e[i]:"boolean"==typeof n?!1===n&&delete e[i]:n instanceof Object?e[i]instanceof Object?this.applyFilter(e[i],t[i]):rt.warn("[applyFilter] A - Invalid filter Object for key ["+i+"]"):rt.warn("[applyFilter] B - Invalid filter value for key ["+i+"]")}},this.normalizeCoordinates=function(t){var i=t.viewport;if(i){if(i.normalized)return void rt.warn("invalid normalization of state.viewport. Ignoring command.");i.normalized=!0;if(Qy(i,Kp.getNormalizingMatrix(e.model)),"orthographicHeight"in i){var n=e.model.myData.bbox,r=n.max.y-n.min.y,o=i.orthographicHeight/r;i.orthographicHeight=o}}},this.denormalizeCoordinates=function(t){var i=t.viewport;if(i){if(!i.normalized)return void rt.warn("invalid denormalization of state.viewport. Ignoring command.");delete i.normalized;if(Qy(i,Kp.getNormalizingMatrix(e.model).clone().invert()),"orthographicHeight"in i){var n=e.model.myData.bbox,r=n.max.y-n.min.y,o=i.orthographicHeight*r;i.orthographicHeight=o}}}}function Qy(e,t){var i=new THREE.Vector3(e.eye[0],e.eye[1],e.eye[2]),n=new THREE.Vector3(e.pivotPoint[0],e.pivotPoint[1],e.pivotPoint[2]),r=new THREE.Vector3(e.target[0],e.target[1],e.target[2]);i.applyMatrix4(t),n.applyMatrix4(t),r.applyMatrix4(t),e.eye[0]=i.x,e.eye[1]=i.y,e.eye[2]=i.z,e.pivotPoint[0]=n.x,e.pivotPoint[1]=n.y,e.pivotPoint[2]=n.z,e.target[0]=r.x,e.target[1]=r.y,e.target[2]=r.z}function Zy(e,t,i){this.setGlobalManager(t.globalManager);var n,r,o=this,s=.001,a=.01,l=i&&i.hasOwnProperty("dollyDragScale")?i.dollyDragScale:100,c=-1!=navigator.userAgent.search("Mac OS"),u=i&&i.disablePinchRotation,h=t.navigation,d=h.getCamera(),f=["orbit","freeorbit","dolly","pan"],p=f[0],m=[p],g=p,v=null,y=1,b=0,x=0,_=0,E=0,S=!0,A=!1,w=null,C=!1,T=33,M=34,I=37,P=38,L=39,R=40,D=48,O=187,B=189,N=-4,U=-1,k=-5,F=new THREE.Vector3,V=new THREE.Vector3,G=new THREE.Vector2,z=new THREE.Vector2,H=new THREE.Vector2,W=new THREE.Vector2,j=new THREE.Vector3,q=new THREE.Vector3,K=new THREE.Vector3,X=new THREE.Vector3,Y=new THREE.Vector3,Q=new THREE.Vector3,Z=new THREE.Vector3,$=new THREE.Vector3,J=new THREE.Vector3,ee=new THREE.Quaternion,te=new THREE.Plane,ie=[!1,!1,!1,!1,!1,!1],ne={SHIFT:0,ALT:0,CONTROL:0,SPACE:0};this.active=!1;var re,oe=function(t){e.renderer().rolloverObjectId(0,null,0)},se=.01,ae=i&&i.hasOwnProperty("dollyScrollScale")?i.dollyScrollScale:.6,le=1,ce=5,ue=.025;function he(e,t){var i=o.getWindow(),n=0,r=0,s=i.innerWidth,a=i.innerHeight;$.set((e-.5*s-n)/(.5*s),(.5*a+r-t)/(.5*a),0);var l=$.length();return l>1?$.normalize():$.z=Math.sqrt(1-l*l),X.copy(d.position).sub(d.pivot),Q.copy(d.up).setLength($.y),Q.add(Z.copy(d.up).cross(X).setLength($.x)),Q.add(X.setLength($.z)),Q}this.getNames=function(){return f},this.getName=function(){return f[0]},this.activate=function(i){this.active=!0,m.push(i),g=i,S=t.prefs.get(Mn.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR),t.prefs.addListeners(Mn.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR,this._onPrefCursor),e.canvas.addEventListener("mouseout",oe),t.addEventListener(Rn,this.handleBlur)},this.deactivate=function(i){this.active=!1,t.prefs.removeListeners(Mn.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR,this._onPrefCursor);var n=m.length-1;n>0&&m[n]===i&&(m.pop(),g=m[n-1]),e.canvas.removeEventListener("mouseout",oe),t.removeEventListener(Rn,this.handleBlur)},this.isActive=function(){return this.active},this.adjustDollyLookSpeed=function(e){0===e?(ue=.025,ce=5):((ue*=e>0?1.1:.9)<1e-6&&(ue=1e-6),(ce*=e>0?1.1:.9)<1e-6&&(ce=1e-6))},this.getDollySpeed=function(e,t){var i;if(!h.getZoomTowardsPivot()&&!h.getWheelSetsPivot()||d.isPerspective||h.getIs2D()){var n=h.getEyeVector(),r=h.getPosition();o=e.clone().sub(r).dot(n.normalize())*ue;i=Math.abs(o)<se?o<0?-.01:se:o}else{var o=d.orthoScale*ue;i=Math.abs(o)<5e-4&&t?0:o}return i},this.setPivotPointFromInput=function(t,i){if(!h.getIs2D()&&h.getWheelSetsPivot()){var n=e.hitTest(t,i,!0);if(n&&n.intersectPoint)this.utilities.setPivotPoint(n.intersectPoint,!0,!0);else{const n=h.getPivotPoint(),r=h.getEyeVector().normalize(),o=-n.dot(r);te.set(r,o);const s=e.viewportToRay(e.clientToViewport(t,i));let a=new THREE.Vector3;s.intersectPlane(te,a),this.utilities.setPivotPoint(a,!0,!0)}}},this.getDollyScrollScale=function(){return ae},this.setDollyScrollScale=function(e){ae=e},this.getDollyDragScale=function(){return l},this.setDollyDragScale=function(e){l=e},this.getLookSpeed=function(){return ce},this.coiIsActive=function(){return h.getPivotSetFlag()&&h.isPointVisible(h.getPivotPoint())},this.adjustSpeed=function(e){this.adjustDollyLookSpeed(e),this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())},this.getTriggeredMode=function(){return 1===k&&ne.SHIFT?m[1]:(e=ne,2===k&&e.SHIFT&&!e.ALT&&!e.CONTROL||2===k&&e.ALT&&!e.SHIFT&&!e.CONTROL||"dolly"===g&&!e.ALT&&"pinch"!==v||0!==j.z?function(){var e=ne;return!(e.CONTROL||e.ALT||e.SHIFT||2!==k&&1!==k)}()?"pan":"dolly":function(){var e=ne;return 2===k&&!e.SHIFT&&!(e.ALT^e.CONTROL)||2===k&&e.SHIFT&&e.CONTROL||1===k&&!e.SHIFT&&!e.CONTROL||1===k&&e.ALT||1===k&&e.CONTROL&&!e.ALT||0===k&&e.SHIFT&&!e.CONTROL&&!e.ALT||"pan"===g&&1!==k&&!e.ALT&&!("pinch"===v)||e.SPACE}()?"pan":"pan"===v||"pinch"===v?"dollypan":g);var e},this.initTracking=function(e,t){var i;if(d.isPerspective){i=.5*(d.near+d.far);var n=this.utilities.getHitPoint(e,t),r=h.getPosition();if(n&&n.sub){var o=n.sub(r),s=h.getEyeVector().normalize();i=Math.abs(s.dot(o))}else{if(h.getPivotSetFlag()&&h.isPointVisible(h.getPivotPoint())){var a=h.getPivotPlaneDistance();a>.01&&(i=a)}}}else i=h.getEyeVector().length();le=i},this.initOrbit=function(){this.utilities.setTemporaryPivot(d.isPerspective&&h.getPivotPoint().sub(h.getPosition()).dot(h.getEyeVector())<=0?h.getTarget():null)},this.getActiveMode=function(){return p},this.getCursor=function(){if(!S)return null;switch(p){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(e,t){var i=h&&h.getReverseZoomDirection()?-1.5:1.5;c&&(i*=-1),ie[0]&&(V.x+=a,H.x+=20),ie[1]&&(V.x-=a,H.x-=20),ie[2]&&(V.y+=a,H.y+=20),ie[3]&&(V.y-=a,H.y-=20),ie[4]&&(V.z+=i),ie[5]&&(V.z-=i);var n=V.x-F.x,r=V.y-F.y,o=V.z-F.z;Math.abs(n)<s&&(n=0),Math.abs(r)<s&&(r=0),Math.abs(o)<s&&(o=0),e.set(n,r,o),t&&t.set(H.x-z.x,H.y-z.y)},this.stepMotionDelta=function(e,t){t?(F.x+=.6*e.x,F.y+=.6*e.y,F.z+=.6*e.z):F.copy(V),z.copy(H)},this.getFitBounds=function(){return this.utilities.viewerImpl.zoomBoundsChanged&&(re=this.utilities.viewerImpl.getVisibleBounds(!0),this.utilities.viewerImpl.zoomBoundsChanged=!1),re},this.update=function(){var e,i=!1,o=!1;this.getMotionDelta(j,W);var s=j.x,a=j.y,c=j.z;if(A||this.checkInteractionMode(),(A=k>U)&&this.controller.setIsLocked(!0),0!==s||0!==a||0!==c){switch(p){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(W.x=-W.x,w&&this.utilities.autocam.orbit(H,w,W.multiplyScalar(2),this.utilities.autocam.startState));break;case"freeorbit":!function(){if(h.isActionEnabled("orbit")){X.subVectors(d.position,d.pivot),Y.subVectors(d.position,d.target);var e=Y.length();Y.normalize();var t=Math.acos(q.dot(K)/q.length()/K.length());t&&(t*=2,J.crossVectors(q,K).normalize(),ee.setFromAxisAngle(J,-t),X.applyQuaternion(ee),d.up.applyQuaternion(ee),K.applyQuaternion(ee),Y.applyQuaternion(ee),q.copy(K)),d.position.addVectors(d.pivot,X),d.target.subVectors(d.position,Y.multiplyScalar(e)),d.dirty=!0}}();break;case"dolly":var m,g=new THREE.Vector2;c*=ae,k>=0?(a=-a,c=Math.abs(s)>Math.abs(a)?s:a,h.getReverseZoomDirection()&&(c*=-1),c*=l,s=0,a=0,g=h.viewportToScreen(0,0)):(e=h.getScreenViewport(),n&&r?(g.x=n/e.width,g.y=r/e.height):g=h.viewportToScreen(0,0)),!h.getIs2D()&&h.getZoomTowardsPivot()?this.coiIsActive()?m=h.getPivotPoint():(g=h.viewportToScreen(0,0),m=h.getWorldPoint(g.x,g.y)):m=h.getWorldPoint(g.x,g.y),h.dollyFromPoint(c*this.getDollySpeed(m,c<0),m,this.getFitBounds());break;case"pan":h.panRelative(-s,a,le);break;case"dollypan":0===s&&0===a||h.panRelative(-s,a,le),e=h.getScreenViewport(),m=h.getWorldPoint(n/e.width,r/e.height);var E=h.getPosition(),S=h.getIs2D()?E.sub(m).length():le,T=(b/x-1)*S;h.dollyFromPoint(T,m,this.getFitBounds());var M=new THREE.Vector3,I=new THREE.Quaternion,P=h.getCameraUpVector(),L=M.copy(d.position).sub(d.target).normalize();I.setFromAxisAngle(L,1.2*_),P.applyQuaternion(I),h.getIs2D()||u&&("pinch"===v||"pan"===v)||h.setCameraUpVector(P),b=x,y,le=S+T}o=!0}return this.stepMotionDelta(j,"pan"!==p&&"dollypan"!==p),k===U&&Math.abs(c)<.01&&(this.interactionEnd(U),V.z=0,F.z=0,i=!0,o=!0),(ne.SHIFT||ne.ALT)&&-1!==f.indexOf(t.getActiveNavigationTool())&&(o=!0),!C&&(i||k>-5)&&(k>U&&(F.copy(V),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),k=-5,A&&this.controller.setIsLocked(!1),A=!1,w=null,v=null),o?this.utilities.pivotActive(h.getPivotSetFlag(),k<=U):this.utilities.pivotUpdate(),d.dirty},this.checkInteractionMode=function(){var e=this.getTriggeredMode();e!==p&&("pan"===(p=e)&&k>U||"dollypan"===p)&&this.initTracking(F.x,F.y)},this.interactionStart=function(e,t){(t||e>k)&&(k=e,C=!0,e>U&&("pan"===p&&this.initTracking(F.x,F.y),"orbit"===p&&this.initOrbit()),!h.getSelectionSetsPivot()&&this.utilities.pivotActive(h.getPivotSetFlag(),e===U),this.utilities.autocam&&(this.utilities.autocam.sync(d),this.utilities.autocam.startInteraction(z.x,z.y),w=z.clone()))},this.interactionCheck=function(){(ie[0]||ie[1]||ie[2]||ie[3]||ie[4]||ie[5]||ne.SHIFT||ne.CONTROL||ne.ALT||ne.SPACE)&&this.interactionStart(N,!0)},this.interactionEnd=function(e){e===k&&(e!==U&&this.utilities.pivotActive(!1),C=!1)},this.isInteractionActive=function(){return C},this.handleWheelInput=function(t,i){if(n=i.canvasX,r=i.canvasY,this.isDragging)return!1;if(h.getIs2D()){var o=h.getScreenViewport(),s=e.intersectGround(n+o.width,r+o.height);this.utilities.setPivotPoint(s,!0,!0)}else this.setPivotPointFromInput(n,r);return h.getReverseZoomDirection()&&(t*=-1),V.z+=t,0!=t&&this.interactionStart(U),!0},this.resetKeys=function(){this.autoMove(-1,!1),ne.SHIFT=0,ne.CONTROL=0,ne.ALT=0,ne.SPACE=0},this.autoMove=function(e,t){t&&this.isDragging||(e<0?ie[0]=ie[1]=ie[2]=ie[3]=ie[4]=ie[5]=t:ie[e]=t,t||this.interactionEnd(N),this.interactionCheck())},this.updateModifierState=function(e){ne.CONTROL=c&&e.metaKey||e.ctrlKey?1:0,ne.SHIFT=e.shiftKey?1:0,ne.ALT=e.altKey?1:0},this.handleKeyDown=function(e,t){this.updateModifierState(e);var i=!1;if(c&&ne.CONTROL)return this.autoMove(-1,!1),this.interactionEnd(N),!1;switch(t){case O:this.adjustSpeed(1),i=!0;break;case B:this.adjustSpeed(-1),i=!0;break;case D:this.adjustSpeed(0),i=!0;break;case I:this.autoMove(0,!0),i=!0;break;case L:this.autoMove(1,!0),i=!0;break;case T:this.autoMove(2,!0),i=!0;break;case M:this.autoMove(3,!0),i=!0;break;case P:this.autoMove(4,!0),i=!0;break;case R:this.autoMove(5,!0),i=!0;break;default:return!1}return this.isDragging||this.interactionStart(N),i},this.handleKeyUp=function(e,t){this.updateModifierState(e);var i=!1;if(c&&ne.CONTROL)return this.autoMove(-1,!1),this.interactionEnd(N),!1;switch(t){case I:this.autoMove(0,!1),i=!0;break;case L:this.autoMove(1,!1),i=!0;break;case T:this.autoMove(2,!1),i=!0;break;case M:this.autoMove(3,!1),i=!0;break;case P:this.autoMove(4,!1),i=!0;break;case R:this.autoMove(5,!1),i=!0;break;default:return!1}return i&&(this.interactionEnd(N),C||this.interactionCheck()),i},this.handleDollyPan=function(e){n=e.canvasX,r=e.canvasY;var t=h.getScreenViewport();H.x=n,H.y=r,V.x=H.x/t.width,V.y=H.y/t.height,x=function(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY;return Math.sqrt(t*t+i*i)}(e);var i,o,s=THREE.Math.degToRad(e.rotation);_=s-E,Math.abs(_)>1&&(_=0),E=s,i=e.type,o="start",-1!==i.indexOf(o,i.length-o.length)&&(b=x,1,_=0,E=s),y=e.scale},this.handleGesture=function(e){switch(e.type){case"dragstart":return v="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"!==v&&(this.handleButtonDown(e,0),v="drag"),this.handleMouseMove(e);case"dragend":return"drag"===v&&(this.handleButtonUp(e,0),v=null,!0);case"panstart":return v="pan",this.handlePanStart(e),this.handleDollyPan(e),!0;case"panmove":return"pan"!==v&&(v="pan",this.handlePanStart(e)),this.handleDollyPan(e);case"panend":return"pan"===v&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0);case"pinchstart":return this.setPivotPointFromInput(e.center.x,e.center.y),this.isDragging=!0,v="pinch",F.x=.5*(e.normalizedX+1),F.y=1-.5*(e.normalizedY+1),G.set(e.canvasX,e.canvasY),z.set(e.canvasX,e.canvasY),A=!1,this.interactionStart(3),this.handleDollyPan(e),!0;case"pinchmove":return"pinch"===v&&this.handleDollyPan(e);case"pinchend":return"pinch"===v&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0)}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),F.x=.5*(e.normalizedX+1),F.y=1-.5*(e.normalizedY+1),z.set(e.canvasX,e.canvasY),V.copy(F),H.copy(z),q.copy(he(e.canvasX,e.canvasY)),K.copy(q),n=e.canvasX,r=e.canvasY,this.isDragging=!0,this.interactionStart(t),!0},this.handlePanStart=function(e){return this.isDragging=!0,F.x=.5*(e.normalizedX+1),F.y=1-.5*(e.normalizedY+1),G.set(e.canvasX,e.canvasY),z.set(e.canvasX,e.canvasY),this.interactionStart(3),!0},this.handleButtonUp=function(e,t){return this.updateModifierState(e),V.x=.5*(e.normalizedX+1),V.y=1-.5*(e.normalizedY+1),H.set(e.canvasX,e.canvasY),K.copy(he(e.canvasX,e.canvasY)),q.copy(K),n=e.canvasX,r=e.canvasY,this.interactionEnd(t),this.isDragging=!1,!0},this.handleMouseMove=function(t){return this.updateModifierState(t),this.isDragging?(V.x=.5*(t.normalizedX+1),V.y=1-.5*(t.normalizedY+1),H.set(t.canvasX,t.canvasY),K.copy(he(t.canvasX,t.canvasY)),n=t.canvasX,r=t.canvasY,!0):(F.x=.5*(t.normalizedX+1),F.y=1-.5*(t.normalizedY+1),z.set(t.canvasX,t.canvasY),V.x=F.x,V.y=F.y,H.copy(z),n=t.canvasX,r=t.canvasY,t.target===e.canvas&&e.rolloverObject(n,r),!1)},this.handleBlur=e=>{this.resetKeys(),this.interactionEnd(k)},this._onPrefCursor=function(e){S=e}.bind(this)}ye.A&&function(){if(!Ky.singletap){var e=Ky;e.singletap=[ye.A.Tap,{event:"singletap",threshold:7,time:400}],e.singletap2=[ye.A.Tap,{event:"singletap2",pointers:2,threshold:7,time:400}],e.press=[ye.A.Press,{event:"press",time:500,threshold:50}],e.doubletap=[ye.A.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],e.doubletap2=[ye.A.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],e.swipe=[ye.A.Swipe,{event:"swipe",pointers:1,threshold:200,velocity:1.7}],e.drag=[ye.A.Pan,{event:"drag",pointers:1}],e.drag3=[ye.A.Pan,{event:"drag3",pointers:3,threshold:15}],e.pan=[ye.A.Pan,{event:"pan",pointers:2,threshold:20}],e.pinch=[ye.A.Pinch,{event:"pinch",pointers:2,enable:!0,threshold:.05}],e.rotate=[ye.A.Rotate,{event:"rotate",pointers:2,enable:!0,threshold:7}]}}(),Yy.prototype.constructor=Yy,fo.call(Zy.prototype);const $y=Number.MIN_VALUE||3e-308,Jy=1e-5;function eb(e){const t=1e-12;Math.abs(e.x)<t&&Math.abs(e.y)<t?e.set(0,0,e.z>0?1:-1):Math.abs(e.y)<t&&Math.abs(e.z)<t?e.set(e.x>0?1:-1,0,0):Math.abs(e.z)<t&&Math.abs(e.x)<t&&e.set(0,e.y>0?1:-1,0)}function tb(e,t,i){var n=this,r=null,o=!1;this.cube=null,this.camera=e,this.renderer="WEBGL",this.startState={},this.navApi=t,this.orthographicFaces=!1,this.canvas=i,this.cameraChangedCallback=function(){},this.pivotDisplayCallback=function(){},this.transitionCompletedCallback=function(){};var s,a=Date.now(),l=!1;function c(t){o=!0,e.target.copy(n.center),e.pivot.copy(n.pivot),e.worldup?e.worldup.copy(n.sceneUpDirection):e.up.copy(n.sceneUpDirection),n.cameraChangedCallback(t),o=!1}function u(e,t){e.position.copy(e.globalPosition).sub(t),e.center.copy(e.globalCenter).sub(t),e.pivot.copy(e.globalPivot).sub(t)}this.recordTime=!0,this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.transitionCompletedCallback=null,this.canvas=null,this.recordTime=!1,this.afAnimateTransition&&cancelAnimationFrame(this.afAnimateTransition)},this.registerCallbackCameraChanged=function(e){this.cameraChangedCallback=e},this.registerCallbackPivotDisplay=function(e){this.pivotDisplayCallback=e},this.registerCallbackTransitionCompleted=function(e){this.transitionCompletedCallback=e},this.showPivot=function(e){this.pivotDisplayCallback(e)},this.setWorldUpVector=function(e){o||e&&e.lengthSq()>0&&!e.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(e),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var e=this.sceneUpDirection.clone();return Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()},this.goToView=function(e){if(this.navApi.isActionEnabled("gotoview")){var t={position:e.position.clone(),up:e.up.clone(),center:e.center.clone(),pivot:e.pivot.clone(),fov:e.fov,worldUp:e.worldUp.clone(),isOrtho:e.isOrtho};this.addGlobalPositions(t),n.elapsedTime=0,this.animateTransition(t)}},this.getCurrentView=function(){return{position:e.position.clone(),up:e.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:e.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:!1===e.isPerspective}},this.setCurrentViewAsHome=function(e){e?(this.navApi.setRequestFitToView(!0),l=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(e){var t=e.pivot?e.pivot:this.center,i=e.target?e.target:this.pivot,n=e.worldup?e.worldup:this.sceneUpDirection;this.homeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:n.clone(),isOrtho:!1===e.isPerspective},this.originalHomeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:n.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:!1===e.isPerspective},this.addGlobalPositions(this.homeVector),this.addGlobalPositions(this.originalHomeVector)},this.toPerspective=function(){e.isPerspective||(e.toPerspective(),c(!1))},this.toOrthographic=function(){e.isPerspective&&(e.toOrthographic(),c(!1))},this.setOrthographicFaces=function(e){this.orthographicFaces=e},this.getViewType=function(){return this.orthographicFaces?Ln.PERSPECTIVE_ORTHO_FACES:e.isPerspective?Ln.PERSPECTIVE:Ln.ORTHOGRAPHIC},this.setViewType=function(e,t){switch(e){case Ln.ORTHOGRAPHIC:return this.setOrthographicFaces(!1),this.toOrthographic(),!0;case Ln.PERSPECTIVE:return this.setOrthographicFaces(!1),this.toPerspective(),!0;case Ln.PERSPECTIVE_ORTHO_FACES:return this.setOrthographicFaces(!0),void 0===t&&(t=this.isFaceView()),t?this.toOrthographic():this.toPerspective(),!0;default:return!1}},this.goHome=function(){this.navApi.isActionEnabled("gotoview")&&(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(e.position)},this.setCameraUp=function(t){var i=this.dir.clone(),n=i.cross(t).normalize();0===n.lengthSq()&&(i.copy(this.dir),t.z>t.y?i.y+=1e-4:i.z+=1e-4,n=i.cross(t).normalize()),e.up.copy(n).cross(this.dir).normalize()},this.addGlobalPositions=function(e){var t=this.camera.globalOffset;e.globalPosition=e.position.clone().add(t),e.globalCenter=e.center.clone().add(t),e.globalPivot=e.pivot.clone().add(t)},this.onGlobalOffsetChanged=function(e){u(this.homeVector,e),u(this.originalHomeVector,e),this.camera.setGlobalOffset(e)};var h,d,f,p,m=this;!function e(){m.recordTime&&requestAnimationFrame(e);var t=Date.now();s=t-a,a=t}(),this.ortho=!1,this.center=e.target?e.target.clone():new(v().Vector3)(0,0,0),this.pivot=e.pivot?e.pivot.clone():this.center.clone(),this.sceneUpDirection=e.worldup?e.worldup.clone():e.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(e.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=e.position.clone(),this.saveUp=e.up.clone(),this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(e);var g,b,_=new(v().Quaternion),E=new(v().Quaternion),S=new(v().Quaternion),A=new(v().Quaternion);this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,e.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=v().Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new(v().Vector3)(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0;var w,C,T={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=T,this.zoomDelta=new(v().Vector2);var M;function I(e,t,i){if(e<=t)return 0;if(e>=i)return 1;var n=(e-t)/(i-t);return.5*(Math.sin((n-.5)*Math.PI)+1)}function P(e){return Math.round(10*e)/10}function L(e,t){var i=new(v().Vector2)(0,0),r=n.getWindow();return i.x=e/r.innerWidth,i.y=t/r.innerHeight,i}function R(e,t,i){var r,o,s,a;r=o=s=a=0;var l=0,c=null,u=null,h=n.snapOrbitDeadZone,d=n.orbitMultiplier;return"h"==e?(r=n.snapOrbitThresholdH,o=n.snapOrbitAccelerationAX,s=n.snapOrbitAccelerationBX,a=1-n.snapOrbitAccelerationPointX,u=n.lockDeltaX,c=n.lockedX):(r=n.snapOrbitThresholdV,o=n.snapOrbitAccelerationAY,s=n.snapOrbitAccelerationBY,a=1-n.snapOrbitAccelerationPointY,u=n.lockDeltaY,c=n.lockedY),c?(u+=i)<-h?(l=(u+h)*d*1/s,c=!1):u>h&&(l=(u-h)*d*1/s,c=!1):(l=Math.abs(t)>r?i*d:Math.abs(t)>a*r?i*t>0?i*d*o:i*d*1/o:i*t>0?i*d*s:i*d*1/s)*t>0&&Math.abs(l)>Math.abs(t)&&(this.lockDeltaX=this.lockDeltaY=0,c=!0,l=t),l}function D(){return n.combined}function O(e,t){var i=!1,r=n.getWindow(),o=r.innerWidth,s=e.x%o,a=r.innerHeight,l=e.y%a,c=s>0?s-t.x:o+s-t.x,u=l>0?l-t.y:a+l-t.y;return Math.abs(c)<30&&Math.abs(u)<30&&(i=!0),i}function B(e,t,i){var r=n.getWindow();if(!M||!e){if(e){var o=new(v().Vector2),s=t.x,a=t.y;!function(e,t,i){var r=n.getWindow();i.x=(e.x-t.x)/r.innerWidth,e.x=t.x+(e.x-t.x)%r.innerWidth,i.y=(e.y-t.y)/r.innerHeight,e.y=t.y+(e.y-t.y)%r.innerHeight}(t,i,o),r.innerWidth*o.x,r.innerHeight*o.y,s<i.x?s-=60:s+=60,a<i.y?a-=60:a+=60}M=e}}function N(e){var t=Math.pow(e,2);e<0&&(t=-t);var i=L(0,t),r=.01*(n.maxSceneBound-n.minSceneBound);i.y*=r;var o=n.userHeightSpeed*i.y;return o=function(e,t,i){if(0===t)return 0;var r=e,o=n.saveEye.clone().sub(worldUp.clone().multiplyScalar(i+r)),s=n.saveEye.clone().sub(worldUp.clone().multiplyScalar(i)),a=0,l=(n.maxSceneBound-n.minSceneBound)/1e3;n.topLimit&&t>0?(a=n.maxSceneBound-l,n.topLimit=!1):n.bottomLimit&&t<0?(a=n.minSceneBound+l,n.bottomLimit=!1):a=o.dot(worldUp);var c=s.dot(worldUp);return a<n.minSceneBound?c<n.minSceneBound&&(n.bottomLimit=!0,r=0):a>n.maxSceneBound&&c>n.maxSceneBound&&(n.topLimit=!0,r=0),r}(o,e,n.m_amount),o}function U(e){var t=n.sceneFrontDirection.clone().cross(n.sceneUpDirection),i=Math.abs(Math.abs(e.dot(n.sceneUpDirection))-1),r=Math.abs(Math.abs(e.dot(n.sceneFrontDirection))-1),o=Math.abs(Math.abs(e.dot(t))-1);return i<Jy||r<Jy||o<Jy}this.viewCubeMenuOpen=!1,this.menuSize=new(v().Vector2)(0,0),this.menuOrigin=new(v().Vector2)(0,0),e.lookAt(this.center),this.setCube=function(e){this.cube=e},this.sync=function(t){t.isPerspective!==e.isPerspective&&(t.isPerspective?e.toPerspective():(e.toOrthographic(),t.saveFov&&(e.saveFov=t.saveFov))),e.fov=t.fov,e.position.copy(t.position),t.target&&(this.center.copy(t.target),e.target.copy(t.target)),t.pivot&&(this.pivot.copy(t.pivot),e.pivot.copy(t.pivot)),this.dir.copy(this.center).sub(e.position),this.setCameraUp(t.up);var i=t.worldup?t.worldup:t.up;i.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(i),l&&!this.navApi.getTransitionActive()&&(l=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},v().Matrix3.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,s=i+i,a=n+n,l=r+r,c=i*s,u=i*a,h=i*l,d=n*a,f=n*l,p=r*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(d+p),t[3]=u-v,t[6]=h+g,t[1]=u+v,t[4]=1-(c+p),t[7]=f-m,t[2]=h-g,t[5]=f+m,t[8]=1-(c+d),this},v().Quaternion.prototype.setFromRotationMatrix3=function(e){var t,i=e.elements,n=i[0],r=i[3],o=i[6],s=i[1],a=i[4],l=i[7],c=i[2],u=i[5],h=i[8],d=n+a+h;return d>0?(t=.5/Math.sqrt(d+1),this.w=.25/t,this.x=(u-l)*t,this.y=(o-c)*t,this.z=(s-r)*t):n>a&&n>h?(t=2*Math.sqrt(1+n-a-h),this.w=(u-l)/t,this.x=.25*t,this.y=(r+s)/t,this.z=(o+c)/t):a>h?(t=2*Math.sqrt(1+a-n-h),this.w=(o-c)/t,this.x=(r+s)/t,this.y=.25*t,this.z=(l+u)/t):(t=2*Math.sqrt(1+h-n-a),this.w=(s-r)/t,this.x=(o+c)/t,this.y=(l+u)/t,this.z=.25*t),this},v().Quaternion.prototype.rotate=function(e){var t=(new(v().Matrix4)).makeRotationFromQuaternion(this).elements,i=(new(v().Matrix3)).set(t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]);return e.applyMatrix3(i)},this.animateTransition=function(t){if(u(t,e.globalOffset),t){var i=!1,r=0;if(this.setCameraOrtho(t.isOrtho),n.elapsedTime>=T.duration)return r=1,n.center.copy(t.center),n.pivot.copy(t.pivot),e.position.copy(t.position),e.up.copy(t.up),e.target.copy(t.center),t.isOrtho||(e.fov=t.fov),e.dirty=!0,(i=!t.worldUp.equals(this.sceneUpDirection))&&this.setWorldUpVector(t.worldUp),this.currentlyAnimating=!1,c(i),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.navApi.setTransitionActive(!1),void this.transitionCompletedCallback();this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0);var o=T.destinationPercent,a=1-(r=I(n.elapsedTime/T.duration,0,o));n.elapsedTime+=s/500;var l=n.center.clone().multiplyScalar(a).add(t.center.clone().multiplyScalar(r)),h=e.position.clone().multiplyScalar(a).add(t.position.clone().multiplyScalar(r)),d=e.up.clone().multiplyScalar(a).add(t.up.clone().multiplyScalar(r)),f=e.pivot.clone().multiplyScalar(a).add(t.pivot.clone().multiplyScalar(r)),p=this.sceneUpDirection.clone().multiplyScalar(a).add(t.worldUp.clone().multiplyScalar(r)),m=e.fov*a+t.fov*r;n.center.copy(l),n.pivot.copy(f),e.position.copy(h),e.up.copy(d),e.target.copy(l),t.isOrtho||(e.fov=m),e.dirty=!0,(i=p.distanceToSquared(this.sceneUpDirection)>1e-4)&&this.setWorldUpVector(p),e.lookAt(n.center),c(i),this.cube&&requestAnimationFrame(this.cube.render),n.afAnimateTransition=requestAnimationFrame((function(){n.animateTransition(t)}))}},this.sphericallyInterpolateTransition=function(t){var i,r,o,a=0;if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),n.elapsedTime>=T.duration)a=1,this.currentlyAnimating=!1;else{var l=T.destinationPercent;a=I(n.elapsedTime/T.duration,0,l),n.elapsedTime+=s/500}if(1===a)r=C.position,i=C.center,o=C.up;else{var u=new(v().Matrix3),h=_.clone();h.slerp(E,a),u.makeRotationFromQuaternion(h);var d=function(e,t,i){return t*(1-e)+i*e}(a,g,b),f=u.elements;r=(i=w.center.clone().multiplyScalar(1-a).add(C.center.clone().multiplyScalar(a))).clone().sub(new(v().Vector3)(f[0],f[1],f[2]).multiplyScalar(d)),o=new(v().Vector3)(f[3],f[4],f[5])}n.center.copy(i),e.position.copy(r),e.up.copy(o),n.navApi.getUsePivotAlways()||n.pivot.copy(i),e.lookAt(n.center),!0===this.currentlyAnimating?(this.showPivot(!0),requestAnimationFrame((function(){n.sphericallyInterpolateTransition(t)}))):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),t&&t()),c(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var t=P(e.up.x),i=P(e.up.y),n=P(e.up.z),r=this.sceneFrontDirection.clone(),o=this.sceneUpDirection.clone(),s=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();r.x=P(r.x),r.y=P(r.y),r.z=P(r.z),o.x=P(o.x),o.y=P(o.y),o.z=P(o.z),s.x=P(s.x),s.y=P(s.y),s.z=P(s.z);var a=s.clone().multiplyScalar(-1),l=o.clone().multiplyScalar(-1),c=r.clone().multiplyScalar(-1);switch(this.cube.currentFace){case"front":if(o.x==t&&o.y==i&&o.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(s.x==t&&s.y==i&&s.z==n)return"right";if(a.x==t&&a.y==i&&a.z==n)return"left";break;case"right":if(o.x==t&&o.y==i&&o.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(c.x==t&&c.y==i&&c.z==n)return"left";if(r.x==t&&r.y==i&&r.z==n)return"right";break;case"left":if(o.x==t&&o.y==i&&o.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(r.x==t&&r.y==i&&r.z==n)return"left";if(c.x==t&&c.y==i&&c.z==n)return"right";break;case"back":if(o.x==t&&o.y==i&&o.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(a.x==t&&a.y==i&&a.z==n)return"right";if(s.x==t&&s.y==i&&s.z==n)return"left";break;case"top":if(c.x==t&&c.y==i&&c.z==n)return"down";if(r.x==t&&r.y==i&&r.z==n)return"up";if(s.x==t&&s.y==i&&s.z==n)return"right";if(a.x==t&&a.y==i&&a.z==n)return"left";break;case"bottom":if(r.x==t&&r.y==i&&r.z==n)return"down";if(c.x==t&&c.y==i&&c.z==n)return"up";if(s.x==t&&s.y==i&&s.z==n)return"right";if(a.x==t&&a.y==i&&a.z==n)return"left"}}},this.setCameraOrtho=function(t){t&&e.isPerspective&&e.toOrthographic(),t||e.isPerspective||e.toPerspective()},this.resetOrientation=function(){this.cube&&this.cube.showCompass(this.cube.prevRenderCompass),this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),c(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front",this.cube.showCompass(!1)),this.sceneUpDirection.copy(e.up.clone()),eb(this.sceneUpDirection),this.sceneFrontDirection.copy(this.getView()).normalize(),eb(this.sceneFrontDirection),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),eb(this.cubeFront),this.orthographicFaces&&this.setCameraOrtho(!0),c(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top",this.cube.showCompass(!1)),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),eb(this.sceneUpDirection),this.sceneFrontDirection.copy(e.up),eb(this.sceneFrontDirection),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),eb(this.cubeFront),c(!0)},this.calculateCubeTransform=function(t){var i=this.sceneUpDirection.clone(),r=this.sceneFrontDirection.clone(),o=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();(w=e.clone()).center=n.center.clone(),w.pivot=n.pivot.clone(),(C=e.clone()).center=n.center.clone(),C.pivot=n.pivot.clone();var s=new(v().Vector3)(0,0,0);t.indexOf("back")>=0&&(s=s.add(r)),t.indexOf("front")>=0&&(s=s.sub(r)),t.indexOf("top")>=0&&(s=s.add(i)),t.indexOf("bottom")>=0&&(s=s.sub(i)),t.indexOf("right")>=0&&(s=s.add(o)),t.indexOf("left")>=0&&(s=s.sub(o));var a=i,l=s.clone().normalize();if(1-Math.abs(l.dot(i))<$y)for(var c=this.getView().normalize(),u=[r.clone(),r.clone().negate(),o.clone(),o.clone().negate()],h=l.dot(i)>0?1:-1,d=c.clone().add(e.up.clone().multiplyScalar(h)).normalize(),f=-2,p=0;p<4;p++){var m=d.dot(u[p]);m>f&&(f=m,a=u[p].multiplyScalar(h))}b=g=this.getView().length(),C.position.copy(C.center.clone().add(s.multiplyScalar(b/s.length()))),C.up.copy(a);var y=w.center.clone().sub(w.position).normalize(),x=y.clone().cross(w.up).normalize(),T=x.clone().cross(y).normalize(),M=new(v().Matrix3);M.set(y.x,T.x,x.x,y.y,T.y,x.y,y.z,T.z,x.z),_.setFromRotationMatrix3(M),T=(x=(y=C.center.clone().sub(C.position).normalize()).clone().cross(C.up).normalize()).clone().cross(y).normalize(),M.set(y.x,T.x,x.x,y.y,T.y,x.y,y.z,T.z,x.z),S.setFromAxisAngle(y,0),A.setFromAxisAngle(T,0),E.setFromRotationMatrix3(M),E.multiply(S).multiply(A).normalize()},this.drawDropdownMenu=function(e,t,i,n,o,s,a){var l=0,c=this.getDocument();if(r)s.appendChild(r);else{(r=c.createElement("div")).className="dropDownMenu",r.style.top="100px",r.style.left="-400px";for(var u=0,h=0,d=0;d<e.length;d++){var f;if(null===e[d])(f=c.createElement("li")).style.height="1px",u+=1,f.style.backgroundColor="#E0E0E0";else{var p=hs.t(e[d]);if(h=p.length>h?p.length:h,i[d]){f=c.createElement("div");var m=c.createElement("input"),g=c.createElement("label");m.type="radio",m.className="dropDownMenuCheck",g.innerHTML=p,g.className="dropDownMenuCheckText",f.appendChild(m),f.appendChild(g),f.className="dropDownMenuCheckbox"}else(f=c.createElement("li")).textContent=p,f.className=t[d]?"dropDownMenuItem":"dropDownMenuItemDisabled";f.id="menuItem"+l,l++,u+=25,f.setAttribute("data-i18n",e[d])}r.appendChild(f)}s.appendChild(r),r.style.minWidth=Math.max(256,7.4*h)+"px";var v=r.getBoundingClientRect().width;this.menuSize.x=v,this.menuSize.y=u}l=0;for(d=0;d<e.length;d++)if(null!==e[d]){if(i[d]){var y="menuItem"+l,b=c.getElementById(y);b&&(b.children[0].checked=i[d]())}l++}var x=o-15,_=n+1,E=this.canvas.getBoundingClientRect();_+this.menuSize.x>E.right&&(_=n-this.menuSize.x-1),x+this.menuSize.y>E.bottom&&(x=E.bottom-this.menuSize.y),x-=a.y,_-=a.x,r.style.top=x+"px",r.style.left=_+"px",this.menuOrigin.x=_,this.menuOrigin.y=x},this.removeDropdownMenu=function(e){e.removeChild(r)},this.isFaceView=function(){return U(this.center.clone().sub(e.position).normalize())&&U(e.up)},this.startInteraction=function(e,t){this.startCursor=new(v().Vector2)(e,t),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new(v().Vector3)(0,0,0),this.navApi.setTransitionActive(!0)},this.orbit=function(t,i,r,o){if(this.navApi.isActionEnabled("orbit")&&!0!==this.currentlyAnimating){var s="wheel";if(n.orthographicFaces&&!e.isPerspective&&(e.toPerspective(),o&&o.saveEye.copy(this.camera.position)),o&&(s="cube"),"cube"==s?(this.saveCenter.copy(o.saveCenter),this.saveEye.copy(o.saveEye),this.savePivot.copy(o.savePivot),this.saveUp.copy(o.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(e.position),this.saveUp.copy(e.up),this.useSnap=!1,this.doCustomOrbit=!1),D()&&null==d&&(d=this.saveCenter.clone(),h=this.saveEye.clone(),p=this.savePivot.clone(),f=this.saveUp.clone()),this.preserveOrbitUpDirection){var a=L(t.x-i.x,t.y-i.y),l=L(r.x,r.y),u=this.sceneUpDirection.clone(),m=this.sceneFrontDirection.clone(),g=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),y=D()?p:this.savePivot,b=D()?h:this.saveEye,x=D()?d:this.saveCenter,_=D()?f:this.saveUp,E=y.clone().sub(b).normalize(),S=x.clone().sub(b).normalize(),A=S.clone().cross(_),w=b.clone().sub(y).length(),C=b.clone().sub(x).length(),T=E.clone().multiplyScalar(-1),M=S.clone().multiplyScalar(-1),I=A,P=_.clone();if(!this.constrainOrbitHorizontal){u.dot(this.saveUp)<-.009&&(a.x=-a.x,l.x=-l.x);var O=0;O=D()?l.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+R("h",0,-l.x):a.x*this.orbitMultiplier,this.lastSnapRotateX=O;var B=(new(v().Quaternion)).setFromAxisAngle(u,-O);T.applyQuaternion(B),M.applyQuaternion(B),I.applyQuaternion(B),P.applyQuaternion(B)}if(!this.constrainOrbitVertical){var N=m.clone().multiplyScalar(m.dot(I)),U=g.clone().multiplyScalar(g.dot(I)),k=N.clone().add(U);k.clone().normalize();var F=0;if(D())F=l.y*this.orbitMultiplier;else{var V=R("v",0,l.y);F=this.useSnap?this.lastSnapRotateY+V:a.y*this.orbitMultiplier}var G=(new(v().Quaternion)).setFromAxisAngle(k,-F);if(this.navApi.getOrbitPastWorldPoles())T.applyQuaternion(G).normalize(),M.applyQuaternion(G).normalize(),P.applyQuaternion(G).normalize();else{var z=P.clone();if(z.applyQuaternion(G).normalize(),u.dot(z)<0){var H=M.clone();H.applyQuaternion(G).normalize();var W=H.angleTo(u);Math.abs(W)>.5*Math.PI&&(W-=W>0?Math.PI:-Math.PI),F-=W,G.setFromAxisAngle(k,-F),T.applyQuaternion(G).normalize(),M.applyQuaternion(G).normalize(),P.applyQuaternion(G).normalize()}else T.applyQuaternion(G).normalize(),M.applyQuaternion(G).normalize(),P.applyQuaternion(G).normalize()}this.lastSnapRotateY=F}var j=T.multiplyScalar(w).add(y);e.position.copy(j),e.up.copy(P),this.center.copy(j),this.center.sub(M.multiplyScalar(C)),D()&&(d.copy(this.center),h.copy(e.position),p.copy(this.pivot),f.copy(e.up))}e.lookAt(this.center),c(!1)}},this.endInteraction=function(){this.navApi.setTransitionActive(!1)},this.look=function(t){if(this.navApi.isActionEnabled("walk")){var i=L(t.x,t.y),n=this.userLookSpeed,r=this.getView(),o=e.up,s=r.clone().cross(o).normalize(),a=this.sceneUpDirection.clone(),l=i.clone();l.x*=Math.PI,l.y*=Math.PI/e.aspect,l.multiplyScalar(n);var u=(new(v().Quaternion)).setFromAxisAngle(s,-l.y);if(e.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var h=o.clone();if(h.applyQuaternion(u).normalize(),h.dot(a)<0){var d=r.clone();d.applyQuaternion(u);var f=d.angleTo(a);Math.abs(f)>.5*Math.PI&&(f-=f>0?Math.PI:-Math.PI),l.y-=f,u.setFromAxisAngle(s,-l.y)}}r=u.clone().rotate(r),(o=u.clone().rotate(o)).normalize();var p=e.keepSceneUpright?a:o,m=(new(v().Quaternion)).setFromAxisAngle(p,-l.x);r=m.clone().rotate(r),o=m.clone().rotate(o),this.center.copy(r.add(e.position)),e.up.copy(o),e.lookAt(this.center),c(!1)}},this.pan=function(t){if(this.navApi.isActionEnabled("pan")){t=L(t.x,t.y);var i=this.getView(),n=e.up.clone().cross(i),r=i.clone().cross(n);n.normalize(),r.normalize(),i.normalize();var o=this.pivot.clone().sub(e.position),s=i.clone().dot(o),a=s*(Math.tan(v().Math.degToRad(e.leftFov))+Math.tan(v().Math.degToRad(e.rightFov))),l=s*(Math.tan(v().Math.degToRad(e.topFov))+Math.tan(v().Math.degToRad(e.bottomFov))),u=t.x*Math.abs(a),h=t.y*Math.abs(l),d=new(v().Vector3),f=n.clone().multiplyScalar(u),p=r.clone().multiplyScalar(h);d=f.clone().add(p).clone().multiplyScalar(this.userPanSpeed),e.position.add(d),this.center.add(d),e.lookAt(this.center),c(!1)}},this.zoom=function(t){if(this.navApi.isActionEnabled("zoom")){var i=this.userZoomSpeed,r=Number.MAX_VALUE,o=t.x+t.y,s=Math.pow(i,o),a=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(s)),l=a.clone().add(n.D.clone().multiplyScalar(n.D.clone().dot(this.pivot.clone().sub(a).clone())));if(!(s>=r)){if(o>0){Math.pow(i,o-0);if(o<0)return void 0;e.position.copy(a),this.center.copy(l);var u=a.clone().sub(this.saveEye).dot(n.D);u>r?(e.position.copy(this.saveEye.sub(n.D).clone().multiplyScalar(r)),r>0?-1:0):-u/r}else e.position.copy(a),this.center.copy(l);e.lookAt(this.center),c(!1)}}},this.walk=function(t,i,n,r,o){if(this.navApi.isActionEnabled("walk")){var s=this.sceneUpDirection.clone(),a=this.sceneFrontDirection.clone(),l=this.sceneFrontDirection.clone().cross(this.sceneUpDirection);O(t,i)?(wheel.cursorImage("SWWalk"),B(!0,t,i),x=i.x,y=i.y):B(!1,t,i),x=t.x,y=t.y;var u=L(x-i.x,y-i.y),h=-u.x,d=-u.y,f=h<0?-1:1,p=d<0?-1:1,m=Math.abs(h),g=Math.abs(d),b=new(v().Vector2)(30,30);b=L(b.x,b.y),m=O(t,i)?0:Math.abs(h)-b.x,g=O(t,i)?0:Math.abs(d)-b.y;g/=.25;var _=(m=(m/=.25)<1?I(m,0,1):Math.pow(m,1))>0?m*f:0,E=(g=g<1?I(g,0,1):Math.pow(g,1))>0?g*p:0,S=this.getView(),A=S.length();S.normalize(),S.clone().cross(e.up).normalize();var w=l.clone().multiplyScalar(l.clone().dot(S)),C=a.clone().multiplyScalar(a.clone().dot(S)).clone().add(w);C=C.clone().length()>$y?C.normalize():e.up;var T=E*(1*this.walkMultiplier),M=C,P=Math.cos(.65);1!=P&&(s.clone().dot(e.up)<-$y&&s.clone().dot(S)<-P||s.clone().dot(e.up)>$y&&s.clone().dot(S)>P)&&(M=-M);var R=-_*this.walkMultiplier*.05,D=e.up;(s.clone().dot(e.up)<-$y||Math.abs(s.clone().dot(e.up))<$y&&s.clone().dot(S)>$y)&&(R=-R),D=s;var N=(new(v().Quaternion)).setFromAxisAngle(D,R);N.normalize(),(S=N.clone().rotate(S)).normalize(),e.up.copy(N.clone().rotate(e.up)),e.up.normalize(),e.position.add(M.clone().multiplyScalar(T)),this.center.copy(e.position.clone().add(S.clone().multiplyScalar(A))),(M=s).normalize(),0===T&&(T=.01),e.lookAt(this.center),c(!1)}},this.updown=function(t){if(!this.navApi.getIsLocked()){var i=N(t);n.m_amount+=i;var r=new(v().Vector3)(0,1,0),o=n.saveEye.clone().sub(r.clone().multiplyScalar(n.m_amount)),s=o.clone().dot(r);e.position.copy(o),s<n.minSceneBound&&e.position.add(r.clone().multiplyScalar(n.minSceneBound-s)),s>n.maxSceneBound&&e.position.add(r.clone().multiplyScalar(n.maxSceneBound-s)),this.center.copy(e.position.clone().add(n.saveCenter.clone().sub(n.saveEye))),e.lookAt(this.center),c(!1)}}}fo.call(tb.prototype);class ib{constructor(){if(new.target===ib)throw new TypeError("Cannot construct RenderContextBase instances directly")}init(e,t,i){throw new Error("init method must be implemented")}startTimeQuery(){throw new Error("startTimeQuery method must be implemented")}stopTimeQuery(e){throw new Error("stopTimeQuery method must be implemented")}getTimeResult(e,t){throw new Error("getTimeResult method must be implemented")}}var nb=r(8071),rb=r.n(nb),ob=r(70984),sb=r.n(ob);let ab={uniforms:{color1:{type:"v3",value:new(v().Vector3)(41/255,76/255,120/255)},color2:{type:"v3",value:new(v().Vector3)(1/255,2/255,3/255)},opacity:{type:"f",value:1},envMap:{type:"t",value:null},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},uCamDir:{type:"v3",value:new(v().Vector3)},uCamUp:{type:"v3",value:new(v().Vector3)},uResolution:{type:"v2",value:new(v().Vector2)(600,400)},uHalfFovTan:{type:"f",value:.5},envMapBackground:{type:"i",value:0},backgroundTexture:{type:"t",value:null}},vertexShader:rb(),fragmentShader:sb()};var lb=r(44203),cb=r.n(lb),ub=r(66299),hb=r.n(ub);let db={uniforms:v().UniformsUtils.merge([Zd.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},useAO:{type:"i",value:0},aoOpacity:{type:"f",value:.625},tOverlay:{type:"t",value:null},useOverlay:{type:"i",value:0},useOverlayAlpha:{type:"i",value:1},tID:{type:"t",value:null},tID2:{type:"t",value:null},objIDv4:{type:"v4",value:new(v().Vector4)(0,0,0,0)},modelIDv2:{type:"v2",value:new(v().Vector2)(0,0)},modelIDsv2v:{type:"v2v",value:[]},edgeObjIDv4:{type:"v4",value:new(v().Vector4)(0,0,0,0)},edgeModelIDv2:{type:"v2",value:new(v().Vector2)(0,0)},highlightIntensity:{type:"f",value:1},highlightColor:{type:"c",value:new(v().Color)(1,1,1)},resolution:{type:"v2",value:new(v().Vector2)(1/1024,1/512)},selectionColor:{type:"c",value:new(v().Color)(0,0,0)},expand2dSelection:{type:"f",value:.5},tCrossFadeTex0:{type:"t",value:null},tCrossFadeTex1:{type:"t",value:null},crossFadeOpacity0:{type:"f",value:0},crossFadeOpacity1:{type:"f",value:0},highlightFullModel:{type:"f",value:0}}]),vertexShader:cb(),fragmentShader:hb()};var fb=r(78551),pb=r.n(fb);let mb={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:cb(),fragmentShader:pb()};var gb=r(2303),vb=r.n(gb),yb=r(49248),bb=r.n(yb);let xb={uniforms:{tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:new(v().Vector2)(1/1024,1/512)}},vertexShader:vb(),fragmentShader:bb()};var _b=r(9696),Eb=r.n(_b),Sb=r(94727),Ab=r.n(Sb);let wb={uniforms:{color:{type:"v4",value:new(v().Vector4)(0,0,0,.3)},cutplanes:{type:"v4v",value:[]}},vertexShader:Eb(),fragmentShader:Ab()};var Cb=r(47697),Tb=r.n(Cb),Mb=r(29126),Ib=r.n(Mb);let Pb={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:Tb(),fragmentShader:Ib()},Lb=function(e){let t={vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return e.uniforms&&(t.uniforms=v().UniformsUtils.clone(e.uniforms)),e.defines&&(t.defines=Object.assign({},e.defines)),e.extensions&&(t.extensions=Object.assign({},e.extensions)),e.attributes&&(t.attributes=e.attributes),new(v().ShaderMaterial)(t)},Rb=function(e,t,i){i=i||"",e.defines||(e.defines={}),e.defines[t]!=i&&(e.defines[t]=i,e.needsUpdate=!0)},Db=function(e,t){(e.defines||e.defines[t])&&(delete e.defines[t],e.needsUpdate=!0)};const Ob={createShaderMaterial:Lb,setMacro:Rb,removeMacro:Db},Bb={Color:1,Depth:2,ModelId:3,Overlay:4,Post1:5,Post2:6,SSAO:7,PostDisplay:8};function Nb(e,t,i,n,r){var o=new(v().WebGLRenderTarget)(e,t,{minFilter:v().NearestFilter,magFilter:v().NearestFilter,format:i,type:n,stencilBuffer:!1});return r&&(o.shareDepthFrom=r),o.name="depthTarget",o}const Ub=new(v().Vector4)(1,1,1,.5),kb=new(v().Vector4)(1,1,1,1);function Fb(e,t){var i=new(v().WebGLRenderTarget)(e,t,{minFilter:v().NearestFilter,magFilter:v().NearestFilter,format:v().RGBAFormat,type:v().UnsignedByteType,stencilBuffer:!1});return i.texture.generateMipmaps=!1,i.canReadPixels=!0,i}function Vb(e){e.material.blending=v().NoBlending,e.material.depthWrite=!1,e.material.depthTest=!1}function Gb(e,t){if(e&&t){t.length=0;for(let i=0;i<e.length;i++)t[i]=e[i]}}class zb{constructor(e,t){this.viewer=t,this.renderContext=e,this.postProcPass=null,this.postProcShaded=!1,this.setGlobalManager(t.globalManager)}load(){}unload(){this.viewer=null,this.renderContext=null,this.postProcPass=null}enable(){this.setPostProcShaded(!0);const e=this.renderContext.settings;this.renderContext.initPostPipeline(e.sao,e.antialias),this.viewer.impl.fireRenderOptionChanged(),this.viewer.impl.invalidate(!0,!0,!0)}disable(){this.setPostProcShaded(!1),this.viewer.impl.invalidate(!1,!1,!0)}shouldRenderAfterOverlays(){return!1}render(e,t,i,n){const r=void 0===n||n===this.shouldRenderAfterOverlays();return!(!this.isPostProcShaded()||!r)&&(this.postProcPass.render(e,t,i),!0)}updateUniformValue(e,t,i){this.postProcPass.uniforms[e]&&(i?this.postProcPass.uniforms[e].value.copy(t):this.postProcPass.uniforms[e].value=t,this.viewer.impl.invalidate(!1,!1,!0))}updateDefineValue(e,t){this.postProcPass.material.defines[e]!==t&&(null!==t?this.postProcPass.material.defines[e]=t:delete this.postProcPass.material.defines[e],this.setMaterialNeedsUpdate())}getUniformValue(e){return this.postProcPass.uniforms[e].value}getDefineValue(e){return this.postProcPass.material.defines[e]}changeResolution(e,t){this.postProcPass.uniforms.resolution.value.set(e,t)}setMaterialNeedsUpdate(){this.postProcPass.material.needsUpdate=!0,this.viewer.impl.invalidate(!1,!1,!0)}postProcessEdgesOn(){return!1}setPostProcShaded(e){this.postProcShaded=e}isPostProcShaded(){return this.postProcShaded}getOrder(){return 0}}class Hb{constructor(){this.rcExtensions=[]}registerPostProcessingExtension(e){this.rcExtensions.push(e),this.rcExtensions.sort(((e,t)=>t.getOrder()-e.getOrder()))}removePostProcessingExtension(e){const t=this.rcExtensions.indexOf(e);-1!==t&&(e.unload(),this.rcExtensions.splice(t,1))}render(e,t,i,n,r){for(let o=0;o<this.rcExtensions.length;o++){if(this.rcExtensions[o].render(e,t,i,r)){i=t;const e=t;t=n,n=e}}return i}updateUniformValue(e,t,i){for(let n=0;n<this.rcExtensions.length;n++)this.rcExtensions[n].updateUniformValue(e,t,i)}changeResolution(e,t){for(let i=0;i<this.rcExtensions.length;i++)this.rcExtensions[i].changeResolution(e,t)}setMaterialNeedsUpdate(){for(let e=0;e<this.rcExtensions.length;e++)this.rcExtensions[e].setMaterialNeedsUpdate()}postProcessEdgesOn(){return this.rcExtensions.some((e=>e.postProcessEdgesOn()))}isPostProcShaded(){return this.rcExtensions.some((e=>e.isPostProcShaded()))}}var Wb=r(9893),jb=r.n(Wb);let qb={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new g.Vector2(512,512)},resolution:{type:"v2",value:new g.Vector2(1/512,1/512)},axis:{type:"v2",value:new g.Vector2(1,0)},radius:{type:"f",value:50}},vertexShader:cb(),fragmentShader:jb()};var Kb=r(37787),Xb=r.n(Kb),Yb=r(18952),Qb=r.n(Yb),Zb=r(67020),$b=r.n(Zb);const Jb={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new g.Vector2(1/512,1/512)}},vertexShader:Xb(),fragmentShader:Qb()},ex={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new g.Vector2(1/512,1/512)}},vertexShader:Xb(),fragmentShader:$b()};var tx=r(78101),ix=r.n(tx);let nx={uniforms:v().UniformsUtils.merge([Zd.DepthTextureUniforms,{size:{type:"v2",value:new(v().Vector2)(512,512)},resolution:{type:"v2",value:new(v().Vector2)(1/512,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:12},bias:{type:"f",value:.1},projScale:{type:"f",value:500},intensity:{type:"f",value:1},tDepth_mip1:{type:"t",value:null},tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}}]),vertexShader:cb(),fragmentShader:ix()},rx=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.material=Lb(e),this.uniforms=this.material.uniforms,this.renderToScreen=!1,this.enabled=!0,this.clear=!1,this.camera=new(v().OrthographicCamera)(-1,1,1,-1,0,1);var i=new(v().BufferGeometry),n=new Float32Array(9);n[0]=-1,n[1]=-1,n[2]=0,n[3]=3,n[4]=-1,n[5]=0,n[6]=-1,n[7]=3,n[8]=0;var r=new Float32Array(6);r[0]=0,r[1]=0,r[2]=2,r[3]=0,r[4]=0,r[5]=2;var o=new Float32Array(9);o[0]=0,o[1]=0,o[2]=1,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=1,i.setAttribute("position",new(v().BufferAttribute)(n,3)),i.setAttribute("normal",new(v().BufferAttribute)(o,3)),i.setAttribute("uv",new(v().BufferAttribute)(r,2)),this.quad=new(v().Mesh)(i,this.material),this.scene=new(v().Scene),this.scene.add(this.quad)};rx.prototype={render:function(e,t,i,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i),e.setRenderTarget(t),!this.renderToScreen&&this.clear&&e.clear(),e.render(this.scene,this.camera)}};const ox=c().document,sx=new g.Color(16777215),ax=new g.Color(0);function lx(){var e,t,i,n,r,o,s,a,l,c,u,h,d,f,p,m=!1,y=new Hb;this.postShadingManager=function(){return y};var b,x,_,E,A={},w=void 0,C=null,T=null,M=null,I=null,P=null,L=null,R=null,D=[],O=null,B=0,N=0,U=0,k=0,V=1,G=!1,z=!1;let H=!1;var W={},j={},q=[0,0],K=new g.Vector4(0,0,0,.3),X=null,Y=1,Q=1,Z=!1,$={isRenderingHidden:!1,isRenderingOverlays:!1},ee=g.RGBAFormat,te=g.FloatType,ie=!1,ne=0,re=0,oe=0,se=[.42,0,1,1],ae=!0,le={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,customPresentPass:!1,envMapBg:!1,numIdTargets:1,renderEdges:!1,useIdBufferSelection:!1,copyDepth:!1},ce={},ue=null,he=null;function de(t){try{var i=Nb(2,2,t.format,t.type);i.texture.generateMipmaps=!1,e.setRenderTarget(i);var n=e.getContext(),r=n.checkFramebufferStatus(n.FRAMEBUFFER);return e.setRenderTarget(null),i.dispose(),r===n.FRAMEBUFFER_COMPLETE}catch(e){return!1}}function fe(e){le.useIdBufferSelection=e,e?f.material.defines.USE_IDBUFFER_SELECTION="1":delete f.material.defines.USE_IDBUFFER_SELECTION}function pe(e){e(t);for(var i=1;i<t.variants.length;i++)e(t.variants[i])}function me(e){switch(e){case Bb.Color:return!0;case Bb.Depth:return ie&&(le.sao||y.isPostProcShaded());case Bb.ModelId:return le.idbuffer;case Bb.Overlay:return!0;case Bb.SSAO:return le.sao;case Bb.Post1:return le.antialias||le.sao||le.customPresentPass||y.isPostProcShaded();case Bb.Post2:return y.isPostProcShaded()||le.customPresentPass;case Bb.PostDisplay:return le.antialias&&y.isPostProcShaded()}}function ge(){var t=I,i=C;if(f.uniforms.useAO.value){const n=function(){var e=[f.uniforms.useOverlay.value,f.uniforms.objIDv4.value];return f.uniforms.useOverlay.value=0,f.uniforms.objIDv4.value=new g.Vector4,e}();f.render(e,t,i),i=t,t=R,function(e){f.uniforms.useOverlay.value=e[0],f.uniforms.objIDv4.value=e[1]}(n)}var n=t===I?R:I;if(t=(i=y.render(e,t,i,n,!1))===I?R:I,f.uniforms.useOverlay.value||f.uniforms.objIDv4.value){const n=function(){var e=f.uniforms.useAO.value;return f.uniforms.useAO.value=0,e}();f.render(e,t,i),i=t,function(e){f.uniforms.useAO.value=e}(n)}return n=(t=i===I?R:I)===I?R:I,i=y.render(e,t,i,n,!0)}function ve(e,t){return(t=t||new g.Vector2).set((255&e)/255,(e>>8&255)/255),t}function ye(e,t,i){t=t||0;const n=function(e){return e!==re&&(re=e,-1===e&&(e=0),f.uniforms.objIDv4.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255,(e>>24&255)/255),!0)}(e),r=function(e){if(Array.isArray(e)&&1==e.length&&(e=e[0]),e===oe)return!1;const t=Array.isArray(oe)?oe.length:1,i=Array.isArray(e)?e.length:1;return!(i>1&&(e.sort(),i==t&&!oe.some(((t,i)=>t!==e[i])))||(i!=t&&(1==i?delete f.material.defines.HIGHLIGHT_MODEL_ID_COUNT:f.material.defines.HIGHLIGHT_MODEL_ID_COUNT=i.toString(),f.material.needsUpdate=!0),oe=e,1==i?ve(e=Array.isArray(e)?e[0]:e,f.uniforms.modelIDv2.value):f.uniforms.modelIDsv2v.value=e.map((e=>ve(e))),0))}(t);if(n||r)return f.uniforms.highlightIntensity.value=0,ne=performance.now(),f.uniforms.highlightFullModel.value=i?1:0,!0}this.settings=le,this.depthTargetSupported=function(){return ie},this.isWeakDevice=function(){return Z},this.init=function(n,r,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const m=s.offscreen,y=void 0!==s.useIdBufferSelection?s.useIdBufferSelection:J;var b;(t=function(){const e=Lb(Pb);e.blending=v().NoBlending,e.packedNormals=!0,e.depthWrite=!1;var t=1,i=2,n=4,r=8,o=[];o[0]=null;for(var s=1;s<r;s++){var a=e.clone();a.packedNormals=e.packedNormals,s&t&&(a.cutplanes=null,a.doNotCut=!0),s&i&&(a.useInstancing=!0),s&n&&(a.packedNormals=!1),o[s]=a}return e.variants=o,e.getCustomOverrideMaterial=function(e){var r=!e||!e.cutplanes||0==e.cutplanes.length,o=e.useInstancing,s=!e.packedNormals,a=(r?t:0)|(o?i:0)|(s?n:0);return this.variants[a]},e}(),i=function(e,t){const i=Lb(wb);i.depthWrite=!0,i.depthTest=!0,i.isEdgeMaterial=!0,i.transparent=!0,i.blending=v().NormalBlending,i.supportsMrtNormals=!0;var n=1,r=2,o=4,s=[];s[0]=null;for(var a=1;a<o;a++){var l=i.clone();l.defines=Object.assign({},i.defines),l.isEdgeMaterial=!0,l.supportsMrtNormals=!0,a&n&&(l.useInstancing=!0),a&r&&(l.doNotCut=!0,l.cutplanes=[]),s[a]=l}return i.variants=s,i.getCustomOverrideMaterial=function(o){var s=(null==o?void 0:o.useInstancing)?n:0;null!=o&&o.doNotCut&&(s|=r);var a=this.variants[s]||i;return e.isRenderingOverlays?e.isRenderingHidden?a.uniforms.color.value.copy(Ub):a.uniforms.color.value.copy(kb):a.uniforms.color.value.copy(t),void 0!==(null==o?void 0:o.edgeOpacity)&&(a.uniforms.color.value.w=o.edgeOpacity),a.uniforms.color.needsUpdate=!0,a},i}($,K),Vb(c=new rx(nx)),Vb(l=new rx(qb)),Vb(h=new rx(Jb)),Vb(u=new rx(ex)),Vb(d=new rx(xb)),Vb(f=new rx(db)),Vb(a=new rx(ab)),Vb(p=new rx(mb)),n)?(Z=F(),le.idbuffer=!Z,y&&(le.idbuffer=!0,le.numIdTargets=2,f.material.defines.USE_MODEL_ID="1",fe(!0)),_=r,E=o,e=n,z=!!m,H=!!s.removeAlphaInOutput,(b=(Z?[{format:g.RGBAFormat,type:g.HalfFloatType},{format:g.RGBAFormat,type:g.FloatType}]:[{format:g.RGBAFormat,type:g.FloatType},{format:g.RGBAFormat,type:g.HalfFloatType}]).find(de))?(ie=!0,ee=b.format,te=b.type):(ie=!1,rt.warn("Depth target is unsupported for this device."))):S()||rt.error("You need a gl context to make a renderer. Things will go downhill from here.",at(st.BROWSER_WEBGL_NOT_SUPPORTED))},this.setDepthMaterialOffset=function(e,t,i){pe((function(n){n.polygonOffset=e,n.polygonOffsetFactor=t,n.polygonOffsetUnits=i,n.extraDepthOffset&&(n.polygonOffsetFactor+=n.extraDepthOffset),n.needsUpdate=!0}))},this.setNoDepthNoBlend=Vb,this.overlayUpdate=function(){if(0===re||-1===re)return!1;var e=f.uniforms.highlightIntensity.value,t=1;if(ae){var i=.004*(performance.now()-ne);i=Math.min(i,1),t=function(e,t){var i=3*e[1],n=3*(e[3]-e[1])-i;return(((1-i-n)*t+n)*t+i)*t}(se,i)}return e!=t&&(f.uniforms.highlightIntensity.value=t,!0)},this.setRollOverFadeEnabled=function(e){ae=e},this.beginScene=function(t,i,n,l){if(r=i,s=t.fog,o=n,m=!1,A={},!C&&_)this.initPostPipeline(le.sao,le.antialias);else if(!C&&!_)return void(G||S()||(rt.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance.",at(st.VIEWER_INTERNAL_ERROR)),G=!0));if(l&&function(){var t=le.envMapBg&&!!a.material.envMap,i=!!a.material.useBackgroundTexture;if(!X||t||i){const t=a.uniforms.uCamDir.value||new g.Vector3;a.uniforms.uCamDir.value=r.worldUpTransform?r.getWorldDirection(t).applyMatrix4(r.worldUpTransform):r.getWorldDirection(t),a.uniforms.uCamUp.value=r.worldUpTransform?r.up.clone().applyMatrix4(r.worldUpTransform):r.up,a.uniforms.uResolution.value.set(_,E),a.uniforms.uHalfFovTan.value=Math.tan(g.Math.degToRad(.5*r.fov)),a.uniforms.opacity.value=Y,e.setRenderTarget(C),e.clear(!1,!0,!1),a.render(e,C,null)}else e.setClearColor(X,Y),e.setRenderTarget(C),e.clear(!0,!0,!1);ue&&ue.clearTarget(e);for(var n=0;n<D.length;n++)e.setClearColor(sx,1),e.setRenderTarget(D[n]),e.clear(!0,!1,!1);me(Bb.Depth)&&(e.setClearColor(ax,0),e.setRenderTarget(x),e.clear(!0,!1,!1))}(),me(Bb.Depth)){var u=i.near,d=i.far;c.uniforms.cameraNear.value=u,c.uniforms.cameraFar.value=d,h.uniforms.cameraNear.value=u,h.uniforms.cameraInvNearFar.value=1/(u-d);var p=i.projectionMatrix.elements;i.isPerspective?c.uniforms.projInfo.value.set(-2/(C.width*p[0]),-2/(C.height*p[5]),(1-p[8])/p[0],(1+p[9])/p[5]):c.uniforms.projInfo.value.set(-2/(C.width*p[0]),-2/(C.height*p[5]),(1-p[12])/p[0],(1-p[13])/p[5]),f.uniforms.projInfo.value.copy(c.uniforms.projInfo.value);var v=i.isPerspective?0:1;c.uniforms.isOrtho.value=v,f.uniforms.isOrtho.value=v;if(c.uniforms.projScale.value=C.height*p[5]*.125,f.uniforms.worldMatrix_mainPass.value=i.matrixWorld,y.isPostProcShaded()){const e=Autodesk.Viewing.Navigation.prototype.fov2fl(i.fov);y.updateUniformValue("focalLength",e),y.updateUniformValue("unitScale",V),y.updateUniformValue("worldMatrix_mainPass",i.matrixWorld,!0),y.updateUniformValue("cameraPos",i.position,!0),y.updateUniformValue("cameraNear",u),y.updateUniformValue("cameraFar",d),y.updateUniformValue("projInfo",c.uniforms.projInfo.value,!0),y.updateUniformValue("isOrtho",v)}}le.sao||(f.uniforms.useAO.value=0),this.renderScenePart(t,!0,!0,!0,!0)},this._render=function(e,t,i,n,r){e.setRenderTarget(t),e.render(i,n,r)},this._renderDepthTarget=function(i,n,o,s){if(n&&!i.sortObjects&&o){const n=i.overrideMaterial;i.overrideMaterial=t,t.depthWrite!==s&&function(e,t){e.depthWrite=t;for(var i=0;i<e.variants.length;i++){var n=e.variants[i];n&&(n.depthWrite=t)}}(t,s),this._render(e,o,i,r),i.overrideMaterial=n}},this.renderScenePart=function(t,n,a,l,c){void 0!==t.skipColorTarget&&(n=!t.skipColorTarget),void 0!==t.skipDepthTarget&&(a=!t.skipDepthTarget),void 0!==t.skipIdTarget&&(l=!t.skipIdTarget),n&&le.renderEdges&&(t.edgeMaterial=i);var u=a&&me(Bb.Depth),h=C,d=x;ue&&(h=ue.chooseColorTarget(t,h),(d=ue.getRenderSao(t)?x:null)&&x.shareDepthFrom),m=!1,A={};var f,p=c?o:void 0;t.fog=s,f=me(Bb.ModelId)&&l&&u?[h,d].concat(D):u?[h,d]:me(Bb.ModelId)&&l?[h].concat(D):h,this._render(e,f,t,r,p),t.edgeMaterial=void 0},this.clearAllOverlays=function(){e.setRenderTarget(T),e.clear(!0,!1,!1)},this.renderOverlays=function(t,n,o){var s=0;$.isRenderingOverlays=!0;let a=!1,l=!1,c=Object.values(t).sort(((e,t)=>e.needSeparateDepth==t.needSeparateDepth?t.scene.renderOrder-e.scene.renderOrder:1==e.needSeparateDepth?1:1==t.needSeparateDepth?-1:void 0));for(let t=0;t<c.length;++t){var u=c[t],h=u.scene,d=u.camera?u.camera:r,p=e;if(h.children.filter((e=>"lmvInternal"!==e.name)).length){let e=T;if(p.setRenderTarget(e),s||(s=1,o||(p.setClearColor(ax,0),p.clear(!0,!1,!1))),u.materialPre&&(h.overrideMaterial=u.materialPre),u.needSeparateDepth&&!l?(e=T,e.shareDepthFrom=null,p.setRenderTarget(e),p.clear(!1,!0,!1),l=!0):e.shareDepthFrom=C,u.needIdTarget&&me(Bb.ModelId)){O||((O=Fb(e.width,e.height)).shareDepthFrom=C,O.name="overlayId"),0==a&&(p.setRenderTarget(O),p.clear(!0,!1,!1),a=!0);var m=[e];u.needIdTarget&&m.push(O),this._render(p,m,h,d,n)}else this._render(p,e,h,d,n),u.needIdTarget&&(O||((O=Fb(e.width,e.height)).shareDepthFrom=C,O.name="overlayId"),p.setProgramPrefix(1,"#define ID_COLOR","#define ID_COLOR"),this._render(p,O,h,d,n),p.setProgramPrefix(0,"",""));u.materialPost&&($.isRenderingHidden=!0,p.getContext().depthFunc(p.getContext().GREATER),u.materialPost.depthFunc=g.GreaterDepth,le.renderEdges&&(i.depthWrite=!1,i.depthTest=!1,h.overrideMaterial=i,this._render(p,e,h,d)),h.overrideMaterial=u.materialPost,this._render(p,e,h,d,n),p.getContext().depthFunc(p.getContext().LEQUAL),u.materialPost.depthFunc=g.LessEqualDepth,$.isRenderingHidden=!1),le.renderEdges&&u.materialPre&&(i.depthWrite=!1,i.depthTest=!0,h.overrideMaterial=i,this._render(p,e,h,d)),h.overrideMaterial=null}}$.isRenderingOverlays=!1,i.depthWrite=!0,i.depthTest=!0,f.uniforms.useOverlay.value=s,s&&(f.uniforms.useOverlayAlpha.value=Q)},this.computeSSAO=function(t){if(!t&&le.sao){if(!m){if(w&&w.length){var i=w[0];h.uniforms.resolution.value.set(1/i.width,1/i.height),h.render(e,i,x);for(var n=1;n<w.length;n++){var r=w[n];u.uniforms.resolution.value.set(1/r.width,1/r.height),u.render(e,r,i),i=r}}c.render(e,L,C),l.uniforms.axis.value.set(1,0),l.render(e,I,L),l.uniforms.axis.value.set(0,1),l.render(e,L,I),m=!0}f.uniforms.useAO.value=1}else f.uniforms.useAO.value=0},this.getFinalTarget=function(){return he||null},this.presentBuffer=function(t){if(e){var i=this.getFinalTarget();if(!(f.uniforms.useAO.value||f.uniforms.useOverlay.value||ue||0!==re&&-1!==re||0!==oe&&-1!==oe))if(le.antialias)if(t)d.render(e,I,C),t.render(e,i,I);else if(y.isPostProcShaded()){const t=y.render(e,I,C,R);p.render(e,P,t),d.render(e,i,P)}else d.render(e,i,C);else if(t)t.render(e,i,C);else if(y.isPostProcShaded()){const t=y.render(e,I,C,R);p.render(e,i,t)}else p.render(e,i,C);else if(le.antialias)if(t)f.render(e,I,C),d.render(e,R,I),t.render(e,i,R);else if(y.isPostProcShaded()){let t=ge();p.render(e,P,t),d.render(e,i,P)}else f.render(e,I,C),d.render(e,i,I);else if(t)f.render(e,I,C),t.render(e,i,I);else if(y.isPostProcShaded()){let t=ge();p.render(e,i,t)}else f.render(e,i,C);if(H){const t=e.getContext(),n=t.getColorMask(),r=e.getClearAlpha();e.setRenderTarget(i),t.colorMask(!1,!1,!1,!0),e.setClearAlpha(1),e.clear(),t.colorMask(...n),e.setClearAlpha(r)}}},this.composeFinalFrame=function(e,t){this.computeSSAO(e),t||this.presentBuffer()},this.cleanup=function(){e&&e.setRenderTarget(null),C&&(C.dispose(),C=null),x&&(x.dispose(),x=null),T&&(T.dispose(),T=null),O&&(O.dispose(),O=null),M&&(M.dispose(),M=null),b&&(b.dispose(),b=null),ue&&ue.disposeTargets(),I&&(I.dispose(),I=null),L&&(L.dispose(),L=null),R&&(R.dispose(),R=null),w&&(w.forEach((e=>e.dispose())),w=void 0);for(var t=0;t<D.length;t++)D[t]&&D[t].dispose();D=[],A={},W={},j={}},this.setSize=function(t,i,n,r){var o,s,a,u;if(_=t,E=i,le.logicalWidth=t,le.logicalHeight=i,0===t&&0===i||!e)return void this.cleanup();const h=e.getPixelRatio();let p=Math.max(0,t*h),m=Math.max(0,i*h);var v;le.deviceWidth=p,le.deviceHeight=m,r||(z?e.setViewport(0,0,t,i):e.setSize(t,i));var b=p,S=m;(le.useSSAA||y.isPostProcShaded()&&!Z&&e.getPixelRatio()<=1&&y.postProcessEdgesOn())&&(p*=2,m*=2);var A=1/p,M=1/m;if(!n&&C&&C.width==p&&C.height==m||(rt.log("Reallocating render targets."),this.cleanup(),(C=new g.WebGLRenderTarget(p,m,{minFilter:g.LinearFilter,magFilter:g.LinearFilter,format:g.RGBAFormat,type:le.useHdrTarget?g.FloatType:g.UnsignedByteType,stencilBuffer:!1})).texture.generateMipmaps=!1,C.name="colorTarget",(T=new g.WebGLRenderTarget(p,m,{minFilter:g.NearestFilter,magFilter:g.NearestFilter,format:g.RGBAFormat,stencilBuffer:!1})).texture.generateMipmaps=!1,T.name="overlayTarget",T.shareDepthFrom=C,x=null,I=null,P=null,L=null,R=null,w=void 0),ue&&ue.updateTargets(p,m,n,le.useHdrTarget),me(Bb.Post1)&&(!n&&I&&I.width==p&&I.height==m||((I=new g.WebGLRenderTarget(p,m,{minFilter:g.LinearFilter,magFilter:g.LinearFilter,format:g.RGBAFormat,stencilBuffer:!1,depthBuffer:!1})).texture.generateMipmaps=!1,I.name="postTarget1")),!L&&me(Bb.SSAO)&&((L=I.clone()).name="SSAO target"),!R&&me(Bb.Post2)&&((R=I.clone()).name="post target 2"),!P&&me(Bb.PostDisplay)&&((P=new g.WebGLRenderTarget(b,S,{minFilter:g.LinearFilter,magFilter:g.LinearFilter,format:g.RGBAFormat,stencilBuffer:!1,depthBuffer:!1})).texture.generateMipmaps=!1,P.name="postTargetNormal"),me(Bb.Depth)){if(n||!x||x.width!=p||x.height!=m){x=Nb(p,m,ee,te,C);const e=5,t=Math.floor(Math.log2(Math.max(1,Math.min(p,m)))),i=Math.min(e,t);w=new Array(i),c.material.defines.USE_MIPMAP=i>0,c.material.defines.MAX_MIP_LEVEL=i,c.material.needsUpdate=!0;for(let e=1;e<=i;++e){const t=p>>e,i=m>>e,n=new g.WebGLRenderTarget(t,i,{minFilter:g.NearestFilter,magFilter:g.NearestFilter,format:g.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});n.texture.generateMipmaps=!1,n.name=`depthTarget_mipmap ${e}`,w[e-1]=n,c.uniforms[`tDepth_mip${e}`].value=n.texture}for(let t=i+1;t<=e;++t)c.uniforms[`tDepth_mip${t}`].value=null}c.uniforms.size.value.set(p,m),c.uniforms.resolution.value.set(A,M),c.uniforms.tDepth.value=x.texture,l.uniforms.size.value.set(p,m),l.uniforms.resolution.value.set(A,M),y.updateUniformValue("tDepth",x),f.uniforms.tDepth.value=x.texture}if(me(Bb.ModelId)){if(n||!D[0]||D[0].width!=p||D[0].height!=m){for(v=0;v<D.length;v++)D[v]&&D[v].dispose();for(D=[],v=0;v<le.numIdTargets;v++){var O=Fb(p,m);O.shareDepthFrom=C,O.name="id "+v,D.push(O)}}y.updateUniformValue("tID",D[0])}else if(D[0]){for(v=0;v<D.length;v++)D[v].dispose(),D[v]=null;D.length=0}d.uniforms.uResolution.value.set(A,M),y.changeResolution(A,M),f.uniforms.tOverlay.value=null===(o=T)||void 0===o?void 0:o.texture,f.uniforms.tAO.value=null===(s=L)||void 0===s?void 0:s.texture,f.uniforms.useAO.value=le.sao?1:0,f.uniforms.resolution.value.set(A,M),f.uniforms.tID.value=(null===(a=D[0])||void 0===a?void 0:a.texture)||null,f.uniforms.tID2.value=(null===(u=D[1])||void 0===u?void 0:u.texture)||null,ue&&ue.updateBlendPass()},this.getMaxAnisotropy=function(){return e?e.getMaxAnisotropy():0},this.mrtFlags=function(){return{mrtNormals:me(Bb.Depth),mrtIdBuffer:me(Bb.ModelId)?le.numIdTargets:void 0}},this.setIdTargetCount=function(e){if(!(e>2||e<1)&&e!==le.numIdTargets&&(le.numIdTargets=e,0!==D.length&&2===e&&1===D.length)){var t=Fb(D[0].width,D[0].height);return t.shareDepthFrom=C,t.name="id "+D.length,D.push(t),f.uniforms.tID2.value=t,f.material.defines.USE_MODEL_ID="1",f.material.needsUpdate=!0,!0}},this.getAntialiasing=function(){return le.antialias},this.initPostPipeline=function(e,t){le.sao=e&&ie,le.antialias=t,le.haveTwoSided&&pe((function(e){e.side=g.DoubleSide})),pe((function(e){e.needsUpdate=!0})),c.material.needsUpdate=!0,l.material.needsUpdate=!0,h.material.needsUpdate=!0,u.material.needsUpdate=!0,d.material.needsUpdate=!0,y.setMaterialNeedsUpdate(),f.material.needsUpdate=!0,a.material.needsUpdate=!0,p.material.needsUpdate=!0,this.setSize(_,E)},this.setClearColors=function(e,t){e instanceof g.Color?X=e.clone():!t||e.equals(t)?X=new g.Color(e.x,e.y,e.z):Z?X=new g.Color(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)):(X=void 0,a.uniforms.color1.value.copy(e),a.uniforms.color2.value.copy(t))},this.useOverlayAlpha=function(e){Q=e},this.setClearAlpha=function(e){Y=e},this.getClearAlpha=function(){return Y},this.setAOEnabled=function(e){le.sao=e&&ie,ce.sao=le.sao,this.setSize(_,E,!1,!0)},this.setAOOptions=function(e,t,i){void 0!==e&&(c.uniforms.radius.value=e,c.uniforms.bias.value=F()?.1:.01,l.uniforms.radius.value=e),void 0!==t&&(c.uniforms.intensity.value=t),f.uniforms.aoOpacity.value=void 0!==i?i:1,m=!1},this.getAOEnabled=function(){return le.sao},this.getAORadius=function(){return c.uniforms.radius.value},this.getAOIntensity=function(){return c.uniforms.intensity.value},this.setCubeMap=function(e){a.material.envMap=e,e||this.toggleEnvMapBackground(!1),e&&le.envMapBg&&(a.uniforms.envMapBackground.value=!0)},this.setBackgroundTexture=function(e){const t=a.material.useBackgroundTexture;a.uniforms.backgroundTexture.value=e,a.material.useBackgroundTexture=!!e,!!e!==t&&(a.material.needsUpdate=!0)},this.getCubeMap=function(){return a.material.envMap},this.setEnvRotation=function(e){U=e,a.material.envRotationSin=Math.sin(e),a.material.envRotationCos=Math.cos(e)},this.getEnvRotation=function(){return U},this.setEnvExposure=function(e){const t=a.material.envMapExposure,i=Math.pow(2,e);a.uniforms.envMapExposure.value=i,a.material.envMapExposure=i,i!==t&&(a.material.needsUpdate=!0),B=e},this.setTonemapExposureBias=function(e){N=e,a.uniforms.exposureBias.value=Math.pow(2,e)},this.getExposureBias=function(){return N},this.setCamera=function(e){r=e},this.setTonemapMethod=function(t){const i=k;k=t,e.gammaInput=0!==t,a.material.tonemapOutput=k,t!==i&&(a.material.needsUpdate=!0)},this.getToneMapMethod=function(){return k},this.toggleTwoSided=function(e){le.haveTwoSided!=e&&t&&pe((function(t){t.side=e?g.DoubleSide:g.FrontSide,t.needsUpdate=!0})),le.haveTwoSided=e},this.toggleEdges=function(e){le.renderEdges=e,ce.renderEdges=e},this.getRenderEdges=function(){return le.renderEdges},this.toggleEnvMapBackground=function(e){le.envMapBg=e,a.uniforms.envMapBackground.value=e&&!!a.material.envMap},this.enter2DMode=function(e,t){n=e,ce.sao=le.sao,ce.antialias=le.antialias,ce.idbuffer=le.idbuffer,ce.renderEdges=le.renderEdges,ce.useIdBufferSelection=le.useIdBufferSelection,t&&(ce.selectionColor=le.selectionColor,this.setSelectionColor(t)),le.idbuffer=!0,le.renderEdges=!1,f.material.defines.IS_2D="",fe(le.idbuffer),this.initPostPipeline(!1,!1)},this.exit2DMode=function(){n=null,le.idbuffer=ce.idbuffer,le.renderEdges=ce.renderEdges,ce.selectionColor&&this.setSelectionColor(ce.selectionColor),delete f.material.defines.IS_2D,fe(ce.idbuffer),this.initPostPipeline(ce.sao,ce.antialias)},this.idAtPixel=function(e,t,i,n){return this.idAtPixels(e,t,1,i,n)},this.idAtPixels=function(t,i,n,r,o){if(o&&o[0]||(o=D),!o[0])return 0;n%2==0&&(n+=1);const s=.5*(t+1)*o[0].width-.5*(n-1),a=.5*(i+1)*o[0].height-.5*(n-1);if(A[n]&&s===A[n][4]&&a===A[n][5]&&A[n][6]==o[0].name)return Gb(A[n],r),A[n][0];const l=4*n*n;W[l]||(W[l]=new Uint8Array(l));const c=W[l];let u;return e.readRenderTargetPixels(o[0],s,a,n,n,c),o[1]&&(j[l]||(j[l]=new Uint8Array(l)),u=j[l],e.readRenderTargetPixels(o[1],s,a,n,n,u)),function(e,t,i,n,r,o,s){let a;s=s||D;let l=0,c=0,u=0,h=-1;A[i]=[-1,-1,null,null,e,t,s[0].name];for(let o=0;o<i*i;o++){const o=l+(i-1)/2,f=c+(i-1)/2;if(o>=0&&o<=i&&f>=0&&f<=i){const l=o+f*i;if(a=n[4*l+2]<<16|n[4*l+1]<<8|n[4*l],a=a<<8>>8,A[i][0]=a,r){var d=r[4*l+1]<<8|r[4*l];A[i][1]=d<<16>>16}if(A[i][2]=2*(e+o)/s[0].width-1,A[i][3]=2*(t+f)/s[0].height-1,-1!==a)break}if(l==c||l<0&&l==-c||l>0&&l==1-c){const e=u;u=-h,h=e}l+=u,c+=h}return Gb(A[i],o),a}(s,a,n,c,u,r,o)},this.idsAtPixelsBox=function(t,i,n,r,o,s){if((s=s||D)[0]){var a=n*s[0].width,l=r*s[0].height,c=0|.5*(t+1)*s[0].width,u=0|.5*(i+1)*s[0].height,h=new Uint8Array(4*a*l);e.readRenderTargetPixels(s[0],c,u,a,l,h);var d=void 0;o&&s[1]&&(d=new Uint8Array(4*a*l),e.readRenderTargetPixels(s[1],c,u,a,l,d));var f={};for(let e=0;e<h.length;e+=4){var p=h[4*e+2]<<16|h[4*e+1]<<8|h[4*e];if((p=p<<8>>8)>0){var m=0;d&&(m=(m=d[4*e+1]<<8|d[4*e])<<16>>16);var g=p+"-"+m;f[g]||(f[g]=!0,o.push([p,m]))}}}},this.readbackTargetId=function(){if(!D[0])return null;var t=new Uint8Array(4*D[0].width*D[0].height);return e.readRenderTargetPixels(D[0],0,0,D[0].width,D[0].height,t),{buffer:t,width:D[0].width,height:D[0].height}},this.rolloverObjectViewport=function(e,t){q[1]=0;var i=this.idAtPixel(e,t,q);return this.rolloverObjectId(i,null,q[1])},this.rolloverObjectId=function(e,t,i){return ye(e,i,!1)},this.getRollOverDbId=function(){return re},this.getRollOverModelId=function(){return oe},this.rollOverModelId=function(e){return ye(1,e,!0)},this.setRollOverHighlightColor=function(e){e?f.uniforms.highlightColor.value.copy(e):f.uniforms.highlightColor.value.setRGB(1,1,1)},this.setDbIdForEdgeDetection=function(e,t){f.uniforms.edgeObjIDv4.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255,(e>>24&255)/255),f.uniforms.edgeModelIDv2.value.set((255&t)/255,(t>>8&255)/255)},this.setSpatialFilterForRollOver=function(e){if(!e||this.spatialFilterForRollOverSupported()){var t="SPATIAL_FILTER";f.material.defines[t]!==e&&(e&&""!==e?f.material.defines[t]=e:delete f.material.defines[t],f.material.needsUpdate=!0,f.uniforms.highlightIntensity.value=0,ne=performance.now())}else rt.warn("Spatial filter for mouse-over can only be used with depth target")},this.spatialFilterForRollOverSupported=function(){return me(Bb.Depth)},this.getBlendHighlightIntensity=function(){return this.getBlendPass().uniforms.highlightIntensity.value},this.setBlendHighlightIntensity=function(e){this.getBlendPass().uniforms.highlightIntensity.value=e},this.setEdgeColor=function(e){K.copy(e)},this.setSelectionColor=function(e){var t=new g.Color(e);t.r=Math.pow(t.r,2),t.g=Math.pow(t.g,2),t.b=Math.pow(t.b,2),f.uniforms.selectionColor.value.set(t),f.material.needsUpdate=!0,le.selectionColor=e},this.setUnitScale=function(e){V=e},this.getUnitScale=function(){return V},this.getBlendPass=function(){return f},this.getClearPass=function(){return a},this.getColorTarget=function(){return C},this.getIDTargets=function(){return D},this.getDepthTarget=function(){return x},this.getIdTarget=function(){return D[0]},this.getOverlayIdTarget=function(){return O},this.getDepthMaterial=function(){return t},this.getPostTarget=function(){return I},this.getEdgeMaterial=function(){return i},this.setCrossFade=function(e){ue=e},this.getCrossFade=function(){return ue},this.setOffscreenTarget=function(e){he=e},this.getOffscreenTarget=function(){return he},this.getNamedTarget=function(e){switch(e){case"color":return C;case"overlay":return T;case"id":return D[0];case"post1":return I;case"post2":return R;case"postdisplay":return P;case"ssao":return L;case"depth":return x}return null},this.getCurrentFramebuffer=function(){return e.getCurrentFramebuffer()},this.getConfig=function(){return{renderEdges:le.renderEdges,envMapBackground:le.envMapBg,envMap:a.material.envMap,envExposure:B,toneMapExposureBias:N,envRotation:this.getEnvRotation(),tonemapMethod:k,clearColor:X&&X.clone(),clearColorTop:!X&&a.uniforms.color1.value.clone(),clearColorBottom:!X&&a.uniforms.color2.value.clone(),clearAlpha:Y,useOverlayAlpha:Q,aoEnabled:this.getAOEnabled(),aoRadius:this.getAORadius(),aoIntensity:this.getAOIntensity(),twoSided:le.haveTwoSided,edgeColor:K.clone(),unitScale:this.getUnitScale(),is2D:!!f.material.defines.IS_2D,antialias:this.getAntialiasing(),idMaterial:n,selectionColor:le.selectionColor}},this.applyConfig=function(e){this.toggleEdges(e.renderEdges),this.toggleEnvMapBackground(e.envMapBackground),this.setCubeMap(e.envMap),this.setEnvExposure(e.envExposure),this.setTonemapExposureBias(e.toneMapExposureBias),this.setEnvRotation(e.envRotation),this.setTonemapMethod(e.tonemapMethod),this.toggleTwoSided(e.twoSided),this.setEdgeColor(e.edgeColor),this.setUnitScale(e.unitScale),e.clearColor?this.setClearColors(e.clearColor):this.setClearColors(e.clearColorTop,e.clearColorBottom),this.setClearAlpha(e.clearAlpha),this.useOverlayAlpha(e.useOverlayAlpha);var t=!!f.material.defines.IS_2D;e.is2D&&!t?this.enter2DMode(e.idMaterial,e.selectionColor):!e.is2D&&t&&(this.setSelectionColor(e.selectionColor),this.exit2DMode());var i=e.aoEnabled!=this.getAOEnabled(),n=e.antialias!=this.getAntialiasing();(i||n)&&this.initPostPipeline(e.aoEnabled,e.antialias)},this.targetToCanvas=function(t){var i=t.width,n=t.height,r=new Uint8Array(i*n*4);e.readRenderTargetPixels(t,0,0,i,n,r);var o=ox.createElement("canvas");o.width=i,o.height=n;var s,a=o.getContext("2d"),l=new Uint8ClampedArray(r);return s=new ImageData(l,i,n),a.putImageData(s,0,0),a.globalCompositeOperation="copy",a.translate(0,n),a.scale(1,-1),a.drawImage(o,0,0,i,n),a.globalCompositeOperation="source-over",{canvas:o,ctx:a}},this.resetRenderStats=function(){e.info.reset()},this.getRenderStats=function(){return Object.assign({},e.info.render)},this.startTimeQuery=function(){if(e.supportsDisjointTimerQuery()){const t=e.createDisjointTimerQuery();return e.beginDisjointTimerQuery(t),t}return null},this.stopTimeQuery=function(t){e.supportsDisjointTimerQuery()&&e.endDisjointTimerQuery(t)},this.getTimeResult=function(t,i){e.supportsDisjointTimerQuery()&&t&&e.getDisjointTimerQueryResultAsync(t,(n=>{e.destroyDisjointTimerQuery(t),i(n)}))}}lx.prototype=Object.create(ib.prototype);var cx=r(38383),ux=r.n(cx),hx=r(88368),dx=r.n(hx);const fx=134217728;let px=1;function mx(e){this.starts=new Map,this.ends=new Map,this.freeSize=0,this.addFreeBlock(0,e)}mx.prototype.addFreeBlock=function(e,t){let i=e,n=e+t;this.freeSize+=t;let r=this.starts.get(n);void 0!==r&&(this.starts.delete(n),n=r);let o=this.ends.get(i);void 0!==o&&(this.ends.delete(i),i=o),this.starts.set(i,n),this.ends.set(n,i)},mx.prototype.findBlock=function(e){let t,i;for(const[n,r]of this.starts)if(r-n>=e){t=n,i=r;break}if(void 0===t)return;this.freeSize-=e;let n=t+e;return this.starts.delete(t),n===i?this.ends.delete(i):(this.starts.set(n,i),this.ends.set(i,n)),t},mx.prototype.getFreeSize=function(){return this.freeSize};class gx{#It={};#Pt=[];#Lt=[];#Rt=[];#Dt;#Ot;#Bt=[];constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.#Dt=e,this.#Ot=t}#Nt(e,t,i,n){let r,o;for(let t=e.length-1;t>=0;t--)if(o=e[t].heap.findBlock(n),void 0!==o){r=e[t];break}if(void 0===o){r={buffer:this.#Dt.createBuffer({size:i,usage:t|GPUBufferUsage.COPY_DST}),heap:new mx(i),id:px++},e.push(r),o=r.heap.findBlock(n)}return{bufferEntry:r,offset:o,size:n}}vAlloc(e,t){let i=this.#It[t];return i||(i=[],this.#It[t]=i),this.#Nt(i,GPUBufferUsage.VERTEX,67108864,e)}iAlloc(e){return this.#Nt(this.#Pt,GPUBufferUsage.INDEX,16777216,e)}mAlloc(e){return this.#Nt(this.#Lt,GPUBufferUsage.STORAGE,33554432,e)}uAlloc(e){return this.#Nt(this.#Rt,GPUBufferUsage.STORAGE,fx,e)}#Ut(e,t,i){this.#Ot?this.#Bt.push({heap:e,offset:t,size:i}):e.addFreeBlock(t,i)}gFree(e){e.__gpuvb&&(this.#Ut(e.__gpuvb.heap,e.__gpuvbBaseVertex*e.vbstride*4,e.__gpuvbSize),e.__gpuvb=void 0),e.__gpuib&&(this.#Ut(e.__gpuib.heap,e.__gpuibBaseIndex<<e.__gpuibShift,e.__gpuibSize),e.__gpuib=void 0),e.__gpu=void 0}freeAlloc(e){this.#Ut(e.bufferEntry.heap,e.offset,e.size)}free(e,t,i){this.#Ut(e.heap,t,i)}flushFreeBlocks(){if(this.#Ot){for(const e of this.#Bt)e.heap.addFreeBlock(e.offset,e.size);this.#Bt=[]}}stats(){console.log(this.#It,this.#Pt)}computeUsedBytes(){let e=0,t=0;for(const i of Object.values(this.#It))for(const n of i)t+=n.buffer.size-n.heap.getFreeSize(),e+=n.buffer.size;let i=0;for(const t of this.#Pt)i+=t.buffer.size-t.heap.getFreeSize(),e+=t.buffer.size;let n=0;for(const t of this.#Lt)n+=t.buffer.size-t.heap.getFreeSize(),e+=t.buffer.size;let r=0;for(const t of this.#Rt)r+=t.buffer.size-t.heap.getFreeSize(),e+=t.buffer.size;return{vbBytes:t,ibBytes:i,mbBytes:n,ubBytes:r,totalBytes:t+i+n,totalBufferSize:e}}static maxUniformBufferSize(){return fx}}const vx=10485760;class yx{#kt;#Ft;#Vt;#Dt;#Gt;#zt;#Ht;#Wt=new Set;#jt=0;#qt=0;#Kt=!1;#Xt=0;#Yt=0;#Qt=0;constructor(e){const t=e.getDevice();this.#Dt=t,this.#Gt=new gx(t,!0),this.#zt=new gx(t,!0),this.#Ht=new _x(t)}static#Zt(e){const t=e.target;t.removeEventListener("dispose",yx.#Zt),yx.deallocateGeometry(t)}static deallocateGeometry(e){e.__gpu&&e.__gpu.gFree(e)}flushWrites(){this.#Ht.flushData()&&this.#Xt++}#$t(e,t,i,n,r){this.#qt+=r,this.#Yt++,this.#qt>vx&&(this.#Kt=!0),this.#Ht.writeData(e,t,i,n,r)||this.#Dt.queue.writeBuffer(e,t,i,n,r)}#Jt(e,t){var i;if(e.__gpu&&!e.vbNeedsUpdate)return;e.__gpu&&yx.deallocateGeometry(e),e.__gpu=t;let n=4*e.vbstride;const r=t.vAlloc(e.vb.byteLength,n),o=r.bufferEntry,s=r.offset/n;this.#$t(o.buffer,s*n,e.vb.buffer,e.vb.byteOffset,e.vb.byteLength),e.__gpuvb=o,e.__gpuvbSize=e.vb.byteLength,e.__gpuvbBaseVertex=s;let a=e.ib.byteLength;a%4&&(a+=2);let l=(null===(i=e.iblines)||void 0===i?void 0:i.byteLength)||0;l%4&&(l+=2);const c=a+l,u=t.iAlloc(c),h=u.bufferEntry,d=u.offset;if(e.ib.byteOffset+a>e.ib.buffer.byteLength){let t=new Uint16Array(new ArrayBuffer(a));t.set(e.ib),this.#$t(h.buffer,d,t.buffer,0,a)}else this.#$t(h.buffer,d,e.ib.buffer,e.ib.byteOffset,a);e.iblines&&this.#$t(h.buffer,d+a,e.iblines.buffer,e.iblines.byteOffset,l),e.__gpuib=h,e.ib instanceof Uint16Array?(e.__gpuibType="uint16",e.__gpuibShift=1,e.iblines&&(e.__gpuibLinesOffset=a/2)):e.ib instanceof Uint32Array?(e.__gpuibType="uint32",e.__gpuibShift=2,e.iblines&&(e.__gpuibLinesOffset=a/4)):console.warn("unknown index buffer type"),e.__gpuibBaseIndex=d>>e.__gpuibShift,e.__gpuibSize=c,e.vbNeedsUpdate=!1,t===this.#Gt&&e.addEventListener("dispose",yx.#Zt)}initUploaded(e){this.#Wt.has(e)&&(yx.deallocateGeometry(e),this.#Wt.delete(e)),this.#Jt(e,this.#Gt)}initStream(e){this.#Wt.has(e)||(this.#Jt(e,this.#zt),this.#Wt.add(e))}#ei(){for(const e of this.#Wt)e.__gpu===this.#zt&&yx.deallocateGeometry(e);this.#Wt.clear(),this.#zt.flushFreeBlocks()}cleanup(){this.#Gt.flushFreeBlocks(),this.#ei(),this.#Ht.cleanup(),this.#qt=0,this.#Kt=!1,this.#jt++,this.#Xt=0,this.#Yt=0,this.#Qt=0}stats(){const e=this.getTotalMemory()/1024/1024/1024;console.log(`Vertex Buffer Memory: ${e} GB`),console.log(`Bytes written: ${this.#qt/1024/1024} MB`),console.log(`Writes: ${this.#Yt}`),console.log(`Flushed times: ${this.#Xt}`),console.log(`Draws: ${this.#Qt}`)}getTotalMemory(){let e=0;return e+=this.#Gt.computeUsedBytes().totalBytes,e+=this.#zt.computeUsedBytes().totalBytes,e+=this.#Ht.totalAllocated(),e}canDraw(e){if(!Ji)return!0;if(!e.__gpuvb||e.vbNeedsUpdate){var t;const i=e.vb.byteLength+e.ib.byteLength+((null===(t=e.iblines)||void 0===t?void 0:t.byteLength)||0)+4;return this.canUpload(i)}return!0}canUpload(e){if(e>vx&&!this.#Kt)return!0;return vx-this.#qt>e}#ti(e,t){if(Ji){if(!t.__gpuvb||t.vbNeedsUpdate){if(!t.streamingDraw)return void console.error("Non-streaming-draw VB should have already been uploaded!");this.initStream(t)}}else t.__gpuvb&&!t.vbNeedsUpdate||this.initUploaded(t);const i=t.__gpuvb,n=t.__gpuib;i&&n?(this.#Qt++,this.#Vt!==e?(e.setVertexBuffer(0,i.buffer),this.#kt=i.buffer,e.setIndexBuffer(n.buffer,t.__gpuibType),this.#Ft=n.buffer,this.#Vt=e):(i.buffer!==this.#kt&&(e.setVertexBuffer(0,i.buffer),this.#kt=i.buffer),n.buffer!==this.#Ft&&(e.setIndexBuffer(n.buffer,t.__gpuibType),this.#Ft=n.buffer))):console.error("Still missing VB or IB when drawing!")}draw(e,t,i){this.#ti(e,t);const n=t.numInstances??1;e.drawIndexed(t.ib.length,n,t.__gpuibBaseIndex,t.__gpuvbBaseVertex,i)}drawEdges(e,t,i){if(!t.iblines)return;this.#ti(e,t);const n=t.numInstances??1;let r=t.__gpuibBaseIndex+t.__gpuibLinesOffset;e.drawIndexed(t.iblines.length,n,r,t.__gpuvbBaseVertex,i)}}const bx=1048576,xx=Math.ceil(10);class _x{#Dt;#ii=[];#ni;#ri=[];constructor(e){this.#Dt=e}#oi(){if(this.#ii.length)return this.#ii.shift();return{buffer:this.#Dt.createBuffer({size:bx,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),range:null,offset:0,size:bx}}#si(e){for(const t of this.#ri)if("mapped"==t.buffer.mapState&&t.size-t.offset>e)return t;if(this.#ri.length>=xx)return null;const t=this.#oi();return this.#ri.push(t),t}totalAllocated(){let e=0;for(const t of this.#ii)e+=t.size;for(const t of this.#ri)e+=t.size;return e}writeData(e,t,i,n,r){if(r>bx)return!1;const o=this.#si(r);if(!o)return!1;o.range||(o.range=o.buffer.getMappedRange());return new Uint8Array(o.range,o.offset,r).set(new Uint8Array(i,n,r)),this.#ni||(this.#ni=this.#Dt.createCommandEncoder()),this.#ni.copyBufferToBuffer(o.buffer,o.offset,e,t,r),o.offset+=r,!0}flushData(){if(!this.#ni)return!1;for(const e of this.#ri)"mapped"==e.buffer.mapState&&(e.buffer.unmap(),e.range=null);return this.#Dt.queue.submit([this.#ni.finish()]),this.#ni=null,!0}cleanup(){this.flushData();for(const e of this.#ri)"unmapped"==e.buffer.mapState&&e.buffer.mapAsync(GPUMapMode.WRITE).then((()=>{this.#ii.push({...e,offset:0})}));this.#ri=[]}}const Ex="\nstruct VertexOutput {\n\t@builtin(position) position: vec4f,\n\t@location(0) @interpolate(linear) vUv: vec2f\n}\n\n@vertex\nfn main(\n  @builtin(vertex_index) VertexIndex : u32\n) -> VertexOutput {\n\n\t//Instead of using a screen quad we use a large triangle -- this is slightly\n\t//faster (~6% measured in our specific case), due to better cache coherency. See this article:\n\t//http://michaldrobot.com/2014/04/01/gcn-execution-patterns-in-full-screen-passes/\n\n\tconst pos = array(\n\t\tvec2f(-1.0, -1.0),\n\t\tvec2f( 3.0, -1.0),\n\t\tvec2f(-1.0,  3.0),\n\t);\n\tconst uv = array(\n\t\tvec2f(0.0, 0.0),\n\t\tvec2f(2.0, 0.0),\n\t\tvec2f(0.0, 2.0),\n\t);\n\n\tvar output: VertexOutput;\n\toutput.position = vec4f(pos[VertexIndex], 0.0, 1.0);\n\toutput.vUv = uv[VertexIndex];\n\n\treturn output;\n}\n\n@vertex\nfn mainFlipY(\n  @builtin(vertex_index) VertexIndex : u32\n) -> VertexOutput {\n\n\t//Instead of using a screen quad we use a large triangle -- this is slightly\n\t//faster (~6% measured in our specific case), due to better cache coherency. See this article:\n\t//http://michaldrobot.com/2014/04/01/gcn-execution-patterns-in-full-screen-passes/\n\n\tconst pos = array(\n\t\tvec2f(-1.0, -1.0),\n\t\tvec2f( 3.0, -1.0),\n\t\tvec2f(-1.0,  3.0),\n\t);\n\tconst uv = array(\n\t\tvec2f(0.0, 1.0),\n\t\tvec2f(2.0, 1.0),\n\t\tvec2f(0.0, -1.0),\n\t);\n\n\tvar output: VertexOutput;\n\toutput.position = vec4f(pos[VertexIndex], 0.0, 1.0);\n\toutput.vUv = uv[VertexIndex];\n\n\treturn output;\n}",Sx="//See documentation in Fxaa3_11.h\n//This shader uses the CONSOLE PC version of the algorithm, adapted for WebGPU.\n//Since WGSL doesn't currently allow texture reads from non-uniform code paths,\n//a small adaptation is necessary to avoid the early out\n\ndiagnostic(off, derivative_uniformity);\n\n@group(0) @binding(0) var tex: texture_2d<f32>;\n@group(0) @binding(1) var smpl: sampler;\n\n@id(0) override invWidth = (1.0/1024.0);\n@id(1) override invHeight = (1.0/1024.0);\n\nfn FxaaTexTop(p: vec2f) -> vec4f {\n\treturn textureSample(tex, smpl, p);\n}\n\nfn FxaaLuma(rgb: vec3f) -> f32 {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\n\n/*============================================================================\n\n\t\t\t\t\t\t FXAA3 CONSOLE - PC VERSION\n\n------------------------------------------------------------------------------\nInstead of using this on PC, I'd suggest just using FXAA Quality with\n\t#define FXAA_QUALITY__PRESET 10\nOr\n\t#define FXAA_QUALITY__PRESET 20\nEither are higher qualilty and almost as fast as this on modern PC GPUs.\n============================================================================*/\n\nconst fxaaConsoleEdgeThresholdMin = 0.05;\nconst fxaaConsoleEdgeThreshold = 0.125;\nconst fxaaConsoleEdgeSharpness = 8.0;\nconst fxaaConsoleRcpFrameOpt = 0.33; //0.33 (sharper) or 0.5 (default) // This affects sub-pixel AA quality and inversely sharpness.\nconst fxaaConsoleRcpFrameOpt2 = 2.0;\n\n/*--------------------------------------------------------------------------*/\n@fragment fn FxaaPixelShader(\n\t@builtin(position) coord : vec4f,\n\t@location(0) @interpolate(linear) pos: vec2f\n) -> @location(0) vec4f {\n\n\tvar invDim = vec2f(invWidth, invHeight);\n\n/*--------------------------------------------------------------------------*/\n\t// Compute Luma\n\tvar lumaNw = FxaaLuma(textureSample(tex, smpl, pos, vec2i(-1,-1)).rgb);\n\tvar lumaSw = FxaaLuma(textureSample(tex, smpl, pos, vec2i(-1, 1)).rgb);\n\tvar lumaNe = FxaaLuma(textureSample(tex, smpl, pos, vec2i( 1,-1)).rgb);\n\tvar lumaSe = FxaaLuma(textureSample(tex, smpl, pos, vec2i( 1, 1)).rgb);\n/*--------------------------------------------------------------------------*/\n\tvar rgbaM = FxaaTexTop(pos);\n\tvar lumaM = FxaaLuma(rgbaM.rgb);\n/*--------------------------------------------------------------------------*/\n\tvar lumaMaxNwSw = max(lumaNw, lumaSw);\n\tlumaNe += 1.0/384.0;\n\tvar lumaMinNwSw = min(lumaNw, lumaSw);\n/*--------------------------------------------------------------------------*/\n\tvar lumaMaxNeSe = max(lumaNe, lumaSe);\n\tvar lumaMinNeSe = min(lumaNe, lumaSe);\n/*--------------------------------------------------------------------------*/\n\tvar lumaMax = max(lumaMaxNeSe, lumaMaxNwSw);\n\tvar lumaMin = min(lumaMinNeSe, lumaMinNwSw);\n/*--------------------------------------------------------------------------*/\n\tvar lumaMaxScaled = lumaMax * fxaaConsoleEdgeThreshold;\n/*--------------------------------------------------------------------------*/\n\tvar lumaMinM = min(lumaMin, lumaM);\n\tvar lumaMaxScaledClamped = max(fxaaConsoleEdgeThresholdMin, lumaMaxScaled);\n\tvar lumaMaxM = max(lumaMax, lumaM);\n\tvar dirSwMinusNe = lumaSw - lumaNe;\n\tvar lumaMaxSubMinM = lumaMaxM - lumaMinM;\n\tvar dirSeMinusNw = lumaSe - lumaNw;\n\tvar earlyOut = 0.0;\n\tif(lumaMaxSubMinM < lumaMaxScaledClamped) {\n\t\treturn rgbaM;\n\t}\n/*--------------------------------------------------------------------------*/\n\tvar dir: vec2f;\n\tdir.x = dirSwMinusNe + dirSeMinusNw;\n\tdir.y = dirSwMinusNe - dirSeMinusNw;\n/*--------------------------------------------------------------------------*/\n\tvar dir1 = normalize(dir.xy);\n\tvar rcpFrameOpt = fxaaConsoleRcpFrameOpt * invDim;\n\tvar rgbN1 = FxaaTexTop(pos - dir1 * rcpFrameOpt).rgb;\n\tvar rgbP1 = FxaaTexTop(pos + dir1 * rcpFrameOpt).rgb;\n/*--------------------------------------------------------------------------*/\n\tvar dirAbsMinTimesC = min(abs(dir1.x), abs(dir1.y)) * fxaaConsoleEdgeSharpness;\n\tvar dir2 = clamp(dir1.xy / dirAbsMinTimesC, vec2f(-2.0), vec2f(2.0));\n/*--------------------------------------------------------------------------*/\n\tvar rcpFrameOpt2 = fxaaConsoleRcpFrameOpt2 * invDim;\n\tvar rgbN2 = FxaaTexTop(pos - dir2 * rcpFrameOpt2).rgb;\n\tvar rgbP2 = FxaaTexTop(pos + dir2 * rcpFrameOpt2).rgb;\n/*--------------------------------------------------------------------------*/\n\tvar rgbA = rgbN1 + rgbP1;\n\tvar rgbB = ((rgbN2 + rgbP2) * 0.25) + (rgbA * 0.25);\n/*--------------------------------------------------------------------------*/\n\tvar lumaB = FxaaLuma(rgbB);\n\tvar twoTap = (lumaB < lumaMin) || (lumaB > lumaMax);\n\tif(twoTap) {\n\t\treturn vec4f(rgbA * 0.5, rgbaM.a);\n\t} else {\n\t\treturn vec4f(rgbB, rgbaM.a);\n\t}\n}\n/*==========================================================================*/\n\n";class Ax{#Dt;#ai;#li;#ci;#ui;#hi;#di;#fi=!1;#pi;#mi;#gi=!1;constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.#Dt=e,this.#pi=r||"",this.#gi=o;let s=t,a=t%4;a&&(s+=4-a),this.#ai=new Float32Array(s),this.#li=new Int32Array(this.#ai.buffer);let l=0;i&&(l|=GPUShaderStage.FRAGMENT),n&&(l|=GPUShaderStage.VERTEX),this.#di=l,this.#vi()}#vi(){!this.#ci&&this.#Dt&&(this.#gi&&!this.#mi&&(this.#mi=this.#Dt.createBuffer({size:this.#ai.byteLength,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})),this.#ci=this.#Dt.createBuffer({label:this.#pi,size:this.#ai.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST|(this.#gi?GPUBufferUsage.COPY_SRC:0)}),this.#ui=this.#Dt.createBindGroupLayout({entries:[{binding:0,visibility:this.#di,buffer:{}}]}),this.#hi=this.#Dt.createBindGroup({layout:this.#ui,entries:[{binding:0,resource:{buffer:this.#ci}}]}))}setDevice(e){this.#Dt=e,this.#vi()}getLayout(){return this.#ui}getBindGroup(){return this.#hi}getVisibility(){return this.#di}getBuffer(){return this.#ci}setFloat(e,t){this.#ai[e]=t}getFloat(e){return this.#ai[e]}setFloat2(e,t,i){this.#ai[e]=t,this.#ai[e+1]=i}setFloat4(e,t,i,n,r){this.#ai[e]=t,this.#ai[e+1]=i,this.#ai[e+2]=n,this.#ai[e+3]=r}setVector3(e,t){this.#ai[e]=t.x,this.#ai[e+1]=t.y,this.#ai[e+2]=t.z}setVector4(e,t){this.#ai[e]=t.x,this.#ai[e+1]=t.y,this.#ai[e+2]=t.z,this.#ai[e+3]=t.w}setColor(e,t,i){this.#ai[e]=t.r,this.#ai[e+1]=t.g,this.#ai[e+2]=t.b,void 0!==i&&(this.#ai[e+3]=i)}setMatrix3x3(e,t){for(let i=0;i<3;i++)for(let n=0;n<3;n++)this.#ai[e+n+4*i]=t[n+3*i]}setMatrix4x4(e,t){this.#ai.set(t,e)}setInt=function(e,t){this.#li[e]=t};getInt(e){return this.#li[e]}setBuffer(e,t){this.#ai.set(t,e)}upload(){this.#Dt.queue.writeBuffer(this.#ci,0,this.#ai.buffer,0,this.#ai.byteLength)}copyBufferToRead(e){this.#mi&&e.copyBufferToBuffer(this.#ci,0,this.#mi,0,this.#ci.size)}async download(){if(!this.#mi)return new ArrayBuffer;await this.#mi.mapAsync(GPUMapMode.READ,0);const e=this.#mi.getMappedRange().slice(0);return this.#mi.unmap(),e}}const wx="struct BlendUniforms {\n    highlightColor: vec4f, // 0, 1, 2, 3,\n    selectionColor: vec4f, // 4, 5, 6, 7\n\n    objectId: i32,      //8\n    modelId: i32,       //9\n    glowFlagInt: i32,   //10\n    glowCompFunc: i32,  //11\n    highlightIntensity: f32, //12\n    useAO: i32,         //13\n    aoBias: f32,         //14\n    edgeObjectId: i32,   //15\n    edgeModelId: i32,    //16\n    useOverlay: i32,      //17 //TODO: combine with useAO into single bitmask uniform\n    zFloorRange: vec2f,  //18, 19\n    is2d: i32, // 20\n\n    //Enable these if the forward pass renders in HDR-linear target and the Blend shader is doing the tone mapping\n    //exposureBias: f32,\n    //toneMapMethod: i32,\n}\n@group($0) @binding(0) var<uniform> u : BlendUniforms;\n",Cx="struct UnProjectUniforms {\n    modelViewInverse: mat4x4<f32>,\n    projectionInverse: mat4x4<f32>,\n    cameraNear: f32,\n    cameraFar: f32,\n    isPerspectiveCamera: f32\n}\n@group($0) @binding(0) var<uniform> u2 : UnProjectUniforms;\n";const Tx=0,Mx=4,Ix=8,Px=9,Lx=10,Rx=11,Dx=12,Ox=13,Bx=14,Nx=15,Ux=16,kx=17,Fx=18,Vx=20,Gx=21;class zx extends Ax{constructor(){super(null,Gx,!0,!1,"blend-settings")}init(e){this.setDevice(e),this.setAOEnabled(!1),this.setHighlightObjectId(0),this.setHighlightModelId(0),this.setHighlightIntensity(1),this.setRolloverHighlightColor(new THREE.Color(1,1,1)),this.setEdgeHighlightObjectId(0,0),this.setSelectionColor(new THREE.Color(0,0,0)),this.setUseOverlay(!1),this.setIs2d(!1)}setAOEnabled(e){this.setInt(Ox,e?1:0)}setHighlightObjectId(e){this.setInt(Ix,e)}setHighlightModelId(e){this.setInt(Px,e)}setHighlightIntensity(e){this.setFloat(Dx,e)}getHighlightIntensity(){return this.getFloat(Dx)}setRolloverHighlightColor(e){this.setColor(Tx,e,1)}setEdgeHighlightObjectId(e,t){this.setInt(Nx,e),this.setInt(Ux,t)}setGlowFlag(e){this.setInt(Lx,e)}setGlowOptions(e,t){this.setInt(Rx,t)}setAOBias(e){this.setFloat(Bx,e)}getAOBias(){return this.getFloat(Bx)}setSelectionColor(e){this.setColor(Mx,e,1)}setUseOverlay(e){this.setInt(kx,e?1:0)}setZRange(e,t){this.setFloat2(Fx,e,t)}setIs2d(e){this.setInt(Vx,e?1:0)}}function Hx(e){return Im(Cx,e+0||0)}class Wx extends Ax{constructor(){super(null,36,!0,!1)}init(e){this.setDevice(e)}setCamera(e){const t=e.projectionMatrix.clone().invert();this.setMatrix4x4(0,e.matrixWorld.elements),this.setMatrix4x4(16,t.elements),this.setFloat2(32,e.near,e.far),this.setFloat(34,e.isPerspective)}}const jx="//post-gamma luminance\nfn luminance_post(rgb: vec3f) -> f32 {\n\treturn dot(rgb, vec3f(0.299, 0.587, 0.114));\n}\n\n//pre-gamma luminance\nfn luminance_pre(rgb: vec3f) -> f32 {\n\treturn dot(rgb, vec3f(0.212671, 0.715160, 0.072169));\n}\n\n\nfn xyz2rgb(xyz: vec3f) -> vec3f {\n\t//XYZ -> RGB conversion matrix using HDTV constants\n\tvar R = vec3f( 3.240479, -1.537150, -0.498535);\n\tvar G = vec3f(-0.969256,  1.875992,  0.041556);\n\tvar B = vec3f( 0.055648, -0.204043,  1.057311);\n\n\tvar rgb: vec3f;\n\trgb.b = dot(xyz, B);\n\trgb.g = dot(xyz, G);\n\trgb.r = dot(xyz, R);\n\n\treturn rgb;\n}\n\nfn rgb2xyz(rgb: vec3f) -> vec3f {\n\t//RGB -> XYZ conversion matrix using HDTV constants\n\tvar X = vec3f(0.412453, 0.35758, 0.180423);\n\tvar Y = vec3f(0.212671, 0.71516, 0.0721688);\n\tvar Z = vec3f(0.0193338, 0.119194, 0.950227);\n\n\tvar xyz: vec3f;\n\txyz.x = dot(rgb, X);\n\txyz.y = dot(rgb, Y);\n\txyz.z = dot(rgb, Z);\n\n\treturn xyz;\n}\n\nfn xyz2xyY(xyz: vec3f) -> vec3f {\n\tvar sum = xyz.x + xyz.y + xyz.z;\n\n\t//Note in case of division by 0, the hardware\n\t//should output zero for sum, so we are still ok with the result\n\tsum = 1.0 / sum;\n\n\tvar xyY: vec3f;\n\txyY.z = xyz.y;\n\txyY.x = xyz.x * sum;\n\txyY.y = xyz.y * sum;\n\n\treturn xyY;\n}\n\nfn xyY2xyz(xyY: vec3f) -> vec3f {\n\tvar x = xyY.x;\n\tvar y = xyY.y;\n\tvar Y = xyY.z;\n\n\tvar xyz: vec3f;\n\txyz.y = Y;\n\txyz.x = x * (Y / y);\n\txyz.z = (1.0 - x - y) * (Y / y);\n\n\treturn xyz;\n}\n\n\n\n//OGS/RaaS Cannon tonemappong with ColorPerserving enabled.\nfn toneMapCanon_T(x: f32) -> f32\n{\n\t// this function fits the measured Canon sigmoid *without gamma correction* through 0.0\n\tvar xpow = pow(x, 1.60525727);\n\tvar tmp = ((1.05542877*4.68037409)*xpow) / (4.68037409*xpow + 1.0);\n\treturn clamp(tmp, 0.0, 1.0);\n}\n\n\nconst Shift = 1.0 / 0.18;\n\n//Best fit of John Hable's generalized filmic function parameters to the Canon curve\n//This is a significantly better and cheaper to compute fit than the power and polynomial\n//least squares fits from OGS/RaaS (which have larger max and average error, and also go negative near\n//the origin).\nfn toneMapCanonFilmic_NoGamma(y: f32) -> f32 {\n\n\t//This extra exposure by 1.0/0.18 mimics what is also done in OGS's implementation\n\t//and the curve fit was done with this scale in mind.\n\tvar x = y;\n\tx *= Shift;\n\n\tconst A = 0.2; //shoulder strength\n\tconst B = 0.34; //linear strength\n\tconst C = 0.002; //linear angle\n\tconst D = 1.68; //toe strength\n\tconst E = 0.0005; //toe numerator\n\tconst F = 0.252; //toe denominator (E/F = toe angle)\n\tconst scale = 1.0/0.833837;\n\n\treturn (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;\n}\n\n\n//Same as above but with 2.2 gamma built into the fit and working on the\n//whole RGB triplet at once (i.e. non color preserving version).\nfn toneMapCanonFilmic_WithGamma(y: vec3f) -> vec3f {\n\n\t//This extra exposure by 1.0/0.18 mimics what is also done in OGS's implementation\n\t//and the curve fit was done with this scale in mind.\n\tvar x = y;\n\tx *= Shift;\n\n\t//Best overall error params\n\t/*\n\tconst float A = 0.2;\n\tconst float B = 0.23;\n\tconst float C = 0.147;\n\tconst float D = 0.26;\n\t//const float E = 0.0;\n\tconst float F = 0.22;\n\tconst float scale = 1.0/0.900202;\n\t*/\n\n\t//Best max deviation params\n\tconst A = 0.27;\n\tconst B = 0.29;\n\tconst C = 0.052;\n\tconst D = 0.2;\n\t//const E = 0.0;\n\tconst F = 0.18;\n\tconst scale = 1.0/0.897105;\n\n\treturn (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;\n}\n\n\nfn toneMapCanonOGS_WithGamma_WithColorPerserving(x: vec3f) -> vec3f {\n\tvar outColor = x.rgb;\n\toutColor = min(outColor, vec3f(3.0));\n\tvar inLum = luminance_pre(outColor);\n\tif (inLum > 0.0) {\n\t\tvar outLum = toneMapCanon_T(inLum);\n\t\toutColor = outColor * (outLum / inLum);\n\t\toutColor = clamp(outColor, vec3f(0.0), vec3f(1.0));\n\t}\n\tconst gamma = 1.0/2.2;\n\toutColor = pow(outColor, vec3f(gamma));\n\treturn outColor;\n}\n",qx="\n// Note: This code was initially ported from WebGL replacing GLSL \"mod\" with\n// WGSL '%' but these use the floored vs truncated modulo respectively.\n// See https://en.wikipedia.org/wiki/Modulo#Variants_of_the_definition\n// and WGSL issue: https://github.com/gpuweb/gpuweb/issues/3987\nfn glslMod(x: f32, y: f32) -> f32 {\n\treturn x - y * floor(x / y);\n}\n\nfn calculateHatchPatternRaw(hatchSlopeGL: f32, hatchPeriod: f32, coord: vec2f ) -> f32 {\n\t//Note that the slope is inverted from the WebGL version because WebGPU is Y-down.\n\t//Only the hatch direction matches WebGL as an exact match requires mapping coord.y -> ScreenHeight - coord.y\n\tlet hatchSlope : f32 = -hatchSlopeGL;\n\n\tif (abs(hatchSlope) <= 1.0) {\n\t\t// Shallow slopes repeat with period in y direction.\n\t\tlet hatchPhase : f32 = coord.y - hatchSlope * coord.x;\n\t\tlet dist : f32 = abs(glslMod(hatchPhase, hatchPeriod));\n\t\treturn dist;\n\t} else {\n\t\t// Steep slopes repeat with period in x direction.\n\t\tlet hatchPhase : f32 = - coord.y / hatchSlope + coord.x;\n\t\tlet dist : f32 = abs(glslMod(hatchPhase, hatchPeriod));\n\t\treturn dist;\n\t}\n}\n\nfn calculateHatchPattern(hatchParams: vec2f, coord: vec2f, fragColor: vec4f, hatchTintColor: vec3f, hatchTintIntensity: f32 ) -> vec4f {\n\n\tvar dist = calculateHatchPatternRaw(hatchParams.x, hatchParams.y, coord);\n\tvar outColor: vec4f;\n\n\tif (dist < 1.0) {\n\t\toutColor = vec4f(0.0,0.0,0.0,1.0);\n\t} else {\n\t\toutColor = vec4f(mix(fragColor.xyz, hatchTintColor, hatchTintIntensity), fragColor.a);\n\t}\n\n\treturn outColor;\n}\n",Kx="@group(0) @binding(0) var tColor: texture_2d<f32>;\n@group(0) @binding(1) var tOverlay: texture_2d<f32>;\n@group(0) @binding(2) var tID: texture_2d<u32>;\n@group(0) @binding(3) var tID2: texture_2d<u32>;\n//@group(0) @binding(4) var tID3: texture_2d<u32>;\n@group(0) @binding(4) var tAO: texture_2d<f32>;\n@group(0) @binding(5) var tDepth: texture_depth_2d; // Expecting the actual depth buffer (no special g-buffer)\n\n$blendUniforms\n$unprojectUniforms // required by spatialFilter\n$tonemap\n$hatch\n$spatialFilter\n\nfn toInt(v: vec4u) -> i32 {\n    return i32(v.r | (v.g << 8) | (v.b << 16) | (v.a << 24));\n}\n\n// modify rgb by applying rollOver highlighting.\n// filterValue is an additonal multiplier for highlighting intensity. (always 1.0 if no spatial filter is used)\nfn applyHighlighting(rgb: vec3f) -> vec3f {\n    if (bool(u.is2d)) {\n        // Tint yellow\n        return mix(rgb, vec3(1, 1, 0), u.highlightIntensity * 0.25);\n    } else {\n        return rgb + u.highlightColor.rgb * u.highlightIntensity * 0.20;\n    }\n}\n\n//Color key based edge detection for selection set\nfn isSelectionColor(C : vec3f) -> bool {\n\n    // //Simple check that assumes the blue selection color\n    // if (C.b > C.g && C.b > C.r) {\n    //     return true;\n    // }\n    //\n    // return false;\n\n    var minS = min(u.selectionColor.r, min(u.selectionColor.g, u.selectionColor.b));\n    var maxS = max(u.selectionColor.r, max(u.selectionColor.g, u.selectionColor.b));\n    var satS = maxS - minS;\n    var minC = min(C.r, min(C.g, C.b));\n    var maxC = max(C.r, max(C.g, C.b));\n    var satC = maxC - minC;\n    // If one color has low saturation, they only match if both have low saturation.\n    if (satC < .01 || satS < .01) {\n        return false;\n    }\n\n    // Now compare the hue. We don't convert to a numeric hue, just\n    // the vector representation.\n    var S = (u.selectionColor.rgb - minS) / satS;\n    var H = (C - minC) / satC;\n    var D = H - S;\n    var eps = .15;\n    // We want to match the hue of selectionColor and C, but if the max component of C is\n    // 1, then it may have been clamped which will change the hue. In this case the\n    // middle colors should be higher than we expect, so we just make sure that\n    // all of C's components are larger than selectionColor's.\n    return (abs(D.r) + abs(D.g) + abs(D.b) < eps)\n        || (maxC >= (1.0 - eps) && D.r >= -eps && D.g >= -eps && D.b >= -eps);\n}\n\nfn sampleTargetSS(coord: vec2i, offset: vec2i) -> vec4f {\n    return textureLoad(tOverlay, coord + offset, 0);\n}\n\nstruct SumNeighbors {\n    hasEdge: i32,\n    selectionPixel: vec4f,\n    maxAlpha: f32\n}\nvar<private> sum: SumNeighbors;\n\nfn checkEdgeSelection(ssCoord: vec2i, offX: i32, offY: i32) {\n    var c = sampleTargetSS( ssCoord, vec2i(offX, offY));\n    sum.maxAlpha = max(sum.maxAlpha, c.a);\n    if (c.a <= 0.0) {\n        sum.hasEdge++;\n    }\n}\n\n// search neighbors to detect change in pixel coverage\n// the current pixel is outline if is selection && has empty neighbors\nfn overlayEdgeDetect(ssCoord: vec2i) -> vec4f {\n\n    var center = sampleTargetSS(ssCoord, vec2i(0));\n    var paintOutline = false;\n\n    //The sampled color has pre-multiplied alpha which we undo for the selection check.\n    if (center.a > 0.0 && isSelectionColor(center.rgb / center.a)) {\n        checkEdgeSelection(ssCoord, -1,-1);\n        checkEdgeSelection(ssCoord,  0,-1);\n        checkEdgeSelection(ssCoord,  1,-1);\n\n        checkEdgeSelection(ssCoord, -1, 0);\n        checkEdgeSelection(ssCoord,  1, 0);\n\n        checkEdgeSelection(ssCoord, -1, 1);\n        checkEdgeSelection(ssCoord,  0, 1);\n        checkEdgeSelection(ssCoord,  1, 1);\n\n        checkEdgeSelection(ssCoord, -2,-2);\n        checkEdgeSelection(ssCoord, -1,-2);\n        checkEdgeSelection(ssCoord,  0,-2);\n        checkEdgeSelection(ssCoord,  1,-2);\n        checkEdgeSelection(ssCoord,  2,-2);\n\n        checkEdgeSelection(ssCoord, -2,2);\n        checkEdgeSelection(ssCoord, -1,2);\n        checkEdgeSelection(ssCoord,  0,2);\n        checkEdgeSelection(ssCoord,  1,2);\n        checkEdgeSelection(ssCoord,  2,2);\n\n        checkEdgeSelection(ssCoord, -2, -2);\n        checkEdgeSelection(ssCoord, -2, -1);\n        checkEdgeSelection(ssCoord, -2,  0);\n        checkEdgeSelection(ssCoord, -2,  1);\n        checkEdgeSelection(ssCoord, -2,  2);\n\n        checkEdgeSelection(ssCoord, 2, -2);\n        checkEdgeSelection(ssCoord, 2, -1);\n        checkEdgeSelection(ssCoord, 2,  0);\n        checkEdgeSelection(ssCoord, 2,  1);\n        checkEdgeSelection(ssCoord, 2,  2);\n\n        if (sum.hasEdge != 0) {               // if has empty neighbors\n            paintOutline = true;\n        } else {\n            center.a = -center.a;        // special flag marking inside pixel\n        }\n    }\n\n    // calculate outline color\n    if (paintOutline) {\n        var rgb = mix(sqrt(u.selectionColor.rgb), vec3f(1.0), 0.65);\n        var a = 1.0; //make edge fully opaque so it's easier to see\n        center = vec4f(rgb, a);\n    }\n\n    return center;\n}\n\nfn glowComp(c: i32) -> bool {\n    if (u.glowCompFunc == 0) {\n        return c == u.glowFlagInt;\n    } else {\n        return (c != -1) && ((c & u.glowFlagInt) != 0);\n    }\n}\n\nvar<private> hasEdgeGlow: i32;\n\nfn checkEdgeId(ssCoord: vec2i, offX: i32, offY: i32, W: i32) {\n    //See corresponding comment in UberShader. We currently don't have enough room\n    //to encode the object flags in a separate render target, so we put half of it\n    //in the upper 2 bytes of the modelId render target (tID2). We need to find a solution\n    //for the remaining two bytes, or an alternative solution that doesn't require the extra\n    //target during the main pass (e.g. lookup into data texture by model/object ID which we already know)\n    var c = toInt(textureLoad(tID2, ssCoord + vec2i(offX, offY), 0)) >> 16;\n    if (glowComp(c)) {\n        hasEdgeGlow += W;\n    }\n}\n\nconst glowColor = vec3f(1.0,1.0,0.0);\n\n// search 3x3 neighbors\n// the current pixel is outline if\n// (is selection && has empty neighbor) || (pixel is empty && has selection neighbor)\nfn glowEdgeDetect(ssCoord: vec2i) -> vec4f {\n\n    hasEdgeGlow = 0;\n\n    var paintOutline = false;\n\n    checkEdgeId(ssCoord, -1,-1, 2);\n    checkEdgeId(ssCoord, 0,-1, 4);\n    checkEdgeId(ssCoord, 1,-1, 2);\n    checkEdgeId(ssCoord,-1, 0, 4);\n    checkEdgeId(ssCoord, 1, 0, 4);\n    checkEdgeId(ssCoord,-1, 1, 2);\n    checkEdgeId(ssCoord, 0, 1, 4);\n    checkEdgeId(ssCoord, 1, 1, 2);\n\n    checkEdgeId(ssCoord, 2, -1, 1);\n    checkEdgeId(ssCoord, 2, 0, 1);\n    checkEdgeId(ssCoord, 2, 1, 1);\n\n    checkEdgeId(ssCoord, -2, -1, 1);\n    checkEdgeId(ssCoord, -2,  0, 1);\n    checkEdgeId(ssCoord, -2,  1, 1);\n\n    checkEdgeId(ssCoord, -1, 2, 1);\n    checkEdgeId(ssCoord, 0, 2, 1);\n    checkEdgeId(ssCoord, 1, 2, 1);\n\n    checkEdgeId(ssCoord, -1, -2, 1);\n    checkEdgeId(ssCoord, 0, -2, 1);\n    checkEdgeId(ssCoord, 1, -2, 1);\n\n    if (hasEdgeGlow != 0) {              // if has object neighbors\n        paintOutline = true;\n    }\n\n    // calculate outline color\n    if (paintOutline) {\n        return vec4f(glowColor.rgb, min(1.0, f32(hasEdgeGlow)/6.0));\n    }\n\n    return vec4f(0.0);\n}\n\n@fragment\nfn main(\n    @builtin(position) coord : vec4f,\n    @location(0) @interpolate(linear) vUv: vec2f\n) -> @location(0) vec4f {\n\n    var pixelCoord = vec2i(floor(coord.xy));\n\n    var outColor = textureLoad(tColor, pixelCoord, 0);\n\n    if (u.useAO != 0) {\n        var ao = textureLoad(tAO, pixelCoord, 0).r;\n        outColor = vec4f(sqrt(outColor.rgb * outColor.rgb * min(1.0, ao+ u.aoBias)), outColor.a);\n    }\n\n    if (u.useOverlay != 0) {\n        //composite in the overlays texture\n        var overlay = overlayEdgeDetect(pixelCoord);\n\n        // Negative alpha signals the inside overlay condition, as above.\n        if (overlay.a < 0.0) {\n            overlay.a = -overlay.a;\n\n            if (overlay.a >= 0.99) {\n                //Blend the overlay color with the luminance of the underlying\n                //pixel so that we do not lose detail from any underlying texture map\n                overlay.a = 0.75;\n                outColor = vec4f(vec3f(luminance_post(outColor.rgb)), outColor.a);\n            }\n        }\n\n        // For 3D, apply some hard-wired gamma correction.\n        // Todo: When embedding 2D in 3D scenes, the gamma-correction will alter the 2D colors as well.\n        //outColor = vec4f(outColor.rgb * (1.0 - overlay.a) + sqrt(overlay.rgb * overlay.a), outColor.a);\n        //WEBGPU: do not gamma the overlay because it's currently using the UberShader that applies tone mapping + gamma in the pixel shader\n        //Note we use pre-multiplied blend function here, because that's how our blend function is set up\n        //to put pixels into the color targets\n        outColor = vec4f(outColor.rgb * (1.0 - overlay.a) + overlay.rgb, outColor.a);\n\n        //if (useOverlayAlpha != 0) {\n            // In case texel (diffuse color) has 0 alpha, but overlay has something to render, make sure to update the alpha accordingly.\n            outColor = vec4f(outColor.rgb, outColor.a + overlay.a * (1.0 - outColor.a));\n        //}\n\n        //test only\n        //outColor = overlay;\n    }\n\n    let objectId = toInt(textureLoad(tID, pixelCoord, 0));\n\n    //rollover highlighting\n    if (u.objectId != 0) {\n        var modelId = toInt(textureLoad(tID2, pixelCoord, 0)) & 0xffff;\n\n        if (u.objectId == objectId && u.modelId == modelId) {\n            outColor = vec4f(applyHighlighting(outColor.rgb), outColor.a);\n        }\n    }\n\n#if $spatialFilter\n    // Floor-based highlighting (FloorSelector of the AEC levels extensions).\n    // Only highlight fragments that are associated to object and exclude, e.g., background fragments.\n    let inZRange = f32(objectId != 0) * isInZRange(coord.xy);\n    outColor = vec4f(mix(outColor.rgb, applyHighlighting(outColor.rgb), inZRange), outColor.a);\n#endif\n\n    //glow effect\n    if (u.glowFlagInt != 0) {\n\n        var flagAtPixel = toInt(textureLoad(tID2, pixelCoord, 0)) >> 16;\n\n        if (!glowComp(flagAtPixel)) {\n            var outline = glowEdgeDetect(pixelCoord);\n            outline.a *= u.highlightIntensity;\n            outColor = vec4f(outColor.rgb * (1.0 - outline.a) + outline.rgb * outline.a, outColor.a);\n        } else {\n            var dist = calculateHatchPatternRaw(1.0, 10.0, coord.xy);\n            var intensity : f32;\n            if (dist <= 0.5) {\n                intensity = 1.0;\n            } else {\n                intensity = 0.10;\n            }\n            //float intensity = 0.1;\n            outColor = vec4f(mix(outColor.rgb, glowColor, intensity * u.highlightIntensity), outColor.a);\n        }\n    }\n\n    return outColor;\n}\n",Xx="// Spatial Filter, e.g., for floor-based highlighting (FloorSelector of the AEC levels extensions).\nfn isInZRange(coord_xy: vec2f) -> f32 {\n    let tDepth_size: vec2f = vec2f(textureDimensions(tDepth, 0));\n    let p_screen = coord_xy / vec2f(tDepth_size); // vUv.xy\n    // The non-linear depth from rasterization in ndc, i.e., [ 0, +1 ] (WebGPU) not [ -1, +1 ] (WebGL)\n    let depth_raw = textureLoad(tDepth, vec2i(floor(coord_xy)), 0);\n    // if (depth_raw >= 1.0) { discard; }\n    var p_world: vec3f;\n    if (u2.isPerspectiveCamera != 0) {\n        p_world = worldFromPerspectiveDepth(p_screen.xy, depth_raw);\n    } else {\n        p_world = worldFromOrthographicDepth(p_screen.xy, depth_raw);\n    }\n    return step(u.zFloorRange[0], p_world.z) * step(p_world.z, u.zFloorRange[1]);\n}\n\nfn linearizePerspectiveDepth(depth_raw: f32) -> f32 {\n    // REFERENCE:\n    // let near = u2.cameraNearFar[0]; // actual camera near\n    // let far = u2.cameraNearFar[1];  // actual camera far\n    // let depth_linear = (far * near) / ((far - near) * depth_raw - far);\n    /* OPTIMIZATION: The above equation can be simplified to:\n        *\n        * depth_linear = (far * near) / ((far - near) * depth_raw - far);\n        *              =  A / (B * depth_raw + C) // ...now substitute A with D = A / C and B with E = B / C\n        *              =  D / (E * depth_raw + 1)\n        *       with D = (far * near) / -far\n        *           -D =  near                // -> constants[0]\n        *        and E = (far - near) / -far  // -> constants[1]\n        */\n    let nearFar: f32 = (u2.cameraFar - u2.cameraNear) / (-u2.cameraFar);\n    return - u2.cameraNear / (nearFar * depth_raw + 1.0);\n}\n\nfn worldFromPerspectiveDepth(p_screen: vec2f, depth_raw: f32) -> vec3f {\n    let p_ndc  = vec4f(2.0 * p_screen.x - 1.0, 1.0 - 2.0 * p_screen.y, 1.0, 1.0);\n    /* @todo: review and move the depth math to before p_view is computed.\n     * This will allow to just have the projectionModelViewInverse to be applied in one step.\n     * Also, consider using a 4-component vector to encode the projection inverse (should be sufficient).\n     */\n    var p_view = u2.projectionInverse * p_ndc;\n    let depth_linear = linearizePerspectiveDepth(depth_raw);\n    p_view = vec4f(p_view.xy * depth_linear / p_view.z, depth_linear, 1.0);\n    let p_world = u2.modelViewInverse * p_view;\n    return p_world.xyz;\n}\n\nfn worldFromOrthographicDepth(p_screen: vec2f, depth_raw: f32) -> vec3f {\n    let p_ndc = vec4f(2.0 * p_screen.x - 1.0, 1.0 - 2.0 * p_screen.y, depth_raw * 2.0 - 1.0, 1.0);\n    let p_world = u2.modelViewInverse * u2.projectionInverse * p_ndc;\n    return p_world.xyz;\n}\n";function Yx(){const e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?Xx:"";return Im(Kx,{blendUniforms:(t=1,Im(wx,t+0||0)),unprojectUniforms:Hx(2),tonemap:jx,hatch:qx,spatialFilter:e});var t}function Qx(e){let t,i,n,r,o,s,a,l,c,u=e,h=navigator.gpu.getPreferredCanvasFormat(),d=new zx,f=new Wx,p=[],m=[],g=!1;function v(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const i=d.getLayout(),n=f.getLayout();return i.label="blend-pass-settings",n.label="blend-pass-unproject",t.createRenderPipeline({label:"blend-pass",layout:t.createPipelineLayout({bindGroupLayouts:[o,i,n]}),vertex:{module:t.createShaderModule({label:"blend-vertex-shader",code:Ex}),entryPoint:"main"},fragment:{module:t.createShaderModule({label:"blend-fragment-shader",code:Yx(e)}),entryPoint:"main",targets:[{format:h}]},primitive:{topology:"triangle-list",cullMode:"back"}})}this.init=function(){t=u.getDevice(),f.init(t),d.init(t)},this.getBlendSettings=function(){return d},this.resize=function(e,d){!function(e,i){s||(s=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]})),r=t.createRenderPipeline({layout:t.createPipelineLayout({bindGroupLayouts:[s]}),vertex:{module:t.createShaderModule({code:Ex}),entryPoint:"mainFlipY"},fragment:{module:t.createShaderModule({code:Sx}),entryPoint:"FxaaPixelShader",targets:[{format:h}],constants:{0:1/e,1:1/i}},primitive:{topology:"triangle-list",cullMode:"back"}}),c||(c=t.createSampler({magFilter:"linear",minFilter:"linear"}))}(e,d),function(){o||(o=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"uint"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"uint"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:5,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"depth"}}]})),i||(i=v()),n||(n=v(!0));let e=u.getRenderTargets().getTargetViewsForBlend().map(((e,t)=>({binding:t,resource:e})));e.push({binding:e.length,resource:u.getSAO().getTargetView()});const r=u.getRenderTargets().getDepthTarget();e.push({binding:e.length,label:`view:${r.label}`,resource:r.createView()}),l=t.createBindGroup({label:"blend-pass-textures",layout:o,entries:e}),a||(a={colorAttachments:[{view:void 0,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]})}(),function(e,i){for(let e=0;e<2;e++){const i=u.getRenderTargets().getPostTarget(e);m[e]=i.createView(),m[e].label=`view:${i.label}`,p[e]=t.createBindGroup({layout:s,entries:[{binding:0,resource:m[e]},{binding:1,resource:c}]})}}()},this.run=function(e,o,s){d.upload(),g&&(f.setCamera(s),f.upload());let c=t.createCommandEncoder();if(o){a.colorAttachments[0].view=m[0];let t=c.beginRenderPass(a);t.setPipeline(g?n:i),t.setBindGroup(0,l),t.setBindGroup(1,d.getBindGroup()),t.setBindGroup(2,f.getBindGroup()),t.draw(3),t.end(),a.colorAttachments[0].view=e,t=c.beginRenderPass(a),t.setPipeline(r),t.setBindGroup(0,p[0]),t.draw(3),t.end()}else{a.colorAttachments[0].view=e;let t=c.beginRenderPass(a);t.setPipeline(g?n:i),t.setBindGroup(0,l),t.setBindGroup(1,d.getBindGroup()),t.setBindGroup(2,f.getBindGroup()),t.draw(3),t.end()}t.queue.submit([c.finish()])},this.enableSpatialFilter=function(){g=!0},this.disableSpatialFilter=function(){g=!1}}const Zx="depth24plus",$x=2,Jx={color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}};class e_{#e;#Dt;#yi;#bi;#xi;#_i;#Ei;#Si;#Ai;#wi;#Ci=[0,0];#Ti;#Mi;#mi;#Ii;#Pi=!0;#Li=!1;#Ri;#Di;#Oi;onIdReadbackCacheFinished=null;constructor(e){this.#e=e}init(e){this.#Dt=this.#e.getDevice(),this.#Ti=navigator.gpu.getPreferredCanvasFormat(),this.#Mi=e?"rgba16float":this.#Ti}cleanup(){var e,t,i,n,r,o,s;null===(e=this.#bi)||void 0===e||e.destroy(),null===(t=this.#yi)||void 0===t||t.destroy(),null===(i=this.#Ei)||void 0===i||i.destroy(),null===(n=this.#xi)||void 0===n||n.destroy(),null===(r=this.#_i)||void 0===r||r.destroy(),null===(o=this.#Si)||void 0===o||o.forEach((e=>null==e?void 0:e.destroy())),null===(s=this.#Ai)||void 0===s||s.forEach((e=>null==e?void 0:e.destroy())),this.#bi=null,this.#yi=null,this.#Ei=null,this.#xi=null,this.#Si=[],this.#Ai=[]}resize(e,t){if((this.#Ci[0]!=e||this.#Ci[1]!=t)&&(this.#Ri=null,this.#Di=null,this.#Oi=null,this.#Ci[0]=e,this.#Ci[1]=t,this.#Ii=null,this.cleanup(),0!==e&&0!==t)){this.#yi=this.#Dt.createTexture({label:"color-target",size:[e,t],format:this.#Mi,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC}),this.#wi=this.#yi.createView(),this.#bi=this.#Dt.createTexture({label:"depth-target",size:[e,t],format:Zx,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.#Ei=this.#Dt.createTexture({label:"overlay-target",size:[e,t],format:this.#Ti,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.#xi=this.#Dt.createTexture({label:"normals-target",size:[e,t],format:"rgb10a2unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.#_i=this.#Dt.createTexture({label:"view-depth-target",size:[e,t],format:"rgb10a2unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.#Si=new Array($x);for(let i=0;i<this.#Si.length;i++){let n=this.#Dt.createTexture({label:`id-target-${i}`,size:[e,t],format:"rgba8uint",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});this.#Si[i]=n}this.#Ai=[null,null];for(let i=0;i<this.#Ai.length;i++){let n=this.#Dt.createTexture({label:`post-target-${i}`,size:[e,t],format:this.#Ti,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});this.#Ai[i]=n}}}getPreferredFormat(){return this.#Ti}getColorTarget(){return this.#yi}getNormalsTarget(){return this.#xi}getDepthTarget(){return this.#bi}getViewDepthTarget(){return this.#_i}getOverlayTarget(){return this.#Ei}getIdTarget(e){return this.#Si[e]}getPostTarget(e){return this.#Ai[e]}getTargetViewsForBlend(){let e=[this.#yi.createView(),this.#Ei.createView()];for(let t=0;t<$x;t++)e.push(this.#Si[t].createView());return e}getColorTargetView(){return this.#wi}getTargetSize(){return this.#Ci}getTargetsListMainPass(){if(!this.#Ri){this.#Ri=[{format:this.#yi.format,blend:Jx},{format:this.#xi.format,blend:Jx},{format:this.#_i.format,blend:Jx}];for(let e=0;e<$x;e++)this.#Ri.push({format:this.#Si[e].format})}return this.#Ri}getTargetsListEdgePass(){return this.#Di||(this.#Di=[{format:this.#yi.format,blend:Jx}]),this.#Di}getOverlayTargetsList(){return this.#Oi||(this.#Oi=[{format:this.#yi.format,blend:Jx}]),this.#Oi}async readIdTargetPixelsAsync(e,t,i,n,r){var o;if("pending"===(null===(o=this.#mi)||void 0===o?void 0:o.mapState))return;let s=4*i,a=s%256;a>0&&(s+=256-a);let l=s*n;var c;(!this.#mi||this.#mi.size<2*l)&&(null===(c=this.#mi)||void 0===c||c.destroy(),this.#mi=this.#Dt.createBuffer({size:2*l,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}));let u=this.#Dt.createCommandEncoder();return u.copyTextureToBuffer({texture:this.#Si[0],origin:[e,t]},{buffer:this.#mi,offset:0,bytesPerRow:s},[i,n]),u.copyTextureToBuffer({texture:this.#Si[1],origin:[e,t]},{buffer:this.#mi,offset:l,bytesPerRow:s},[i,n]),this.#Dt.queue.submit([u.finish()]),this.#mi.mapAsync(GPUMapMode.READ,0).then((()=>{let e=new Uint8Array(this.#mi.getMappedRange());!function(e,t,i,n,r){const o=e[0],s=e[1],a=r*n;for(let e=0;e<n;e++){let n=r*e,l=n+a,c=i*e;for(let e=0;e<i;e++)o[c]=t[n++],s[c]=t[l++],c++}}(r,e,4*i,n,s),this.#mi.unmap()}))}async#Bi(){this.#Li=!0;let[e,t]=this.#Ci,i=4*e,n=i%256;n>0&&(i+=256-n);let r=i*t;var o;(!this.#mi||this.#mi.size<2*r)&&(null===(o=this.#mi)||void 0===o||o.destroy(),this.#mi=this.#Dt.createBuffer({size:2*r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}));let s=this.#Dt.createCommandEncoder();return s.copyTextureToBuffer({texture:this.#Si[0],origin:[0,0]},{buffer:this.#mi,offset:0,bytesPerRow:i},[e,t]),s.copyTextureToBuffer({texture:this.#Si[1],origin:[0,0]},{buffer:this.#mi,offset:r,bytesPerRow:i},[e,t]),this.#Dt.queue.submit([s.finish()]),this.#mi.mapAsync(GPUMapMode.READ,0).then((()=>{let e=new Uint8Array(this.#mi.getMappedRange());this.#Ii||(this.#Ii=new Uint8Array(e.byteLength)),this.#Ii.set(e),this.#mi.unmap(),this.#Pi=!1,this.#Li=!1,this.onIdReadbackCacheFinished&&this.onIdReadbackCacheFinished()}))}readIdTargetPixelsSyncOrFail(e,t,i,n,r){var o;function s(){if(r)for(let e=0;e<r.length;e++)r[e].fill(0)}if("pending"===(null===(o=this.#mi)||void 0===o?void 0:o.mapState))return s(),!1;if(this.#Li)return s(),!1;if(this.#Pi)return s(),this.#Bi(),!1;let a=4*this.#Ci[0],l=a%256;return l>0&&(a+=256-l),r&&((e,t,i,n,r,o,s)=>{const a=e[0],l=e[1],c=r*this.#Ci[1],u=o||0,h=s||0;for(let e=0;e<n;e++){let n=r*(e+h)+4*u,o=n+c,s=i*e;for(let e=0;e<i;e++)a[s]=t[n++],l[s]=t[o++],s++}})(r,this.#Ii,4*i,n,a,e,t),!0}setIdTargetsDirty(){this.#Pi=!0}}const t_="\n//https://www.shadertoy.com/view/ltc3zl\n//https://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\n\n//Packs a float in the range 0-1 to an RGBA8\nfn packDepth( depth: f32 ) -> vec4f {\n    var enc = vec4f(1.0, 255.0, 65025.0, 16581375.0) * depth;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\n\n//Used to unpack depth value when input depth texture is RGBA8\nfn unpackDepth( rgba_depth: vec4f ) -> f32 {\n    return dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );\n}\n\n//Packs a float in the range 0-1 to an RGB8\nfn packDepth3( depth: f32 ) -> vec3f {\n    var enc = vec3f(1.0, 255.0, 65025.0) * depth;\n    enc = fract(enc);\n    enc -= vec3f(enc.yz, 0.0) * vec3f(1.0/255.0 ,1.0/255.0, 0.0);\n    return enc;\n}\n\n//Used to unpack depth value when input depth texture is RGB8\nfn unpackDepth3( rgba_depth: vec3f ) -> f32 {\n    return dot( rgba_depth, vec3f(1.0, 1.0/255.0, 1.0/65025.0) );\n}\n\n//Packs depth in the range 0-1 in an RGB10\nfn packDepth10( depth: f32 ) -> vec3f {\n    var enc = vec3f(1.0, 1023.0, 1023.0 * 1023.0) * depth;\n    enc = fract(enc);\n    enc -= vec3f(enc.yz, 0.0) * vec3f(1.0/1023.0 ,1.0/1023.0, 0.0);\n    return enc;\n}\n\n//Used to unpack depth value when input depth texture is RGB10A2\nfn unpackDepth10( rgba_depth: vec3f ) -> f32 {\n    return dot( rgba_depth, vec3f(1.0, 1.0/1023.0, 1.0/(1023.0*1023.0)) );\n}\n\n//Pack view space normal for use in rgb10unorm target\n//Packing the sign bits into the spare B component gives us\n//an extra bit of precision, until we need to pack something else into\n//that component. The difference in the SSAO output is not really visible\nfn packNormal10( normal: vec3f) -> vec3f {\n/*\n\t//we keep the absolute values of the x and y components (z is derived)\n\tvar res = abs(normal);\n\n\t//pack the sign bits of the x and y components into the z component\n\tvar sxIsNeg = clamp(-sign(res.x), 0.0, 1.0);\n\tvar syIsNeg = clamp(-sign(res.y), 0.0, 1.0);\n\tres.z = (sxIsNeg + 2.0 * syIsNeg) * 0.25;\n*/\n\tvar res = normal * 0.5 + vec3f(0.5);\n\n\treturn res;\n}\n\nfn unpackNormal10( value: vec3f) -> vec3f {\n/*\n\tvar res = value;\n\tvar signs = value.z * 4.0;\n\t//There's probably more efficient way to retrieve this\n\tif (signs >= 2.0) {\n\t\tres.y = -res.y;\n\t}\n\tif (signs == 1.0 || signs == 3.0) {\n\t\tres.x = -res.x;\n\t}\n\tres.z = sqrt(1.0 - dot(res.xy, res.xy));\n*/\n\tvar res = (value - vec3f(0.5)) * 2.0;\n\n\treturn res;\n}\n",i_="// Precomputed sin/cos of the environment rotation\n//DT uniform float envRotationSin;\n//DT uniform float envRotationCos;\nconst envRotationSin = 0.0;\nconst envRotationCos = 1.0;\n\nfn adjustLookupVector(lookup: vec3f) -> vec3f {\n    return vec3f(\n            envRotationCos * lookup.x - envRotationSin * lookup.z,\n            lookup.y,\n            envRotationSin * lookup.x + envRotationCos * lookup.z);\n}\n\n//NOTE: This depends on the specific encoding used.\n//We use the environment preset's built in exposure correction,\n//a gamma of 2.0 and an extra factor of 16\n//when generating the cube map in the modified CubeMapGen tool\n//See this article by Karis for details: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\nfn RGBMDecode(vRGBM: vec4f, exposure: f32) -> vec3f {\n    var ret = vRGBM.rgb * (vRGBM.a * 16.0); //variable factor in alpha channel + fixed factor of 16.0\n    ret *= ret; //remove gamma of 2.0 to go into linear space\n    ret *= exposure; //apply exposure to get back original intensity\n    return ret;\n}\n\n//Gamma encoded half-float or float input texture. See DecodeEnvMap for details.\nfn GammaDecode(vRGBA: vec4f, exposure: f32) -> vec3f {\n    return vRGBA.xyz * vRGBA.xyz * exposure;\n}\n\nfn sampleIrradianceMap(dirWorld: vec3f, irrMap: texture_cube<f32>, s: sampler, exposure: f32) -> vec3f {\n\n    var cubeColor4 = textureSample(irrMap, s, adjustLookupVector(dirWorld));\n\n#if $isGamma\n    var indirectDiffuse = GammaDecode(cubeColor4, exposure);\n    return indirectDiffuse;\n#elif $isRgbm\n    var indirectDiffuse = RGBMDecode(cubeColor4, exposure);\n    return indirectDiffuse;\n#else\n    var indirectDiffuse = cubeColor4.xyz;\n\n\t#if $gammaInput\n\t\tindirectDiffuse.xyz *= indirectDiffuse.xyz;\n\t#endif\n\n    return indirectDiffuse;\n\n#endif\n}\n\nfn sampleReflection(dir: vec3f, envMap: texture_cube<f32>, s: sampler, mipIndex: f32, exposure: f32) -> vec3f {\n\n    var adjDir = adjustLookupVector(dir);\n\n#if $isGamma\n    //TODO: is it textureSampleBias or textureSampleLevel? Used to be textureCubeLod in WebGL\n    var envTexColor = textureSampleLevel( envMap, s, adjDir, mipIndex );\n    return GammaDecode(envTexColor, exposure);\n#elif $isRgbm\n    var envTexColor = textureSampleLevel( envMap, s, adjDir, mipIndex );\n    return RGBMDecode(envTexColor, exposure);\n#else\n\n    //Assumes this code path is non-HDR and non-blurred reflection map, like vanilla three.js\n\n    var envTexColor = textureSample( envMap, s, adjDir );\n    var cubeColor = envTexColor.xyz;\n\n\t#if $gammaInput\n\t\tcubeColor *= cubeColor;\n\t#endif\n\n\treturn cubeColor;\n#endif\n\n}\n";function n_(e,t,i){return Im(i_,{isGamma:e,isRgbm:t,gammaInput:i})}function r_(e,t){switch(e){case v().RepeatWrapping:return"repeat";case v().ClampToEdgeWrapping:return"clamp-to-edge";case v().MirroredRepeatWrapping:return"mirror-repeat";case v().NearestFilter:case v().NearestMipMapNearestFilter:return"nearest";case v().NearestMipMapLinearFilter:return t?"linear":"nearest";case v().LinearFilter:return"linear";case v().LinearMipMapNearestFilter:return t?"nearest":"linear";case v().LinearMipMapLinearFilter:return"linear";default:return console.warn("unknown filter param",e),""}}function o_(e,t){let i,n;switch(e){case v().AlphaFormat:i="r";break;case v().RGBFormat:i="rgb is unsupported";break;case v().RGBAFormat:i="rgba";break;case v().LuminanceFormat:i="r";break;case v().LuminanceAlphaFormat:i="rg";break;case v().RGB_S3TC_DXT1_Format:return"bc1-rgb-unorm unsupported";case v().RGBA_S3TC_DXT1_Format:return"bc1-rgba-unorm";case v().RGBA_S3TC_DXT3_Format:return"bc2-rgba-unorm";case v().RGBA_S3TC_DXT5_Format:return"bc3-rgba-unorm";default:i=e}switch(t){case v().UnsignedByteType:n="8unorm";break;case v().ByteType:n="8snorm";break;case v().ShortType:n="16sint";break;case v().UnsignedShortType:n="16uint";break;case v().IntType:n="32sint";break;case v().UnsignedIntType:n="32uint";break;case v().FloatType:n="32float";break;case v().HalfFloatType:n="16float";break;default:console.warn("unknown type",t),n=""}return""+i+n}function s_(e){switch(e){case v().FrontSide:return"back";case v().BackSide:return"front";case v().DoubleSide:return"none"}}class a_{#Dt;#Ni;#Ui;#ki={};constructor(e){this.#Dt=e}#Fi(e){let t=this.#ki[e];if(!t){const i=this.#Dt.createShaderModule({label:"Mipmap Generator",code:"\n\tvar<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(\n\t\tvec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0)\n\t);\n\n\tstruct VertexOutput {\n\t\t@builtin(position) position : vec4<f32>,\n\t\t@location(0) texCoord : vec2<f32>,\n\t};\n\n\t@vertex\n\tfn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {\n\t\tvar output : VertexOutput;\n\t\toutput.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);\n\t\toutput.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);\n\t\treturn output;\n\t}\n\n\t@group(0) @binding(0) var imgSampler : sampler;\n\t@group(0) @binding(1) var img : texture_2d<f32>;\n\n\t@fragment\n\tfn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {\n\t\treturn textureSample(img, imgSampler, texCoord);\n\t}\n\t"});this.#Ni=this.#Dt.createBindGroupLayout({label:"Mipmap Generator",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}}]}),this.#Ui=this.#Dt.createPipelineLayout({label:"Mipmap Generator",bindGroupLayouts:[this.#Ni]}),t=this.#Dt.createRenderPipeline({layout:this.#Ui,vertex:{module:i,entryPoint:"vertexMain"},fragment:{module:i,entryPoint:"fragmentMain",targets:[{format:e}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint32"}}),this.#ki[e]=t}return t}generateMipmaps(e,t){let i=e.__gpuTexture.createView({baseMipLevel:0,mipLevelCount:1});const n=this.#Dt.createCommandEncoder({label:"mipmap encoder"});for(let r=1;r<t.mipLevelCount;++r){const o=e.__gpuTexture.createView({baseMipLevel:r,mipLevelCount:1}),s=n.beginRenderPass({colorAttachments:[{view:o,loadValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]}),a=this.#Fi(t.format),l=this.#Dt.createBindGroup({layout:a.getBindGroupLayout(0),entries:[{binding:0,resource:e.__gpuSampler},{binding:1,resource:i}]});s.setPipeline(a),s.setBindGroup(0,l),s.draw(3,1,0,0),s.end(),i=o}this.#Dt.queue.submit([n.finish()])}}function l_(e,t){if(e.width<=t&&e.height<=t)return e;if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var i=t/Math.max(e.width,e.height),n=Math.max(Math.floor(e.width*i),1),r=Math.max(Math.floor(e.height*i),1),o=document.createElement("canvas");return o.width=n,o.height=r,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n,r),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}function c_(e){return{addressModeU:r_(e.wrapS),addressModeV:r_(e.wrapT),magFilter:r_(e.magFilter),minFilter:r_(e.minFilter),mipmapFilter:r_(e.minFilter,!0),maxAnisotropy:e.anisotropy||1}}function u_(e,t){return e.createSampler(c_(t))}function h_(e,t){if(6!==(null==t?void 0:t.image.length))return;if(!0!==t.needsUpdate)return;let i=t instanceof v().CompressedTexture,n=t.image[0]instanceof v().DataTexture,r=[];for(let o=0;o<6;o++)r[o]=i||n?n?t.image[o].image:t.image[o]:l_(t.image[o],e.limits.maxTextureDimension2D||8192);var o;t.__gpuTextureCube||(t.addEventListener("dispose",(()=>{var e;null===(e=t.__gpuTextureCube)||void 0===e||e.destroy(),t.__gpuTextureCube=null,t.__gpuSampler=null})),t.__gpuTextureCube=e.createTexture({dimension:"2d",format:o_(t.format,t.type),mipLevelCount:(null===(o=r[0].mipmaps)||void 0===o?void 0:o.length)||1,size:[r[0].width,r[0].height,6],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),t.__gpuSampler=u_(e,t));for(let o=0;o<6;o++)if(i){let i=r[o].mipmaps;for(let n=0,r=i.length;n<r;n++){let r=i[n];e.queue.writeTexture({texture:t.__gpuTextureCube,origin:[0,0,o],mipLevel:n},r.data,{offset:0,bytesPerRow:r.data.byteLength/r.height},[r.width,r.height])}}else n?e.queue.writeTexture({texture:t.__gpuTextureCube,origin:[0,0,o]},r[o].data,{offset:0,bytesPerRow:r[o].data.byteLength/r[o].height},[r[o].width,r[o].height]):e.queue.copyExternalImageToTexture({source:r[o],flipY:!!t.flipY},{texture:t.__gpuTextureCube,origin:[0,0,o]},[r[o].width,r[o].height]);t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}function d_(e,t,i){var n;if(!0!==i.needsUpdate)return;let r=i instanceof v().CompressedTexture,o=i instanceof v().DataTexture;r||o||(i.image=l_(i.image,e.limits.maxTextureDimension2D||8192));const s=(a=i.image,Math.floor(Math.log2(Math.max(a.width,a.height)))+1);var a;let l={label:i.name,dimension:"2d",format:o_(i.format,i.type),mipLevelCount:(null===(n=i.mipmaps)||void 0===n?void 0:n.length)||s,size:[i.image.width,i.image.height],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};i.__gpuTexture||(i.addEventListener("dispose",(()=>{var e;null===(e=i.__gpuTexture)||void 0===e||e.destroy(),i.__gpuTexture=null,i.__gpuSampler=null})),i.__gpuTexture=e.createTexture(l),i.__gpuSampler=u_(e,i));let c=i.image,u=i.mipmaps;if(o||r)if(u.length>0){for(let t=0,n=u.length;t<n;t++){let n=u[t];e.queue.writeTexture({texture:i.__gpuTexture,origin:[0,0],mipLevel:t},n.data,{offset:0,bytesPerRow:n.data.byteLength/n.height},[n.width,n.height])}i.generateMipmaps=!1}else e.queue.writeTexture({texture:i.__gpuTexture,origin:[0,0]},c.data,{offset:0,bytesPerRow:c.data.byteLength/c.height},[c.width,c.height]);else if(u.length>0){for(let t=0,n=u.length;t<n;t++){let n=u[t];e.queue.copyExternalImageToTexture({source:n,flipY:!!i.flipY},{texture:i.__gpuTexture,mipLevel:t,premultipliedAlpha:!!i.premultiplyAlpha},[n.width,n.height])}i.generateMipmaps=!1}else e.queue.copyExternalImageToTexture({source:c,flipY:!!i.flipY},{texture:i.__gpuTexture},[c.width,c.height]);i.generateMipmaps&&(t.generateMipmaps(i,l),i.generateMipmaps=!1),i.needsUpdate=!1,i.onUpdate&&i.onUpdate()}function f_(e){e instanceof v().Texture&&(e.__refCount=(e.__refCount||0)+1)}function p_(e){e instanceof v().Texture&&Number.isFinite(e.__refCount)&&(e.__refCount<1&&console.warning("Texture was unreferenced more times than referenced."),e.__refCount--,e.__refCount<1&&e.dispose())}const m_="struct TextureUniforms {\n\t//Note that 3x3 matrix is padded to 4 floats per row\n\ttexMatrix: mat3x3f,\n\ttexMatrixBump: mat3x3f,\n\ttexMatrixAlpha: mat3x3f,\n\tnormalScale: vec2f,\n\tpad: vec2f\n}\n@group($bindGroup) @binding(0) var<uniform> textureUniforms : TextureUniforms;\n\n//TODO: add other material specific uniforms like texture map bindings here\n//Note that basic stuff like diffuse/specular color is already handled by ObjectUniforms, here\n//is meant for more complex materials\n\n@group($bindGroup) @binding(1) var mapDiffuse: texture_2d<f32>;\n@group($bindGroup) @binding(2) var smplDiffuse: sampler;\n\n@group($bindGroup) @binding(3) var mapSpecular: texture_2d<f32>;\n@group($bindGroup) @binding(4) var smplSpecular: sampler;\n\n//Contains either bump map or normal map, depending on render flags\n@group($bindGroup) @binding(5) var mapNormal: texture_2d<f32>;\n@group($bindGroup) @binding(6) var smplNormal: sampler;\n\n@group($bindGroup) @binding(7) var mapAlpha: texture_2d<f32>;\n@group($bindGroup) @binding(8) var smplAlpha: sampler;\n";function g_(){return{binding:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,visibility:arguments.length>1&&void 0!==arguments[1]?arguments[1]:GPUShaderStage.FRAGMENT,texture:{sampleType:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float"}}}function v_(){return{binding:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,visibility:arguments.length>1&&void 0!==arguments[1]?arguments[1]:GPUShaderStage.FRAGMENT,sampler:{}}}function y_(){return Im(m_,{bindGroup:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0})}const b_={NO_UNIFORMS:268435456,TEXTURE_MASK:255,MAP_DIFFUSE:1,MAP_SPECULAR:2,MAP_BUMP:4,MAP_NORMAL:8,MAP_ALPHA:16},x_=new Float32Array(9);class __ extends Ax{#Dt;#Vi;#ui;#hi;#Gi;constructor(e,t,i){super(e,40,!0,!1),this.#Dt=e,this.#Vi=i,this.#ui=e.createBindGroupLayout({label:"material bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,buffer:{}},g_(1),v_(2),g_(3),v_(4),g_(5),v_(6),g_(7),v_(8)]}),t?(this.#Gi||(this.#Gi=new a_(e)),this.#zi(t)):this.#Hi()}#Hi(){let e=this.#Vi.view,t=this.#Vi.sampler;this.#hi=this.#Dt.createBindGroup({layout:this.#ui,entries:[{binding:0,resource:{buffer:this.getBuffer()}},{binding:1,resource:e},{binding:2,resource:t},{binding:3,resource:e},{binding:4,resource:t},{binding:5,resource:e},{binding:6,resource:t},{binding:7,resource:e},{binding:8,resource:t}]})}#Wi(e,t){let i=e.offset,n=e.repeat;if(e.matrix)x_.set(e.matrix.elements);else for(let e=0;e<9;e++)x_[e]=e%4?0:1;x_[6]+=i.x,x_[7]+=i.y,x_[0]*=n.x,x_[3]*=n.x,x_[1]*=n.y,x_[4]*=n.y,this.setMatrix3x3(t,x_)}#zi(e){let t=0,i=[{binding:0,resource:{buffer:this.getBuffer()}}];const n=(n,r,o)=>{let s,a,l=e[n];l?(d_(this.#Dt,this.#Gi,l),s=l.__gpuTexture.createView(),a=l.__gpuSampler,t|=r):(s=this.#Vi.view,a=this.#Vi.sampler),i.push({binding:o,resource:s}),i.push({binding:o+1,resource:a})};n("map",b_.MAP_DIFFUSE,1),n("specularMap",b_.MAP_SPECULAR,3),e.bumpMap?n("bumpMap",b_.MAP_BUMP,5):n("normalMap",b_.MAP_NORMAL,5),n("alphaMap",b_.MAP_ALPHA,7);let r=e.map||e.specularMap;r&&this.#Wi(r,0);let o=e.normalMap||e.bumpMap;o&&this.#Wi(o,12);let s=e.alphaMap;return s&&this.#Wi(s,24),e.bumpMap&&(this.setFloat(36,e.bumpScale),this.setFloat(37,e.bumpScale)),e.normalMap&&(this.setFloat(36,e.normalScale.x),this.setFloat(37,e.normalScale.y)),this.upload(),this.#hi=this.#Dt.createBindGroup({layout:this.#ui,entries:i}),t}getLayout(){return this.#ui}getBindGroup(){return this.#hi}}function E_(e){let t=0;return e.map&&(t|=b_.MAP_DIFFUSE),e.specularMap&&(t|=b_.MAP_SPECULAR),e.bumpMap&&(t|=b_.MAP_BUMP),e.normalMap&&(t|=b_.MAP_NORMAL),e.alphaMap&&(t|=b_.MAP_ALPHA),t}function S_(e){const t=e.target;t.__gpuMaterialUniforms&&(t.__gpuMaterialUniforms.getBuffer().destroy(),t.__gpuMaterialUniforms=void 0),t.removeEventListener("dispose",S_)}let A_;const w_=new al;w_.elements[10]=.5,w_.elements[14]=.5;class C_ extends Ax{static getDeclaration(e,t){return Im("struct CameraUniforms {\n    projectionMatrix : mat4x4f,\n    viewMatrix: mat4x4f,\n    viewMatrixInverse: mat4x4f,\n    viewInverseEnv: mat4x4f,\n    near: f32,\n    far: f32\n}\n@group($bindGroup) @binding($binding) var<uniform> uniforms : CameraUniforms;\n",{bindGroup:e,binding:t})}#ji=new al;#qi=new al;#Ki=new al;constructor(e){super(e,80,!0,!0)}update(e){void 0!==e.parent&&null!==e.parent||e.updateMatrixWorld(),e.worldUpTransform?this.#qi.multiplyMatrices(e.worldUpTransform,e.matrixWorld):this.#qi.copy(e.matrixWorld),this.#ji.multiplyMatrices(w_,e.projectionMatrix),this.#Ki.multiplyMatrices(this.#ji,e.matrixWorldInverse),this.setBuffer(0,this.#ji.elements),this.setBuffer(16,e.matrixWorldInverse.elements),this.setBuffer(32,e.matrixWorld.elements),this.setBuffer(48,this.#qi.elements),this.setFloat(64,e.near),this.setFloat(65,e.far),this.upload()}getViewProjectionMatrix(){return this.#Ki}}class T_{static getDeclaration(e,t){return Im("const NUM_STOPS = $NUM_HEATMAP_STOPS;\n\n// Interleaving heatmap colors and stops for better alignment\nstruct ColorsAndStops {\n    color: vec3f,\n    stop: f32\n};\n\nstruct IBLSettings {\n    envMapExposure: f32,\n    exposureBias: f32,\n    tonemapMethod: i32,\n    numCutplanes: i32,\n    heatmapAlpha: f32,\n    pad1: u32,\n    pad2: u32,\n    pad3: u32,\n    colorsAndStops: array<ColorsAndStops, NUM_STOPS>\n}\n@group($bindGroup) @binding($firstBinding + 0) var<uniform> ibl : IBLSettings;\n@group($bindGroup) @binding($firstBinding + 1) var reflMap: texture_cube<f32>;\n@group($bindGroup) @binding($firstBinding + 2) var reflSampler: sampler;\n@group($bindGroup) @binding($firstBinding + 3) var irrMap: texture_cube<f32>;\n@group($bindGroup) @binding($firstBinding + 4) var irrSampler: sampler;\n@group($bindGroup) @binding($firstBinding + 5) var<uniform> cutplanes: array<vec4f, 6>; //TODO: could use variable length array of needed\n@group($bindGroup) @binding($firstBinding + 6) var<storage> heatmapSensors: array<vec4f>;\n\n//TODO: Add lights here if we want to support discrete lights\n\nfn checkCutPlanes(worldPosition: vec3f) {\n    for (var i=0; i<ibl.numCutplanes; i++) {\n        // test if point is outside of cutting plane; if so, discard fragment\n        if (dot(vec4f(worldPosition, 1.0), cutplanes[i]) > 0.0) {\n            discard;\n        }\n    }\n}\n",{NUM_HEATMAP_STOPS:5,bindGroup:e,firstBinding:t})}#e;#Dt;#Xi;#Yi;#Qi;#Zi=1;#$i=1;#Ji=0;#en=new Float32Array(28);#tn=new Int32Array(this.#en.buffer);#in;#nn=new Float32Array(24);#rn=0;#on;#sn=!1;#an=new Float32Array(20);#ln;#cn;#un;#hn=!1;#dn;#fn;constructor(e){this.#e=e,this.#Xi=_u({x:1,y:1,z:1},{x:1,y:1,z:1}),this.#Yi=this.#Xi,this.#Qi=this.#Xi,f_(this.#Xi),f_(this.#Yi),f_(this.#Qi),this.#en}init(){this.#Dt=this.#e.getDevice(),this.#in=this.#Dt.createBuffer({size:this.#en.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.#on=this.#Dt.createBuffer({size:this.#nn.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.#un=this.#Dt.createBuffer({size:64,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})}getLayoutEntries(e){return[{binding:e+0,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:e+1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"cube"}},{binding:e+2,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:e+3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"cube"}},{binding:e+4,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:e+5,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:e+6,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}setReflectionMap(e){e!==this.#Yi&&(e||=this.#Xi,f_(e),p_(this.#Yi),this.#Yi=e,this.#dn=!0)}setIrradianceMap(e){e||=this.#Xi,f_(e),p_(this.#Qi),this.#Qi=e,this.#dn=!0}isComplete(){return this.#Yi&&this.#Qi}setEnvExposure=function(e){const t=Math.pow(2,e);t!==this.#$i&&(this.#$i=t,this.#fn=!0)};setExposureBias(e){let t=Math.pow(2,e);t!==this.#Zi&&(this.#Zi=t,this.#fn=!0)}setTonemapMethod(e){this.#Ji!==e&&(this.#Ji=e,this.#fn=!0)}setEnvRotation(e){}setCutPlanes(e){if(this.#rn!==((null==e?void 0:e.length)||0)&&(this.#rn=(null==e?void 0:e.length)||0,this.#fn=!0),!e)return;e.length>6&&console.warn("too many cut planes");let t=0;for(let i=0;i<e.length;i++){let n=e[i],r=n.x;this.#nn[t]!==r&&(this.#sn=!0,this.#nn[t]=r),t++,r=n.y,this.#nn[t]!==r&&(this.#sn=!0,this.#nn[t]=r),t++,r=n.z,this.#nn[t]!==r&&(this.#sn=!0,this.#nn[t]=r),t++,r=n.w,this.#nn[t]!==r&&(this.#sn=!0,this.#nn[t]=r),t++}}#pn(){const e=new Array(this.#rn);for(let t=0;t<this.#rn;t++)e[t]={x:this.#nn[4*t],y:this.#nn[4*t+1],z:this.#nn[4*t+2],w:this.#nn[4*t+3]};return e}setHeatmaps(e,t,i){let n=0;for(let i=0;i<5;++i)this.#an.set([e[3*i],e[3*i+1],e[3*i+2],t[i]],n),n+=4;this.#ln=i,this.#fn=!0}setHeatmapSensors(e){!this.#cn||this.#cn.length<e.length?this.#cn=new Float32Array(e):this.#cn.set(e),this.#hn=!0}getEntries(e){var t,i,n,r;return[{binding:e+0,resource:{buffer:this.#in}},{binding:e+1,resource:null===(t=this.#Yi)||void 0===t?void 0:t.__gpuTextureCube.createView({dimension:"cube"})},{binding:e+2,resource:null===(i=this.#Yi)||void 0===i?void 0:i.__gpuSampler},{binding:e+3,resource:null===(n=this.#Qi)||void 0===n?void 0:n.__gpuTextureCube.createView({dimension:"cube"})},{binding:e+4,resource:null===(r=this.#Qi)||void 0===r?void 0:r.__gpuSampler},{binding:e+5,resource:{buffer:this.#on}},{binding:e+6,resource:{buffer:this.#un}}]}update(){var e,t;return!!this.#Dt&&(this.#fn&&(this.#en[0]=this.#$i,this.#en[1]=this.#Zi,this.#tn[2]=this.#Ji,this.#tn[3]=this.#rn,this.#en[4]=this.#ln,this.#en.set(this.#an,8),this.#Dt.queue.writeBuffer(this.#in,0,this.#en.buffer,0,this.#en.byteLength),this.#fn=!1),this.#sn&&(this.#Dt.queue.writeBuffer(this.#on,0,this.#nn.buffer,0,this.#nn.byteLength),this.#sn=!1),this.#hn&&((!this.#un||this.#un.size<this.#cn.byteLength)&&(this.#un&&this.#un.destroy(),this.#un=this.#Dt.createBuffer({size:this.#cn.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.#dn=!0),this.#Dt.queue.writeBuffer(this.#un,0,this.#cn.buffer,0,this.#cn.byteLength),this.#hn=!1),!!(this.#dn||null!==(e=this.#Yi)&&void 0!==e&&e.needsUpdate||null!==(t=this.#Qi)&&void 0!==t&&t.needsUpdate)&&(h_(this.#Dt,this.#Yi),h_(this.#Dt,this.#Qi),this.#dn=!1,!0))}copyFrom(e){this.#Yi=e.getReflectionMap(),this.#Qi=e.getIrradianceMap(),this.#$i=e.getEnvMapExposure(),this.#Zi=e.getExposureBias(),this.#Ji=e.getTonemapMethod(),this.#dn=!0,this.#fn=!0,this.setCutPlanes(e.#pn())}getIrradianceMap(){return this.#Qi}getReflectionMap(){return this.#Yi}getEnvMapExposure(){return this.#$i}getExposureBias(){return this.#Zi}getTonemapMethod(){return this.#Ji}}class M_{static getDeclaration(e){return Im("\n            $cameraUniforms\n            $iblUniforms\n        ",{cameraUniforms:C_.getDeclaration(e,0),iblUniforms:T_.getDeclaration(e,1)})}#Dt;#mn;#gn;#Ni;#hi;constructor(e,t,i){this.#Dt=e,this.#mn=t,this.#gn=i,this.#Ni=this.#Dt.createBindGroupLayout({label:"frame bind group layout",entries:[{binding:0,visibility:this.#mn.getVisibility(),buffer:{}},...this.#gn.getLayoutEntries(1)]})}updateBindGroup(){this.#hi=this.#Dt.createBindGroup({layout:this.#Ni,entries:[{binding:0,resource:{buffer:this.#mn.getBuffer()}},...this.#gn.getEntries(1)]})}getLayout(){return this.#Ni}getBindGroup(){return this.#hi}}function I_(e,t,i,n,r){return Im("\tdiagnostic(off, derivative_uniformity);\n\n\t$frameBindGroup\n\t$objectUniforms\n\t$materialUniforms\n\t$pack_normals\n\t$pack_depth\n\t$mat_inverse\n\t$tonemap\n\t$envMapSample\n\t$heatmapDecl\n\t$hatch\n\n\tconst hatchTintColor = vec3f(0, 0, 0);\n\n\n\tstruct VertexOutput {\n\t\t@builtin(position) Position : vec4f,\n\t\t@location(0) @interpolate(flat) instance: u32,\n\t\t@location(1) vViewNormal: vec3f,\n\t\t@location(2) vViewPosition: vec3f,\n\t\t@location(3) vWorldPosition: vec3f,\n\t\t@location(4) depth: f32,\n#if $isUVW\n\t\t@location(5) uvw : vec3f,\n\t\t@location(6) uvwBump : vec3f,\n\t\t@location(7) uvwAlpha : vec3f,\n#elif $hasTextures\n\t\t@location(5) uv : vec2f,\n\t\t@location(6) uvBump : vec2f,\n\t\t@location(7) uvAlpha : vec2f,\n#endif\n#if $hasVertexColors\n\t\t@location(8) color: vec3f\n#endif\n\t}\n\n\tstruct VertexInput {\n\t\t@location(0) position : vec3f,\n\t\t@location(1) normal : u32,\n#if $hasVertexColors\n\t\t@location(2) color: vec3f,\n\t#if $hasUV\n\t\t#if $isUVW\n\t\t\t@location(3) uvw: vec3f,\n\t\t#else\n\t\t\t@location(3) uv: vec2f,\n\t\t#endif\n\t#endif\n#elif $hasUV\n\t#if $isUVW\n\t\t@location(2) uvw: vec3f,\n\t#else\n\t\t@location(2) uv: vec2f,\n\t#endif\n#endif\n\t}\n\n\t@vertex fn vsmain(\n\t\tin: VertexInput,\n\t\t@builtin(instance_index) instance : u32\n\t) -> VertexOutput {\n\n\t\tvar objectUniforms = getObjectUniforms(instance);\n\n\t\tvar output : VertexOutput;\n\t\tvar pos4 = vec4f(in.position.x, in.position.y, in.position.z, 1.0);\n\n\t\tvar mvMatrix = uniforms.viewMatrix * objectUniforms.modelMatrix;\n\t\tvar mvPosition = mvMatrix * pos4;\n\n\t\toutput.Position = uniforms.projectionMatrix * mvPosition;\n\n\t\toutput.vViewPosition = -mvPosition.xyz;\n\t\toutput.vViewNormal = getNormalMatrix(mvMatrix) * decodeNormalInt(in.normal);\n\t\toutput.vWorldPosition = (objectUniforms.modelMatrix * pos4).xyz;\n\n#if $hasTextures\n\t#if $isUVW\n\t\toutput.uvw = textureUniforms.texMatrix * in.uvw;\n\t\toutput.uvwBump = textureUniforms.texMatrixBump * in.uvw;\n\t\toutput.uvwAlpha = textureUniforms.texMatrixAlpha * in.uvw;\n\t#else\n\t\toutput.uv = (textureUniforms.texMatrix * vec3f(in.uv, 1.0)).xy;\n\t\toutput.uvBump = (textureUniforms.texMatrixBump * vec3f(in.uv, 1.0)).xy;\n\t\toutput.uvAlpha = (textureUniforms.texMatrixAlpha * vec3f(in.uv, 1.0)).xy;\n\t#endif\n#else\n\t#if $isUVW\n\t\toutput.uvw = in.uvw;\n\t\toutput.uvwBump = in.uvw;\n\t\toutput.uvwAlpha = in.uvw;\n\t#endif\n#endif\n\t\toutput.instance = instance;\n\t\toutput.depth = mvPosition.z;\n#if $hasVertexColors\n\t\toutput.color = in.color;\n#endif\n\n\t\treturn output;\n\t}\n\n\tstruct PixelOutput {\n\t\t@location(0) color: vec4f,\n\t\t@location(1) normal: vec4f,\n\t\t@location(2) viewDepth: vec4f,\n\t\t@location(3) dbId: vec4u,\n\t\t@location(4) modelId: vec4u,\n\t\t//@location(5) objectFlags: vec4u\n\t}\n\n\n\t//Samples normal map texture (will be treated as either bump map or normal map depending on flags)\n\tfn GET_BUMPMAP(uv: vec2f) -> vec4f {\n\t\t//TODO: this ignores invert and clamp settings, see getMapChunk in WebGLProgram.js for details\n\t\treturn textureSample(mapNormal, smplNormal, uv);\n\t}\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t//  http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\tfn dHdxy_fwd(vUvBump: vec2f) -> vec2f {\n\n\t\tvar dSTdx = dpdx( vUvBump );\n\t\tvar dSTdy = dpdy( vUvBump );\n\n\t\tvar Hll = textureUniforms.normalScale.x * GET_BUMPMAP(vUvBump).x;\n\t\tvar dBx = textureUniforms.normalScale.x * GET_BUMPMAP(vUvBump + dSTdx).x - Hll;\n\t\tvar dBy = textureUniforms.normalScale.x * GET_BUMPMAP(vUvBump + dSTdy).x - Hll;\n\n\t\treturn vec2f( dBx, dBy );\n\t}\n\n\tfn perturbNormalArb( surf_pos: vec3f, surf_norm: vec3f, dHdxy: vec2f ) -> vec3f {\n\n\t\tvar vSigmaX = dpdx( surf_pos );\n\t\tvar vSigmaY = dpdy( surf_pos );\n\t\tvar vN = surf_norm; // normalized\n\n\t\tvar R1 = cross( vSigmaY, vN );\n\t\tvar R2 = cross( vN, vSigmaX );\n\n\t\tvar fDet = dot( vSigmaX, R1 );\n\n\t\tvar vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\tfn perturbNormal2Arb( eye_pos: vec3f, surf_norm: vec3f, vUvBump: vec2f ) -> vec3f {\n\n\t\tvar q0 = dpdx( eye_pos.xyz );\n\t\tvar q1 = dpdy( eye_pos.xyz );\n\t\tvar st0 = dpdx( vUvBump.xy );\n\t\tvar st1 = dpdy( vUvBump.xy );\n\n\t\tvar S = normalize(  q0 * st1.y - q1 * st0.y );\n\t\tvar T = normalize( -q0 * st1.x + q1 * st0.x );\n\t\tvar N = normalize( surf_norm );\n\n\t\tvar mapN = GET_BUMPMAP(vUvBump).xyz * 2.0 - 1.0;\n\t\tmapN = vec3f(textureUniforms.normalScale * mapN.xy, mapN.z);\n\t\tvar tsn = mat3x3f( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n\n\n\tfn toIntVec(v: vec4f) -> vec4u\n\t{\n\t\treturn vec4u(v * 255.0);\n\t}\n\n\tfn Schlick_v3(v: vec3f, cosHV: f32) -> vec3f {\n\t\tvar facing = max(1.0 - cosHV, 0.0);\n\t\treturn v + (1.0 - v) * pow(facing, 5.0);\n\t}\n\n\tfn Schlick_f(v: f32, cosHV: f32) -> f32 {\n\t\tvar facing = max(1.0 - cosHV, 0.0);\n\t\treturn v + ( 1.0 - v ) * pow(facing, 5.0);\n\t}\n\n\tfn InputToLinear(v: vec3f) -> vec3f {\n\t\treturn v*v;\n\t}\n\n\tconst AlphaTest = 0.01;\n\n\t@fragment fn psmain(\n\t\tin: VertexOutput\n\t) -> PixelOutput\n\t{\n#if $hasTextures\n\t#if $isUVW\n\t\tvar vUv = in.uvw.xy;\n\t\tvar vUvBump = in.uvwBump.xy;\n\t\tvar vUvAlpha = in.uvwAlpha.xy;\n\t#else\n\t\tvar vUv = in.uv;\n\t\tvar vUvBump = in.uvBump;\n\t\tvar vUvAlpha = in.uvAlpha;\n\t#endif\n#else\n\tconst vUv = vec2f(0.0,0.0);\n\tconst vUvBump = vec2f(0.0,0.0);\n\tconst vUvAlpha = vec2f(0.0,0.0);\n#endif\n\t\tvar output: PixelOutput;\n\t\tvar objectUniforms = getObjectUniforms(in.instance);\n\t\tvar materialUniforms = getMaterialUniforms(objectUniforms.materialIndex);\n\n\t\t//check doNotCut flag\n\t\tif (commonMaterialUniforms.doNotCutOverride + (materialUniforms.renderFlags & 2) == 0) {\n\t\t\tcheckCutPlanes(in.vWorldPosition);\n\t\t}\n\n\t\tvar normal = normalize(in.vViewNormal);\n\n\t\t//With ortho projection, the view direction needs to be\n\t\t//adjusted so that all view direction rays (for all pixels) are parallel\n\t\t//instead of going from the camera position directly to the vertex like\n\t\t//in perspective. In view space, this is kind of easy -- the view vector is along Z.\n\t\t//TODO: Actually the vViewPosition varying is the position of the camera wrt the vertex\n\t\t//so the naming of the variable can be clarified.\n\t\tvar viewDirection: vec3f;\n\t\tif (uniforms.projectionMatrix[3][3] == 0.0) {\n\t\t\tviewDirection = normalize( in.vViewPosition );\n\t\t} else {\n\t\t\tviewDirection = vec3f(0.0, 0.0, 1.0);\n\t\t}\n\t\tnormal = faceForward(normal, -viewDirection, normal);\n\n\t\tvar geomNormal = normal;\n\n#if $hasTextures\n\t\tif ((materialUniforms.renderFlags & (8 << 16)) != 0) {\n\t\t\tnormal = perturbNormal2Arb( -in.vViewPosition, normal, vUvBump );\n\t\t} else if ((materialUniforms.renderFlags & (4 << 16)) != 0) {\n\t\t\tnormal = perturbNormalArb( -in.vViewPosition, normal, dHdxy_fwd(vUvBump) );\n\t\t}\n#endif\n\n\t\t//TODO: vertex color\n#if $hasVertexColors\n\t\tvar diffuse = vec4f(in.color, 1.0);\n#else\n\t\tvar diffuse = intToVecf(materialUniforms.diffuse);\n\t\tif ((materialUniforms.renderFlags & (1 << 16)) != 0) {\n\t\t\tdiffuse *= textureSample(mapDiffuse, smplDiffuse, vUv);\n\t\t}\n#endif\n\t\tvar outAlpha = diffuse.a;\n\n#if $hasTextures\n\t\tif ((materialUniforms.renderFlags & (16 << 16)) != 0) {\n\t\t\tvar alphaTexel = textureSample(mapAlpha, smplAlpha, vUvAlpha);\n\t\t\toutAlpha *= alphaTexel.r;\n\t\t}\n#endif\n\n\t\t//In the WebGL version, alpha test is a configurable parameter of each material,\n\t\t//However, we don't _really_ need to be that generic\n\t\tif ((materialUniforms.renderFlags & 4) != 0 && outAlpha < AlphaTest) {\n\t\t\tdiscard;\n\t\t}\n\n\t\tvar specularR = intToVecf(materialUniforms.specular);\n\t\tvar reflectivity = specularR.a;\n\t\tvar specular = InputToLinear(specularR.xyz);\n\n\t\t//Diffuse from irradiance map\n\t\tvar worldNormal = getMat3(uniforms.viewInverseEnv) * normal;\n\t\tvar indirectDiffuse = sampleIrradianceMap(worldNormal, irrMap, irrSampler, ibl.envMapExposure);\n\n\t\tvar outColor = InputToLinear(diffuse.xyz) * indirectDiffuse;\n\n\t\t//Reflection map\n\t\tvar reflectVec = reflect( -viewDirection, normal );\n\n\t\treflectVec = getMat3(uniforms.viewInverseEnv) * reflectVec;\n\n\t\t//If the reflection vector points into the ground, we will scale\n\t\t//down the reflection intensity, in order to fake interference with the\n\t\t//ground plane and avoid an eclipse-like light-dark line between the object\n\t\t//and its shadow.\n\t\t//The actual scaling is made up so that it gets very dark near the ground facing faces\n\t\t//float reflectScale = 1.0 - clamp(-reflectVec.y, 0.0, 1.0);\n\t\t//reflectScale *= (reflectScale * reflectScale);\n\t\tvar reflectScale = 1.0;\n\n\t\t//The environment cube map is blurred with the assumption that\n\t\t//max shininess is 2048 and every mip drops that by a factor of 4\n\t\t//float MipmapIndex = log4(shininess / 2048.0) / log4(0.25);\n\t\t//The simplification below was given in the original source for this method.\n\t\t//It uses log base 10. We use log base 2 below, which changes the constant.\n\t\t//float MipmapIndex = max(0.0, -1.66096404744368 * logShiny + 5.5);\n\t\tvar logShiny = log2(max(1.0+1e-10, materialUniforms.shininess));\n\t\tvar reflMipIndex = max(0.0, 5.5 - 0.5 * logShiny);\n\t\t//If we get roughness map support, we'd have to sample the roughness map here to get a mip index.\n\n\t\tvar cubeColor = sampleReflection(reflectVec, reflMap, reflSampler, reflMipIndex, ibl.envMapExposure);\n\n\t\tcubeColor *= reflectScale;\n\n\t\tvar facing = dot( viewDirection, normal );\n\n\t\t//Argh. If facing is very much below the horizon, it's probably\n\t\t//a backwards facing polygon, so turn off Fresnel completely.\n\t\t//Otherwise, if it's just slightly below, it's probably some interpolation\n\t\t//artifact, so we treat it as almost oblique facing.\n\t\t// Bypassing Fresnel when reflectivity is set exactly to 0.0 is intentional and provided\n\t\t// as a way to turn off the effect\n\t\tif (facing < -1e-2  || reflectivity == 0.0) {\n\t\t\tfacing = 1.0;\n\t\t} else {\n\t\t\tfacing = max(1e-6, facing);\n\t\t}\n\n#if $hasTextures\n\t\t//Gratuitous hack to make bump mapped materials less shiny at grazing angles.\n\t\t//This has the effect of reducing the Fresnel effect when bumpScale is large.\n\t\t//Assumption is that large bump scale = very rough surface.\n\t\tif ((materialUniforms.renderFlags & (4 << 16)) != 0) {\n\t\t\tfacing = min(1.0, facing + textureUniforms.normalScale.x * 7.0);\n\t\t}\n#endif\n\n#if $metalMaterial\n\n\t\t//Metals do not generally have Fresnel reflection\n\t\tvar schlickRefl = specular;\n\n#else\n\n\t\t//Nonmetals reflect using Fresnel -- so they reflect a lot at grazing angles\n\t\tvar schlickRefl = Schlick_v3(specular, facing);\n\n\t\t//Seems appropriate to also reduce transparency of the material as\n\t\t//the view angle is more oblique:\n\t\t//BOGUS: The scaling by reflectivity is not physical -- here\n\t\t//we use reflectivity as a scale to make transparent ghosted objects look good\n\t\t//while still retaining some physical Fresnel for glass materials.\n\t\t//For ghosted objects the reflectivity is 0 while for physical glass\n\t\t//it is a non-zero value.\n\t\toutAlpha = mix(outAlpha, Schlick_f(outAlpha, facing), reflectivity);\n\n\t\t//Scale down diffuse in order to keep energy conservation\n\t\t//at grazing angles, where specular takes over. The actual equation is\n\t\t//given here: http://www.cs.utah.edu/~shirley/papers/jgtbrdf.pdf.\n\t\t//For the environment map, N.V and N.R are equal so we can just square the one factor\n\t\t//instead of computing two and multiplying them.\n\t\t//TODO: check further on the exact normalization factors needed.\n\t\t//Also note that we drop a factor of PI (we drop that from the specular light as well,\n\t\t//where we use n/8 instead of n/8pi as normalization).\n\t\tvar invSchlick = pow(1.0 - facing * 0.5, 5.0);\n\n\t\t//If contrast is too high, and RaaS complains, set this factor to 1.\n\t\tvar norm_factor = (28.0 / 23.0) * (1.0 - invSchlick) * (1.0 - invSchlick);\n\n\t\toutColor *= norm_factor * (1.0 - specular);\n#endif\n\n\t\toutColor += cubeColor.xyz * schlickRefl.xyz;\n\n\t\tif (ibl.tonemapMethod == 1) {\n\t\t\toutColor = toneMapCanonOGS_WithGamma_WithColorPerserving(ibl.exposureBias * outColor);\n\t\t} else if (ibl.tonemapMethod == 2) {\n\t\t\toutColor = toneMapCanonFilmic_WithGamma(ibl.exposureBias * outColor);\n\t\t}\n\n\t\toutput.color = vec4f(outColor, outAlpha);\n\n\t\t//Store normal and depth information for SSAO (opaque objects only)\n\t\tvar discardNormal = 1.0;\n\t\tif (outAlpha < 0.9) {\n\t\t\tdiscardNormal = 0.0;\n\t\t}\n\n\t\toutput.normal = vec4f(packNormal10(geomNormal), discardNormal);\n\t\tvar unitDepth = (-in.depth - uniforms.near) / (uniforms.far - uniforms.near);\n\t\toutput.viewDepth = vec4f(packDepth10(unitDepth), discardNormal);\n\n\t\t//Store object identity information\n\t\toutput.dbId = intToVec(objectUniforms.dbId);\n\n\n\t\t//Currently we don't have enough room to bind a third ID render target (32 byte limit on render attachments),\n\t\t//so we stash half of the object flags in the modelId\n\t\t//output.objectFlags = intToVec(objectUniforms.objectFlags);\n\n\t\toutput.modelId = intToVec(objectUniforms.modelId | (objectUniforms.objectFlags << 16));\n\n\t\t//If there is theming color, apply it at the end\n\t\t//If we ever use the uber shader for drawing ghosted objects, which are not subject to theming\n\t\t//we will also need to check the ghosting flag here (materialUniforms.renderFlags & 1)\n\t\t//Currently our ghosting effect is edges only.\n\t\tif (objectUniforms.themeColor != 0) {\n\t\t\tvar themingColor = intToVecf(objectUniforms.themeColor);\n\t\t\toutput.color = mix(output.color, themingColor, themingColor.a);\n\t\t}\n\n\t\t// (See the comment on theming above). If this shader is ever used for ghosted objects,\n\t\t// the heatmap chunk needs to check for that.\n\t\t$heatmap\n\n\t\t// cap mesh hatch pattern\n\t\tif ((materialUniforms.renderFlags & 8) != 0) {\n\t\t\toutput.color = calculateHatchPattern(materialUniforms.hatchParams, in.Position.xy, output.color,\n\t\t\t\thatchTintColor, materialUniforms.hatchTintIntensity);\n\t\t}\n\n\t\treturn output;\n\t}\n",{frameBindGroup:M_.getDeclaration(0),objectUniforms:Dm(1),materialUniforms:y_(2),pack_normals:"//See http://aras-p.info/texts/CompactNormalStorage.html\n//Currently using the slow and simple approach of mapping 3d normal to two spherical coords.\n//TODO try other, cheaper ways to encode the normal.\n\nconst kPI = 3.14159265358979;\n\nfn encodeNormal (n: vec3f) -> vec2f {\n\treturn (vec2f(atan2(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\n\nfn decodeNormal (enc: vec2f) -> vec3f {\n\tvar ang = enc * 2.0 - 1.0;\n\tvar scth = vec2f(sin(ang.x * kPI), cos(ang.x * kPI));\n\t//sincos(ang.x * kPI, scth.x, scth.y);\n\tvar scphi = vec2f(sqrt(1.0 - ang.y * ang.y), ang.y);\n\treturn vec3f(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}\n\nfn decodeNormalInt (enc: u32) -> vec3f {\n\tvar xy = vec2f(f32(enc & 0xffff), f32((enc >> 16) & 0xffff)) / 65535.0;\n\treturn decodeNormal(xy);\n}",pack_depth:t_,mat_inverse:"\nfn inverse2(m: mat2x2f) -> mat2x2f {\n\treturn mat2x2f(\n\t\tm[1][1],-m[0][1],\n\t\t-m[1][0], m[0][0]\n\t) * (1.0 / (m[0][0]*m[1][1] - m[0][1]*m[1][0]));\n}\n\nfn inverse3(m: mat3x3f) -> mat3x3f {\n\tvar a00 = m[0][0]; var a01 = m[0][1]; var a02 = m[0][2];\n\tvar a10 = m[1][0]; var a11 = m[1][1]; var a12 = m[1][2];\n\tvar a20 = m[2][0]; var a21 = m[2][1]; var a22 = m[2][2];\n\n\tvar b01 = a22 * a11 - a12 * a21;\n\tvar b11 = -a22 * a10 + a12 * a20;\n\tvar b21 = a21 * a10 - a11 * a20;\n\n\tvar det = a00 * b01 + a01 * b11 + a02 * b21;\n\n\treturn mat3x3f(\n\t\tb01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n\t\tb11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n\t\tb21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)\n\t) * (1.0 / det);\n}\n\nfn inverse4(m: mat4x4f) -> mat4x4f {\n\tvar a00 = m[0][0]; var a01 = m[0][1]; var a02 = m[0][2]; var a03 = m[0][3];\n\tvar a10 = m[1][0]; var a11 = m[1][1]; var a12 = m[1][2]; var a13 = m[1][3];\n\tvar a20 = m[2][0]; var a21 = m[2][1]; var a22 = m[2][2]; var a23 = m[2][3];\n\tvar a30 = m[3][0]; var a31 = m[3][1]; var a32 = m[3][2]; var a33 = m[3][3];\n\n\tvar b00 = a00 * a11 - a01 * a10;\n\tvar b01 = a00 * a12 - a02 * a10;\n\tvar b02 = a00 * a13 - a03 * a10;\n\tvar  b03 = a01 * a12 - a02 * a11;\n\tvar  b04 = a01 * a13 - a03 * a11;\n\tvar  b05 = a02 * a13 - a03 * a12;\n\tvar  b06 = a20 * a31 - a21 * a30;\n\tvar  b07 = a20 * a32 - a22 * a30;\n\tvar b08 = a20 * a33 - a23 * a30;\n\tvar b09 = a21 * a32 - a22 * a31;\n\tvar b10 = a21 * a33 - a23 * a31;\n\tvar b11 = a22 * a33 - a23 * a32;\n\n\tvar det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n\treturn mat4x4f(\n\t\ta11 * b11 - a12 * b10 + a13 * b09,\n\t\ta02 * b10 - a01 * b11 - a03 * b09,\n\t\ta31 * b05 - a32 * b04 + a33 * b03,\n\t\ta22 * b04 - a21 * b05 - a23 * b03,\n\t\ta12 * b08 - a10 * b11 - a13 * b07,\n\t\ta00 * b11 - a02 * b08 + a03 * b07,\n\t\ta32 * b02 - a30 * b05 - a33 * b01,\n\t\ta20 * b05 - a22 * b02 + a23 * b01,\n\t\ta10 * b10 - a11 * b08 + a13 * b06,\n\t\ta01 * b08 - a00 * b10 - a03 * b06,\n\t\ta30 * b04 - a31 * b02 + a33 * b00,\n\t\ta21 * b02 - a20 * b04 - a23 * b00,\n\t\ta11 * b07 - a10 * b09 - a12 * b06,\n\t\ta00 * b09 - a01 * b07 + a02 * b06,\n\t\ta31 * b01 - a30 * b03 - a32 * b00,\n\t\ta20 * b03 - a21 * b01 + a22 * b00\n\t) * (1.0 / det);\n}\n\nfn getMat3(m: mat4x4f) -> mat3x3f {\n\treturn mat3x3f(\n\t\tm[0].xyz,\n\t\tm[1].xyz,\n\t\tm[2].xyz\n\t);\n}\n\nfn getNormalMatrix(m: mat4x4f) -> mat3x3f\n{\n\tvar nm = getMat3(m);\n\treturn transpose(inverse3(nm));\n}\n",tonemap:jx,envMapSample:n_(!0,!1,!0),hatch:qx,heatmapDecl:"fn lmap(value: f32, inMin: f32, inMax: f32, outMin: f32, outMax: f32) -> f32 {\n    return clamp(outMin + ((outMax - outMin) * (value - inMin)) / (inMax - inMin), outMin, outMax);\n}\n\n// Gradient with multiple colors in non-equal intervals\nfn colormap(x: f32) -> vec3f {\n    var colorsAndStops = ibl.colorsAndStops;\n    for (var i = 1; i < NUM_STOPS; i++) {\n        if (x <= colorsAndStops[i].stop) {\n            var stopPct = lmap(x, colorsAndStops[i - 1].stop, colorsAndStops[i].stop, 0.0, 1.0);\n            return mix(colorsAndStops[i - 1].color, colorsAndStops[i].color, stopPct);\n        }\n    }\n\n    // In case 'x' goes beyond upper bound.\n    return colorsAndStops[NUM_STOPS - 1].color;\n}\n",heatmap:"var sensorCount = materialUniforms.heatmapSensorCountAndOffset & 0x000000ff;\nif (sensorCount > 0) {\n\n    var sensorOffset = materialUniforms.heatmapSensorCountAndOffset >> 8;\n    var heatResult: f32 = 0.0;\n    var heatSum: f32 = 0.0;\n    var heatWsum: f32 = 0.000001;\n    var heatFound: bool = false; // at exact location of the sensor\n    var heatmapAlpha = ibl.heatmapAlpha;\n\n    for (var i = sensorOffset; i < sensorOffset + sensorCount; i++) {\n        var mydist = distance(in.vWorldPosition, heatmapSensors[i].xyz);\n        if (mydist < 0.00001) {\n            // So the exact pixel of the sensor will get the right color, but pretty much nothing beside it.\n            heatResult = heatmapSensors[i][3];\n            heatFound = true;\n        } else {\n            var w = (1.0 / (mydist * mydist));\n            heatSum += (heatmapSensors[i][3] * w);\n            heatWsum += w;\n        }\n    }\n\n    if (!heatFound) {\n        heatResult = heatSum / heatWsum;\n    }\n\n    // Defaults without influence from any sensor\n    var sensorColor = vec3f(0.5);\n    if (heatResult >= 0.0) {\n        heatResult = clamp(heatResult, 0.0, 1.0);\n        sensorColor = colormap(heatResult);\n    }\n\n    // If this chunk is used in shaders that render ghosted objects, we need to check for that and don't apply the\n    // heatmap color, i.e. use 'ghosted ? 0.0 : heatmapAlpha' below.\n    output.color = vec4f(mix(vec3f(luminance_post(output.color.rgb)), sensorColor, heatmapAlpha), output.color.a);\n    if (heatmapAlpha > 0.0) {\n        output.color[3] = max(output.color.a, heatmapAlpha);\n    }\n}\n",metalMaterial:e.metal,hasUV:t,hasTextures:i,hasVertexColors:n,isUVW:r})}function P_(e,t,i,n,r,o){let s=e.__gpuPipelineHash;s||(s=function(e,t,i,n){let r=e.__gpuPipelineHash;if(r)return r;r=255&e.vbstride;const o=e.attributesInterleaved||e.attributes;for(let e in o){let t=o[e];switch(e){case"position":0!==t.itemOffset&&console.log("unexpected itemOffset"),r|=256;break;case"normal":3!==t.itemOffset&&console.log("unexpected itemOffset"),2===t.bytesPerItem?r|=512:r|=1024;break;case"uv":case"uvw":i&&(3===t.itemOffset?r|=2048:4===t.itemOffset?r|=4096:6===t.itemOffset?r|=6144:console.log("unexpected itemOffset for color channel",t.itemOffset));break;case"color":n&&(3===t.itemOffset?r|=8192:4===t.itemOffset?r|=16384:6===t.itemOffset?r|=24576:8===t.itemOffset?r|=32768:console.log("unexpected itemOffset"))}}let s=0;return e.isLines&&(s=1),r|=s<<16,e.__gpuPipelineHash=r,r}(e,e.isLines,n,r));let a=t.__gpuPipelineHash;return!t.needsUpdate&&a||(a=function(e,t){let i=16777216;if(e.depthWrite&&(i|=1),e.depthTest&&(i|=2),e.depthFunc)switch(e.depthFunc){case"less":i|=4;break;case"less-equal":i|=8;break;case"greater":i|=12;break;case"greater-equal":i|=16;break;case"never":i|=20;break;case"always":i|=24;break;default:console.warn("unsupported depthFunc",e.depthFunc)}else i|=8;return i|=(e.side||0)<<5,i|=t?128:0,i|=e.isRoomMaterial&&e.heatmapSensorCount?256:0,e.__gpuPipelineHash=i,i}(t,o)),s|a<<17}function L_(e,t,i,n,r){let o=[],s=n&&e.attributes.color;if(e.vb){let a={arrayStride:4*e.vbstride,attributes:[]};const l=e.attributesInterleaved||e.attributes;"position"in l&&a.attributes.push({shaderLocation:0,offset:4*l.position.itemOffset,format:"float32x3"}),!e.isLines&&t&&a.attributes.push({shaderLocation:1,offset:4*l.normal.itemOffset,format:"uint32"}),i&&(r?a.attributes.push({shaderLocation:s?3:2,offset:4*l.uvw.itemOffset,format:"float32x3"}):a.attributes.push({shaderLocation:s?3:2,offset:4*l.uv.itemOffset,format:"float32x2"})),n&&a.attributes.push({shaderLocation:2,offset:4*l.color.itemOffset,format:"float32x3"}),o.push(a)}else console.log("non-interleaved buffer geometry not yet done");return o}function R_(e){let t=[],i={arrayStride:4*e.vbstride,attributes:[]};return i.attributes.push({shaderLocation:0,offset:0,format:"float32x2"}),i.attributes.push({shaderLocation:1,offset:8,format:"float32x4"}),i.attributes.push({shaderLocation:2,offset:24,format:"unorm8x4"}),i.attributes.push({shaderLocation:3,offset:28,format:"uint8x4"}),i.attributes.push({shaderLocation:4,offset:32,format:"uint8x4"}),i.attributes.push({shaderLocation:5,offset:36,format:"uint8x4"}),i.attributes.push({shaderLocation:6,offset:i.arrayStride-8,format:"float32x2"}),t.push(i),t}function D_(e){return{materialHasLineStyles:!!e.hasLineStyles,isSelectionHighlight:!!e.defines.SELECTION_RENDERER}}const O_=1,B_=2;class N_{#e;#Dt;#ki=new Map;#vn;#yn;#bn;#xn;#_n;#En;constructor(e){this.#e=e,this.#Dt=e.getDevice(),this.#_n=this.#e.getVB(),this.#En=P_}#Fi(e,t,i,n){const r=t.attributes,o=!(!r.color||!i.vertexColors),s=!!r.uvw,a=!!r.uv||s,l=a&&0!==n,c=!(!r.normal||i instanceof THREE.MeshBasicMaterial);let u;if(t.isLines){let e=this.#Dt.createShaderModule({code:Im("$frameBindGroup\n$objectUniforms\n\nstruct VertexOutput {\n    @builtin(position) Position : vec4f,\n    @location(0) @interpolate(flat) instance: u32,\n    @location(4) vWorldPosition: vec3f\n}\n\n@vertex\nfn vsmain(\n    @location(0) position : vec3f,\n    @builtin(instance_index) instance : u32\n) -> VertexOutput {\n\n    var objectUniforms = getObjectUniforms(instance);\n\n    var output : VertexOutput;\n    var pos4 = vec4f(position.x, position.y, position.z, 1.0);\n\n    var mvMatrix = uniforms.viewMatrix * objectUniforms.modelMatrix;\n    var mvPosition = mvMatrix * pos4;\n\n    output.Position = uniforms.projectionMatrix * mvPosition;\n    output.vWorldPosition = (objectUniforms.modelMatrix * pos4).xyz;\n\n    output.instance = instance;\n\n    //TODO: world position for cutplanes\n\n    return output;\n}\n\nstruct PixelOutput {\n    @location(0) color: vec4f,\n    @location(1) normal: vec4f,\n    @location(2) viewDepth: vec4f,\n    @location(3) dbId: vec4u,\n    @location(4) modelId: vec4u\n    //@location(4) objectFlags: vec4u,\n}\n\n@fragment\nfn psmain(\n    in: VertexOutput,\n) -> PixelOutput {\n\n    var output: PixelOutput;\n\n    var objectUniforms = getObjectUniforms(in.instance);\n    var materialUniforms = getMaterialUniforms(objectUniforms.materialIndex);\n\n    //TODO: vertex color\n    var diffuse = intToVecf(materialUniforms.diffuse);\n\n    //check doNotCut flag\n    if (commonMaterialUniforms.doNotCutOverride + (materialUniforms.renderFlags & 2) == 0) {\n        checkCutPlanes(in.vWorldPosition);\n    }\n\n    //For line geometry, we just return the color as is\n    output.color = diffuse;\n    output.normal = vec4f(0.0);\n    output.viewDepth = vec4f(0.0);\n    output.dbId = intToVec(objectUniforms.dbId);\n    output.modelId = intToVec(objectUniforms.modelId);\n\n    return output;\n}\n",{frameBindGroup:M_.getDeclaration(0),objectUniforms:Dm(1)})});u=this.#Dt.createRenderPipeline({label:"uber shader lines",layout:this.#Dt.createPipelineLayout({bindGroupLayouts:this.#bn}),vertex:{module:e,entryPoint:"vsmain",buffers:L_(t,!1,!1,!1,!1)},fragment:{module:e,entryPoint:"psmain",targets:this.#xn},primitive:{topology:"line-list",cullMode:"none"},depthStencil:{depthWriteEnabled:i.depthWrite,depthCompare:i.depthTest?i.depthFunc||"less-equal":"always",format:Zx}})}else{let n;n=c?this.#Dt.createShaderModule({label:"uber shader triangles ("+e+")",code:I_(i,a,l,o,s)}):this.#Dt.createShaderModule({label:"basic shader triangles ("+e+")",code:Im("\tdiagnostic(off, derivative_uniformity);\n\n\t$frameBindGroup\n\t$objectUniforms\n\t$materialUniforms\n\t$pack_depth\n\n\tstruct VertexOutput {\n\t\t@builtin(position) Position : vec4f,\n\t\t@location(0) @interpolate(flat) instance: u32,\n\t\t@location(1) vViewPosition: vec3f,\n\t\t@location(2) vWorldPosition: vec3f,\n\t\t@location(3) depth: f32,\n\t}\n\n\tstruct VertexInput {\n\t\t@location(0) position : vec3f,\n\t}\n\n\t@vertex fn vsmain(\n\t\tin: VertexInput,\n\t\t@builtin(instance_index) instance : u32\n\t) -> VertexOutput {\n\n\t\tvar objectUniforms = getObjectUniforms(instance);\n\n\t\tvar output : VertexOutput;\n\t\tvar pos4 = vec4f(in.position.x, in.position.y, in.position.z, 1.0);\n\n\t\tvar mvMatrix   = uniforms.viewMatrix * objectUniforms.modelMatrix;\n\t\tvar mvPosition = mvMatrix * pos4;\n\n\t\toutput.Position       = uniforms.projectionMatrix * mvPosition;\n\t\toutput.vViewPosition  = -mvPosition.xyz;\n\t\toutput.vWorldPosition = (objectUniforms.modelMatrix * pos4).xyz;\n\t\toutput.instance       = instance;\n\t\toutput.depth          = mvPosition.z;\n\n\t\treturn output;\n\t}\n\n\tstruct PixelOutput {\n\t\t@location(0) color: vec4f,\n\t\t@location(1) normal: vec4f, // Actually, we have no proper normal, but the current pipeline requires a normal output\n\t\t@location(2) viewDepth: vec4f,\n\t\t@location(3) dbId: vec4u,\n\t\t@location(4) modelId: vec4u,\n\t}\n\n\t@fragment fn psmain(\n\t\tin: VertexOutput\n\t) -> PixelOutput\n\t{\n\t\tvar output: PixelOutput;\n\t\tvar objectUniforms = getObjectUniforms(in.instance);\n\t\tvar materialUniforms = getMaterialUniforms(objectUniforms.materialIndex);\n\n\t\t//check doNotCut flag\n\t\tif (commonMaterialUniforms.doNotCutOverride + (materialUniforms.renderFlags & 2) == 0) {\n\t\t\tcheckCutPlanes(in.vWorldPosition);\n\t\t}\n\n\t\t// Forward rgba from material\n\t\toutput.color = intToVecf(materialUniforms.diffuse);\n\n\t\t// We don't have a normal and don't use lighting.\n\t\t// By setting the 4th component of viewDepth to 0, we indicate that no valid\n\t\t// normal is written. In this way, SAO handles it like background pixels and doesn't randomly change the color.\n\t\tconst normalValid = 0.0;\n\t\toutput.normal = vec4f(0,0,0,0);\n\n\t\t// Write viewDepth\n\t\tvar unitDepth = (-in.depth - uniforms.near) / (uniforms.far - uniforms.near);\n\t\toutput.viewDepth = vec4f(packDepth10(unitDepth), normalValid);\n\n\t\t// Store object identity information\n\t\toutput.dbId = intToVec(objectUniforms.dbId);\n\t\toutput.modelId = intToVec(objectUniforms.modelId | (objectUniforms.objectFlags << 16));\n\n\t\treturn output;\n\t}\n",{frameBindGroup:M_.getDeclaration(0),objectUniforms:Dm(1),materialUniforms:y_(2),pack_depth:t_})}),u=this.#Dt.createRenderPipeline({label:"uber pipeline triangles ("+e+")",layout:this.#Dt.createPipelineLayout({bindGroupLayouts:this.#bn}),vertex:{module:n,entryPoint:"vsmain",buffers:L_(t,c,a,o,s)},fragment:{module:n,entryPoint:"psmain",targets:this.#xn},primitive:{topology:"triangle-list",cullMode:s_(i.side)},depthStencil:{depthWriteEnabled:i.depthWrite,depthCompare:i.depthTest?i.depthFunc||"less-equal":"always",format:Zx,depthBias:i.isRoomMaterial&&i.heatmapSensorCount?1:2,depthBiasSlopeScale:i.isRoomMaterial&&i.heatmapSensorCount?.5:1}})}return this.#ki.set(e,u),u}reset(e,t){this.#vn=null,this.#yn=null,this.#bn=e,this.#xn=t}#Sn(e,t){let i=0|t.__gpuUniformsMask;return i!==b_.NO_UNIFORMS||t.needsUpdate?((0===i||t.needsUpdate)&&(i=function(e,t,i){let n=E_(t);if(0!==n){t.__gpuMaterialUniforms&&S_({target:t});const n=new __(e,t,i);t.__gpuMaterialUniforms=n,t.addEventListener("dispose",S_)}return A_&&t.addEventListener("update",A_),t.__gpuUniformsMask=n|=b_.NO_UNIFORMS,n}(this.#Dt,t,this.#e.getPlaceholderTexture()),this.#yn=null),i===b_.NO_UNIFORMS?0:(this.#yn!==t&&(e.setBindGroup(2,t.__gpuMaterialUniforms.getBindGroup()),this.#yn=t),i)):0}drawOne(e,t,i,n){const r=this.#Sn(e,n)&b_.TEXTURE_MASK,o=i.attributes,s=o.color&&n.vertexColors,a=o.uv,l=a&&0!==r,c=this.#En(i,n,!0,a,s,l);let u=this.#ki.get(c);return u||(u=this.#Fi(c,i,n,r)),u!==this.#vn&&(e.setPipeline(u),this.#vn=u),this.#_n.draw(e,i,t),r}}const U_='\nfn orderedDithering(coord: vec2i) -> f32 {\n\n\t//Matrix for 4x4 ordered dithering. (http://en.wikipedia.org/wiki/Ordered_dithering)\n\tconst thresholdMatrix = mat4x4f(\n\t\t 1.0,  9.0,  3.0, 11.0,\n\t\t13.0,  5.0, 15.0,  7.0,\n\t\t 4.0, 12.0,  2.0, 10.0,\n\t\t16.0,  8.0, 14.0,  6.0) * (1.0 / 17.0);\n\n\tvar i = coord.x & 3;\n\tvar j = coord.y & 3;\n\n\treturn thresholdMatrix[i][j];\n\n}\n\n\n//Screen door transparency for "ghosted" elements, indicated by opacity < 0\nfn checkGhosting(coord: vec2i, isGhosted: bool) {\n\tif (isGhosted) {\n\t\tif (orderedDithering(coord) < 0.5) {\n\t\t\tdiscard;\n\t\t}\n\t}\n}\n';function k_(){return Im("$ghosting\n$frameBindGroup\n$objectUniforms\n$materialUniforms\n\n\nstruct VertexOutput {\n    @builtin(position) Position : vec4f,\n    @location(0) @interpolate(flat) instance: u32,\n    @location(4) vWorldPosition: vec3f\n}\n\n@vertex\nfn vsmain(\n    @location(0) position : vec3f,\n    @builtin(instance_index) instance : u32\n) -> VertexOutput {\n\n    var objectUniforms = getObjectUniforms(instance);\n\n    var output : VertexOutput;\n    var pos4 = vec4f(position.x, position.y, position.z, 1.0);\n\n    var mvMatrix = uniforms.viewMatrix * objectUniforms.modelMatrix;\n    var mvPosition = mvMatrix * pos4;\n\n    output.Position = uniforms.projectionMatrix * mvPosition;\n    output.vWorldPosition = (objectUniforms.modelMatrix * pos4).xyz;\n\n    //TODO: world position for cutplanes\n\n    output.instance = instance;\n\n    return output;\n}\n\n@fragment\nfn psmain(\n    in: VertexOutput\n) -> @location(0) vec4f {\n\n    var objectUniforms = getObjectUniforms(in.instance);\n    var materialUniforms = getMaterialUniforms(objectUniforms.materialIndex);\n\n    //check doNotCut flag\n    if (commonMaterialUniforms.doNotCutOverride + (materialUniforms.renderFlags & 2) == 0) {\n        checkCutPlanes(in.vWorldPosition);\n    }\n\n    var color = intToVecf(commonMaterialUniforms.edgeColor);\n\n    // Disabled stippling effect for now. Used only by Tandem.\n    // #if $ghosted\n    // checkGhosting(vec2i(floor(in.Position.xy)), true);\n    // #endif\n\n    return vec4(color.r, color.g, color.b, color.a);\n}\n",{ghosting:U_,ghosted:arguments.length>0&&void 0!==arguments[0]&&arguments[0],frameBindGroup:M_.getDeclaration(0),objectUniforms:Dm(1),materialUniforms:y_(2)})}class F_{#e;#Dt;#ki=new Map;#vn;#bn;#xn;#_n;#En=P_;constructor(e){this.#e=e,this.#Dt=e.getDevice()}#Fi(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.#Dt.createShaderModule({code:k_(n)}),o=this.#Dt.createRenderPipeline({layout:this.#Dt.createPipelineLayout({bindGroupLayouts:this.#bn}),vertex:{module:r,entryPoint:"vsmain",buffers:L_(t,!1,!1,!1,!1)},fragment:{module:r,entryPoint:"psmain",targets:this.#xn},primitive:{topology:"line-list",cullMode:"none"},depthStencil:{depthWriteEnabled:i.depthWrite,depthCompare:i.depthTest?i.depthFunc||"less-equal":"always",format:Zx,depthBias:0,depthBiasSlopeScale:0}});return this.#ki.set(e,o),o}reset(e,t){this.#vn=null,this.#bn=e,this.#xn=t,this.#_n=this.#e.getVB()}drawOne(e,t,i,n){if(i.isLines)return;let r=this.#En(i,n,!1,!1,!1),o=this.#ki.get(r);o||(o=this.#Fi(r,i,n)),o!==this.#vn&&(e.setPipeline(o),this.#vn=o),this.#_n.drawEdges(e,i,t)}drawOneGhosted(e,t,i,n){let r=this.#En(i,n,!1,!1,!1,!0),o=this.#ki.get(r);o||(o=this.#Fi(r,i,n,!0)),o!==this.#vn&&(e.setPipeline(o),this.#vn=o),i.isLines?this.#_n.draw(e,i,t):this.#_n.drawEdges(e,i,t)}}const V_=0,G_=4,z_=5,H_=8,W_=0,j_=1,q_=2,K_=3,X_=4,Y_=5;class Q_{static getUniformsDeclaration(e){return Im("struct LineMaterialUniforms {\n    selectionColor: vec4f, // needed for selection highlights\n\thasTexture: u32,\n    hasLayers: u32,\n    padding1: u32,\n    padding2: u32,\n}\n@group($group) @binding(0) var<uniform> lineMat: LineMaterialUniforms;\n@group($group) @binding(1) var rasterTexture : texture_2d<f32>;\n@group($group) @binding(2) var rasterSampler : sampler;\n@group($group) @binding(3) var selectionTexture : texture_2d<f32>; // only used for selection\n@group($group) @binding(4) var layerTexture : texture_2d<f32>; // only used when hasLayers = 1\n@group($group) @binding(5) var layerSampler : sampler; // only used when hasLayers = 1\n",{group:e})}#Dt;#Vi;#Gi;#An;#ui;#wn;#Cn;#Tn=new THREE.Vector4(0,0,1,1);constructor(e){this.#Dt=e.getDevice(),this.#Vi=e.getPlaceholderTexture(),this.#Gi=new a_(this.#Dt),this.#An=this.#Dt.createSampler({label:"2d layer sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest"}),this.#ui=this.#Dt.createBindGroupLayout({entries:[{binding:W_,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,buffer:{}},{binding:j_,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:q_,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:K_,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,texture:{sampleType:"float"}},{binding:X_,visibility:GPUShaderStage.VERTEX,texture:{sampleType:"float"}},{binding:Y_,visibility:GPUShaderStage.VERTEX,sampler:{}}]}),this.#wn=this.handleUpdate.bind(this),this.#Cn=this.handleDispose.bind(this)}getLayout(){return this.#ui}initMaterial(e){var t,i,n,r;let o,s;e.__buffer||(e.__buffer=new Ax(this.#Dt,H_,!0,!1));const a=null===(t=e.uniforms.tRaster)||void 0===t?void 0:t.value;a&&d_(this.#Dt,this.#Gi,a),a&&a.__gpuTexture?(e.__buffer.setInt(G_,1),o=a.__gpuTexture.createView(),s=a.__gpuSampler):(e.__buffer.setInt(G_,0),o=this.#Vi.view,s=this.#Vi.sampler);const l=(null===(i=e.uniforms.selectionColor)||void 0===i?void 0:i.value)||this.#Tn;e.__buffer.setVector4(V_,l);let c=null;const u=null===(n=e.uniforms.tSelectionTexture)||void 0===n?void 0:n.value;u&&d_(this.#Dt,this.#Gi,u),c=u&&u.__gpuTexture?u.__gpuTexture.createView():this.#Vi.view;const h=null===(r=e.uniforms.tLayerMask)||void 0===r?void 0:r.value;let d;h&&d_(this.#Dt,this.#Gi,h),h&&h.__gpuTexture?(e.__buffer.setInt(z_,1),d=h.__gpuTexture.createView()):(e.__buffer.setInt(z_,0),d=this.#Vi.view),e.__buffer.upload(),e.__gpuBindGroup=this.#Mn(e.__buffer.getBuffer(),o,s,c,d),e.needsUpdate=!1,e.hasEventListener("dispose",this.#Cn)||e.addEventListener("dispose",this.#Cn),e.hasEventListener("update",this.#wn)||e.addEventListener("update",this.#wn)}updateTextures(e){var t,i,n;const r=null===(t=e.uniforms.tRaster)||void 0===t?void 0:t.value;r&&r.needsUpdate&&d_(this.#Dt,this.#Gi,r);const o=null===(i=e.uniforms.tSelectionTexture)||void 0===i?void 0:i.value;o&&o.needsUpdate&&d_(this.#Dt,this.#Gi,o);const s=null===(n=e.uniforms.tLayerMask)||void 0===n?void 0:n.value;s&&s.needsUpdate&&d_(this.#Dt,this.#Gi,s)}handleUpdate(e){this.initMaterial(e.target)}handleDispose(e){var t;const i=e.target;var n;(i.removeEventListener("dispose",this.#Cn),i.__buffer)&&(null===(n=i.__buffer.getBuffer())||void 0===n||n.destroy(),i.__buffer=null);const r=null===(t=i.uniforms.tRaster)||void 0===t?void 0:t.value;r&&r.dispose()}#Mn(e,t,i,n,r){return this.#Dt.createBindGroup({layout:this.#ui,entries:[{binding:W_,resource:{buffer:e}},{binding:j_,resource:t},{binding:q_,resource:i},{binding:K_,resource:n},{binding:X_,resource:r},{binding:Y_,resource:this.#An}]})}}class Z_ extends Ax{#Dt;#ui;#hi;#In;#Pn;constructor(e){super(e,16,!0,!0),this.setFloat(5,0),this.setFloat(7,1),this.#Dt=e,this.#ui=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.#Pn=this.#Dt.createBuffer({size:64,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.setInt(8,0),this.setMiterData(sf,af,lf),this.#Mn()}#Mn(){this.#hi=this.#Dt.createBindGroup({layout:this.#ui,entries:[{binding:0,resource:{buffer:this.getBuffer()}},{binding:1,resource:{buffer:this.#Pn}}]})}updatePixelScale(e,t){if(this.#In=e,this.setFloat(1,.5),null!=t&&t.isPerspective){const e=t.fov*Math.PI/180;this.setFloat(6,Math.tan(.5*e))}else this.setFloat(6,0);this.setFloat(0,e)}setLineStyleBuffer(e,t){this.#Pn&&this.#Pn.size!==e.byteLength&&(this.#Pn.destroy(),this.#Pn=null),this.#Pn||(this.#Pn=this.#Dt.createBuffer({size:e.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})),this.#Dt.queue.writeBuffer(this.#Pn,0,e.buffer,0,e.byteLength),this.setInt(8,t)}setTargetSize(e,t){this.setFloat(2,e),this.setFloat(3,t)}setMiterData(e,t,i){this.setFloat(9,e),this.setFloat(10,t),this.setFloat(11,i)}getLayout(){return this.#ui}getBindGroup(){return this.#hi}}class $_{#e;#Dt;#ki=new Map;#Ln;#vn=null;#Rn=null;#xn;#_n;#Dn;constructor(e){this.#e=e,this.#Dt=e.getDevice(),this.#_n=this.#e.getVB(),this.#Dn=new Q_(e)}static#On(e){return Im("$frameBindGroup\n$objectUniforms\n$lineUniforms\n$lineMaterialUniforms\n$hatch\n\nconst hatchTintColor = vec3f(1, 1, 1);\n\n// Common defines\nconst TAU = 6.28318530718;\nconst PI = 3.14159265358979;\nconst HALF_PI = 1.57079632679;\nconst PI_1_5 = 4.71238898038; // 1.5 * PI\n\n// discard fragments if they belong to ghosted layers\n@id(0) override ENABLE_ID_DISCARD: u32 = 1;\n\n// Geometry type defines\nconst VBB_GT_TRIANGLE_INDEXED = 0;\nconst VBB_GT_LINE_SEGMENT     = 1;\nconst VBB_GT_ARC_CIRCULAR     = 2;\nconst VBB_GT_ARC_ELLIPTICAL   = 3;\nconst VBB_GT_TEX_QUAD         = 4;\nconst VBB_GT_ONE_TRIANGLE     = 5;\nconst VBB_GT_MSDF_TRIANGLE_INDEXED = 6;\nconst VBB_GT_TEX_TRIANGLE_INDEXED = 7;\nconst VBB_GT_LINE_SEGMENT_CAPPED = 8;\nconst VBB_GT_LINE_SEGMENT_CAPPED_START = 9;\nconst VBB_GT_LINE_SEGMENT_CAPPED_END = 10;\nconst VBB_GT_LINE_SEGMENT_MITER = 11;\n\n// ID defines\nconst VBB_INSTANCED_FLAG   = 0;\nconst VBB_SEG_START_RIGHT  = 0;\nconst VBB_SEG_START_LEFT   = 1;\nconst VBB_SEG_END_RIGHT    = 2;\nconst VBB_SEG_END_LEFT     = 3;\n\n// Defines scaling of line style patterns (e.g. for dashed and dotted lines)\n// We define some fixed scaling here.\n//\n// Why 0.25?: The choice is currently sort-of arbitrary - just manually adjusted\n//           to look reasonable when drawing into 2D overlays. If this is not sufficient, we could make it\n//           adjustable per shader parameter.\n//\n// AutoCAD will scale patterns based on the LTSCALE setting, and currently this is ignored here.\nconst LTSCALE = 0.25;\n\n//Attributes\nstruct VsInput {\n\t@builtin(instance_index) instance : u32,\n\t@location(0) fields1: vec2f,\n\t@location(1) fields2: vec4f,\n\t@location(2) color4b: vec4f,\n\t@location(3) dbId4b: vec4u,\n\t@location(4) flags4b: vec4u,\n\t@location(5) layerVp4b: vec4u,\n\t@location(6) extraParams: vec2f,\n}\n\n// Varyings\nstruct VsOutput {\n\t@builtin(position) position : vec4f,\n\t//TODO: most of these should be tagged @interpolate(flat)\n\t@location(0) @interpolate(flat) fsColor: vec4f,\n\t@location(1) fsOffsetDirection: vec2f,\n\t@location(2) fsMultipurpose: vec4f,\n\t//fsGeomType: f32,\n\t@location(3) @interpolate(flat) fsHalfWidth: f32,\n\t@location(4) fsVpTC: vec2f,\n\t@location(5) @interpolate(flat) fsGhosting: f32,\n\t@location(6) @interpolate(flat) dbId: vec4u,\n\t@location(7) vWorldPosition: vec3f, //for cutplanes\n\t@location(8) @interpolate(flat) instance: u32,\n#if $materialHasLineStyles\n\t@location(9) vPixelsPerUnit: f32\n#endif\n}\n\n// used internally by the VS\nvar<private> centralVertex: vec2f;\nvar<private> offsetPosition: vec2f;\nvar<private> offsetPosDepth: vec2f;\nvar<private> mvpMatrix: mat4x4f;\n\nfn cos_sin(angle: f32) -> vec2f {\n\treturn vec2f(cos(angle), sin(angle));\n}\n\nfn getVertexId(in: VsInput) -> u32 { return in.flags4b.x; }\n\nfn isStartVertex(in: VsInput) -> bool { return (getVertexId(in) < VBB_SEG_END_RIGHT); }\nfn isLeftVertex(in: VsInput) -> bool  { var id = getVertexId(in); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\n\nfn min_max(minPt: ptr<function, vec2f>, maxPt: ptr<function, vec2f>, p: vec2f) {\n\t*minPt = min(*minPt, p);\n\t*maxPt = max(*maxPt, p);\n}\n\nfn setMvp(instance: u32) {\n\tvar objectUniforms = getObjectUniforms(instance);\n\tmvpMatrix = uniforms.projectionMatrix * uniforms.viewMatrix * objectUniforms.modelMatrix;\n}\n\n// Get the 2d screenspace position of a model-space position.\nfn posToSs(pos: vec4f) -> vec2f {\n\treturn clipPosToSs(mvpMatrix * pos);\n}\n\n// Get the 2d screenspace position of a clip-space position.\n// Visible positions will be within [0, width] x [0, height].\nfn clipPosToSs(clip: vec4f) -> vec2f {\n\treturn (clip.xy / clip.w + vec2f(1)) * 0.5 * u.size;\n}\n\n// Get the 2d screenspace transformation of a model-space vector.\nfn vecToSs(inVec: vec4f) -> vec2f {\n\tvar clip = mvpMatrix * inVec;\n\t// Don't divide by w, and don't translate vectors.\n\treturn clip.xy * 0.5 * u.size;\n}\n\n// Convert screenspace position back to clip space position.\nfn ssToClip(ssPos: vec2f, clipZw: vec2f) -> vec4f {\n\treturn vec4((ssPos / u.size * 2.0 - vec2f(1)) * clipZw[1], clipZw);\n}\n\nstruct SegmentData {\n\tangle: f32,\n\tdistAlong: f32,\n\tdistTotal: f32,\n\tlineWidthHalf: f32,\n\tlineType: u32\n};\n\nfn decodeSegmentData(in: VsInput) -> SegmentData {\n\tvar seg: SegmentData;\n\tseg.angle         = in.fields2.x * TAU - PI;\n\tseg.distAlong     = in.fields2.y;\n\tseg.distTotal     = in.fields2.w;\n\tseg.lineWidthHalf = in.fields2.z;\n\tseg.lineType      = in.flags4b.z;\n\n\treturn seg;\n}\n\nfn strokeLineSegment(in: VsInput, geomType: u32, out: ptr<function, VsOutput>) {\n\tvar seg = decodeSegmentData(in);\n\n\t//Compute output point based on start point plus segment length and direction\n\t//This is because the line segment's 4 vertices are all equal to the start\n\t//point to begin with. We move the vertex to the correct place in the quad\n\t//based on vertex flags indicating whether it's left/right/top/bottom vertex in the\n\t//quad.\n\tvar isStartCapVertex = select(1.0, -1.0, isStartVertex(in));\n\tvar isLeftSide = select(-1.0, 1.0, isLeftVertex(in));\n\n\t// Clip-space start position\n\tvar clipStart = (mvpMatrix * vec4f(centralVertex.xy, 0.0, 1.0));\n\n\tvar distanceAlong = seg.distAlong;\n\tvar along = distanceAlong * cos_sin(seg.angle);\n\n\tvar clipEnd = (mvpMatrix * vec4f(centralVertex.xy + along, 0.0, 1.0));\n\n\tvar screenStart = clipPosToSs(clipStart);\n\tvar screenEnd = clipPosToSs(clipEnd);\n\tvar roundedEnd = 0.0;\n\n\tif (isStartCapVertex < 0.0) {\n\t\toffsetPosition = screenStart;\n\t\tcentralVertex = screenStart;\n\t\toffsetPosDepth = clipStart.zw;\n\t\t// use 0.5 instead of 1.0 so that floor(roundedEnd)==roundedEnd\n\t\troundedEnd = select(0.0, 0.5, geomType == VBB_GT_LINE_SEGMENT || geomType == VBB_GT_LINE_SEGMENT_CAPPED_END);\n\t} else {\n\t\toffsetPosition = screenEnd;\n\t\tcentralVertex = screenEnd;\n\t\toffsetPosDepth = clipEnd.zw;\n\t\t// use 0.5 instead of 1.0 so that floor(roundedEnd)==roundedEnd\n\t\troundedEnd = select(0.0, 0.5, geomType == VBB_GT_LINE_SEGMENT || geomType == VBB_GT_LINE_SEGMENT_CAPPED_START);\n\t}\n\n#if $materialHasLineStyles\n\t// For consistency, disable butt capped ends for any pattern other\n\t// than a solid line (seg.lineType will be >0 and thus roundedEnd\n\t// will be >0, i.e., true)\n\t// See note in fragment shader\n\n\t// transport roundedEnd as fractional part of the integer lineType\n\troundedEnd += seg.lineType;\n#endif\n\n\t// Apply transverse line width offset to the start/endpoint\n\tvar screenDelta = screenEnd - screenStart;\n\tvar screenAngle = 0.0;\n\tif (distanceAlong != 0.0) {\n\t\tscreenAngle = atan2(screenDelta.y, screenDelta.x);\n\t}\n\tvar angleTransverse = screenAngle - isLeftSide * HALF_PI;\n\tvar lwAdjustment = (*out).fsHalfWidth + u.aaRange;\n\tvar transverseDir = cos_sin(angleTransverse);\n\toffsetPosition += transverseDir * lwAdjustment;\n\n\t// Apply start/end-cap extension offsets if needed\n\t//   for rounded ends, the extension is lwAdjustment,\n\t//   for butt capped ends it's aaRange\n\tvar segmentExtension = select(u.aaRange, lwAdjustment, roundedEnd > 0.0);\n\tvar moveOffset = isStartCapVertex * isLeftSide * vec2f(-transverseDir.y, transverseDir.x) * segmentExtension;\n\toffsetPosition += moveOffset;\n\tcentralVertex += moveOffset;\n\n\t// Distance we care about beyond the actual line segment vertex.\n\t// For start vertex, this is negative and equal to half a line weight\n\t// For end vertex this is the segment length plus the half line weight adjustment.\n\tvar distanceFromStart = max(0.0, isStartCapVertex) * length(screenDelta);\n\n\t(*out).fsMultipurpose = vec4f(\n\t\t// distance after end point that we want to fill with cap/join\n\t\t(isStartCapVertex * segmentExtension) + distanceFromStart,\n\t\tlength(screenDelta),\n\t\tseg.distTotal,\n\t\troundedEnd\n\t);\n\n\tif (seg.lineWidthHalf < 0.0) {\n\t\t(*out).fsHalfWidth = -(*out).fsHalfWidth;\n\t}\n\n\t// Vector from logical line centerline to the pixel position of the thick\n\t// line being shaded. We use this distance for antialiasing and line caps clipping\n\t(*out).fsOffsetDirection = offsetPosition - centralVertex;\n\n\t// Back to clip space coords\n\t(*out).position = ssToClip(offsetPosition, offsetPosDepth);\n}\n\nstruct MiterSegmentData {\n\tangle: f32,\n\tdistAlong: f32,\n\tdistAlongPN: f32,\n\tanglePrev: f32,\n\tangleNext: f32,\n\tlineWidthHalf: f32,\n\tlineType: u32,\n};\n\nfn decodeMiterSegment(in: VsInput) -> MiterSegmentData {\n\tvar seg: MiterSegmentData;\n\tseg.angle         = in.fields2.x * TAU - PI;\n\tseg.distAlong     = in.fields2.y;\n\tseg.anglePrev     = in.fields2.w * TAU - PI;\n\tseg.lineWidthHalf = in.fields2.z;\n\tseg.lineType      = in.flags4b.z;\n\tseg.angleNext     = in.extraParams.x * TAU - PI;\n\tseg.distAlongPN   = in.extraParams.y;\n\treturn seg;\n}\n\nfn strokeMiterLineSegment(in: VsInput, out: ptr<function, VsOutput>) {\n\tvar seg = decodeMiterSegment(in);\n\n\t// Compute output point based on a starting point plus three directions to get the\n\t// previous, current, and next line segment. Using this information, each line\n\t// segment can calculate the correct miter joints on the start and end vertices.\n\t// The vertex flags indicate whether it's left/right/top/bottom vertex in the joint.\n\n\tvar isStartCapVertex = select(1.0, -1.0, isStartVertex(in));\n\tvar isLeftSide = select(-1.0, 1.0, isLeftVertex(in));\n\n\t// Unpack previous and next line segment lengths. Precision was lost during compression.\n\t// These lengths are used along with the angles to determine if the line segments are\n\t// self intersecting and if so to draw a regular line segment with no miter joints.\n\tvar next = floor(seg.distAlongPN / u.miterCp);\n\tvar prev = seg.distAlongPN - (next * u.miterCp);\n\tvar distanceAlongNext = floor(next) / u.miterScaleFactor;\n\tvar distanceAlongPrev = floor(prev) / u.miterScaleFactor;\n\n\t// Screen space start position\n\tvar distanceAlong = seg.distAlong;\n\tvar along  = cos_sin(seg.anglePrev) * distanceAlongPrev;\n\tvar along2 = cos_sin(seg.angle) * distanceAlong;\n\tvar along3 = along2 + cos_sin(seg.angleNext) * distanceAlongNext;\n\n\tvar screenPrev = posToSs(vec4(centralVertex.xy - along, 0.0, 1.0));\n\tvar screenNext = posToSs(vec4(centralVertex.xy + along3, 0.0, 1.0));\n\n\tvar clipStart = mvpMatrix * vec4(centralVertex.xy, 0.0, 1.0);\n\tvar screenStart = clipPosToSs(clipStart);\n\tvar clipEnd = mvpMatrix * vec4(centralVertex.xy + along2, 0.0, 1.0);\n\tvar screenEnd = clipPosToSs(clipEnd);\n\n\tif (isStartCapVertex < 0.0) {\n\t\toffsetPosition = screenStart;\n\t\toffsetPosDepth = clipStart.zw;\n\t} else {\n\t\toffsetPosition = screenEnd;\n\t\toffsetPosDepth = clipEnd.zw;\n\t}\n\tcentralVertex = offsetPosition;\n\n\tvar screenDelta = screenEnd - screenStart;\n\n\tvar AB = normalize(screenStart.xy - screenPrev.xy);\n\tvar BC = normalize(screenDelta);\n\tvar CD = normalize(screenNext.xy - screenEnd.xy);\n\n\tvar a = screenPrev;\n\tvar b = screenStart;\n\tvar c = screenEnd;\n\tvar d = screenNext;\n\tvar p = select(d, a, isStartCapVertex < 0.0);\n\n\tvar a2 = select(c, a, isStartCapVertex < 0.0);\n\tvar b2 = select(d, b, isStartCapVertex < 0.0);\n\tvar p2 = select(b, c, isStartCapVertex < 0.0);\n\tvar PP = select(CD, AB, isStartCapVertex < 0.0);\n\n\tvar normalBC = vec2(-BC.y, BC.x);\n\tvar normalPP = vec2(-PP.y, PP.x);\n\n\t// Check if the line segment at the start/end is interecting with the previous/next\n\t// line segment's start/end.\n\tvar pIsLeftOfBC = select(-1.0, 1.0, ((c.x - b.x)*(p.y - b.y) - (c.y - b.y)*(p.x - b.x)) > 0.0);\n\tvar bN = b + normalBC * (*out).fsHalfWidth * pIsLeftOfBC;\n\tvar cN = c + normalBC * (*out).fsHalfWidth * pIsLeftOfBC;\n\tvar pN = p + normalPP * (*out).fsHalfWidth * pIsLeftOfBC;\n\tvar isPIntersecting = ((cN.x - bN.x)*(pN.y - bN.y) - (cN.y - bN.y)*(pN.x - bN.x)) * pIsLeftOfBC;\n\n\tvar p2IsLeftOfPP = select(-1.0, 1.0, ((b2.x - a2.x)*(p2.y - a2.y) - (b2.y - a2.y)*(p2.x - a2.x)) > 0.0);\n\tvar a2N = a2 + normalPP * (*out).fsHalfWidth * p2IsLeftOfPP;\n\tvar b2N = b2 + normalPP * (*out).fsHalfWidth * p2IsLeftOfPP;\n\tvar p2N = p2 + normalBC * (*out).fsHalfWidth * p2IsLeftOfPP;\n\tvar isP2Intersecting = ((b2N.x - a2N.x)*(p2N.y - a2N.y) - (b2N.y - a2N.y)*(p2N.x - a2N.x)) * p2IsLeftOfPP;\n\n\t// calculate the miter joint\n\tvar tangentLength = select(length(BC + CD), length(AB + BC), isStartCapVertex < 0.0);\n\tvar tangent = select(normalize(BC + CD), normalize(AB + BC), isStartCapVertex < 0.0);\n\tvar miter = vec2(-tangent.y, tangent.x);\n\tvar normal = select(vec2(-BC.y, BC.x), vec2(-AB.y, AB.x), isStartCapVertex < 0.0);\n\tvar miterLength = abs(1.0 / dot(miter, normal));\n\n\tvar moveOffset: vec2f;\n\tvar lwAdjustment = (*out).fsHalfWidth + u.aaRange;\n\tif (miterLength > u.miterLimit || min(isPIntersecting, isP2Intersecting) < 0.0) {\n\t\tmoveOffset = isLeftSide * lwAdjustment * normalBC;\n\t} else {\n\t\tmoveOffset = isLeftSide * miter * lwAdjustment * miterLength;\n\t}\n\n\toffsetPosition += moveOffset;\n\n\tvar distanceFromStart = max(0.0, isStartCapVertex) * (length(screenDelta) + dot(moveOffset, BC));\n\t(*out).fsMultipurpose.x = distanceFromStart;\n\t(*out).fsMultipurpose.y = length(screenDelta) + dot(moveOffset, BC);\n\t(*out).fsMultipurpose.z = 0.0;\n#if $materialHasLineStyles\n\t(*out).fsMultipurpose.w = seg.lineType + 0.5;  // enforce round line ends\n#else\n\t(*out).fsMultipurpose.w = 0.5;                 // enforce round line ends\n#endif\n\n\tif (seg.lineWidthHalf < 0.0) {\n\t\t(*out).fsHalfWidth = -(*out).fsHalfWidth;\n\t}\n\n\t// Vector from logical line centerline to the pixel position of the thick\n\t// line being shaded. We use this distance for antialiasing and line caps clipping\n\t(*out).fsOffsetDirection = offsetPosition - BC * dot(moveOffset, BC) - centralVertex;\n\n\t// Back to clip space coords\n\t(*out).position = ssToClip(offsetPosition, offsetPosDepth);\n}\n\nstruct ArcData {\n\tc: vec2f,\n\tstart: f32,\n\tend: f32,\n\tmajor: f32,\n\tminor: f32,\n\ttilt: f32,\n\tlineWidthHalf: f32,\n};\n\nfn decodeArcData(in: VsInput) -> ArcData {\n\tvar arc : ArcData;\n\tarc.c = in.fields1.xy;\n\tarc.start = in.fields2.x * TAU;\n\tarc.end = in.fields2.y * TAU;\n\tarc.major = in.fields2.w;\n\tarc.minor = in.extraParams.x;\n\tarc.tilt = in.extraParams.y * TAU;\n\tarc.lineWidthHalf = in.fields2.z;\n\treturn arc;\n}\n\nfn strokeArc(in: VsInput, circle: bool, out: ptr<function, VsOutput>) {\n\tvar arc = decodeArcData(in);\n\tif (circle) {\n\t\t// This doesn't get set for circles.\n\t\tarc.minor = arc.major;\n\t}\n\n\t// TODO: Handle rotation/tilt.\n\n\t// Compute a tighter bounding quad for arcs if possible,\n\t// to avoid massive overdraw in case of very small angular range\n\tvar minPt: vec2f;\n\tvar maxPt: vec2f;\n\n\tvar angles: vec2f = vec2f(arc.start, arc.end);\n\tvar endsX: vec2f = vec2f(arc.c.x) + arc.major * cos(angles);\n\tvar endsY: vec2f = vec2f(arc.c.y) + arc.minor * sin(angles);\n\tminPt = vec2f(endsX.x, endsY.x);\n\tmaxPt = minPt;\n\tmin_max(&minPt, &maxPt, vec2f(endsX.y, endsY.y));\n\n\tif (arc.end > arc.start) {\n\t\tif (arc.start < HALF_PI && arc.end > HALF_PI) {\n\t\t\tmin_max(&minPt, &maxPt, vec2f(arc.c.x, arc.c.y + arc.minor));\n\t\t}\n\t\tif (arc.start < PI && arc.end > PI) {\n\t\t\tmin_max(&minPt, &maxPt, vec2f(arc.c.x - arc.major, arc.c.y));\n\t\t}\n\t\tif (arc.start < PI_1_5 && arc.end > PI_1_5) {\n\t\t\tmin_max(&minPt, &maxPt, vec2f(arc.c.x, arc.c.y - arc.minor));\n\t\t}\n\t} else {\n\t\t// In this case, CW arcs, we know it passes through angle 0:\n\t\tmin_max(&minPt, &maxPt, vec2f(arc.c.x + arc.major, arc.c.y));\n\n\t\t// All other checks are also reversed\n\t\t// TODO: verify this logic -- it might be overestimating\n\t\tif (arc.start < HALF_PI || arc.end > HALF_PI) {\n\t\t\tmin_max(&minPt, &maxPt, vec2f(arc.c.x, arc.c.y + arc.minor));\n\t\t}\n\t\tif (arc.start < PI || arc.end > PI) {\n\t\t\tmin_max(&minPt, &maxPt, vec2f(arc.c.x - arc.major, arc.c.y));\n\t\t}\n\t\tif (arc.start < PI_1_5 || arc.end > PI_1_5) {\n\t\t\tmin_max(&minPt, &maxPt, vec2f(arc.c.x, arc.c.y - arc.minor));\n\t\t}\n\t}\n\n\tminPt -= arc.lineWidthHalf;\n\tmaxPt += arc.lineWidthHalf;\n\n\tvar isStart = isStartVertex(in);\n\tvar isLeft = isLeftVertex(in);\n\tvar offsetPos: vec2f;\n\toffsetPos.x = select(maxPt.x, minPt.x, isStart);\n\toffsetPos.y = select(maxPt.y, minPt.y, isLeft);\n\n\tvar clipPos = mvpMatrix * vec4(offsetPos, 0, 1);\n\toffsetPosition = clipPosToSs(clipPos);\n\n\t// Apply the aaRange offset in the correct screenspace direction.\n\tvar aaDir: vec2f;\n\taaDir.x = select(1.0, -1.0, isStart);\n\taaDir.y = select(1.0, -1.0, isLeft);\n\tvar ssAaDir = normalize(vecToSs(vec4(aaDir, 0, 0)));\n\toffsetPosition += u.aaRange * sqrt(2.0) * ssAaDir;\n\n\tcentralVertex = posToSs(vec4(arc.c, 0, 1));\n\t(*out).fsOffsetDirection = vec2(offsetPosition - centralVertex);\n\n\t// Back to clip space coords\n\t(*out).position = ssToClip(offsetPosition, clipPos.zw);\n\n\t// Get the screenspace lengths of the major and minor axis vectors.\n\tvar ssMajor = length(vecToSs(vec4(arc.major, 0, 0, 0)));\n\tvar ssMinor = length(vecToSs(vec4(0, arc.minor, 0, 0)));\n\n\t(*out).fsMultipurpose.x = arc.start;\n\t(*out).fsMultipurpose.y = -ssMajor;\n\t(*out).fsMultipurpose.z = arc.end;\n\t(*out).fsMultipurpose.w = ssMinor;\n}\n\nstruct CommonAttribs {\n\tpos: vec2f,\n\tcolor: vec4f,\n\tlayerTC: vec2f,\n\tvpTC: vec2f,\n\tlineWidthHalf: f32,\n\tgeomType: u32,\n\tghosting: u32\n}\n\nfn decodeCommonAttribs(in: VsInput) -> CommonAttribs {\n\tvar attribs : CommonAttribs;\n\tattribs.pos           = in.fields1.xy;\n\tattribs.color         = in.color4b;\n\tattribs.geomType      = in.flags4b.y;\n\tattribs.layerTC       = vec2f(in.layerVp4b.xy) / 255.0;\n\tattribs.vpTC          = vec2f(in.layerVp4b.zw) / 255.0;\n\tattribs.lineWidthHalf = in.fields2.z;\n\tattribs.ghosting      = in.flags4b.w;\n\treturn attribs;\n}\n\nfn strokeIndexedTriangle(in: VsInput, out: ptr<function, VsOutput>) {\n\t// nothing to go, since centralVertex = attribs.pos already happened in main()...\n\t(*out).fsHalfWidth = 0.0;\n\t(*out).fsMultipurpose = vec4f(in.fields2.xy, 0, 0);\n\tvar objectUniforms = getObjectUniforms(in.instance);\n\t(*out).position = mvpMatrix * vec4(centralVertex.xy, 0.0, 1.0);\n}\n\n// The vertex format used for quads is specifying the center of the quad,\n// a rotation angle and the overall size of the quad (width, height).\nstruct TexQuadData {\n\tangle: f32,\n\tsize: vec2f,\n};\n\nfn decodeTexQuadData(in: VsInput) -> TexQuadData {\n\tvar quad: TexQuadData;\n\tquad.angle = in.fields2.x * TAU;\n\tquad.size = in.fields2.yz;\n\treturn quad;\n}\n\nfn strokeTexQuad(in: VsInput, out: ptr<function, VsOutput>) {\n\tvar quad = decodeTexQuadData(in);\n\n\tvar corner = vec2f(\n\t\tselect(1.0, -1.0, isLeftVertex(in)),\n\t\tselect(1.0, -1.0, isStartVertex(in)));\n\n\tvar p = 0.5 * corner * quad.size;\n\tvar rot = cos_sin(quad.angle);\n\tvar offset = vec2(\n\t\tp.x * rot.x - p.y * rot.y,\n\t\tp.x * rot.y + p.y * rot.x);\n\n\toffsetPosition += offset;\n\t(*out).position = mvpMatrix * vec4(offsetPosition, 0.0, 1.0);\n\n\t(*out).fsMultipurpose = vec4f(\n\t\tmax(vec2(0.0), corner), // tex coords xy\n\t\t1, // Mark as polytriangle for the fragment shader\n\t\t0);\n\n\t(*out).fsHalfWidth = 0.0;\n}\n\n#if $isSelectionHighlight\nfn isSelected(attribs: CommonAttribs, dbIdVec: vec4u) -> bool {\n    //This math assumes that vSelTexSize.x = 4096 (byte and a half) for easy computation.\n\t// Reconstruct uint32 from vec4u.\n\t// Note: It's a bit silly to not just use an index and uint32 buffer directly,\n\t//       but we keep the vec4u vertex input for consistency with the original WebGL shader.\n\tlet dbId: u32 = dbIdVec.r + dbIdVec.g * 256 + dbIdVec.b * 65536 + dbIdVec.a * 16777216;\n\tlet coords = vec2u(dbId % 4096, dbId / 4096);\n    let selBit = textureLoad(selectionTexture, coords, 0);\n    return selBit.r > 0;\n}\n#endif //SELECTION_RENDERER\n\nfn isLayerOff(attribs: CommonAttribs) -> bool {\n\tif (lineMat.hasLayers == 0) {\n\t\treturn false;\n\t}\n\tlet layerBit = textureSampleLevel(layerTexture, layerSampler, attribs.layerTC, 0);\n\treturn (layerBit.r == 0.0);\n}\n\nfn getColor(attribs: CommonAttribs, dbId: vec4u) -> vec4f {\n\tif (isLayerOff(attribs)) {\n\t\treturn vec4(0.0);\n\t}\n\n#if $isSelectionHighlight\n    if (isSelected(attribs, dbId)) {\n\t\t// Item is selected => draw it with selection highlight color\n\t\treturn lineMat.selectionColor;\n\t}\n\treturn vec4(0.0); //Item is not selected -- hide it\n#else\n\t//Check layer visibility\n\t//TODO:\n\t//if (isLayerOff(attribs)) { return vec4(0.0); }\n\treturn attribs.color;\n#endif // isSelectionHighlight\n}\n\n@vertex fn vsmain(in: VsInput) -> VsOutput {\n\n\tvar out: VsOutput;\n\n\tvar objectUniforms = getObjectUniforms(in.instance);\n\tvar attribs = decodeCommonAttribs(in);\n\n\tout.instance = in.instance;\n\tout.fsColor = getColor(attribs, in.dbId4b);\n\n\t// LMV-1133: Add AutoCAD-like display functionality, swapping black and white line and fill elements.\n\t/*\n\tif (u.swap != 0.0 ) {\n\t\t// if black, go to white\n\t\tif ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 ) {\n\t\t\tfsColor.rgb = vec3(1.0,1.0,1.0);\n\t\t// if white, go to black\n\t\t} else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 ) {\n\t\t\tfsColor.rgb = vec3(0.0,0.0,0.0);\n\t\t}\n\t}\n\t*/\n\n\tcentralVertex = attribs.pos;\n\toffsetPosition = attribs.pos;\n\n\tvar lineWeight = attribs.lineWidthHalf;\n\n\tvar ppu = u.pixelsPerUnit;\n\t// For perspective camera calculate pixelsPerUnit according to vertex distance from camera.\n\t// Previously this was done as a general value with distance taken from center of the model,\n\t// but this is more accurate\n\tif (u.tanHalfFov > 0.0) { // For ortho camera, tanHalfFov is set to 0 in the uniform\n\n\t\t// There's a bit of chicken and egg problem here. The offsetPosition is modified later\n\t\t// (e.g. see strokeLineSegment) but fsHalfWidth needs to be calculated beforehand for that,\n\t\t// and that in itself is based on the pixelsPerUnit. So if we wait until the end to calculate\n\t\t// ppu according to the final offsetPosition it will be too late anyway and would need to be recalculated.\n\t\t// This should be a good enough approximation, though.\n\t\tvar cameraPos = uniforms.viewMatrixInverse[3].xyz;\n\t\tvar worldPos = objectUniforms.modelMatrix * vec4f(offsetPosition.xy, 0.0, 1.0);\n\t\tvar distanceToCamera = length(cameraPos - worldPos.xyz);\n\t\tppu = u.size.y / (2.0 * distanceToCamera * u.tanHalfFov);\n\t}\n\n#if $materialHasLineStyles\n\tout.vPixelsPerUnit = ppu; // Fragment shader only uses for linestyles (in the meantime...)\n#endif\n\n\tif (lineWeight > 0.0) {\n\t\t//Do not go below a line width of one pixel\n\t\t//Since we store, half-widths, the comparison is to 0.5 instead of 1.0\n\t\tlineWeight = max(0.5, lineWeight * ppu);\n\t}\n\telse {\n\t\t//Negative line weight means device space (pixel) width.\n\t\t//Currently used for antialiasing of polygon outlines.\n\t\tlineWeight = max(0.5, abs(lineWeight));\n\t}\n\n\tout.fsHalfWidth = lineWeight;\n\n\tout.dbId = vec4u(in.dbId4b);\n\n\tout.fsVpTC     = attribs.vpTC;\n\tout.fsGhosting = f32(attribs.ghosting);\n\n\tsetMvp(in.instance);\n\n\tif (attribs.geomType == VBB_GT_LINE_SEGMENT\n\t\t\t|| attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED\n\t\t\t|| attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_START\n\t\t\t|| attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_END) {\n\t\tstrokeLineSegment(in, attribs.geomType, &out);\n\t} else if (attribs.geomType == VBB_GT_LINE_SEGMENT_MITER) {\n\t\tstrokeMiterLineSegment(in, &out);\n\t} else if (attribs.geomType == VBB_GT_ARC_CIRCULAR) {\n\t\tstrokeArc(in, true, &out);\n\t} else if (attribs.geomType == VBB_GT_ARC_ELLIPTICAL) {\n\t\tstrokeArc(in, false, &out);\n\t} else if (attribs.geomType == VBB_GT_TEX_QUAD) {\n\t\tstrokeTexQuad(in, &out);\n\t} else if (attribs.geomType == VBB_GT_TRIANGLE_INDEXED\n\t\t\t|| attribs.geomType == VBB_GT_TEX_TRIANGLE_INDEXED) {\n\t\tstrokeIndexedTriangle(in, &out);\n\t}\n\n\t//fsGeomType = attribs.geomType;\n\n\t// pass world-pos for cut planes\n\tvar worldPosition = objectUniforms.modelMatrix * vec4f( offsetPosition.xy, 0.0, 1.0 );\n\tout.vWorldPosition = worldPosition.xyz;\n\n\treturn out;\n}\n\n\n//Gaussian falloff function\nfn curveGaussian(r : f32, width: f32) -> f32 {\n\tvar amt = clamp(abs(r / (width * 1.0)), 0.0, 1.0);\n\tamt = max(amt - 0.0, 0.0);\n\n\tvar exponent = amt * 2.0;\n\n\treturn clamp(exp(-exponent*exponent), 0.0, 1.0);\n}\n\n#if $materialHasLineStyles\nfn getLinePatternPixel(i: u32, j: u32) -> f32 {\n\treturn f32(lineStyles[j * u.lineStyleWidth + i]) * 255.0;\n}\n\nfn getPatternLength(whichPattern: u32) -> f32 {\n\tvar p1 = getLinePatternPixel(0, whichPattern);\n\tvar p2 = getLinePatternPixel(1, whichPattern);\n\treturn (p2 * 256.0 + p1);\n}\n#endif\n\n\nfn fillLineSegment(in: VsOutput, out: ptr<function, PixelOutput>) {\n\n\tvar radius = abs(in.fsHalfWidth);\n\tvar parametricDistance = in.fsMultipurpose.x;\n\tvar segmentLength      = in.fsMultipurpose.y;\n\tvar totalDistance      = in.fsMultipurpose.z;\n\tvar roundedEnd         = in.fsMultipurpose.w;\n\n\t//Apply any dot/dash linetype\n#if $materialHasLineStyles\n\tvar whichPattern       = u32(in.fsMultipurpose.w);\n\n\tif (whichPattern > 0) {\n\t\tconst TEX_TO_UNIT = 1.0 / 96.0;\n\n\t\tvar patternScale: f32;\n\n\t\t//If line width is negative it means device space line style (zoom invariant)\n\t\t//line width, which also implies the same about the line pattern -- check for this here.\n\t\tif (in.fsHalfWidth < 0.0) {\n\t\t\tpatternScale = LTSCALE;\n\t\t} else {\n\t\t\tpatternScale = LTSCALE * TEX_TO_UNIT * in.vPixelsPerUnit;\n\t\t}\n\n\t\tvar patLen = patternScale * getPatternLength(whichPattern);\n\t\tvar phase = (totalDistance + parametricDistance) % patLen;\n\n\t\tvar onPixel = true;\n\t\tvar radiusPixels = radius + u.aaRange;\n\n\t\tfor (var i: u32 = 2; i < u.lineStyleWidth; i += 2) {\n\n\t\t\tvar on = getLinePatternPixel(i, whichPattern);\n\t\t\tif (on == 1.0) {\n\t\t\t\ton = 0.0; //special handling for dots, map length 1 to 0\n\t\t\t}\n\t\t\ton *= patternScale;\n\n\t\t\tonPixel = true;\n\t\t\tphase -= on;\n\t\t\tif (phase < 0.0) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse if (phase <= radiusPixels) {\n\t\t\t\tonPixel = false;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tvar off = getLinePatternPixel(i+1, whichPattern);\n\t\t\tif (off <= 1.0) {\n\t\t\t\toff = 0.0; //special handling for dots, map length 1 to 0\n\t\t\t}\n\t\t\toff *= patternScale;\n\n\t\t\tonPixel = false;\n\t\t\tphase -= off;\n\t\t\tif (phase < -radiusPixels) {\n\t\t\t\tdiscard;\n\t\t\t}\n\t\t\tif (phase <= 0.0) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//Modify the parametricDistance value used for round cap\n\t\t//rendering to reflect the current position along the dash,\n\t\t//so that dashes get caps also.\n\t\tif (!onPixel && (abs(phase) <= radiusPixels)) {\n\t\t\tsegmentLength = 0.0;\n\t\t\tparametricDistance = phase;\n\t\t}\n\t}\n#endif // HAS_LINESTYLES\n\n\t//Check for end cap or join region -- here we reduce\n\t///allowed distance from centerline in a circular way\n\t//to get a round cap/join\n\tvar dist: f32;\n\tvar offsetLength2 = dot(in.fsOffsetDirection, in.fsOffsetDirection);\n\t/*\n\t if (parametricDistance < 0.0) {\n\t   var d = parametricDistance;\n\t   dist = sqrt(d * d + offsetLength2);\n\t } else if (parametricDistance >= segmentLength) {\n\t   var d = parametricDistance - segmentLength;\n\t   dist = sqrt(d * d + offsetLength2);\n\t } else {\n\t   dist = sqrt(offsetLength2);\n\t }\n\t*/\n\n\t//Branchless version of the above ifs (because who doesn't like to do boolean logic with float ops?):\n\tvar ltz = max(0.0, sign(-parametricDistance));\n\tvar gtsl = max(0.0, sign(parametricDistance - segmentLength));\n\tvar d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\n\tdist = sqrt(max(0.0, offsetLength2 + d*d));\n\n\t//pixel is too far out of the line center\n\t//so discard it\n\tvar range =  dist - radius;\n\n\t// Handle butt capped ends:\n\t// Any line pattern != 0 (solid line) will automatically use round line ends. This behavior is on purpose!\n\t// Patterned lines must use the (unknown) actual line end style for each dash, not the style of either segment end.\n\t// The actual line end style would have to get passed in from Javascript (e.g., as extra bit in the pattern)\n\tif (roundedEnd < 0.25) {\n\t\t// this pixel is close to a butt capped end. Get its distance to the closer line end.\n\t\tvar buttRange = max(-parametricDistance, parametricDistance - segmentLength);\n\t\trange = max(range, buttRange);\n\t}\n\n\t//Here aaRange will always be 0.5 pixels.\n\t//The logic below blurs a thickness of 1 pixel, a distance of\n\t//(halfLineWidth - 0.5) to (halfLineWidth + 0.5) away from the centerline.\n\n\t//Fully outside, discard\n\tif (range > u.aaRange) {\n\t\tdiscard;\n\t}\n\n\t//The geometry covers this pixel -- do AA.\n\t(*out).color = in.fsColor;\n\n\t//Blur if we are in the blur range.\n\t//The exact parameters to the gaussian function (and inside it)\n\t//are based on personal preference observations\n\tif (range > -u.aaRange) {\n\t\t(*out).color = vec4f((*out).color.xyz, curveGaussian(range+u.aaRange, u.aaRange * 2.0));\n\t}\n\t//out.color.a *= curveGaussian(range, 1.0);\n}\n\nfn EllipticalApprox(\n\t\titers: i32,\n\t\tt0: ptr<function, f32>, t1: ptr<function, f32>,\n\t\ty: vec2f, e: vec2f, ey: vec2f, esqr: vec2f) -> f32 {\n\tvar r: vec2f;\n\tfor (var i = 0; i < 10; i++) { // maximum 10 iterations\n\t\tif (i >= iters) {\n\t\t\tbreak; // early out if we don't want the max number of iterations\n\t\t}\n\n\t\tvar t = mix(*t0, *t1, 0.5); // 0.5*(t0 + t1);\n\t\tr = ey / (vec2(t) + esqr);\n\n\t\tvar rsq = r * r;\n\t\tvar f = rsq.x + rsq.y - 1.0;\n\n\t\tif (f > 0.0) {\n\t\t\t*t0 = t;\n\t\t} else {\n\t\t\t*t1 = t;\n\t\t}\n\t}\n\n\tvar closestPoint = e * r;\n\treturn distance(closestPoint, y);\n}\n\nfn EllipseDistanceSpecial(\n\t\te: vec2f, y: vec2f, width: f32, aaRange: f32) -> f32 {\n\tvar dist: f32;\n\n\t// Bisect to compute the root of F(t) for t >= -e1*e1.\n\tvar esqr = e * e;\n\tvar ey = e * y;\n\tvar t0 = -esqr[1] + ey[1];\n\tvar t1 = -esqr[1] + length(ey);\n\n\t//Do a few initial iterations without loop break checks\n\t//to get approximately close to the result\n\tdist = EllipticalApprox(6, &t0, &t1, y, e, ey, esqr);\n\n\t//Early out -- point is going to be too far to matter for the ellipse outline\n\tif (dist > max(2.0 * (width + aaRange), e[0] * 0.05)) {\n\t\treturn dist;\n\t}\n\n\t//Do a few more iterations to get really close to the result...\n\tdist = EllipticalApprox(6, &t0, &t1, y, e, ey, esqr);\n\n\t//Early out -- point is too far to matter for the ellipse outline\n\t//The bigger the eccentricity, the worse the estimate, so increse\n\t//the tolerance based on that.\n\tvar ecc = 1.0 +  0.1 * e[0] / e[1];\n\n\tif (dist > max(ecc * (width + aaRange), e[0] * 0.001)) {\n\t\treturn dist;\n\t}\n\tif (dist < (width - aaRange) / ecc) {\n\t\treturn dist;\n\t}\n\n\t//Finally get an almost exact answer since\n\t//we are near the line width boundary\n\tdist = EllipticalApprox(10, &t0, &t1, y, e, ey, esqr);\n\treturn dist;\n}\n\n\n//----------------------------------------------------------------------------\n// The ellipse is (x0/e0)^2 + (x1/e1)^2 = 1. The query point is (y0,y1).\n// The function returns the distance from the query point to the ellipse.\n//----------------------------------------------------------------------------\nfn EllipseDistance(\n\t\te: vec2f, y: vec2f, width: f32, aaRange: f32) -> f32 {\n\tvar locE = e;\n\tvar locY = y;\n\tif (e[0] < e[1]) {\n\t\t// Determine the axis order for decreasing extents\n\t\tlocE = locE.yx;\n\t\tlocY = locY.yx;\n\t}\n\n\t// Determine reflections for y to the first quadrant.\n\tvar refl = sign(locY);\n\tlocY *= refl;\n\n\treturn EllipseDistanceSpecial(locE, locY, width, aaRange);\n}\n\nfn fillArc(in: VsOutput, out: ptr<function, PixelOutput>) {\n\tvar dist = length(in.fsOffsetDirection);\n\tvar angles  = in.fsMultipurpose.xz; // (start, end) angles\n\tvar radiusX = abs(in.fsMultipurpose.y);\n\tvar radiusY = in.fsMultipurpose.w;\n\n\tvar edgeDist: f32;\n\tvar angle: f32;\n\tif (radiusX == radiusY) {\n\t\tedgeDist = abs(dist - radiusX);\n\t\tangle = atan2(in.fsOffsetDirection.y, in.fsOffsetDirection.x);\n\t} else {\n\t\tedgeDist = EllipseDistance(\n\t\t\tvec2(radiusX, radiusY), in.fsOffsetDirection, in.fsHalfWidth, u.aaRange);\n\t\tvar aspect = radiusX / radiusY;\n\t\tangle = atan2(aspect * in.fsOffsetDirection.y, in.fsOffsetDirection.x);\n\t}\n\tedgeDist -= in.fsHalfWidth;\n\n\t// pixel is too far out of the line center\n\t// so discard it\n\tif (edgeDist > u.aaRange) {\n\t\tdiscard;\n\t}\n\n\t// Handle clockwise arcs, which happen when the arc\n\t// crosses the X axis -- convert to CCW arc starting\n\t// at negative angle instead.\n\tif (angles.x > angles.y) {\n\t\t// Handle the case that 0 < angleStart < PI.\n\t\tif (angle > angles.x && angle < PI) {\n\t\t\tangle -= TAU;\n\t\t}\n\t\tangles.x -= TAU;\n\t\t// Fixed for https://jira.autodesk.com/browse/TREX-508: some arcs in this drawing are trimmed after translating\n\t\t// We need to handle the case that -PI < angle < angleStart < 0\n\t\t// In the case, angle needs to add 2*PI to ensure angle in the range of [angleStart, angleEnd]\n\t\tif (angle < angles.x) {\n\t\t\tangle += TAU;\n\t\t}\n\t} else if (angle < 0.0) {\n\t\tangle += TAU;\n\t}\n\n\t// TODO: Do we need this?\n\t// # ifdef LOADING_ANIMATION\n\t// \tif ((angle - angles.x) / (angles.y - angles.x) > loadingProgress) {\n\t// \t\tdiscard;\n\t// \t}\n\t// # endif\n\n\t// Are we in the exact range of the arc?\n\tif (angle > angles.x && angle < angles.y) {\n\t\t(*out).color = in.fsColor;\n\n\t\tif (edgeDist > -u.aaRange) {\n\t\t\t(*out).color.a *= curveGaussian(edgeDist + u.aaRange, u.aaRange * 2.0);\n\t\t}\n\t} else {\n\t\tdiscard;\n\t}\n}\n\n\nfn fillTriangle(in: VsOutput, out: ptr<function, PixelOutput>) {\n\tif (lineMat.hasTexture == 0) {\n\t\t(*out).color = in.fsColor;\n\t} else {\n\t\t(*out).color = rasterSample;\n\t}\n}\n\nfn fillTexQuad(in: VsOutput, out: ptr<function, PixelOutput>) {\n\t(*out).color = rasterSample;\n\t// TODO: Do we need this?\n\t// # ifdef LOADING_ANIMATION\n\t// \t(*out).color.a *= loadingProgress;\n\t// # endif\n}\n\n\n// Checks whether C is on the right/left of the AB vector\n// Returns 0 on the line\n//  -1 on right side\n//   1 on left side\nfn getSide(a: vec2f, b: vec2f, c: vec2f) -> f32 {\n\treturn sign((b.x - a.x) * (c.y - a.y) - (b.y - a.y) * (c.x - a.x));\n}\n\n// Used internally by the fragment shader.\nvar<private> rasterSample: vec4f;\n\nstruct PixelOutput {\n\t@location(0) color: vec4f,\n\t@location(1) normal: vec4f,\n\t@location(2) viewDepth: vec4f,\n\t@location(3) dbId: vec4u,\n\t@location(4) modelId: vec4u,\n\t//@location(5) objectFlags: vec4u\n}\n\n@fragment fn psmain(in: VsOutput) -> PixelOutput {\n\n\tvar out: PixelOutput;\n\n\tvar objectUniforms = getObjectUniforms(in.instance);\n\tvar materialUniforms = getMaterialUniforms(objectUniforms.materialIndex);\n\n\t//Is visibility off?\n\t//Note we check for all components to be zero,\n\t//because we still want the ability to mark the ID buffer\n\t//with IDs that do not render anything into the color buffer\n\tif (in.fsColor.a == 0.0 && in.fsColor.r == 0.0 && in.fsColor.g == 0.0 && in.fsColor.b == 0.0) {\n\t\tdiscard;\n\t}\n\n\n\trasterSample = textureSample(rasterTexture, rasterSampler, in.fsMultipurpose.xy);\n\n\tif (in.fsHalfWidth == 0.0) {\n\t\t// Filled triangle or quad, not a line, no need for extra math\n        if (in.fsMultipurpose.z != 0.0) {\n            fillTexQuad(in, &out);\n        } else {\n            fillTriangle(in, &out);\n\t\t}\n\n\t\t// cap mesh hatch pattern\n\t\tif ((materialUniforms.renderFlags & 8) != 0) {\n\t\t\tout.color = calculateHatchPattern(materialUniforms.hatchParams, in.position.xy, out.color,\n\t\t\t\thatchTintColor, materialUniforms.hatchTintIntensity);\n\t\t}\n\t} else if (in.fsMultipurpose.y < 0.0) {\n\t\tfillArc(in, &out);\n\t} else {\n\t\tfillLineSegment(in, &out);\n\t}\n\n\t// The LineShader requires the ability to discard IDs independent of color. This is needed for ghosted 2D\n\t// objects, which are visible, but not selectable (allowing to select the object below).\n\t// To support this, the id_frag shader chunk supports the ENABLE_ID_DISCARD macro, which is always defined\n\t// by LineShader. If this macro is set, id_frag requires a variable writeId to control whether the id is\n\t// written (writeId=1.0) or not (writeId=0.0).\n\tvar writeId = 1.0;\n\n\tout.color.a *= u.opacity;\n\t// For fully transparent pixels we can discard\n\tif (out.color.a == 0.0) {\n\t\tdiscard;\n\t}\n\n\t// Apply ghosting, i.e., make an object transparent and exclude it from ID buffer if...\n\t//  a) It is in the ghosting layer (see FragmentList.js)\n\t//  b) We are in 2D measure mode and it belongs to a different viewport than the first selected one\n\tif (in.fsGhosting != 0.0)\n\t\t//|| ((in.viewportId != 0.0) && (abs(in.fsVpTC.x * 255.0 + in.fsVpTC.y) >= 0.5 && abs(in.fsVpTC.x * 255.0 + in.fsVpTC.y - in.viewportId) >= 0.5)))\n\t{\n\t\t// apply ghosting\n\t\twriteId = 0.0;\n\n\t\t// When swapping black and white, must kick up faded inks a bit to give them more contrast\n\t\t// with the (likely to be black) background. By visual test, 0.21 looks good.\n\t\t//DT gl_FragColor.a *= ((u.swap == 1.0) ? 0.21 : 0.1);\n\t\tout.color.a *= 0.30;\n\t}\n\n\t//check doNotCut flag\n\tif (commonMaterialUniforms.doNotCutOverride + (materialUniforms.renderFlags & 2) == 0) {\n\t\tcheckCutPlanes(in.vWorldPosition);\n\t}\n\n\tif (writeId == 1.0) {\n\t\t//Store object identity information\n\t\tout.dbId = in.dbId;\n\n\t\t//Currently we don't have enough room to bind a third ID render target (32 byte limit on render attachments),\n\t\t//so we stash half of the object flags in the modelId\n\t\t//output.objectFlags = intToVec(objectUniforms.objectFlags);\n\n\t\tout.modelId = intToVec(objectUniforms.modelId | (objectUniforms.objectFlags << 16));\n\t}\n\n\treturn out;\n}\n",{frameBindGroup:M_.getDeclaration(0),objectUniforms:Dm(1),lineUniforms:(t=2,Im("//Uniforms\nstruct Line2DUniforms {\n    pixelsPerUnit: f32,\n    aaRange: f32,\n    size: vec2f,\n\n    viewportId: f32,\n    swap: f32,\n    tanHalfFov: f32,\n    opacity: f32,\n\n    lineStyleWidth: u32,\n    miterLimit: f32,\n    miterScaleFactor: f32,\n    miterCp: f32,\n}\n@group($group) @binding(0) var<uniform> u: Line2DUniforms;\n@group($group) @binding(1) var<storage> lineStyles : array<u32>;\n",{group:t})),lineMaterialUniforms:Q_.getUniformsDeclaration(3),hatch:qx,...D_(e)});var t}#Fi(e,t,i){let n,r=this.#Dt.createShaderModule({code:$_.#On(i)});return n=this.#Dt.createRenderPipeline({layout:this.#Dt.createPipelineLayout({bindGroupLayouts:this.#Ln}),vertex:{module:r,entryPoint:"vsmain",buffers:R_(t)},fragment:{module:r,entryPoint:"psmain",targets:this.#xn},primitive:{topology:"triangle-list",cullMode:"none"},depthStencil:{depthWriteEnabled:i.depthWrite,depthCompare:i.depthTest?i.depthFunc||"less-equal":"always",format:Zx}}),this.#ki.set(e,n),n}reset(e){this.#vn=null,this.#xn=e,this.#Rn=null}setLayouts(e,t,i){this.#Ln=[e,t,i,this.#Dn.getLayout()]}setBindGroups(e,t,i,n){e.setBindGroup(0,t),e.setBindGroup(1,i),e.setBindGroup(2,n)}drawOne(e,t,i,n){const r=function(e,t){let i=e.__gpuPipelineHash;void 0===i&&(i=function(e){return e.__gpuPipelineHash=e.vbstride,e.__gpuPipelineHash}(e));let n=t.__gpuPipelineHash;if(t.needsUpdate||void 0===n){n=0;const e=D_(t);e.materialHasLineStyles&&(n|=O_),e.isSelectionHighlight&&(n|=B_),t.__gpuPipelineHash=n}return i|n<<24}(i,n);let o=this.#ki.get(r);o||(o=this.#Fi(r,i,n)),o!==this.#vn&&(e.setPipeline(o),this.#vn=o,this.#Rn=null),!n.needsUpdate&&n.__gpuBindGroup||this.#Dn.initMaterial(n),this.#Dn.updateTextures(n),n!==this.#Rn&&(e.setBindGroup(3,n.__gpuBindGroup),this.#Rn=n),this.#_n.draw(e,i,t)}}var J_;function eE(e){switch(e){case J_.f32:case J_.i32:return 1;case J_.vec2f:return 2;case J_.vec3f:case J_.c:return 3;case J_.vec4f:return 4;case J_.mat3x3f:return 12;case J_.mat4x4f:return 16;default:throw new Error(`Unknown uniform type: ${e}`)}}function tE(e){switch(e){case J_.f32:case J_.i32:return 1;case J_.vec2f:return 2;case J_.vec3f:case J_.c:case J_.vec4f:case J_.mat3x3f:case J_.mat4x4f:return 4;default:throw new Error(`Unknown uniform type: ${e}`)}}function iE(e,t,i,n){switch(i){case J_.f32:e.setFloat(t,n);break;case J_.i32:e.setInt(t,n);break;case J_.vec2f:e.setFloat2(t,n.x,n.y);break;case J_.vec3f:e.setVector3(t,n);break;case J_.c:e.setColor(t,n);break;case J_.vec4f:e.setVector4(t,n);break;case J_.mat3x3f:e.setMatrix3x3(t,n);break;case J_.mat4x4f:e.setMatrix4x4(t,n);break;default:throw new Error(`Unknown uniform type: ${i}`)}}function nE(e,t){const i={},n=function(e,t){let i=0;for(const n in e){const r=e[n],o=tE(r),s=i%o;0!=s&&(i+=o-s),t&&(t[n]=i),i+=eE(r)}return i}(e,i),r=Boolean(t&GPUShaderStage.FRAGMENT),o=Boolean(t&GPUShaderStage.VERTEX);return{buffer:new Ax(void 0,n,r,o),offsets:i}}function rE(){return{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear",lodMinClamp:0,lodMaxClamp:10,maxAnisotropy:16}}!function(e){e.f32="f32",e.i32="i32",e.vec2f="vec2f",e.vec3f="vec3f",e.vec4f="vec4f",e.mat3x3f="mat3x3f",e.mat4x4f="mat4x4f",e.c="c"}(J_||(J_={}));class oE{#pi;#Bn=new Map;#Nn=new Map;#Un=new Map;#kn;#Ni;#hi;#Fn;#Vi;#Vn;#Gn=!1;constructor(e){this.#pi=e}setDefaultTexture(e){const t=e?.createView();e!=this.#Vi&&(this.#Nn.forEach((e=>{!e.texture&&e.bindGroupEntry?.resource&&(e.bindGroupEntry.resource=t,this.#hi=null)})),p_(this.#Vi),f_(e),this.#Vi=e||null,this.#Vn=t||null)}addUniformBuffer(e,t,i=GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,n={}){if(this.#zn(e))return;const r={uniformBufferLayout:t,uniformBufferValues:{},layoutEntry:{binding:e,visibility:i,buffer:n},needsUpload:!0,bindGroupEntry:null,uniformBuffer:null,offsets:null};this.#Bn.set(e,r),this.#Hn()}addTexture(e,t,i=GPUShaderStage.FRAGMENT,n="float"){if(this.#zn(e))return;const r={binding:e,visibility:i,texture:{sampleType:n}},o={texture:t,textureView:t?.createView()||null,layoutEntry:r,bindGroupEntry:null};this.#Nn.set(e,o),this.#Hn()}addSampler(e,t=GPUShaderStage.FRAGMENT,i={addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear",lodMinClamp:0,lodMaxClamp:10,maxAnisotropy:16},n={}){if(this.#zn(e))return;const r={samplerDesc:i,layoutEntry:{binding:e,visibility:t,sampler:n},sampler:null,bindGroupEntry:null};this.#Un.set(e,r),this.#Hn()}setUniformBufferValues(e,t=0){const i=this.#Bn.get(t);if(i){for(const t in e){const n=i.uniformBufferLayout[t];n?(i.uniformBufferValues[t]=e[t],i.uniformBuffer&&iE(i.uniformBuffer,i.offsets[t],n,e[t])):console.error("Uniform name not found in the UniformBufferLayout: ",t)}i.needsUpload=!0,this.#Gn=!0}else console.error("Uniform buffer not found for binding: ",t)}setTexture(e,t){const i=this.#Nn.get(t);i?(p_(i.texture),f_(e),i.texture=e,i.textureView=e?.createView()||this.#Vn,i.bindGroupEntry&&(i.bindGroupEntry.resource=i.textureView),this.#hi=null):console.error("Texture not found for binding: ",t)}isAssigned(e){return void 0!==this.#Wn(e)}update(e){this.#Ni||(this.#jn(e),this.#qn(e),this.#Kn(e)),this.#Xn(e),this.#Yn()}get layout(){return this.#Ni}get bindGroup(){return this.#hi}#qn(e){for(const t of this.#Bn.values()){(!t.uniformBuffer||!t.offsets)&&(this.#Qn(e,t),this.#Zn(t))}}#Qn(e,t){const{buffer:i,offsets:n}=nE(t.uniformBufferLayout,t.layoutEntry.visibility);i.setDevice(e),t.uniformBuffer=i,t.offsets=n}#Zn(e){for(const t in e.uniformBufferValues){const i=e.uniformBufferLayout[t];iE(e.uniformBuffer,e.offsets[t],i,e.uniformBufferValues[t]),e.uniformBuffer.upload(),e.needsUpload=!1}}#Kn(e){this.#Un.forEach((t=>{t.sampler||(t.sampler=e.createSampler(t.samplerDesc))}))}#jn(e){const t=[];for(const e of this.#Bn.values())t.push(e.layoutEntry);for(const e of this.#Nn.values())t.push(e.layoutEntry);for(const e of this.#Un.values())t.push(e.layoutEntry);this.#kn={label:this.#pi,entries:t},this.#Ni=e.createBindGroupLayout(this.#kn)}#Xn(e){this.#Fn||this.#$n(),this.#hi||(this.#hi=e.createBindGroup({label:this.#pi,layout:this.#Ni,entries:this.#Fn}))}#Jn(e){const t=e.uniformBuffer?.getBuffer(),i=e.textureView,n=e.sampler;return t?{buffer:t}:i||(n||null)}#er(e){const t={binding:e.layoutEntry.binding,resource:this.#Jn(e)};this.#Fn.push(t),e.bindGroupEntry=t}#$n(){this.#Fn=[];for(const e of this.#Bn.values())this.#er(e);for(const e of this.#Nn.values())e.textureView||this.#Vn||console.error(`Texture is missing for binding: ${e.layoutEntry.binding}. Null textures are only allowed if a default texture is provided`),this.#er(e);for(const e of this.#Un.values())this.#er(e)}#tr(){this.#kn=null,this.#Ni=null,this.#hi=null,this.#Bn.forEach((e=>{e.bindGroupEntry=null,e.uniformBuffer=null,e.offsets=null})),this.#Nn.forEach((e=>{e.bindGroupEntry=null})),this.#Un.forEach((e=>{e.bindGroupEntry=null}))}#Hn(){this.#tr()}#Wn(e){const t=this.#Bn.get(e),i=this.#Nn.get(e),n=this.#Un.get(e);return t||i||n}#zn(e){return!!this.#Wn(e)&&(console.error("Binding ",e," is assigned."),!0)}#Yn(){if(this.#Gn){for(const e of this.#Bn.values())e.needsUpload&&e.uniformBuffer.upload();this.#Gn=!1}}}function sE(e){return Im(e.webGPU.shader,{frameBindGroup:M_.getDeclaration(0),objectUniforms:Dm(1),pack_depth:t_})}function aE(e){switch(e){case"i":return"i32";case"f":return"f32";case"v2":return"vec2f";case"v3":return"vec3f";case"v4":return"vec4f";case"c":return"c";case"m3":return"mat3x3f";case"m4":return"mat4x4f"}return null}class lE{#e;#Dt;#ki=new Map;#ir=new Map;#vn;#yn;#bn;#xn;#_n;constructor(e){this.#e=e,this.#Dt=e.getDevice(),this.#_n=this.#e.getVB()}#Fi(e,t,i){const n=t.attributes,r=n.color,o=n.normal,s=n.uv,a=i.webGPU.labelPrefix||`Material-${e}`;let l;const c=this.#Dt.createShaderModule({label:`${a} Shader`,code:sE(i)}),u=this.#bn.slice();return u[2]=i.__gpuCustomMaterialUniforms.layout,l=this.#Dt.createRenderPipeline({label:`${a} Pipeline`,layout:this.#Dt.createPipelineLayout({label:`${a} Pipeline Layout`,bindGroupLayouts:u}),vertex:{module:c,entryPoint:"vsmain",buffers:L_(t,o,s,r)},fragment:{module:c,entryPoint:"psmain",targets:this.#xn},primitive:{topology:"triangle-list",cullMode:s_(i.side)},depthStencil:{depthWriteEnabled:i.depthWrite,depthCompare:i.depthTest?i.depthFunc||"less-equal":"always",format:Zx,depthBias:0,depthBiasSlopeScale:0}}),this.#ki.set(e,l),l}reset(e,t){this.#vn=null,this.#yn=null,this.#bn=e,this.#xn=t}#nr(e){const t=e.id;return this.#ir.has(t)||this.#ir.set(t,new a_(this.#Dt)),d_(this.#Dt,this.#ir.get(t),e),e.__gpuTexture}#rr(e){const t=new oE(e.webGPU.labelPrefix);t.setDefaultTexture(this.#e.getPlaceholderTexture().texture);const{uniformBufferLayout:i,uniformBufferValues:n}=function(e){const t={},i={};for(let n in e.uniforms){const r=aE(e.uniforms[n].type);r&&(t[n]=r,i[n]=e.uniforms[n].value)}return{uniformBufferLayout:t,uniformBufferValues:i}}(e);t.addUniformBuffer(0,i,e.webGPU.uniformBufferVisibility,e.webGPU.uniformBufferBindingLayout),t.setUniformBufferValues(n);for(let i of e.webGPU.textureBindings)if(i.uniformKey&&i.binding){const n=e.uniforms[i.uniformKey];if("t"!==n.type||null===n.value)continue;const r=n.value instanceof GPUTexture,o=r?n.value:this.#nr(n.value);if(t.addTexture(i.binding,o,i.textureVisibility,i.sampleType),i.samplerBinding)if(r)console.warn("'samplerBinding' can only be used for a THREE.Texture. For a GPUTexture define 'samplers' instead.");else{const e=c_(n.value);t.addSampler(i.samplerBinding,i.samplerVisibility,e)}}if(e.webGPU.samplers)for(const i of e.webGPU.samplers)t.addSampler(i.binding,i.visibility,i.descriptor);return t}#or(e){const t=e.__gpuCustomMaterialUniforms;for(let i of e.webGPU.textureBindings)if(i.uniformKey&&i.binding){const n=e.uniforms[i.uniformKey];if("t"!==n.type||null===n.value)continue;n.value instanceof GPUTexture&&t.setTexture(n.value,i.binding)}}#sr(e){if(e.__gpuCustomMaterialUniforms)e.uniformsNeedUpdate&&(this.#or(e),e.__gpuCustomMaterialUniforms.update(this.#Dt),e.uniformsNeedUpdate=!1);else{const t=this.#rr(e);e.__gpuCustomMaterialUniforms=t,e.__gpuCustomMaterialUniforms.update(this.#Dt)}}#Sn(e,t){this.#sr(t),this.#yn!==t&&(e.setBindGroup(2,t.__gpuCustomMaterialUniforms.bindGroup),this.#yn=t)}drawOne(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:P_;i.vb&&!i.vbNeedsUpdate||Oc.interleaveGeometry(i,!0),this.#Sn(e,n);const o=r(i,n);let s=this.#ki.get(o);s&&!n.needsUpdate||(s=this.#Fi(o,i,n),n.needsUpdate=!1),s!==this.#vn&&(e.setPipeline(s),this.#vn=s),this.#_n.draw(e,i,t)}}new(v().Vector3),new(v().Frustum);function cE(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?e.z-t.z:e.id-t.id}function uE(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?t.z-e.z:e.id-t.id}class hE{#ar=[];#lr=[];#cr=!1;#ur;#hr;#dr=Ji;#fr=new(v().Vector3);#K=new(v().Frustum);setFromScene(e,t){this.#K.setFromProjectionMatrix(t),!0===e.autoUpdate&&e.updateMatrixWorld(),this.#ar.length=0,this.#lr.length=0,this.#cr=!1,this.#ur=void 0,this.#hr=void 0,this.#pr(e,!0===e.sortObjects,!0===e.forceVisible,t),!0===e.sortObjects&&(this.#ar.sort(uE),this.#lr.sort(cE))}forEachWGPU(e,t,i){let n=t||-1,r=e;this.#dr&&(r=this.#hr||r,this.#hr=void 0);let o=0,s=this.#ar.length;if(r<s){let e=s;n>0&&(e-r>n?(e=r+n,o=e):n=Math.max(0,n-(e-r)));let t=0;for(;r<e;r++){var a;const e=this.#ar[r];if(t+=(null===(a=e.geometry)||void 0===a?void 0:a.numInstances)??1,t>n){o=r;break}const s=i(e);if(this.checkInterrupt(r,s))return-1}}if(o)return o;if(0===n)return s;r-=s;let l=this.#lr.length;n>0&&l-r>n&&(l=r+n,o=l+s);let c=0;for(;r<l;r++){var u;const e=this.#lr[r];if(c+=(null===(u=e.geometry)||void 0===u?void 0:u.numInstances)??1,c>n){o=r;break}const t=i(e);if(this.checkInterrupt(r,t))return-1}return o||-1}is2d(){return this.#cr}needsCutPlanes(){const e=this.#ar[0]??this.#lr[0]??null;return!!(null==e?void 0:e.material.cutplanes)}#pr(e,t,i,n){if(i||!1!==e.visible){if(e instanceof v().Scene||e instanceof v().Group);else if(e instanceof Sc);else if(e instanceof v().Light);else if((e instanceof v().Mesh||e instanceof v().Line)&&(!1===e.frustumCulled||!0===this.#K.intersectsObject(e))){const i=e.material;i&&(i.transparent?this.#lr.push(e):this.#ar.push(e),i.is2d&&(this.#cr=!0)),!0===t&&(this.#fr.setFromMatrixPosition(e.matrixWorld),this.#fr.applyProjection(n),e.z=this.#fr.z)}if(e.children)for(let n=0,r=e.children.length;n<r;n++)this.#pr(e.children[n],t,i)}}setDeadline(e){this.#ur=e}hasBeenInterrupted(){return void 0!==this.#hr}resetInterrupted(){this.#hr=void 0}checkInterrupt(e,t){return!!this.#dr&&((t||void 0!==this.#ur&&e%10==0&&performance.now()>this.#ur)&&(this.#hr=e,!0))}}new hE;const dE=e=>{if(void 0!==e.__fallbackGeom)return e.__fallbackGeom;if(!(e instanceof v().Geometry))return e.__fallbackGeom=null,console.warn("Skipping object with unsupported geometry.",e),e.__fallbackGeom;const t=new(v().BufferGeometry);return 0==e.faces.length?t.setFromPoints(e.vertices):t.fromGeometry(e),Oc.interleaveGeometry(t),e.__fallbackGeom=t,e.__fallbackGeom.isLines=e.isLines,e.__fallbackGeomOnDisposeProxy=function(e){var t;const i=e.target;null===(t=i.__fallbackGeom)||void 0===t||t.dispatchEvent(e),i.removeEventListener("dispose",i.__fallbackGeomOnDisposeProxy)},e.addEventListener("dispose",e.__fallbackGeomOnDisposeProxy),e.__fallbackGeom},fE=0,pE=1;class mE{#Dt;#mr;#gr=new Float32Array(4);#vr=new Int32Array(this.#gr.buffer);constructor(e){this.#Dt=e,this.#mr=this.#Dt.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}setEdgeColorInt(e){e!==this.#vr[fE]&&(this.#vr[fE]=e,this.#Dt.queue.writeBuffer(this.#mr,0,this.#gr.buffer,0,this.#gr.byteLength))}setDoNotCutOverride(e){e!==!!this.#vr[pE]&&(this.#vr[pE]=e,this.#Dt.queue.writeBuffer(this.#mr,0,this.#gr.buffer,0,this.#gr.byteLength))}getGPUBuffer(){return this.#mr}byteSize(){return this.#mr.size}}class gE extends gx{#yr=null;#Dt=null;#br=new Float32Array(8);#xr=new Int32Array(this.#br.buffer);#_r;#Er;#Sr=new Map;constructor(e){super(e),this.#Dt=e;const t=this.mAlloc(0);this.#yr=t.bufferEntry.buffer,this.#_r=this.#Ar.bind(this),this.#Er=this.#wr.bind(this)}byteSize(){return this.computeUsedBytes().mbBytes}getAlloc(e){return this.#Sr.get(e)}#Cr(e){let t=this.getAlloc(e);if(t)return t.offset;t=this.mAlloc(32),this.#Sr.set(e,t);const i=()=>{this.freeAlloc(t),this.#Sr.delete(e),e.removeEventListener("dispose",i)};return e.addEventListener("dispose",i),t.offset}#Tr(e){this.#Dt.queue.writeBuffer(this.#yr,e,this.#br.buffer,0,this.#br.byteLength)}acquireMaterial(e){return this.#Cr(e)/32}#Mr(e,t){return(e.opacity<0?1:0)|(e.doNotCut?2:0)|(e.alphaTest>0?4:0)|(e.hatchPattern?8:0)|t<<16}updateMaterial(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(i||e.needsUpdate||e.uniformsNeedUpdate))return;const n=this.#Cr(e),r=this.#Mr(e,t);this.#xr[0]=r,e.uniformsNeedUpdate&&(e.__gpuDiffuse=vE(e.color,Math.abs(e.opacity)),e.specular?e.__gpuSpecular=vE(e.specular,e.reflectivity):e.__gpuSpecular=0),this.#xr[1]=e.__gpuDiffuse,this.#xr[2]=e.__gpuSpecular,this.#br[3]=e.shininess,e.hatchPattern&&(this.#br[4]=e.hatchParams.x,this.#br[5]=e.hatchParams.y,this.#br[6]=e.hatchTintIntensity),this.#xr[7]=((e.heatmapSensorOffset??0)<<8)+e.heatmapSensorCount??0,this.#Tr(n),i||(e.needsUpdate=!1)}updateMaterial2D(e){if(e.needsUpdate||e.uniformsNeedUpdate){this.#Cr(e);const t=this.#Mr(e,0);this.#xr[0]=t,e.uniformsNeedUpdate&&(e.__gpuDiffuse=255*(e.opacity||1)<<24,e.uniformsNeedUpdate=!1),this.#xr[1]=e.__gpuDiffuse,e.hatchPattern&&(this.#br[4]=e.hatchParams.x,this.#br[5]=e.hatchParams.y,this.#br[6]=e.hatchTintIntensity);const i=this.getAlloc(e);this.#Tr(i.offset),e.needsUpdate=!1}}getMaterialRef(e){return this.getAlloc(e).offset/32}getGPUBuffer(){return this.#yr}initMaterialUpdateHook(e,t){if(!e.hasEventListener("update",this.#_r)){e.addEventListener("update",this.#_r),e.addEventListener("dispose",this.#Er);const i=!0;this.updateMaterial(e,t,i)}}#Ar(e){const t=e.target,i=E_(t);this.updateMaterial(t,i,!0)}#wr(e){const t=e.target;t.removeEventListener("update",this.#_r),t.removeEventListener("dispose",this.#Er)}}function vE(e,t){return 255*e.r|255*e.g<<8|255*e.b<<16|255*t<<24}const yE=()=>Ji?3e4:512;class bE{#Dt;#Ir;#Pr;#Lr=new Map;#Rr=[];#Dr=0;#Or=0;#Br;#Nr;#Ur=null;#kr=!1;#Fr=new Map;constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.#Dt=e,this.#Ur=t,this.#kr=n;const r=yE();if(this.#Ir=new Bm(r),n||!en){const e=this.#Dt.limits.maxStorageBufferBindingSize;this.#Nr=Math.floor(e/Lm),this.#Br=this.#Nr*Lm,i>0&&this.allocNewGPUBuffer(i)}else this.#Pr=new gx(e)}dtor(){this.clear(),this.#Dt=null,this.#Ur=null}byteSize(){return en&&!this.#kr?this.#Pr.computeUsedBytes().ubBytes:this.#Rr.reduce(((e,t)=>e+t.size),0)}clear(){if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){for(const e of this.#Rr)null==e||e.destroy();this.#Rr=[]}this.#Dr=0,this.#Or=0}get maxFragsPerBuffer(){return this.#Nr}get maxModelBufferByteSize(){return this.#Br}allocNewGPUBuffer(e){const t=this.#Dt.createBuffer({size:e,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});this.#Rr.push(t),this.#Or=this.#Rr.length-1,this.#Dr=0}preallocateModelBuffers(e){const t=e*Lm;let i=Math.ceil(t/this.#Br);const n=(i-1)*(yE()-1)*Lm;i*this.#Br<t+n&&(i+=1);let r=(t+n)/this.#Br%1*this.#Br;r=0===r?this.#Br:r+3&4294967292;for(let e=0;e<i-1;e++)this.allocNewGPUBuffer(this.#Br);this.allocNewGPUBuffer(r),this.#Or=0}allocUniformBufferRange(e){const t=e.count;if(t>Math.floor(gx.maxUniformBufferSize()/Lm))return console.error(`Requested range length ${t} exceeds maximum buffer size ${gx.maxUniformBufferSize()}`),null;if(en){const i=Lm*t,n=this.#Pr.uAlloc(i),r=n.bufferEntry.id;this.#Lr.set(r,n.bufferEntry);const o={bufferIndex:r,startIndex:n.offset/Lm,rangeLength:t};return this.#Fr.set(e,o),o}if(t>this.#Nr)return console.error("Range must fit into a single GPU buffer"),null;let i=this.#Vr();for(;i<t;){if(!this.#Gr())return null;i=this.#Vr()}const n={bufferIndex:this.#Or,startIndex:this.#Dr,rangeLength:t};return this.#Fr.set(e,n),this.#Dr+=t,n}freeUniformBufferRange(e){const t=this.getRange(e);if(!t)return;const i=this.#Lr.get(t.bufferIndex);if(!i)return;const n=t.startIndex*Lm,r=t.rangeLength*Lm;this.#Pr.free(i,n,r),this.clearRange(e)}getRange(e){return this.#Fr.get(e)}clearRange(e){this.#Fr.delete(e)}updateRange(e,t,i,n,r,o){const s=this.getGPUBuffer(o);let a=0;for(;a<n;){const o=this.#Ir.length(),l=n-a,c=Math.min(l,o),u=i+a,h=0;this.#zr(e,t,u,c,h);const d=r+a;this.#Ir.upload(this.#Dt,s,c,d),a+=c}}getGPUBuffer(e){let t,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(en&&!this.#kr){const i=this.#Lr.get(e);t=null==i?void 0:i.buffer}else t=this.#Rr[e];return i&&!t&&console.error(`Unexpcected GPUBuffer index: ${e}. No GPUBuffer found.`),t||null}setOneFragmentCPU(e,t,i){const n=e.getMaterial(t),r=this.#Ur.acquireMaterial(n);this.#Ir.setFromFragment(i,e,t,r)}setOneFragment(e,t,i,n){this.setOneFragmentCPU(e,t,0);const r=this.getGPUBuffer(i);r&&this.#Ir.upload(this.#Dt,r,1,n,0)}setOneObjectCPU(e,t){const i=this.#Ur.acquireMaterial(e.material);this.#Ir.setFromObject(e,t,i)}setObjectDataFromInstanceBuffer(e,t){const i=e.material;this.#Ur.updateMaterial(i);const n=this.#Ur.getMaterialRef(i),r=e.geometry;this.#Ir.setObjectDataFromInstanceBuffer(r,t,n)}writeToQueue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.getGPUBuffer(t);i&&this.#Ir.upload(this.#Dt,i,e,0,0,!0)}setMaterial(e,t,i){this.#Ur.updateMaterial(e);const n=this.#Ur.getMaterialRef(e),r=this.getGPUBuffer(t);r&&this.#Ir.uploadIntValue(this.#Dt,r,i,Om.materialReference,n)}updateTransform(e,t,i,n){const r=this.getGPUBuffer(i);r&&this.#Ir.uploadTransform(this.#Dt,r,n,e,t)}setThemingColor(e,t,i){const n=this.getGPUBuffer(t);n&&this.#Ir.uploadThemingColor(this.#Dt,n,i,e)}getUniformBuilder(){return this.#Ir}#Vr(){const e=this.getGPUBuffer(this.#Or);return e.size/Lm-this.#Dr}#zr(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;for(let o=0;o<n;o++){const n=t[i+o],s=e.getMaterial(n);let a=0;s&&(a=this.#Ur.acquireMaterial(s));const l=r+o;this.#Ir.setFromFragment(l,e,n,a)}}#Gr(){return!!this.getGPUBuffer(this.#Or+1,!1)&&(this.#Or+=1,this.#Dr=0,!0)}}const xE=1,_E=2,EE=3,SE=4;class AE{#Hr;#Wr;#jr;#qr;#Kr;#Ir;#Xr=this.#Yr.bind(this);#Qr=this.#Zr.bind(this);#$r=this.setOneFragment.bind(this);#Jr=this.updateTransform.bind(this);#eo=this.setMaterial.bind(this);#to=this.#io.bind(this);#no=this.setThemingColor.bind(this);#ro=!1;#oo=0;#e;constructor(e,t,i){this.#qr=e,this.#e=i,this.#jr=e.getFragmentList(),this.#so();const n=this.#jr.getCount();this.#Hr=new Int32Array(n),this.#Wr=new Int32Array(n),this.#ao(),this.#Ir=t,e.registerIteratorChangedCallback(this.#Xr),this.#Yr(this.#qr.getIterator())}dtor(){this.#qr.removeIteratorChangedCallback(this.#Xr),this.#lo(),this.#co()}#so(){this.#jr.registerMeshSetCallback(this.#$r),this.#jr.registerTransformChangedCallback(this.#Jr),this.#jr.registerMaterialChangedCallback(this.#eo),this.#jr.registerObjectFlagsChangedCallback(this.#to),this.#jr.registerThemingColorChangedCallback(this.#no)}#lo(){this.#jr.removeMeshSetCallback(this.#$r),this.#jr.removeTransformChangedCallback(this.#Jr),this.#jr.removeMaterialChangedCallback(this.#eo),this.#jr.removeObjectFlagsChangedCallback(this.#to),this.#jr.removeThemingColorChangedCallback(this.#no)}#co(){this.#uo((e=>{e.removeFragOrderChangedCallback(this.#Qr)}))}setMaterial(e,t,i){this.#ho(e,xE,t),i||this.#e.invalidateRenderBundles(this.#qr)}updateTransform(e){this.#ho(e,_E)}setThemingColor(e,t){this.#ho(e,EE,t)}fragOnGpu(e){return-1!==this.#Hr[e]}setOneFragment(e){this.#ho(e,SE)}updateFragmentLookup(e,t,i,n){wE(e,n,((e,n)=>{this.#Hr[e]=t,this.#Wr[e]=i+n}))}removeFromFragmentLookup(e){wE(e,e.count,(e=>{this.#Hr[e]=-1,this.#Wr[e]=-1}))}resetUpdateHeuristic(){this.#oo=0,this.#ro=!1}registerRenderBatch(e){e.registerFragOrderChangedCallback(this.#Qr);const t=this.#Ir.getRange(e);this.updateFragmentLookup(e,t.bufferIndex,t.startIndex,e.count)}unregisterRenderBatch(e){e.removeFragOrderChangedCallback(this.#Qr),this.removeFromFragmentLookup(e)}getGPUArrayIndex(e){return this.#Wr[e]}freeAllUniforms(){this.#uo((e=>{this.#Ir.freeUniformBufferRange(e)}))}#ho(e,t,i){if(this.#do())return;const n=this.#Hr[e],r=this.#Wr[e];if(this.fragOnGpu(e))switch(t){case xE:this.#Ir.setMaterial(i,n,r);break;case _E:this.#Ir.updateTransform(this.#jr,e,n,r);break;case EE:this.#jr.getThemingColor(e);this.#Ir.setThemingColor(i,n,r);break;case SE:this.#Ir.setOneFragment(this.#jr,e,n,r)}}#do(){return!!this.#ro||++this.#oo>1e3&&(this.#ro=!0,this.#io(),!0)}#uo(e){const t=this.#Kr.getGeomScenes();let i;for(let n=0;n<t.length;++n){i=t[n];!i||!i.count||e(i)}}#io(){this.#uo((e=>{e.uniformsNeedUpdate=!0}))}#fo(){this.#Kr&&(en&&this.freeAllUniforms(),this.#Ir.clear(!1),this.#ao(),this.#uo((e=>{e.removeFragOrderChangedCallback(this.#Qr),this.#Ir.clearRange(e)})),this.#Kr=null)}#Yr(e){if(this.#fo(),this.#Kr=e,en)return void(Ji||this.#io());let t=0;this.#uo((e=>{let i=this.#Ir.allocUniformBufferRange(e);if(!i){const n=this.#jr.fragments.length-t,r=this.#Ir.maxFragsPerBuffer,o=Math.min(n,r)*Lm;this.#Ir.allocNewGPUBuffer(o),i=this.#Ir.allocUniformBufferRange(e)}const n=e.count;this.updateFragmentLookup(e,i.bufferIndex,i.startIndex,n),e.registerFragOrderChangedCallback(this.#Qr),e.uniformsNeedUpdate=!0,t+=e.count}))}#ao(){this.#Hr.fill(-1),this.#Wr.fill(-1)}#Zr(e,t,i){if(void 0===e)return this.#ao(),void this.#io();const n=this.#Ir.getRange(i);this.updateFragmentLookup(i,n.bufferIndex,n.startIndex,t),this.#Ir.updateRange(i.frags,i.getIndices(),e,t,n.startIndex,n.bufferIndex)}}const wE=(e,t,i)=>{const n=e.getIndices();for(let r=0;r<t;r++){const t=e.start+r;i(n?n[t]:t,r)}},CE=e=>{const t=e.frags;return(null==t?void 0:t.modelId)??0};class TE{#Dt;#po;modelUniforms=new Map;#mo;#go;#mr;#vo;#Ni;#yo=[];#bo=new Map;MAX_BATCH=yE();OBJECT_STRIDE_32=Rm;#e;#xo;#_o=0;#Eo=0;constructor(e){this.#e=e,this.#Dt=e.getDevice(),this.#mr=new mE(this.#Dt),this.#vo=new gE(this.#Dt),this.#So(),this.#mo=new bE(this.#Dt,this.#vo,this.MAX_BATCH*Lm,!0);const t=this.#mo.getGPUBuffer(0);this.#go=this.#Mn(t),en&&(this.#po=new bE(this.#Dt,this.#vo))}updateBatch(e){let t,i;if(en)t=this.#po.getRange(e),t&&t.rangeLength!==e.count&&(this.freeUniforms(e),t=null),i=this.#po;else{const n=CE(e);i=this.modelUniforms.get(n),t=i.getRange(e)}t||(t=i.allocUniformBufferRange(e),this.#Ao(e));const n=e.lastItem-e.start;i.updateRange(e.frags,e.getIndices(),e.start,n,t.startIndex,t.bufferIndex)}freeUniforms(e){this.#po.getRange(e)&&(this.#po.freeUniformBufferRange(e),this.#wo(e))}getBindGroup(e){const t=e?CE(e):0;let i;if(en)i=this.#po.getRange(e);else{const n=this.modelUniforms.get(t);n&&(i=n.getRange(e))}if(!i)return this.#_o=0,this.#Eo=0,this.#xo=0,this.#go;this.#_o=i.startIndex,this.#Eo=0|e.start,this.#xo=t;const n=i.bufferIndex;return this.#Co(t,n)}getRenderIndex(e){return e-this.#Eo+this.#_o}getLayout(){return this.#Ni}addModel(e){var t;if(e.is2d())return;if(this.modelUniforms.get(e.id))return void console.warn("Adding the same model twice is unexpected.");const i=0|(null===(t=e.getFragmentList())||void 0===t||null===(t=t.fragments)||void 0===t?void 0:t.length);if(0===i)return;let n;en?n=this.#po:(n=new bE(this.#Dt,this.#vo),this.modelUniforms.set(e.id,n),n.preallocateModelBuffers(i)),this.#bo.set(e.id,new AE(e,n,this.#e)),this.#yo[e.id]=[]}removeModel(e){if(!this.#bo.has(e.id))return;const t=this.#bo.get(e.id);if(en&&!Ji&&t.freeAllUniforms(),!en){this.modelUniforms.get(e.id).dtor(),this.modelUniforms.delete(e.id)}t.dtor(),this.#bo.delete(e.id)}getCommonMaterialUniforms(){return this.#mr}getDynamicUniforms(){return this.#mo}setOneObjectData(e,t){this.#mo.setOneObjectCPU(e,t)}setOneMaterialData(e,t){this.#vo.updateMaterial(e,t)}setOneMaterialData2D(e){this.#vo.updateMaterial2D(e)}writeToQueue(e){this.#mo.writeToQueue(e,0)}resetUpdateHeuristic(e){var t;null===(t=this.#bo.get(e))||void 0===t||t.resetUpdateHeuristic()}setEdgeColorInt(e){this.#mr.setEdgeColorInt(e)}setDoNotCutOverride(e){this.#mr.setDoNotCutOverride(e)}initMaterialUpdateHook(e,t){this.#vo.initMaterialUpdateHook(e,t)}setMaterialReference(e,t){const i=this.#vo.acquireMaterial(t);this.#mo.getUniformBuilder().setMaterialReference(e,i)}byteSize(){const e=en?this.#po.byteSize():this.modelUniforms.reduce(((e,t)=>e+t.byteSize()),0);return e+this.#mo.byteSize()+this.#vo.byteSize()+this.#mr.byteSize()}setObjectDataFromInstanceBuffer(e,t){this.#mo.setObjectDataFromInstanceBuffer(e,t)}getObjectIndex(e){return this.#bo.get(this.#xo).getGPUArrayIndex(e)-this.#_o+this.#Eo}#So(){this.#Ni=this.#Dt.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]})}#Mn(e){return this.#Dt.createBindGroup({layout:this.#Ni,entries:[{binding:0,resource:{buffer:e}},{binding:1,resource:{buffer:this.#vo.getGPUBuffer()}},{binding:2,resource:{buffer:this.#mr.getGPUBuffer()}}]})}#Ao(e){const t=CE(e);this.#bo.get(t).registerRenderBatch(e)}#wo(e){const t=CE(e);this.#bo.get(t).unregisterRenderBatch(e)}#Co(e,t){const i=this.#To(e,t);if(!i)return console.error("TODO: Specified UniformBuffer does not exist."),null;let n=this.#yo[e][t];return n||(n=this.#Mn(i),this.#yo[e][t]=n),n}#To(e,t){return en?this.#po.getGPUBuffer(t):this.modelUniforms.get(e).getGPUBuffer(t)}}const ME={depthTest:!0,depthWrite:!0,depthFunc:"less-equal"},IE={depthTest:!0,depthWrite:!1,depthFunc:"greater"},PE={depthTest:!0,depthWrite:!1,depthFunc:"less-equal"},LE={depthTest:!0,depthWrite:!0,depthFunc:"less"},RE={x:0,y:0,z:0,w:.2},DE={x:0,y:0,z:0,w:.1},OE={x:1,y:1,z:1,w:1},BE={x:1,y:1,z:1,w:.5};class NE{#e;#Dt;#Mo;#Io;#Po;#Lo;#Ro;#Do;#Oo;#Bo;#No;#Uo=!1;#ko;#M;#Fo;#Vo;#vo;#mn;#Go;#zo;#Ho;#Wo;#jo;#qo;#Ko;#Xo;#Yo=Nm(RE);#Qo=Nm(DE);#Ln;#Zo=[];#$o=[];#Jo;#es;#ts=new Map;constructor(e){this.#e=e,this.#Fo=new T_(e),this.#Jo=new hE}#is(){let e=this.#e.getRenderTargets(),t=e.getColorTarget().createView(),i=e.getDepthTarget().createView(),n=e.getNormalsTarget().createView(),r=e.getViewDepthTarget().createView(),o=e.getOverlayTarget().createView();this.#Po={colorAttachments:[{view:n,clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:r,clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:i,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},this.#Mo={colorAttachments:[{view:t,loadOp:"load",storeOp:"store"},{view:n,loadOp:"load",storeOp:"store"},{view:r,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:i,depthLoadOp:"load",depthStoreOp:"store"}},this.#Do={colorFormats:[e.getColorTarget().format,e.getNormalsTarget().format,e.getViewDepthTarget().format],depthStencilFormat:[e.getDepthTarget().format]};for(let t=0;t<$x;t++){let i={view:e.getIdTarget(t).createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},n={view:i.view,loadOp:"load",storeOp:"store"},r=e.getIdTarget(t).format;this.#Po.colorAttachments.push(i),this.#Mo.colorAttachments.push(n),this.#Do.colorFormats.push(r)}this.#Oo={colorFormats:[e.getColorTarget().format],depthStencilFormat:[e.getDepthTarget().format]},this.#Io={colorAttachments:[{view:t,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:i,depthLoadOp:"load",depthStoreOp:"store"}},this.#Lo={colorAttachments:[{view:o,clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]},this.#Ro={colorAttachments:[{view:o,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:i,depthLoadOp:"load",depthStoreOp:"store"}}}init(e){this.#Dt=this.#e.getDevice(),this.#Fo.init(),this.#mn=new C_(this.#Dt),this.#zo=new M_(this.#Dt,this.#mn,this.#Fo),this.#Vo=e,this.#Zo.length=this.#Vo.MAX_BATCH,this.#$o.length=this.#Vo.MAX_BATCH,this.#vo=new __(this.#Dt,void 0,this.#e.getPlaceholderTexture()),this.#Go=new Z_(this.#Dt),this.#Ho=new N_(this.#e),this.#Wo=new F_(this.#e),this.#Ko=new $_(this.#e),this.#Xo=new $_(this.#e),this.#qo=new lE(this.#e),this.#jo=new N_(this.#e),this.#Ln=[this.#zo.getLayout(),this.#Vo.getLayout(),this.#vo.getLayout()];const t=[this.#zo.getLayout(),this.#Vo.getLayout(),this.#Go.getLayout()];this.#Ko.setLayouts(...t),this.#Xo.setLayouts(...t)}resize(e,t){this.#is(e,t),this.#Go.setTargetSize(e,t),this.#Go.upload()}#ns(e){let t=this.#Dt.createCommandEncoder();t.beginRenderPass(e).end(),this.#Dt.queue.submit([t.finish()])}clearMainTargets(){this.#ns(this.#Po)}clearOverlayTargets(){this.#ns(this.#Lo)}setGhostingBrightness(e){}updatePixelScale(e,t){this.#Go&&(this.#Go.updatePixelScale(e,t),this.#Go.upload())}setLineStyleBuffer(e,t){this.#Go&&(this.#Go.setLineStyleBuffer(e,t),this.#Go.upload())}getIBL(){return this.#Fo}disableRenderBundles(){this.#Uo=!0}#rs(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=e.beginRenderPass(t);this.#e.passViewport(r);let o=r;if(i){if(!i.record)return r;o=i}let s=this.#Vo.getBindGroup(n);return o.setBindGroup(0,this.#zo.getBindGroup()),o.setBindGroup(1,s),o.setBindGroup(2,this.#vo.getBindGroup()),this.#es=n,r}#os(e,t,i){let n=e.beginRenderPass(t);return this.#e.passViewport(n),i.setBindGroups(n,this.#zo.getBindGroup(),this.#Vo.getBindGroup(-1),this.#Go.getBindGroup()),n}#ss(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.finish();if(i&&t&&this.#Vo.writeToQueue(t),!i)return n;this.#e.getVB().flushWrites(),this.#Dt.queue.submit([n])}beginScene(e,t){this.#mn.update(e),this.#Fo.update()&&(this.#zo.updateBindGroup(),this.#e.invalidateRenderBundles())}#as(e,t,i,n){const r=this.#es.frags.getVizmesh(n);return this.#ls(r)}#cs(e,t,i,n){const r=this.#es.frags.getVizmesh(n);return this.#us(r)}#hs(e,t,i,n){if(!(e=this.#e.initGeometry(e)))return!0;let r;if(!this.#No||this.#Bo.record){const n=this.#Vo.getRenderIndex(i);this.#Zo[this.#M]=e,this.#$o[this.#M]=n,r=this.#Ho.drawOne(this.#ko,n,e,t),this.#Vo.initMaterialUpdateHook(t,r),t.needsUpdate=!1,this.#M++}return!1}#ds(e,t,i,n){if(!(e=this.#e.initGeometry(e)))return!0;const r=this.#Vo.getRenderIndex(i);return this.#Wo.drawOneGhosted(this.#ko,r,e,LE),!1}#ls(e){const t=e.material,i=this.#e.initGeometry(e.geometry);if(!i)return!0;if(this.#Zo[this.#M]=i,this.#$o[this.#M]=this.#M,t instanceof THREE.ShaderMaterial)return this.#Vo.setOneObjectData(e,this.#M),this.#qo.drawOne(this.#ko,this.#M,i,t),this.#M++,!1;const n=this.#Ho.drawOne(this.#ko,this.#M,i,t),r=i.numInstances;return void 0!==r?(this.#Vo.setObjectDataFromInstanceBuffer(e,this.#M),this.#M+=r):(this.#Vo.setOneObjectData(e,this.#M),this.#M++),this.#Vo.setOneMaterialData(t,n),!1}#us(e){const t=this.#e.initGeometry(e.geometry);return!t||(this.#Vo.setOneObjectData(e,this.#M),this.#Wo.drawOneGhosted(this.#ko,this.#M,t,LE),this.#M++,!1)}#fs(e){const t=this.#Dt.createRenderBundleEncoder(e);return t.record=!0,t}#ps(e,t,i,n){if(n){let r=n;n.record&&(r=n.finish(),this.setRenderBundle(e,t,r)),i.executeBundles([r])}}renderScenePart(e,t){let i,n,r,o,s,a,l,c,u=this.#e.getRenderTargets();if(u.setIdTargetsDirty(),this.#No=!1,e instanceof Sc){i=e,n=i.frags.modelId,c=!1,r=this.#hs.bind(this),o=this.#ds.bind(this),this.#Vo.resetUpdateHeuristic(n);if(!i.is2d()){Ji&&!i.isComplete?(c=!0,r=this.#as.bind(this),o=this.#cs.bind(this)):i.uniformsNeedUpdate&&(this.#Vo.updateBatch(i),i.uniformsNeedUpdate=!1),this.#e.clear3dModelVisibilityDirty(n)}this.#Uo||(this.#No=i.useRenderBundles),this.#No&&(s=this.getRenderBundle(i,0),a=this.getRenderBundle(i,1),t&&s&&!a&&(s=null),!t&&a&&(this.setRenderBundle(i,1,null),a=null),l=this.getRenderBundle(i,2))}else this.#Jo.setFromScene(e,this.#mn.getViewProjectionMatrix()),i=this.#Jo,n=-1,c=!0,r=this.#ls.bind(this),o=this.#us.bind(this);if(i.is2d())return void this.#ms(i);let h=u.getTargetsListMainPass(),d=u.getTargetsListEdgePass();this.#Vo.setDoNotCutOverride(!1);let f,p=0;do{this.#M=0;let n=this.#Dt.createCommandEncoder();if(e.edgesOnly){this.#Vo.setEdgeColorInt(this.#Qo),this.#No&&!l&&(l=this.#fs(this.#Oo));const e=this.#rs(n,this.#Io,l,i);this.#ko=l||e,this.#Wo.reset(this.#Ln,d),this.#M=0;let t=0;this.#No&&!l.record||(t=i.forEachWGPU(p,this.#Vo.MAX_BATCH,o)),this.#ps(i,2,e,l),e.end(),f=this.#ss(n,this.#M,c),p=t}else{this.#Vo.setEdgeColorInt(this.#Yo),this.#No&&(s||(s=this.#fs(this.#Do)),this.#Bo=s);const e=this.#rs(n,this.#Mo,s,i);this.#ko=s||e,this.#Ho.reset(this.#Ln,h),this.#qo.reset(this.#Ln,h);let o=0;if(this.#No&&!s.record||(o=i.forEachWGPU(p,this.#Vo.MAX_BATCH,r)),this.#ps(i,0,e,s),e.end(),t){this.#No&&!a&&(a=this.#fs(this.#Oo));const e=this.#rs(n,this.#Io,a,i);if(this.#ko=a||e,this.#Wo.reset(this.#Ln,d),!this.#No||a.record)for(let e=0;e<this.#M;){const t=this.#Zo[e],i=t.numInstances??1;this.#Wo.drawOne(this.#ko,this.#$o[e],t,ME),e+=i}this.#ps(i,1,e,a),e.end()}f=this.#ss(n,this.#M,c),p=o}}while(p>0);return this.#ko=null,this.#Bo=null,f}#ms(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.#e.getRenderTargets();i||n.setIdTargetsDirty();let r=e,o=i?n.getOverlayTargetsList():n.getTargetsListMainPass();this.#Vo.setDoNotCutOverride(!1);let s=0;do{let e=0,n=this.#Dt.createCommandEncoder({label:"2d mainpass encoder"});const a=i?this.#Ro:this.#Mo,l=i?this.#Xo:this.#Ko;l.reset(o);let c=this.#os(n,a,l);this.#e.passViewport(c);let u=r.forEachWGPU(s,this.#Vo.MAX_BATCH,(i=>{const n=t||i.material,r=this.#e.initGeometry(i.geometry);if(!r)return!0;l.drawOne(c,e,r,n),this.#Vo.setOneObjectData(i,e),this.#Vo.setOneMaterialData2D(n,0),e++}));c.end(),this.#ss(n,e),s=u}while(s>0)}renderOverlay(e,t,i,n,r,o,s){if(this.#mn.update(t),this.#Jo.setFromScene(e,this.#mn.getViewProjectionMatrix()),this.#Jo.is2d())return void this.#ms(this.#Jo,i,!0);let a=this.#e.getRenderTargets().getOverlayTargetsList();this.#Vo.setDoNotCutOverride(!this.#Jo.needsCutPlanes());let l,c=0;do{let e,t=0,s=this.#Dt.createCommandEncoder();i&&(e=i),this.#Vo.setEdgeColorInt(Nm(o||BE));let u=this.#rs(s,this.#Ro);if(this.#jo.reset(this.#Ln,a),l=this.#Jo.forEachWGPU(c,this.#Vo.MAX_BATCH,(i=>{const n=i.material,r=this.#e.initGeometry(i.geometry);if(!r)return!0;this.#Zo[t]=r;const o=e||n,s=void 0!==r.numInstances,a=r.numInstances??1,l=this.#jo.drawOne(u,t,r,o);i.material=o,s?(this.#Vo.setObjectDataFromInstanceBuffer(i,t),t+=a):(this.#Vo.setOneObjectData(i,t),t++),this.#Vo.setOneMaterialData(o,l)})),u.end(),n){if(r){let e=this.#rs(s,this.#Ro);this.#Wo.reset(this.#Ln,a);for(let i=0;i<t;i++)this.#Wo.drawOne(e,i,this.#Zo[i],IE);e.end()}this.#ss(s,t),s=this.#Dt.createCommandEncoder();{n.depthFunc="greater",n.needsUpdate=!0,this.#Vo.setEdgeColorInt(Nm(o||OE));let e=this.#rs(s,this.#Ro);this.#jo.reset(this.#Ln,a);let t=0;const i=n;l=this.#Jo.forEachWGPU(c,this.#Vo.MAX_BATCH,(n=>{const r=this.#e.initGeometry(n.geometry);if(!r)return!0;const o=this.#jo.drawOne(e,t,r,i);this.#Vo.setMaterialReference(t*this.#Vo.OBJECT_STRIDE_32,i),this.#Vo.setOneMaterialData(i,o),t++})),e.end()}}if(r){let e=this.#rs(s,this.#Ro);this.#Wo.reset(this.#Ln,a);for(let i=0;i<t;i++)this.#Wo.drawOne(e,i,this.#Zo[i],PE);e.end()}this.#ss(s,t),c=l}while(c>0)}getRenderBundle(e,t){const i=this.#ts.get(e);return null==i?void 0:i[t]}setRenderBundle(e,t,i){let n=this.#ts.get(e);n||(n=[],this.#ts.set(e,n)),n[t]=i}clearRenderBundles(e){const t=this.#ts.get(e);t&&(t.length=0)}}const UE="$0 // ghosting\n\n@id(0) override r1: f32 = 0.9;\n@id(1) override g1: f32 = 0.9;\n@id(2) override b1: f32 = 0.9;\n\n@id(3) override r2: f32 = 0.59;\n@id(4) override g2: f32 = 0.59;\n@id(5) override b2: f32 = 0.59;\n\n@fragment\nfn main(\n    @builtin(position) coord : vec4f,\n    @location(0) @interpolate(linear) vUv: vec2f\n) -> @location(0) vec4f {\n    var outColor = mix(vec3f(r2, g2, b2), vec3f(r1, g1, b1), vUv.y);\n    return vec4f(outColor + orderedDithering(vec2i(floor(coord.xy))) / 256.0, 1.0);\n}\n";function kE(e){let t,i,n,r,o,s,a,l,c,u,h,d=e,f=1,p=!1;function m(){i=t.createRenderPipeline({layout:"auto",vertex:{module:r,entryPoint:"main"},fragment:{module:o,entryPoint:"main",targets:[{format:d.getRenderTargets().getColorTarget().format,blend:{color:{operation:"add",srcFactor:"constant",dstFactor:"zero"},alpha:{operation:"add",srcFactor:"constant",dstFactor:"zero"}}}],constants:{0:s,1:a,2:l,3:c,4:u,5:h}},primitive:{topology:"triangle-list",cullMode:"back"}})}this.init=function(){t=d.getDevice(),r||(r=t.createShaderModule({code:Ex})),o||(o=t.createShaderModule({code:Im(UE,U_)})),!i&&p&&m(),n||(n={colorAttachments:[{view:void 0,loadOp:"load",storeOp:"store"}]})},this.setAlpha=function(e){f=e},this.run=function(){if(!t||!p)return;let e=t.createCommandEncoder();n.colorAttachments[0].view=d.getRenderTargets().getColorTargetView();let r=e.beginRenderPass(n);d.passViewport(r),r.setPipeline(i),r.setBlendConstant([f,f,f,f]),r.draw(3),r.end(),t.queue.submit([e.finish()])},this.setClearColors=function(e,n,r,o,d,f){s=e,a=n,l=r,c=o,u=d,h=f,i=null,t&&m(),p=!0},this.getClearColors=function(){return[s,a,l,c,u,h]}}const FE="@group(0) @binding(0) var envMap: texture_cube<f32>;\n@group(0) @binding(1) var envSampler: sampler;\n\nstruct EnvMapUniforms {\n\tuCamDir: vec4f,\n\tuCamUp: vec4f,\n\tuResolution: vec2f,\n\tuHalfFovTan: f32,\n\tenvMapExposure: f32,\n\texposureBias: f32,\n\ttonemapMethod: i32\n}\n@group(1) @binding(0) var<uniform> u : EnvMapUniforms;\n\n$tonemap\n$envMapSample\n\nfn rayDir(vUv: vec2f) -> vec3f {\n    var A = (u.uResolution.x/u.uResolution.y)*normalize(cross(u.uCamDir.xyz,u.uCamUp.xyz)) * (u.uHalfFovTan * 2.0);\n    var B = normalize(u.uCamUp.xyz) * (u.uHalfFovTan * 2.0);\n    var C = normalize(u.uCamDir.xyz);\n\n    var ray = normalize( C + (2.0*vUv.x - 1.0)*A + (2.0*vUv.y - 1.0)*B );\n    return ray;\n}\n\n\n@fragment\nfn main\t(\n\t@builtin(position) coord : vec4f,\n\t@location(0) @interpolate(linear) vUv: vec2f\n) -> @location(0) vec4f {\n\n\tvar rd = rayDir(vUv);\n\n\tvar outColor = sampleIrradianceMap(rd, envMap, envSampler, u.envMapExposure).xyz;\n\n#if $tonemapMethod1\n\toutColor = toneMapCanonOGS_WithGamma_WithColorPerserving(u.exposureBias * outColor.xyz);\n#elif $tonemapMethod2\n\toutColor = toneMapCanonFilmic_WithGamma(u.exposureBias * outColor.xyz);\n#endif\n\n\treturn vec4f(outColor, 1.0);\n}\n";let VE=new rl;class GE extends Ax{constructor(e){super(e,14,!0,!1)}update(e,t,i,n,r){let o=e.worldUpTransform?e.getWorldDirection(VE).applyMatrix4(e.worldUpTransform):e.getWorldDirection(VE);this.setVector3(0,o);let s=e.worldUpTransform?e.up.clone().applyMatrix4(e.worldUpTransform):e.up;this.setVector3(4,s),this.setFloat(8,t[0]),this.setFloat(9,t[1]),this.setFloat(10,Math.tan(THREE.Math.degToRad(.5*e.fov))),this.setFloat(11,i),this.setFloat(12,n),this.setInt(13,r)}}function zE(e){let t,i,n,r,o,s,a,l=e,c=1,u=1,h=0,d=1;this.init=function(){var e,i;t=l.getDevice(),n=new GE(t),o||(o=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"cube"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]})),r||(r=t.createRenderPipeline({layout:t.createPipelineLayout({bindGroupLayouts:[o,n.getLayout()]}),vertex:{module:t.createShaderModule({code:Ex}),entryPoint:"main"},fragment:{module:t.createShaderModule({code:(e=!0,i=2,Im(FE,{tonemap:jx,envMapSample:n_(e,!e,i>0),tonemapMethod1:1===i,tonemapMethod2:2===i}))}),entryPoint:"main",targets:[{format:l.getRenderTargets().getColorTarget().format,blend:{color:{operation:"add",srcFactor:"constant",dstFactor:"zero"},alpha:{operation:"add",srcFactor:"constant",dstFactor:"zero"}}}]},primitive:{topology:"triangle-list",cullMode:"back"}})),a||(a={colorAttachments:[{view:void 0,loadOp:"load",storeOp:"store"}]})},this.setCubeMap=function(e){f_(e),p_(i),i=e},this.getCubeMap=function(){return i},this.hasCubeMap=function(){return!!i},this.setEnvExposure=function(e){const t=Math.pow(2,e);t!==u&&(u=t)},this.setExposureBias=function(e){let t=Math.pow(2,e);t!==c&&(c=t)},this.setTonemapMethod=function(e){h!==e&&(h=e)},this.setEnvRotation=function(e){},this.setCamera=function(e){if(!t)return;let i=l.getRenderTargets().getTargetSize();n.update(e,i,u,c,h)},this.setAlpha=function(e){d=e},this.run=function(){if(!t)return;!i.needsUpdate&&s||(h_(t,i),s=t.createBindGroup({layout:o,entries:[{binding:0,resource:i.__gpuTextureCube.createView({dimension:"cube"})},{binding:1,resource:i.__gpuSampler}]})),n.upload();let e=t.createCommandEncoder();a.colorAttachments[0].view=l.getRenderTargets().getColorTargetView();let c=e.beginRenderPass(a);l.passViewport(c),c.setPipeline(r),c.setBlendConstant([d,d,d,d]),c.setBindGroup(0,s),c.setBindGroup(1,n.getBindGroup()),c.draw(3),c.end(),t.queue.submit([e.finish()])}}const HE='$pack_depth\n\n// Total number of direct samples to take at each pixel\nconst NUM_SAMPLES = 17;\n\n// If using depth mip levels, the log of the maximum pixel offset before we need to switch to a lower\n// miplevel to maintain reasonable spatial locality in the cache\n// If this number is too small (< 3), too many taps will land in the same pixel, and we\'ll get bad variance that manifests as flashing.\n// If it is too high (> 5), we\'ll get bad performance because we\'re not using the MIP levels effectively\nconst LOG_MAX_OFFSET: i32 = 3;\n\n// This must be less than or equal to the MAX_MIP_LEVEL defined in SSAO.cpp\nconst MAX_MIP_LEVEL: i32 = 5;\n\n// This is the number of turns around the circle that the spiral pattern makes.  This should be prime to prevent\n// taps from lining up.  This particular choice (5) was tuned for NUM_SAMPLES == 17\n// Here is the table. The one\'s digit is the column, the ten\'s is the row to look at.\n// +0   1   2   3   4   5   6   7   8   9\n//  1,  1,  1,  2,  3,  2,  5,  2,  3,  2,  // 00\n//  3,  3,  5,  5,  3,  4,  7,  5,  5,  7,  // 10\n//  9,  8,  5,  5,  7,  7,  7,  8,  5,  8,  // 20\n// 11, 12,  7, 10, 13,  8, 11,  8,  7, 14,  // 30\n// 11, 11, 13, 12, 13, 19, 17, 13, 11, 18,  // 40\n// 19, 11, 11, 14, 17, 21, 15, 16, 17, 18,  // 50\n// 13, 17, 11, 17, 19, 18, 25, 18, 19, 19,  // 60\n// 29, 21, 19, 27, 31, 29, 21, 18, 17, 29,  // 70\n// 31, 31, 23, 18, 25, 26, 25, 23, 19, 34,  // 80\n// 19, 27, 21, 25, 39, 29, 17, 21, 27, 29}; // 90\n\nconst NUM_SPIRAL_TURNS = 5;\n\nconst MIN_RADIUS = 3.0; // pixels\n\nconst TAU = 6.28318530718;\n\n//////////////////////////////////////////////////\n\n//\n// Uniforms and functions to reconstruct camera-space and world-space positions.\n// in post-processing passes from the (linear) depth texture.\n//\nstruct SAOUniforms {\n\t// vec4 used to reconstruct camera-space positions from screen-space + zValue (from tDepth).\n\t// It is computed from canvas resolution and projection matrix used during scene rendering by:\n\t// (see RenderContext.beginScene)\n\t//\n\t//  vec4(-2.0f / (width*P[0][0]),\n\t//       -2.0f / (height*P[1][1]),\n\t//      ( 1.0f - P[0][2]) / P[0][0],\n\t//      ( 1.0f + P[1][2]) / P[1][1])\n\t//\n\t//  where P is the projection matrix that maps camera space points\n\t//  to [-1, 1] x [-1, 1].\n\tprojInfo: vec4f,\n\n\t/* The height in pixels of a 1m object if viewed from 1m away.\n\t  You can compute it from your projection matrix.  The actual value is just\n\t  a scale factor on radius; you can simply hardcode this to a constant (~500)\n\t  and make your radius value unitless (...but resolution dependent.)  */\n\tprojScale: f32,\n\n\tcameraNear: f32,\n\tcameraFar: f32,\n\tlumInfluence: f32,// how much luminance affects occlusion\n\n\t/* World-space AO radius in scene units (r).  e.g., 1.0m */\n\tradius: f32,\n\t/* Bias to avoid AO in smooth corners, e.g., 0.01m */\n\tbias: f32,\n\tintensity: f32,\n\tisOrtho: i32 // 1 if ortho-camera is used, 0 for perspective\n}\n\n// Negative, "linear" depth values in world-space units\n@group(0) @binding(0) var tNormals: texture_2d<f32>;\n@group(0) @binding(1) var tDepth: texture_2d<f32>;\n@group(0) @binding(2) var<uniform> u: SAOUniforms;\n\n#if $USE_MIPMAP\n\t@group(0) @binding(3) var tDepth_mip: texture_2d<f32>;\n#endif\n\n\n/* intensity / radius^6 */\n//uniform float intensityDivR6;\n//float intensityDivR6 = intensity / pow(radius, 6.0);\n\n/* Returns a unit vector and a screen-space radius for the tap on a unit disk (the caller should scale by the actual disk radius) */\nfn tapLocation(sampleNumber: i32, spinAngle: f32) -> vec3f {\n\t// Radius relative to ssR\n\tvar alpha = (f32(sampleNumber) + 0.5) * (1.0 / f32(NUM_SAMPLES));\n\tvar angle = alpha * (f32(NUM_SPIRAL_TURNS) * TAU) + spinAngle;\n\n\treturn vec3f(cos(angle), sin(angle), alpha);\n}\n\n\n/* Used for packing Z into the GB channels */\nfn CSZToKey(z: f32) -> f32 {\n\t// convert from z in camera space to 0-1 space:\n\t// z is a negative value, near and far are positive\n\t// (-z-cameraNear) / (cameraFar-cameraNear)\n\treturn clamp( (z + u.cameraNear) / (u.cameraNear - u.cameraFar), 0.0, 1.0);\n}\n\n\n/* Used for packing Z into the GB channels */\nfn packKey(key: f32) -> vec2f {\n\tvar p: vec2f;\n\n\t// Round to the nearest 1/256.0\n\tvar temp = floor(key * 255.0);\n\n\t// Integer part\n\tp.x = temp * (1.0 / 255.0);\n\n\t// Fractional part\n\tp.y = key * 255.0 - temp;\n\n\treturn p;\n}\n\n//Used to unpack depth value when input depth texture is RGBA8\nfn unpackDepthNearFar( packedDepth: vec3f ) -> f32 {\n\tvar depth = unpackDepth10(packedDepth);\n\tif (depth == 0.0) {\n\t\t//pixel is sky box\n\t\treturn -u.cameraFar * 1.0e10;\n\t}\n\treturn -(depth * (u.cameraFar - u.cameraNear) + u.cameraNear);\n}\n\n/*\n   Clipping plane constants for use by reconstructZ\n\n   clipInfo = (z_f == -inf()) ? Vector3(z_n, -1.0f, 1.0f) : Vector3(z_n * z_f,  z_n - z_f,  z_f);\n */\n//"uniform vec3      clipInfo;",\n//"vec3 clipInfo = vec3(cameraNear * cameraFar, cameraNear - cameraFar, cameraFar);",\n\n//"float reconstructCSZ(float d) {",\n//    "return clipInfo[0] / (clipInfo[1] * d + clipInfo[2]);",\n//"}",\n\n/* Reconstructs screen-space unit normal from screen-space position */\n//vec3 reconstructCSFaceNormal(vec3 C) {\n//    return normalize(cross(dFdy(C), dFdx(C)));\n//}\n\n//vec3 reconstructNonUnitCSFaceNormal(vec3 C) {\n//    return cross(dFdy(C), dFdx(C));\n//}\n\n\n// Reconstruct camera-space P.xyz from screen-space fragCoords = (x, y) in\n//  pixels and camera-space z < 0.  Assumes that the upper-left pixel center\n//  is at (0.5, 0.5) [but that need not be the location at which the sample tap\n//  was placed!]\n//\n//  Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\nfn reconstructCSPosition(fragCoords: vec2f, z: f32) -> vec3f {\n\tvar ndc = (fragCoords * u.projInfo.xy + u.projInfo.zw);\n\n\tif (u.isOrtho != 0) {\n\t\treturn vec3f(ndc * -1.0, z);\n\t} else {\n\t\treturn vec3f(ndc * z, z);\n\t}\n}\n\n/* Read the camera-space position of the point at screen-space pixel ssP */\nfn getPosition(ssP: vec2<i32>, depth: f32) -> vec3f {\n\t// Offset to pixel center\n\tvar P = reconstructCSPosition(vec2f(ssP) + vec2f(0.5), depth);\n\treturn P;\n}\n\n/* Read the camera-space position of the point at screen-space pixel ssP + unitOffset * ssR.  Assumes length(unitOffset) == 1 */\nfn getOffsetPosition(ssC: vec2i, unitOffset: vec2f, ssR: f32) -> vec3f {\n\n\tvar ssP = vec2i(ssR * unitOffset) + ssC;\n\n\tvar z: f32;\n\n\t// We need to divide by 2^mipLevel to read the appropriately scaled coordinate from a MIP-map.\n\t// Manually clamp to the texture size because texelFetch bypasses the texture unit\n\t//"ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(CS_Z_buffer, mipLevel) - ivec2(1));",\n\t//"ivec2 mipP = ssP;",\n\t//"P.z = texelFetch(tDepth, mipP, 0).z;",\n\n#if $USE_MIPMAP\n\tvar mipLevel: u32 = u32(clamp(i32(floor(log2(ssR))) - LOG_MAX_OFFSET, 0, MAX_MIP_LEVEL));\n\n\tif (mipLevel == 0) {\n\t\tz = unpackDepthNearFar(textureLoad(tDepth, ssP, 0).rgb);\n\t}\n\telse {\n\t\tmipLevel -= 1;\n\t\tvar mipP: vec2i = clamp(ssP >> vec2u(mipLevel + 1), vec2i(0), vec2i(textureDimensions(tDepth_mip, mipLevel)) - vec2i(1));\n\t\tz = unpackDepthNearFar(textureLoad(tDepth_mip, mipP, mipLevel).rgb);\n\t}\n#else\n\tz = unpackDepthNearFar(textureLoad(tDepth, ssP, 0).rgb);\n#endif\n\n\n\t// Offset to pixel center\n\treturn reconstructCSPosition(vec2f(ssP) + vec2f(0.5), z);\n}\n\n/** Compute the occlusion due to sample with index \\a i about the pixel at \\a ssC that corresponds\n  to camera-space point \\a C with unit normal \\a n_C, using maximum screen-space sampling radius \\a ssDiskRadius\n\n  Note that units of H() in the HPG12 paper are meters, not\n  unitless.  The whole falloff/sampling function is therefore\n  unitless.  In this implementation, we factor out (9 / radius).\n\n  Four versions of the falloff function are implemented below\n */\nfn sampleAO(ssC: vec2i, C: vec3f, n_C: vec3f, ssDiskRadius: f32, tapIndex: i32, randomPatternRotationAngle: f32) -> f32 {\n\t// Offset on the unit disk, spun for this pixel\n\tvar unitOffset = tapLocation(tapIndex, randomPatternRotationAngle);\n\tvar ssR = unitOffset.z;\n\n\t// Ensure that the taps are at least 1 pixel away\n\tssR = max(0.75, ssR * ssDiskRadius);\n\n\t// The occluding point in camera space\n\tvar Q = getOffsetPosition(ssC, unitOffset.xy, ssR);\n\n\t// aoValueFromPositionsAndNormal() in original code\n\tvar v = Q - C;\n\n\tvar vv = dot(v, v);\n\tvar vn = dot(v, n_C);\n\n\tconst epsilon = 0.001;    // was 0.01, but in G3D code it\'s 0.001\n\n\t// Without the angular adjustment term, surfaces seen head-on have less AO\n\tvar angAdjust = mix(1.0, max(0.0, 1.5 * n_C.z), 0.35);\n\n\t// fallOffFunction()\n\t// comment out this line for lower quality function:\n//#define HIGH_QUALITY\n\t// A: From the HPG12 paper\n\t// Note large epsilon to avoid overdarkening within cracks\n\t//"return angAdjust * float(vv < radius * radius) * max((vn - bias) / (epsilon + vv), 0.0) * (radius * radius) * 0.6;",\n\n\t// B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n//#ifdef HIGH_QUALITY\n\n\t// Higher quality version:\n\t// Epsilon inside the sqrt for rsqrt operation\n\tvar f = max(1.0 - vv / (u.radius * u.radius), 0.0); return angAdjust * f * max((vn - u.bias) / sqrt(epsilon + vv), 0.0);\n//# else\n\t// Avoid the square root from above.\n\t//  Assumes the desired result is intensity/radius^6 in main()\n\t//var f = max(u.radius * u.radius - vv, 0.0); return angAdjust * f * f * f * max((vn - u.bias) / (epsilon + vv), 0.0);\n//# endif\n\n\t// C: Medium contrast (which looks better at high radii), no division.  Note that the\n\t// contribution still falls off with radius^2, but we\'ve adjusted the rate in a way that is\n\t// more computationally efficient and happens to be aesthetically pleasing.\n\t//"return angAdjust * 4.0 * max(1.0 - vv / (radius * radius), 0.0) * max(vn - bias, 0.0);",\n\n\t// D: Low contrast, no division operation\n\t//"return angAdjust * 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);",\n}\n\n\n// user variables\n\n\n// random angle in radians between 0 and 2 PI\nfn getRandomAngle(pos: vec2f) -> f32 {\n\t// from http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\n\tvar dt = dot(pos ,vec2f(12.9898,78.233));\n\treturn TAU * fract(sin(dt % 3.14) * 43758.5453);\n}\n\n@fragment fn psmain(\n\t@builtin(position) position: vec4f,\n\t@location(0) @interpolate(linear) vUv: vec2f\n) -> @location(0) vec4f {\n\n\t// Pixel being shaded\n\tvar ssC = vec2i(floor(position.xy));\n\n\t//get the normal and depth from our normal+depth texture\n\tvar nrmz = textureLoad(tNormals, ssC, 0);\n\tvar depth = unpackDepth10(textureLoad(tDepth, ssC, 0).rgb);\n\n\t//TODO: figure out how to hook this up with a depth test\n\t// Unneccessary with depth test.\n\tif (depth == 0.0) {\n\t\t// We\'re on the skybox\n\t\treturn vec4f(1.0, packKey(1.0), 0.0);\n\t}\n\n\tdepth = -(depth * (u.cameraFar - u.cameraNear) + u.cameraNear);\n\n\tvar output: vec4f;\n\n\t// Camera space point being shaded\n\tvar C = getPosition(ssC, depth);\n\n\tvar outputGB = packKey(CSZToKey(C.z));\n\toutput.g = outputGB.x;\n\toutput.b = outputGB.y;\n\n\t// Choose the screen-space sample radius\n\t// proportional to the projected area of the sphere.\n\t// If orthographic, use 1.0 for the divisor, else use the world-space point\'s Z value.\n\tvar ssDiskRadius = u.projScale * u.radius;\n\tif (u.isOrtho == 0) {\n\t\tssDiskRadius /= -C.z;\n\t}\n\n\tvar A: f32;\n\tif (ssDiskRadius <= MIN_RADIUS) {\n\t\t// There is no way to compute AO at this radius\n\t\tA = 1.0;\n\t} else {\n\n\t\tvar sum = 0.0;\n\n\t\t// Hash function used in the HPG12 AlchemyAO paper\n\t\t//var randomPatternRotationAngle = modXXX(f32((((3 * ssC.x) ^ (ssC.y + ssC.x * ssC.y))) * 10), TAU);\n\t\tvar randomPatternRotationAngle = getRandomAngle(vUv);\n\n\t\t// Reconstruct normals from positions. These will lead to 1-pixel black lines\n\t\t// at depth discontinuities, however the blur will wipe those out so they are not visible\n\t\t// in the final image.\n\t\t//vec3 n_C = reconstructCSFaceNormal(C);\n\t\tvar n_C = unpackNormal10(nrmz.xyz);\n\n\t\tfor (var i = 0; i < NUM_SAMPLES; i++) {\n\t\t\tsum += sampleAO(ssC, C, n_C, ssDiskRadius, i, randomPatternRotationAngle);\n\t\t}\n\n\t\t//var intensityDivR6 = u.intensity / pow(u.radius, 6.0);\n\t\t// high quality:\n\t//#ifdef HIGH_QUALITY\n\t\tA = pow(max(0.0, 1.0 - sqrt(sum * (3.0 / f32(NUM_SAMPLES)))), u.intensity);\n\n\t//# else\n\t\t// lower quality:\n\t\t//A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\n\t\t// Use the following line only with the lower quality formula.\n\t\t// Anti-tone map to reduce contrast and drag dark region farther\n\t\t// (x^0.2 + 1.2 * x^4)/2.2\n\t\t//A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\t//# endif\n\n\t\t// This code has been removed by the creator of the algorithm, see:\n\t\t// http://g3d.cs.williams.edu/websvn/filedetails.php?repname=g3d&path=%2FG3D10%2Fdata-files%2Fshader%2FAmbientOcclusion%2FAmbientOcclusion_AO.pix\n\t\t// In practice it seems to make no difference visually, but matters for\n\t\t// time spent in the benchmark! We see drops on 80 spheres metal and red of 20%. Weird.\n\t\t// So, we\'ll leave it in.\n\t\t// Bilateral box-filter over a quad for free, respecting depth edges\n\t\t// (the difference that this makes is subtle)\n\t\t//"if (abs(dFdx(C.z)) < 0.02) {",\n\t\t//    "A -= dFdx(A) * ((ssC.x & 1) - 0.5);",\n\t\t//"}",\n\t\t//"if (abs(dFdy(C.z)) < 0.02) {",\n\t\t//    "A -= dFdy(A) * ((ssC.y & 1) - 0.5);",\n\t\t//"}",\n\t\t/*\n\t\tif (abs(dFdx(C.z)) < 0.02) {\n\t\t\tA -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n\t\t}\n\t\tif (abs(dFdy(C.z)) < 0.02) {\n\t\t\tA -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n\t\t}\n\t\t*/\n\n\t\t// Fade in as the radius reaches 2 pixels\n\t\tA = mix(1.0, A, clamp(ssDiskRadius - MIN_RADIUS,0.0,1.0));\n\t}\n\n\toutput.r = A;\n\toutput.a = 1.0;\n\n\t// to show depths instead of SAO, uncomment:\n\t//output.r = CSZToKey(C.z);\n\t// to show normal component (pick one, x or y):\n\t//output.r = nrmz.y;\n\n\treturn output;\n\n}\n',WE=!0;const jE="@group(0) @binding(0) var tDepth: texture_2d<f32>;\n\n@fragment\nfn psmain(\n\t@builtin(position) coord : vec4f,\n) -> @location(0) vec4f {\n\n\t// Rotated grid subsampling to avoid XY directional bias or Z precision bias while downsampling.\n\tvar ssP = vec2i(coord.xy);\n\treturn textureLoad(tDepth, clamp(ssP * 2 + vec2i(ssP.y & 1, ssP.x & 1), vec2i(0), vec2i(textureDimensions(tDepth)) - vec2i(1)), 0);\n}\n",qE='/* Increase to make depth edges crisper (though possibly noisier. Decrease to reduce flicker. */\nconst EDGE_SHARPNESS = 3.0;\n\n/* Step in 2-pixel intervals since we already blurred against neighbors in the\n  first AO pass.  This constant can be increased while R decreases to improve\n  performance at the expense of some dithering artifacts.\n\n  Morgan found that a scale of 3 left a 1-pixel checkerboard grid that was\n  unobjectionable after shading was applied but eliminated most temporal incoherence\n  from using small numbers of sample taps.\n */\nconst SCALE = 2;\n\n/* Filter radius in pixels. This will be multiplied by SCALE. */\n// Don\'t change this value, as the loop using it had to be unwound and hardcoded.\nconst R = 4;\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\n/* Swizzle to use to extract the channels of source. This macro allows\n  the same blur shader to be used on different kinds of input data. */\n//#define VALUE_COMPONENTS   r\n\n//#define VALUE_IS_KEY       0\n\n/* Channel encoding the bilateral key value (which must not be the same as VALUE_COMPONENTS) */\n//#define KEY_COMPONENTS     gb\n\n\n// Gaussian coefficients (must be of length R+1)\nconst gaussian = array<f32, R+1>(\n//    float[](0.356642, 0.239400, 0.072410, 0.009869);\n//    float[](0.398943, 0.241971, 0.053991, 0.004432, 0.000134);  // stddev = 1.0\n0.153170, 0.144893, 0.122649, 0.092902, 0.062970  // stddev = 2.0\n//      float[](0.111220, 0.107798, 0.098151, 0.083953, 0.067458, 0.050920, 0.036108); // stddev = 3.0\n);\n\n@id(0) override axisX : i32 = 1;\n\nstruct SAOBlurUniforms {\n\tradius: f32\n}\n\n@group(0) @binding(0) var tAO: texture_2d<f32>;\n@group(0) @binding(1) var<uniform> u: SAOBlurUniforms;\n\n//#define  result         gl_FragColor.r\n//#define  keyPassThrough gl_FragColor.gb\n\n/* Returns a number on (0, 1) */\nfn unpackKey(p: vec2f) -> f32 {\n    return p.x + p.y * (1.0 / 255.0);\n}\n\n\n@fragment fn psmain(\n\t@builtin(position) position: vec4f,\n\t@location(0) @interpolate(linear) vUv: vec2f\n) -> @location(0) vec4f {\n\n\tvar axis = vec2i(axisX, 1 - axisX);\n\tvar output: vec4f;\n\n\tvar ssC = vec2i(floor(position.xy));\n\tvar temp = textureLoad(tAO, ssC, 0);\n\n\toutput.g = temp.g;\n\toutput.b = temp.b;\n\toutput.a = temp.a;\n\n\tvar sum = temp.r;\n\n\tif (temp.a == 0.0) {\n\t\t// Sky pixel (we encoded that flag in the A component in the SAO shader)\n\t\toutput.r = sum;\n\t\treturn output;\n\t}\n\n\tvar key = unpackKey(output.gb);\n\n\t// Base weight for depth falloff.  Increase this for more blurriness,\n\t// decrease it for better edge discrimination\n\tvar BASE = gaussian[0];\n\tvar totalWeight = BASE;\n\tsum *= totalWeight;\n\n\tvar scale = 1.5 / u.radius;\n\n\tfor (var r = -R; r <= R; r++) {\n\t\t// We already handled the zero case above.  This loop should be unrolled and the static branch optimized out,\n\t\t// so the IF statement has no runtime cost\n\t\tif (r != 0) {\n\t\t\ttemp = textureLoad(tAO, ssC + axis * r * SCALE, 0);\n\n\t\t\tvar tapKey = unpackKey(temp.gb);\n\t\t\tvar value  = temp.r;\n\n\t\t\t// spatial domain: offset gaussian tap\n\t\t\tvar weight = 0.3 + gaussian[abs(r)];\n\n\t\t\t// range domain (the "bilateral" weight). As depth difference increases, decrease weight.\n\t\t\tvar dz = tapKey - key;\n\t\t\tweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n\n\t\t\tsum += value * weight;\n\t\t\ttotalWeight += weight;\n\t\t}\n\t}\n\n\tconst epsilon = 0.0001;\n\toutput.r = sum / (totalWeight + epsilon);\n\n\treturn output;\n}\n',KE=0,XE=4,YE=5,QE=6,ZE=8,$E=9,JE=10,eS=11,tS=12;class iS extends Ax{constructor(e){super(e,tS,!0,!1)}setCamera(e,t,i){let n=e.near,r=e.far;this.setFloat(YE,n),this.setFloat(QE,r);let o=e.projectionMatrix.elements;e.isPerspective?this.setFloat4(KE,-2/(t*o[0]),2/(i*o[5]),(1-o[8])/o[0],-(1+o[9])/o[5]):this.setFloat4(KE,-2/(t*o[0]),2/(i*o[5]),(1-o[12])/o[0],-(1-o[13])/o[5]);let s=e.isPerspective?0:1;this.setInt(eS,s);let a=i*o[5]*.125;this.setFloat(XE,a)}setAOOptions(e,t,i){void 0!==e&&this.setFloat(ZE,e),void 0!==t&&this.setFloat($E,t),void 0!==i&&this.setFloat(JE,i)}getAOOptions(){return{bias:this.getFloat($E),radius:this.getFloat(ZE),intensity:this.getFloat(JE)}}}class nS extends Ax{constructor(e){super(e,16,!0,!1)}setRadius(e){this.setFloat(0,e),this.upload()}}function rS(){return{binding:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,visibility:arguments.length>1&&void 0!==arguments[1]?arguments[1]:GPUShaderStage.FRAGMENT,texture:{sampleType:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unfilterable-float"}}}function oS(){return{binding:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,visibility:arguments.length>1&&void 0!==arguments[1]?arguments[1]:GPUShaderStage.FRAGMENT,buffer:{}}}const sS={topology:"triangle-list",cullMode:"back"},aS=5;function lS(e){let t,i,n,r,o,s,a,l,c,u,h,d,f,p,m,g,v,y,b,x,_,E,S,A=e;this.init=function(){t=e.getDevice(),n=new iS(t),n.setAOOptions(8,.01,1),u=new nS(t),u.setRadius(8);const i=t.createShaderModule({code:Ex}),r=t.createShaderModule({label:"sao mip shader",code:jE}),o=t.createShaderModule({code:qE}),s=A.getRenderTargets().getPreferredFormat();"bgra8unorm"!==s&&"rgba8unorm"!==s&&console.warn("post-processing render target format",s,"may not work with SSAO"),a=t.createBindGroupLayout({label:"sao bind group layout",entries:[rS(0),rS(1),oS(2),rS(3)]}),g=t.createBindGroupLayout({label:"sao mip bind group layout",entries:[rS(0)]}),h=t.createBindGroupLayout({entries:[rS(0),oS(1)]}),l=t.createRenderPipeline({layout:t.createPipelineLayout({bindGroupLayouts:[a]}),vertex:{module:i,entryPoint:"mainFlipY"},fragment:{module:t.createShaderModule({code:Im(HE,{pack_depth:t_,USE_MIPMAP:WE})}),entryPoint:"psmain",targets:[{format:s}]},primitive:sS}),y=t.createRenderPipeline({label:"sao mip pipeline",layout:t.createPipelineLayout({bindGroupLayouts:[g]}),vertex:{module:i,entryPoint:"mainFlipY"},fragment:{module:r,entryPoint:"psmain",targets:[{format:"rgb10a2unorm"}]},primitive:sS}),p=t.createRenderPipeline({layout:t.createPipelineLayout({bindGroupLayouts:[h]}),vertex:{module:i,entryPoint:"mainFlipY"},fragment:{module:o,entryPoint:"psmain",targets:[{format:s}],constants:{0:1}},primitive:sS}),m=t.createRenderPipeline({layout:t.createPipelineLayout({bindGroupLayouts:[h]}),vertex:{module:i,entryPoint:"mainFlipY"},fragment:{module:o,entryPoint:"psmain",targets:[{format:s}],constants:{0:0}},primitive:sS}),c={colorAttachments:[{view:void 0,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]}},this.cleanup=function(){var e;null===(e=i)||void 0===e||e.destroy()},this.setAOOptions=function(e,t,i){n.setAOOptions(e,t,i),u.setRadius(e)},this.getAOOptions=function(){return n.getAOOptions()},this.setUnitScale=function(e){},this.resize=function(e,l){r=e,o=l;const c=A.getRenderTargets();i&&i.destroy(),b&&b.destroy(),i=t.createTexture({size:[e,l],format:c.getPreferredFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),E=i.createView(),S=c.getPostTarget(0).createView();const p=c.getViewDepthTarget().createView();x=null,_=[],v=[];const m=Math.min(aS,Math.min(Math.floor(Math.log2(e)),Math.floor(Math.log2(l)))),y=0|e/2,w=0|l/2;y>=1&&w>=1&&(b=t.createTexture({label:"saoMipTarget",size:[y,w],format:"rgb10a2unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,mipLevelCount:m}),x=b.createView({baseMipLevel:0,mipLevelCount:m}));for(let e=0;e<m;e++){const i=b.createView({baseMipLevel:e,mipLevelCount:1});_.push(i),v.push(t.createBindGroup({label:"saoMipBindGroup "+e,layout:g,entries:[{binding:0,resource:0===e?p:_[e-1]}]}))}s=t.createBindGroup({label:"sao bind group",layout:a,entries:[{binding:0,resource:c.getNormalsTarget().createView()},{binding:1,resource:p},{binding:2,resource:{buffer:n.getBuffer()}},{binding:3,resource:x}]}),d=t.createBindGroup({layout:h,entries:[{binding:0,resource:E},{binding:1,resource:{buffer:u.getBuffer()}}]}),f=t.createBindGroup({layout:h,entries:[{binding:0,resource:S},{binding:1,resource:{buffer:u.getBuffer()}}]})},this.getTargetView=function(){return i.createView()},this.run=function(e){if(!t)return;n.setCamera(e,r,o),n.upload();const i=t.createCommandEncoder();let a;if(b&&_.length)for(let e=0;e<_.length;e++)c.colorAttachments[0].view=_[e],a=i.beginRenderPass(c),a.setPipeline(y),a.setBindGroup(0,v[e]),a.draw(3),a.end();c.colorAttachments[0].view=E,a=i.beginRenderPass(c),a.setPipeline(l),a.setBindGroup(0,s),a.draw(3),a.end(),c.colorAttachments[0].view=S,a=i.beginRenderPass(c),a.setPipeline(p),a.setBindGroup(0,d),a.draw(3),a.end(),c.colorAttachments[0].view=E,a=i.beginRenderPass(c),a.setPipeline(m),a.setBindGroup(0,f),a.draw(3),a.end(),t.queue.submit([i.finish()])}}var cS={GROUND_UNFINISHED:0,GROUND_FINISHED:1,GROUND_RENDERED:2};const uS="// Contains either the H/V texture or the main/color target, depending on the pipeline\n@group($bindGroup) @binding(0) var map: texture_2d<f32>;\n@group($bindGroup) @binding(1) var smpl: sampler;\n";function hS(e){return Im(uS,{bindGroup:e})}function dS(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"ground shadow texture bind group";return e.createBindGroup({label:r,layout:t,entries:[{binding:0,resource:n},{binding:1,resource:i}]})}function fS(e,t){return Im("$pack_depth\n$groundShadowTexture\n\nconst PI: f32 = 3.14159265358979;\n@id(0) override KERNEL_SCALE: f32;\n@id(1) override KERNEL_RADIUS: f32;\noverride SIGMA: f32 = (2.0 * KERNEL_RADIUS + 1.0) / 6.0;\noverride SIGMASQ2: f32 = 2.0 * SIGMA * SIGMA;\noverride QUOTIENT: f32 = sqrt(PI * SIGMASQ2);\n\n#if $horizontal\n    fn getUv(vUv: vec2f, x: f32) -> vec2f {\n\t\treturn vec2f(vUv.x + KERNEL_SCALE * x, vUv.y);\n\t}\n#else\n    fn getUv(vUv: vec2f, y: f32) -> vec2f {\n        return vec2f(vUv.x, vUv.y + KERNEL_SCALE * y);\n    }\n#endif\n\nfn kernelVal(x: f32) -> f32 {\n    return (1.0 / QUOTIENT) * exp(-x * x / SIGMASQ2);\n}\n\n@fragment\nfn psmain(\n    @builtin(position) coord: vec4f,\n    @location(0) @interpolate(linear) vUv: vec2f\n) -> @location(0) vec4f {\n    var depthVal: f32 = 0.0;\n    var sum: f32 = 0.0;\n    var kVal: f32;\n\n    for (var x = -KERNEL_RADIUS; x <= KERNEL_RADIUS; x += 1.0) {\n        kVal = kernelVal(x);\n        depthVal += unpackDepth(textureSample(map, smpl, getUv(vUv, x))) * kVal;\n        sum += kVal;\n    }\n\n    return packDepth(depthVal / sum);\n}\n",{pack_depth:t_,groundShadowTexture:hS(t),horizontal:e})}class pS{#e;#Dt;#Ln=[];#gs=[];#ki=new Map;#vn;#_n;#vs={};constructor(e,t,i,n){this.#e=e,this.#Dt=e.getDevice(),this.#Ln=[t,i],this.#gs.push({format:n})}getPipeline(e){const t=P_(e,this.#vs,0,!1,!1,!1);let i=this.#ki.get(t);if(i)return i;const n=this.#Dt.createShaderModule({label:"ground shadow shader",code:Im("// We don't need IBL here, but this is where cut planes are currently implemented\n$frameBindGroup\n$objectUniforms\n$pack_depth\n\nstruct VertexOutput {\n    @builtin(position) position: vec4f,\n    @location(0) vWorldPosition: vec3f,\n    //@location(1) @interpolate(flat) doNotCut: u32\n}\n\n@vertex fn vsmain(\n    @location(0) position: vec3f,\n    @builtin(instance_index) instance: u32\n) -> VertexOutput {\n\n    var objectUniforms = getObjectUniforms(instance);\n\n    var output: VertexOutput;\n\n    var pos4 = vec4f(position.x, position.y, position.z, 1.0);\n    var mvMatrix = uniforms.viewMatrix * objectUniforms.modelMatrix;\n    var mvPosition = mvMatrix * pos4;\n\n    output.position = uniforms.projectionMatrix * mvPosition;\n    output.vWorldPosition = (objectUniforms.modelMatrix * pos4).xyz;\n\n    return output;\n}\n\n@fragment fn psmain(\n    in: VertexOutput\n) -> @location(0) vec4f {\n    // if (in.doNotCut == 0) {\n        checkCutPlanes(in.vWorldPosition);\n    // }\n\n    var depth = 1.0 - in.position.z / in.position.w;\n\n    return packDepth(depth);\n}\n",{frameBindGroup:M_.getDeclaration(0),objectUniforms:Dm(1),pack_depth:t_})}),r={label:"ground shadow pipeline",layout:this.#Dt.createPipelineLayout({bindGroupLayouts:this.#Ln}),vertex:{module:n,entryPoint:"vsmain",buffers:L_(e,!1,!1,!1,!1)},fragment:{module:n,entryPoint:"psmain",targets:this.#gs},primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:Zx,depthBias:e.isLines?0:1,depthBiasSlopeScale:e.isLines?0:1}};return e.isLines?r.primitive.topology="line-list":r.primitive.topology="triangle-list",i=this.#Dt.createRenderPipeline(r),this.#ki.set(t,i),i}reset(){this.#vn=null,this.#_n=this.#e.getVB()}drawOne(e,t,i){const n=this.getPipeline(i);n!==this.#vn&&(e.setPipeline(n),this.#vn=n),this.#_n.draw(e,i,t)}}class mS{#e;#Dt;#ys;#Ln=[];#gs=[];constructor(e,t,i,n,r){this.#e=e,this.#Dt=e.getDevice(),this.#Ln=[t,i],this.#gs.push({format:n,blend:Jx});const o=this.#Dt.createShaderModule({label:"ground shadow color shader",code:Im("$frameBindGroup\n$groundShadowTexture\n$pack_depth\n\nstruct VertexOutput {\n    @builtin(position) position: vec4f,\n    @location(0) vUv: vec2f\n}\n\n@vertex fn vsmain(\n    @location(0) position: vec3f,\n    @location(1) uv: vec2f,\n    @builtin(instance_index) instance: u32\n) -> VertexOutput {\n\n    var output: VertexOutput;\n\n    var pos4 = vec4f(position.x, position.y, position.z, 1.0);\n    var mvPosition = uniforms.viewMatrix * pos4;\n\n    output.position = uniforms.projectionMatrix * mvPosition;\n    output.vUv = uv;\n\n    return output;\n}\n\n@fragment fn psmain(\n    in: VertexOutput\n) -> @location(0) vec4f {\n    var depthVal = unpackDepth(textureSample(map, smpl, in.vUv));\n    var shadowColor = vec4f(0, 0, 0, 1);\n\n    return vec4f(shadowColor.rgb, shadowColor.a * depthVal);\n}\n",{frameBindGroup:M_.getDeclaration(0),groundShadowTexture:hS(1),pack_depth:t_})});this.#ys=this.#Dt.createRenderPipeline({label:"ground shadow color pipeline",layout:this.#Dt.createPipelineLayout({bindGroupLayouts:this.#Ln}),vertex:{module:o,entryPoint:"vsmain",buffers:[{arrayStride:4*r,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x2"}]}]},fragment:{module:o,entryPoint:"psmain",targets:this.#gs},primitive:{cullMode:"back",topology:"triangle-list"},depthStencil:{depthWriteEnabled:!1,depthCompare:"less",format:Zx,depthBias:0,depthBiasSlopeScale:0}})}getPipeline(){return this.#ys}}class gS{#e;#Dt;#ys;#bs;#xs;#_s;#Es={texture:0};#Ln=[];#gs=[];constructor(e,t,i,n,r,o){this.#e=e,this.#Dt=e.getDevice(),this.#bs=n,this.#xs=r,this.#_s=o;for(let e in this.#Es)if("texture"===e)this.#Ln[this.#Es[e]]=t;this.#gs.push({format:i});const s=this.#Dt.createShaderModule({label:"ground shadow blur vertex shader",code:Ex}),a=this.#Dt.createShaderModule({label:"ground shadow blur fragment shader",code:fS(this.#bs,this.#Es.texture)});this.#ys=this.#Dt.createRenderPipeline({label:"ground shadow blur pipeline",layout:this.#Dt.createPipelineLayout({bindGroupLayouts:this.#Ln}),vertex:{module:s,entryPoint:"mainFlipY"},fragment:{module:a,entryPoint:"psmain",targets:this.#gs,constants:{0:this.#xs,1:this.#_s}},primitive:{cullMode:"back",topology:"triangle-list"}})}getPipeline(){return this.#ys}getBindGroupOrder(){return this.#Es}}class vS{#e;#Dt;#Ss=64;#As=1;#ws=7;#Cs;#Ts;#bi;#Ms;#Is;#Ps;#Ls;#mn;#Vo;#zo;#Rs;#Ds;#Os;#Bs;#Ns;#Po;#Us;#ks;#Fs;#Vs;#Gs;#zs;#Hs;#Ws=new Float32Array(20);#js;#qs=new Uint16Array(6);#Ks=new rl;#Xs=new THREE.Quaternion;#Ys=new THREE.Euler;#Qs=new rl(1,1,1);#Zs=new THREE.OrthographicCamera;#$s=new ac;#Js=!0;#ea=cS.GROUND_FINISHED;#ta=!1;#ia=new rl(0,0,0);#na=new rl(0,0,0);#ra=new rl(0,0,0);#oa=new rl(0,0,0);#Ye=new THREE.Box3;#sa=[];#aa;#la=0;#ca=0;#ua=0;constructor(e){this.#e=e,this.enabled=!1}init(e){this.#Dt=this.#e.getDevice(),this.#mn=new C_(this.#Dt),this.#Vo=e,this.#zo=new M_(this.#Dt,this.#mn,this.#e.getIBL()),this.#Fs=this.#Dt.createBindGroupLayout({label:"ground shadow texture bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]}),this.#vi(),this.#Rs=new pS(this.#e,this.#zo.getLayout(),this.#Vo.getLayout(!1),this.#Cs.format),this.#Ds=new mS(this.#e,this.#zo.getLayout(),this.#Fs,navigator.gpu.getPreferredCanvasFormat(),5),this.#Bs=new gS(this.#e,this.#Fs,this.#Ts.format,!1,(this.#As/this.#Ss).toFixed(4),this.#ws.toFixed(2)),this.#Os=new gS(this.#e,this.#Fs,this.#Cs.format,!0,(this.#As/this.#Ss).toFixed(4),this.#ws.toFixed(2)),this.#ha(),this.setTransform(new rl(0,0,0),new rl(1,1,1),new rl(0,1,0),new rl(0,1,0))}#vi(){this.#Cs=this.#Dt.createTexture({label:"ground shadow h texture",size:{width:this.#Ss,height:this.#Ss},format:navigator.gpu.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.#Ms=this.#Cs.createView({label:"ground shadow h texture view"}),this.#Ts=this.#Dt.createTexture({label:"ground shadow v texture",size:[this.#Ss,this.#Ss],format:navigator.gpu.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.#Is=this.#Ts.createView({label:"ground shadow v texture view"}),this.#bi=this.#Dt.createTexture({label:"ground shadow depth texture",size:[this.#Ss,this.#Ss],format:Zx,usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.#Ps=this.#bi.createView(),this.#Ls=this.#Dt.createSampler({label:"ground shadow texture sampler",magFilter:"linear",minFilter:"linear"}),this.#Po={label:"ground shadow clear pass descriptor",colorAttachments:[{view:this.#Ms,clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"},{view:this.#Is,clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.#Ps,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},this.#Ns={label:"ground shadow pass descriptor",colorAttachments:[{view:this.#Ms,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:this.#Ps,depthLoadOp:"load",depthStoreOp:"store"}},this.#ks={label:"ground shadow color pass descriptor",colorAttachments:[{loadOp:"load",storeOp:"store"}],depthStencilAttachment:{depthLoadOp:"load",depthStoreOp:"store"}},this.#Us={label:"ground shadow blur pass descriptor",colorAttachments:[{loadOp:"load",storeOp:"store"}]},this.#zs=dS(this.#Dt,this.#Fs,this.#Ls,this.#Ms,"ground shadow color texture bind group"),this.#Vs=dS(this.#Dt,this.#Fs,this.#Ls,this.#Is,"ground shadow blur h texture bind group"),this.#Gs=dS(this.#Dt,this.#Fs,this.#Ls,this.#Ms,"ground shadow blur v texture bind group"),this.#Hs=this.#Dt.createBuffer({label:"ground shadow plane buffer",size:this.#Ws.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),this.#js=this.#Dt.createBuffer({label:"ground shadow plane index buffer",size:this.#qs.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST})}#ha(){this.#Ws.set([-.5,.5,0,0,0,.5,.5,0,1,0,-.5,-.5,0,0,1,.5,-.5,0,1,1]),this.#qs.set([1,3,2,1,2,0])}#da(e,t,i,n){const r=new al(!1),o=new rl,s=new rl;o.subVectors(e,i),r.lookAt(o,e,n),s.copy(i).multiplyScalar(-.5*t.y).add(e),this.#Ks.copy(s),this.#Ys.setFromRotationMatrix(r),this.#Xs.setFromEuler(this.#Ys,!1),this.#Qs.set(t.z,t.x,t.y),r.compose(this.#Ks,this.#Xs,this.#Qs);for(let e=0;e<4;++e)o.set(this.#Ws[5*e],this.#Ws[5*e+1],this.#Ws[5*e+2]),o.applyMatrix4(r),this.#Ws[5*e]=o.x,this.#Ws[5*e+1]=o.y,this.#Ws[5*e+2]=o.z}setTransform(e,t,i,n){e.equals(this.#ia)&&t.equals(this.#na)&&i.equals(this.#ra)&&n.equals(this.#oa)||(this.setDirty(),this.#ia.copy(e),this.#na.copy(t),this.#ra.copy(i),this.#oa.copy(n),this.#Zs.left=-t.z/2,this.#Zs.right=t.z/2,this.#Zs.top=t.x/2,this.#Zs.bottom=-t.x/2,this.#Zs.near=1,this.#Zs.far=t.y+this.#Zs.near,this.#Zs.updateProjectionMatrix(),this.#ha(),this.#da(e,t,i,n),this.#Zs.position.addVectors(e,i.clone().multiplyScalar(-t.y/2-this.#Zs.near)),n&&this.#Zs.up.set(n.x,n.y,n.z),this.#Zs.lookAt(e),this.#Zs.orthoScale=t.x,this.#Zs.clientHeight=this.#Ss,this.#$s.reset(this.#Zs),this.#$s.areaCullThreshold=2)}#fa(){this.#mn.update(this.#Zs),this.#zo.updateBindGroup()}#ss(e){this.#e.getVB().flushWrites();const t=e.finish();this.#Dt.queue.submit([t])}#pa(e,t){if(e.length!==t.length)return!0;for(let i=0;i<e.length;i++)if(e[i]!=t[i])return!0;return!1}#ma(e){const t=e.frags;if(e.edgesOnly||e.is2d()||!t)return;e.forEachNoMesh((t=>{e.frags.getWorldBounds(t,this.#Ye);const i=e.frags.vizflags[t]&ll.MESH_VISIBLE,n=this.#$s.estimateProjectedDiameter(this.#Ye)<this.#$s.areaCullThreshold;e.frags.setFlagFragment(t,ll.MESH_RENDERFLAG,i&&!n)})),e.forceVisible=!1;const i=this.#Dt.createCommandEncoder({label:"ground shadow encoder"}),n=i.beginRenderPass(this.#Ns),r=t.modelId,o=Ji&&!e.isComplete;o||(this.#Vo.resetUpdateHeuristic(r),e.uniformsNeedUpdate&&(this.#Vo.updateBatch(e),e.uniformsNeedUpdate=!1)),n.setBindGroup(0,this.#zo.getBindGroup());const s=this.#Vo.getBindGroup(e);let a;n.setBindGroup(1,s),this.#Rs.reset();let l=0;e.forEachWGPU(0,this.#Vo.MAX_BATCH,((e,i,r,s)=>{if(!(e=this.#e.initGeometry(e)))return!0;if(o){a=l;this.#Vo.getDynamicUniforms().setOneFragmentCPU(t,s,a)}else a=this.#Vo.getRenderIndex(r);this.#Rs.drawOne(n,a,e),l++})),n.end(),o&&this.#Vo.writeToQueue(l),this.#ss(i)}prepareGroundShadow(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!this.enabled||e.isEmpty())return this.#ea=cS.GROUND_FINISHED,i;const r=e.getGeomScenesPerModel();if(this.#Js=this.#pa(this.#sa,r)||this.#Js,this.#Js)this.clear(),this.#Js=!1,this.#fa(),this.#sa=r,this.#aa=e.getGeomScenes(),this.#la=this.#aa.length,this.#ca=0,this.#ua=t?Math.max(Math.ceil(this.#la/100),t):this.#la;else{if(this.#ea===cS.GROUND_RENDERED||this.#ea===cS.GROUND_FINISHED)return this.#ea=cS.GROUND_FINISHED,i;0===t&&(this.#ua=this.#la)}let o,s,a;i&&(o=performance.now(),s=n*i);let l=0;for(;l<this.#ua&&this.#ca<this.#la;){const e=this.#aa[this.#ca++];if(!e)continue;if(!(e.getBoundingBox&&this.#$s.estimateProjectedDiameter(e.getBoundingBox())<this.#$s.areaCullThreshold)&&(l++,e.forceVisible=!0,this.#ma(e),e.forceVisible=!1,i)){const e=performance.now()-o;if(s<e){this.#ea=cS.GROUND_UNFINISHED,a=i-e;break}}}return this.#ca<this.#la&&(this.#ea=cS.GROUND_UNFINISHED,a=i?i-performance.now()+o:1),void 0!==a?a:(this.#ga(),this.#ea=cS.GROUND_RENDERED,i?i-performance.now()+o:1)}#va(e,t){const i=this.#Dt.createCommandEncoder({label:"ground shadow blur encoder"}),n=i.beginRenderPass(this.#Us),r=e.getBindGroupOrder();n.setBindGroup(r.texture,t),n.setPipeline(e.getPipeline()),n.draw(3),n.end(),this.#Dt.queue.submit([i.finish()])}#ga(){this.#Us.colorAttachments[0].view=this.#Is,this.#va(this.#Bs,this.#Gs),this.#Us.colorAttachments[0].view=this.#Ms,this.#va(this.#Os,this.#Vs),this.#ta=!0}renderShadow(e){if(!this.#ta)return;this.#mn.update(e),this.#Dt.queue.writeBuffer(this.#Hs,0,this.#Ws),this.#Dt.queue.writeBuffer(this.#js,0,this.#qs);const t=this.#Dt.createCommandEncoder({label:"ground shadow color encoder"});this.#ks.colorAttachments[0].view=this.#e.getRenderTargets().getColorTargetView(),this.#ks.depthStencilAttachment.view=this.#e.getRenderTargets().getDepthTarget().createView();const i=t.beginRenderPass(this.#ks);this.#e.passViewport(i),i.setBindGroup(0,this.#zo.getBindGroup()),i.setBindGroup(1,this.#zs),i.setVertexBuffer(0,this.#Hs),i.setIndexBuffer(this.#js,"uint16"),i.setPipeline(this.#Ds.getPipeline()),i.drawIndexed(this.#qs.length,1,0,0,0),i.end(),this.#Dt.queue.submit([t.finish()])}clear(){if(!this.enabled)return;const e=this.#Dt.createCommandEncoder({label:"ground shadow clear encoder"});e.beginRenderPass(this.#Po).end(),this.#Dt.queue.submit([e.finish()]),this.#ta=!1}setDirty(){this.#Js=!0,this.#ea=cS.GROUND_UNFINISHED}getStatus(){return this.#ea}}const yS={WEBGPU_DEVICE_LOST:"webgpudevicelost",WEBGPU_INIT_FAILED:"webgpuinitfailed",WEBGPU_RENDER_DONE:"webgpurenderdone"},bS=3;function xS(e,t){let i,n,r,o,s,a,l,c,u,h,d=e,f=[],p=new Set,m=new Map,g=new Map,v=new e_(this),y=null,b=new NE(this),x=new Qx(this),_=new kE(this),E=new zE(this),S=new lS(this),A=new vS(this);n=t.canvas||document.createElement("canvas"),i=n.getContext("webgpu"),o=t.pixelRatio;let w=null,C=null,T=null,M=null,I=[];function P(e,t){this.visibilityDirty||(this.visibilityDirty=!0,t.invalidateRenderBundles(e))}this.context=i,Autodesk.Viewing.EventDispatcher.prototype.apply(this),A_=e=>{const t=e.target;(t.__gpuUniformsMask&b_.TEXTURE_MASK)!==E_(t)&&this.invalidateRenderBundles()},this.initSync=function(e,t){l=new TE(this),a=navigator.gpu.getPreferredCanvasFormat(),i.configure({device:d,format:a,alphaMode:"premultiplied"}),r=!0,c=d.createSampler({addressModeU:"repeat",addressModeV:"repeat"}),function(){let e=d.createTexture({label:"missing",dimension:"2d",format:"bgra8unorm",size:[4,4],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),t=e.createView();u={texture:e,view:t,sampler:c};const i=new Uint32Array(16),n=4294967295,r=4294901760;i[0]=r,i[1]=n,i[2]=n,i[3]=r,i[4]=r,i[5]=n,i[6]=r,i[7]=r,i[8]=r,i[9]=r,i[10]=n,i[11]=r,i[12]=n,i[13]=n,i[14]=r,i[15]=n,d.queue.writeTexture({texture:e},i,{offset:0,bytesPerRow:16},[4,4])}(),h=function(e){const t=d.createTexture({label:`color 0x${e.toString(16)}`,dimension:"2d",format:"bgra8unorm",size:[1,1],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),i=t.createView(),n={texture:t,view:i,sampler:c},r=new Uint32Array([e]);return d.queue.writeTexture({texture:t},r,{offset:0,bytesPerRow:4},[1,1]),n}(0),s=new yx(this),v.init(),b.init(l),S.init(),x.init(),A.init(l),this.setSize(e,t),_.init(),E.init(),d.lost.then((e=>{console.error(`WebGPU device was lost: ${e.message}`),d=null,this.fireEvent({type:yS.WEBGPU_DEVICE_LOST})}))},this.clear3dModelVisibilityDirty=function(e){g.get(e).visibilityDirty=!1},this.add3dModel=function(e){if(!e.is3d())return void console.warn("Called add3dModel with 2D model.");p.add(e),l.addModel(e);const t={visibilityDirty:!1},i=P.bind(t,e,this);t.callback=i,e.getFragmentList()&&e.getFragmentList().registerVisibilityDirtyCallback(i),g.set(e.id,t)},this.remove3dModel=function(e){if(!e.is3d())return void console.warn("Called remove3dModel with 2D model.");p.delete(e),l.removeModel(e);const t=g.get(e.id).callback;if(e.getFragmentList()&&e.getFragmentList().removeVisibilityDirtyCallback(t),g.delete(e.id),this.invalidateRenderBundles(e),Object.hasOwn(e.getIterator(),"getGeomScenes")){const t=e.getIterator().getGeomScenes();for(const e of t)e&&(e.isComplete=!1,e.useRenderBundles=!1)}},this.has3dModel=function(e){return p.has(e)},this.getRenderBatchUniforms=function(){return l},this.getPixelRatio=function(){var e;return o||(null===(e=window)||void 0===e?void 0:e.devicePixelRatio)||1},this.setPixelRatio=function(e){o=e},this.setSize=function(e,t,i){n.width=e*this.getPixelRatio(),n.height=t*this.getPixelRatio(),!1!==i&&(n.style.width=e+"px",n.style.height=t+"px"),v.resize(n.width,n.height),b.resize(n.width,n.height),S.resize(n.width,n.height),x.resize(n.width,n.height),this.setViewport(0,0,e,t)},this.renderBackground=function(e){e&&E.hasCubeMap()?E.run():_.run()},this.present=function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!r)return void this.fireEvent({type:yS.WEBGPU_RENDER_DONE});let s=y||i.getCurrentTexture();if(o){const i=v.getPostTarget(1);x.run(i.createView(),e,t),o.run(s,i)}else x.run(s.createView(),e,t);n&&d.queue.onSubmittedWorkDone().then((()=>{this.fireEvent({type:yS.WEBGPU_RENDER_DONE})}))},this.beginScene=function(e,t){r&&(m.clear(),b.beginScene(e,t))},this.renderScenePart=function(e,t){if(!r)return;const i=b.renderScenePart(e,t);i&&(f.push(i),f.length>=bS&&(s.flushWrites(),d.queue.submit(f),f.length=0))},this.renderOverlay=function(e,t,i,n,o,s,a){r&&b.renderOverlay(e,t,i,n,o,s,a)},this.flushCommandQueue=function(){f.length&&(s.flushWrites(),d.queue.submit(f),f.length=0)},this.clearPerFrameBudgets=function(){s.cleanup()},this.getDevice=function(){return d},this.getRenderTargets=function(){return v},this.getVB=function(){return s},this.getGradientPass=function(){return _},this.getEnvMapPass=function(){return E},this.getIBL=function(){return b.getIBL()},this.getSAO=function(){return S},this.getMainPass=function(){return b},this.getGroundShadowPass=function(){return A},this.getPostPass=function(){return x},this.getBlendSettings=function(){return x.getBlendSettings()},this.setRenderTarget=function(e){},this.getOffscreenTarget=function(){return y},this.setOffscreenTarget=function(e){y=e},this.clearTarget=function(e){},this.clearMainTargets=function(){r&&b.clearMainTargets()},this.clearOverlayTargets=function(){r&&b.clearOverlayTargets()},this.clear=function(){},this.depthFunc=function(){},this.updateTimestamp=function(e){},this.getMaxAnisotropy=function(){return 16},this.supportsMRT=function(){return!0},this.verifyMRTWorks=function(){return!0},this.cleanup=function(){},this.getPlaceholderTexture=function(){return h},this.stats=function(){s.stats()},this.setLineStyleBuffer=function(e,t){b.setLineStyleBuffer(e,t)},this.invalidateRenderBundles=function(e){let t;t=e?[e]:p,t.forEach((e=>{if(!m.has(e.id)){if(e.getIterator().getGeomScenes){const t=e.getIterator().getGeomScenes();for(const e of t)e&&b.clearRenderBundles(e)}m.set(e.id)}}))},this.getContext=function(){return this.context},this.canUpload=function(e){return s.canUpload(e)},this.uploadGeometry=function(e){s.initUploaded(e)},this.uploadUniforms=function(e){l.updateBatch(e)},this.freeUniforms=function(e){l.freeUniforms(e)},this.getTotalMemory=function(){return s.getTotalMemory()},this.initGeometry=function(e){if(e instanceof THREE.Geometry){if(!(e=dE(e)))return null;e.streamingDraw=!0}return e.vb||(Oc.interleaveGeometry(e,!0),e.streamingDraw=!0),s.canDraw(e)?e:null},this.setViewport=function(e,t,i,r){const o=this.getPixelRatio();w=Math.trunc(e*o),C=n.height-Math.trunc((t+r)*o),T=Math.trunc(i*o),M=Math.trunc(r*o)},this.passViewport=function(e){e.setViewport(w,C,T,M,0,1)},this.pushViewport=function(){I.push(w),I.push(C),I.push(T),I.push(M)},this.popViewport=function(){if(0==I.length)return void console.warn("Called popViewport on empty stack");const e=I.length-4;w=I[e],C=I[e+1],T=I[e+2],M=I[e+3],I.length=e}}function _S(){var e,t,i,n,r,o={},s=0,a=0,l=0,u=0,h=1,d=!1,f=!1,p={},m={},v=[0,0],y=1,b=1,x=!1,_=0,E=0,A=0,w=!1,C=0,T=[.42,0,1,1],M=!0,I={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,customPresentPass:!1,envMapBg:!1,numIdTargets:$x,renderEdges:!1,copyDepth:!1},P={},L=!1,R=null;function D(e,t){if(e&&t){t.length=0;for(let i=0;i<e.length;i++)t[i]=e[i]}}function O(t,i,n){i=i||0;const r=function(t){return t!==E&&(E=t,-1===t&&(t=0),e.getBlendSettings().setHighlightObjectId(t),!0)}(t),o=function(t){return t!==A&&(A=t,e.getBlendSettings().setHighlightModelId(t),!0)}(i);if(r||o)return w=!0,e.getBlendSettings().setHighlightIntensity(0),_=performance.now(),!0}function B(t){e.getBlendSettings().setGlowFlag(t),C=t}this.settings=I,this.isWeakDevice=function(){return x},this.init=function(t,i,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.initSync(i,o),x=F(),n=i,r=o,e=t,f=!!s.offscreen},this.setDepthMaterialOffset=function(e,t,i){},this.setUserFinalPass=function(e){R=e},this.overlayUpdate=function(){if(w)return w=!1,!0;if(0===C&&(0===E||-1===E))return!1;var t=e.getBlendSettings().getHighlightIntensity(),i=1;if(M){var n=.004*(performance.now()-_);n=Math.min(n,1),i=function(e,t){var i=3*e[1],n=3*(e[3]-e[1])-i;return(((1-i-n)*t+n)*t+i)*t}(T,n)}return t!==i&&(e.getBlendSettings().setHighlightIntensity(i),!0)},this.setRollOverFadeEnabled=function(e){M=e},this.beginScene=function(r,s,a,l){if(t=s,i=a,o={},!L&&n)this.initPostPipeline(I.sao,I.antialias),L=!0;else if(!n)return void(d||S()||(rt.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance.",at(st.VIEWER_INTERNAL_ERROR)),d=!0));l&&(e.getEnvMapPass().setCamera(t),e.renderBackground(I.envMapBg),e.clearMainTargets()),I.sao||e.getBlendSettings().setAOEnabled(!1),e.beginScene(t,i),e.renderScenePart(r,I.renderEdges)},this.renderScenePart=function(t,i,n,r){o={},e.renderScenePart(t,I.renderEdges)},this.clearAllOverlays=function(){e.clearOverlayTargets()},this.renderOverlays=function(i,n,r){let o=!1;r||e.clearOverlayTargets();for(let r in i){let s=i[r],a=s.scene,l=s.camera?s.camera:t;a.children.length&&(o||(o=!0),e.renderOverlay(a,l,s.materialPre,s.materialPost,I.renderEdges,s.edgeColor,n))}e.getBlendSettings().setUseOverlay(o)},this.computeSSAO=function(i){!i&&I.sao?(e.getSAO().run(t),e.getBlendSettings().setAOEnabled(!0)):e.getBlendSettings().setAOEnabled(!1)},this.getFinalTarget=function(){return null},this.presentBuffer=function(i,n){e.present(I.antialias,t,n,i||R)},this.composeFinalFrame=function(t,i,n){e&&(this.computeSSAO(t),i||this.presentBuffer(void 0,n))},this.cleanup=function(){e&&e.cleanup(),o={},p={},m={}},this.setSize=function(t,i,o,s){if(n=t,r=i,I.logicalWidth=t,I.logicalHeight=i,0===t&&0===i||!e)this.cleanup();else{var a=0|t*e.getPixelRatio(),l=0|i*e.getPixelRatio();I.deviceWidth=a,I.deviceHeight=l,s||(f?e.setViewport(0,0,t,i):e.setSize(t,i))}},this.getMaxAnisotropy=function(){return e?e.getMaxAnisotropy():0},this.mrtFlags=function(){return{mrtNormals:!0,mrtIdBuffer:!0}},this.getAntialiasing=function(){return I.antialias},this.initPostPipeline=function(e,t){I.sao=e,I.antialias=t,this.setSize(n,r)},this.setClearColors=function(t,i){i||(i=t),e.getGradientPass().setClearColors(t.x,t.y,t.z,i.x,i.y,i.z)},this.useOverlayAlpha=function(e){b=e},this.setClearAlpha=function(t){y=t,e.getGradientPass().setAlpha(t),e.getEnvMapPass().setAlpha(t)},this.getClearAlpha=function(){return y},this.setAOEnabled=function(t){I.sao=t,P.sao=I.sao,e.getBlendSettings().setAOEnabled(t),this.setSize(n,r,!1,!0)},this.setAOOptions=function(t,i,n){let r;void 0!==t&&(r=.01),e.getSAO().setAOOptions(t,r,i),void 0!==n&&e.getBlendSettings().setAOBias(n)},this.getAOEnabled=function(){return I.sao},this.getAORadius=function(){return e.getSAO().getAOOptions().radius},this.getAOIntensity=function(){return e.getSAO().getAOOptions().intensity},this.getAOBias=function(){return e.getSAO().getAOOptions().bias},this.getAOBlendBias=function(){return e.getBlendSettings().getAOBias()},this.setCubeMap=function(t){e.getEnvMapPass().setCubeMap(t),t||this.toggleEnvMapBackground(!1)},this.setEnvRotation=function(t){l=t,e.getEnvMapPass().setEnvRotation(t)},this.getEnvRotation=function(){return l},this.setEnvExposure=function(t){e.getEnvMapPass().setEnvExposure(t),s=t},this.setTonemapExposureBias=function(t){a=t,e.getEnvMapPass().setExposureBias(t)},this.getExposureBias=function(){return a},this.setCamera=function(e){t=e},this.setTonemapMethod=function(t){u=t,e.gammaInput=0!==t,e.getEnvMapPass().setTonemapMethod(t)},this.getToneMapMethod=function(){return u},this.toggleTwoSided=function(e){I.haveTwoSided=e},this.toggleEdges=function(e){I.renderEdges=e,P.renderEdges=e},this.toggleEnvMapBackground=function(e){I.envMapBg=e},this.idAtPixel=function(e,t,i){return this.idAtPixels(e,t,1,i)},this.idAtPixels=function(t,i,n,r){n%2==0&&(n+=1);let s=e.getRenderTargets(),a=s.getTargetSize();const l=.5*(t+1)*a[0]-.5*(n-1)|0,c=.5*(1-i)*a[1]-.5*(n-1)|0;if(o[n]&&l===o[n][4]&&c===o[n][5])return D(o[n],r),o[n][0];const u=4*n*n;p[u]||(p[u]=new Uint8Array(u));const h=p[u];let d;return m[u]||(m[u]=new Uint8Array(u)),d=m[u],s.readIdTargetPixelsSyncOrFail(l,c,n,n,[h,d]),function(t,i,n,r,s,a){let l,c=0,u=0,h=0,d=-1,f=e.getRenderTargets().getTargetSize();o[n]=[-1,-1,null,null,t,i];for(let e=0;e<n*n;e++){const e=c+(n-1)/2,a=u+(n-1)/2;if(e>=0&&e<=n&&a>=0&&a<=n){const c=4*(e+a*n);if(l=r[c+3]<<24|r[c+2]<<16|r[c+1]<<8|r[c],o[n][0]=l,s){let e=s[c+1]<<8|s[c];o[n][1]=e<<16>>16}if(o[n][2]=2*(t+e)/f[0]-1,o[n][3]=-(2*(i+a)/f[1]-1),-1!==l)break}if(c==u||c<0&&c==-u||c>0&&c==1-u){const e=h;h=-d,d=e}c+=h,u+=d}return D(o[n],a),l}(l,c,n,h,d,r)},this.rolloverObjectViewport=function(e,t){return this.idAtPixel(e,t,v),this.rolloverObjectId(v[0],null,v[1])},this.getRollOverDbId=function(){return E},this.getRollOverModelId=function(){return A},this.rolloverObjectId=function(e,t,i){return B(0),O(e,i)},this.rollOverModelId=function(e){return B(0),O(1,e)},this.setRollOverHighlightColor=function(t){e.getBlendSettings().setRolloverHighlightColor(t)},this.setDbIdForEdgeDetection=function(t,i){e.getBlendSettings().setEdgeHighlightObjectId(t,i)},this.setGlowFlagAndColor=function(t,i,n){t?(O(0,0),t!==C&&(B(t),_=performance.now())):B(0),e.getBlendSettings().setGlowOptions(i,n||0)},this.setEdgeColor=function(e){},this.setSelectionColor=function(t){var i=new g.Color(t);i.r=Math.pow(i.r,2),i.g=Math.pow(i.g,2),i.b=Math.pow(i.b,2),e.getBlendSettings().setSelectionColor(i),I.selectionColor=t},this.setUnitScale=function(t){let i=h/t;h=t,e.getSAO().setUnitScale(i)},this.getUnitScale=function(){return h},this.getColorTarget=function(){return e.getRenderTargets().getColorTarget()},this.getOverlayTarget=function(){return e.getRenderTargets().getOverlayTarget()},this.getIdTarget=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e.getRenderTargets().getIdTarget(t)},this.getViewDepthTarget=function(){return e.getRenderTargets().getViewDepthTarget()},this.getOffscreenTarget=function(){return e.getOffscreenTarget()},this.setOffscreenTarget=function(t){e.setOffscreenTarget(t)},this.getCurrentFramebuffer=function(){return e.getCurrentFramebuffer()},this.setCutPlanes=function(t){e.getIBL().setCutPlanes(t)},this.getConfig=function(){let t=e.getGradientPass().getClearColors();return{renderEdges:I.renderEdges,envMapBackground:I.envMapBg,envMap:e.getEnvMapPass().getCubeMap(),envExposure:s,toneMapExposureBias:a,envRotation:this.getEnvRotation(),tonemapMethod:u,clearColorTop:new g.Vector3(t[0],t[1],t[2]),clearColorBottom:new g.Vector3(t[3],t[4],t[5]),clearAlpha:y,useOverlayAlpha:b,aoEnabled:this.getAOEnabled(),aoRadius:this.getAORadius(),aoIntensity:this.getAOIntensity(),aoBlendBias:this.getAOBlendBias(),twoSided:I.haveTwoSided,unitScale:this.getUnitScale(),antialias:this.getAntialiasing(),selectionColor:I.selectionColor}},this.applyConfig=function(e){this.toggleEdges(e.renderEdges),this.toggleEnvMapBackground(e.envMapBackground),this.setCubeMap(e.envMap),this.setEnvExposure(e.envExposure),this.setTonemapExposureBias(e.toneMapExposureBias),this.setEnvRotation(e.envRotation),this.setTonemapMethod(e.tonemapMethod),this.toggleTwoSided(e.twoSided),this.setEdgeColor(e.edgeColor),this.setUnitScale(e.unitScale),this.setAOOptions(e.aoRadius,e.aoIntensity,e.aoBlendBias),e.clearColor?this.setClearColors(e.clearColor):this.setClearColors(e.clearColorTop,e.clearColorBottom),this.setClearAlpha(e.clearAlpha),this.useOverlayAlpha(e.useOverlayAlpha);var t=e.aoEnabled!=this.getAOEnabled(),i=e.antialias!=this.getAntialiasing();(t||i)&&this.initPostPipeline(e.aoEnabled,e.antialias)},this.enter2DMode=function(t,i){P.sao=I.sao,P.antialias=I.antialias,P.renderEdges=I.renderEdges,P.selectionColor=I.selectionColor,this.setSelectionColor(i),I.renderEdges=!1,e.getBlendSettings().setIs2d(!0),this.initPostPipeline(!1,!1)},this.exit2DMode=function(){I.renderEdges=P.renderEdges,P.selectionColor&&this.setSelectionColor(P.selectionColor),e.getBlendSettings().setIs2d(!1),this.initPostPipeline(P.sao,P.antialias)},this.getBlendHighlightIntensity=function(){return e.getBlendSettings().getHighlightIntensity()},this.setBlendHighlightIntensity=function(t){e.getBlendSettings().setHighlightIntensity(t)},this.spatialFilterForRollOverSupported=function(){return I.sao},this.setSpatialFilterForRollOver=function(t,i){void 0===i||this.spatialFilterForRollOverSupported()?(e.getPostPass().enableSpatialFilter(),e.getBlendSettings().setZRange(...i)):console.warn("Spatial filter for mouse-over not supported")},this.disableSpatialFilterForRollOver=function(){e.getPostPass().disableSpatialFilter()},this.waitForIdReadback=function(){const t=e.getRenderTargets();if(t.readIdTargetPixelsSyncOrFail(0,0,1,1))return Promise.resolve();if(this._waitForIdReadbackPromise)return null;const i=Promise.withResolvers();t.onIdReadbackCacheFinished=i.resolve;const n=i.promise.then((()=>{t.onIdReadbackCacheFinished=null,this._waitingForIdReadback=null}));return this._waitingForIdReadback=n,n},this.startTimeQuery=function(){},this.stopTimeQuery=function(e){},this.getTimeResult=function(e,t){},this.createWebGpuCanvas=function(t,i){var n=c().document.createElement("canvas");n.width=t,n.height=i;const r=n.getContext("webgpu");return r.configure({device:e.getDevice(),format:navigator.gpu.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC|GPUTextureUsage.COPY_DST,alphaMode:"premultiplied"}),{canvas:n,texture:r.getCurrentTexture(),cleanup:()=>{r.unconfigure()}}},this.targetToCanvas=async function(t){const i=this.createWebGpuCanvas(t.width,t.height),n=e.getDevice(),r=n.createCommandEncoder();return r.copyTextureToTexture({texture:t,origin:[0,0,0]},{texture:i.texture,origin:[0,0,0]},[t.width,t.height]),n.queue.submit([r.finish()]),await n.queue.onSubmittedWorkDone(),i}}xS.Events=yS,_S.prototype=Object.create(ib.prototype);class ES{constructor(e,t,i,n){if(this.viewerImpl=e,this.renderContext=t,this.glRenderer=i,sn){const e={},t=Gi();this.glRenderer=new xS(t,e)}this.materialManager=n,this.materialName="__material_2Don3D__",this.tmpVec=new THREE.Vector3,this.tmpBox=new THREE.Box3}createContext(){const e=!sn;this.sheetContext=sn?new _S:new Autodesk.Viewing.Private.RenderContext,this.sheetContext.init(this.glRenderer,this.renderContext.settings.logicalWidth,this.renderContext.settings.logicalHeight,{offscreen:e});const t=this.renderContext.getConfig();t.antialias=!1,t.renderEdges=!1,t.clearAlpha=0,t.clearColor?t.clearColor.set(1,1,1):(t.clearColorBottom.set(1,1,1),t.clearColorTop.set(1,1,1)),this.sheetContext.applyConfig(t),this.prototypeScene=new THREE.Scene}setSize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.renderContext;this.sheetContext&&(this.sheetContext.setSize(e.settings.logicalWidth,e.settings.logicalHeight),this.updateMaterial())}createScene(){this.setSize(),this.scene=new THREE.Scene,this.planeGeometry=new THREE.PlaneBufferGeometry(1,1),this.material=new THREE.ShaderMaterial({uniforms:{sheetMap:{type:"t",value:this.sheetContext.getColorTarget()},idMap:{type:"t",value:this.sheetContext.getIdTarget()},modelIDv2:{type:"v3",value:new THREE.Vector3},resolution:{type:"v2",value:new THREE.Vector2},alphaTest:{type:"f",value:0}},vertexShader:ux(),fragmentShader:dx(),side:THREE.DoubleSide,transparent:!0}),this.material.webGPU={labelPrefix:"SheetRenderContext Shader",shader:"$frameBindGroup\n$objectUniforms\n$pack_depth\n\nstruct VertexOutput {\n    @builtin(position) Position : vec4f,\n    @location(0) @interpolate(flat) instance: u32,\n    @location(1) depth: f32,\n}\n\n@vertex fn vsmain(\n    @location(0) position : vec3f,\n    @builtin(instance_index) instance : u32\n) -> VertexOutput {\n    var objectUniforms = getObjectUniforms(instance);\n\n    var output : VertexOutput;\n    var pos4 = vec4f(position.x, position.y, position.z, 1.0);\n\n    var mvMatrix = uniforms.viewMatrix * objectUniforms.modelMatrix;\n    var mvPosition = mvMatrix * pos4;\n\n    output.Position = uniforms.projectionMatrix * mvPosition;\n    output.instance = instance;\n    output.depth    = mvPosition.z;\n\n    return output;\n}\n\nstruct PixelOutput {\n    @location(0) color: vec4f,\n    @location(1) normal: vec4f,\n    @location(2) viewDepth: vec4f,\n    @location(3) dbId: vec4u,\n    @location(4) modelId: vec4u,\n}\n\nstruct Uniforms {\n    modelIDv2: vec3f,\n    resolution: vec2f,\n    alphaTest: f32\n};\n\n@group(2) @binding(0) var<uniform> materialUniforms: Uniforms;\n\n@group(2) @binding(1) var sheetMap: texture_2d<f32>;\n@group(2) @binding(2) var idMap: texture_2d<u32>;\n\n@fragment fn psmain(\n    in: VertexOutput,\n) -> PixelOutput\n{\n    let pixelCoord = vec2i(floor(in.Position.xy));\n    let objectUniforms = getObjectUniforms(in.instance);\n\n    let outColor = textureLoad(sheetMap, pixelCoord, 0);\n\n    // Note that we also write the z-Buffer. So we must discard\n    // sheet background pixels to avoid occluding 3d geometry behind.\n    if (outColor.a <= 0.0) {\n        discard;\n    }\n\n    // Compute viewDepth\n    let unitDepth = (-in.depth - uniforms.near) / (uniforms.far - uniforms.near);\n    const normalValid = 0.0; // Indicates not to use normal and lighting, see basic.wgsl\n\n    var output: PixelOutput;\n    output.color = outColor;\n    output.normal = vec4f(0.0);\n    output.viewDepth = vec4f(packDepth10(unitDepth), normalValid);\n    output.dbId = textureLoad(idMap, pixelCoord, 0);\n    output.modelId = intToVec(objectUniforms.modelId | (objectUniforms.objectFlags << 16));\n\n    return output;\n}",textureBindings:[{uniformKey:"sheetMap",binding:1},{uniformKey:"idMap",binding:2,sampleType:"uint"}]},this.scene.skipDepthTarget=!0,this.updateMaterial(),this.materialManager.addMaterialNonHDR(this.materialName,this.material),this.mesh=new THREE.Mesh(this.planeGeometry,this.material),this.mesh.matrixAutoUpdate=!1,this.scene.add(this.mesh)}updateMaterial(){if(this.material){const e=this.sheetContext.getColorTarget();this.material.uniforms.sheetMap.value=e,this.material.uniforms.idMap.value=this.sheetContext.getIdTarget(),this.material.uniforms.resolution.value.set(1/(e.width||1),1/(e.height||1)),sn&&(this.material.uniformsNeedUpdate=!0)}}renderScenePart(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.renderContext;if(!e.frags||!e.frags.is2d)return;this.sheetContext||this.createContext(),this.scene||this.createScene(),this.material.uniforms.alphaTest.value=!e.needsTwoPasses||e.isSecondPass?0:.9;const o=e.modelId,s=this.viewerImpl.modelQueue().findModel(o),a=this.tmpBox.copy(s.getBoundingBox(!0)),l=s.getViewportBounds();l&&a.intersect(l);const c=s.getModelToViewerTransform();this.material.uniforms.modelIDv2.value.set((255&o)/255,(o>>8&255)/255,(o>>16&255)/255),r.getAOEnabled()!==this.sheetContext.getAOEnabled()&&this.sheetContext.initPostPipeline(r.getAOEnabled(),!1),n=n&&s.areAllVisible(),i=!1;this.lastRenderedModel===s&&e.isSecondPass||(this.sheetContext.beginScene(this.prototypeScene,this.viewerImpl.camera,this.viewerImpl.noLights,!0),this.sheetContext.renderScenePart(e,t,i,n,!1),this.sheetContext.presentBuffer());const u=a.getSize(new THREE.Vector3);this.mesh.matrix.makeScale(u.x,u.y,1),a.getCenter(this.tmpVec),this.mesh.matrix.setPosition(this.tmpVec),c&&this.mesh.matrix.multiplyMatrices(c,this.mesh.matrix),this.mesh.matrixWorld.copy(this.mesh.matrix),this.scene.modelId=o,r.renderScenePart(this.scene,t,i,n),this.lastRenderedModel=s}destroy(){this.material&&(this.material.dispose(),this.materialManager.removeNonHDRMaterial(this.materialName),this.material=null),this.planeGeometry&&(this.planeGeometry.dispose(),this.planeGeometry=null),this.sheetContext&&(this.sheetContext.cleanup(),this.context=null),this.renderContext=null,this.glRenderer=null}}const SS=(e,t,i,n,r)=>{let o=r.getMaterials(),s=r.glrenderer(),a=r.renderer(),l=r.modelQueue(),u=[],h=(n=n||{}).models||l.getModels();for(let e=0;e<h.length;e++){let t=h[e].getIterator();if(!t||!t.getGeomScenes)continue;let i=t.getGeomScenes();for(let e=0;e<i.length;e++){let t=i[e];t&&u.push(t)}}let d=n.camera||r.camera;u.sort(((e,t)=>{let i=e.sortObjects??!0;return i!==(t.sortObjects??!0)?i?1:-1:i?d.getWorldDirection().dot(e.getBoundingBox().getCenter())-d.getWorldDirection().dot(t.getBoundingBox().getCenter()):0})),d===r.camera&&(d=d.clone()),d.isUnifiedCamera&&d.updateCameraMatrices(),d.clientWidth=e,d.clientHeight=t;const f=new ac,p=n.excludeCutPlanes?[]:o.getCutPlanes(),m=!n.excludeCutplanes&&o.cutplanesHideInterior>0;if(f.reset(d,p,m),f.areaCullThreshold=Qi,sn&&!n.renderContext){const e=Gi();s=new xS(e,{pixelRatio:1});const t=r.glrenderer().getIBL();s.getIBL().copyFrom(t),s.getMainPass().disableRenderBundles()}let g,y;if(w(),n.renderContext?g=n.renderContext:sn?(g=new _S,g.init(s,e,t)):(g=new lx,g.init(s,e,t,{offscreen:!0})),sn)for(const e of h)e.is3d()&&!s.has3dModel(e)&&s.add3dModel(e);r.isSheetRendererNeeded()&&(y=n.sheetRenderer?n.sheetRenderer:new ES(r,g,s,o)),sn||(o.addOverrideMaterial("normalsMaterial_screenshot",g.getDepthMaterial()),o.addOverrideMaterial("edgeMaterial_screenshot",g.getEdgeMaterial()));let b=n.renderConfig||a.getConfig();g.applyConfig(b),g.beginScene(r.scene,d,r.noLights,!0),C();let x,_=0,E={stop:()=>{x&&(c().clearTimeout(x),T())},finished:()=>!!x},S=-1,A=[];for(let e=0;e<h.length;e++){let t=h[e];if(t.isLeaflet()){let e=t.getIterator();A.push({iter:e,viewId:e.registerView(),ready:!1})}}function w(){sn||(s.pushViewport(),s.setPixelRatio(1),s.setViewport(0,0,e,t))}function C(){sn||(s.popViewport(),s.setPixelRatio())}const T=()=>{A.forEach((e=>e.iter.unregisterView(e.viewId))),A.length=0};let M=n.fragOptions,I=M?[]:void 0;const P=e=>{if(!(!!M&&e instanceof Sc))return;let t=e.frags;e.forEachNoMesh((function(e,i){I[i]=t.vizflags[e];let n=M.isFragOff&&M.isFragOff(e);void 0!==n&&t.setFlagFragment(e,ll.MESH_HIDE,n);let r=M.isFragVisible&&M.isFragVisible(e);void 0!==r&&t.setFlagFragment(e,ll.MESH_VISIBLE,r)}))},L=e=>{if(!(!!M&&e instanceof Sc))return;let t=e.frags;e.forEachNoMesh((function(e,i){let n=I[i],r=!!(n&ll.MESH_HIDE),o=!!(n&ll.MESH_VISIBLE);t.setFlagFragment(e,ll.MESH_HIDE,r),t.setFlagFragment(e,ll.MESH_VISIBLE,o)}))},R=(()=>{let e;if(n.models){e=new(v().Box3);for(let t=0;t<h.length;t++){let i=h[t];e.union(i.getBoundingBox())}}else e=r.getVisibleBounds();let t=Object.prototype.hasOwnProperty.call(n,"is2d")?n.is2d:r.is2d,i=g.settings.deviceHeight,s=n.excludeCutPlanes?void 0:o.getCutPlanesRaw(),a=s&&s[0],l=h[0]&&h[0].getBoundingBox();return Kp.getPixelsPerUnit(d,t,e,i,a,l)})();let D=[],O=null;const B=e=>{n.excludeThemingColors&&e instanceof Sc&&(e.frags.is2d||(O=e.frags.db2ThemingColor,e.frags.db2ThemingColor=D))},N=e=>{O&&(e.frags.db2ThemingColor=O,O=null)};let U=new(v().Vector4)(0,0,-1,-1e20),k=[],F=null;const V=e=>{e.canvas.toBlob((function(t){let r=c().URL.createObjectURL(t);i&&(i(r),n.renderContext||g.cleanup()),e.cleanup&&e.cleanup()}))},G=()=>{let l=!(()=>{let e=!0;for(let t=0;t<A.length;t++){let i=A[t];i.ready||(i.ready=i.iter.reset(f,d,i.viewId)),e=e&&i.ready}if(e=e||n.dontWaitForLeafletTiles,e)for(let e=0;e<A.length;e++){let t=A[e],i=t.iter.getScene(t.viewId);u.push(i)}return e})();if(l)return void(x=c().setTimeout(G,0));let p=performance.now();w();let m=r.getPixelsPerUnit(r.camera,r.getVisibleBounds());var v,E;(o.updatePixelScale(R,e,t,d),n.excludeCutPlanes)?(()=>{F=o.getCutPlanes();let e=F.length;if(k.length!==e){k.length=e;for(let t=0;t<e;t++)k[t]=U}a.toggleTwoSided(o.setCutPlanes(k))})():null===(v=(E=r.api).syncCutPlanes)||void 0===v||v.call(E);for(n.beforeRender&&n.beforeRender();_<u.length;){let e=u[_];const t=h.find((t=>{var i;return t.id===(null===(i=e.frags)||void 0===i?void 0:i.modelId)}));if(null!=t&&t.is2d()){const e=t.getModelToViewerTransform(),i=e?e.getMaxScaleOnAxis():1;if(!r.is2d||1!==i){const e=t.getVisibleBounds(),n=g.settings.deviceWidth,r=g.settings.deviceHeight,s=Kp.getPixelsPerUnit(d,!0,e,r,null,e);o.updatePixelScaleForModel(t,s,n,r,i,d)}}if(P(e),B(e),e instanceof Sc&&e.applyVisibility(vc.RENDER_NORMAL,f),y&&e.frags.is2d)y.renderScenePart(e,!0,!0,!1,g);else if(g.renderScenePart(e,!0,!0,!1,!1),e.frags&&!e.frags.areAllVisible()&&r.showGhosting||M){e instanceof Sc&&e.applyVisibility(vc.RENDER_HIDDEN,f),a.setEdgeColor(r.edgeColorGhosted),e.overrideMaterial=r.fadeMaterial;const t=sn&&!e.frags.is2d;t&&(e.edgesOnly=!0),g.renderScenePart(e,!0,!0,!1,!1),a.setEdgeColor(r.edgeColorMain),e.overrideMaterial=null,t&&(e.edgesOnly=void 0)}if(N(e),L(e),_++,performance.now()-p>20)break}if(sn&&s.flushCommandQueue(),C(),o.updatePixelScale(m,a.settings.deviceWidth,a.settings.deviceHeight,d),n.excludeCutPlanes&&a.toggleTwoSided(o.setCutPlanes(F)),n.afterRender&&n.afterRender(),_===u.length?(()=>{T();let o,s=g.getColorTarget();if(b.aoEnabled||b.antialias)b.aoEnabled&&g.computeSSAO(),sn?(o=g.createWebGpuCanvas(e,t),s=o.texture):(s=g.getNamedTarget("overlay"),g.getBlendPass().uniforms.tOverlay.value=null),g.setOffscreenTarget(s),g.presentBuffer();else{let e=r.lightsOn?r.lights:r.no_lights;if(n.overlayScenes){const t=n.overlayScenes??r.overlayScenes;g.renderOverlays(t,e)}}if(n.returnAsTarget){const e=n.extraTargets?n.extraTargets.map((e=>g.getNamedTarget(e))):void 0;i(g,s,d,y,e)}else{var a;if(n.sheetRenderer||(null===(a=y)||void 0===a||a.destroy(),y=null),sn)o?V(o):g.targetToCanvas(s).then(V);else{let e=g.targetToCanvas(s);V(e)}}})():x=c().setTimeout(G,0),n.onProgress){let e=Math.floor(100*_/u.length);e!==S&&(S=e,n.onProgress(e))}};return G(),E},AS=(e,t,i,n,r)=>{var{fullPage:o,bounds:s,getCropBounds:a,margin:l,overlayRenderer:u,overlayRendererExtraOptions:h}=r;sn&&u&&console.warn("getScreenShotWithBounds() in WebGPU mode does not currently support overlayRenderer option."),o&&(s=e.impl.getVisibleBounds());const d=e.impl.getCanvasBoundingClientRect().width;let f=e.navigation.getCamera();s&&(f=MS(e,s,l));const p=wS(e,f);try{if(o){const e=p.getSize(new(v().Vector3)),n=d/Math.max(e.x,e.y);t=Math.floor(t*n),i=Math.floor(i*n)}const r=r=>{if(o){const e=t/d;p.min.x*=e,p.min.y*=e,p.max.x*=e,p.max.y*=e,CS(r,p,n)}else if(a){const t=a(e,f,s);CS(r,t,n)}else r.toBlob((e=>{const r=c().URL.createObjectURL(e);n(r,t,i)}))},l=e.impl.selector.getSelection();return e.clearSelection(),SS(t,i,((n,o,s)=>{if(e.impl.selector.setSelection(l),u){u(e,{width:t,height:i,ctx:n,target:o,screenshotCamera:s,onRenderDone:r},h)}else if(sn)n.targetToCanvas(o).then((e=>{let{canvas:t,cleanup:i}=e;r(t),i()}));else{const{canvas:e}=n.targetToCanvas(o);r(e)}}),{returnAsTarget:!0,camera:f},e.impl)}catch(e){console.error("getScreenShot error: "+e),n(null)}},wS=(e,t)=>{const i=e.impl.getVisibleBounds(void 0,void 0,void 0,!0),n=e.worldToClient(i.min,t),r=e.worldToClient(i.max,t);return(new(v().Box3)).setFromPoints([n,r])},CS=(e,t,i)=>{const n=c().document.createElement("canvas"),r=n.getContext("2d"),o=t.getSize(new(v().Vector3)),s=Math.min(Math.floor(o.x),e.width),a=Math.min(Math.floor(o.y),e.height);n.width=s,n.height=a;const l=Math.max(Math.floor(t.min.x),0),u=Math.max(Math.floor(t.min.y),0),h=s,d=a;r.drawImage(e,l,u,h,d,0,0,s,a),n.toBlob((e=>{var t=c().URL.createObjectURL(e);i(t,s,a)}),"image/png")},TS=(e,t,i,n)=>{const r=c().document.createElement("canvas"),o=r.getContext("2d"),s=new Image;r.width=t,r.height=i,s.src=e,s.onload=function(){o.drawImage(s,0,0,t,i);const e=r.toDataURL("image/png");n(e)}},MS=(e,t,i)=>{i=i||e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN;const n={horizontal:e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN,vertical:e.navigation.FIT_TO_VIEW_VERTICAL_MARGIN};e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=i,e.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=i;const r=e.getState({viewport:!0});e.navigation.fitBounds(!0,t,!1,!0);const o=e.navigation.getCamera().clone();return e.restoreState(r,void 0,!0),e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=n.horizontal,e.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=n.vertical,e.impl.updateNearFarValues(o,t),o};let IS={getScreenShotLegacy:function(e,t,i,n,r){var o=e.impl,s=o.renderer(),a=s.settings.logicalWidth,l=s.settings.logicalHeight,u=o.progressiveRender,h=o.glrenderer().getPixelRatio();let d,f;t&&i||(t=a,i=l),o.progressiveRender=!1,o.resize(t/h,i/h,!0),o.tick(performance.now()),sn?(f=s.createWebGpuCanvas(t,i),d=f.texture):d=new(v().WebGLRenderTarget)(t,i,{minFilter:v().LinearFilter,magFilter:v().LinearFilter,format:v().RGBFormat,type:v().UnsignedByteType});const p=s.getOffscreenTarget();function m(){let e;function t(e){o.progressiveRender=u,o.resize(a,l,!0),e.canvas.toBlob((function(t){var i=c().URL.createObjectURL(t);n?n(i):c().open(i),e.cleanup&&e.cleanup()}),"image/png")}sn?e=f:(e=s.targetToCanvas(d||s.getColorTarget()),d&&(d.dispose(),d=void 0,o.glrenderer().setRenderTarget(null))),r?(sn&&console.warn("getScreenShotLegacy() in WebGPU mode does not currently support overlayRenderer param."),r(e.ctx,(()=>{t(e)}))):t(e)}if(s.setOffscreenTarget(d),s.presentBuffer(),s.setOffscreenTarget(p),e.model.isLeaflet()){var g=!1;const t=function(){g=!0,o.progressiveRender=u,o.resize(a,l,!0),d&&d.dispose()};e.addEventListener(Wr,t,{once:!0}),o.invalidate(!0),e.model.getIterator().callWhenRefined((function(){g||(e.removeEventListener(Wr,t),m())}))}else m()},getScreenShot:SS,getScreenShotWithBounds:AS,getScreenShotAtScreenSize:(e,t,i)=>{const n=e.impl.getCanvasBoundingClientRect(),r=Math.floor(n.width),o=Math.floor(n.height);AS(e,r,o,((e,i,n)=>{e?TS(e,i,n,(e=>{t(e,i,n)})):t(null)}),i)},getSceneClientBounds:wS,cropImage:CS,blobToImage:TS,makeBoundsSquare:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.getSize(new(v().Vector3)),n=Math.max(i.x,i.y,t);e.expandByVector(new(v().Vector3)((n-i.x)/2,(n-i.y)/2,0))},getCameraWithFitBounds:MS};var PS={RESET_NORMAL:0,RESET_REDRAW:1,RESET_RELOAD:2},LS=new(v().Vector3),RS=new Float32Array(6);const DS="hierarchy";var OS=DS;class BS{constructor(){}static setStrategy(e){if(OS!==e)return OS=e,!0}static getStrategy(){return OS}static explode(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n=e.getData().instanceTree,r=e.getFragmentList(),o=e.getVisibleBounds(!0).getCenter(new(v().Vector3));if(OS===DS&&n&&0!==t){const{magnitude:e,depthDampening:s}=i;!function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;var s=i*e.maxDepth+1;1===e.maxDepth&&(s=i);var a=0|s,l=s-a;function c(n,s,u,h,d,f,p,m){var g=i*r/Math.pow(s,o);s==a&&(g*=l),e.getNodeBox(n,RS);var v=.5*(RS[0]+RS[3]),y=.5*(RS[1]+RS[4]),b=.5*(RS[2]+RS[5]);s>0&&s<=a&&(f+=(v-u)*g,p+=(y-h)*g,m+=(b-d)*g);e.isNodeExplodeLocked(n)&&(f=p=m=0),e.enumNodeChildren(n,(function(e){c(e,s+1,v,y,b,f,p,m)}),!1),LS.x=f,LS.y=p,LS.z=m,e.enumNodeFragments(n,(function(e){t.updateAnimTransform(e,null,null,LS)}),!1)}c(e.getRootId(),0,n.x,n.y,n.z,0,0,0)}(n,r,t,o,e,s)}else!function(e,t,i,n){var r,o,s=e.fragments.boxes;e.useThreeMesh?r=e.vizmeshes:o=e.fragments.fragId2dbId;for(var a=0,l=e.getCount();a<l;a++)if(0==i||t&&t.isNodeExplodeLocked(r?r[a]&&r[a].dbId:o[a]))e.updateAnimTransform(a);else{var c=6*a,u=.5*(s[c]+s[c+3]),h=.5*(s[c+1]+s[c+4]),d=.5*(s[c+2]+s[c+5]);LS.x=i*(u-n.x),LS.y=i*(h-n.y),LS.z=i*(d-n.z),e.updateAnimTransform(a,null,null,LS)}}(r,n,t,o)}}let NS=new class{viewers=new Map;frameTimeScalingFactorAvg=1;taskExecutionTime=0;#ya=0;#ba=0;#xa=void 0;constructor(){}registerViewer(e,t){this.viewers.set(e,{priority:t,renderTimeFraction:0,usedCpuTime:void 0,desiredFrameTime:0}),this._updateRenderTimeFractions()}updateViewerPriority(e,t){this.viewers.get(e).priority=t,this._updateRenderTimeFractions()}unregisterViewer(e){this.viewers.delete(e),this._updateRenderTimeFractions()}_updateRenderTimeFractions(){let e=0;this.viewers.forEach((t=>{e+=t.priority})),this.viewers.forEach((t=>{t.renderTimeFraction=t.priority/e}))}setTaskExecutionTime(e){this.taskExecutionTime=e}updateFrameTime(e,t,i,n,r){if(!i){i=void 0;for(let[,e]of this.viewers)e.usedCpuTime=void 0}if(i&&void 0!==this.viewers.get(e).usedCpuTime){let e=0,t=!0,i=0;for(let[,n]of this.viewers)void 0!==n.usedCpuTime&&(e+=n.usedCpuTime,n.usedCpuTime=void 0,t&=n.isDone,i+=n.desiredFrameTime);n-=this.taskExecutionTime,this.taskExecutionTime=0;const r=!t||n>i?e/n:1;this.frameTimeScalingFactorAvg=.9*this.frameTimeScalingFactorAvg+.1*r;for(let[e,t]of this.viewers)e._updateTargetFrameBudget(this.frameTimeScalingFactorAvg,t.renderTimeFraction)}let o=this.viewers.get(e);o.usedCpuTime=i,o.isDone=t,o.desiredFrameTime=r,this.#ya=r/(this.#ba+20),this.#xa=void 0}ensureMinimumBatchTime(e){if(fn&&!sn){if(e&&e.lastGPUTimesChanged){if(void 0!==this.#xa)for(;performance.now()-this.#xa<e.avgGPUTimeMS;);}else if(void 0!==this.#xa&&void 0!==this.#ya)for(;performance.now()-this.#xa<this.#ya;);this.#xa=performance.now()}}beginFrame(){this.#ba=0}onBatchRendered(){this.#ba++}};const US=new(v().Box3);class kS{#X=!1;#_a=[];#Ea=[];#Sa=[];#Aa=[];#K=new ac;#wa=new(v().Raycaster);enableNonResumableFrames=!1;budgetForTransparent=.1;#Ca=!1;#Ta=[];#Zs=null;interruptedRenderBatch=void 0;constructor(){}frustum(){return this.#K}#Ma(e,t){for(let i=0;i<e.length;i++){const n=e[i];if(n&&n.id===t)return n}return null}findModel(e){return this.#Ma(this.#_a,e)}findHiddenModel(e){return this.#Ma(this.#Aa,e)}addModel(e){-1===this.#_a.indexOf(e)&&(this.#_a.push(e),this.#Ea.length=this.#_a.length,this.#Sa.length=this.#_a.length,this.recomputeLinePrecision())}removeModel(e){const t=this.#_a.indexOf(e);return t>=0&&this.#_a.splice(t,1),this.#Ea.length=this.#_a.length,this.#Sa.length=this.#_a.length,this.recomputeLinePrecision(),t>=0}addHiddenModel(e){const t=this.#Aa.indexOf(e);return t<0&&this.#Aa.push(e),t<0}removeHiddenModel(e){const t=this.#Aa.indexOf(e);return t>=0&&this.#Aa.splice(t,1),t>=0}isEmpty(){return 0===this.#_a.length}recomputeLinePrecision(){let e=1;const t=new(v().Vector3);for(let i=0,n=this.#_a.length;i<n;++i){const n=this.#_a[i].getData().bbox;if(0===n.getSize(t).length())continue;const r=.001*v().Box3.prototype.getBoundingSphere.call(n,new(v().Sphere)).radius;e=Math.min(e,r)}this.#wa.params.Line.threshold=e}_updateAvgFrameTime(e,t){if(void 0===e.avgFrameTime)return e.avgFrameTime=t,void(e.outliers=[]);let i=!0;t<.7*e.avgFrameTime||t>1.5*e.avgFrameTime?(e.outliers.push(t),i=!1,e.outliers.length>4&&(e.avgFrameTime=e.outliers.reduce(((e,t)=>e+t),0)/e.outliers.length,e.outliers.splice(0,1e3))):e.outliers.splice(0,1e3),i&&(e.avgFrameTime=.95*e.avgFrameTime+.05*t)}#Ia(e,t,i){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=r.boundingBox||r.getBoundingBox();r.cameraDistance=i.distanceToPoint(t.position)}e.sort((function(e,t){return t.cameraDistance-e.cameraDistance}));let o=performance.now();for(n=0;n<e.length;n++){r=e[n],r.render?r.render(i):i(r);const t=performance.now(),s=t-o;o=t,this._updateAvgFrameTime(r,s)}}frameResumePossible(){return!this.#Ca}renderSome(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=performance.now(),r=n;NS.beginFrame();let o=n+2*t/i,s=n+t/i;const a=this.budgetForTransparent*t;let l=null,c=0,u=0,h=0,d=$i;const f=e=>{const r=performance.now()+Math.min(d,.5*t),o=Ji?performance.now()+t:1/0;let s=performance.now(),a=e.nextBatch(o,r),l=performance.now(),c=l-s;return t-=c/i,d-=c,n=l,NS.ensureMinimumBatchTime(a),a};for(;;){let i=0,d=null;if(this.interruptedRenderBatch)d=this.interruptedRenderBatch,this.interruptedRenderBatch=void 0;else for(let e=0;e<this.#Ea.length;e++){let n=this.#Ea[e];if(l=this.#_a[e],n||(this.#Ea[e]=n=f(l)),t<=0)return t;if(this.#Ca&&t<a){n&&!n.sortObjects&&(l.skipOpaqueShapes(),this.#Ea[e]=n=f(l))}if(null===n)continue;d||(i=e,d=n);const r=n.sortObjects==d.sortObjects&&n.renderImportance>d.renderImportance,o=!n.sortObjects&&d.sortObjects;(r||o)&&(i=e,d=n)}if(!d){this.#X=!0;break}{const a=d.hasBeenInterrupted&&d.hasBeenInterrupted();if(a||(this.#Ea[i]=f(this.#_a[i])),d.sortObjects&&this.#Ca)this.#Ta.push(d),t-=void 0===d.avgFrameTime?.05:d.avgFrameTime;else if(Ji&&d.setDeadline&&(d instanceof Ac?d.setDeadline(o):d.setDeadline(s)),d.render?d.render(e):e(d),NS.onBatchRendered(),d.setDeadline&&d.setDeadline(void 0),d.hasBeenInterrupted&&d.hasBeenInterrupted())this.interruptedRenderBatch=d,t=-1;else{Object.prototype.hasOwnProperty.call(d,"drawEnd")&&(d.drawEnd=d.lastItem),r=performance.now();let e=r-n;if(n=r,a)t-=e;else{let i;c>5&&(i=u/c,e>5*i&&h<3&&(e=d.avgFrameTime??i,h++)),u+=e,c++,void 0===d.avgFrameTime&&(e=Ji?i??e:i??.5),this._updateAvgFrameTime(d,e),t-=d.avgFrameTime}}if(t<=0)break}}return this.#Ta.length>0&&(this.#Ia(this.#Ta,this.#Zs,e),this.#Ta.length=0),t}reset(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.interruptedRenderBatch&&(this.interruptedRenderBatch.resetInterrupted(),this.interruptedRenderBatch=void 0),this.#X=!1,this.#K.reset(e,n,r),this.#K.areaCullThreshold=Qi,!this.#_a.length)return;this.#Ca=this.enableNonResumableFrames&&i==PS.RESET_RELOAD&&t===vc.RENDER_NORMAL,this.#Zs=e;const o=performance.now()+$i,s=Ji?performance.now()+$i:1/0;for(let n=0;n<this.#_a.length;n++)this.#_a[n].resetIterator(e,this.#K,t,i),this.#Ea[n]=this.#_a[n].nextBatch(s,o),this.#Sa[n]=null}isDone(){return this.#X||this.isEmpty()}setAllVisibility(e){for(let t=0;t<this.#_a.length;t++)this.#_a[t].setAllVisibility(e)}hideLines(e){for(let t=0;t<this.#_a.length;t++)this.#_a[t].hideLines(e)}hidePoints(e){for(let t=0;t<this.#_a.length;t++)this.#_a[t].hidePoints(e)}hasHighlighted(){for(let e=0;e<this.#_a.length;e++)if(this.#_a[e].hasHighlighted())return!0;return!1}areAllVisible(){for(let e=0;e<this.#_a.length;e++)if(!this.#_a[e].areAllVisible())return!1;return!0}areAll2D(){for(let e=0;e<this.#_a.length;e++)if(!this.#_a[e].is2d())return!1;return!0}areAll3D(){for(let e=0;e<this.#_a.length;e++)if(!this.#_a[e].is3d())return!1;return!0}invalidateVisibleBounds(){for(let e=0;e<this.#_a.length;e++)this.#_a[e].invalidateBBoxes()}getVisibleBounds(e,t,i){US.makeEmpty();for(let n=0;n<this.#_a.length;n++){const r=this.#_a[n].getVisibleBounds(e,i);t&&!t(r)||US.union(r)}return US}rayIntersect(e,t,i,n,r,o,s,a){if(this.#wa.set(e,t),this.#_a.length>1){const e=[];if(r)for(let t=0;t<r.length;t++){const l=this.findModel(r[t]);if(l){const r=n&&n[t],c=l.rayIntersect(this.#wa,i,r,o,s,a);c&&e.push(c)}}else for(let t=0;t<this.#_a.length;t++){const r=this.#_a[t].rayIntersect(this.#wa,i,n,o,s,a);r&&e.push(r)}return e.length?(e.sort((function(e,t){return e.distance-t.distance})),e[0]):null}{if(!this.#_a.length)return null;const e=this.#_a[0];return r&&-1===r.indexOf(e.id)?null:e.rayIntersect(this.#wa,i,n,o,s,a)}}getRenderProgress(){return this.#_a[0].getRenderProgress()}getModels(){return this.#_a}getHiddenModels(){return this.#Aa}getAllModels(){return this.#_a.concat(this.#Aa)}getFragmentList(){return this.#_a[0].getFragmentList()}getGeometryList(){return this.#_a[0].getGeometryList()}getSceneCount(){return this.#_a[0].getSceneCount()}getGeomScenes(){let e=[];for(let t=0;t<this.#_a.length;t++){const i=this.#_a[t].getGeomScenes();for(let t=0;t<i.length;t++){const n=i[t];n&&e.push(n)}}return e}getGeomScenesPerModel(){return this.#_a.reduce(((e,t)=>(e.push(t.getGeomScenes()),e)),[])}explode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.#_a.length){for(let i=0;i<this.#_a.length;i++){const n=this.#_a[i];BS.explode(n,e,t)}this.invalidateVisibleBounds()}}update(e){let t=!1;for(let i=0;i<this.#_a.length;i++){const n=this.#_a[i];t=t||n.update(e)}return t}hideModel(e){for(let t=0;t<this.#_a.length;t++){const i=this.#_a[t];if(i&&i.id===e)return this.removeModel(i),this.#Aa.push(i),!0}return!1}showModel(e){for(let t=0;t<this.#Aa.length;++t){const i=this.#Aa[t];if(i&&i.id===e)return this.addModel(i),this.#Aa.splice(t,1),!0}return!1}}var FS={MIXED:1,REGULAR:2,OVERLAYED:3};function VS(e,t){var i=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=po.LEAF_OBJECT,this.lockedNodes=[];var n={};function r(){return t.getData().instanceTree}function o(i){var s=r();if(n[i]>0)n[i]--,0==n[i]&&e.highlightObjectNode(t,i,!1);else if(n[i]<0)throw"Selection State machine broken. Negatively selected object!";s&&s.enumNodeChildren(i,(function(e){o(e)}),!1)}function s(i,o,a){var l=r();if(n[i])n[i]++;else{switch(a){default:case FS.MIXED:e.highlightObjectNode(t,i,!0,o);break;case FS.REGULAR:e.highlightObjectNode(t,i,!0,!0);break;case FS.OVERLAYED:e.highlightObjectNode(t,i,!0,!1)}n[i]=1}l&&l.enumNodeChildren(i,(function(e){s(e,!0,a)}),!1)}function a(e){if(void 0!==e&&i.selectedObjectIds[e])return!0}function l(n,o){if(!i.isNodeSelectionLocked(n)){var l=r();if(o=o||FS.MIXED,l){const r=function(){var n;const r="ifc"===(null===(n=t.getData())||void 0===n||null===(n=n.loadOptions)||void 0===n?void 0:n.fileExt),o=void 0!==e.api.prefs.getPrefFromLocalStorage(Autodesk.Viewing.Private.Prefs3D.SELECTION_MODE);return r&&!o?Autodesk.Viewing.SelectionMode.FIRST_OBJECT:i.selectionMode}();if(n=l.findNodeForSelection(n,r),!l.isNodeSelectable(n))return}a(n)||(i.selectedObjectIds[n]=o,i.selectionCount++,s(n,!1,o))}}function c(e){a(e)&&(o(e),i.selectedObjectIds[e]=0,i.selectionCount--)}this.getInstanceTree=r,this.hasSelection=function(){return i.selectionCount>0},this.getSelectionLength=function(){return i.selectionCount},this.getSelection=function(){var e=[],t=i.selectedObjectIds;for(var n in t)if(t[n]){var r=parseInt(n);e.push(r)}return e},this.isSelected=function(e){return a(e)},this.clearNodeSelection=function(e){return void 0!==e&&0!==this.selectionCount&&(o(e),delete i.selectedObjectIds[e],!0)},this.clearSelection=function(e){if(this.selectionCount>0){var t=i.selectedObjectIds;for(var n in t){var r=parseInt(n);void 0!==r&&o(r)}return i.selectedObjectIds={},i.selectionCount=0,!0}},this.deselectInvisible=function(){var n=!1,r=i.selectedObjectIds,o=e.visibilityManager;for(var s in r){var a=parseInt(s);a&&!o.isNodeVisible(t,a)&&(c(a),n=!0)}return n},this.toggleSelection=function(e,i){e||t.isLeaflet()?a(e)?c(e):l(e,i):rt.error("Attempting to select node 0.",at(st.VIEWER_INTERNAL_ERROR))},this.setSelectionMode=function(e){this.clearSelection(!0),this.selectionMode=e},this.isNodeSelectionLocked=function(e){if(-1===e)return!1;var t=r();return t?t.isNodeSelectionLocked(e):-1!==i.lockedNodes.indexOf(e)},this.lockSelection=function(e,t){var n=r();function o(e,t){if(e&&-1!==e)if(t)-1===i.lockedNodes.indexOf(e)&&(i.lockedNodes.push(e),i.clearNodeSelection(e));else{const t=i.lockedNodes.indexOf(e);i.lockedNodes.splice(t,1)}}e=Array.isArray(e)?e:[e],n?e.forEach((function(e){n.enumNodeChildren(e,(function(e){n.lockNodeSelection(e,!1),o(e,t),t&&n.lockNodeSelection(e,t)}),!0)})):e.forEach((e=>{o(e,t)}))},this.setSelection=function(e,t){if(!function(e){if(i.selectionCount!==e.length)return!1;for(var t=0;t<e.length;t++)if(!a(e[t]))return!1;return!0}(e)&&(this.clearSelection(!0),null!=e&&0!==e.length))for(var n=0;n<e.length;n++)l(e[n],t)},this.getSelectionBounds=function(){var e=new(v().Box3),n=new(v().Box3),o=r();if(o){var s=t.getFragmentList(),a=i.selectedObjectIds;for(var l in a){var c=parseInt(l);o.enumNodeFragments(c,(function(t){s.getWorldBounds(t,n),e.union(n)}),!0)}}return e},this.getSelectionVisibility=function(){var e=!1,n=!1,o=i.selectedObjectIds;for(var s in o){var a=parseInt(s);if(a){var l=r();if(l&&l.isNodeHidden(a)?n=!0:e=!0,e&&n)break}}return{hasVisible:e,hasHidden:n,model:t}},this.update2DSelectionHighlighting=function(){if(i._2DSelectionHighlightingUpdated)return;if(!t.isLoadDone())return;var n=t.getPropertyDb();if(n&&!n.isLoadDone())return;if(!e.overlayScenes[e.selection2dOverlayName(t)])return;for(var r=i.getSelection(),a=0;a<r.length;a++){o(c=r[a])}const l={};Object.keys(i.selectedObjectIds).forEach((e=>{l[t.remapDbId(e)]=i.selectedObjectIds[e]})),i.selectedObjectIds=l;for(a=0;a<r.length;a++){var c;s(c=r[a],!1,i.selectedObjectIds[c])}i._2DSelectionHighlightingUpdated=!0},this.dtor=function(){this.selectedObjectIds=null}}function GS(e){var t=[];function i(){t.length>1&&rt.warn("This selection call does not yet support multiple models.")}function n(i){for(var n,r=[],o=0;o<t.length;o++){var s=[],a=[],l=t[o].selector.selectedObjectIds,c=t[o].selector.getInstanceTree();for(var u in l)if(l[u]){var h=parseInt(u);h&&(s.push(h),c&&c.enumNodeFragments(h,(function(e){a.push(e)}),!1))}s.length&&r.push({fragIdsArray:a,dbIdArray:s,nodeArray:s,model:t[o]})}1===t.length&&(n={type:fr,fragIdsArray:r[0]?r[0].fragIdsArray:[],dbIdArray:r[0]?r[0].dbIdArray:[],nodeArray:r[0]?r[0].dbIdArray:[],model:t[0],mouseButton:i},e.api.dispatchEvent(n)),n={type:pr,selections:r,mouseButton:i},e.api.dispatchEvent(n)}function r(){for(var e=!1,i=0;i<t.length;i++)e=t[i].selector.deselectInvisible()||e;e&&n()}function o(e){e.model.is2d()&&e.model.selector&&e.model.selector.update2DSelectionHighlighting()}this.highlightDisabled=!1,this.highlightPaused=!1,this.selectionDisabled=!1,this.addModel=function(i){-1==t.indexOf(i)&&(i.selector=new VS(e,i),t.push(i))},this.removeModel=function(e){var i=t.indexOf(e);e.selector.getSelection();e.selector.clearSelection(),e.selector=null,t.splice(i,1)},this.hasSelection=function(){for(var e=0;e<t.length;e++)if(t[e].selector.hasSelection())return!0;return!1},this.getSelectionLength=function(){for(var e=0,i=0;i<t.length;i++)e+=t[i].selector.getSelectionLength();return e},this.getSelection=function(){return i(),t.length>1&&rt.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),t[0]?t[0].selector.getSelection():[]},this.getAggregateSelection=function(){for(var e=[],i=0;i<t.length;i++){var n=t[i].selector.getSelection();n&&n.length&&e.push({model:t[i],selection:n})}return e},this.clearSelection=function(e){let i;for(var r=0;r<t.length;r++)t[r].selector.clearSelection(e)&&(i=!0);!e&&i&&n()},this.toggleSelection=function(e,r,o){this.selectionDisabled||(r||(i(),r=t[0]),r.selector.toggleSelection(e,o),n())},this.setSelectionMode=function(e){for(var i=0;i<t.length;i++)t[i].selector.setSelectionMode(e)},this.isNodeSelectionLocked=function(e,n){return n||(i(),n=t[0]),n&&n.selector.isNodeSelectionLocked(e)},this.lockSelection=function(e,n,r){r||(i(),r=t[0]),r&&r.selector.lockSelection(e,n)},this.unlockSelection=function(e,n){e||n?(n||(i(),n=t[0]),e=e||n.selector.lockedNodes.slice(),this.lockSelection(e,!1,n)):t.forEach((e=>{const t=e.selector.lockedNodes.slice();this.lockSelection(t,!1,e)}))},this.setSelection=function(e,r,o,s){if(!this.selectionDisabled){if(e&&0!==e.length){if(r)for(var a=0;a<t.length;a++)t[a]!==r&&t[a].selector.clearSelection();else i(),r=t[0];r.selector.setSelection(e,o)}else this.clearSelection(!0);n(s)}},this.setAggregateSelection=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.selectionDisabled){if(e&&0!==e.length)for(var i=0;i<e.length;++i){var r=e[i].model,o=e[i].ids,s=e[i].selectionType;r.selector.setSelection(o,s)}else this.clearSelection(!0);t&&n()}},this.getSelectionBounds=function(){if(1==t.length)return t[0].selector.getSelectionBounds();for(var e=new(v().Box3),i=0;i<t.length;i++){var n=t[i].selector.getSelectionBounds();e.union(n)}return e},this.getSelectionVisibility=function(){for(var e={hasVisible:!1,hasHidden:!1,details:[]},i=0;i<t.length;i++){var n=t[i].selector.getSelectionVisibility();e.hasVisible=e.hasVisible||n.hasVisible,e.hasHidden=e.hasHidden||n.hasHidden,e.details.push(n)}return e},this.dtor=function(){for(var e=0;e<t.length;e++)t[e].selector.dtor()},e.api.addEventListener(mr,(function(e){r()})),e.api.addEventListener(vr,(function(e){r()})),e.api.addEventListener(Wn,o),e.api.addEventListener(qn,o),e.api.addEventListener(Kn,o)}class zS{viewerImpl;model;hiddenNodes=new Set;isolatedNodes=new Set;constructor(e,t){this.viewerImpl=e,this.model=t}getInstanceTree(){return this.model?this.model.getInstanceTree():null}getIsolatedNodes(){return Array.from(this.isolatedNodes)}getHiddenNodes(){return Array.from(this.hiddenNodes)}setAllVisibility(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.isolatedNodes.clear(),this.hiddenNodes.clear();const n=i||(this.model?this.model.getRootId():null);n?(this.model.is2d()&&this.model.setAllVisibility(e),this.setVisibilityOnNode(n,e,!1,!0,t)):(this.model.setAllVisibility(e),this.updateNodeVisibilityTracking(re,e,t),this.viewerImpl.sceneUpdated(!0,!1))}isNodeVisible(e){const t=this.getInstanceTree();return t?!t.isNodeHidden(e):!this.hiddenNodes.has(e)&&(this.isolatedNodes.size?this.isolatedNodes.has(e):!this.hiddenNodes.has(re))}isolate(e){const t=Array.isArray(e)?e:[e],i=t.find((e=>this.#Pa(e)));if(e)if(i){this.setAllVisibility(!0,!0,i);const e=t.filter((e=>!this.#Pa(e)));for(const t of e)this.updateNodeVisibilityTracking(t,!0,!0)}else this.isolateMultiple(t);else this.setAllVisibility(!0,!1)}isolateNone(){this.setAllVisibility(!0)}isolateMultiple(e){if(e&&0!=e.length){this.setAllVisibility(!1);const t=e.length-1;for(let i=0;i<e.length;i++)this.setVisibilityOnNode(e[i],!0,i!==t,!0,!0)}else this.setAllVisibility(!0)}hide(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Array.isArray(e)?e:[e];if(!n.length)return;const r=n.length-1;for(let e=0;e<n.length;++e)this.setVisibilityOnNode(n[e],!1,e!==r,!0,i);t&&this.viewerImpl.api.dispatchEvent({type:vr,nodeIdArray:n,model:this.model})}show(e){const t=Array.isArray(e)?e:[e];if(!t.length)return;const i=t.length-1;for(let e=0;e<t.length;++e)this.setVisibilityOnNode(t[e],!0,e!==i);this.viewerImpl.api.dispatchEvent({type:br,nodeIdArray:t,model:this.model})}toggleVisibility(e){this.isNodeVisible(e)?this.hide(e):this.show(e)}setVisibilityOnNode(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=this.model.getFragmentList(),s=this.getInstanceTree(),a=!!this.isolatedNodes.size;s?s.enumNodeChildren(e,(i=>{const n=s.isNodeVisibleLocked(i);if(!t&&r&&this.isolatedNodes.has(i))return!0;if(s.setNodeHidden(i,!t&&!n),this.model.is2d()){const e=this.model.reverseMapDbIdFor2D(i);null==o||o.setObject2DGhosted(e,!t&&!n)}else s.enumNodeFragments(i,(e=>{this.model.setVisibility(e,t||n)}),!1);this.#La(e,i)}),n):this.model.is2d()?this.model.isLeaflet()?this.model.setVisibility(null,t):null==o||o.setObject2DGhosted(e,!t):this.model.setVisibility(e,t),this.updateNodeVisibilityTracking(e,t,r||a),this.viewerImpl.sceneUpdated(!0,!1,i)}updateNodeVisibilityTracking(e,t,i){if(this.#Pa(e))return this.hiddenNodes.clear(),this.isolatedNodes.clear(),void(t?i&&this.isolatedNodes.add(e):this.hiddenNodes.add(e));t?this.hiddenNodes.has(e)?(this.hiddenNodes.delete(e),i&&this.isolatedNodes.add(e)):this.isAllHidden()?(this.hiddenNodes.clear(),this.isolatedNodes.add(e)):i&&this.isolatedNodes.add(e):this.isolatedNodes.size?this.isolatedNodes.has(e)?(this.isolatedNodes.delete(e),this.isolatedNodes.size||(this.hiddenNodes.clear(),this.hiddenNodes.add(this.model.getRootId()||re))):this.hiddenNodes.add(e):this.isAllHidden()||this.hiddenNodes.add(e)}isAllHidden(){return!this.isolatedNodes.size&&this.hiddenNodes.has(this.model.getRootId()||re)}toggleVisibleLocked(e){const t=this.getInstanceTree();t&&this.lockNodeVisible(e,!t.isNodeVisibleLocked(e))}lockNodeVisible(e,t){const i=this.getInstanceTree();if(!i)return;const n=!!this.isolatedNodes.size,r=e=>{i.enumNodeChildren(e,(n=>{if(i.lockNodeVisible(n,t),t){if(i.setNodeHidden(n,!1),this.model.is2d()){const e=this.model.reverseMapDbIdFor2D(n);this.model.getFragmentList().setObject2DGhosted(e,!1)}else i.enumNodeFragments(n,(e=>{this.model.setVisibility(e,!0)}),!1);this.#La(e,n)}}),!0),t&&(this.updateNodeVisibilityTracking(e,t,n),this.viewerImpl.sceneUpdated(!0))};Array.isArray(e)?e.forEach((e=>r(e))):r(e)}isNodeVisibleLocked(e){const t=this.getInstanceTree();return null==t?void 0:t.isNodeVisibleLocked(e)}setNodeOff(e,t,i,n){const r=this.getInstanceTree(),o=this.model.getFragmentList();if(!r){if(!o)return;return this.model.is2d()?o.setObject2DVisible(e,!t):o.setFragOff(e,t),void this.viewerImpl.sceneUpdated(!0)}if(i&&n)if(this.model.is2d())for(const e of i){r.setNodeOff(e,t);const i=this.model.reverseMapDbIdFor2D(e);null==o||o.setObject2DVisible(i,!t)}else{for(const e of i)r.setNodeOff(e,t);for(const e of n)null==o||o.setFragOff(e,t)}else r.enumNodeChildren(e,(e=>{if(r.setNodeOff(e,t),this.model.is2d()){const i=this.model.reverseMapDbIdFor2D(e);null==o||o.setObject2DVisible(i,!t)}else r.enumNodeFragments(e,(e=>{null==o||o.setFragOff(e,t)}),!1)}),!0);this.viewerImpl.sceneUpdated(!0)}#Pa(e){const t=this.model.getRootId()||re;if("number"==typeof e)return e===t;"object"==typeof e&&(null==e||e.dbId)}#La(e,t){e!==t&&(this.isolatedNodes.delete(t),this.hiddenNodes.delete(t))}}class HS{viewerImpl;models=[];constructor(e){this.viewerImpl=e}addModel(e){-1===this.models.indexOf(e)&&(e.visibilityManager=new zS(this.viewerImpl,e),this.models.push(e))}removeModel(e){const t=this.models.indexOf(e);-1!==t&&(e.visibilityManager.setAllVisibility(!0),e.visibilityManager=null,this.models.splice(t,1))}warn(){this.models.length>1&&rt.warn("This selection call does not yet support multiple models.")}getAggregateIsolatedNodes(){const e=[];for(const t of this.models){const i=t.visibilityManager.getIsolatedNodes();i.length&&e.push({model:t,ids:i})}return e}getIsolatedNodes(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getIsolatedNodes()}getAggregateHiddenNodes(){const e=[];for(const t of this.models){const i=t.visibilityManager.getHiddenNodes();i.length&&e.push({model:t,ids:i})}return e}getHiddenNodes(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getHiddenNodes()}isNodeVisible(e,t){return e||(this.warn(),e=this.models[0]),e.visibilityManager.isNodeVisible(t)}isolate(e,t){t||(this.warn(),t=this.models[0]),this.aggregateIsolate([{model:t,ids:e}],{hideLoadedModels:!1})}aggregateIsolate(e,t){if(e&&0!==e.length){const i=(null==t?void 0:t.hideLoadedModels)??!0;for(const t of this.models){const n=e.find((e=>e.model==t));if(n){const e=n.ids||n.selection;t.visibilityManager.isolate(e)}else i&&t.visibilityManager.setAllVisibility(!1)}}else for(const e of this.models)e.visibilityManager.setAllVisibility(!0);this.#Ra()}hide(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.hide(e)}aggregateHide(e){if(!e||0===e.length)return;for(const t of e){const e=t.model,i=t.ids||t.selection;e.visibilityManager.hide(i,1===this.models.length)}const t=this.getAggregateHiddenNodes();this.viewerImpl.api.dispatchEvent({type:yr,hidden:t})}aggregateRestore(e){if(!e||0===e.length)return;for(const t of this.models){const i=e.find((e=>e.model===t));if(!i)continue;const{isolatedIds:n,hiddenIds:r}=i;t.visibilityManager.isolate(n),t.visibilityManager.hide(r,1===this.models.length,!0)}this.#Ra();const t=this.getAggregateHiddenNodes();this.viewerImpl.api.dispatchEvent({type:yr,hidden:t})}show(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.show(e)}toggleVisibility(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibility(e)}setVisibilityOnNode(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];i||(this.warn(),i=this.models[0]),i.visibilityManager.setVisibilityOnNode(e,t,n,r)}toggleVisibleLocked(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibleLocked(e)}lockNodeVisible(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.lockNodeVisible(e,t)}isNodeVisibleLocked(e,t){return t||(this.warn(),t=this.models[0]),t.visibilityManager.isNodeVisibleLocked(e,t)}setNodeOff(e,t,i,n,r){i||(this.warn(),i=this.models[0]),i.visibilityManager.setNodeOff(e,t,n,r)}#Ra(){const e=this.getAggregateIsolatedNodes();1===this.models.length&&this.viewerImpl.api.dispatchEvent({type:mr,nodeIdArray:e.length?e[0].ids:[],model:this.models[0]}),this.viewerImpl.api.dispatchEvent({type:gr,isolation:e})}}var WS=r(67312),jS=r.n(WS),qS=r(2647),KS=r.n(qS),XS=r(63694),YS=r.n(XS),QS=r(12065),ZS=r.n(QS),$S=r(17797),JS=r.n($S);class eA{needsClear(e,t){if(e.length!==t.length)return!0;for(let i=0;i<e.length;i++)if(e[i]!=t[i])return!0}}const tA=2;var iA={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:jS(),fragmentShader:KS()},nA={uniforms:{tDepth:{type:"t",value:null},worldSize:{type:"v3",value:new(v().Vector3)(1,1,1)}},defines:{},vertexShader:cb(),fragmentShader:YS()},rA={uniforms:{tDepth:{type:"t",value:null}},defines:{},vertexShader:cb(),fragmentShader:ZS()},oA={uniforms:{tDepth:{type:"t",value:null},uShadowColor:{type:"v4",value:new(v().Vector4)(0,0,0,1)}},vertexShader:cb(),fragmentShader:JS()};let sA,aA,lA,cA=new yc;function uA(e){var t=new(v().PlaneBufferGeometry)(1,1);return t.index.array.reverse(),new(v().Mesh)(t,e)}function hA(e,t,i,n,r){sA||(sA=new(v().Matrix4)),aA||(aA=new(v().Vector3)),lA||(lA=new(v().Vector3)),aA.subVectors(t,n),sA.lookAt(aA,t,r),lA.copy(n).multiplyScalar(-.5*i.y).add(t),e.position.copy(lA),e.rotation.setFromRotationMatrix(sA),e.scale.set(i.z,i.x,i.y)}function dA(e,t){var i,n=e;const r=new ac;var o,s,a,l,c,u,h,d,f,p,m,g,y,b,x=!1,_=!0,E=cS.GROUND_FINISHED,S={texSize:64,pixScale:1,blurRadius:7,debug:!1};this.setTransform=(m=new(v().Vector3)(0,0,0),g=new(v().Vector3)(0,0,0),y=new(v().Vector3)(0,0,0),b=new(v().Vector3)(0,0,0),function(e,t,n,o){e.equals(m)&&t.equals(g)&&n.equals(y)&&o.equals(b)||(m.copy(e),g.copy(t),y.copy(n),b.copy(o),this.setDirty(),i.left=-t.z/2,i.right=t.z/2,i.top=t.x/2,i.bottom=-t.x/2,i.near=1,i.far=t.y+i.near,i.updateProjectionMatrix(),hA(s,e,t,n,o),i.position.addVectors(e,n.clone().multiplyScalar(-t.y/2-i.near)),o&&i.up.set(o.x,o.y,o.z),i.lookAt(e),S.debug&&(p.position.set(e.x,e.y,e.z),p.rotation.set(i.rotation.x,i.rotation.y,i.rotation.z),p.scale.set(t.z,t.x,t.y)),f.uniforms.worldSize.value.copy(t),i.orthoScale=t.x,i.clientHeight=S.texSize,r.reset(i),r.areaCullThreshold=tA)}),this.renderIntoShadow=function(e){if(!e.overrideMaterial||!e.overrideMaterial.transparent){e.forEachNoMesh&&(Zi||rn)&&(e.forEachNoMesh((t=>{e.frags.getWorldBounds(t,cA);const i=e.frags.vizflags[t]&ll.MESH_VISIBLE,n=r.estimateProjectedDiameter(cA)<r.areaCullThreshold;e.frags.setFlagFragment(t,ll.MESH_RENDERFLAG,i&&!n)})),e.forceVisible=!1);var t=e.overrideMaterial;e.overrideMaterial=c,n.setRenderTarget(a),n.render(e,i),e.overrideMaterial=t}};var A,w,C,T,M=[];if(this.prepareGroundShadow=(w=0,C=0,T=0,function(e,t,i,n){if(!this.enabled||e.isEmpty())return E=cS.GROUND_FINISHED,i;const o=e.getGeomScenesPerModel();if(_=this.needsClear(M,o)||_)this.clear(),_=!1,M=o,A=e.getGeomScenes(),w=A.length,C=0,T=t?Math.max(Math.ceil(w/100),t):w;else{if(E===cS.GROUND_RENDERED||E===cS.GROUND_FINISHED)return E=cS.GROUND_FINISHED,i;0===t&&(T=w)}var s,a,l;i&&(s=performance.now(),a=(n=void 0===n?1:n)*i);for(var c=0;c<T&&C<w;){var u=A[C++];if(u&&(!((Zi||rn)&&u.getBoundingBox&&r.estimateProjectedDiameter(u.getBoundingBox())<r.areaCullThreshold)&&(c++,u.forceVisible=!0,this.renderIntoShadow(u),u.forceVisible=!1,i))){var h=performance.now()-s;if(a<h){E=cS.GROUND_UNFINISHED,l=i-h;break}}}return C<w&&(E=cS.GROUND_UNFINISHED,l=i?i-performance.now()+s:1),void 0!==l?l:(this.postprocess(),E=cS.GROUND_RENDERED,i?i-performance.now()+s:1)}),this.resetScenesPerModel=function(){M=[],A=void 0,this.setDirty()},this.renderShadow=function(e,t){x&&(t&&n.setRenderTarget(t),n.render(o,e))},this.postprocess=function(){d.render(n,l,a),h.render(n,a,l),x=!0},this.clear=function(){var e=n.getClearColor(new(v().Color)).getHex(),t=n.getClearAlpha();n.setClearColor(0,0),n.setRenderTarget(a),n.clear(!0,!0,!1),n.setClearColor(e,t),n.clearBlend(),x=!1},this.setColor=function(e){u.uniforms.uShadowColor.value.x=e.r,u.uniforms.uShadowColor.value.y=e.g,u.uniforms.uShadowColor.value.z=e.b},this.getColor=function(){return new(v().Color)(u.uniforms.uShadowColor.value.x,u.uniforms.uShadowColor.value.y,u.uniforms.uShadowColor.value.z)},this.setAlpha=function(e){u.uniforms.uShadowColor.value.w=e},this.getAlpha=function(){return u.uniforms.uShadowColor.value.w},this.isValid=function(){return x},this.getStatus=function(){return E},this.setDirty=function(){_=!0,E=cS.GROUND_UNFINISHED},this.getDepthMaterial=function(){return c},t)for(var I in S)S[I]=t[I]||S[I];o=new(v().Scene),i=new(v().OrthographicCamera),(a=new(v().WebGLRenderTarget)(S.texSize,S.texSize,{minFilter:v().LinearFilter,magFilter:v().LinearFilter,format:v().RGBAFormat,stencilBuffer:!1})).texture.generateMipmaps=!1,a.name="GroundShadow targetH",(l=new(v().WebGLRenderTarget)(S.texSize,S.texSize,{minFilter:v().LinearFilter,magFilter:v().LinearFilter,format:v().RGBAFormat,stencilBuffer:!1})).texture.generateMipmaps=!1,l.name="GroundShadow targetV",(c=Lb(iA)).type="GroundDepthShader",c.side=v().DoubleSide,c.blending=v().NoBlending,h=new rx(rA,"tDepth"),d=new rx(rA,"tDepth"),f=new rx(nA,"tDepth"),h.material.defines.KERNEL_SCALE=d.material.defines.KERNEL_SCALE=(S.pixScale/S.texSize).toFixed(4),h.material.defines.KERNEL_RADIUS=d.material.defines.KERNEL_RADIUS=S.blurRadius.toFixed(2),f.material.blending=h.material.blending=d.material.blending=v().NoBlending,f.material.depthWrite=h.material.depthWrite=d.material.depthWrite=!1,f.material.depthTest=h.material.depthTest=d.material.depthTest=!1,h.material.defines.HORIZONTAL=1,(u=Lb(oA)).uniforms.tDepth.value=a.texture,u.depthWrite=!1,u.transparent=!0,s=uA(u),o.add(s),S.debug&&(p=new(v().Mesh)(new(v().BoxGeometry)(1,1,1),new(v().MeshBasicMaterial)({color:65280,wireframe:!0})),o.add(p)),this.setTransform(new(v().Vector3)(0,0,0),new(v().Vector3)(1,1,1),new(v().Vector3)(0,1,0),v().Object3D.DefaultUp)}dA.prototype=Object.create(eA.prototype),dA.prototype.constructor=dA;class fA{constructor(){this.webglContextId=1}onContextRestored(){this.webglContextId++}refreshTargetIfNeeded(e){this.refreshIfNeeded(e);const t=null==e?void 0:e.shareDepthFrom;this.refreshIfNeeded(t)}refreshTargetsIfNeeded(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.refreshTargetIfNeeded(e[t]);else this.refreshTargetIfNeeded(e)}refreshIfNeeded(e){if(!e||e.__webglContextId===this.webglContextId)return!1;this._refreshGlData(e),e.__webglContextId=this.webglContextId}_refreshGlData(e){e instanceof THREE.Mesh&&this._refreshMeshGlData(e),e instanceof THREE.BufferGeometry&&this._refreshBufferGeometryGlData(e),e instanceof THREE.WebGLRenderTarget&&this._refreshTargetGlData(e),e instanceof THREE.Texture&&this._refreshTextureGlData(e),e instanceof THREE.Material&&this._refreshMaterialGlData(e)}_refreshMeshGlData(e){var t;e.__webglActive&&(e.__webglActive=void 0),null!==(t=e.geometry)&&void 0!==t&&t.__webglInit&&(e.geometry.__webglInit=void 0)}_refreshBufferGeometryGlData(e){e.__webglInit&&(e.__webglInit=void 0,e.needsUpdate=!0),e.vbbuffer&&(e.vbbuffer=void 0,e.needsUpdate=!0),e.ibbuffer&&(e.ibbuffer=void 0,e.needsUpdate=!0),e.iblinesbuffer&&(e.iblinesbuffer=void 0,e.needsUpdate=!0),e.vaos&&(e.vaos=void 0,e.needsUpdate=!0),e.streamingDraw===Ug&&(e.streamingDraw=!1,e.streamingDrawIndex=!1);for(let t in e.attributes){const i=e.attributes[t];i.buffer&&(i.buffer=void 0,e.needsUpdate=!0)}}_refreshTargetGlData(e){e.__webglFramebuffer&&(e.__webglFramebuffer=null),e.__webglRenderbuffer&&(e.__webglRenderbuffer=null),e.__webglBoundBuffers&&(e.__webglBoundBuffers=null),e.__webglTexture&&(e.__webglTexture=null)}_refreshTextureGlData(e){e.__webglInit&&(e.__webglInit=void 0,e.needsUpdate=!0),e.__webglTexture&&(e.__webglTexture=void 0,e.needsUpdate=!0),e.__webglTextureCube&&(e.__webglTextureCube=null,e.needsUpdate=!0)}_refreshMaterialGlData(e){(e.program||e.programs)&&(e.program=null,e.programs=[],e.needsUpdate=!0)}}const pA=e=>{if(Ji)return void km.resetAfterContextLoss();const t={};return e.getAllModels().forEach((e=>{e.isConsolidated()&&(e.unconsolidate(),t[e.id]=!0)})),t},mA=async(e,t)=>{if(!Ji)for(const i of e.getAllModels())t[i.id]&&await e.impl.consolidateModel(i)};function gA(e){var t=e+"_texMatrix",i=e+"_invert",n={};return n[e]={type:"t",value:null},n[t]={type:"m3",value:new(v().Matrix3)},n[i]={type:"i",value:0},n}let vA={GetPrismMapUniforms:gA};var yA=r(8102),bA=r.n(yA),xA=r(15201),_A=r.n(xA),EA={uniforms:{tDiffuse:{type:"t",value:null},uColor:{type:"v4",value:new(v().Vector4)(1,1,1,1)}},vertexShader:bA(),fragmentShader:_A()};let SA=function(e,t,i,n,r){var o,s,a,l=e,c=t,u=i||3,h=n||1,d=r.hasAlpha||!1,f=r.blending||!1,p=r.flipUV||!1;this.render=function(e,t,i){o.render(e,a,i),s.render(e,t,a)},this.setSize=function(e,t){this.cleanup(),l=e,c=t,(a=new(v().WebGLRenderTarget)(e,t,{minFilter:v().LinearFilter,magFilter:v().LinearFilter,format:void 0!==r.format?r.format:v().RGBAFormat,type:void 0!==r.type?r.type:v().UnsignedByteType,stencilBuffer:!1})).texture.generateMipmaps=!1,o.material.defines.KERNEL_SCALE_H=s.material.defines.KERNEL_SCALE_H=(h/l).toFixed(4),o.material.defines.KERNEL_SCALE_V=s.material.defines.KERNEL_SCALE_V=(h/c).toFixed(4),o.material.needsUpdate=s.material.needsUpdate=!0},this.cleanup=function(){a&&a.dispose()},this.setColor=function(e){s.material.uniforms.uColor.value.x=e.r,s.material.uniforms.uColor.value.y=e.g,s.material.uniforms.uColor.value.z=e.b},this.setAlpha=function(e){s.material.uniforms.uColor.value.w=e},o=new rx(EA),s=new rx(EA),this.setSize(e,t),o.material.blending=s.material.blending=v().NoBlending,o.material.depthWrite=s.material.depthWrite=!1,o.material.depthTest=s.material.depthTest=!1,o.material.defines.HORIZONTAL=1,o.material.defines.KERNEL_RADIUS=s.material.defines.KERNEL_RADIUS=u.toFixed(1),f&&(s.material.transparent=!0,s.material.blending=v().NormalBlending),d&&(o.material.defines.HAS_ALPHA=s.material.defines.HAS_ALPHA=""),p&&(o.material.defines.FLIP_UV="")};var AA=r(9063),wA=r.n(AA),CA=r(32968),TA=r.n(CA),MA=r(54707),IA=r.n(MA),PA=r(77500),LA=r.n(PA);let RA=function(e,t,i){var n="uv_"+e+"_map",r="";return t&&i?r="if ("+n+".x < 0.0 || "+n+".x > 1.0 || "+n+".y < 0.0 || "+n+".y > 1.0) { discard; }":t?r="if ("+n+".x < 0.0 || "+n+".x > 1.0) { discard; }":i&&(r="if ("+n+".y < 0.0 || "+n+".y > 1.0) { discard; }"),"#define "+e.toUpperCase()+"_CLAMP_TEST "+r},DA={uniforms:v().UniformsUtils.merge([Zd.ShadowMapCommonUniforms,{shadowMapRangeMin:{type:"f",value:0},shadowMapRangeSize:{type:"f",value:0},shadowMinOpacity:{type:"f",value:0},map:{type:"t",value:null},alphaMap:{type:"t",value:null},texMatrix:{type:"m3",value:new(v().Matrix3)},texMatrixAlpha:{type:"m3",value:new(v().Matrix3)}},gA("surface_cutout_map")]),vertexShader:wA(),fragmentShader:TA()},OA={uniforms:Zd.ShadowMapUniforms,vertexShader:IA(),fragmentShader:LA()};function BA(){var e=[],t=Lb(DA),i=new(v().Material);i.visible=!1;var n=[];var r=new function(){this.init=function(){this.isPrism=!1,this.alphaMap=!1,this.alphaClampS=!1,this.alphaClampT=!1,this.alphaInvert=!1,this.rgbaMap=!1,this.rgbaClampS=!1,this.rgbaClampT=!1,this.rgbaInvert=!1,this.instanced=!1,this.decalIndex=-1},this.init(),this.getMaterialIndex=function(){return(this.isPrism?1:0)|(this.alphaMap?2:0)|(this.alphaClampS?4:0)|(this.alphaClampT?8:0)|(this.alphaInvert?16:0)|(this.rgbaMap?32:0)|(this.rgbaClampS?64:0)|(this.rgbaClampT?128:0)|(this.rgbaInvert?256:0)|(this.instanced?512:0)|1024*(this.decalIndex+1)}};function o(n,o){if((s=n)instanceof v().MeshPhongMaterial?s.opacity<NA.ShadowMinOpacity:s.isPrismMaterial?"PrismTransparent"===s.prismType||"PrismGlazing"===s.prismType:!s.visible)return i;var s,a=n instanceof v().MeshPhongMaterial,l=n.isPrismMaterial;if(!a&&!l)return null;var c=a?n.alphaMap:n.surface_cutout_map,u=a&&n.alphaTest?n.map:null;if(!c&&!u&&!n.useInstancing)return null;var h=r;h.init(),h.isPrism=l,h.alphaMap=!!c,h.rgbaMap=!!u,h.instanced=n.useInstancing,h.decalIndex=void 0===o?-1:o,c&&(h.alphaClampS=c.clampS,h.alphaClampT=c.clampT,h.alphaInvert=c.invert),u&&(h.rgbaClampS=u.clampS,h.rgbaClampT=u.clampT,h.rgbaInvert=u.invert);var d=function(i,n){var r=i.getMaterialIndex();if(!e[r]){var o=t.clone();i.isPrism&&i.alphaMap&&(Rb(o,"USE_SURFACE_CUTOUT_MAP"),o.fragmentShader=RA("surface_cutout",i.alphaClampS,i.alphaClampT)+"\n"+o.fragmentShader),i.instanced&&(o.useInstancing=!0),e[r]=o}return e[r]}(h);return c&&(a?(d.uniforms.alphaMap.value=c,d.uniforms.texMatrixAlpha.value=c.matrix,d.alphaMap=c,d.side=n.side):(d.uniforms.surface_cutout_map.value=c,d.uniforms.surface_cutout_map_texMatrix.value.copy(c.matrix),d.uniforms.surface_cutout_map_invert.value=c.invert,d.side=v().DoubleSide)),u&&(d.uniforms.map.value=u,d.uniforms.texMatrix.value=u.matrix,d.map=u),d}this.forEachMaterial=function(i){for(var n=0;n<e.length;n++){var r=e[n];r&&i(r)}i(t)},this.getCustomOverrideMaterial=function(e){var t=o(e);if(!t)return null;if(!e.decals)return t.decals=null,t;if(e.decals){n.length=0;for(var i=0;i<e.decals.length;i++){var r=e.decals[i],s=o(r.material,i);if(!s)return null;n.push({uv:r.uv,material:s})}}return t.decals=n,t},this.dispose=function(){this.forEachMaterial((function(e){e.dispose()}))}}const NA={ShadowMapSize:1024,ShadowESMConstant:80,ShadowBias:.001,ShadowDarkness:.7,ShadowMapBlurRadius:4,ShadowMinOpacity:.9,UseHardShadows:!1,BlurShadowMap:!0},UA=0,kA=1,FA=2;function VA(){this.shadowMap=void 0,this.shadowMapSize=void 0,this.shadowMatrix=void 0,this.shadowLightDir=void 0,this.init=function(e){this.shadowMap=e,this.shadowMapSize=new(v().Vector2)(e.width,e.height),this.shadowMatrix=new(v().Matrix4),this.shadowLightDir=new(v().Vector3)},this.apply=function(e){e.shadowMap=this.shadowMap,e.shadowMatrix=this.shadowMatrix,e.shadowLightDir=this.shadowLightDir,this.shadowMap?(Rb(e,"USE_SHADOWMAP"),NA.UseHardShadows&&Rb(e,"USE_HARD_SHADOWS")):(Db(e,"USE_SHADOWMAP"),Db(e,"USE_HARD_SHADOWS"))}}var GA=new VA;function zA(e){var t=null,i=null,n=new(v().OrthographicCamera),r=Math.exp(NA.ShadowESMConstant),o=NA.UseHardShadows?new(v().Color)(1,1,1):new(v().Color)(r,1,1),s=e,a=null,l=null,c=null,u=Lb(DA),h=new BA;u.getCustomOverrideMaterial=h.getCustomOverrideMaterial;var d=null;function f(e,t){e.forEach((function(e){t.apply(e)}))}function p(e){var t=new(v().WebGLRenderTarget)(e,e,{minFilter:v().LinearFilter,magFilter:v().LinearFilter,format:v().RGBAFormat,type:v().FloatType,stencilBuffer:!1,generateMipmaps:!1});return t.texture.generateMipmaps=!1,t}function m(e){s.setRenderTarget(e),s.setClearColor(o,1),s.clear()}var g=function(){var e=new(v().Matrix4),t=new(v().Matrix4),i=new(v().Vector3)(0,0,0),n=new(v().Box3),r=new(v().Vector3),o=new(v().Vector3);return function(s,a,l){s.position.copy(l),s.lookAt(i),e.makeRotationFromQuaternion(s.quaternion),t.copy(e).invert(),n.copy(a).applyMatrix4(t),o=n.getCenter(o),r.set(o.x,o.y,n.max.z),r.applyMatrix4(e),s.position.copy(r),o=n.size(o),s.left=-.5*o.x,s.right=.5*o.x,s.bottom=-.5*o.y,s.top=.5*o.y,s.near=0,s.far=o.z,s.updateMatrixWorld(),s.updateProjectionMatrix()}}();function y(e){e.uniforms.shadowMapRangeMin.value=n.near,e.uniforms.shadowMapRangeSize.value=n.far-n.near,e.uniforms.shadowESMConstant.value=NA.ShadowESMConstant,e.uniforms.shadowMinOpacity.value=NA.ShadowMinOpacity}this.init=function(){(t=new VA).init(p(NA.ShadowMapSize)),i=NA.BlurShadowMap?new SA(NA.ShadowMapSize,NA.ShadowMapSize,NA.ShadowMapBlurRadius,1,{type:t.shadowMap.type,format:t.shadowMap.format}):void 0,(a=Lb(OA)).depthWrite=!1,a.transparent=!0,l=uA(a),(c=new(v().Scene)).add(l),this.groundShapeBox=new(v().Box3),m(d=p(1))},this.init(),this.state=UA,this.startUpdate=function(e,t,i,r,o){var s=e.getVisibleBounds(!0);return this.beginShadowMapUpdate(i,s,r),e.reset(n,vc.RENDER_SHADOWMAP,!0),this.state=kA,t=this.continueUpdate(e,t,o)},this.continueUpdate=function(e,i,n){return i=e.renderSome(this.renderSceneIntoShadowMap,i),e.isDone()?(this.state=FA,this.finishShadowMapUpdate(n)):function(e){var i=t.shadowMap;t.shadowMap=d,f(e,t),t.apply(a),t.shadowMap=i}(n),i},this.beginShadowMapUpdate=function(e,i,r){g(n,i,r),y(u),h.forEachMaterial(y),NA.UseHardShadows&&(Rb(u,"USE_HARD_SHADOWS"),h.forEachMaterial((function(e){Rb(e,"USE_HARD_SHADOWS")}))),m(t.shadowMap),this.renderSceneIntoShadowMap(c)},this.renderSceneIntoShadowMap=function(e){e.overrideMaterial=u,s.render(e,n,t.shadowMap),e.overrideMaterial=null},this.finishShadowMapUpdate=function(e){i&&!NA.UseHardShadows&&i.render(s,t.shadowMap,t.shadowMap),t.shadowMatrix.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),t.shadowMapRangeMin=n.near,t.shadowMapRangeSize=n.far-n.near,t.shadowLightDir.copy(n.position).normalize(),f(e,t),t.apply(a),this.isValid=!0},this.cleanup=function(e){i&&i.cleanup(),t.shadowMap&&t.shadowMap.dispose(),f(e,GA),u.dispose(),h.dispose(),a.dispose(),l.geometry.dispose()},this.setGroundShadowTransform=function(e,t,i,n){hA(l,e,t,i,n),this.groundShapeBox.setFromObject(l)},this.renderGroundShadow=function(e,t){s.render(c,e,t,!1)},this.expandByGroundShadow=function(){var e=new(v().Plane),t=new(v().Ray),i=new(v().Vector3),n=new(v().Vector3),r=new(v().Box3);return function(o,s){e.normal.set(0,1,0),e.constant=-o.min.y,t.direction.copy(s).negate().normalize();var a,l,c,u=o.getCenter(i),h=100*u.distanceToSquared(o.min)*100;r.makeEmpty();for(var d=0;d<8;d++){t.origin=(a=o,l=d,c=void 0,(c=void 0||new(v().Vector3)).x=1&l?a.max.x:a.min.x,c.y=2&l?a.max.y:a.min.y,c.z=4&l?a.max.z:a.min.z,c);var f=t.intersectPlane(e,n);f&&(f.distanceToSquared(u)>=h||r.expandByPoint(f))}o.union(r)}}(),this.getShadowParams=function(){return t},this.getShadowCamera=function(){return n}}const HA=function(){};HA.RefreshUniformsShadow=function(e,t){e.shadowMap&&(e.shadowMap.value=t.shadowMap),e.shadowMatrix&&(e.shadowMatrix.value=t.shadowMatrix),e.shadowLightDir&&(e.shadowLightDir.value=t.shadowLightDir),e.shadowESMConstant&&(e.shadowESMConstant.value=NA.ShadowESMConstant),e.shadowBias&&(e.shadowBias.value=NA.ShadowBias),e.shadowMapSize&&(e.shadowMapSize.value=NA.ShadowMapSize),e.shadowDarkness&&(e.shadowDarkness.value=NA.ShadowDarkness)};var WA=r(99885),jA=r.n(WA),qA={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:cb(),fragmentShader:jA()};let KA=function(e,t,i,n){var r,o,s,a,l,c,u=e,h=u.getContext(),d=t||512,f=i||512,p=!1,m=new(v().Color)(0,0,0),g=!1,y=!1;this.inTarget=void 0,this.outTarget=void 0;var b=!0,x=cS.GROUND_UNFINISHED,_={color:new(v().Color)(1,1,1),alpha:.3,texScale:.5,blurRadius:2,blurTexScale:.5,fadeAngle:Math.PI/18};this.setTransform=function(e,t,i){a=e,s.normal=t,s.constant=-e.dot(t)},this.cleanup=function(){r&&r.cleanup(),this.inTarget&&this.inTarget.dispose(),this.outTarget&&this.outTarget.dispose()},this.setSize=function(e,t){d=e,f=t,this.cleanup(),this.inTarget=new(v().WebGLRenderTarget)(d*_.texScale,f*_.texScale,{magFilter:v().LinearFilter,minFilter:v().LinearFilter,format:v().RGBAFormat,stencilBuffer:!1}),this.inTarget.texture.generateMipmaps=!1,this.inTarget.name="GroundReflection inTarget",this.outTarget=new(v().WebGLRenderTarget)(d*_.texScale,f*_.texScale,{magFilter:v().LinearFilter,minFilter:v().LinearFilter,format:v().RGBAFormat,stencilBuffer:!1}),this.outTarget.texture.generateMipmaps=!1,this.outTarget.name="GroundReflection outTarget",r?r.setSize(d*_.texScale*_.blurTexScale,f*_.texScale*_.blurTexScale):r=new SA(d*_.texScale*_.blurTexScale,f*_.texScale*_.blurTexScale,_.blurRadius,1,{hasAlpha:!0,blending:!0,flipUV:!0})},this.updateCamera=function(e){var t;t=e.isPerspective?a.clone():e.target.clone();var i=e.position.clone().sub(t).normalize(),n=Math.PI/2-i.angleTo(s.normal);if(!(p=n<0)){if(_.fadeAngle>0){var o=Math.min(_.fadeAngle,n)/_.fadeAngle;r.setAlpha(o*_.alpha)}var c=function(e){var t=e.normal,i=e.constant;return(new(v().Matrix4)).set(1-2*t.x*t.x,-2*t.y*t.x,-2*t.x*t.z,-2*i*t.x,-2*t.x*t.y,1-2*t.y*t.y,-2*t.y*t.z,-2*i*t.y,-2*t.x*t.z,-2*t.y*t.z,1-2*t.z*t.z,-2*i*t.z,0,0,0,1)}(s);(l=e.clone()).applyMatrix4(c),l.projectionMatrix.elements[5]*=-1,l.matrixWorldNeedsUpdate=!0,e.worldUpTransform?l.worldUpTransform=e.worldUpTransform.clone():l.worldUpTransform=new(v().Matrix4)}},this.renderIntoReflection=function(e){p||(u.setRenderTarget(this.inTarget),u.render(e,l))};var E,S,A,w,C=[];if(this.resetScenesPerModel=function(){C=[],E=void 0,this.setDirty()},this.prepareGroundReflection=(S=0,A=0,w=0,function(e,t,i,n,r,o){var s=t.modelQueue();if(x!==cS.GROUND_UNFINISHED||s.isEmpty())return x=cS.GROUND_FINISHED,r;const a=s.getGeomScenesPerModel();if(b=this.needsClear(C,a)||b){if(b=!1,this.updateCamera(t.camera),this.isGroundCulled())return x=cS.GROUND_FINISHED,r;this.clear(),C=a,E=s.getGeomScenes(),S=E.length,A=0,w=n?Math.max(Math.ceil(S/100),n):S,x=cS.GROUND_UNFINISHED}else{if(x!==cS.GROUND_UNFINISHED)return x=cS.GROUND_FINISHED,r;0===n&&(w=S)}var l,c,u;r&&(l=performance.now(),c=(o=void 0===o?1:o)*r);for(var h=0;h<w&&A<S;){var d=E[A++];if(d&&(h++,d.forceVisible=!0,this.renderIntoReflection(d),d.forceVisible=!1,r)){var f=performance.now()-l;if(c<f&&A<S){x=cS.GROUND_UNFINISHED,u=r-f;break}}}return A<S&&(x=cS.GROUND_UNFINISHED,u=r?r-performance.now()+l:1),void 0===u||i?(this.postprocess(t.camera,t.matman()),e&&e.enabled&&t.renderGroundShadow(this.outTarget),this.renderReflection(t.camera,t.renderer().getColorTarget()),void 0===u&&(x=cS.GROUND_RENDERED),r?r-performance.now()+l:1):u}),this.renderReflection=function(e,t){p||(h.depthRange(1-2*Tn,1-Tn),o.render(u,t,this.outTarget),h.depthRange(0,1))},this.toggleEnvMapBackground=function(e){y=e,c.uniforms.envMapBackground.value=e},this.postprocess=function(e){if(!p){if(g||y){const t=c.uniforms.uCamDir.value||new(v().Vector3);c.uniforms.uCamDir.value=e.worldUpTransform?e.getWorldDirection(t).applyMatrix4(e.worldUpTransform):e.getWorldDirection(t),c.uniforms.uCamUp.value=e.worldUpTransform?e.up.clone().applyMatrix4(e.worldUpTransform):e.up,c.uniforms.uResolution.value.set(d,f),c.uniforms.uHalfFovTan.value=Math.tan(v().Math.degToRad(.5*e.fov)),c.render(u,this.outTarget),u.setRenderTarget(this.outTarget),u.clear(!1,!0,!1)}else u.setClearColor(m,1),u.setRenderTarget(this.outTarget),u.clear(!0,!0,!1);r.render(u,this.outTarget,this.inTarget)}},this.clear=function(){u.setClearColor(m,0),u.setRenderTarget(this.inTarget),u.clear(!0,!0,!1),u.clearBlend()},this.setClearColors=function(e,t,i){t?(m.setRGB(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)),g=!e.equals(t)&&!i):(m.copy(e),g=!1),g&&(c.uniforms.color1.value.copy(e),c.uniforms.color2.value.copy(t))},this.setEnvRotation=function(e){c.material.envRotationSin=Math.sin(e),c.material.envRotationCos=Math.cos(e)},this.isGroundCulled=function(){return p},this.getStatus=function(){return x},this.setDirty=function(){b=!0,x=cS.GROUND_UNFINISHED},this.setColor=function(e){r.setColor(_.color),_.color.set(e)},this.setAlpha=function(e){r.setAlpha(_.alpha),_.alpha=e},n)for(var T in _)_[T]=void 0!==n[T]?n[T]:_[T];(o=new rx(qA)).material.blending=v().NoBlending,o.material.depthTest=!0,o.material.depthWrite=!1,o.scene.position.z=-(1-2*Tn),n.clearPass?c=n.clearPass:((c=new rx(ab)).material.blending=v().NoBlending,c.material.depthWrite=!1,c.material.depthTest=!1),this.setSize(d,f),r.setAlpha(_.color),r.setAlpha(_.alpha),s=new(v().Plane)(new(v().Vector3)(0,1,0),0),a=new(v().Vector3)(0,0,0)};KA.prototype=Object.create(eA.prototype),KA.prototype.constructor=KA;var XA={name:"root",id:"root",isLayer:!1,children:[],childCount:0};function YA(e){this.viewer=e,this.matman=e.matman(),this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[]}var QA=YA.prototype;function ZA(e,t){var i=e.model,n=e.indexToLayer;if(i.is2d()){if(!i.getData().layerCount)return;var r=[];for(var o in e.layerToIndex)r.push(e.layerToIndex[o]);e.matman.setLayerVisible(r,t,i.id),e.viewer.invalidate(!0)}else{var s=[],a=t?e.viewer.visibilityManager.show:e.viewer.visibilityManager.hide;$A(e,(function(e,r){n[r].visible!==t&&(s.push(e),1024===s.length&&(a(s,i),s.length=0))})),s.length>0&&a(s,i)}for(var l=n.length,c=1;c<l;++c){var u=n[c];u&&(u.visible=t)}}function $A(e,t){var i=e.nodeToLayer;if(i&&i.length){var n=e.model.getData().instanceTree.nodeAccess;for(var r in n.dbIdToIndex){var o=i[n.dbIdToIndex[r]]||0;0!==o&&t(0|r,o)}}}function JA(e,t){return"number"==typeof t?t:e.layerToIndex[t.name||t]||0}function ew(e){return!e.layer.isLayer}function tw(e,t){for(var i=0;i<e.length;++i){var n=e[i];t(n),n.children&&tw(n.children,t)}}function iw(e){this.bounds=e,this.point=new(v().Vector4),this.point.z=0,this.point.w=1}QA.addModel=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.initialized&&(e.is2d()||!t)){var i=function(t){if(this.model&&t){var i=this.model.getData().instanceTree;t.children=t.children||[];var n=function(e){if(!e)return[];var t=[],i=0;tw(e,(e=>{t.push(e),e.isLayer&&(i=Math.max(i,0|e.index))}));for(var n=0;n<t.length;++n)t[n].isLayer||(t[n].index=++i);return t}(t.children);t.childCount=n.length,this.indexToLayer=new Array(t.childCount+1),this.indexToLayer[0]=null;for(var r=0;r<t.childCount;++r){var o=n[r],s=null==o.visible||o.visible;this.layerToIndex[o.name]=o.index,this.indexToLayer[o.index]={layer:o,visible:s}}if(!this.model.is2d()&&0!==t.childCount){this.nodeToLayer=t.childCount<=256?new Uint8Array(i.nodeAccess.getNumNodes()):new Uint16Array(i.nodeAccess.getNumNodes());var a=function(e){if(this.model){var t=this.model.getData().instanceTree;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i))for(var n=this.layerToIndex[i],r=e[i],o=0,s=r.length;o<s;++o){var a=t.nodeAccess.getIndex(r[o]);this.nodeToLayer[a]=n}}}.bind(this),l=function(){rt.warn("ModelLayers error: coudn't get layers from property database.")}.bind(this);e.getLayerToNodeIdMapping(a,l)}}}.bind(this),n=function(t){var i;this.root=t,this.initialized=!0;!this.activateLayerState("Initial")&&null!==(i=this.model)&&void 0!==i&&i.is2d()&&this.indexToLayer.forEach((e=>{e&&!e.visible&&this.setLayerVisible(e.layer,!1)})),this.viewer.api.dispatchEvent({type:Jn,model:e,root:t})}.bind(this);this.model=e,(e.is2d()?function(e){var t=e.getData(),i=XA;t&&t.layersRoot&&(i=t.layersRoot);return Promise.resolve(i)}(e):function(e){if(e.getData().loadOptions.skipPropertyDb)return Promise.resolve(null);var t=e.getPropertyDb();if(!t||e.getData().loadOptions.disable3DModelLayers)return Promise.resolve(XA);return t.findLayers()}(e)).then((function(e){i(e),n(e)})).catch((function(e){rt.warn(e),n(XA)}))}},QA.removeModel=function(e){this.model===e&&(this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[])},QA.getRoot=function(){return this.initialized||rt.warn("Autodesk.Viewing.ModelLayers.getRoot couldn't peform action, layers are still being loaded"),this.root},QA.showAllLayers=function(){this.initialized?ZA(this,!0):rt.warn("Autodesk.Viewing.ModelLayers.showAllLayers couldn't peform action, layers are still being loaded")},QA.hideAllLayers=function(){this.initialized?ZA(this,!1):rt.warn("Autodesk.Viewing.ModelLayers.hideAllLayers couldn't peform action, layers are still being loaded")},QA.isLayerVisible=function(e){if(!this.initialized)return rt.warn("Autodesk.Viewing.ModelLayers.isLayerVisible couldn't peform action, layers are still being loaded"),!1;let t=JA(this,e);const i=this.indexToLayer[t];if(ew(i)){const e=i.layer.children;for(var n=0;n<e.length;++n){let t=e[n].index;if(this.indexToLayer[t].visible)return!0}return!1}return i.visible},QA.setLayerVisible=function(e,t){if(!this.initialized)return void rt.warn("Autodesk.Viewing.ModelLayers.setLayersVisible couldn't peform action, layers are still being loaded");var i=(e=Array.isArray(e)?e:[e]).map(function(e){return JA(this,e)}.bind(this));const n=i.length;for(var r=0;r<n;++r){let e=i[r],t=this.indexToLayer[e];if(ew(t)){t.layer.children.forEach((e=>{i.push(e.index)}))}}var o=this.model,s=this.indexToLayer;if(o.is2d())this.matman.setLayerVisible(i,t,o.id),this.viewer.invalidate(!0);else{var a=s.map((function(e){return!(null!==e&&-1!==i.indexOf(e.layer.index)&&e.visible!==t)})),l=[],c=t?this.viewer.visibilityManager.show:this.viewer.visibilityManager.hide;$A(this,(function(e,t){a[t]||(l.push(e),1024===l.length&&(c(l,o),l.length=0))})),l.length>0&&c(l,o)}var u=i.length;for(let e=0;e<u;++e){const n=this.indexToLayer[i[e]];n&&(n.visible=t)}},QA.getVisibleLayerIndices=function(){if(!this.initialized)return rt.warn("Autodesk.Viewing.ModelLayers.getVisibleLayerIndices couldn't peform action, layers are still being loaded"),[];for(var e=[],t=this.indexToLayer,i=t.length,n=1;n<i;++n){var r=t[n];r&&r.visible&&!ew(r)&&e.push(r.layer.index)}return e},QA.allLayersVisible=function(){if(!this.initialized)return!0;for(var e=this.indexToLayer,t=e.length,i=1;i<t;++i){var n=e[i];if(n&&!n.visible)return!1}return!0},QA.activateLayerState=function(e){if(!this.initialized)return rt.warn("Autodesk.Viewing.ModelLayers.activateLayerState couldn't peform action, layers are still being loaded"),!1;if(!this.model||this.model.is3d()||!e)return!1;var t=this.model.getData().metadata,i=null==t?void 0:t.layer_states;if(!i)return!1;let n;for(n=0;n<i.length&&i[n].name!==e;n++);if(n>=i.length)return!1;var r=i[n].visible_layers,o={};if(r&&0<r.length)for(var s=0;s<r.length;s++)o[r[s]]=1;var a=[],l=[];for(var c in t.layers){var u=t.layers[c].name;c|=0,1===o[u]?a.push(c):l.push(c)}return this.setLayerVisible(a,!0),this.setLayerVisible(l,!1),!0},QA.getLayerStates=function(){function e(e,t){var i=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);if(i.length!==n.length)return!1;for(var r=0;r<i.length;++r){var o=i[r];if(e[o]!==t[o])return!1}return!0}if(!this.initialized)return rt.warn("Autodesk.Viewing.ModelLayers.getLayerStates couldn't peform action, layers are still being loaded"),null;var t,i=this.model,n=i?i.getData().metadata:null,r=n?n.layers:null,o=n?n.layer_states:null;if(this.model.is3d()||!r||!o)return null;var s={},a={};for(var l in r)if(Object.prototype.hasOwnProperty.call(r,l)){var c=parseInt(l),u=r[l];s[t="string"==typeof u?u:u.name]=!0,this.isLayerVisible(c)&&(a[t]=!0)}for(var h=[],d=0;d<o.length;++d){var f=o[d],p=f.visible_layers,m={};if(!f.hidden){if(p&&0<p.length)for(var g=0;g<p.length;++g)t=p[g],Object.prototype.hasOwnProperty.call(s,t)&&(m[t]=!0);h.push({name:f.name,description:f.description,active:e(a,m)})}}return 0<h.length?h:null},iw.prototype.onVertex=function(e,t,i){this.point.x=e,this.point.y=t,this.bounds.expandByPoint(this.point)},iw.prototype.onLineSegment=function(e,t,i,n,r){this.onVertex(e,t),this.onVertex(i,n)},iw.prototype.onCircularArc=function(e,t,i,n,r,o){this.onEllipticalArc(e,t,i,n,r,r,0,o)},iw.prototype.onEllipticalArc=function(e,t,i,n,r,o,s,a){0==s?i<=0&&n>=2*Math.PI-1e-5?this.onTexQuad(e,t,2*r,2*o,s,a):(this.point.x=e+Math.cos(i)*r,this.point.y=t+Math.sin(i)*o,this.bounds.expandByPoint(this.point),this.point.x=e+Math.cos(n)*r,this.point.y=t+Math.sin(n)*o,this.bounds.expandByPoint(this.point),i>n&&(this.point.x=e+r,this.point.y=t,this.bounds.expandByPoint(this.point),i-=2*Math.PI),i<.5*Math.PI&&n>.5*Math.PI&&(this.point.x=e,this.point.y=t+o,this.bounds.expandByPoint(this.point)),i<Math.PI&&n>Math.PI&&(this.point.x=e-r,this.point.y=t,this.bounds.expandByPoint(this.point)),i<1.5*Math.PI&&n>1.5*Math.PI&&(this.point.x=e,this.point.y=t-o,this.bounds.expandByPoint(this.point))):this.onTexQuad(e,t,2*r,2*o,s,a)},iw.prototype.onTexQuad=function(e,t,i,n,r,o){var s=.5*i,a=.5*i;if(0==r)this.onVertex(e-s,t-a),this.onVertex(e+s,t+a);else{var l=new(v().Matrix4),c=new(v().Matrix4);l.makeRotationZ(r),c.makeTranslation(e,t,0),c.multiply(l);for(var u=0;u<4;u++)this.point.x=u%2==1?s:-s,this.point.y=u>=2?a:-a,this.point.applyMatrix4(c),this.bounds.expandByPoint(this.point)}},iw.prototype.onOneTriangle=function(e,t,i,n,r,o,s){this.onVertex(e,t),this.onVertex(i,n),this.onVertex(r,o)};var nw=function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")};function rw(e,t,i){var n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===e.getShaderParameter(n,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(n),nw(i))),n}const ow="#version 300 es\n    #define texture2D texture\n    #define textureCube texture\n    #define attribute in\n    #define varying out\n",sw="#version 300 es\n    #define texture2D texture\n    #define textureCube texture\n    #define textureCubeLodEXT textureLod\n    #define gl_FragColor outFragColor\n    #define varying in\n";let aw=(lw=0,cw=function(e){return""!==e},uw=function(e,t,i,n,r){var o=n?"1.0-":"",s="texture2D("+e+", (UV))",a="";return r=r||"vec4(0.0)",t&&i?a="((UV).x < 0.0 || (UV).x > 1.0 || (UV).y < 0.0 || (UV).y > 1.0) ? "+r+" : ":t?a="((UV).x < 0.0 || (UV).x > 1.0) ? "+r+" : ":i&&(a="((UV).y < 0.0 || (UV).y > 1.0) ? "+r+" : "),"#define GET_"+e.toUpperCase()+"(UV) ("+a+o+s+")"},function(e,t,i,n,r){var o=e,s=o.context,a=i.defines,l=i.__webglShader.uniforms;let c={};c={...i.attributes,...r.attributes};var u=Id(n.vertexShader),h=Id(n.fragmentShader),d=i.index0AttributeName;void 0===d&&!0===n.morphTargets&&(d="position");var f,p,m="ENVMAP_MODE_REFLECTION",g=e.gammaFactor>0?e.gammaFactor:1,y=function(e){var t,i,n=[];for(var r in e)!1!==(t=e[r])&&(i="#define "+r+" "+t,n.push(i));return n.join("\n")}(a),b=s.createProgram();i instanceof v().RawShaderMaterial?((f=[ow,y].filter(cw).join("\n")).length>0&&(f+="\n"),(p=[sw,"precision "+n.precisionFragment+" float;",y,"out vec4 outFragColor;"].filter(cw).join("\n")).length>0&&(p+="\n")):(f=[ow,"precision "+n.precision+" float;","precision "+n.precision+" int;",y,n.vertexPrefix,n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+g,n.mrtNormals?"#define MRT_NORMALS":"",n.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_BONES "+n.maxBones,"#define NUM_CUTPLANES "+n.numCutplanes,n.loadingAnimationDuration>0?"#define LOADING_ANIMATION":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+m:"",n.irradianceMap?"#define USE_IRRADIANCEMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.vertexIds?"#define USE_VERTEX_ID":"",n.useTiling?"#define USE_TILING":"",n.useInstancing?"#define USE_INSTANCING":"",n.useTheming?"#define USE_THEMING":"",n.wideLines?"#define WIDE_LINES":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.packedNormals?"#define UNPACK_NORMALS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF_EXT":"",n.flatShading?"#define FLAT_SHADED":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","#ifdef UNPACK_NORMALS","attribute vec2 normal;","#else","attribute vec3 normal;","#endif","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","   attribute vec3 color;","#endif",""].join("\n"),p=[sw,y,n.fragmentPrefix,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define NUM_CUTPLANES "+n.numCutplanes,n.loadingAnimationDuration>0?"#define LOADING_ANIMATION":"",n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+g,n.mrtNormals?"#define MRT_NORMALS":"",n.mrtIdBuffer?"#define MRT_ID_BUFFER":"",n.mrtIdBuffer>1?"#define MODEL_COLOR":"","#define TONEMAP_OUTPUT "+(n.tonemapOutput||0),n.useBackgroundTexture?"#define USE_BACKGROUND_TEXTURE":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define ENVMAP_TYPE_CUBE":"",n.envMap?"#define "+m:"",n.envMap?"#define ENVMAP_BLENDING_MULTIPLY":"",n.irradianceMap?"#define USE_IRRADIANCEMAP":"",n.envGammaEncoded?"#define ENV_GAMMA":"",n.irrGammaEncoded?"#define IRR_GAMMA":"",n.envRGBM?"#define ENV_RGBM":"",n.irrRGBM?"#define IRR_RGBM":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.vertexIds?"#define USE_VERTEX_ID":"",n.metal?"#define METAL":"",n.clearcoat?"#define CLEARCOAT":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.hatchPattern?"#define HATCH_PATTERN":"",n.useTheming?"#define USE_THEMING":"",n.useInstancing?"#define USE_INSTANCING":"",n.mapInvert?"#define MAP_INVERT":"",n.useTiling?"#define USE_TILING":"",n.useTiling?"#define TILE_RANGE_X_MIN "+n.tilingRepeatRange[0]:"",n.useTiling?"#define TILE_RANGE_Y_MIN "+n.tilingRepeatRange[1]:"",n.useTiling?"#define TILE_RANGE_X_MAX "+n.tilingRepeatRange[2]:"",n.useTiling?"#define TILE_RANGE_Y_MAX "+n.tilingRepeatRange[3]:"",n.hasRoundCorner?"#define USE_TILING_NORMAL":"",n.useRandomOffset?"#define USE_TILING_RANDOM":"",uw("map",n.mapClampS,n.mapClampT),uw("bumpMap",n.bumpMapClampS,n.bumpMapClampT),uw("normalMap",n.normalMapClampS,n.normalMapClampT),uw("specularMap",n.specularMapClampS,n.specularMapClampT),uw("alphaMap",n.alphaMapClampS,n.alphaMapClampT,n.alphaMapInvert),n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF_EXT":"",n.logarithmicDepthBuffer&&n.polygonOffset?"#define POLYGON_OFFSET":"",n.flatShading?"#define FLAT_SHADED":"","precision "+n.precisionFragment+" float;","precision "+n.precisionFragment+" int;","layout(location = 0) out vec4 outFragColor;","uniform highp mat4 viewMatrix;","uniform highp mat4 projectionMatrix;","uniform highp vec3 cameraPosition;","#if defined(USE_ENVMAP) || defined(USE_IRRADIANCEMAP)","uniform mat4 viewMatrixInverse;","#endif",""].join("\n"));var x=new rw(s,s.VERTEX_SHADER,f+u),_=new rw(s,s.FRAGMENT_SHADER,p+h);s.attachShader(b,x),s.attachShader(b,_),void 0!==d&&s.bindAttribLocation(b,0,d),s.linkProgram(b),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===s.getProgramParameter(b,s.LINK_STATUS)&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",s.getProgramParameter(b,s.VALIDATE_STATUS)),console.error("gl.getError()",s.getError())),""!==s.getProgramInfoLog(b)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",s.getProgramInfoLog(b))),s.deleteShader(x),s.deleteShader(_);var E=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","viewMatrixInverse","mvpMatrix","dbId"];for(var S in l)E.push(S);for(var A in E.push("logDepthBufFC","polygonOffset"),this.uniforms=function(e,t,i){for(var n={},r=0,o=i.length;r<o;r++){var s=i[r];n[s]=e.getUniformLocation(t,s)}return n}(s,b,E),E=["position","normal","uv","uv2","tangent","color","lineDistance","uvw","id","instOffset","instScaling","instRotation","prev","next","side","uvp","pointScale"],c)E.push(A);this.attributes=function(e,t,i){for(var n={},r=0,o=i.length;r<o;r++){var s=i[r];n[s]=e.getAttribLocation(t,s)}return n}(s,b,E),this.attributesKeys=Object.keys(this.attributes),this.id=lw++,this.code=t,this.usedTimes=1,this.program=b,this.vertexShader=x,this.fragmentShader=_;let w=s.getProgramParameter(this.program,s.ACTIVE_UNIFORM_BLOCKS),C=[];for(let e=0;e<w;e++){let t=s.getActiveUniformBlockName(this.program,e);C.push(t)}return this.ubos=C,this});var lw,cw,uw,hw=r(41298),dw=r.n(hw);class fw{constructor(){this._subsets=new Array,this._totalFreeSpace=0}insert(e){let t=dw()(this._subsets,e,"size");this._totalFreeSpace+=e.size,this._subsets.splice(t,0,e)}remove(e){this._totalFreeSpace-=e.size,this._subsets.splice(this._subsets.indexOf(e),1)}findSmallestLargerOrEqual(e){let t=dw()(this._subsets,{size:e},"size");return t<this._subsets.length?this._subsets[t]:null}getLargestFreeSubsetSize(){return this._subsets.length>0?this._subsets[this._subsets.length-1].size:0}get totalFreeSpace(){return this._totalFreeSpace}}class pw{constructor(e,t,i){this.size=i,this.offset=t,this.free=!1,this.next=null,this.prev=null,this.bufferRegion=e}getGlBuffer(){return this.bufferRegion._buffer}getStride(){return this.bufferRegion._stride}}class mw{constructor(e,t,i,n){this._buffer=e.createBuffer(),this._size=t,this._allocatedSize=0,this._firstSubset=null,this._lastSubset=null,this._freeList=new fw,this._bumpAllocationDone=!1,this._isVertexBuffer=i===e.ARRAY_BUFFER,this._stride=n,e.bindBuffer(i,this._buffer),e.bufferData(i,t,e.STATIC_DRAW)}isEmpty(){return this._freeList.getLargestFreeSubsetSize()===this._size}tryAllocateBufferSubset(e){if(!this._bumpAllocationDone){if(this._allocatedSize+e>this._size)return null;let t=null;return null===this._firstSubset?(t=new pw(this,0,e),this._firstSubset=t,this._lastSubset=this._firstSubset):(t=new pw(this,this._allocatedSize,e),this._lastSubset.next=t,t.prev=this._lastSubset,this._lastSubset=t),this._allocatedSize+=e,t}if(e>this._freeList.getLargestFreeSubsetSize())return null;let t=this._freeList.findSmallestLargerOrEqual(e);this._freeList.remove(t);const i=new pw(this,t.offset,e);return i.next=t.next,i.prev=t.prev,t.prev&&(t.prev.next=i),t.size>0?(t.size-=e,t.prev=i,t.offset+=e,this._freeList.insert(t),i.next=t):t.next&&(t.next.prev=i),this._allocatedSize+=e,i}destroy(e){e.deleteBuffer(this._buffer),this._buffer=null}freeBufferSubset(e){this._bumpAllocationDone=!0;const t=e.size;e.free=!0,e.next&&e.next.free&&(this._freeList.remove(e.next),e.size+=e.next.size,e.next=e.next.next,e.next&&(e.next.prev=e)),e.prev&&e.prev.free&&(this._freeList.remove(e.prev),e.size+=e.prev.size,e.offset=e.prev.offset,e.prev=e.prev.prev,e.prev&&(e.prev.next=e)),this._freeList.insert(e),this._allocatedSize-=t}}class gw{static BufferManagers=[];constructor(e){this._gl=e,this._indexBuffers=[],this._vertexBuffers=[],this._exactBuffers=[],this._recycledBufferSubsets=[],"undefined"!=typeof WeakRef&&gw.BufferManagers.push(new WeakRef(this))}allocateNewBufferRegion(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e===this._gl.ARRAY_BUFFER,o=r?this._vertexBuffers:this._indexBuffers,s=n?t:Math.max(t,r?vn:yn);console.assert(s%4==0,"Buffer size must be a multiple of 4");const a=new mw(this._gl,s,e,i);return n?(a.exact=!0,this._exactBuffers.push(a)):o.push(a),a}allocateBufferSubset(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=t===this._gl.ARRAY_BUFFER?this._vertexBuffers:this._indexBuffers;if(e+=e%4!=0?4-e%4:0,!n)for(let t=0;t<r.length;t++)if(r[t]._stride===i){const i=r[t].tryAllocateBufferSubset(e);if(i)return i}return this.allocateNewBufferRegion(t,e,i,n).tryAllocateBufferSubset(e)}freeBufferSubset(e){const t=e.size;if(e.bufferRegion.freeBufferSubset(e),e.bufferRegion.isEmpty()){const t=e.bufferRegion._isVertexBuffer,i=e.bufferRegion.exact?this._exactBuffers:t?this._vertexBuffers:this._indexBuffers;i.splice(i.indexOf(e.bufferRegion),1),e.bufferRegion.destroy(this._gl)}return t}resetAfterContextLoss(){this._vertexBuffers=[],this._indexBuffers=[],this._exactBuffers=[]}printMemoryStatistics(){console.log("Vertex Buffer Count: ",this._vertexBuffers.length),console.log("Memory in Vertex Buffers: ",this._vertexBuffers.reduce(((e,t)=>{this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t._buffer);return e+this._gl.getBufferParameter(this._gl.ARRAY_BUFFER,this._gl.BUFFER_SIZE)}),0)/1024),console.log("Actually allocated memory in Vertex Buffers: ",this._vertexBuffers.reduce(((e,t)=>e+t._size-t._freeList.totalFreeSpace),0)),console.log("Index Buffer Count: ",this._indexBuffers.length),console.log("Memory in Index Buffers: ",this._indexBuffers.reduce(((e,t)=>{this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t._buffer);return e+this._gl.getBufferParameter(this._gl.ELEMENT_ARRAY_BUFFER,this._gl.BUFFER_SIZE)}),0)/1024),console.log("Actually allocated memory in Index Buffers: ",this._indexBuffers.reduce(((e,t)=>e+t._size-t._freeList.totalFreeSpace),0))}getMemoryStatistics(){return{vertexBufferCount:this._vertexBuffers.length,vertexBufferMemory:this._vertexBuffers.reduce(((e,t)=>e+t._size),0),vertexBufferAllocatedMemory:this._vertexBuffers.reduce(((e,t)=>e+t._allocatedSize),0),indexBufferCount:this._indexBuffers.length,indexBufferMemory:this._indexBuffers.reduce(((e,t)=>e+t._size),0),indexBufferAllocatedMemory:this._indexBuffers.reduce(((e,t)=>e+t._allocatedSize),0),exactBufferCount:this._exactBuffers.length,exactBufferMemory:this._exactBuffers.reduce(((e,t)=>e+t._size),0),exactBufferAllocatedMemory:this._exactBuffers.reduce(((e,t)=>e+t._allocatedSize),0)}}dtor(){if(this._vertexBuffers.forEach((e=>e.destroy(this._gl))),this._vertexBuffers=[],this._indexBuffers.forEach((e=>e.destroy(this._gl))),this._indexBuffers=[],this._exactBuffers.forEach((e=>e.destroy(this._gl))),this._exactBuffers=[],"undefined"!=typeof WeakRef){let e=gw.BufferManagers.findIndex((e=>e.deref()===this));-1!==e&&gw.BufferManagers.splice(e,1)}}static getTotalMemoryStatistics(){let e=0,t=0;for(let i=0;i<gw.BufferManagers.length;i++){const n=gw.BufferManagers[i].deref();if(n){let i=n.getMemoryStatistics();e+=i.vertexBufferMemory+i.indexBufferMemory+i.exactBufferMemory,t+=i.vertexBufferAllocatedMemory+i.indexBufferAllocatedMemory+i.exactBufferAllocatedMemory}}return{totalMemory:e,totalAllocatedMemory:t}}}const vw=Object.freeze({THEMING_COLOR:1,VISIBILITY:2,HIGHLIGHTING:4});class yw{#Da=new Map;#Oa=null;#Ba=new Map;constructor(e){this.#Oa=e}addModel(e){const t=e.getFragmentList();if(t){const i=[this.requestUpdate.bind(this,e,vw.THEMING_COLOR),this.requestUpdate.bind(this,e,vw.VISIBILITY),this.requestUpdate.bind(this,e,vw.HIGHLIGHTING)];t.registerThemingColorChangedCallback(i[0]),t.registerVisibilityDirtyCallback(i[1]),t.registerHighlightingChangedCallback(i[2]),this.#Ba.set(e.id,i)}}removeModel(e){const t=e.getFragmentList();if(t){const i=this.#Ba.get(e.id);t.removeThemingColorChangedCallback(i[0]),t.removeVisibilityDirtyCallback(i[1]),t.removeHighlightingChangedCallback(i[2]),this.#Ba.delete(e.id)}}requestUpdate(e,t,i){const n=e.getConsolidation();if(n)if(void 0===i)for(let i of n.meshes)this.#Na(e,i,t);else this.#Na(e,n.meshes[n.fragId2MeshIndex[i]],t)}#Na(e,t,i){if(!t||!t.geometry||Hg(t))return;const n=this.#Da.get(t)??0;n&i||(this.#Da.set(t,n|i),0===n&&queueMicrotask((()=>{const i=this.#Da.get(t),n=e.getConsolidation();Wg(t)?(i&vw.THEMING_COLOR&&this.#Ua(t,e.getFragmentList(),n.consolidationMap.fragOrder),i&vw.VISIBILITY&&this.#ka(t,e.getFragmentList(),n.consolidationMap.fragOrder)):this.#Oa.updateMeshFragmentUBO(t,e.getFragmentList(),n.consolidationMap.fragOrder),this.#Da.delete(t)})))}#Ua(e,t,i){const n=e.geometry.getAttribute("instThemingColor"),r=n.array;n.needsUpdate=!0;const o=new THREE.Vector4(0,0,0,0);for(let n=0;n<e.rangeCount;n++){let s=i[e.rangeBegin+n],a=t.getDbIds(s);const l=t.db2ThemingColor[a]??o;r[4*n+0]=255*l.x,r[4*n+1]=255*l.y,r[4*n+2]=255*l.z,r[4*n+3]=255*l.w}}#ka(e,t,i){const n=e.geometry.getAttribute("instFlags"),r=n.array;n.needsUpdate=!0;for(let n=0;n<e.rangeCount;n++){let o=i[e.rangeBegin+n];r[n]=255&t.vizflags[o]}}}let bw=!1;const xw=c(),_w=xw.document;let Ew=function(e){console.log("THREE.WebGLRenderer",v().REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:_w.createElement("canvas"),i=null,n=void 0!==e.precision?e.precision:"highp",r=n,o=void 0!==e.alpha&&e.alpha,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,a=void 0!==e.antialias&&e.antialias,l=void 0===e.stencil||e.stencil,c=void 0===e.preserveDrawingBuffer||e.preserveDrawingBuffer,u=e.logarithmicDepthBuffer,h=new(v().Color)(0),d=0,f=[],p={},m=new(v().Matrix4),g=new(v().Matrix3);this.highResTimeStamp=0;var y=[],b=[];this.domElement=t,this.context=null,this.refCount=0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},reset:function(){this.render.calls=0}};var x,_,E,S,A,w,C=this,T=[],M=null,I=null,P=null,L=null,R=-1,D=null,O="",B=0,N="",U="",k=new Set,F=0,V=0,G=0,z=t.width,H=t.height,W={},j=new(v().Frustum),q=new(v().Matrix4),K=new(v().Matrix4),X=new(v().Vector3),Y=new(v().Vector3),Q=!0,Z=null,$={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};let J,ee,te,ie,ne;C.capabilities={};try{var re={alpha:o,premultipliedAlpha:s,antialias:a,stencil:l,powerPreference:"high-performance",preserveDrawingBuffer:c};if(x=t.getContext("webgl2",re),C.capabilities.isWebGL2=!0,null===x)throw null!==t.getContext("webgl2",re)?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";!function(e){let t=e.colorMask.bind(e),i=e.getParameter(e.COLOR_WRITEMASK);e.colorMask=function(e,n,r,o){e===i[0]&&n===i[1]&&r===i[2]&&o===i[3]||(i[0]=e,i[1]=n,i[2]=r,i[3]=o,t(e,n,r,o))},e.getColorMask=function(){return i.slice()}}(x);const e=x.getExtension("WEBGL_debug_renderer_info");if(e){const t=x.getParameter(e.UNMASKED_VENDOR_WEBGL),i=x.getParameter(e.UNMASKED_RENDERER_WEBGL);console.log("WebGL Renderer: "+i),console.log("WebGL Vendor: "+t),Qe.trackHWInfo(i,t)}if(Z=fn?x.getExtension("EXT_disjoint_timer_query_webgl2"):null,_=new gw(x),A=nn?_.freeBufferSubset.bind(_):x.deleteBuffer.bind(x),w=nn?function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",Re));if(e.streamingDraw&&!k.has(e)){if(e.streamingDraw===Ug)tt(e);else if(!e.streamingIndex){var t=e.index;t&&(t.buffer=x.createBuffer(),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,t.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,t.array||e.ib,x.STATIC_DRAW))}return}e.vb&&void 0===e.vbbuffer&&(e.vbNeedsUpdate=!0);e.ib&&void 0===e.ibbuffer&&(e.ibNeedsUpdate=!0);e.iblines&&void 0===e.iblinesbuffer&&(e.iblinesNeedsUpdate=!0);if(e.vbNeedsUpdate){let t=!0;void 0!==e.vbbuffer&&(e.vbbuffer.size!==e.vb.byteLength||e.vbbuffer.getStride()!=e.vbstride?_.freeBufferSubset(e.vbbuffer):t=!1),t&&(e.vbbuffer=_.allocateBufferSubset(e.vb.byteLength,x.ARRAY_BUFFER,4*e.vbstride),e.streamingDraw=Ug,e.streamingIndex=Ug,k.add(e)),x.bindBuffer(x.ARRAY_BUFFER,e.vbbuffer.getGlBuffer()),x.bufferSubData(x.ARRAY_BUFFER,e.vbbuffer.offset,e.vb),e.vbNeedsUpdate=!1}if(e.ibNeedsUpdate){let t=!0;void 0!==e.ibbuffer&&(e.ibbuffer.size!==e.ib.byteLength?_.freeBufferSubset(e.ibbuffer):t=!1),t&&(e.ibbuffer=_.allocateBufferSubset(e.ib.byteLength,x.ELEMENT_ARRAY_BUFFER,0),e.streamingDraw=Ug,e.streamingIndex=Ug,k.add(e)),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.ibbuffer.getGlBuffer()),x.bufferSubData(x.ELEMENT_ARRAY_BUFFER,e.ibbuffer.offset,e.ib),e.ibNeedsUpdate=!1}if(e.iblinesNeedsUpdate){let t=!0;void 0!==e.iblinesbuffer&&(e.iblinesbuffer.size!==e.iblines.byteLength?_.freeBufferSubset(e.iblinesbuffer):t=!1),t&&(e.iblinesbuffer=_.allocateBufferSubset(e.iblines.byteLength,x.ELEMENT_ARRAY_BUFFER,0),e.streamingDraw=Ug,e.streamingIndex=Ug,k.add(e)),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.iblinesbuffer.getGlBuffer()),x.bufferSubData(x.ELEMENT_ARRAY_BUFFER,e.iblinesbuffer.offset,e.iblines),e.iblinesNeedsUpdate=!1}const i=e.attributes,n=Object.keys(e.attributes);for(let t=0,s=n.length;t<s;t++){const s=n[t],a=i[s];var r,o="index"===s?x.ELEMENT_ARRAY_BUFFER:x.ARRAY_BUFFER;if(a.array&&void 0===a.buffer){const t=a.bytesPerItem||a.array.BYTES_PER_ELEMENT;a.buffer=_.allocateBufferSubset(a.array.byteLength,o,a.itemSize*t),a.needsUpdate=!0,e.streamingDraw=Ug,e.streamingIndex=Ug,k.add(e)}if($e(a))void 0===(null===(r=a.buffer)||void 0===r?void 0:r.getGlBuffer)?(x.bindBuffer(o,a.buffer),x.bufferData(o,a.array,x.STATIC_DRAW)):(x.bindBuffer(o,a.buffer.getGlBuffer()),x.bufferSubData(o,a.buffer.offset,a.array)),Je(a)}}:function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",Re));if(e.streamingDraw){if(!e.streamingIndex){var t=e.index;t&&(t.buffer=x.createBuffer(),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,t.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,t.array||e.ib,x.STATIC_DRAW))}return}e.vb&&void 0===e.vbbuffer&&(e.vbbuffer=x.createBuffer(),e.vbNeedsUpdate=!0);e.ib&&void 0===e.ibbuffer&&(e.ibbuffer=x.createBuffer(),e.ibNeedsUpdate=!0);e.iblines&&void 0===e.iblinesbuffer&&(e.iblinesbuffer=x.createBuffer(),e.iblinesNeedsUpdate=!0);for(var i=e.attributes,n=Object.keys(e.attributes),r=0,o=n.length;r<o;r++){var s=n[r],a=i[s],l="index"===s;if(a.array&&void 0===a.buffer&&(a.buffer=x.createBuffer(),a.needsUpdate=!0),$e(a)){var c=l?x.ELEMENT_ARRAY_BUFFER:x.ARRAY_BUFFER;x.bindBuffer(c,a.buffer),x.bufferData(c,a.array,x.STATIC_DRAW),Je(a),e.discardAfterUpload&&(a.array=null)}}e.vbNeedsUpdate&&(x.bindBuffer(x.ARRAY_BUFFER,e.vbbuffer),x.bufferData(x.ARRAY_BUFFER,e.vb,x.STATIC_DRAW),e.vbNeedsUpdate=!1,e.discardAfterUpload&&(e.vbLength=e.vb.length,e.vb=null));e.ibNeedsUpdate&&(x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.ibbuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,e.ib,x.STATIC_DRAW),e.ibNeedsUpdate=!1,e.discardAfterUpload&&(e.ibLength=e.ib.length,e.ibByteSize=e.ib instanceof Uint32Array?4:2,e.ib=null));e.iblinesNeedsUpdate&&(x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.iblinesbuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,e.iblines,x.STATIC_DRAW),e.iblinesNeedsUpdate=!1,e.discardAfterUpload&&(e.iblinesLength=e.iblines.length,e.iblinesByteSize=e.iblines instanceof Uint32Array?4:2,e.iblines=null))},fn){var oe=x.getParameter(x.MAX_UNIFORM_BLOCK_SIZE);E=new Dg(this,oe),S=new yw(E)}0==x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.HIGH_FLOAT).precision&&(r="mediump"),J=function(e){e.preventDefault(),ce(),le(),p={},bt={},xt=0,ue.dispose(),T.length=0,jt.lutBuffer=null,jt.geomBuffer=null,jt.programs.clear(),jt.vaos.clear()},t.addEventListener("webglcontextlost",J,!1),ee=function(e){e.preventDefault(),C.enableContextRestore&&(se(),Ee(),nn&&(_.resetAfterContextLoss(),k=new Set),W={},C.lostContextRecovery=C.lostContextRecovery||new fA,C.lostContextRecovery.onContextRestored(),M=null,I=null)},t.addEventListener("webglcontextrestored",ee)}catch(e){return void console.error(e)}function se(){te=new(v().WebGLExtensions)(x),ie=new(v().WebGLState)(x,Wt),ne=ie,te.get("EXT_texture_filter_anisotropic"),te.get("WEBGL_compressed_texture_s3tc"),te.get("EXT_color_buffer_float"),C.extensions=te}void 0===x.getShaderPrecisionFormat&&(x.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),se();var ae=function(e,t,i,n){!0===s&&(e*=n,t*=n,i*=n),x.clearColor(e,t,i,n)},le=function(){x.clearColor(0,0,0,1),x.clearDepth(1-Tn),x.clearStencil(0),x.enable(x.DEPTH_TEST),x.depthFunc(x.LEQUAL),x.frontFace(x.CCW),x.cullFace(x.BACK),x.enable(x.CULL_FACE),x.enable(x.BLEND),x.blendEquation(x.FUNC_ADD),x.blendFunc(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA),x.viewport(V,G,z,H),ae(h.r,h.g,h.b,d)},ce=function(){M=null,D=null,O="",R=-1,Q=!0,ie.reset(),ne.disableUnusedAttributes()};le(),this.context=x,this.state=ie;for(var ue,he=x.getParameter(x.MAX_TEXTURE_IMAGE_UNITS),de=x.getParameter(x.MAX_VERTEX_TEXTURE_IMAGE_UNITS),fe=x.getParameter(x.MAX_TEXTURE_SIZE),pe=x.getParameter(x.MAX_CUBE_MAP_TEXTURE_SIZE),me=de>0,ge=x.getShaderPrecisionFormat(x.VERTEX_SHADER,x.HIGH_FLOAT),ve=x.getShaderPrecisionFormat(x.VERTEX_SHADER,x.MEDIUM_FLOAT),ye=x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.HIGH_FLOAT),be=x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.MEDIUM_FLOAT),xe=new Uint8Array(16),_e=0;_e<4;_e++)bw?1===_e||2===_e?(xe[4*_e]=246,xe[4*_e+1]=140,xe[4*_e+2]=220):(xe[4*_e]=48,xe[4*_e+1]=195,xe[4*_e+2]=3):xe[4*_e]=xe[4*_e+1]=xe[4*_e+2]=0,xe[4*_e+3]=255;function Ee(){(ue=new(v().DataTexture)(xe,2,2,v().RGBAFormat,v().UnsignedByteType,v().UVMapping,v().RepeatWrapping,v().RepeatWrapping,v().NearestFilter,v().NearestFilter)).needsUpdate=!0}Ee();var Se,Ae,we=function(){if(void 0!==Se)return Se;if(Se=[],te.get("WEBGL_compressed_texture_pvrtc")||te.get("WEBGL_compressed_texture_s3tc"))for(var e=x.getParameter(x.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)Se.push(e[t]);return Se},Ce=ge.precision>0,Te=ve.precision>0;"highp"!==n||Ce||(Te?(n="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(n="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==n||Te||(n="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),Ce=ye.precision>0,Te=be.precision>0,"highp"!==r||Ce||(Te?(r="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(r="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==r||Te||(r="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return x},this.isWebGL2=function(){return!0},this.forceContextLoss=function(){te.get("WEBGL_lose_context").loseContext()},this.forceContextRestore=function(){te.get("WEBGL_lose_context").restoreContext()},this.getMaxAnisotropy=function(){if(void 0!==Ae)return Ae;var e=te.get("EXT_texture_filter_anisotropic");return Ae=null!==e?x.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPixelRatio=function(){return i||xw.devicePixelRatio||1},this.setPixelRatio=function(e){i=e},this.getCurrentFramebuffer=function(){return I},this.setSize=function(e,i,n){const r=this.getPixelRatio();t.width=e*r,t.height=i*r,!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i)},this.setViewport=function(e,t,i,n){const r=this.getPixelRatio();V=e*r,G=t*r,z=i*r,H=n*r,x.viewport(V,G,z,H)};var Me=!1;this.enableViewportOnOffscreenTargets=function(e){Me=e};var Ie=[];function Pe(e){e.__webglVertexBuffer=x.createBuffer(),e.__webglNormalBuffer=x.createBuffer(),e.__webglTangentBuffer=x.createBuffer(),e.__webglColorBuffer=x.createBuffer(),e.__webglUVBuffer=x.createBuffer(),e.__webglUV2Buffer=x.createBuffer(),e.__webglSkinIndicesBuffer=x.createBuffer(),e.__webglSkinWeightsBuffer=x.createBuffer(),e.__webglFaceBuffer=x.createBuffer(),e.__webglLineBuffer=x.createBuffer(),C.info.memory.geometries++}this.pushViewport=function(){Ie.push(V),Ie.push(G),Ie.push(z),Ie.push(H)},this.popViewport=function(){var e=Ie.length-4;V=Ie[e],G=Ie[e+1],z=Ie[e+2],H=Ie[e+3],x.viewport(V,G,z,H),Ie.length=e},this.setScissor=function(e,t,i,n){const r=this.getPixelRatio();x.scissor(e*r,t*r,i*r,n*r)},this.enableScissorTest=function(e){e?x.enable(x.SCISSOR_TEST):x.disable(x.SCISSOR_TEST)},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new(v().Color)),e.copy(h)},this.setClearColor=function(e,t){h.set(e),d=void 0!==t?t:1,ae(h.r,h.g,h.b,d)},this.getClearAlpha=function(){return d},this.setClearAlpha=function(e){d=e,ae(h.r,h.g,h.b,d)},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=x.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=x.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=x.STENCIL_BUFFER_BIT),x.clear(n)},this.clearColor=function(){x.clear(x.COLOR_BUFFER_BIT)},this.clearDepth=function(){x.clear(x.DEPTH_BUFFER_BIT)},this.clearStencil=function(){x.clear(x.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.resetGLState=ce;var Le=function(e){e.target.traverse((function(e){e.removeEventListener("remove",Le),function(e){(e instanceof v().Mesh||e instanceof v().PointCloud||e instanceof v().Line)&&delete p[e.id];delete e.__webglInit,delete e.__webglActive}(e)}))},Re=function(e){var t=e.target;t.removeEventListener("dispose",Re),Ue(t)},De=function(e){var t=e.target;t.removeEventListener("dispose",De),ze(t),C.info.memory.textures--},Oe=function(e){var t=e.target;t.removeEventListener("dispose",Oe),He(t),C.info.memory.textures--},Be=function(e){var t=e.target;t.removeEventListener("dispose",Be),We(t)},Ne=function(e){if(void 0!==e.__webglVertexBuffer&&(x.deleteBuffer(e.__webglVertexBuffer),e.__webglVertexBuffer=void 0),void 0!==e.__webglNormalBuffer&&(x.deleteBuffer(e.__webglNormalBuffer),e.__webglNormalBuffer=void 0),void 0!==e.__webglTangentBuffer&&(x.deleteBuffer(e.__webglTangentBuffer),e.__webglTangentBuffer=void 0),void 0!==e.__webglColorBuffer&&(x.deleteBuffer(e.__webglColorBuffer),e.__webglColorBuffer=void 0),void 0!==e.__webglUVBuffer&&(x.deleteBuffer(e.__webglUVBuffer),e.__webglUVBuffer=void 0),void 0!==e.__webglUV2Buffer&&(x.deleteBuffer(e.__webglUV2Buffer),e.__webglUV2Buffer=void 0),void 0!==e.__webglSkinIndicesBuffer&&(x.deleteBuffer(e.__webglSkinIndicesBuffer),e.__webglSkinIndicesBuffer=void 0),void 0!==e.__webglSkinWeightsBuffer&&(x.deleteBuffer(e.__webglSkinWeightsBuffer),e.__webglSkinWeightsBuffer=void 0),void 0!==e.__webglFaceBuffer&&(x.deleteBuffer(e.__webglFaceBuffer),e.__webglFaceBuffer=void 0),void 0!==e.__webglLineBuffer&&(x.deleteBuffer(e.__webglLineBuffer),e.__webglLineBuffer=void 0),void 0!==e.__webglLineDistanceBuffer&&(x.deleteBuffer(e.__webglLineDistanceBuffer),e.__webglLineDistanceBuffer=void 0),void 0!==e.__webglCustomAttributesList){for(var t in e.__webglCustomAttributesList)x.deleteBuffer(e.__webglCustomAttributesList[t].buffer);e.__webglCustomAttributesList=void 0}C.info.memory.geometries--},Ue=function(e){var t,i,n,r;if(e.__webglInit=void 0,e instanceof v().BufferGeometry){if(void 0!==e.vbbuffer&&(A(e.vbbuffer),e.vbbuffer=void 0),void 0!==e.ibbuffer&&(A(e.ibbuffer),e.ibbuffer=void 0),void 0!==e.iblinesbuffer&&(A(e.iblinesbuffer),e.iblinesbuffer=void 0),e.vaos){for(t=0;t<e.vaos.length;t++)x.deleteVertexArray(e.vaos[t].vao);e.vaos=void 0}var o=e.attributes;for(var s in o)void 0!==o[s].buffer&&(A(o[s].buffer),o[s].buffer=void 0);C.info.memory.geometries--}else{var a=bt[e.id];if(void 0!==a){for(t=0,i=a.length;t<i;t++){var l=a[t];if(void 0!==l.numMorphTargets){for(n=0,r=l.numMorphTargets;n<r;n++)x.deleteBuffer(l.__webglMorphTargetsBuffers[n]);delete l.__webglMorphTargetsBuffers}if(void 0!==l.numMorphNormals){for(n=0,r=l.numMorphNormals;n<r;n++)x.deleteBuffer(l.__webglMorphNormalsBuffers[n]);delete l.__webglMorphNormalsBuffers}Ne(l)}delete bt[e.id]}else Ne(e)}};this.deallocateGeometry=Ue;var ke,Fe,Ve,Ge,ze=function(e){if(e.__webglTextureCube)x.deleteTexture(e.__webglTextureCube),e.__webglTextureCube=void 0;else{if(!e.__webglInit)return;x.deleteTexture(e.__webglTexture),e.__webglInit=void 0,e.__webglTexture=void 0}},He=function(e){e&&e.__webglTexture&&(x.deleteTexture(e.__webglTexture),x.deleteFramebuffer(e.__webglFramebuffer),void 0!==e.__webglRenderbuffer&&x.deleteRenderbuffer(e.__webglRenderbuffer),void 0!==e.__webglRenderbufferOwn&&(x.deleteRenderbuffer(e.__webglRenderbufferOwn),e.__webglRenderbufferOwn=void 0))},We=function(e){var t=!1;e.program=void 0,e.programs.forEach((function(e){var i,n,r,o;if(void 0!==e&&null!=(i=e.program))for(n=0,r=T.length;n<r;n++)if((o=T[n])&&o.program===i){o.usedTimes--,0===o.usedTimes&&(T[n]=void 0,x.deleteProgram(i),C.info.memory.programs--,t=!0);break}}),!1),e.programs.length=0,t&&(T=T.filter((function(e){return void 0!==e})))};function je(e,t){var i=e.vertices.length,n=t.material;if(n.attributes)for(var r in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var s=1;"v2"===o.type?s=2:"v3"===o.type?s=3:"v4"===o.type?s=4:"c"===o.type&&(s=3),o.size=s,o.array=new Float32Array(i*s),o.buffer=x.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function qe(e,t){var i=t.geometry,n=e.faces3,r=3*n.length,o=1*n.length,s=3*n.length,a=Ke(t,e),l=Ze(a),c=Xe(a),u=Ye(a);e.__vertexArray=new Float32Array(3*r),c&&(e.__normalArray=new Float32Array(3*r)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*r)),u&&(e.__colorArray=new Float32Array(3*r)),l&&(i.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*r)),i.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*r))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*r),e.__skinWeightArray=new Float32Array(4*r));var h=o>21845?Uint32Array:Uint16Array;if(e.__typeArray=h,e.__faceArray=new h(3*o),e.__lineArray=new h(2*s),e.__webglFaceCount=3*o,e.__webglLineCount=2*s,a.attributes)for(var d in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),a.attributes){var f=a.attributes[d],p={};for(var m in f)p[m]=f[m];if(!p.__webglInitialized||p.createUniqueBuffers){p.__webglInitialized=!0;var g=1;"v2"===p.type?g=2:"v3"===p.type?g=3:"v4"===p.type?g=4:"c"===p.type&&(g=3),p.size=g,p.array=new Float32Array(r*g),p.buffer=x.createBuffer(),p.buffer.belongsToAttribute=d,f.needsUpdate=!0,p.__original=f}e.__webglCustomAttributesList.push(p)}e.__inittedArrays=!0}function Ke(e,t){return e.material instanceof v().MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Xe(e){return!(e instanceof v().MeshBasicMaterial&&!e.envMap||e instanceof v().MeshDepthMaterial)&&(function(e){return e&&(void 0!==e.shading&&e.shading===v().SmoothShading||void 0!==e.flatShading&&!1===e.flatShading)}(e)?v().SmoothShading:v().FlatShading)}function Ye(e){return!!e.vertexColors&&e.vertexColors}function Ze(e){return!!(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e instanceof v().ShaderMaterial)}function $e(e){return!0===e.needsUpdate}function Je(e){e.needsUpdate=!1}function et(e,t,i,n,r){if(e.__inittedArrays){var o,s,a,l,c,u,h,d,f,p,m,g,y,b,_,E,S,A,w,C,T,M,I,P,L,R,D=Xe(r),O=Ye(r),B=Ze(r),N=D===v().SmoothShading,U=0,k=0,F=0,V=0,G=0,z=0,H=0,W=0,j=0,q=0,K=e.__vertexArray,X=e.__uvArray,Y=e.__uv2Array,Q=e.__normalArray,Z=e.__tangentArray,$=e.__colorArray,J=e.__webglCustomAttributesList,ee=e.__faceArray,te=e.__lineArray,ie=t.geometry,ne=ie.verticesNeedUpdate,re=ie.elementsNeedUpdate,oe=ie.uvsNeedUpdate,se=ie.normalsNeedUpdate,ae=ie.tangentsNeedUpdate,le=ie.colorsNeedUpdate,ce=ie.vertices,ue=e.faces3,he=ie.faces,de=ie.faceVertexUvs[0],fe=ie.faceVertexUvs[1];if(ne){for(o=0,s=ue.length;o<s;o++)m=ce[(a=he[ue[o]]).a],g=ce[a.b],y=ce[a.c],K[k]=m.x,K[k+1]=m.y,K[k+2]=m.z,K[k+3]=g.x,K[k+4]=g.y,K[k+5]=g.z,K[k+6]=y.x,K[k+7]=y.y,K[k+8]=y.z,k+=9;x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,K,i)}if(le&&O){for(o=0,s=ue.length;o<s;o++)u=(a=he[ue[o]]).vertexColors,h=a.color,3===u.length&&O===v().VertexColors?(S=u[0],A=u[1],w=u[2]):(S=h,A=h,w=h),$[j]=S.r,$[j+1]=S.g,$[j+2]=S.b,$[j+3]=A.r,$[j+4]=A.g,$[j+5]=A.b,$[j+6]=w.r,$[j+7]=w.g,$[j+8]=w.b,j+=9;j>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,$,i))}if(ae&&ie.hasTangents){for(o=0,s=ue.length;o<s;o++)b=(d=(a=he[ue[o]]).vertexTangents)[0],_=d[1],E=d[2],Z[H]=b.x,Z[H+1]=b.y,Z[H+2]=b.z,Z[H+3]=b.w,Z[H+4]=_.x,Z[H+5]=_.y,Z[H+6]=_.z,Z[H+7]=_.w,Z[H+8]=E.x,Z[H+9]=E.y,Z[H+10]=E.z,Z[H+11]=E.w,H+=12;x.bindBuffer(x.ARRAY_BUFFER,e.__webglTangentBuffer),x.bufferData(x.ARRAY_BUFFER,Z,i)}if(se&&D){for(o=0,s=ue.length;o<s;o++)if(l=(a=he[ue[o]]).vertexNormals,c=a.normal,3===l.length&&N)for(C=0;C<3;C++)M=l[C],Q[z]=M.x,Q[z+1]=M.y,Q[z+2]=M.z,z+=3;else for(C=0;C<3;C++)Q[z]=c.x,Q[z+1]=c.y,Q[z+2]=c.z,z+=3;x.bindBuffer(x.ARRAY_BUFFER,e.__webglNormalBuffer),x.bufferData(x.ARRAY_BUFFER,Q,i)}if(oe&&de&&B){for(o=0,s=ue.length;o<s;o++)if(void 0!==(f=de[ue[o]]))for(C=0;C<3;C++)I=f[C],X[F]=I.x,X[F+1]=I.y,F+=2;F>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglUVBuffer),x.bufferData(x.ARRAY_BUFFER,X,i))}if(oe&&fe&&B){for(o=0,s=ue.length;o<s;o++)if(void 0!==(p=fe[ue[o]]))for(C=0;C<3;C++)P=p[C],Y[V]=P.x,Y[V+1]=P.y,V+=2;V>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglUV2Buffer),x.bufferData(x.ARRAY_BUFFER,Y,i))}if(re){for(o=0,s=ue.length;o<s;o++)ee[G]=U,ee[G+1]=U+1,ee[G+2]=U+2,G+=3,te[W]=U,te[W+1]=U+1,te[W+2]=U,te[W+3]=U+2,te[W+4]=U+1,te[W+5]=U+2,W+=6,U+=3;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,ee,i),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,te,i)}if(J)for(C=0,T=J.length;C<T;C++)if($e((R=J[C]).__original)){if(q=0,1===R.size){if(void 0===R.boundTo||"vertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)a=he[ue[o]],R.array[q]=R.value[a.a],R.array[q+1]=R.value[a.b],R.array[q+2]=R.value[a.c],q+=3;else if("faces"===R.boundTo)for(o=0,s=ue.length;o<s;o++)L=R.value[ue[o]],R.array[q]=L,R.array[q+1]=L,R.array[q+2]=L,q+=3}else if(2===R.size){if(void 0===R.boundTo||"vertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)a=he[ue[o]],m=R.value[a.a],g=R.value[a.b],y=R.value[a.c],R.array[q]=m.x,R.array[q+1]=m.y,R.array[q+2]=g.x,R.array[q+3]=g.y,R.array[q+4]=y.x,R.array[q+5]=y.y,q+=6;else if("faces"===R.boundTo)for(o=0,s=ue.length;o<s;o++)m=L=R.value[ue[o]],g=L,y=L,R.array[q]=m.x,R.array[q+1]=m.y,R.array[q+2]=g.x,R.array[q+3]=g.y,R.array[q+4]=y.x,R.array[q+5]=y.y,q+=6}else if(3===R.size){var pe;if(pe="c"===R.type?["r","g","b"]:["x","y","z"],void 0===R.boundTo||"vertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)a=he[ue[o]],m=R.value[a.a],g=R.value[a.b],y=R.value[a.c],R.array[q]=m[pe[0]],R.array[q+1]=m[pe[1]],R.array[q+2]=m[pe[2]],R.array[q+3]=g[pe[0]],R.array[q+4]=g[pe[1]],R.array[q+5]=g[pe[2]],R.array[q+6]=y[pe[0]],R.array[q+7]=y[pe[1]],R.array[q+8]=y[pe[2]],q+=9;else if("faces"===R.boundTo)for(o=0,s=ue.length;o<s;o++)m=L=R.value[ue[o]],g=L,y=L,R.array[q]=m[pe[0]],R.array[q+1]=m[pe[1]],R.array[q+2]=m[pe[2]],R.array[q+3]=g[pe[0]],R.array[q+4]=g[pe[1]],R.array[q+5]=g[pe[2]],R.array[q+6]=y[pe[0]],R.array[q+7]=y[pe[1]],R.array[q+8]=y[pe[2]],q+=9;else if("faceVertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)m=(L=R.value[ue[o]])[0],g=L[1],y=L[2],R.array[q]=m[pe[0]],R.array[q+1]=m[pe[1]],R.array[q+2]=m[pe[2]],R.array[q+3]=g[pe[0]],R.array[q+4]=g[pe[1]],R.array[q+5]=g[pe[2]],R.array[q+6]=y[pe[0]],R.array[q+7]=y[pe[1]],R.array[q+8]=y[pe[2]],q+=9}else if(4===R.size)if(void 0===R.boundTo||"vertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)a=he[ue[o]],m=R.value[a.a],g=R.value[a.b],y=R.value[a.c],R.array[q]=m.x,R.array[q+1]=m.y,R.array[q+2]=m.z,R.array[q+3]=m.w,R.array[q+4]=g.x,R.array[q+5]=g.y,R.array[q+6]=g.z,R.array[q+7]=g.w,R.array[q+8]=y.x,R.array[q+9]=y.y,R.array[q+10]=y.z,R.array[q+11]=y.w,q+=12;else if("faces"===R.boundTo)for(o=0,s=ue.length;o<s;o++)m=L=R.value[ue[o]],g=L,y=L,R.array[q]=m.x,R.array[q+1]=m.y,R.array[q+2]=m.z,R.array[q+3]=m.w,R.array[q+4]=g.x,R.array[q+5]=g.y,R.array[q+6]=g.z,R.array[q+7]=g.w,R.array[q+8]=y.x,R.array[q+9]=y.y,R.array[q+10]=y.z,R.array[q+11]=y.w,q+=12;else if("faceVertices"===R.boundTo)for(o=0,s=ue.length;o<s;o++)m=(L=R.value[ue[o]])[0],g=L[1],y=L[2],R.array[q]=m.x,R.array[q+1]=m.y,R.array[q+2]=m.z,R.array[q+3]=m.w,R.array[q+4]=g.x,R.array[q+5]=g.y,R.array[q+6]=g.z,R.array[q+7]=g.w,R.array[q+8]=y.x,R.array[q+9]=y.y,R.array[q+10]=y.z,R.array[q+11]=y.w,q+=12;x.bindBuffer(x.ARRAY_BUFFER,R.buffer),x.bufferData(x.ARRAY_BUFFER,R.array,i)}n&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function tt(e){if(e.streamingDraw===Ug&&(e.streamingDraw=!1,e.streamingIndex=!1,e.discardAfterUpload)){e.ib&&(e.ibLength=e.ib.length,e.ibByteSize=e.ib instanceof Uint32Array?4:2,e.ib=null),e.vb&&(e.vbLength=e.vb.length,e.vb=null),e.iblines&&(e.iblinesLength=e.iblines.length,e.iblinesByteSize=e.iblines instanceof Uint32Array?4:2,e.iblines=null);const t=e.attributes,i=Object.keys(e.attributes);for(let e=0,n=i.length;e<n;e++){const n=t[i[e]];n.array&&(n.arrayLength=n.array.length,n.arrayByteSize=n.array.byteLength,n.array=null)}}}function it(e,t,i,n){var r=i.vaos;if(r)for(var o=0,s=r.length;o<s;o++){var a=r[o];if(a.geomhash===t.id&&a.uv===n)return x.bindVertexArray(a.vao),!0}else if(null===r)return!1;return function(e,t,i,n){var r,o,s;if(!Xi||i.streamingDraw)return i.vaos=null,!1;if(void 0===i.vaos&&(i.vaos=[]),s=x.createVertexArray(),i.vaos.push({geomhash:t.id,uv:n,vao:s}),x.bindVertexArray(s),e.isEdgeMaterial)x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,i.iblinesbuffer);else{var a=i.index;a&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,a.buffer||i.ibbuffer)}for(var l=null,c=t.attributes,u=t.attributesKeys,h=i.vbstride,d=null!==(r=i.groups)&&void 0!==r&&r.length?i.groups[0].index:0,f=null!==(o=i.groups)&&void 0!==o&&o.length&&i.groups[0].instanceStart||0,p=0,m=u.length;p<m;p++){var g=u[p],v=c[g];if(v>=0){var y=i.attributes[g];if("uv"===g&&n&&(y=i.attributes["uv"+(n+1)]),!y){x.bindVertexArray(null);for(var b=0;b<i.vaos.length;b++)x.deleteVertexArray(i.vaos[b].vao);return i.vaos=null,!1}var _=x.FLOAT,E=y.bytesPerItem||4;1===E?_=x.UNSIGNED_BYTE:2===E&&(_=x.UNSIGNED_SHORT),x.enableVertexAttribArray(v);var S=d;y.divisor&&(S+=f),void 0!==y.itemOffset?(l!=i.vbbuffer&&(x.bindBuffer(x.ARRAY_BUFFER,i.vbbuffer),l=i.vbbuffer),x.vertexAttribPointer(v,y.itemSize,_,y.normalized,4*h,4*(y.itemOffset+S*h))):(x.bindBuffer(x.ARRAY_BUFFER,y.buffer),l=y.buffer,x.vertexAttribPointer(v,y.itemSize,_,y.normalized,0,S*y.itemSize*E)),x.vertexAttribDivisor(v,i.numInstances&&y.divisor||0)}}return!0}(e,t,i,n)}function nt(e,t){var i=W[e];return i||(i=x.createBuffer(),W[e]=i),x.bindBuffer(x.ARRAY_BUFFER,i),x.bufferData(x.ARRAY_BUFFER,t,x.DYNAMIC_DRAW),i}function rt(e,t,i,n,r,o,s){!0===s?x.vertexAttribIPointer(e,t,i,r,o):x.vertexAttribPointer(e,t,i,n,r,o)}function ot(e,t,i,n,r,o,s){var a,l=t.attributes,c=t.attributesKeys,u=0;if(r)if(!r.buffer&&i.streamingDraw){var h=W.index;h||(h=x.createBuffer(),W.index=h),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,h),e.isEdgeMaterial?x.bufferData(x.ELEMENT_ARRAY_BUFFER,i.iblines,x.DYNAMIC_DRAW):x.bufferData(x.ELEMENT_ARRAY_BUFFER,r.array||i.ib,x.DYNAMIC_DRAW)}else{var d,f,p,m;if(nn)if(e.isEdgeMaterial)x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,i.iblinesbuffer.getGlBuffer?i.iblinesbuffer.getGlBuffer():i.iblinesbuffer);else x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,(null===(d=r.buffer)||void 0===d||null===(f=d.getGlBuffer)||void 0===f?void 0:f.call(d))||r.buffer||(null!==(p=i.ibbuffer)&&void 0!==p&&p.getGlBuffer?null===(m=i.ibbuffer)||void 0===m?void 0:m.getGlBuffer():i.ibbuffer));else e.isEdgeMaterial?x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,i.iblinesbuffer):x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,r.buffer||i.ibbuffer)}for(var g=0,y=c.length;g<y;g++){var b=c[g],_=l[b];if(_>=0){var E=i.attributes[b];"uv"===b&&o&&(E=i.attributes["uv"+(o+1)]);var S=n;if(E){var A=x.FLOAT,w=E.bytesPerItem||4;1===w?A=x.UNSIGNED_BYTE:2===w&&(A=x.UNSIGNED_SHORT);var C,T,M=void 0!==E.itemOffset;M&&(w=4),M?(C=i.vbstride,T=E.itemOffset,u!==a&&(i.streamingDraw?u=nt("interleavedVB",i.vb):(u=i.vbbuffer.getGlBuffer?i.vbbuffer.getGlBuffer():i.vbbuffer,x.bindBuffer(x.ARRAY_BUFFER,u)),a=u)):(C=E.itemSize,T=0,i.streamingDraw?u=nt(b,E.array):E.buffer.getGlBuffer?(u=E.buffer.getGlBuffer(),x.bindBuffer(x.ARRAY_BUFFER,u),S+=E.buffer.offset/(C*w)):(u=E.buffer,x.bindBuffer(x.ARRAY_BUFFER,u))),ne.enableAttribute(_),M&&i.vbbuffer&&i.vbbuffer.getGlBuffer&&i.vbbuffer.getGlBuffer()===u&&(S+=i.vbbuffer.offset/(C*w)),E.divisor&&(S+=s),rt(_,E.itemSize,A,E.normalized,C*w,(T+S*C)*w,E.gpuType===v().IntType),x.vertexAttribDivisor(_,i.numInstances&&E.divisor||0)}else if(e.defaultAttributeValues){var I=e.defaultAttributeValues[b];I&&2===I.length?x.vertexAttrib2fv(_,e.defaultAttributeValues[b]):I&&3===I.length?x.vertexAttrib3fv(_,e.defaultAttributeValues[b]):I&&4===I.length&&x.vertexAttrib4fv(_,e.defaultAttributeValues[b])}}}ne.disableUnusedAttributes()}function st(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function at(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function lt(e){ut(e,!0)}function ct(e){ut(e,!1)}function ut(e,t,i){var n,r;if(i||!1!==e.visible){if(e instanceof v().Scene||e instanceof v().Group);else if(e instanceof Sc)e.forEach(t?lt:ct);else if(yt(e),e instanceof v().Light)f.push(e);else{var o=p[e.id];if(o&&(!1===e.frustumCulled||!0===j.intersectsObject(e)))for(n=0,r=o.length;n<r;n++){var s=o[n];vt(s),s.render=!0,!0===t&&(X.setFromMatrixPosition(e.matrixWorld),X.applyProjection(q),s.z=X.z)}}if(e.children)for(n=0,r=e.children.length;n<r;n++)ut(e.children[n],t,i)}}function ht(e,t){if(!t.getCustomOverrideMaterial)return t;var i=t.getCustomOverrideMaterial(e);return i||t}function dt(e,t,i,n,r){for(var o,s=0,a=e.length;s<a;s++){var l=e[s],c=l.object,u=l.buffer;if(r)o=ht(l.material,r);else{if(!(o=l.material))continue;Tt(o)}if(o.twoPassTransparency){var h=o.side;o.side=v().BackSide,ft(o,t,i,n,u,r,c),o.side=v().FrontSide,ft(o,t,i,n,u,r,c),o.side=h}else ft(o,t,i,n,u,r,c)}}function ft(e,t,i,n,r,o,s){if(C.setMaterialFaces(e),r instanceof v().BufferGeometry?C.renderBufferDirect(t,i,n,e,r,s):C.renderBuffer(t,i,n,e,r,s),e.decals)for(var a=e.decals,l=0,c=a.length;l<c;l++){var u=a[l];Tt(e=u.material),C.setMaterialFaces(e),r instanceof v().BufferGeometry&&C.renderBufferDirect(t,i,n,e,r,s,u.uv)}}function pt(e,t){if(e.visible&&!e.hide){var i;if(Ge)i=ht(e.material,Ge);else{if(!(i=e.material))return;Tt(i)}if(i.twoPassTransparency){var n=i.side;i.side=v().BackSide,mt(e,i),i.side=v().FrontSide,mt(e,i),i.side=n}else mt(e,i)}}function mt(e,t){if(C.setMaterialFaces(t),C.renderBufferDirect(ke,Fe,Ve,t,e.geometry,e),t.decals)for(var i=t.decals,n=0,r=i.length;n<r;n++){var o=i[n];Tt(t=o.material),C.setMaterialFaces(t),C.renderBufferDirect(ke,Fe,Ve,t,e.geometry,e,o.uv)}}function gt(e,t,i,n,r,o){Fe=n,Ve=r,Ge=o||null,ke=i,e.forEach(pt,e.forceVisible?1:32,!1)}function vt(e){var t=e.object,i=e.buffer,n=t.geometry,r=t.material;if(r instanceof v().MeshFaceMaterial){var o=n instanceof v().BufferGeometry?0:i.materialIndex;r=r.materials[o],e.material=r,r.transparent?b.push(e):y.push(e)}else r&&(e.material=r,r.transparent?b.push(e):y.push(e))}function yt(e){C.lostContextRecovery&&C.lostContextRecovery.refreshIfNeeded(e),void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",Le));var t=e.geometry;if(void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",Re),t instanceof v().BufferGeometry||(e instanceof v().Mesh?_t(e,t):e instanceof v().Line?void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=x.createBuffer(),e.__webglColorBuffer=x.createBuffer(),e.__webglLineDistanceBuffer=x.createBuffer(),C.info.memory.geometries++}(t),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i,je(e,t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e instanceof v().PointCloud&&void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=x.createBuffer(),e.__webglColorBuffer=x.createBuffer(),C.info.memory.geometries++}(t),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__webglPointCount=i,je(e,t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0))),void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof v().Mesh){if(t instanceof v().BufferGeometry)Et(p,t,e);else if(t instanceof v().Geometry)for(var i=bt[t.id],n=0,r=i.length;n<r;n++)Et(p,i[n],e)}else(e instanceof v().Line||e instanceof v().PointCloud)&&Et(p,t,e)}this.uploadGeometry=function(e){yt({geometry:e,__webglInit:!0}),C.lostContextRecovery&&C.lostContextRecovery.refreshIfNeeded(e),w(e)},this.renderBufferDirect=function(e,t,i,n,r,o,s){var a;if(C.lostContextRecovery&&C.lostContextRecovery.refreshIfNeeded(r),!1!==n.visible&&(!n.isEdgeMaterial||r.iblines||r.iblinesbuffer)){w(o.geometry);var l=Mt(e,t,i,n,o);if(null!==l){var c=!1,u=n.wireframe?1:0,h="direct_"+r.id+(s?"/"+s:"")+"_"+l.id+"_"+u;h!==O&&(O=h,c=!0);var d,f=null===(a=r.groups)||void 0===a?void 0:a.length,p=f&&r.groups.some((function(e){return e.index>=0||e.instanceStart>=0}));p?c=!0:(d=it(n,l,r,s||0),c=c&&!d),c&&ne.initAttributes();var m,g=r.index;if(g){var y,b=r.ibByteSize,_=g.array?g.array:r.ib;let e=r.ibLength;_&&(g.bytesPerItem=_.BYTES_PER_ELEMENT),n.isEdgeMaterial&&(g=r.attributes.indexlines,_=r.iblines,e=r.iblinesLength,b=r.iblinesByteSize),g.bytesPerItem?b=g.bytesPerItem:_&&(b=_ instanceof Uint32Array?4:_ instanceof Uint16Array?2:1),4===b?y=x.UNSIGNED_INT:2===b?y=x.UNSIGNED_SHORT:1===b&&(y=x.UNSIGNED_BYTE);var E=r.groups;f&&n.isEdgeMaterial&&!Object.prototype.hasOwnProperty.call(E[0],"edgeStart")&&(E=null);var S=0;do{var A,T,M,I,P;if(f){var L,R=E[S];A=R.index,T=n.isEdgeMaterial?R.edgeStart||0:R.start,M=n.isEdgeMaterial?R.edgeCount||(null===(L=_)||void 0===L?void 0:L.length)||e:R.count,I=R.instanceStart||0,P=R.numInstances||r.numInstances;var D=n.program.uniforms;if(D.themingColor&&"themingColor"in R){var B=R.themingColor;B instanceof v().Vector4?x.uniform4f(D.themingColor,B.x,B.y,B.z,B.w):x.uniform4f(D.themingColor,0,0,0,0)}}else{var N;A=0,T=0,M=(null===(N=_)||void 0===N?void 0:N.length)||e,I=0,P=r.numInstances}nn&&(n.isEdgeMaterial?T+=r.iblinesbuffer&&!r.streamingDraw?r.iblinesbuffer.offset/b:0:r.index.buffer?T+=r.index.buffer.getGlBuffer?r.index.buffer.offset/b:0:T+=r.ibbuffer&&!r.streamingDraw?r.ibbuffer.offset/b:0),c&&(ot(n,l,r,A,g,s,I),p||(c=!1)),m=x.TRIANGLES,r.isPoints||o instanceof v().PointCloud?m=x.POINTS:(r.isLines||n.isEdgeMaterial||o instanceof v().Line)&&(m=x.LINES),P?x.drawElementsInstanced(m,M,y,T*b,P):x.drawElements(m,M,y,T*b),++this.info.render.calls}while(E&&++S<E.length)}else{var U;(null===(U=r.groups)||void 0===U?void 0:U.length)>1&&console.error("Geometry with draw calls and no index buffer"),c&&ot(n,l,r,0,void 0,s,0);var k=r.attributes.position;m=x.TRIANGLES,r.isPoints||o instanceof v().PointCloud?m=x.POINTS:(r.isLines||n.isEdgeMaterial||o instanceof v().Line)&&(m=x.LINES),r.numInstances?x.drawArraysInstanced(m,0,k.array.length/3,r.numInstances):x.drawArrays(m,0,k.array.length/k.itemSize),++this.info.render.calls}d&&x.bindVertexArray(null)}}},this.renderBuffer=function(e,t,i,n,r,o){if(!1!==n.visible&&!n.isEdgeMaterial){!function(e){var t,i,n=e.geometry;if(n instanceof v().BufferGeometry)w(n);else if(e instanceof v().Mesh){!0===n.groupsNeedUpdate&&_t(e,n);for(var r=bt[n.id],o=0,s=r.length;o<s;o++){var a=r[o];t=(i=Ke(e,a)).attributes&&St(i),(n.verticesNeedUpdate||n.morphTargetsNeedUpdate||n.elementsNeedUpdate||n.uvsNeedUpdate||n.normalsNeedUpdate||n.colorsNeedUpdate||n.tangentsNeedUpdate||t)&&et(a,e,x.DYNAMIC_DRAW,!n.dynamic,i)}n.verticesNeedUpdate=!1,n.morphTargetsNeedUpdate=!1,n.elementsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.tangentsNeedUpdate=!1,i.attributes&&At(i)}else e instanceof v().Line?(t=(i=Ke(e,n)).attributes&&St(i),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.lineDistancesNeedUpdate||t)&&function(e,t){var i,n,r,o,s,a,l,c,u,h,d,f,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,y=m.length,b=g.length,_=e.__vertexArray,E=e.__colorArray,S=e.__lineDistanceArray,A=e.verticesNeedUpdate,w=e.colorsNeedUpdate,C=e.lineDistancesNeedUpdate,T=e.__webglCustomAttributesList;if(A){for(i=0;i<v;i++)o=p[i],_[s=3*i]=o.x,_[s+1]=o.y,_[s+2]=o.z;x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,_,t)}if(w){for(n=0;n<y;n++)a=m[n],E[s=3*n]=a.r,E[s+1]=a.g,E[s+2]=a.b;x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,E,t)}if(C){for(r=0;r<b;r++)S[r]=g[r];x.bindBuffer(x.ARRAY_BUFFER,e.__webglLineDistanceBuffer),x.bufferData(x.ARRAY_BUFFER,S,t)}if(T)for(l=0,c=T.length;l<c;l++)if($e(f=T[l])&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(s=0,h=f.value.length,1===f.size)for(u=0;u<h;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.x,f.array[s+1]=d.y,s+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.r,f.array[s+1]=d.g,f.array[s+2]=d.b,s+=3;else for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.x,f.array[s+1]=d.y,f.array[s+2]=d.z,s+=3;else if(4===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[s]=d.x,f.array[s+1]=d.y,f.array[s+2]=d.z,f.array[s+3]=d.w,s+=4;x.bindBuffer(x.ARRAY_BUFFER,f.buffer),x.bufferData(x.ARRAY_BUFFER,f.array,t)}}(n,x.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.lineDistancesNeedUpdate=!1,i.attributes&&At(i)):e instanceof v().PointCloud&&(t=(i=Ke(e,n)).attributes&&St(i),(n.verticesNeedUpdate||n.colorsNeedUpdate||t)&&function(e,t){var i,n,r,o,s,a,l,c,u,h,d,f=e.vertices,p=e.colors,m=f.length,g=p.length,v=e.__vertexArray,y=e.__colorArray,b=e.verticesNeedUpdate,_=e.colorsNeedUpdate,E=e.__webglCustomAttributesList;if(b){for(i=0;i<m;i++)r=f[i],v[o=3*i]=r.x,v[o+1]=r.y,v[o+2]=r.z;x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,v,t)}if(_){for(n=0;n<g;n++)s=p[n],y[o=3*n]=s.r,y[o+1]=s.g,y[o+2]=s.b;x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,y,t)}if(E)for(a=0,l=E.length;a<l;a++)if($e(d=E[a])&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(o=0,u=d.value.length,1===d.size)for(c=0;c<u;c++)d.array[c]=d.value[c];else if(2===d.size)for(c=0;c<u;c++)h=d.value[c],d.array[o]=h.x,d.array[o+1]=h.y,o+=2;else if(3===d.size)if("c"===d.type)for(c=0;c<u;c++)h=d.value[c],d.array[o]=h.r,d.array[o+1]=h.g,d.array[o+2]=h.b,o+=3;else for(c=0;c<u;c++)h=d.value[c],d.array[o]=h.x,d.array[o+1]=h.y,d.array[o+2]=h.z,o+=3;else if(4===d.size)for(c=0;c<u;c++)h=d.value[c],d.array[o]=h.x,d.array[o+1]=h.y,d.array[o+2]=h.z,d.array[o+3]=h.w,o+=4;x.bindBuffer(x.ARRAY_BUFFER,d.buffer),x.bufferData(x.ARRAY_BUFFER,d.array,t)}}(n,x.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,i.attributes&&At(i))}(o);var s=Mt(e,t,i,n,o),a=s.attributes,l=!1,c=n.wireframe?1:0,u=r.id+"_"+s.id+"_"+c;if(u!==O&&(O=u,l=!0),l&&ne.initAttributes(),!n.morphTargets&&a.position>=0&&l&&(x.bindBuffer(x.ARRAY_BUFFER,r.__webglVertexBuffer),ne.enableAttribute(a.position),g(a.position,3,x.FLOAT,!1,0,0)),l){if(r.__webglCustomAttributesList)for(var h=0,d=r.__webglCustomAttributesList.length;h<d;h++){var f=r.__webglCustomAttributesList[h];a[f.buffer.belongsToAttribute]>=0&&(x.bindBuffer(x.ARRAY_BUFFER,f.buffer),ne.enableAttribute(a[f.buffer.belongsToAttribute]),g(a[f.buffer.belongsToAttribute],f.size,x.FLOAT,!1,0,0))}a.color>=0&&(o.geometry.colors.length>0||o.geometry.faces.length>0?(x.bindBuffer(x.ARRAY_BUFFER,r.__webglColorBuffer),ne.enableAttribute(a.color),g(a.color,3,x.FLOAT,!1,0,0)):n.defaultAttributeValues&&x.vertexAttrib3fv(a.color,n.defaultAttributeValues.color)),a.normal>=0&&(x.bindBuffer(x.ARRAY_BUFFER,r.__webglNormalBuffer),ne.enableAttribute(a.normal),g(a.normal,3,x.FLOAT,!1,0,0)),a.tangent>=0&&(x.bindBuffer(x.ARRAY_BUFFER,r.__webglTangentBuffer),ne.enableAttribute(a.tangent),g(a.tangent,4,x.FLOAT,!1,0,0)),a.uv>=0&&(o.geometry.faceVertexUvs[0]?(x.bindBuffer(x.ARRAY_BUFFER,r.__webglUVBuffer),ne.enableAttribute(a.uv),g(a.uv,2,x.FLOAT,!1,0,0)):n.defaultAttributeValues&&x.vertexAttrib2fv(a.uv,n.defaultAttributeValues.uv)),a.uv2>=0&&(o.geometry.faceVertexUvs[1]?(x.bindBuffer(x.ARRAY_BUFFER,r.__webglUV2Buffer),ne.enableAttribute(a.uv2),g(a.uv2,2,x.FLOAT,!1,0,0)):n.defaultAttributeValues&&x.vertexAttrib2fv(a.uv2,n.defaultAttributeValues.uv2)),a.lineDistance>=0&&(x.bindBuffer(x.ARRAY_BUFFER,r.__webglLineDistanceBuffer),ne.enableAttribute(a.lineDistance),g(a.lineDistance,1,x.FLOAT,!1,0,0))}if(ne.disableUnusedAttributes(),o instanceof v().Mesh){var p=r.__typeArray===Uint32Array?x.UNSIGNED_INT:x.UNSIGNED_SHORT;n.wireframe?(ie.setLineWidth(n.wireframeLinewidth*this.getPixelRatio()),l&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,r.__webglLineBuffer),x.drawElements(x.LINES,r.__webglLineCount,p,0)):(l&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer),x.drawElements(x.TRIANGLES,r.__webglFaceCount,p,0)),++this.info.render.calls}else if(o instanceof v().Line){var m=o.mode===v().LineStrip?x.LINE_STRIP:x.LINES;ie.setLineWidth(n.linewidth*this.getPixelRatio()),x.drawArrays(m,0,r.__webglLineCount),++this.info.render.calls}else o instanceof v().PointCloud&&(x.drawArrays(x.POINTS,0,r.__webglPointCount),++this.info.render.calls)}function g(e,t,i,n,r,o){x.vertexAttribPointer(e,t,i,n,r,o),x.vertexAttribDivisor(e,0)}},this.render=function(e,t,i,n){var r,o,s;let a,l=i,c=n;if(arguments.length>2&&(i instanceof v().WebGLRenderTarget||Array.isArray(i))&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),a=i,l=n,c=arguments[4]),t instanceof v().Camera!=!1){if(!x.isContextLost()){O="",R=-1,D=null;for(let e of k)tt(e);k.clear(),void 0!==c&&(f.length=0,Q=!0);var u=e.fog;!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.worldUpTransform?K.multiplyMatrices(t.worldUpTransform,t.matrixWorld):K.copy(t.matrixWorld),q.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),j.setFromProjectionMatrix(q);var h=e instanceof Sc&&e.renderImmediate;if(h||(y.length=0,b.length=0,ut(e,e.sortObjects||!0===C.sortObjects,!0===e.forceVisible),(e.sortObjects||!0===C.sortObjects)&&(y.sort(at),b.sort(st))),Q&&(c&&c.length&&(f=c.slice()),Bt(f)),void 0!==a&&this.setRenderTarget(a),this.resetGLState(),(this.autoClear||l)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){let i=e.overrideMaterial;Tt(i),h?gt(e,"",t,f,u,i):(dt(y,t,f,u,i),dt(b,t,f,u,i))}else h?gt(e,"",t,f,u,null):(ie.setBlending(v().NoBlending),dt(y,t,f,u,null),dt(b,t,f,u,null));if(e.edgeMaterial){x.depthFunc(x.LESS);let i=e.edgeMaterial;Tt(i),h?gt(e,"",t,f,u,i):(dt(y,t,f,u,i),dt(b,t,f,u,i)),x.depthFunc(x.LEQUAL)}!L&&null!==(r=P)&&void 0!==r&&null!==(r=r.texture)&&void 0!==r&&r.generateMipmaps&&(null===(o=P)||void 0===o?void 0:o.texture.minFilter)!==v().NearestFilter&&(null===(s=P)||void 0===s?void 0:s.texture.minFilter)!==v().LinearFilter&&function(e){x.bindTexture(x.TEXTURE_2D,e.__webglTexture),x.generateMipmap(x.TEXTURE_2D),x.bindTexture(x.TEXTURE_2D,null)}(P),this.resetGLState(),ie.setDepthTest(!0),ie.setDepthWrite(!0)}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setProgramPrefix=function(e,t,i){B=e,N=t,U=i},this.getProgramPrefix=function(){return{programPrefix:B,vertexPrefix:N,fragmentPrefix:U}};var bt={},xt=0;function _t(e,t){var i=e.material,n=!1;void 0!==bt[t.id]&&!0!==t.groupsNeedUpdate||(delete p[e.id],bt[t.id]=function(e,t){for(var i,n,r={},o=e.morphTargets?e.morphTargets.length:0,s=e.morphNormals?e.morphNormals.length:0,a={},l=[],c=0,u=e.faces.length;c<u;c++){var h=e.faces[c],d=t?h.materialIndex:0;d in r||(r[d]={hash:d,counter:0}),(i=r[d].hash+"_"+r[d].counter)in a||(n={id:xt++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:o,numMorphNormals:s},a[i]=n,l.push(n)),a[i].vertices+3>4294967296&&(r[d].counter+=1,(i=r[d].hash+"_"+r[d].counter)in a||(n={id:xt++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:o,numMorphNormals:s},a[i]=n,l.push(n))),a[i].faces3.push(c),a[i].vertices+=3}return l}(t,i instanceof v().MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var r=bt[t.id],o=0,s=r.length;o<s;o++){var a=r[o];void 0===a.__webglVertexBuffer?(Pe(a),qe(a,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,n=!0):n=!1,(n||void 0===e.__webglActive)&&Et(p,a,e)}e.__webglActive=!0}function Et(e,t,i){var n=i.id;e[n]=e[n]||[],e[n].push({id:n,buffer:t,object:i,material:null,z:0})}function St(e){for(var t in e.attributes)if($e(e.attributes[t]))return!0;return!1}function At(e){for(var t in e.attributes)Je(e.attributes[t])}var wt={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshLambertMaterial:"lambert",LineDashedMaterial:"dashed",MeshBasicMaterial:"firefly_basic",LineBasicMaterial:"firefly_basic",PointCloudMaterial:"firefly_basic",PointsMaterial:"firefly_basic",MeshPhongMaterial:"firefly_phong"};function Ct(e,t,i,o){e.addEventListener("dispose",Be);var s=wt[e.type];if(s){var a=v().ShaderLib[s];let t=v().UniformsUtils.clone(a.uniforms);e.uniforms&&(t=v().UniformsUtils.merge([t,e.uniforms])),e.__webglShader={uniforms:t,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var l,c,h=function(e){for(var t=0,i=0,n=0,r=0,o=0,s=e.length;o<s;o++){var a=e[o];a.onlyShadow||(a instanceof v().DirectionalLight&&t++,a instanceof v().PointLight&&i++,a instanceof v().SpotLight&&n++,a instanceof v().HemisphereLight&&r++)}return{directional:t,point:i,spot:n,hemi:r}}(t),d={vertexShader:e.__webglShader.vertexShader,fragmentShader:e.__webglShader.fragmentShader,precision:n,precisionFragment:r,supportsVertexTextures:me,loadingAnimationDuration:C.loadingAnimationDuration,map:!!e.map,envMap:!!e.envMap,irradianceMap:!!e.irradianceMap,envIsSpherical:e.envMap&&e.envMap.mapping==v().SphericalReflectionMapping,envGammaEncoded:e.envMap&&e.envMap.GammaEncoded,irrGammaEncoded:e.irradianceMap&&e.irradianceMap.GammaEncoded,envRGBM:e.envMap&&e.envMap.RGBM,irrRGBM:e.irradianceMap&&e.irradianceMap.RGBM,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,vertexColors:e.vertexColors,vertexIds:e.vertexIds,flatShading:e.flatShading,useInstancing:e.useInstancing,wideLines:e.wideLines,fog:i,useFog:e.fog,useBackgroundTexture:e.useBackgroundTexture,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:u,polygonOffset:e.polygonOffset,maxDirLights:h.directional,maxPointLights:h.point,maxSpotLights:h.spot,maxHemiLights:h.hemi,alphaTest:e.alphaTest,metal:e.metal,clearcoat:e.clearcoat,wrapAround:e.wrapAround,doubleSided:e.side===v().DoubleSide,flipSided:e.side===v().BackSide,mrtNormals:e.mrtNormals,mrtIdBuffer:e.mrtIdBuffer,vertexPrefix:N,fragmentPrefix:U,tonemapOutput:e.tonemapOutput,packedNormals:e.packedNormals,hatchPattern:!!e.hatchParams,useTheming:!e.disableTheming,numCutplanes:e.cutplanes?e.cutplanes.length:0,useTiling:e.useTiling,tilingRepeatRange:e.useTiling&&e.tilingRepeatRange,hasRoundCorner:e.hasRoundCorner,useRandomOffset:e.useRandomOffset,mapInvert:e.map&&e.map.invert,mapClampS:e.map&&e.map.clampS,mapClampT:e.map&&e.map.clampT,bumpMapClampS:e.bumpMap&&e.bumpMap.clampS,bumpMapClampT:e.bumpMap&&e.bumpMap.clampT,normalMapClampS:e.normalMap&&e.normalMap.clampS,normalMapClampT:e.normalMap&&e.normalMap.clampT,specularMapClampS:e.specularMap&&e.specularMap.clampS,specularMapClampT:e.specularMap&&e.specularMap.clampT,alphaMapInvert:e.alphaMap&&e.alphaMap.invert,alphaMapClampS:e.alphaMap&&e.alphaMap.clampS,alphaMapClampT:e.alphaMap&&e.alphaMap.clampT},f=[];for(var p in s?f.push(s):(f.push(e.fragmentShader),f.push(e.vertexShader)),e.defines)f.push(p),f.push(e.defines[p]);for(l in d)f.push(l),f.push(d[l]);var m,g=f.join();for(l=0,c=T.length;l<c;l++){var y=T[l];if(y.code===g){(m=y).usedTimes++;break}}for(var b in void 0===m&&(e.onBeforeCompile(d,C),m=new aw(C,g,e,d,o.geometry),T.push(m),C.info.memory.programs=T.length),e.programs||(e.programs=[]),e.programs[B]=m,e.uniformsLists||(e.uniformsLists=[]),e.uniformsList=e.uniformsLists[B]=[],e.__webglShader.uniforms){var x=m.uniforms[b];x&&e.uniformsList.push([e.__webglShader.uniforms[b],x])}}function Tt(e){!0===e.transparent?ie.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):ie.setBlending(v().NoBlending),ie.setDepthTest(e.depthTest),ie.setDepthWrite(e.depthWrite),ie.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Mt(e,i,n,r,o){F=0,C.lostContextRecovery&&C.lostContextRecovery.refreshIfNeeded(r),$e(r)?(r.program&&We(r),Ct(r,i,n,o),Je(r)):r.programs&&r.programs[B]||Ct(r,i,n,o);var s=!1,a=!1,l=!1;r.uniformsList=r.uniformsLists[B];var c,h=r.program=r.programs[B],d=h.uniforms,f=r.__webglShader.uniforms;if(h.id!==M&&(x.useProgram(h.program),M=h.id,s=!0,a=!0,l=!0),r.id!==R&&(-1===R&&(l=!0),R=r.id,a=!0),d.meshAnimTime){var p=1;o.geometry.creationTime&&C.loadingAnimationDuration>0&&(p=Math.min((C.highResTimeStamp-o.geometry.creationTime)/C.loadingAnimationDuration,1)),x.uniform1f(d.meshAnimTime,p)}if((s||e!==D)&&(x.uniformMatrix4fv(d.projectionMatrix,!1,e.projectionMatrix.elements),u&&(x.uniform1f(d.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),r.polygonOffset&&x.uniform2f(d.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits)),e!==D&&(D=e),(r instanceof v().ShaderMaterial||r instanceof v().MeshPhongMaterial||r.envMap)&&null!==d.cameraPosition&&(X.setFromMatrixPosition(e.matrixWorld),x.uniform3f(d.cameraPosition,X.x,X.y,X.z)),(r instanceof v().MeshPhongMaterial||r instanceof v().MeshLambertMaterial||r instanceof v().ShaderMaterial||r.skinning)&&(null!==d.viewMatrix&&x.uniformMatrix4fv(d.viewMatrix,!1,e.matrixWorldInverse.elements),null!==d.viewMatrixInverse&&x.uniformMatrix4fv(d.viewMatrixInverse,!1,K.elements),d.mvpMatrix&&x.uniformMatrix4fv(d.mvpMatrix,!1,q.elements),l?(Pt(f,r),Lt(f,!0)):Lt(f,!1))),d.unpackXform){var y=o.geometry,b=y.unpackXform;if(b?x.uniform4f(d.unpackXform,b.x,b.y,b.z,b.w):x.uniform4f(d.unpackXform,1,1,0,0),d.tIdColor){x.uniform2f(d.vIdColorTexSize,y.vIdColorTexSize.x,y.vIdColorTexSize.y);var _=Dt();x.uniform1i(d.tIdColor,_),C.setTexture(y.tIdColor,_)}}if(a){if((r instanceof v().MeshPhongMaterial||r instanceof v().MeshLambertMaterial||r.lights)&&(Q&&(l=!0,Bt(i),Q=!1),l?(!function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(f,$),Rt(f,!0)):Rt(f,!1)),(r instanceof v().MeshBasicMaterial||r instanceof v().MeshLambertMaterial||r instanceof v().MeshPhongMaterial)&&(!function(e,t){e.opacity.value=t.opacity,e.diffuse.value.copy(t.color),e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));function i(e,t,i,n){const{x:r,y:o}=i,{x:s,y:a}=t,l=r*Math.cos(n),c=r*Math.sin(n),u=o*Math.cos(n),h=o*Math.sin(n),d=e.elements,f=d[0],p=d[3],m=d[6],g=d[1],v=d[4],y=d[7],b=d[2],x=d[5],_=d[8];d[0]=f*l+g*c+b*s,d[3]=p*l+v*c+x*s,d[6]=m*l+y*c+_*s,d[1]=f*-h+g*u+b*a,d[4]=p*-h+v*u+x*a,d[7]=m*-h+y*u+_*a}function n(e,t,n){const{offset:r,repeat:o,rotation:s}=n;if(t){var a=t.value;n.matrix?a.copy(n.matrix):a.identity(),i(a,r,o,s??0)}else e.offsetRepeat.value.set(r.x,r.y,o.x,o.y)}t.alphaMap&&n(e,e.texMatrixAlpha,t.alphaMap);var r,o;t.normalMap?r=t.normalMap:t.bumpMap&&(r=t.bumpMap);void 0!==r&&n(e,e.texMatrixBump,r);t.map?o=t.map:t.specularMap&&(o=t.specularMap);void 0!==o&&n(e,e.texMatrix,o);e.envMap.value=t.envMap,e.irradianceMap&&(e.irradianceMap.value=t.irradianceMap);e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(f,r),Pt(f,r)),r instanceof v().PointCloudMaterial||r instanceof v().PointsMaterial?function(e,t){It(e,t),e.point_size.value=t.size,e.map.value=t.map}(f,r):r instanceof v().LineBasicMaterial?It(f,r):r instanceof v().LineDashedMaterial?(It(f,r),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(f,r)):r instanceof v().MeshPhongMaterial?function(e,t){if(e.shininess.value=t.shininess,e.reflMipIndex){var i=Math.log(Math.max(1+1e-10,t.shininess));e.reflMipIndex.value=Math.max(0,-.72134752*i+5.5)}e.emissive&&e.emissive.value.copy(t.emissive);e.specular.value.copy(t.specular),e.exposureBias&&(e.exposureBias.value=t.exposureBias)}(f,r):r instanceof v().MeshLambertMaterial?function(e,t){e.emissive.value.copy(t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(f,r):r instanceof v().MeshDepthMaterial?(f.mNear.value=e.near,f.mFar.value=e.far,f.opacity.value=r.opacity):r instanceof v().MeshNormalMaterial?f.opacity.value=r.opacity:"function"==typeof r.refreshUniforms&&r.refreshUniforms(f),r.wideLines){var E=o.geometry.lineWidth;void 0!==r.linewidth&&(E=r.linewidth);const e=1/Math.max(Number.EPSILON,E);f.view_size.value=new(v().Vector2)(t.width*e,t.height*e)}HA&&r.shadowMap&&HA.RefreshUniformsShadow(f,r);var S=f.cutplanes;r.cutplanes&&r.cutplanes.length>0&&S&&(S.value=r.cutplanes,null!=f&&f.cutplanesHideInterior&&(f.cutplanesHideInterior.value=r.cutplanesHideInterior),S._array&&S._array.length!=4*r.cutplanes&&(S._array=void 0)),r.hatchParams&&f.hatchParams&&(f.hatchParams.value.copy(r.hatchParams),f.hatchTintColor.value.copy(r.hatchTintColor),f.hatchTintIntensity.value=r.hatchTintIntensity),function(e){for(var t,i,n,r=0,o=e.length;r<o;r++){var s=e[r][0];if(!1!==s.needsUpdate&&!s.perObject){var a,l,c=s.type,u=s.value,h=e[r][1];switch(c){case"1i":case"i":x.uniform1i(h,u);break;case"1f":case"f":x.uniform1f(h,u);break;case"2f":x.uniform2f(h,u[0],u[1]);break;case"3f":x.uniform3f(h,u[0],u[1],u[2]);break;case"4f":x.uniform4f(h,u[0],u[1],u[2],u[3]);break;case"1iv":case"iv1":x.uniform1iv(h,u);break;case"3iv":case"iv":x.uniform3iv(h,u);break;case"1fv":case"fv1":x.uniform1fv(h,u);break;case"2fv":x.uniform2fv(h,u);break;case"3fv":case"fv":x.uniform3fv(h,u);break;case"4fv":x.uniform4fv(h,u);break;case"Matrix3fv":x.uniformMatrix3fv(h,!1,u);break;case"Matrix4fv":x.uniformMatrix4fv(h,!1,u);break;case"v2":x.uniform2f(h,u.x,u.y);break;case"v3":x.uniform3f(h,u.x,u.y,u.z);break;case"v4":x.uniform4f(h,u.x,u.y,u.z,u.w);break;case"c":x.uniform3f(h,u.r,u.g,u.b);break;case"v2v":for(void 0===s._array&&(s._array=new Float32Array(2*u.length)),a=0,l=u.length;a<l;a++)n=2*a,s._array[n]=u[a].x,s._array[n+1]=u[a].y;x.uniform2fv(h,s._array);break;case"v3v":for(void 0===s._array&&(s._array=new Float32Array(3*u.length)),a=0,l=u.length;a<l;a++)n=3*a,s._array[n]=u[a].x,s._array[n+1]=u[a].y,s._array[n+2]=u[a].z;x.uniform3fv(h,s._array);break;case"v4v":for(void 0===s._array&&(s._array=new Float32Array(4*u.length)),a=0,l=u.length;a<l;a++)n=4*a,s._array[n]=u[a].x,s._array[n+1]=u[a].y,s._array[n+2]=u[a].z,s._array[n+3]=u[a].w;x.uniform4fv(h,s._array);break;case"m3":x.uniformMatrix3fv(h,!1,u.elements);break;case"m3v":for(void 0===s._array&&(s._array=new Float32Array(9*u.length)),a=0,l=u.length;a<l;a++)u[a].flattenToArrayOffset(s._array,9*a);x.uniformMatrix3fv(h,!1,s._array);break;case"m4":x.uniformMatrix4fv(h,!1,u.elements);break;case"m4v":for(void 0===s._array&&(s._array=new Float32Array(16*u.length)),a=0,l=u.length;a<l;a++)u[a].flattenToArrayOffset(s._array,16*a);x.uniformMatrix4fv(h,!1,s._array);break;case"t":if(t=u,i=Dt(),x.uniform1i(h,i),!t){x.activeTexture(x.TEXTURE0+i),x.bindTexture(x.TEXTURE_2D,ue.__webglTexture);continue}C.lostContextRecovery&&C.lostContextRecovery.refreshIfNeeded(t),Array.isArray(t.image)&&6===t.image.length||t instanceof v().CubeTexture?$e(t)?kt(t,i):(x.activeTexture(x.TEXTURE0+i),x.bindTexture(x.TEXTURE_CUBE_MAP,t.__webglTextureCube)):t instanceof v().WebGLRenderTargetCube?Ft(t,i):C.setTexture(t,i);break;case"tv":for(void 0===s._array&&(s._array=[]),a=0,l=s.value.length;a<l;a++)s._array[a]=Dt();for(x.uniform1iv(h,s._array),a=0,l=s.value.length;a<l;a++)t=s.value[a],i=s._array[a],t&&(C.lostContextRecovery&&C.lostContextRecovery.refreshIfNeeded(t),C.setTexture(t,i));break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+c)}}}}(r.uniformsList)}if(function(e,t,i){m.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),x.uniformMatrix4fv(e.modelViewMatrix,!1,m.elements),e.normalMatrix&&(g.getNormalMatrix(m),x.uniformMatrix3fv(e.normalMatrix,!1,g.elements));null!==e.modelMatrix&&x.uniformMatrix4fv(e.modelMatrix,!1,t.matrixWorld.elements);e.modelLocalMatrix&&x.uniformMatrix4fv(e.modelLocalMatrix,!1,t.matrix.elements)}(d,o,e),d.modelId){d.dbId&&(c=o.dbId||o.fragId||0,x.uniform3f(d.dbId,(255&c)/255,(c>>8&255)/255,(c>>16&255)/255));var A=o.modelId;x.uniform3f(d.modelId,(255&A)/255,(A>>8&255)/255,(c>>24&255)/255)}else null!==d.dbId&&(c=o.dbId||o.fragId||0,x.uniform3f(d.dbId,(255&c)/255,(c>>8&255)/255,(c>>16&255)/255));if(d.themingColor){var w=o.themingColor;w instanceof v().Vector4?x.uniform4f(d.themingColor,w.x,w.y,w.z,w.w):x.uniform4f(d.themingColor,0,0,0,0)}if(null!=o&&o.ubos)for(let e=0;e<h.ubos.length;e++){let t=h.ubos[e];o.ubos[t]&&(x.uniformBlockBinding(h.program,e,e),x.bindBufferBase(x.UNIFORM_BUFFER,e,o.ubos[t].buffer))}return h}function It(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Pt(e,t){e.envMap&&(e.envMap.value=t.envMap),e.irradianceMap&&(e.irradianceMap.value=t.irradianceMap),e.envMapExposure&&(e.envMapExposure.value=t.envMapExposure),e.envRotationSin&&e.envRotationCos&&(e.envRotationSin.value=t.envRotationSin,e.envRotationCos.value=t.envRotationCos)}function Lt(e,t){e.envMap&&(e.envMap.needsUpdate=t),e.irradianceMap&&(e.irradianceMap.needsUpdate=t),e.envMapExposure&&(e.envMapExposure.needsUpdate=t)}function Rt(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Dt(){var e=F;return e>=he&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+he),F+=1,e}function Ot(e,t,i,n){e[t]=i.r*n,e[t+1]=i.g*n,e[t+2]=i.b*n}function Bt(e){var t,i,n,r,o,s,a,l,c=0,u=0,h=0,d=$,f=d.directional.colors,p=d.directional.positions,m=d.point.colors,g=d.point.positions,y=d.point.distances,b=d.spot.colors,x=d.spot.positions,_=d.spot.distances,E=d.spot.directions,S=d.spot.anglesCos,A=d.spot.exponents,w=d.hemi.skyColors,C=d.hemi.groundColors,T=d.hemi.positions,M=0,I=0,P=0,L=0,R=0,D=0,O=0,B=0,N=0,U=0,k=0,F=0;for(t=0,i=e.length;t<i;t++)if(!(n=e[t]).onlyShadow)if(r=n.color,a=n.intensity,l=n.distance,n instanceof v().AmbientLight){if(!n.visible)continue;c+=r.r,u+=r.g,h+=r.b}else if(n instanceof v().DirectionalLight){if(R+=1,!n.visible)continue;Y.setFromMatrixPosition(n.matrixWorld),X.setFromMatrixPosition(n.target.matrixWorld),Y.sub(X),Y.normalize(),p[N=3*M]=Y.x,p[N+1]=Y.y,p[N+2]=Y.z,Ot(f,N,r,a),M+=1}else if(n instanceof v().PointLight){if(D+=1,!n.visible)continue;Ot(m,U=3*I,r,a),X.setFromMatrixPosition(n.matrixWorld),g[U]=X.x,g[U+1]=X.y,g[U+2]=X.z,y[I]=l,I+=1}else if(n instanceof v().SpotLight){if(O+=1,!n.visible)continue;Ot(b,k=3*P,r,a),X.setFromMatrixPosition(n.matrixWorld),x[k]=X.x,x[k+1]=X.y,x[k+2]=X.z,_[P]=l,Y.copy(X),X.setFromMatrixPosition(n.target.matrixWorld),Y.sub(X),Y.normalize(),E[k]=Y.x,E[k+1]=Y.y,E[k+2]=Y.z,S[P]=Math.cos(n.angle),A[P]=n.exponent,P+=1}else if(n instanceof v().HemisphereLight){if(B+=1,!n.visible)continue;Y.setFromMatrixPosition(n.matrixWorld),Y.normalize(),T[F=3*L]=Y.x,T[F+1]=Y.y,T[F+2]=Y.z,o=n.color,s=n.groundColor,Ot(w,F,o,a),Ot(C,F,s,a),L+=1}for(t=3*M,i=Math.max(f.length,3*R);t<i;t++)f[t]=0;for(t=3*I,i=Math.max(m.length,3*D);t<i;t++)m[t]=0;for(t=3*P,i=Math.max(b.length,3*O);t<i;t++)b[t]=0;for(t=3*L,i=Math.max(w.length,3*B);t<i;t++)w[t]=0;for(t=3*L,i=Math.max(C.length,3*B);t<i;t++)C[t]=0;d.directional.length=M,d.point.length=I,d.spot.length=P,d.hemi.length=L,d.ambient[0]=c,d.ambient[1]=u,d.ambient[2]=h}function Nt(e,t,i){var n;i?(x.texParameteri(e,x.TEXTURE_WRAP_S,Wt(t.wrapS)),x.texParameteri(e,x.TEXTURE_WRAP_T,Wt(t.wrapT)),x.texParameteri(e,x.TEXTURE_MAG_FILTER,Wt(t.magFilter)),x.texParameteri(e,x.TEXTURE_MIN_FILTER,Wt(t.minFilter))):(x.texParameteri(e,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(e,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),t.wrapS===v().ClampToEdgeWrapping&&t.wrapT===v().ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),x.texParameteri(e,x.TEXTURE_MAG_FILTER,zt(t.magFilter)),x.texParameteri(e,x.TEXTURE_MIN_FILTER,zt(t.minFilter)),t.minFilter!==v().NearestFilter&&t.minFilter!==v().LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(n=te.get("EXT_texture_filter_anisotropic"))&&t.type!==v().FloatType&&t.type!==v().HalfFloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(x.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,C.getMaxAnisotropy())),t.__oldAnisotropy=t.anisotropy)}function Ut(e,t){if(e.width<=t&&e.height<=t)return e;if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var i=t/Math.max(e.width,e.height),n=Math.max(Math.floor(e.width*i),1),r=Math.max(Math.floor(e.height*i),1),o=_w.createElement("canvas");return o.width=n,o.height=r,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n,r),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}function kt(e,t){if(6===e.image.length)if($e(e)){e.__webglTextureCube||(e.addEventListener("dispose",De),e.__webglTextureCube=x.createTexture(),C.info.memory.textures++),x.activeTexture(x.TEXTURE0+t),x.bindTexture(x.TEXTURE_CUBE_MAP,e.__webglTextureCube),x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,e.flipY);var i,n=e instanceof v().CompressedTexture,r=e.image[0]instanceof v().DataTexture,o=[];for(i=0;i<6;i++)!C.autoScaleCubemaps||n||r?o[i]=r?e.image[i].image:e.image[i]:o[i]=Ut(e.image[i],pe);var s=o[0],a=v().Math.isPowerOfTwo(s.width)&&v().Math.isPowerOfTwo(s.height),l=Wt(e.format),c=Wt(e.type);for(Nt(x.TEXTURE_CUBE_MAP,e,a),i=0;i<6;i++)if(n)for(var u,h=o[i].mipmaps,d=0,f=h.length;d<f;d++)u=h[d],e.format!==v().RGBAFormat&&e.format!==v().RGBFormat?we().indexOf(l)>-1?x.compressedTexImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+i,d,l,u.width,u.height,0,u.data):console.warn("Attempt to load unsupported compressed texture format"):x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+i,d,l,u.width,u.height,0,l,c,u.data);else r?x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,l,o[i].width,o[i].height,0,l,c,o[i].data):x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,l,l,c,o[i]);e.generateMipmaps&&a&&x.generateMipmap(x.TEXTURE_CUBE_MAP),Je(e),e.onUpdate&&e.onUpdate()}else x.activeTexture(x.TEXTURE0+t),x.bindTexture(x.TEXTURE_CUBE_MAP,e.__webglTextureCube)}function Ft(e,t){x.activeTexture(x.TEXTURE0+t),x.bindTexture(x.TEXTURE_CUBE_MAP,e.__webglTexture)}function Vt(e){var t=x.COLOR_ATTACHMENT0,i=[t];for(_e=1;_e<e.length;_e++)i.push(t+_e);x.drawBuffers(i)}function Gt(e){var t=v().Math.isPowerOfTwo(e.width)&&v().Math.isPowerOfTwo(e.height),i=Wt(e.texture.format),n=Wt(e.texture.type),r=Ht(e.texture.format,e.texture.type);e.addEventListener("dispose",Oe),e.__webglTexture=x.createTexture(),C.info.memory.textures++,x.bindTexture(x.TEXTURE_2D,e.__webglTexture),Nt(x.TEXTURE_2D,e.texture,t),x.texImage2D(x.TEXTURE_2D,0,r,e.width,e.height,0,i,n,null),t&&e.texture.generateMipmaps&&x.generateMipmap(x.TEXTURE_2D)}function zt(e){return e===v().NearestFilter||e===v().NearestMipMapNearestFilter||e===v().NearestMipMapLinearFilter?x.NEAREST:x.LINEAR}function Ht(e,t){if(e===v().RGBFormat)switch(t){case v().UnsignedByteType:return x.RGB8;case v().FloatType:return x.RGB32F;case v().HalfFloatType:return x.RGB16F}else if(e===v().RGBAFormat)switch(t){case v().UnsignedByteType:return x.RGBA8;case v().FloatType:return x.RGBA32F;case v().HalfFloatType:return x.RGBA16F}else if(e===v().LuminanceFormat&&t===v().UnsignedByteType)return x.LUMINANCE;return console.error("failed to map texture format and type to internalformat"),Wt(e)}function Wt(e){var t;if(e===v().RepeatWrapping)return x.REPEAT;if(e===v().ClampToEdgeWrapping)return x.CLAMP_TO_EDGE;if(e===v().MirroredRepeatWrapping)return x.MIRRORED_REPEAT;if(e===v().NearestFilter)return x.NEAREST;if(e===v().NearestMipMapNearestFilter)return x.NEAREST_MIPMAP_NEAREST;if(e===v().NearestMipMapLinearFilter)return x.NEAREST_MIPMAP_LINEAR;if(e===v().LinearFilter)return x.LINEAR;if(e===v().LinearMipMapNearestFilter)return x.LINEAR_MIPMAP_NEAREST;if(e===v().LinearMipMapLinearFilter)return x.LINEAR_MIPMAP_LINEAR;if(e===v().UnsignedByteType)return x.UNSIGNED_BYTE;if(e===v().UnsignedShort4444Type)return x.UNSIGNED_SHORT_4_4_4_4;if(e===v().UnsignedShort5551Type)return x.UNSIGNED_SHORT_5_5_5_1;if(e===v().UnsignedShort565Type)return x.UNSIGNED_SHORT_5_6_5;if(e===v().ByteType)return x.BYTE;if(e===v().ShortType)return x.SHORT;if(e===v().UnsignedShortType)return x.UNSIGNED_SHORT;if(e===v().IntType)return x.INT;if(e===v().UnsignedIntType)return x.UNSIGNED_INT;if(e===v().FloatType)return x.FLOAT;if(e===v().HalfFloatType)return x.HALF_FLOAT;if(e===v().AlphaFormat)return x.ALPHA;if(e===v().RGBFormat)return x.RGB;if(e===v().RGBAFormat)return x.RGBA;if(e===v().LuminanceFormat)return x.LUMINANCE;if(e===v().LuminanceAlphaFormat)return x.LUMINANCE_ALPHA;if(e===v().AddEquation)return x.FUNC_ADD;if(e===v().MinEquation)return x.MIN;if(e===v().MaxEquation)return x.MAX;if(e===v().SubtractEquation)return x.FUNC_SUBTRACT;if(e===v().ReverseSubtractEquation)return x.FUNC_REVERSE_SUBTRACT;if(e===v().ZeroFactor)return x.ZERO;if(e===v().OneFactor)return x.ONE;if(e===v().SrcColorFactor)return x.SRC_COLOR;if(e===v().OneMinusSrcColorFactor)return x.ONE_MINUS_SRC_COLOR;if(e===v().SrcAlphaFactor)return x.SRC_ALPHA;if(e===v().OneMinusSrcAlphaFactor)return x.ONE_MINUS_SRC_ALPHA;if(e===v().DstAlphaFactor)return x.DST_ALPHA;if(e===v().OneMinusDstAlphaFactor)return x.ONE_MINUS_DST_ALPHA;if(e===v().DstColorFactor)return x.DST_COLOR;if(e===v().OneMinusDstColorFactor)return x.ONE_MINUS_DST_COLOR;if(e===v().SrcAlphaSaturateFactor)return x.SRC_ALPHA_SATURATE;if(null!==(t=te.get("WEBGL_compressed_texture_s3tc"))){if(e===v().RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===v().RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===v().RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===v().RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=te.get("WEBGL_compressed_texture_pvrtc"))){if(e===v().RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===v().RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===v().RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===v().RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=te.get("EXT_blend_minmax"))){if(e===v().MinEquation)return t.MIN_EXT;if(e===v().MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===v().CullFaceNone?x.disable(x.CULL_FACE):(t===v().FrontFaceDirectionCW?x.frontFace(x.CW):x.frontFace(x.CCW),e===v().CullFaceBack?x.cullFace(x.BACK):e===v().CullFaceFront?x.cullFace(x.FRONT):x.cullFace(x.FRONT_AND_BACK),x.enable(x.CULL_FACE))},this.setMaterialFaces=function(e){ie.setDoubleSided(e.side===v().DoubleSide),ie.setFlipSided(e.side===v().BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",De),e.__webglTexture=x.createTexture(),C.info.memory.textures++),x.bindTexture(x.TEXTURE_2D,e.__webglTexture),x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,e.flipY),x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),x.pixelStorei(x.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=Ut(e.image,fe);var t=e.image,i=v().Math.isPowerOfTwo(t.width)&&v().Math.isPowerOfTwo(t.height),n=Wt(e.format),r=Wt(e.type),o=Ht(e.format,e.type);Nt(x.TEXTURE_2D,e,i);var s,a,l,c=e.mipmaps;if(e instanceof v().DataTexture)if(c.length>0&&i){for(a=0,l=c.length;a<l;a++)s=c[a],x.texImage2D(x.TEXTURE_2D,a,o,s.width,s.height,0,n,r,s.data);e.generateMipmaps=!1}else x.texImage2D(x.TEXTURE_2D,0,o,t.width,t.height,0,n,r,t.data);else if(e instanceof v().CompressedTexture){for(a=0,l=c.length;a<l;a++)s=c[a],e.format!==v().RGBAFormat&&e.format!==v().RGBFormat?we().indexOf(n)>-1?x.compressedTexImage2D(x.TEXTURE_2D,a,o,s.width,s.height,0,s.data):console.warn("Attempt to load unsupported compressed texture format"):x.texImage2D(x.TEXTURE_2D,a,o,s.width,s.height,0,n,r,s.data);if(c.length>1&&we().indexOf(n)>-1)for(var u,h=s.width>>1,d=s.height>>1,f=c.length;h>=1||d>=1;)u=4==s.width&&4==s.height?s.data:new DataView(s.data.buffer,s.data.byteOffset,s.data.byteLength*(Math.max(h,4)*Math.max(d,4))/(s.width*s.height)),x.compressedTexImage2D(x.TEXTURE_2D,f,o,Math.max(h,1),Math.max(d,1),0,u),h>>=1,d>>=1,++f}else if(c.length>0&&i){for(a=0,l=c.length;a<l;a++)x.texImage2D(x.TEXTURE_2D,a,o,n,r,c[a]);e.generateMipmaps=!1}else x.texImage2D(x.TEXTURE_2D,0,o,n,r,e.image);e.generateMipmaps&&i&&x.generateMipmap(x.TEXTURE_2D),Je(e),e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){x.activeTexture(x.TEXTURE0+t),$e(e)?C.uploadTexture(e):e.__webglTexture?x.bindTexture(x.TEXTURE_2D,e.__webglTexture):x.bindTexture(x.TEXTURE_2D,ue.__webglTexture)},C.uploadTexture(ue),this.initFrameBufferMRT=function(e,t){var i=e[0],n=!1;if(i&&!i.__webglFramebuffer){var r;if(void 0===i.depthBuffer&&(i.depthBuffer=!0),void 0===i.stencilBuffer&&(i.stencilBuffer=!0),i.__webglFramebuffer=x.createFramebuffer(),x.bindFramebuffer(x.FRAMEBUFFER,i.__webglFramebuffer),i.shareDepthFrom)r=i.__webglRenderbuffer=i.shareDepthFrom.__webglRenderbuffer,i.__isUsingShared=!0;else if(r=i.__webglRenderbuffer,i.__isUsingShared=!1,i.depthBuffer){let e;r||(r=i.__webglRenderbuffer=x.createRenderbuffer(),i.__webglRenderbufferOwn=r),x.bindRenderbuffer(x.RENDERBUFFER,r),e=i.stencilBuffer?x.DEPTH24_STENCIL8:x.DEPTH_COMPONENT32F,x.renderbufferStorage(x.RENDERBUFFER,e,i.width,i.height)}if(i.depthBuffer){const e=i.stencilBuffer?x.DEPTH_STENCIL_ATTACHMENT:x.DEPTH_ATTACHMENT;x.framebufferRenderbuffer(x.FRAMEBUFFER,e,x.RENDERBUFFER,r)}n=!0}else if(i)if(i.shareDepthFrom&&0==i.__isUsingShared){if(r=i.shareDepthFrom.__webglRenderbuffer,i.__isUsingShared=!0,i.depthBuffer){const e=i.stencilBuffer?x.DEPTH_STENCIL_ATTACHMENT:x.DEPTH_ATTACHMENT;x.framebufferRenderbuffer(x.FRAMEBUFFER,e,x.RENDERBUFFER,r)}}else if(null==i.shareDepthFrom&&1==i.__isUsingShared){if(r=i.__webglRenderbufferOwn,i.__isUsingShared=!1,null==r&&i.depthBuffer){let e;r=i.__webglRenderbuffer=x.createRenderbuffer(),i.__webglRenderbufferOwn=r,x.bindRenderbuffer(x.RENDERBUFFER,r),e=i.stencilBuffer?x.DEPTH24_STENCIL8:x.DEPTH_COMPONENT32F,x.renderbufferStorage(x.RENDERBUFFER,e,i.width,i.height)}if(i.depthBuffer){const e=i.stencilBuffer?x.DEPTH_STENCIL_ATTACHMENT:x.DEPTH_ATTACHMENT;x.framebufferRenderbuffer(x.FRAMEBUFFER,e,x.RENDERBUFFER,r)}}var o=I;if(x.bindFramebuffer(x.FRAMEBUFFER,i.__webglFramebuffer),function(e,t){let i=e.__webglBoundBuffers;if(!i)return!0;if(i.length!==t.length)return!0;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!0;return!1}(i,e)){var s;for(s=0;s<e.length;s++){var a=e[s];a&&!a.__webglTexture&&Gt(a),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0+s,x.TEXTURE_2D,a&&a.__webglTexture,0)}s=e.length;for(var l=i.__webglBoundBuffers&&i.__webglBoundBuffers.length||s;s<l;)x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0+s,x.TEXTURE_2D,null,0),s++;i.__webglBoundBuffers=e.slice()}if(Vt(e),t){var c=x.checkFramebufferStatus(x.FRAMEBUFFER);c!==x.FRAMEBUFFER_COMPLETE&&(console.log("Can't use multiple render targets. Falling back to two passes. "+c),o===i.__webglFramebuffer&&(o=I=null),x.bindFramebuffer(x.FRAMEBUFFER,o),x.deleteFramebuffer(i.__webglFramebuffer),delete i.__webglFramebuffer,t=!1)}return x.bindFramebuffer(x.FRAMEBUFFER,o),n&&(x.bindTexture(x.TEXTURE_2D,null),x.bindRenderbuffer(x.RENDERBUFFER,null),x.bindFramebuffer(x.FRAMEBUFFER,null)),t},this.setRenderTarget=function(e){var t,i,n,r,o,s;if(Array.isArray(e)&&e.length>0?(P=e[0],L=!0):(P=e,L=!1),C.lostContextRecovery&&C.lostContextRecovery.refreshTargetsIfNeeded(e),Array.isArray(e))this.initFrameBufferMRT(e),(t=e[0]).initForMRT=!0;else if(e){var a=e.__webglFramebuffer;a&&I===a&&!e.initForMRT&&null!=e.shareDepthFrom==!!e.__isUsingShared||this.initFrameBufferMRT([e]),(t=e).initForMRT=!1}!t||Me?(n=z,r=H,o=V,s=G):(n=t.width,r=t.height,o=0,s=0),(i=t?t.__webglFramebuffer:null)!==I&&(x.bindFramebuffer(x.FRAMEBUFFER,i),I=i),x.viewport(o,s,n,r)},this.readRenderTargetPixels=function(e,t,i,n,r,o){if(e instanceof v().WebGLRenderTarget){if(C.lostContextRecovery&&C.lostContextRecovery.refreshTargetsIfNeeded(e),e.__webglFramebuffer){if(e.texture.format!==v().RGBAFormat&&e.texture.format!==v().RGBFormat||e.texture.type!==v().UnsignedByteType)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not a readable format.");var s=!1;e.__webglFramebuffer!==I&&(x.bindFramebuffer(x.FRAMEBUFFER,e.__webglFramebuffer),s=!0),e.canReadPixels||x.checkFramebufferStatus(x.FRAMEBUFFER)===x.FRAMEBUFFER_COMPLETE?x.readPixels(t,i,n,r,x.RGBA,x.UNSIGNED_BYTE,o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&x.bindFramebuffer(x.FRAMEBUFFER,I)}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.supportsDisjointTimerQuery=function(){return null!==Z},this.createDisjointTimerQuery=function(){if(null===Z)return null;return{query:x.createQuery(),time:0}},this.destroyDisjointTimerQuery=function(e){if(!e)throw new Error("destroyDisjointTimerQuery: query is not defined");x.deleteQuery(e.query)},this.beginDisjointTimerQuery=function(e){if(!e)throw new Error("beginDisjointTimerQuery: query is not defined");e.time=performance.now(),x.beginQuery(Z.TIME_ELAPSED_EXT,e.query)},this.endDisjointTimerQuery=function(e){e.time=performance.now()-e.time,x.endQuery(Z.TIME_ELAPSED_EXT)},this.getDisjointTimerQueryResultAsync=function(e,t){if(!e)throw new Error("beginDisjointTimerQuery: query is not defined");const i=()=>{const n=x.getQueryParameter(e.query,x.QUERY_RESULT_AVAILABLE),r=x.getParameter(Z.GPU_DISJOINT_EXT);if(!n||r)n||requestAnimationFrame(i);else{const i=x.getQueryParameter(e.query,x.QUERY_RESULT),n=e.time;t({cpuTimeMS:n,gpuTimeMS:i/1e6})}};requestAnimationFrame(i)};const jt={programs:new Map,vaos:new Map,lutBuffer:null,geomBuffer:null,lutBufferData:new Uint32Array(65535)};function qt(e,t){x.bindBuffer(x.ARRAY_BUFFER,e),x.bufferData(x.ARRAY_BUFFER,t,x.STREAM_COPY)}this.createConsolidatedBuffer=function(e,t,i){const n=Float32Array.BYTES_PER_ELEMENT;let r=0;for(let t=0;t<i.length;t++){const n=i[t].vb.length/e.vbstride;jt.lutBufferData.fill(t,r,r+n),r+=n}null===jt.lutBuffer&&(jt.lutBuffer=x.createBuffer(),jt.geomBuffer=x.createBuffer()),qt(jt.lutBuffer,jt.lutBufferData.subarray(0,r)),qt(jt.geomBuffer,e.vb);const o=e.vb.length*n,s=_.allocateBufferSubset(o,x.ARRAY_BUFFER,e.vbstride,!0);x.bindBuffer(x.ARRAY_BUFFER,null);let a=e.attributesKeys.sort().join(".");const l=Math.floor(x.getParameter(x.MAX_VERTEX_UNIFORM_VECTORS)/4);if(!jt.programs.has(a)){const t={};let i="",r="",o="",s=0;for(let[a,l]of Object.entries(e.attributes))if(void 0!==l.offset){t[a]={},t[a].location=s++,t[a].itemSize=l.itemSize,t[a].bytesPerItem=l.bytesPerItem||4,t[a].offsetInBytes=l.offset*n;const e=t[a].bytesPerItem;if(4===e)1!==l.itemSize||l.normalized?2===l.itemSize?t[a].type="vec2":3===l.itemSize?t[a].type="vec3":4===l.itemSize?t[a].type="vec4":t[a].type="int":t[a].type="float";else{if(2!==e||2!==l.itemSize)throw new Error("Unsupported attribute type.");t[a].type="int"}const c=t[a].type;i+=`in ${c} a_${a};\n`,r+=`${"int"===c?"flat ":""}out ${c} v_${a};\n`,o+=`v_${a} = a_${a};\n`}const c=`#version 300 es\n                precision highp float;\n                precision highp int;\n\n                #define COPY_NORMALS ${void 0!==e.attributes.normal?1:0}\n                #define PI 3.1415926535897932384626433832795\n\n                ${i}\n                in int a_lutIndex;\n\n                ${r}\n\n                uniform mat4 matrices[${l}];\n\n                // See src/wgs/render/chunks/pack_normals.glsl\n                vec2 encodeNormal(vec3 n) {\n                    vec2 result;\n                    result.x = 0.5 * (1.0 + atan(n.y, n.x) / PI);\n                    result.y = 0.5 * (1.0 + n.z);\n                    return result;\n                }\n\n                vec3 decodeNormal(vec2 enc) {\n                    vec2 ang = enc * 2.0 - 1.0;\n                    vec2 scth = vec2(sin(ang.x * PI), cos(ang.x * PI));\n                    vec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\n                    return vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n                }\n\n                void main() {\n                    // Assign before computation to prevent attributes being overwritten\n                    ${o}\n\n                    mat4 transform = matrices[a_lutIndex % ${l}];\n                    v_position = (transform * vec4(a_position, 1.0)).xyz;\n\n                    #if COPY_NORMALS\n                    mat3 normalMatrix = mat3(transform);\n                    normalMatrix = transpose(inverse(normalMatrix));\n\n                    const int MAX_UNSIGNED_SHORT = 0xffff;\n                    const float MAX_UNSIGNED_SHORT_F32 = float(MAX_UNSIGNED_SHORT);\n\n                    int hWordU32 = (a_normal >> 16) & MAX_UNSIGNED_SHORT;\n                    int lWordU32 = a_normal & MAX_UNSIGNED_SHORT;\n                    vec2 normal = vec2(float(lWordU32), float(hWordU32)) / MAX_UNSIGNED_SHORT_F32;\n\n                    vec3 decNormal = decodeNormal(normal);\n                    decNormal = normalMatrix * decNormal;\n                    decNormal = normalize(decNormal);\n                    normal = encodeNormal(decNormal) * MAX_UNSIGNED_SHORT_F32;\n\n                    hWordU32 = (int(normal.x) & MAX_UNSIGNED_SHORT);\n                    lWordU32 = (int(normal.y) & MAX_UNSIGNED_SHORT) << 16;\n\n                    v_normal = hWordU32 | lWordU32;\n                    #endif\n                }\n            `,u="#version 300 es\n                void main() {\n                }\n            ",h=[];for(let[e,i]of Object.entries(t))h.push(`v_${e}`);const d=function(e,t,i){const n=function(e,t){const i=x.createShader(t);if(x.shaderSource(i,e),x.compileShader(i),x.getShaderParameter(i,x.COMPILE_STATUS))return i;throw x.deleteShader(i),new Error(x.getShaderInfoLog(i))},r=n(e,x.VERTEX_SHADER),o=n(t,x.FRAGMENT_SHADER),s=x.createProgram();if(x.transformFeedbackVaryings(s,i,x.INTERLEAVED_ATTRIBS),x.attachShader(s,r),x.attachShader(s,o),x.linkProgram(s),x.detachShader(s,r),x.detachShader(s,o),x.deleteShader(r),x.deleteShader(o),x.getProgramParameter(s,x.LINK_STATUS))return s;throw x.deleteProgram(s),new Error(x.getProgramInfoLog(s))}(c,u,h);for(let[e,i]of Object.entries(t))x.bindAttribLocation(d,i.location,`a_${e}`);jt.programs.set(a,d);const f=x.createVertexArray();x.bindVertexArray(f);const p=e.vbstride*n;x.bindBuffer(x.ARRAY_BUFFER,jt.geomBuffer);for(let[e,i]of Object.entries(t))if(x.enableVertexAttribArray(i.location),4===i.bytesPerItem)i.normalized?x.vertexAttribIPointer(i.location,i.itemSize,x.INT,p,i.offsetInBytes):x.vertexAttribPointer(i.location,i.itemSize,x.FLOAT,!1,p,i.offsetInBytes);else{if(2!==i.bytesPerItem||2!==i.itemSize)throw new Error("Unsupported attribute type.");x.vertexAttribIPointer(i.location,1,x.INT,p,i.offsetInBytes)}const m=x.getAttribLocation(d,"a_lutIndex");x.bindBuffer(x.ARRAY_BUFFER,jt.lutBuffer),x.vertexAttribIPointer(m,1,x.INT,0,0),x.enableVertexAttribArray(m),x.bindBuffer(x.ARRAY_BUFFER,null),x.bindVertexArray(null),jt.vaos.set(a,f)}const c=jt.programs.get(a),u=jt.vaos.get(a);x.useProgram(c),x.enable(x.RASTERIZER_DISCARD);const h=t.length/16,d=Math.ceil(h/l);let f=0,p=0,m=0;for(let r=0;r<d;r++){const o=Math.min(h-r*l,l);for(let e=0;e<o;e++){const i=r*l*16,n=x.getUniformLocation(c,`matrices[${e}]`),o=16*e+i,s=t.slice(o,o+16);x.uniformMatrix4fv(n,!1,s)}let a=0;for(let t=f;t<f+o;t++){a+=i[t].vb.length/e.vbstride}f+=o;const d=a*e.vbstride*n;x.bindBufferRange(x.TRANSFORM_FEEDBACK_BUFFER,0,s.getGlBuffer(),m,d),m+=d,x.beginTransformFeedback(x.POINTS),x.bindVertexArray(u),x.drawArrays(x.POINTS,p,a),p+=a,x.endTransformFeedback()}return x.disable(x.RASTERIZER_DISCARD),x.bindBufferRange(x.TRANSFORM_FEEDBACK_BUFFER,0,null,0,0),x.bindVertexArray(null),x.bindBuffer(x.ARRAY_BUFFER,null),x.useProgram(null),s},this.dtor=function(){var e;null!==jt.lutBuffer&&(x.deleteBuffer(jt.lutBuffer),jt.lutBuffer=null),null!==jt.geomBuffer&&(x.deleteBuffer(jt.geomBuffer),jt.geomBuffer=null),_.dtor(),null===(e=E)||void 0===e||e.dtor(),t.removeEventListener("webglcontextlost",J),t.removeEventListener("webglcontextrestored",ee)},this.setUniformBufferObject=function(e,t){const i=(null==e?void 0:e.buffer)??x.createBuffer();x.bindBuffer(x.UNIFORM_BUFFER,i),x.bufferData(x.UNIFORM_BUFFER,t,x.STATIC_DRAW),x.bindBuffer(x.UNIFORM_BUFFER,null),e.buffer=i},this.deallocateUniformBufferObject=function(e){x.deleteBuffer(e.buffer)},this.getUBOManager=function(){return E},this.addModel=function(e){var t;null===(t=S)||void 0===t||t.addModel(e)},this.removeModel=function(e){var t;null===(t=S)||void 0===t||t.removeModel(e)}};class Sw{_callbacks;_numberOfTotalDrawCalls;_numberOfInjections;constructor(){this._callbacks=new Array,this._numberOfTotalDrawCalls=0,this._numberOfInjections=0,this.counters={drawArrays:0,drawArraysInstanced:0,drawElements:0,drawElementsInstanced:0,total:0}}initialize(e){e instanceof WebGL2RenderingContext?(this.#Fa(e),this.#Va(e)):console.debug("Draw calls cannot be intruded and counted: Valid context object expected, given",e)}uninitialize(){}resetCounters(){for(const e of this._callbacks)e.continuous?e.callCountOnLastInvocation-=this.counters.total:e.callCountOnLastInvocation=0;this.counters.drawArrays=0,this.counters.drawArraysInstanced=0,this.counters.drawElements=0,this.counters.drawElementsInstanced=0,this.counters.total=0}inject(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Number.isInteger(t)&&t<0?console.warn("After-draw-call callback injection ignored. Number of calls ignored before invocation must be a positive number, given",t):this._callbacks.push({callback:e,numberOfCallsIgnoreBeforeInvocation:t,callCountOnLastInvocation:0,continuous:i})}#Ga(e,t){if(void 0!==e)return function(){e.apply(this,arguments),t.apply(this)}}#za(){if(++this.counters.total,++this._numberOfTotalDrawCalls,0!==this._callbacks.length)for(const e of this._callbacks)this.counters.total-e.callCountOnLastInvocation<=e.numberOfCallsIgnoreBeforeInvocation||(e.callback(),e.callCountOnLastInvocation=this.counters.total,++this._numberOfInjections)}#Fa(e){e.drawArrays=this.#Ga(e.drawArrays,(()=>{++this.counters.drawArrays,this.#za()})),e.drawArraysInstanced=this.#Ga(e.drawArraysInstanced,(()=>{++this.counters.drawArraysInstanced,this.#za()})),e.drawElements=this.#Ga(e.drawElements,(()=>{++this.counters.drawElements,this.#za()})),e.drawElementsInstanced=this.#Ga(e.drawElementsInstanced,(()=>{++this.counters.drawElementsInstanced,this.#za()})),e.drawRangeElements=this.#Ga(e.drawRangeElements,(()=>{++this.counters.drawElements,this.#za()}))}#Va(e){}}const Aw={WEBGL_CONTEXT_LOST:"webglcontextlost",WEBGL_CONTEXT_RESTORED:"webglcontextrestored"};class ww extends Ew{static DEFAULT_NUM_DRAW_CALLS_TO_INJECT_FLUSH_AFTER_IOS=1e3;_drawCallIntrusion;#Ha;#Wa;#ja;constructor(){var e,t;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});let i=()=>{this.fireEvent({type:Aw.WEBGL_CONTEXT_LOST})};null===(e=this.domElement)||void 0===e||e.addEventListener("webglcontextlost",i);let n=()=>{this.fireEvent({type:Aw.WEBGL_CONTEXT_RESTORED})};null===(t=this.domElement)||void 0===t||t.addEventListener("webglcontextrestored",n);let r=this.dtor;this.dtor=function(){var e,t;r.call(this),null===(e=this.domElement)||void 0===e||e.removeEventListener("webglcontextlost",i),null===(t=this.domElement)||void 0===t||t.removeEventListener("webglcontextrestored",n)},this.refCount=0;const o=parseInt(R(),10);if(N()&&o>=15){this._drawCallIntrusion=new Sw,this._drawCallIntrusion.initialize(this.getContext());const e=ww.DEFAULT_NUM_DRAW_CALLS_TO_INJECT_FLUSH_AFTER_IOS-1;this._drawCallIntrusion.inject((()=>{this.getContext().flush()}),e,!0),console.debug(e<1?"LMVRenderer: Additional context flushes will be invoked after every draw call.":`LMVRenderer: Additional context flushes will be invoked after ${e+1} subsequent draw calls.`)}else this._drawCallIntrusion=void 0;this.#Ha=[],this.loadingAnimationDuration=-1,this.highResTimeStamp=-1,this.#Wa=this.render,this.#ja=this.setRenderTarget,this.render=ww.prototype.render.bind(this),this.setRenderTarget=ww.prototype.setRenderTarget.bind(this)}supportsMRT(){return console.warn("LMVRenderer: .supportsMRT() has been deprecated. It always returns true."),!0}updateTimestamp(e){return this.highResTimeStamp=e}getLoadingAnimationDuration(){return this.loadingAnimationDuration}setLoadingAnimationDuration(e){return this.loadingAnimationDuration=e}clearBlend(){this.state.setBlending(v().NoBlending)}isWebGL2(){return console.warn("LMVRenderer: .isWebGL2() has been deprecated. It always returns true."),!0}render(e,t,i){this.#Wa(e,t,!1,i)}notifyFinalFrameRendered(e){void 0!==this._drawCallIntrusion&&this._drawCallIntrusion.resetCounters()}setRenderTarget(e){this.#ja(e)}}Ba.prototype.apply(ww.prototype),ww.Events=Aw;var Cw=null,Tw=c().ENABLE_DEBUG,Mw=c().ENABLE_DEBUG_RCS;let Iw=!1,Pw=0,Lw={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1,depth:!1,logarithmicDepthBuffer:!1};function Rw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(S())return;var i=Object.assign({},Lw,t);let n;i.canvas=e;try{if(Cn()){n=new xS(Gi(),i)}else n=new ww(i)}catch(e){return null}return n.name="MainRenderer",!n.getContext||n.getContext&&!n.getContext()?null:(n.autoClear=!1,n.sortObjects=!1,n)}function Dw(e,t){var i=this;this.setGlobalManager(t.globalManager);var n,r,o,s,a,l,u=1e3/15,h=1e3/30,d=1,f=-1,p=-1,m=-1,g=null,y="y";let b;var x,_,E,A,w,C,T,M,I=null,P=null,L=null,R=!1,D=!1,O=!1,B={type:Dn,state:Gp.LOADING,percent:0},N=!1,U=!1,k=!1,V=0,G={magnitude:4,depthDampening:0},z=0,j=1e3/60,q=0,K=!0,X=!1,Y=!1,Q=null,Z=null;this.edgeColorMain=new(v().Vector4)(0,0,0,.3),this.edgeColorGhosted=new(v().Vector4)(0,0,0,.1);var $,J,ee,te=c(),ie=!1,ne=e=>{var t=e.model;this.canvas&&t&&t.getData()&&t.getData().stdSurfMats&&t.getData().stdSurfMats.materials&&this.api.loadExtension("Autodesk.StandardSurface").then((e=>{e&&e.processModel(t)}))},re=e=>e.model.modelRootLoaded=!0,oe=e=>{null!=e&&e.model&&!M.findModel(e.model.id)||this.invalidate(!1,!0)},se={},ae=!1,le="",ce=!0,ue=!1,he=1;function fe(e,t){const n=e=>{var t;const n=null===(t=e.frags)||void 0===t?void 0:t.is2d;var r=$.phase,o=!0,s=r==vc.RENDER_NORMAL,a=_.settings.idbuffer&&r!=vc.RENDER_HIDDEN,l=r==vc.RENDER_HIDDEN?i.edgeColorGhosted:i.edgeColorMain;_.setEdgeColor(l),r!=vc.RENDER_HIDDEN||e.ignoreFadeMaterial?r==vc.RENDER_HIGHLIGHTED&&(e.overrideMaterial=i.highlightMaterial):e.overrideMaterial=i.fadeMaterial;const c={type:Qr,scene:e,wantColor:o,wantSAO:s,wantID:a,context:_};if(i.api.dispatchEvent(c),!i.is2d&&n)i.getSheetRenderer().renderScenePart(e,o,s,a);else{const t=ue&&!i.is2d&&r==vc.RENDER_HIDDEN;t&&(e.edgesOnly=!0),_.renderScenePart(e,o,s,a),t&&(e.edgesOnly=void 0)}e.overrideMaterial=null},r=_.startTimeQuery();t&&n(t),n(e),_.stopTimeQuery(r),_.getTimeResult(r,(t=>{e instanceof v().Scene||e.hasBeenInterrupted()||e.addTimestamp(t.gpuTimeMS)}))}function pe(e){if(!o)return;i.canvasBoundingclientRectDirty=!0,i.camera.aspect=s/a,i.camera.clientWidth=s,i.camera.clientHeight=a,i.camera.updateProjectionMatrix();const t=i.getWindow().devicePixelRatio;i.glrenderer().getPixelRatio()!==t&&i.glrenderer().setPixelRatio(t),_.setSize(s,a),i.controls.handleResize(),T&&T.setSize(s,a),E&&E.setSize(),i.invalidate(!0,!0,!0),o=!1,e||i.api.dispatchEvent({type:Un,width:s,height:a})}function me(){var e;if((C.enabled||T)&&!i.is2d&&(e=i.model&&!i.model.isLoadDone()?i.model.getData().bbox:i.getVisibleBounds(!0,!1,void 0,void 0))){var t=i.camera,n=e.clone(),r=new(v().Vector3)(1,0,0),o=P.clone();t.worldUpTransform&&(n.applyMatrix4(t.worldUpTransform),r.applyMatrix4(t.worldUpTransform),o.applyMatrix4(t.worldUpTransform)),n.min.y-=.005*(n.max.y-n.min.y),A&&A.expandByGroundShadow(n,o);var s=n.getSize(new(v().Vector3)),a=n.getCenter(new(v().Vector3));if(A||(s.x*=1.25,s.z*=1.25,s.x=s.z=Math.max(s.x,s.z)),t.worldUpTransform){var l=t.worldUpTransform.clone().invert();a.applyMatrix4(l)}if(C.setTransform(a,s,t.worldup,r),T){var c=(new(v().Vector3)).subVectors(a,t.worldup.clone().multiplyScalar(s.y/2));T.setTransform(c,t.worldup,s)}A&&A.setGroundShadowTransform(a,s,t.worldup,r)}}function ge(){A&&(A.state=UA)}this.useDeferredConsolidation=!1,e&&(this.interval=setInterval((function(){K||q<60||i.track({name:"fps",value:Number(i.fps().toFixed(2)),aggregate:"last"})}),3e4)),this.api=t,this.canvas=e,this.loader=null,this.canvasBoundingclientRectDirty=!0,this.nearRadius=0,this.defaultLoadingAnimationDuration=300,this.lastTime2dGeometryCreated=0,this.maxModelDistance=0,this._viewerVisible=null,this.visibilityManager=null,this.initialize=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n=new(v().Vector3)(0,1,0),M=new kS,(ue=Cn())&&console.warn("Using WebGPU renderer. Note that this option is experimental and still under development."),(x=t.glrenderer||Rw(e,t.webglInitParams))||S()){x&&(this.onWebGLcontextLost=this.onWebGLcontextLost.bind(this),this.onWebGLcontextRestored=this.onWebGLcontextRestored.bind(this),x.addEventListener(ww.Events.WEBGL_CONTEXT_LOST,this.onWebGLcontextLost),x.refCount++,t.enableContextRestore&&(x.enableContextRestore=!0,x.addEventListener(ww.Events.WEBGL_CONTEXT_RESTORED,this.onWebGLcontextRestored))),(_=t.renderer||(ue?new _S:new lx)).init(x,e?e.clientWidth:0,e?e.clientHeight:0,t),b=t.materialManager||new wf(x),b.refCount++,this.useDeferredConsolidation=t&&void 0!==t.useDeferredConsolidation?!!t.useDeferredConsolidation:tn,this.camera=new ny(e?e.clientWidth:512,e?e.clientHeight:512),this.lightsOn=!1,this.lights=[],this.no_lights=[],Q=(new(v().Color)).setRGB(1,1,1),Z=(new(v().Color)).setRGB(1,1,1),this.cameraChangedEvent={type:Sr,camera:this.camera},I=new(v().Vector3)(1,1,1),P=(new(v().Vector3)).copy(I),L=new(v().Vector3)(-1,0,1),this.scene=new(v().Scene),this.sceneAfter=new(v().Scene),this.sceneAfter.sortObjects=!1,this.overlayScenes={},ke(),this.createOverlayScene("selection_points",null,null),this.selectionMeshes={},this.fadeMaterial=new(v().MeshPhongMaterial)({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,b.addInstancingSupport(this.fadeMaterial),b.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.setSelectionColor(6724095),b.togglePolygonOffset(!0),_.setDepthMaterialOffset(b.getPolygonOffsetOn(),b.getPolygonOffsetFactor(),b.getPolygonOffsetUnits()),this.progressiveRender=!0,this.swapBlackAndWhite=!1,this.targetFrameBudget=h,this.frameDisplayRate=5,F()&&(u*=2,h*=2,this.targetFrameBudget/=2,this.frameDisplayRate/=2),this.interruptBudget=1e10,this.controls={update:function(){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){},isToolActivated:function(){return!1}},this.selector=new GS(this),this.visibilityManager=new HS(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null,this.zoomBoundsChanged=!0;var i=xo[mo].bgColorGradient;this.setClearColors(i[0],i[1],i[2],i[3],i[4],i[5]),(C=ue?x.getGroundShadowPass():new dA(x)).enabled=!0,$=new ye,Ji&&this._updateTargetFrameBudget(),ue||(b.addMaterialNonHDR("groundShadowDepthMaterial",C.getDepthMaterial()),b.addOverrideMaterial("normalsMaterial",_.getDepthMaterial()),b.addOverrideMaterial("edgeMaterial",_.getEdgeMaterial())),_.beginScene(this.scene,this.camera,this.noLights,!0),_.composeFinalFrame(!0),this.api.addEventListener(Hn,ne),this.api.addEventListener(Hn,re),this.api.addEventListener(zn,oe),Ji&&(km.registerViewer(this),NS.registerViewer(this,he))}},this.getSheetRenderer=function(){return E||(E=new ES(i,_,x,b)),E},this.isSheetRendererNeeded=function(){return!i.is2d&&this.get2DModels().length>0},this.get2DModels=function(){return M.getModels().filter((e=>e.is2d()))},this.get3DModels=function(){return M.getModels().filter((e=>e.is3d()))},this.renderGroundShadow=function(e){A?A.state==FA&&A.renderGroundShadow(i.camera,e||_.getColorTarget()):(C.renderShadow(i.camera,e||_.getColorTarget()),C.rendered=!0)};var ve={NOTHING_DRAWN:0,MODEL_DRAWN:1,BACKGROUND_DRAWN:2,OVERLAY_DRAWN:4,REFLECTION_DRAWN:8,ALL_DRAWN:15};function ye(){this.highResTimeStamp=-1,this.screenDrawn=ve.NOTHING_DRAWN,this.screenHasChanged=!1,this.frameBudget=0,this._usedFrameTime=0,this.frameTimeScalingFactorAvg=1,this.frameTimeFraction=1,this.frameRemaining=0,this.phase=vc.RENDER_NORMAL,this.signalProgressByRendering=!1,this.tickCount=0,this.beginFrameAvg=0,this.lastBeginFrameTimeStamp=0,this.RENDERMODE_FULL=0,this.RENDERMODE_PROGRESSIVE=1,this.RENDERMODE_SILENT=2,this.renderType=this.RENDERMODE_FULL,this.INITIAL_GROUND_SHADOW=.2,this.cmdListActive=!1,this.cmdIndex=0,this.continueExecution=!0,this.encounteredAlwaysDo=!1,this.finishedFullRender=!0,this.groundShadowInPost=!1,this.drawOverlay=!1,this.cmdIsOpen=!1,this.allocArraySize=0,this.cmdListLength=0,this.cmdList=[],this.paramList=[],this.CMD_NORMAL_SEQUENCE=0,this.CMD_DO_AFTER=1,this.CMD_ALWAYS_DO=2,this.isActive=function(){return this.cmdListActive},this.setFrame=function(e){this.frameBudget=e},this.beginCommandSet=function(){this.cmdListActive=!0,this.cmdIndex=0,this.cmdListLength=0,this.encounteredAlwaysDo=!1,this.tickCount=0,this.screenDrawn=ve.NOTHING_DRAWN,this.screenHasChanged=!1},this.endCommandSet=function(){this.cmdIsOpen&&(this.cmdIsOpen=!1,this.cmdListLength++)},this._internalSetParam=function(e,t){this.paramList[this.cmdIndex][e]=t},this.addCommand=function(e,t){for(this.cmdIsOpen&&this.cmdListLength++,this.cmdIsOpen=!0;this.allocArraySize<=this.cmdListLength;)this.cmdList[this.cmdListLength]={},this.paramList[this.cmdListLength]={},this.allocArraySize++;return this.cmdList[this.cmdListLength]=e,this.paramList[this.cmdListLength].executionLevel=t||this.CMD_NORMAL_SEQUENCE,this.encounteredAlwaysDo=this.encounteredAlwaysDo||t===this.CMD_ALWAYS_DO,this.cmdListLength},this.setParam=function(e,t){this.cmdIsOpen?this.paramList[this.cmdListLength][e]=t:Tw&&rt.error("ERROR: cannot set param when no command is open!")},this.getParam=function(e){return Tw&&void 0===this.paramList[this.cmdIndex][e]&&rt.error("ERROR: parameter "+e+" was never set for this command! Go fix it."),this.paramList[this.cmdIndex][e]},this.executeCommandList=function(){if(!$.cmdListActive)return $.lastBeginFrameTimeStamp=0,!0;var e;if(this.tickCount>0&&($.lastBeginFrameTimeStamp=0),this.frameRemaining=this.frameBudget,Tw&&this.cmdIsOpen&&rt.error("ERROR: should call endCommandSet before executing"),this.continueExecution=!0,Mw&&(0===this.tickCount&&console.log("==================="),console.log("Running commands for "+($.renderType===$.RENDERMODE_PROGRESSIVE?"progressive":$.renderType===$.RENDERMODE_FULL?"full":"silent")+" render, for tick count "+this.tickCount)),this.encounteredAlwaysDo)for(var t=0;t<this.cmdIndex;)this.paramList[t].executionLevel>=$.CMD_ALWAYS_DO&&(Mw&&console.log("  ALWAYS DO command "+t+": "+this.cmdList[t].name),this.cmdList[t]()),t++;for(;this.cmdIndex<this.cmdListLength;)(this.continueExecution||this.paramList[this.cmdIndex].executionLevel>=$.CMD_DO_AFTER)&&(Mw&&console.log("  command "+this.cmdIndex+": "+this.cmdList[this.cmdIndex].name+" and "+$.frameRemaining+" frame budget remaining"),this.cmdList[this.cmdIndex]()&&(Mw&&console.log("  >>> out of tick time with "+$.frameRemaining),e=this.cmdIndex,this.continueExecution=!1)),this.cmdIndex++;return $._usedFrameTime=$.frameBudget-$.frameRemaining,this.continueExecution?this.cmdListActive=!1:this.cmdIndex=e,this.tickCount++,!this.continueExecution}}function be(){if($.renderType===$.RENDERMODE_PROGRESSIVE)if($.getParam("GenerateGroundShadow.afterBeauty")){if($.frameRemaining=C.prepareGroundShadow(i.modelQueue(),0,$.frameRemaining),C.getStatus()==cS.GROUND_RENDERED){if($.getParam("GenerateGroundShadow.signalRedraw"))return i.requestSilentRender(),Mw&&console.log(" $$$$ SIGNAL FULL GROUND SHADOW REDRAW"),!0;$.groundShadowInPost=!0}}else 0===$.tickCount&&C.prepareGroundShadow(i.modelQueue(),10,rn?3:void 0);else $.frameRemaining=C.prepareGroundShadow(i.modelQueue(),0,$.frameRemaining);return $.frameRemaining<0&&C.getStatus()===cS.GROUND_UNFINISHED}function xe(){return C.getStatus()!==cS.GROUND_UNFINISHED&&i.renderGroundShadow(),!1}function _e(){return $.renderType===$.RENDERMODE_PROGRESSIVE?$.getParam("GenerateGroundReflection.afterBeauty")?($.frameRemaining=T.prepareGroundReflection(C,i,!1,0,$.frameRemaining),T.getStatus()==cS.GROUND_RENDERED&&($.screenDrawn|=ve.REFLECTION_DRAWN,$.groundShadowInPost&&b.hasTransparentMaterial()&&i.requestDeferredSilentRender())):0===$.tickCount&&T.prepareGroundReflection(C,i,!0,10,rn?5:void 0):$.frameRemaining=T.prepareGroundReflection(C,i,!1,0,$.frameRemaining),$.frameRemaining<0&&T.getStatus()===cS.GROUND_UNFINISHED}function Ee(){if(A.state===UA)$.frameRemaining=A.startUpdate(M,$.frameRemaining,i.camera,P,b);else if(A.state==kA&&($.frameRemaining=A.continueUpdate(M,$.frameRemaining,b),A.state==FA))return i.requestSilentRender(),Mw&&console.log(" $$$$ SIGNAL FULL SHADOW MAP REDRAW"),!0;return $.frameRemaining<0&&A.state!==FA}function Se(){A.state=UA}function Ae(){if($.signalProgressByRendering&&i.signalProgress(0,Gp.RENDERING),$.renderType===$.RENDERMODE_PROGRESSIVE){if($.lastBeginFrameTimeStamp>0){var e=$.highResTimeStamp-$.lastBeginFrameTimeStamp;if(Ji)NS.updateFrameTime(i,M.isDone(),$._usedFrameTime,e,h*$.frameTimeFraction);else if(rn){const t=$._usedFrameTime&&!M.isDone()?$._usedFrameTime/e:1;$.frameTimeScalingFactorAvg=.9*$.frameTimeScalingFactorAvg+.1*t,i._updateTargetFrameBudget()}else $.beginFrameAvg=.75*$.beginFrameAvg+.25*e,i._updateTargetFrameBudget()}$.lastBeginFrameTimeStamp=$.highResTimeStamp}var t=$.getParam("BeginScene.clear");return _.beginScene(i.scene,i.camera,i.lightsOn?i.lights:i.no_lights,t),t&&($.screenDrawn|=ve.BACKGROUND_DRAWN),$.getParam("BeginScene.signalCameraChanged")&&i.api.dispatchEvent(i.cameraChangedEvent),!1}function we(){return $.phase=$.getParam("BeginPhase.phase"),Mw&&console.log("     render phase is now "+$.phase),M.reset(i.camera,$.phase,$.getParam("BeginPhase.moved"),b.getCutPlanes(),ae),!1}function Ce(){return M.isEmpty()||M.isDone()||($.screenDrawn|=ve.MODEL_DRAWN,$.frameRemaining=M.renderSome(fe,$.frameRemaining,$.frameTimeScalingFactorAvg),ue&&x.flushCommandQueue(),$.signalProgressByRendering&&(i.signalProgress(100*M.getRenderProgress(),Gp.RENDERING),Mw&&console.log("  %%% percent done "+100*M.getRenderProgress()))),!M.isDone()}function Te(){return $.phase=vc.RENDER_FINISHED,_.renderScenePart(i.sceneAfter,!0,!0,!0),!1}function Me(){return $.phase=vc.RENDER_FINISHED,!1}function Ie(){i.signalProgress(100,Gp.RENDERING)}function Pe(){return i.isOverlayDirty()&&(i.clearOverlayDirtyFlag(),$.drawOverlay=!0),$.drawOverlay&&(!M.isEmpty()&&M.isDone()||i.showOverlaysWhileMoving?(i.renderOverlays(),$.screenDrawn|=ve.OVERLAY_DRAWN):(_.clearAllOverlays(),$.drawOverlay=!1)),!1}function Le(){$.screenDrawn|=ve.ALL_DRAWN}function Re(){if($.screenDrawn&&($.phase===vc.RENDER_FINISHED||$.tickCount%i.frameDisplayRate==0)){var e=!$.getParam("PostAndPresent.performAO")||($.screenDrawn&(ve.BACKGROUND_DRAWN|ve.MODEL_DRAWN))==ve.BACKGROUND_DRAWN;_.composeFinalFrame(e),$.screenHasChanged=!0,$.screenDrawn=ve.NOTHING_DRAWN,t=$.highResTimeStamp,q++,z<=t&&z>0&&(j=.8*j+.2*(t-z)),i.fpsCallback&&i.fpsCallback(i.fps()),i.api.dispatchEvent({type:Lr})}var t;return!1}function De(){return Tw&&!1===_.getAOEnabled()&&rt.error("AO should be on at this point!"),_.setAOEnabled(!1),!1}function Oe(){return Tw&&!0===_.getAOEnabled()&&rt.error("AO should be off at this point!"),_.setAOEnabled(!0),!1}function Be(){return i.requestSilentRender(),!1}function Ne(){return $.finishedFullRender=!0,!1}this.tick=function(e){if(e||(e=0),this.canvas.checkVisibility){let e=this.canvas.checkVisibility({visibilityProperty:!0});e!=this._viewerVisible&&(this._viewerVisible=e,i.api.dispatchEvent({type:so,visible:this._viewerVisible}))}$.highResTimeStamp=e,x.updateTimestamp(e);var t=b.updateMaterials();i.invalidate(t.needsClear,t.needsRender,t.overlayDirty);const n=function(e){if(i.keyFrameAnimator){var t=z>0?(e-z)/1e3:0,n=i.keyFrameAnimator.update(t);if(n&&(i.sceneUpdated(!0),n&i.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}(e),r=i.controls.update(e),s=M&&M.update(e),a=r||n||w||s;w=!1;var l=o;pe(),R||(R=a),O||(O=a);var c=!1,u=_.overlayUpdate();O?function(){for(var e in i.selectionMeshes){var t=i.selectionMeshes[e];if(t.model){var n,r=t.model.getFragmentList();t.geometry===(null===(n=r)||void 0===n?void 0:n.getGeometry(t.fragId))&&r.getWorldMatrix(t.fragId,t.matrix)}}}():u&&!O&&(O=c=!0),this.isLoadingAnimationEnabled()&&z-i.lastTime2dGeometryCreated<=x.getLoadingAnimationDuration()&&(D=!0);var h=i.model&&i.model.loader&&i.model.loader.pagingProxy&&i.model.loader.pagingProxy.getMemoryInfo();$.signalProgressByRendering=i.model&&i.model.isLoadDone()&&!i.model.isLeaflet()&&!h,N&&(me(),C.setDirty(),N=!1,1)&&(R=!0);var d=R,f=M.frameResumePossible();if(R=R||!f,k=k||U&&!$.cmdListActive,R||D||O||k)if($.drawOverlay=O||R||D,R||D||k){var p,m=d?PS.RESET_RELOAD:PS.RESET_NORMAL;R||D?(i.progressiveRender?($.renderType=$.RENDERMODE_PROGRESSIVE,p=i.targetFrameBudget):($.renderType=$.RENDERMODE_FULL,p=i.interruptBudget),R&&(U=k=!1)):($.renderType=$.RENDERMODE_SILENT,p=i.targetFrameBudget,R=!0,m=PS.RESET_REDRAW,U=k=!1),i.skipCameraUpdate||i.updateCameraMatrices(),$.setFrame(p),$.finishedFullRender=!1,$.beginCommandSet();var g=C.enabled&&!i.is2d&&!K,v=!!T&&!i.is2d&&!K,y=a||l,E=a&&i.skipAOWhenMoving&&_.getAOEnabled();$.addCommand(Ae),$.setParam("BeginScene.signalCameraChanged",y),$.setParam("BeginScene.clear",R),E&&$.addCommand(De,$.CMD_ALWAYS_DO),M&&(A&&A.state!==FA&&$.addCommand(Ee),g&&($.addCommand(be),$.setParam("GenerateGroundShadow.afterBeauty",!1),$.setParam("GenerateGroundShadow.signalRedraw",!1)),v?(T.setDirty(),$.addCommand(_e),$.setParam("GenerateGroundReflection.afterBeauty",!1)):g&&R&&$.addCommand(xe),M.hasHighlighted()&&($.addCommand(we),$.setParam("BeginPhase.phase",vc.RENDER_HIGHLIGHTED),$.setParam("BeginPhase.moved",m),m=!1,$.addCommand(Ce)),$.addCommand(we),$.setParam("BeginPhase.phase",vc.RENDER_NORMAL),$.setParam("BeginPhase.moved",m),m=!1,$.addCommand(Ce),!M.areAllVisible()&&i.showGhosting&&(v&&$.renderType===$.RENDERMODE_PROGRESSIVE||($.addCommand(we),$.setParam("BeginPhase.phase",vc.RENDER_HIDDEN),$.setParam("BeginPhase.moved",m),$.addCommand(Ce))),$.addCommand(Te),$.signalProgressByRendering&&$.addCommand(Ie)),$.addCommand(Pe,$.renderType===$.RENDERMODE_PROGRESSIVE?$.CMD_DO_AFTER:$.CMD_NORMAL_SEQUENCE),$.addCommand(Re,$.renderType===$.RENDERMODE_PROGRESSIVE?$.CMD_DO_AFTER:$.CMD_NORMAL_SEQUENCE),$.setParam("PostAndPresent.performAO",_.getAOEnabled()&&!E),$.renderType===$.RENDERMODE_PROGRESSIVE&&M&&(A&&A.state!==FA&&($.addCommand(Se),$.addCommand(Ee)),g&&($.addCommand(be),$.setParam("GenerateGroundShadow.afterBeauty",!0),$.setParam("GenerateGroundShadow.signalRedraw",!v),$.signalProgressByRendering&&$.addCommand(Ie)),v&&($.groundShadowInPost=!1,$.addCommand(_e),$.setParam("GenerateGroundReflection.afterBeauty",!0),!M.areAllVisible()&&i.showGhosting&&($.addCommand(we),$.setParam("BeginPhase.phase",vc.RENDER_HIDDEN),$.setParam("BeginPhase.moved",m),$.addCommand(Ce)),$.addCommand(Me),$.addCommand(Re),$.setParam("PostAndPresent.performAO",_.getAOEnabled()&&!E),$.signalProgressByRendering&&$.addCommand(Ie))),E&&($.addCommand(Oe,$.CMD_ALWAYS_DO),$.addCommand(Be)),$.addCommand(Ne),$.endCommandSet(),R=!1,D=!1,this.clearOverlayDirtyFlag()}else $.finishedFullRender&&($.beginCommandSet(),Mw&&console.log("=====\nOVERLAY DIRTY"),c?$.addCommand(Le):$.addCommand(Pe,!0),$.addCommand(Re,!0),$.setParam("PostAndPresent.performAO",_.getAOEnabled()),$.signalProgressByRendering&&$.addCommand(Ie),$.endCommandSet(),this.clearOverlayDirtyFlag());ee=$.cmdListActive,i.onBeforeRender&&i.onBeforeRender(ee),$.executeCommandList(),ee!==ce&&(ee||ue||i.glrenderer().notifyFinalFrameRendered(),i.api.dispatchEvent({type:Pr,value:{finalFrame:!ee}}),ce=ee),z=$.highResTimeStamp,ue&&x.clearPerFrameBudgets()},this.setLmvDisplay=function(e){te=e},this.run=function(){l=!0,r=0,setTimeout((function(){Ji&&!Iw&&function e(t){Iw=te.requestAnimationFrame(e),i.executeTasks(t)}(),Pw++,l&&function e(t){r=te.requestAnimationFrame(e),i.tick(t)}()}),1)},this.stop=function(){let e=i.getWindow();e.cancelAnimationFrame(r),l=!1,Pw--,Ji&&0===Pw&&Iw&&(e.cancelAnimationFrame(Iw),Iw=void 0)},this.executeTasks=function(e){if(Ji){const e=performance.now(),t=e+Math.min((u-h)*un,cn);km.executeTasks(t);const i=performance.now();NS.setTaskExecutionTime(i-e)}},this.toggleProgressive=function(e){this.progressiveRender=e,R=!0},this.updateClearColors=function(){let e=this.clearColorTop,t=this.clearColorBottom;if(this.is2d&&this.swapBlackAndWhite){const i=e=>1===e.x&&1===e.y&&1===e.z,n=e=>0===e.x&&0===e.y&&0===e.z,r=e=>i(e)?new(v().Vector3)(0,0,0):n(e)?new(v().Vector3)(1,1,1):e;e=r(e),t=t&&r(t)}_.setClearColors(e,t)},this.toggleSwapBlackAndWhite=function(e){this.swapBlackAndWhite=e,this.updateClearColors(),R=!0},this.toggleGrayscale=function(e){b.setGrayscale(e),R=!0},this.toggleGhosting=function(e){this.showGhosting=e,R=!0},this.toggleOverlaysWhileMoving=function(e){this.showOverlaysWhileMoving=e},this.togglePostProcess=function(e,t){_.initPostPipeline(e,t),this.fireRenderOptionChanged(),R=!0},this.toggleCmdMapping=function(e,t){t.keyMapCmd=e},this.toggleGroundShadow=function(e){C.enabled!==e&&(C.enabled=e,C.clear(),e&&C.setDirty(),me(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.isGroundShadowEnabled=function(){return C&&C.enabled},this.setGroundShadowColor=function(e){C.enabled&&(C.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(e){C.enabled&&(C.setAlpha(e),this.invalidate(!0,!1,!1))},this.setRightBtnSelection=function(e){ie=e},this.isRightBtnSelectionEnabled=function(){return ie},this.toggleGroundReflection=function(e){e&&T||!e&&!T||(e?((T=new KA(x,this.canvas.clientWidth,this.canvas.clientHeight,{clearPass:_.getClearPass()})).setClearColors(this.clearColorTop,this.clearColorBottom,F()),T.toggleEnvMapBackground(X),T.setEnvRotation(_.getEnvRotation()),me()):(T.cleanup(),T=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(e){T&&(T.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(e){T&&(T.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(e){X=e,_.toggleEnvMapBackground(e),T&&T.toggleEnvMapBackground(e),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return X},this.setOptimizeNavigation=function(e){this.skipAOWhenMoving=e},this.getOverlayScenesToRender=function(){const e={};for(const[t,i]of Object.entries(this.overlayScenes))i.hiddenFromMainRender||(e[t]=i);return e},this.renderOverlays=function(){!function(){for(var e in i.selectionMeshes){var t=i.selectionMeshes[e];t.model&&t.model.isConsolidated()&&(t.model.updateRenderProxy(t,t.fragId),t.geometry||i.highlightFragment(t.model,t.fragId,!1))}}();var e,t=this.lightsOn;t||this.toggleLights(!0,!0),this.dir_light1&&(e=this.dir_light1.intensity,this.dir_light1.intensity=1);const n=this.getOverlayScenesToRender();_.renderOverlays(n,this.lightsOn?this.lights:this.no_lights),t||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=e)},this.setLayerVisible=function(e,t){this.layers.setLayerVisible(e,t)},this.isLayerVisible=function(e){return this.layers.isLayerVisible(e)},this.getVisibleLayerIndices=function(){return this.layers.getVisibleLayerIndices()},this.setNearRadius=function(e,t){this.nearRadius!==e&&(this.nearRadius=e,t&&this.invalidate(!0))},this.getNearRadius=function(){return this.nearRadius},this.updateNearFarValues=function(){var e,t,i;return function(n,r){if(r.isEmpty())rt.warn("Calculating near-far values based on empty worldBox (infinity) will result in incorrect values - Better to keep previous values instead.");else{if(i||(e=new(v().Matrix4),t=new(v().Matrix4),i=new(v().Box3)),e.compose(n.position,n.quaternion,n.scale),t.copy(e).invert(),i.copy(r),T){var o=new(v().Vector3);o.multiplyVectors(i.max,n.worldup);var s=new(v().Vector3);s.multiplyVectors(i.min,n.worldup),o.sub(s),o.x>=0?i.min.x-=o.x:i.max.x-=o.x,o.y>=0?i.min.y-=o.y:i.max.y-=o.y,o.z>=0?i.min.z-=o.z:i.max.z-=o.z}A&&A.groundShapeBox&&i.union(A.groundShapeBox),i.applyMatrix4(t);var a=1e-5*(i.max.z-i.min.z),l=.5*(i.max.y-i.min.y),c=-(i.max.z+a)-l,u=-(i.min.z-a)+l;if(n.isPerspective){if(this.nearRadius>0)c=Math.max(c,Math.min(this.nearRadius,1e-4*Math.abs(u-c))),u=Math.min(u,1e4*c);else{if(c=Math.max(c,Math.min(1,1e-4*Math.abs(u-c))),n.target){const e=n.target.clone().sub(n.position).length();c=Math.min(c,e)}u<0&&(u=1e-4),c=Math.max(c,1e-5*u)}const e=Math.sqrt(Kp.pointToBoxDistance2(n.position,r)),t=Math.max(1,e);c=Math.min(c,t)}u=Math.max(u,c),n.near=c,n.far=u,n.updateCameraMatrices()}}}(),this.getPixelsPerUnit=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.model;var n=_.settings.deviceHeight,r=b.getCutPlanesRaw()[0],o=i?i.getBoundingBox():t;return Kp.getPixelsPerUnit(e,this.is2d,t,n,r,o)},this.updateCameraMatrices=function(){const e=this.camera;e.worldup&&this.setWorldUp(e.worldup);const t=this.getVisibleBounds(!0,O);this.updateNearFarValues(e,t),this.maxModelDistance&&this._applyMaxModelDistanceToNearFar();const i=this.getPixelsPerUnit(e,t),n=_.settings.deviceWidth,r=_.settings.deviceHeight;this.is2d?(b.updatePixelScale(i,n,r,e),b.updateSwapBlackAndWhite(this.swapBlackAndWhite)):b.updatePixelScale(i,n,r,e),ue&&x.getMainPass().updatePixelScale(i,e);this.get2DModels().forEach((t=>{const i=t.getModelToViewerTransform(),o=i?i.getMaxScaleOnAxis():1;if(!this.is2d||1!==o){const i=t.getVisibleBounds(),s=Kp.getPixelsPerUnit(e,!0,i,r,null,i);b.updatePixelScaleForModel(t,s,n,r,o,e)}}))},this.initLights=function(){Y||(this.dir_light1=new(v().DirectionalLight)(Q,1),this.dir_light1.position.copy(L),this.amb_light=new(v().AmbientLight)(Z),this.lights=[this.dir_light1,this.amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),Y=!0)};function Ue(){if(sn)return;if(F())return;var e=M.getModels().length;let t=_.mrtFlags();e>1&&t.mrtIdBuffer<2&&(_.setIdTargetCount(2)&&b.toggleMRTSetting(_.mrtFlags()))}this.toggleLights=function(e,t){this.amb_light&&(this.lightsOn=e,function(e,t,i,n){var r,o,s=xo[f],a=s&&s.ambientColor,l=s&&s.directLightColor;a=(null===(r=a)||void 0===r?void 0:r.slice(0))??Z.toArray(),l=(null===(o=l)||void 0===o?void 0:o.slice(0))??Q.toArray(),i?(n&&e?e.color.setRGB(.5*l[0],.5*l[1],.5*l[2]):e&&e.color.setRGB(a[0],a[1],a[2]),t&&t.color.setRGB(l[0],l[1],l[2])):e&&n&&e.color.setRGB(a[0],a[1],a[2])}(this.amb_light,this.dir_light1,e,t))},this.syncCamera=function(e){this.camera.updateCameraMatrices(),e&&this.setWorldUp(this.api.navigation.getWorldUpVector()),w=!0},this.getModelCamera=function(e){if(!e)return;let t;const i=e.getDefaultCamera();return t=i||ny.getViewParamsFromBox(e.getBoundingBox(),e.is2d(),this.camera.aspect,this.camera.up,this.camera.fov),t},this.setViewFromFile=function(e,t){if(e){var i=this.getModelCamera(e),n=e.getMetadata("navigation hint","value",null),r=this.controls.isToolActivated("freeorbit")||t&&"Freeorbit"===n;this.setViewFromCamera(i,t,r)}},this.adjustOrthoCamera=function(e){var t=this.getVisibleBounds();ny.adjustOrthoCamera(e,t)},this.setViewFromCamera=function(e,t,i){this.adjustOrthoCamera(e);var n,r=this.model?this.model.getUpVector():null;n=r?(new(v().Vector3)).fromArray(r):i?e.up.clone():zy.snapToAxis(e.up.clone());const o=e.target.clone().sub(e.position).normalize().distanceTo(n.clone().negate())<1e-6;i?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",n.equals(e.up)):o||(e.up=n);var s=this.api.navigation;if(s){var a=this.camera;if(t)a.up.copy(e.up),a.position.copy(e.position),a.target.copy(e.target),e.isPerspective?a.fov=e.fov:(a.saveFov=e.fov,a.fov=ny.ORTHO_FOV),a.isPerspective=e.isPerspective,a.orthoScale=e.orthoScale,a.dirty=!0,s.setWorldUpVector(i||o?n:a.up),s.setView(a.position,a.target),s.setPivotPoint(a.target),this.syncCamera(!0);else if(a.isPerspective=e.isPerspective,e.isPerspective||(a.saveFov=e.fov,e.fov=ny.ORTHO_FOV),i)s.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,e.up,n);else{var l=this.getVisibleBounds();if(!l.containsPoint(e.target)){var c=l.getCenter(new(v().Vector3)).distanceTo(e.position),u=e.target.clone().sub(e.position).normalize().multiplyScalar(c);e.target.copy(e.position.clone().add(u))}var h=s.computeOrthogonalUp(e.position,e.target);s.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,h,n)}}w=!0},this.getViewArrayFromCamera=function(e){var t,i=e||{x:0,y:0,z:0},n=this.camera,r=this.model.getUpVector();t=r?(new(v().Vector3)).fromArray(r):zy.snapToAxis(n.up.clone());var o=this.api.navigation.getPivotPoint();return[n.position.x+i.x,n.position.y+i.y,n.position.z+i.z,o.x+i.x,o.y+i.y,o.z+i.z,t.x,t.y,t.z,n.aspect,v().Math.degToRad(n.fov),n.orthoScale,n.isPerspective?0:1]},this.setViewFromViewBox=function(e,t,i,n){if(!e.is2d())return;var r={},o=e.getBoundingBox(),s={width:t[2]-t[0],height:t[3]-t[1]};s.aspect=s.width/s.height,s.centerX=t[0]+s.width/2,s.centerY=t[1]+s.height/2;var a=this.camera.aspect;a>s.aspect?r.orthoScale=s.height:r.orthoScale=s.width/a;const l=o.getCenter(new(v().Vector3));r.isPerspective=!1,r.position=new(v().Vector3)(s.centerX,s.centerY,l.z+r.orthoScale),r.target=new(v().Vector3)(s.centerX,s.centerY,l.z),r.target.y+=1e-6*s.height,r.up=new(v().Vector3)(0,0,1),this.setViewFromCamera(r,n,!1)},this.setWorldUp=function(e){if(!n.equals(e)){n.copy(e);var t=Math.abs(e.x);y="x",Math.abs(e.y)>t&&(y="y",t=Math.abs(e.y)),Math.abs(e.z)>t&&(y="z");var r,o,s,a,l=new(v().Vector3)(0,1,0);i.camera.worldUpTransform=(r=l,o=e,s=(new(v().Vector3)).crossVectors(o,r).normalize(),a=Math.acos(r.dot(o)),(new(v().Matrix4)).makeRotationAxis(s,a)),this.sceneUpdated(!1)}},this.setUp2DMode=function(e,t){const n=e.getData();null!=n&&n.layerCount&&b.initLayersTexture(n.layerCount,n.layersMap,e.id);const r=b.create2DMaterial(null,{},!0,!1,(function(){i.invalidate(!1,!0,!1)})),o=b.findMaterial(null,r);if(!t){this.is2d&&_.exit2DMode(),_.enter2DMode(o,b.get2dSelectionColor()),this.is2d||this.saveLightPreset(),this.is2d=!0,this.setLightPreset(go),this.setRenderingPrefsFor2D(!0);const t=e.getData();if(null!=t&&t.hidePaper){var s=t.bgColor,a=s>>16&255,l=s>>8&255,c=255&s;this.setClearColors(a,l,c,a,l,c)}}},this.addModel=function(e,t){if(e){var i=!!this.model,n=e.is2d();this.model||e.getData().underlayRaster||(this.model=e,_.setUnitScale(e.getUnitScale())),this.layers||(this.layers=new YA(this)),e.getData().underlayRaster||this.layers.addModel(e,!0),M.addModel(e),this.selector.addModel(e),this.visibilityManager.addModel(e),ue&&!n&&x.add3dModel(e),this._setModelPreferences(e),n?this.setUp2DMode(e,i):this.is2d?(this.is2d=void 0,_.exit2DMode()):m>=0&&(p=m),this.updateClearColors(),this.setupLighting(e),Ue(),this.fireRenderOptionChanged(),this.invalidate(!0),this.api.fireEvent({type:Zn,model:e,preserveTools:t,isOverlay:i})}},this._setModelPreferences=function(e){void 0!==this.api.prefs.get("lineRendering")&&(e.hideLines(!this.api.prefs.get("lineRendering")),e.hidePoints(!this.api.prefs.get("pointRendering"))),e.selector.setSelectionMode(this.api.prefs.get(Mn.SELECTION_MODE))},this.setupLighting=function(e){e=e||this.model,S()||!e||e.is2d()||(this.setLightPresetFromFile(e)||(p>=0?(this.setLightPreset(p,!0,g),p=-1,g=null):this.setLightPreset(f,!1)),ue||this.setAOHeuristics(e))},this.getSvfMaterialId=function(e){return this.model.getFragmentList().getSvfMaterialId(e)},this.getMaterials=function(){return b},this.setupMesh=function(e,t,i,n){const r={geometry:t,matrix:n};return(i||null===i)&&(r.material=this.matman().setupMaterial(e,t,i)),r.isLine=t.isLines,r.isWideLine=t.isWideLines,r.isPoint=t.isPoints,r.is2d=t.is2d,e.is2d()&&(r.geometry.creationTime=z,this.lastTime2dGeometryCreated=z),r},this.selection2dOverlayName=function(e){return b._getMaterialHash(e,"selection2d")},this.init2dSelection=function(e){var t=this.selection2dOverlayName(e);if(this.overlayScenes[t])return;var n=b.initSelectionTexture(e.getData().maxObjectNumber,e.id);const r=e.getFragmentList(),o=e.getDoNotCut();let s;if(null!=r&&r.viewBounds){const e=r.viewBounds;s=new(v().Vector4)(e.min.x,e.min.y,e.max.x,e.max.y)}var a=b.create2DMaterial(e,{doNotCut:o,viewportBounds:s},!1,n,(function(){i.invalidate(!1,!0,!1)})),l=b.findMaterial(e,a);this.createOverlayScene(t,l)},this.onLoadComplete=function(e){K=!1,this.signalProgress(100,Gp.LOADING,e),this.modelVisible(e.id)&&((C&&C.enabled||T)&&this.sceneUpdated(!1,!0),this.invalidate(!!T,!0,!1)),e.is2d()&&this.init2dSelection(e);var t=e.getGeometryList();t&&t.printStats(),e.hasGeometry()?b.hasTransparentMaterial()&&this.requestSilentRender():rt.warn("Loaded model has no geometry."),this.api.dispatchEvent({type:Wn,model:e})},this.onTextureLoadComplete=function(e){this.api.dispatchEvent({type:jn,model:e}),this.requestSilentRender()},this.signalProgress=function(e,t,i){B.percent===e&&B.state===t&&i&&B.model&&B.model.id===i.id||(B.percent=e,B.state=t,i&&(B.model=i),this.api.dispatchEvent(B))},this.resize=function(e,t,i){o=!0,s=e,a=t,i&&pe(!0)},this.unloadModel=function(e,t){if(this.api.dispatchEvent({type:Qn,model:e}),this.removeModel(e)||M.removeHiddenModel(e)){var i,n,r,o;if(!t)if(b.cleanup(e),e.dtor(),e.loader)null===(i=(n=e.loader).dtor)||void 0===i||i.call(n),e.loader=null;if(e.is2d()&&this.overlayScenes[e.id]&&this.removeOverlayScene(this.selection2dOverlayName(e)),B.model===e&&(B.model=null),this.api.dispatchEvent({type:Yn,model:e}),!sn)null===(r=C)||void 0===r||r.resetScenesPerModel(),null===(o=T)||void 0===o||o.resetScenesPerModel()}},this._reserveLoadingFile=function(){this.loaders||(this.loaders=[]);var e={dtor:function(){}};return this.loaders.push(e),e},this._hasLoadingFile=function(){return this.loaders&&this.loaders.length>0},this._addLoadingFile=function(e,t){if(this.loaders){var i=this.loaders.indexOf(e);i>=0&&(this.loaders[i]=t)}},this._removeLoadingFile=function(e){if(this.loaders){var t=this.loaders.indexOf(e);t>=0&&this.loaders.splice(t,1)}},this.removeModel=function(e){return!!M.removeModel(e)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),this.selector.removeModel(e),this.visibilityManager.removeModel(e),this.layers.removeModel(e),ue&&e.is3d()&&x.remove3dModel(e),e===this.model&&(this.model=null,M.isEmpty()||(this.model=M.getModels()[0])),Ue(),this.invalidate(!0,!0,!0),this.api.fireEvent({type:$n,model:e}),!0)},this.cancelLoad=function(e){if(this.loaders)for(var t=0;t<this.loaders.length;t++){var i=this.loaders[t];if(i.currentLoadPath===e){i.dtor(),this.loaders.splice(t,1);break}}},this.unloadCurrentModel=function(){this.model&&(this.is2d?(this.is2d=void 0,this.removeOverlayScene(this.selection2dOverlayName(this.model)),_.exit2DMode()):p=f,this.model.is3d()&&(m=f),_.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),_.composeFinalFrame(!0)),this.loaders&&(this.loaders.forEach((function(e){e.dtor()})),this.loaders=[]);for(var e=M.getAllModels(),t=e.length-1;t>=0;t--)this.unloadModel(e[t]);this.model=null};var ke=function(){var e,t,n;i.selectionMaterialBase=new(v().MeshPhongMaterial)({specular:526344,opacity:1,transparent:!1}),i.selectionMaterialTop=new(v().MeshPhongMaterial)({specular:526344,opacity:.15,transparent:!0}),i.selectionMaterialTop.packedNormals=!0,i.selectionMaterialBase.packedNormals=!0,e="selection",t=i.selectionMaterialBase,n=i.selectionMaterialTop,t.depthWrite=!1,t.depthTest=!0,t.side=v().DoubleSide,n.depthWrite=!1,n.depthTest=!0,n.side=v().DoubleSide,b.addInstancingSupport(t),b.addInstancingSupport(n),i.createOverlayScene(e,t,n),i.highlightMaterial=new(v().MeshPhongMaterial)({specular:526344,opacity:1,transparent:!1}),i.highlightMaterial.packedNormals=!0,i.highlightMaterial.disableTheming=!0,b.addInstancingSupport(i.highlightMaterial),b.addMaterial("__highlightMaterial__",i.highlightMaterial,!0)};this.createOverlayScene=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];t&&b.addOverrideMaterial(e+"_pre",t),i&&b.addOverrideMaterial(e+"_post",i);var a=new(v().Scene);return a.name=e,a.__lights=this.scene.__lights,this.overlayScenes[e]={scene:a,camera:n,materialName:e,materialPre:t,materialPost:i,needIdTarget:r,needSeparateDepth:o,hiddenFromMainRender:s}},this.removeOverlayScene=function(e){if(this.overlayScenes[e]){var t=this.overlayScenes[e];t.materialPre&&b.removeMaterial(t.materialName+"_pre"),t.materialPost&&b.removeMaterial(t.materialName+"_post"),delete this.overlayScenes[e],this.invalidate(!1,!1,!0)}},this.addOverlay=function(e,t){this.overlayScenes[e]&&t&&(this.overlayScenes[e].scene.add(t),this.invalidate(!1,!1,!0))},this.addMultipleOverlays=function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&this.addOverlay(e,t[i])},this.removeOverlay=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.overlayScenes[e]&&t&&(this.overlayScenes[e].scene.remove(t),i&&t.geometry&&t.geometry.dispose(),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&this.removeOverlay(e,t[n],i)},this.clearOverlay=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.overlayScenes[e]){var i,n,r=this.overlayScenes[e].scene;for(n=r.children.length-1;n>=0;--n)(i=r.children[n])&&(r.remove(i),t&&i.geometry&&i.geometry.dispose());this.invalidate(!1,!1,!0)}},this.setClearColors=function(e,t,i,n,r,o){this.clearColorTop=new(v().Vector3)(e/255,t/255,i/255),this.clearColorBottom=new(v().Vector3)(n/255,r/255,o/255),this.updateClearColors(),T&&T.setClearColors(this.clearColorTop,this.clearColorBottom,F()),R=!0,this.fireRenderOptionChanged()},this.setClearAlpha=function(e){_.setClearAlpha(e)};var Fe=new(v().Box3);function Ve(e,t,i){t.updateMatrixWorld(!0),t.traverse((function(t){var n=t.geometry;const r=t.model&&"number"==typeof t.fragId;if(!r||n.boundingBox)void 0!==n&&t.visible&&(n.boundingBox||n.computeBoundingBox(),Fe.copy(n.boundingBox),Fe.applyMatrix4(t.matrixWorld),i&&!i(Fe)||e.union(Fe));else{const n=r&&t.model.getFragmentList();n&&(n.getWorldBounds(t.fragId,Fe),i&&!i(Fe)||e.union(Fe))}}))}var Ge,ze=new(v().Box3);this.getVisibleBounds=function(e,t,n,r){var o=new(v().Box3);return M.isEmpty()||(Ve(o,this.scene,n),o=M.getVisibleBounds(e,n,r).union(o),t&&(o=function(e){ze.makeEmpty();var t=i.overlayScenes;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&Ve(ze,t[n].scene,e);return Ve(ze,i.scene,e),Ve(ze,i.sceneAfter,e),ze}(n).union(o))),o},this.getFitBounds=function(e){var t;return e||null===this.selector||(t=this.selector.getSelectionBounds()),t&&!t.isEmpty()||(t=this.getVisibleBounds()).isEmpty()&&this.model.is2d()&&(t=this.model.getBoundingBox()),t},this.getRenderProxy=function(e,t){var i;return null===(i=e.getFragmentList())||void 0===i?void 0:i.getVizmesh(t)},this.getLayersRoot=function(){return this.layers.getRoot()},this.getFragmentProxy=function(e,t){return new Al(e.getFragmentList(),t)},this.getRenderProxyCount=function(e){return e.getFragmentList().getCount()},this.getRenderProxyDbIds=function(e,t){return e.getFragmentList().getDbIds(t)},this.isWholeModelVisible=function(){return!M||M.areAllVisible()},this.isNodeVisible=function(e,t){return this.visibilityManager.isNodeVisible(t,e)},this.highlightObjectNode=function(e,t,i,n){t=e.reverseMapDbIdFor2D(t),e.is2d()&&(b.highlightObject2D(t,i,e.id),this.invalidate(!1,!1,!0)),this.renderer().setDbIdForEdgeDetection(i&&!n?t:0,i?e.id:0);var r=this,o=e.getData().instanceTree;if(o&&!e.is2d())if(e.useIdBufferSelection){var s=e.getData().fragments.dbId2fragId[t];r.highlightFragment(e,s,i,n)}else o.enumNodeFragments(t,(function(t){r.highlightFragment(e,t,i,n)}),!1);else{let o=t;if(e.is2d()&&e.getData().fragments&&(o=e.getData().fragments.dbId2fragId[t]),Array.isArray(o))for(var a=0;a<o.length;a++)r.highlightFragment(e,o[a],i,n);else r.highlightFragment(e,o,i,n)}},this.highlightFragment=function(e,t,i,n){if(e.isLeaflet())return e.getIterator().highlightSelection(i,this.highlightMaterial.color),void this.invalidate(!0);var r=this.getRenderProxy(e,t);if(r){var o=!n||r.is2d||r.isPoint,s=e.id+":"+t;if(o){var a="selection";if(e.is2d()&&(a=this.selection2dOverlayName(e)),r.isPoint&&(a+="_points"),i)if(r.is2d&&Object.prototype.hasOwnProperty.call(this.selectionMeshes,s))++this.selectionMeshes[s]._lmv_highlightCount;else{var l;if(!r||!r.geometry)return;if(r.isPoint){var c=r.material.clone();c.color=this.selectionMaterialBase.color,c.needsUpdate=!0,c.defines&&r.geometry.attributes.pointScale&&(c.defines.PARTICLE_FLAGS=1),l=new(v().Mesh)(r.geometry,c)}else l=new(v().Mesh)(r.geometry,r.material);l.matrix.copy(r.matrixWorld),l.matrixAutoUpdate=!1,l.matrixWorldNeedsUpdate=!0,l.frustumCulled=!1,l.model=e,l.fragId=t,l._lmv_highlightCount=1,this.addOverlay(a,l),this.selectionMeshes[s]=l}else if(Object.prototype.hasOwnProperty.call(this.selectionMeshes,s)){var u=this.selectionMeshes[s];--u._lmv_highlightCount<=0&&(this.removeOverlay(a,u),delete this.selectionMeshes[s])}}o&&i||e.setHighlighted(t,i)&&this.invalidate(!0)}},this.explode=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Object.keys(t);for(let e of i)Object.prototype.hasOwnProperty.call(G,e)||rt.warn(`Property "${e}" is not part of Explode options.`);const n=(()=>{for(let e of i)if(Object.prototype.hasOwnProperty.call(G,e)&&t[e]!=G[e])return!1;return!0})();return((e=Number(e))!=V||!n)&&(V=e,i.filter((e=>Object.prototype.hasOwnProperty.call(G,e))).forEach((e=>G[e]=t[e])),this.refreshExplode(),this.api.dispatchEvent({type:Ar,scale:e,options:t}),!0)},this.refreshExplode=function(){M.explode(V,G),this.sceneUpdated(!0)},this.getExplodeScale=function(){return V},this.getExplodeOptions=function(){return{...G}},this.lockExplode=function(e,t,i){const n=(i=i||this.model).getData().instanceTree;if(!n)return!1;const r=function(e,i){return n.enumNodeChildren(i,(function(i){e=n.lockNodeExplode(i,t)||e}),!0),e};let o;return o=Array.isArray(e)?e.reduce(r,!1):r(!1,e),o&&V>0&&(M.explode(V),this.sceneUpdated(!0)),o},this.isExplodeLocked=function(e,t){const i=(t=t||this.model).getData().instanceTree;return i&&i.isNodeExplodeLocked(e)},this.setGhostingBrightness=function(e){var t=new(v().Color)(e?1052688:16777215);function i(e){e.color=t}i(this.fadeMaterial),this.fadeMaterial.variants&&this.fadeMaterial.variants.forEach(i),ue&&x.getMainPass().setGhostingBrightness(e)},this.loadCubeMap=function(e,t){this._reflectionMapPath=e;return Hu.loadCubeMap(e,t,(function(t){if(e===i._reflectionMapPath&&b)if(b.setReflectionMap(t),ue&&x.getIBL().setReflectionMap(t),i.invalidate(!0),t)xo[f].useIrradianceAsBackground||_.setCubeMap(t);else{const e=_u(i.clearColorTop,i.clearColorBottom);b.setReflectionMap(e)}}))},this.loadIrradianceMap=function(e,t){this._irradianceMapPath=e;return Hu.loadCubeMap(e,t,(function(t){e===i._irradianceMapPath&&b&&(b.setIrradianceMap(t),ue&&x.getIBL().setIrradianceMap(t),i.invalidate(!0),xo[f].useIrradianceAsBackground&&_.setCubeMap(t))}))},this.setCurrentLightPreset=function(e){f=e},this.setLightPreset=function(e,t,i){var n;if(S()&&(e=0),this.initLights(),f===e&&!t)return void(i&&i());if((e<0||xo.length<=e)&&(e=mo),f=e,M.isEmpty())return p=f,void(g=i);var r=xo[e],o=r.bgColorGradient;if(o||(o=yo.Custom),this.setClearColors(o[0],o[1],o[2],o[3],o[4],o[5]),void 0!==r.useIrradianceAsBackground&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?rt.debug("setLightPreset(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(r.useIrradianceAsBackground))),r.path){var s="res/environments/"+r.path,a=de(s+"_mipdrop."+(r.type||"")+".dds"),l=de(s+"_irr."+(r.type||"")+".dds");this.loadIrradianceMap(l,r.E_bias),this.loadCubeMap(a,r.E_bias),b.setEnvExposure(-r.E_bias),ue&&x.getIBL().setEnvExposure(-r.E_bias),_.setEnvExposure(-r.E_bias),this.setTonemapExposureBias(r.E_bias),this.setTonemapMethod(r.tonemap),this.setGhostingBrightness(r.darkerFade)}else{var c=_u(this.clearColorTop,this.clearColorBottom);_.setCubeMap(c),b.setIrradianceMap(null),b.setReflectionMap(c),ue&&x.getIBL().setIrradianceMap(),b.setEnvExposure(-r.E_bias||0),ue&&x.getIBL().setEnvExposure(-r.E_bias),_.setEnvExposure(-r.E_bias||0),this.setTonemapExposureBias(r.E_bias||0),this.setTonemapMethod(r.tonemap||0),this.setGhostingBrightness(r.darkerFade),_.toggleEnvMapBackground(X),this.invalidate(!0)}const u=null===(n=M)||void 0===n?void 0:n.getModels().filter((e=>{var t;const i=null==e?void 0:e.getDocumentNode(),n=(null==i?void 0:i.getInputFileType())||(null==i||null===(t=i.getRootNode())||void 0===t||null===(t=t.data)||void 0===t?void 0:t.name)||"";return["dwfx","dwf"].includes(n.toLowerCase())}));u.length>0&&u.forEach((e=>{b.forEachInModel(e,!1,(e=>{e.emissiveOrig||(e.emissiveOrig=e.emissive),e.emissive=e.emissiveOrig.clone().multiplyScalar(Math.pow(2,-r.E_bias))}))}));var h=nx.uniforms.radius.value,d=nx.uniforms.intensity.value,m=void 0;ue&&(h=8,d=1,m=.25),Object.prototype.hasOwnProperty.call(r,"saoRadius")&&(h=r.saoRadius),Object.prototype.hasOwnProperty.call(r,"saoIntensity")&&(d=r.saoIntensity),ue?_.setAOOptions(h,d,m):_.setAOOptions(h,d);var v=1;null!==r.lightMultiplier&&void 0!==r.lightMultiplier&&(v=r.lightMultiplier),P.copy(I),r.lightDirection&&P.fromArray(r.lightDirection).negate(),A&&ge(),this.dir_light1&&(this.dir_light1.intensity=v,r.lightDirection?this.dir_light1.position.set(-r.lightDirection[0],-r.lightDirection[1],-r.lightDirection[2]):this.dir_light1.position.copy(L)),b.setEnvRotation(r.rotation||0),_.setEnvRotation(r.rotation||0),T&&T.setEnvRotation(r.rotation||0),this.toggleLights(0!==v),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged(),i&&i()},this.setLightPresetFromFile=function(e){if(!e||e.is2d())return!1;let t;var i=e.getMetadata("renderEnvironmentGroundReflection","value",null);t=this.api.prefs.hasTag(Mn.GROUND_REFLECTION,"ignore-producer"),null===i||t||(this.api.prefs.tag("no-storage",Mn.GROUND_REFLECTION),this.api.setGroundReflection(i));var n=e.getMetadata("renderEnvironmentGroundShadow","value",null);t=this.api.prefs.hasTag(Mn.GROUND_SHADOW,"ignore-producer"),null===n||t||(this.api.prefs.tag("no-storage",Mn.GROUND_SHADOW),this.api.setGroundShadow(n));var r=e.getMetadata("renderEnvironmentAmbientShadows","value",null);t=this.api.prefs.hasTag(Mn.AMBIENT_SHADOWS,"ignore-producer"),null===r||t||(this.api.prefs.tag("no-storage",Mn.AMBIENT_SHADOWS),this.api.setQualityLevel(r,_.getAntialiasing()));var o=e.getMetadata("renderEnvironmentDisplayLines","value",null);t=this.api.prefs.hasTag(Mn.LINE_RENDERING,"ignore-producer"),null===o||t||(this.api.prefs.tag("no-storage",Mn.LINE_RENDERING),this.api.hideLines(!o));var s=e.getMetadata("renderEnvironmentDisplayPoints","value",null);t=this.api.prefs.hasTag(Pn.POINT_RENDERING,"ignore-producer"),null===s||t||(this.api.prefs.tag("no-storage",Pn.POINT_RENDERING),this.api.hidePoints(!s));var a=e.getMetadata("renderEnvironmentDisplayEdges","value",null);t=this.api.prefs.hasTag(Mn.EDGE_RENDERING,"ignore-producer"),null===a||t||(this.api.prefs.tag("no-storage",Mn.EDGE_RENDERING),this.api.setDisplayEdges(!F()&&!!a));var l=e.getMetadata("renderEnvironmentStyle","value",null),c=xo.filter((function(e){return e.name===l}))[0];if(t=this.api.prefs.hasTag(Mn.LIGHT_PRESET,"ignore-producer"),c&&!t){this.api.prefs.tag("no-storage",Mn.LIGHT_PRESET);var u=Cw;u||(u=Cw={},xo.push(u)),Eo(c,u),u.name="Custom Model defined";var h=e.getMetadata("renderEnvironmentExposureBias","value",null),d=e.getMetadata("renderEnvironmentExposureBase","value",null);null!==h&&null!==d&&(u.E_bias=h+d);var f=e.getMetadata("renderEnvironmentBackgroundColor","value",null);t=this.api.prefs.hasTag(Pn.BACKGROUND_COLOR_PRESET,"ignore-producer"),f&&!t&&(u.bgColorGradient=[255*f[0],255*f[1],255*f[2],255*f[0],255*f[1],255*f[2]]);var p=e.getMetadata("renderEnvironmentRotation","value",null);null!==p&&(u.rotation=p);var m=xo.indexOf(u);this.setLightPreset(m,!0)}var g=e.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);return t=this.api.prefs.hasTag(Mn.ENV_MAP_BACKGROUND,"ignore-producer"),null===g||t||(this.api.prefs.tag("no-storage",Mn.ENV_MAP_BACKGROUND),this.api.setEnvMapBackground(g)),c},this.setLightPresetForAec=function(){for(var e=c().DefaultLightPresetAec||"Boardwalk",t=-1,i=0;i<xo.length;i++)if(xo[i].name===e){t=i;break}return t>=0&&(this.api.prefs.hasTag("lightPreset","ignore-producer")?rt.debug("setLightPresetForAec(): lightPreset is locked. No changes."):(this.api.prefs.tag("no-storage","lightPreset"),this.setLightPreset(t,!0,function(){this.api.prefs.tag("ignore-producer","envMapBackground")}.bind(this)),this.saveLightPreset())),this.api.prefs.hasTag("edgeRendering","ignore-producer")?rt.debug("setLightPresetForAec(): edgeRendering is locked. No changes."):(this.api.prefs.tag("no-storage","edgeRendering"),this.api.setDisplayEdges(!F())),!0},this.setAOHeuristics=function(e){var t=e.getUnitScale(),i=e.getMetadata("renderEnvironmentAmbientShadows","radius",void 0),n=e.getMetadata("renderEnvironmentAmbientShadows","intensity",void 0),r=e.getMetadata("renderEnvironmentAmbientShadows","opacity",void 0);if(void 0!==i||void 0!==n||void 0!==r)_.setAOOptions(i/t,n,r);else if(e.isAEC()){t>.3?_.setAOOptions(4/t,1,.625):_.setAOOptions(.25/t,1,.625)}else{var o=e.getData().bbox.getSize(new(v().Vector3)).length();_.setAOOptions(Math.min(10,.05*o))}},this.setTonemapMethod=function(e){e!=_.getToneMapMethod()&&(_.setTonemapMethod(e),b.setTonemapMethod(e),ue&&x.getIBL().setTonemapMethod(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(e){e!=_.getExposureBias()&&(_.setTonemapExposureBias(e),ue&&x.getIBL().setExposureBias(e),b.setTonemapExposureBias(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setRenderingPrefsFor2D=function(e){if(!S()){var t=!e&&!!this.api.prefs.get("envMapBackground");this.toggleEnvMapBackground(t)}},this.dtor=function(){var e;if(Ji&&(NS.unregisterViewer(this),km.unregisterViewer(this)),this.stop(),this.api.removeEventListener(Hn,ne),this.api.removeEventListener(Hn,re),this.api.removeEventListener(zn,oe),this.unloadCurrentModel(),this.controls=null,this.canvas=null,clearInterval(this.interval),this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.layers=null,this.visibilityManager=null,J&&(J.removeViewer(this.api),J=null),M=null,null===(e=_)||void 0===e||e.cleanup(),_=null,b.refCount--,0===b.refCount&&b.dtor(),b=null,C=null,T=null,x){if(x.refCount--,x.removeEventListener(ww.Events.WEBGL_CONTEXT_LOST,this.onWebGLcontextLost),x.removeEventListener(ww.Events.WEBGL_CONTEXT_RESTORED,this.onWebGLcontextRestored),0===x.refCount){if(!sn){let e=x.getContext();var t;if(x.dtor(),H()&&W())null==e||null===(t=e.getExtension("WEBGL_lose_context"))||void 0===t||t.loseContext()}x.domElement=null,x.context=null}x=null}},this.hideLines=function(e){M&&!M.isEmpty()&&(M.hideLines(e),this.sceneUpdated(!0))},this.hidePoints=function(e){M&&!M.isEmpty()&&(M.hidePoints(e),this.sceneUpdated(!0))},this.setDisplayEdges=function(e){_.toggleEdges(e);var t=e;e||(t=!(!this.model||!this.model.getData().hasLines)),b.togglePolygonOffset(t),_.setDepthMaterialOffset(b.getPolygonOffsetOn(),b.getPolygonOffsetFactor(),b.getPolygonOffsetUnits()),this.invalidate(!0)},this.setDoubleSided=function(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if((t=t||this.model).is2d())return;t.getData()&&(this.matman().setDoubleSided(e,t),i&&this.sceneUpdated())},this.getAllCutPlanes=function(){var e=void 0;for(var t in se){var i=se[t];i&&i.length&&(e=e?t===le?i.concat(e):e.concat(i):i)}return e},this.setCutplanesHideInterior=function(e){ae=Boolean(e)},this.cutplanesHideInteriorEnabled=function(){return ae},this.updateCutPlanes=function(){var e=this.getAllCutPlanes();this.setCutPlanes(e)},this.setCutPlaneSet=function(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(se[e]=t?t.slice():void 0,i)this.updateCutPlanes();else{var n=this.getAllCutPlanes();this.setCutPlanesInScene(n)}},this.setCutPlaneSetFor2DRendering=function(e){le=e,this.updateCutPlanes()},this.getCutPlaneSet=function(e){return se[e]||[]},this.getCutPlaneSets=function(){var e=[];for(var t in se){var i=se[t];i&&i.length&&e.push(t)}return e},this.getCutPlanes=function(){return b.getCutPlanes()},this.setCutPlanesInScene=function(e){_.toggleTwoSided(b.setCutPlanes(e,ae?1:0)),ue&&_.setCutPlanes(e),this.sceneUpdated()},this.setCutPlanes=function(e){this.setCutPlanesInScene(e),this.api.dispatchEvent({type:Tr,planes:e})},this.fireRenderOptionChanged=function(){b.toggleMRTSetting(_.mrtFlags()),this.api.dispatchEvent({type:Ir})},this.viewportToRay=function(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.camera).viewportToRay(e,t)},this.rayIntersect=function(e,t,i,n,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(o.ignore2dModelsOn3d){const e=this.get3DModels().map((e=>e.id));n=n?n.filter((t=>e.includes(t))):e}var s=M.rayIntersect(e.origin,e.direction,t,i,n,r,(e=>{const t=(new(v().Vector3)).copy(e);t.project(this.camera);const i=[];return _.idAtPixel(t.x,t.y,i),i}),o),a=[this.scene,this.sceneAfter];const l=new(v().Vector3);for(let t=0;t<a.length;t++){let i=a[t];if(i.children.length){var c=new(v().Raycaster)(e.origin,e.direction,this.camera.near,this.camera.far);Ve(ze,i),c.params.Line.threshold=Math.min(1,.5*ze.getSize(l).length()*.001);var u=r||[];if(oc.intersectObject(i,c,u,!0),u.length){const e=u[0];(!s||e.distance<s.distance)&&(void 0!==e.modelId&&(e.model=this.findModel(e.modelId)),s=e)}}}return s?(void 0===s.dbId&&void 0!==s.fragId&&(s.dbId=s.model.getFragmentList().getDbIds(s.fragId),s.model.getData().instanceTree||(s.dbId=s.fragId)),s.intersectPoint=s.point,s):null},this.castRayViewport=function(e,t,i,n,r,o){return Ge=Ge||new(v().Ray),M?(this.viewportToRay(e,Ge),this.rayIntersect(Ge,t,i,n,r,o)):{}},this.getCanvasBoundingClientRect=function(){return this.canvasBoundingclientRectDirty&&(this.canvasBoundingclientRectDirty=!1,this.boundingClientRect=this.canvas.getBoundingClientRect()),this.boundingClientRect},this.clientToViewport=function(e,t){var i=this.getCanvasBoundingClientRect();return new(v().Vector3)((e+.5)/i.width*2-1,-(t+.5)/i.height*2+1,1)},this.viewportToClient=function(e,t){var i=this.getCanvasBoundingClientRect();return new(v().Vector3)(.5*(e+1)*i.width-.5,-.5*(t-1)*i.height-.5,0)},this.castRay=function(e,t,i,n){return this.castRayViewport(this.clientToViewport(e,t),i,void 0,void 0,void 0,n)},this.intersectGroundViewport=function(e){var t="z";this.is2d||(t=y);var i=this.model&&this.model.getBoundingBox();return Kp.intersectGroundViewport(e,this.camera,t,i)},this.intersectGround=function(e,t){return this.intersectGroundViewport(this.clientToViewport(e,t))},this._2dHitTestViewport=function(e,t,i){const n=[0,0],r=_.idAtPixels(e.x,e.y,t,n);if(r<i)return null;const o=M.findModel(n[1])||this.model;if(!o)return null;const s=this.intersectGroundViewport(e),a=o.getData().fragments,l=a?a.dbId2fragId[r]:-1;return{intersectPoint:s,dbId:o.remapDbIdFor2D(r),fragId:l,model:o}};const He=e=>t=>{if(!(t&&t.object&&t.object.isLine))return!0;const n=1/i.camera.pixelsPerUnitAtDistance(t.distance),r=e*n;return t.distanceToRay<r};function We(e,t,i,n){new hl(e.getFragmentList().getGeometry(t)).enumGeomsForVisibleLayer(i,n)}function je(e,t,i,n){new hl(e.getFragmentList().getGeometry(t)).enumGeomsForObject(i,n)}this.hitTestViewport=function(e,t,i,n,r,o){let s;if(this.is2d){const t=F()?45:5;s=this._2dHitTestViewport(e,t,1)}else s=this.castRayViewport(e,t,i,n,r,o);return s},this.hitTest=function(e,t,n,r,o,s){return i.hitTestViewport(this.clientToViewport(e,t),n,r,o,void 0,s)},this.hitBoxTestViewport=function(e,t,i){const n=[],r=[];_.idsAtPixelsBox(e.x,e.y,t,i,r);for(let e=0;e<r.length;e++){const t=M.findModel(r[e][1])||this.model;if(t){const i=t.remapDbIdFor2D(r[e][0]);n.push({dbId:i,model:t})}}return n},this.snappingHitTestViewport=function(e,t){let i;const n=F()?45:17;if(this.is2d)if(this.model&&this.model.isLeaflet()){i={intersectPoint:this.intersectGroundViewport(e)}}else i=this._2dHitTestViewport(e,n,0);else{const r=[],o=_.idAtPixels(e.x,e.y,n,r);r[2]&&r[3]&&(e.setX(r[2]),e.setY(r[3]));const s={filter:He(n)};i=this.castRayViewport(e,t,o>0?[o]:null,void 0,void 0,s)}return i},this.snappingHitTest=function(e,t,i){return this.snappingHitTestViewport(this.clientToViewport(e,t),i)},this.clearHighlight=function(){_.rolloverObjectId(-1),this.invalidate(!1,!1,!0)},this.rollOverIdChanged=function(){this.api.fireEvent({type:Zr,dbId:_.getRollOverDbId(),modelId:_.getRollOverModelId()}),this.invalidate(!1,!1,!0)},this.rolloverObjectViewport=function(e){if(!this.model)return;if(this.is2d&&this.model&&(this.model.isLeaflet()||this.model.isPdf(!0)&&this.api.prefs.get(In.DISABLE_PDF_HIGHLIGHT)))return;const t=[],i=_.idAtPixel(e.x,e.y,t);if(this.selector&&this.selector.isNodeSelectionLocked(i,this.model))return void this.clearHighlight();const n=t[1],r=this.findModel(n);null!=r&&r.isLeaflet()?_.rollOverModelId(n)&&this.rollOverIdChanged():_.rolloverObjectViewport(e.x,e.y)&&this.rollOverIdChanged()},this.rolloverObject=function(e,t){this.selector.highlightPaused||this.selector.highlightDisabled||this.rolloverObjectViewport(this.clientToViewport(e,t))},this.pauseHighlight=function(e){this.selector.highlightPaused=e,e&&this.clearHighlight()},this.disableHighlight=function(e){this.selector.highlightDisabled=e,e&&this.clearHighlight()},this.disableSelection=function(e){this.selector.selectionDisabled=e},this.cancelLeafletScreenshot=function(){i.api.dispatchEvent({type:Wr})},this.getScreenShotProgressive=function(e,t,i,n){return IS.getScreenShot(e,t,i,n,this)},this.modelQueue=function(){return M},this._getRcs=function(){return $},this.glrenderer=function(){return x},this.renderer=function(){return _},this.setGeomCache=function(e){(J=e).addViewer(i.api)},this.geomCache=function(){return!J&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.setGeomCache(new eg(i.api.config)),J},this.shadowMaps=function(){return A},this.worldUp=function(){return n},this.worldUpName=function(){return y},this.setUserRenderContext=function(e,t){_=e||new lx,t||(_.init(x,this.canvas.clientWidth,this.canvas.clientHeight),_.setClearColors(this.clearColorTop,this.clearColorBottom)),this.invalidate(!0),this.sceneUpdated(!1)},this.setUserGroundShadow=function(e){var t=C;return C=e,t},this.invalidate=function(e,t,i){R||(R=e),D||(D=t),O||(O=i)},this.isOverlayDirty=function(){return O},this.clearOverlayDirtyFlag=function(){O=!1},this.sceneUpdated=function(e,t,i){this.invalidate(!t,!1,!t),M&&e&&(M.invalidateVisibleBounds(),this.zoomBoundsChanged=!0),N=!0,ge(),i||this.api.fireEvent({type:no,objectsMoved:e})},this.requestSilentRender=function(){U=k=!0},this.requestDeferredSilentRender=function(){U=!0},this.currentLightPreset=function(){return f},this.saveLightPreset=function(){p=f},this.matman=function(){return b},this.fps=function(){return 1e3/j},this.setFPSTargets=function(e,t,i){u=1e3/i,d=1,h=1e3/t,this._updateTargetFrameBudget()},this._updateTargetFrameBudget=function(e,t){if(Ji){if(!$)return void(this.targetFrameBudget=h);$.frameTimeScalingFactorAvg=e??$.frameTimeScalingFactorAvg,$.frameTimeFraction=t??$.frameTimeFraction,this.targetFrameBudget=$.frameTimeScalingFactorAvg*h*$.frameTimeFraction}else if(rn){var n;this.targetFrameBudget=((null===(n=$)||void 0===n?void 0:n.frameTimeScalingFactorAvg)??1)*h}else $.beginFrameAvg<h&&$.frameBudget<u?i.targetFrameBudget+=1:$.beginFrameAvg>h&&$.frameBudget>d&&(this.targetFrameBudget*=.75+.25*h/$.beginFrameAvg);this.targetFrameBudget=Math.min(Math.max(this.targetFrameBudget,d),u)},this.track=function(e){rt.track(e)},this.worldToClient=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.camera;var i=new(v().Vector4)(e.x,e.y,e.z,1);return i.applyMatrix4(t.matrixWorldInverse),i.applyMatrix4(t.projectionMatrix),i.w>0&&(i.x/=i.w,i.y/=i.w,i.z/=i.w),this.viewportToClient(i.x,i.y)},this.clientToWorld=function(e,t,i,n,r){var o=null;if(this.is2d){var s=this.model,a=null==s?void 0:s.getData(),l=this.intersectGround(e,t);l?(l.z=0,(n||a.hidePaper||a.bbox.containsPoint(l))&&(o={point:l,model:s})):n&&(o={point:this.camera.position.clone(),model:s})}else(o=this.hitTest(e,t,i,void 0,void 0,{ignore2dModelsOn3d:r}))&&(o.point=o.intersectPoint);return o},this.set2dSelectionColor=function(e,t){this.matman().set2dSelectionColor(e,t),this.invalidate(!1,!1,!0)},this.setSelectionColor=function(e,t){t=t||FS.MIXED;var i=new(v().Color)(e);i.multiplyScalar(.5);var n=function(t){t.color.set(e),t.emissive.set(i),t.variants&&t.variants.forEach(n)};switch(t){default:case FS.MIXED:n(this.selectionMaterialBase),n(this.selectionMaterialTop),_.setSelectionColor(e),n(this.highlightMaterial),this.invalidate(!0);break;case FS.REGULAR:n(this.highlightMaterial),this.invalidate(!0);break;case FS.OVERLAYED:n(this.selectionMaterialBase),n(this.selectionMaterialTop),_.setSelectionColor(e),this.invalidate(!1,!1,!0)}},this.updateViewportId=function(e){b.updateViewportId(e),this.invalidate(!0)},this.findModel=function(e,t){let i;if("number"==typeof e)i=t=>t.id==e;else if(e instanceof Oa)i=t=>t.getDocumentNode()==e;else{if(!e)return null;i=e}let n=M.getModels().find(i);return t&&!n&&(n=M.getHiddenModels().find(i)),n},this.getFrameRate=function(){return this.frameDisplayRate},this.setFrameRate=function(e){this.frameDisplayRate=e<1?1:e},this.setShadowLightDirection=function(e){P.copy(e),ge(),this.invalidate(!0,!1,!1),me()},this.getShadowLightDirection=function(e){var t=e||new(v().Vector3);return t.copy(P),t},this.toggleShadows=function(e){!!A!=!!e&&(e?A=new zA(x):(A.cleanup(b),A=null),me(),this.invalidate(!0,!0,!1))},this.showTransparencyWhenMoving=function(e){M.enableNonResumableFrames=e},this.fitToView=function(e,t){(t=!!t,0===e.length)&&(e=M.getModels().map((function(e){return{model:e,selection:[]}})));if(0===e.length)return!1;for(var i=0,n=0;n<e.length;++n){var r=e[n].model;if(!r)return!1;r.is2d()&&i++}return!!(i===e.length?this._fitToView2d(e,t):this._fitToView3d(e,t))&&(1===M.getModels().length&&this.api.dispatchEvent({type:wr,nodeIdArray:e[0].selection,immediate:t,model:e[0].model}),this.api.dispatchEvent({type:Cr,selection:e,immediate:t}),!0)},this._fitToView2d=function(e,t){e.length>1&&rt.warn("fitToView() doesn't support multiple 2D models. Using the first one...");var i=e[0].model,n=e[0].selection,r=new(v().Box3),o=new iw(r);if(n&&0!==n.length)this.computeSelectionBounds(n,i,o);else if(this.api.anyLayerHidden())for(var s=i.getData().fragments,a=this.getVisibleLayerIndices(),l=0;l<s.length;l++)We(i,l,a,o);else r=this.getFitBounds(!0);return!r.isEmpty()&&(this.api.navigation.fitBounds(t,r),!0)},this.computeSelectionBounds=function(e,t,i){var n;i||(i=new iw(new(v().Box3)));var r=null===(n=t.getData().fragments)||void 0===n?void 0:n.dbId2fragId;if(r){for(var o=0;o<e.length;o++){var s=t.reverseMapDbIdFor2D(e[o]),a=r[s];if(Array.isArray(a))for(var l=0;l<a.length;l++)je(t,a[l],s,i);else"number"==typeof a&&je(t,a,s,i)}i.bounds.applyMatrix4(t.getPlacementTransform())}else i.bounds.copy(t.getBoundingBox());return i.bounds},this.get3DBounds=function(e){for(var t=!1,i=0;i<e.length;++i)if(e[i].selection.length>0){t=!0;break}var n=new(v().Box3),r=new(v().Box3);if(t)for(var o=0;o<e.length;++o){var s=e[o].selection;if(0!==s.length){var a=e[o].model,l=a.getInstanceTree(),c=a.getFragmentList();if(l)for(var u=0;u<s.length;++u){var h=parseInt(s[u]);l.enumNodeFragments(h,(function(e){c.getWorldBounds(e,r),n.union(r)}),!0)}}}else n.union(this.getVisibleBounds(!1,!1));return n},this.onModelTransformChanged=function(e){if(this.sceneUpdated(),e.isConsolidated())for(var t in i.selectionMeshes){var n=i.selectionMeshes[t];n.model===e&&(n.needsUpdate=!0)}this.invalidate(!0,!0,!0),this.api.fireEvent({type:er,model:e,matrix:e.getModelTransform()})},this.setPlacementTransform=function(e,t){e.setPlacementTransform(t),this.api.fireEvent({type:tr,model:e,matrix:e.getPlacementTransform()}),this.onModelTransformChanged(e)},this._fitToView3d=function(e,t){const i=this.get3DBounds(e);return!i.isEmpty()&&(this.api.navigation.fitBounds(t,i),!0)},this.onWebGLcontextLost=function(){x.enableContextRestore&&(this._reconsolidateOnRestore=pA(this.api)),this.stop(),this.api.fireEvent({type:zr})},this.onWebGLcontextRestored=async function(){await mA(this.api,this._reconsolidateOnRestore),this._reconsolidateOnRestore=null,_.clearAllOverlays(),C.setDirty(),T&&T.setDirty(),this.invalidate(!0,!0,!0),this.run(),this.api.fireEvent({type:Hr})},this.modelVisible=function(e){return!!M.findModel(e)},this.handleInitialVisibility=function(e){rt.info("Hiding objects that are marked as 'hidden'. This can take up to minutes depending on model size ...");var t=this;e.visibilityManager&&e.getObjectTree((i=>setTimeout((()=>function(i){var n=e.getFragmentList();if(!n||n.areAllVisible())return;var r=[];if(!i)return;i.enumNodeChildren(e.getRootId(),(function(e){i.enumNodeFragments(e,(function(e){return n.isFragVisible(e)}),!0)||i.isNodeHidden(e)||i.isNodeOff(e)||r.push(e)}),!0),rt.info("Hiding "+r.length+" objects ...");let o=0;if(r.length>0){const i=r.length-1;for(let n=0;n<r.length;++n)t.visibilityManager.setVisibilityOnNode(r[n],!1,e,n!==i,!1),o=Math.round(n/r.length*100),o>0&&o%10==0&&rt.info(o+"%")}rt.info("Done hiding objects.")}(i)))))},this.changePaperVisibility=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(e.is3d())return void(null==n||n());const o=e.getFragmentList();if(!o)return void(null==n||n());if(e.paperVisibilityAnim&&(e.paperVisibilityAnim.stop(),e.paperVisibilityAnim=null),!i||!r)return e.changePaperVisibility(t),this.invalidate(!0),void(null==n||n());const s=void 0!==o.dbIdOpacity[-1]?o.dbIdOpacity[-1]:t?0:1,a=t?1:0,l=r;e.paperVisibilityAnim=Autodesk.Viewing.Private.fadeValue(s,a,l,(e=>{e=Autodesk.Viewing.Private.smootherStep(e),o.setObject2DOpacity(-1,e),this.invalidate(!0)}),(()=>{e.paperVisibilityAnim=null,null==n||n()}))},this._signalNoMeshes=function(){M.isEmpty()&&(this._geometryAvailable=0)},this.signalNewGeometryAdded=function(e,t){0===this._geometryAvailable&&(this._geometryAvailable=1,this.api.fireEvent({type:qr})),this.api.fireEvent({type:Kr,geomId:e,model:t})},this._signalNewMaterialAdded=function(e,t){this.api.fireEvent({type:Xr,material:e,model:t})},this.hasModels=function(){return!M.isEmpty()},this.onLoadingAnimationChanged=function(e){ue||(x.setLoadingAnimationDuration(e?this.defaultLoadingAnimationDuration:-1),this.invalidate(!1,!0,!1))},this.isLoadingAnimationEnabled=function(){return this.api.prefs.get(In.LOADING_ANIMATION)&&(!this.model||this.model.is2d())},this.setMaxModelDistance=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e5;this.maxModelDistance=e},this._applyMaxModelDistanceToNearFar=function(){var e=this.camera;if(e.far<=e.near+this.maxModelDistance)return null;const t=e.near+this.maxModelDistance;const i=this.getVisibleBounds(!0,O,(function(i){return Kp.pointToBoxDistance2(e.position,i)<t*t}));this.updateNearFarValues(e,i)},this.consolidateModel=function(e,t){if(!Gg(e))return e.consolidateAsync(b,t,x,this.useDeferredConsolidation);console.warn("Model consolidation shouldn't be triggered explicitly when using dynamic GPU memory management.")},this._consolidateModelInternal=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.consolidateAsync(b,void 0,x,this.useDeferredConsolidation,t)},this.setDoNotCut=function(e,t){e.setDoNotCut(b,t)},this.setViewportBounds=function(e,t){e.setViewportBounds(b,t),this.invalidate(!0),this.api.fireEvent({type:ir,model:e,bounds:t})},this.isWebGPU=function(){return ue},this.setFrameTimePriority=function(e){he=e,Ji&&NS.updateViewerPriority(this,e)},this.getFrameTimePriority=function(){return he}}Dw.prototype.constructor=Dw,fo.call(Dw.prototype);const Ow=416,Bw=1e3;class Nw{constructor(e){this.viewer=e,this.setGlobalManager(this.viewer.globalManager),this.domElement=null,this._step=this._step.bind(this),this._maskId="mask"+Date.now()}createDom(e){const t=this.getDocument();this.domElement=t.createElement("div"),this.domElement.className="forge-spinner",this._initTransform="translate(-50%, -50%) scale(0.5)",this.domElement.style.transform=this._initTransform.slice();var i=this._createSvgElement("svg");i.setAttribute("width","242"),i.setAttribute("height","242"),i.setAttribute("viewBox","0 0 72 72"),i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.domElement.appendChild(i);var n=this._createWheelPointData(10,72,6.75);this._createMask(n);var r=this._createSvgElement("polygon");r.setAttribute("mask",`url(#${this._maskId})`),i.appendChild(r),this._addPoints(n.outerPoints,r),this._createSegments(n);var o=t.createElement("img");return o.src=Autodesk.Viewing.Private.getResourceUrl("res/ui/powered-by-autodesk-blk-rgb.png"),this._onResize=this._onResize.bind(this),o.onload=()=>{this._onResize(),this._initResize=!0,this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this._onResize)},this.domElement.appendChild(o),e&&e.appendChild(this.domElement),this.domElement.style.display="none",this.domElement}_createSvgElement(e){return this.getDocument().createElementNS("http://www.w3.org/2000/svg",e)}_getSvg(){return null==this?void 0:this.domElement.getElementsByTagNameNS("http://www.w3.org/2000/svg","svg")[0]}_createMask(e){const t=this._getSvg(),i=this._createSvgElement("defs"),n=this._createSvgElement("mask");n.id=this._maskId,i.appendChild(n),t.appendChild(i);const r=this._createSvgElement("polygon");r.style.opacity=.15,r.style.fill="#FFF",n.appendChild(r),this._addPoints(e.outerPoints,r);const o=this._createSvgElement("polygon");n.appendChild(o),this._addPoints(e.innerPoints,o)}_step(e){this.startTime||(this.startTime=e);const t=(e-this.startTime)%Bw;this._setSegmentOpacities(t);const i=this.getWindow();this._animId=i.requestAnimationFrame(this._step)}_stop(){if(this._animId){this.getWindow().cancelAnimationFrame(this._animId),this._animId=null}}_setSegmentOpacities(e){this.segments.forEach(((t,i)=>{const n=Math.abs(i-this.segments.length)-1;t.style.opacity=this._getSegmentOpacity(n,e)}))}_getSegmentOpacity(e,t){const i=e*(Bw/this.segments.length);return i+Ow>Bw&&t<Ow?-1*((t+Bw-i)/Ow-1):t<i||t>i+Ow?0:Math.abs((t-i)/Ow-1)}_getSegments(){return Array.from(this.domElement.querySelectorAll(".segment"))}_addPoints(e,t){for(let i of e){const e=this._getSvg().createSVGPoint();e.x=i[0],e.y=i[1],t.points.appendItem(e)}}_createWheelPointData(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;const n=t/2,r=t/2,o=t/2,s={outerPoints:[],innerPoints:[]};for(let t=1;t<=e;t++)s.outerPoints.push([r+n*Math.cos(2*t*Math.PI/e),o+n*Math.sin(2*t*Math.PI/e)]),s.innerPoints.push([r+(n-i)*Math.cos(2*t*Math.PI/e),o+(n-i)*Math.sin(2*t*Math.PI/e)]);return s}_createSegments(e){const{outerPoints:t,innerPoints:i}=e,n=this._getSvg(),r=(e,t)=>{var i=this._createSvgElement("polygon");i.classList.add("segment"),i.classList.add(t),this._addPoints(e,i),n.appendChild(i)};for(let e=t.length-1;e>=0;--e){let n=t[e],o=t[e-1],s=i[e],a=i[e-1];0===e&&(o=t[t.length-1],a=i[t.length-1]),r([n,o,s],"light-blue"),r([s,a,o],"dark-blue")}}_fadeOut(){let e=1;const t=setInterval((()=>{var i;null!==(i=this.domElement)&&void 0!==i&&i.style?(e<=.1&&(clearInterval(t),this.domElement.style.display="none"),this.domElement.style.opacity=e,e-=.1*e):clearInterval(t)}),1)}show(){this.domElement&&(this.domElement.style.display="block",this.domElement.style.opacity=1,this.segments=this._getSegments(),this._step(1))}hide(){if(this.domElement){this._hide=e=>{this._stop(),e.model.is3d()?this._fadeOut():(this.domElement.style.opacity=0,this.domElement.style.display="none")};var e=this.viewer.impl.modelQueue().getModels();0===e.length?this.viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this._hide,{once:!0}):this._hide({model:e[0]})}}destroy(){var e;this._stop(),null!==(e=this.domElement)&&void 0!==e&&e.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this.domElement=null,this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this._onResize)}_onResize(){var e;if(this._initResize)return void(this._initResize=!1);const t=this.domElement;if(!t)return;if("none"==t.style.display)return;const i=t.parentElement;if(!i)return;const n=i.getBoundingClientRect(),r=t.getBoundingClientRect(),o=Math.max(r.width/n.width,(r.height+350)/n.height),s=null===(e=this.domElement)||void 0===e||null===(e=e.style)||void 0===e?void 0:e.transform;if(s)if(o>.8){const e=/[-+]?scale\(\d*\.\d+|\d+\)/,t=e.exec(s);if(t.length>0){const i=t[0].split("scale(")[1],n=Number((i/o).toFixed(4)),r=s.replace(e,`scale(${n}`);r!=this.domElement.style.transform&&n<=.5&&n>.2&&(this.domElement.style.transform=r)}}else this.domElement.style.transform!=this._initTransform&&(this.domElement.style.transform=this._initTransform)}}fo.call(Nw.prototype);class Uw{constructor(){this.domElement=null}createDom(e){var t=this.getDocument(),i=t.createElement("div");i.className="spinner",e&&e.appendChild(i);for(var n=1;n<=3;n++){var r=t.createElement("div");r.className="bounce"+n,i.appendChild(r)}return this.domElement=i,this.hide(),i}show(){this.domElement&&(this.domElement.style.display="block")}hide(){this.domElement&&(this.domElement.style.display="None")}destroy(){this.domElement=null}}fo.call(Uw.prototype);const kw=Object.freeze({pdf:"Autodesk.PDF",scalaris:"Autodesk.Scalaris",dwf:"Autodesk.DWF",dwfx:"Autodesk.DWF",rcp:"Autodesk.ReCap",gltf:"Autodesk.glTF",glb:"Autodesk.glTF"});class Fw{constructor(e){this.impl=e}dtor(){this.impl=null}addScene(e){return!!e&&(Object.prototype.hasOwnProperty.call(this.impl.overlayScenes,e)||this.impl.createOverlayScene(e),!0)}removeScene(e){return!!e&&(this.impl.removeOverlayScene(e),!0)}clearScene(e){this.impl.clearOverlay(e)}hasScene(e){return!!e&&Object.prototype.hasOwnProperty.call(this.impl.overlayScenes,e)}setSceneHiddenFromMainRender(e,t){this.impl.overlayScenes[e].hiddenFromMainRender=t}addMesh(e,t){return!!(e&&t&&Object.prototype.hasOwnProperty.call(this.impl.overlayScenes,t))&&(e=Array.isArray(e)?e:[e],this.impl.addMultipleOverlays(t,e),!0)}removeMesh(e,t){return!!(e&&t&&Object.prototype.hasOwnProperty.call(this.impl.overlayScenes,t))&&(e=Array.isArray(e)?e:[e],this.impl.removeMultipleOverlays(t,e),!0)}hasMesh(e,t){var i=this.impl.overlayScenes[t];if(!i)return!1;var n=i.scene.children;for(let t=0,i=n.length;t<i;++t)if(n[t]===e)return!0;return!1}}class Vw extends Ds{constructor(e,t){super(t),this.viewer=e,this.setGlobalManager(e.globalManager),e.addEventListener(Dr,(e=>{var t=this.callbacks[e.name];t&&t.forEach((t=>{var i=t.changed;i&&"function"==typeof i&&i(e.value)}))})),e.addEventListener(Or,(e=>{var t=this.callbacks[e.name];t&&t.forEach((t=>{var i=t.reset;i&&"function"==typeof i&&i(e.value)}))}));const i={[Mn.VIEW_CUBE]:function(t){e.getExtension("Autodesk.ViewCubeUi",(function(e){e.displayViewCube(t)}))},[Mn.ALWAYS_USE_PIVOT]:e.setUsePivotAlways.bind(e),[Mn.ORBIT_PAST_WORLD_POLES]:e.setOrbitPastWorldPoles.bind(e),[Mn.ZOOM_TOWARDS_PIVOT]:e.setZoomTowardsPivot.bind(e),[Pn.REVERSE_MOUSE_ZOOM_DIR]:e.setReverseZoomDirection.bind(e),[Pn.LEFT_HANDED_MOUSE_SETUP]:e.setUseLeftHandedInput.bind(e),[Mn.CLICK_TO_SET_COI]:e.setClickToSetCOI.bind(e),[Pn.ZOOM_DRAG_SPEED]:function(t){var i;const n=e.toolController.getTool("dolly");null==n||null===(i=n.setDollyDragScale)||void 0===i||i.call(n,t)},[Pn.ZOOM_SCROLL_SPEED]:t=>{var i;const n=e.toolController.getTool("dolly");null==n||null===(i=n.setDollyScrollScale)||void 0===i||i.call(n,t)},[Mn.ANTIALIASING]:t=>e.setQualityLevel(this.get("ambientShadows"),t),[Mn.AMBIENT_SHADOWS]:t=>e.setQualityLevel(t,e.prefs.get("antialiasing")),[Mn.GROUND_SHADOW]:e.setGroundShadow.bind(e),[Mn.GROUND_REFLECTION]:e.setGroundReflection.bind(e),[In.SWAP_BLACK_AND_WHITE]:e.setSwapBlackAndWhite.bind(e),[Mn.OPTIMIZE_NAVIGATION]:e.setOptimizeNavigation.bind(e),[Pn.PROGRESSIVE_RENDERING]:e.setProgressiveRendering.bind(e),[Pn.GHOSTING]:e.setGhosting.bind(e),[Mn.LINE_RENDERING]:t=>e.hideLines(!t),[Pn.POINT_RENDERING]:t=>e.hidePoints(!t),[Mn.EDGE_RENDERING]:e.setDisplayEdges.bind(e),[Mn.ENV_MAP_BACKGROUND]:e.setEnvMapBackground.bind(e),[Mn.LIGHT_PRESET]:e.setLightPreset.bind(e)};Object.keys(i).forEach((e=>{this.addListeners(e,i[e])}))}dispatchEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dr;const i=this.get(e);this.viewer.dispatchEvent({type:t,name:e,value:i})}}const Gw=Autodesk.Viewing;var zw=0;const Hw=["markups-svg","pushpin-container"];function Ww(e,t){if(this.setGlobalManager(new ao),Bs._initialize(),e){if(this.clientContainer=e,this.container=this.getDocument().createElement("div"),this.container.classList.add("adsk-viewing-viewer"),this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add(O()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=t||{},this.contextMenu=null,this.contextMenuCallbacks={},this.started=!1,this.theme=this.config.theme||"dark-theme",this.container.classList.add(this.theme),this.containerLayerOrder=this.config.containerLayerOrder||Hw,H()&&this.container.classList.add("quality-text"),"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";if(this.canvasWrap=this.getDocument().createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=this.getDocument().createElement("canvas"),this.canvas.tabIndex=0,this.canvas.setAttribute("data-viewer-canvas","true"),this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),!V()&&!Gw.Private.DISABLE_FORGE_LOGO&&!Gw.Private.DISABLE_FORGE_CANVAS_LOGO){const e=this.getDocument();this._forgeLogo=e.createElement("div"),this._forgeLogo.classList.add("forge-logo-canvas");const t=e.createElement("img");t.src=Autodesk.Viewing.Private.getResourceUrl("res/ui/powered-by-autodesk-oneline-blk-rgb.png"),this._forgeLogo.appendChild(t),this._forgeLogo.style.display="none",this.container.appendChild(this._forgeLogo)}this.canvas.viewer=this}var i=t&&t.localStoragePrefix||"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.";i.endsWith(".")||(i+=".");var n={prefix:i,localStorage:!S()};this._displayEdges=null,this._setDoubleSided=null,this.prefs=new Vw(this,n),this.profile=null,this.profileManager=new ky,this._hotkeyManager=new Vy,this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=zw++,this.impl=new Dw(this.canvas,this),this.overlays=new Fw(this.impl),this._loadingSpinner=Gw.Private.DISABLE_FORGE_LOGO?new Uw:new Nw(this),this._loadingSpinner.setGlobalManager(this.globalManager),this.trackADPTimer=[],this._curAvDocument=null,this._curManifest=null,this._curOptions=null,this._isPdfModelWithVectorAndRasterRepr=!1}function jw(e,t){return new Promise(((i,n)=>{var r=0;function o(t){2===r&&i({viewer:e,model:t})}e.addEventListener(Wn,(function i(s){s.model.getData().loadOptions.bubbleNode===e._curOptions.bubbleNode&&(e.removeEventListener(Wn,i),r++,t.skipPropertyDb?o(s.model):s.model.getProperties(1,(()=>o(s.model)),(e=>n(e))))})),e.addEventListener(jn,(function t(i){i.model.getData().loadOptions.bubbleNode===e._curOptions.bubbleNode&&(e.removeEventListener(jn,t),r++,o(i.model))}))}))}function qw(e){return e&&e.byteLength||0}function Kw(e){return qw(e.boxes)+qw(e.transforms)+qw(e.fragId2dbId)+qw(e.geomDataIndexes)+qw(e.materials)}function Xw(e){return qw(e.geomids)+qw(e.materialids)+qw(e.vizflags)+(e.boxes!==e.fragments.boxes?qw(e.boxes):0)+(e.transforms!==e.fragments.transforms?qw(e.transforms):0)}function Yw(e){return qw(e.nodes.nodesRaw?e.nodes.nodesRaw:e.nodes)+qw(e.primitives)}Ba.prototype.apply(Ww.prototype),nl.prototype.apply(Ww.prototype),Ha.prototype.apply(Ww.prototype),fo.call(Ww.prototype),Ww.prototype.constructor=Ww,Object.defineProperty(Ww.prototype,"model",{get:function(){var e;return null===(e=this.impl)||void 0===e?void 0:e.model},set:function(){throw"Do not set viewer.model"}}),Ww.ViewerCount=0,Ww.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"]},clickShift:{onObject:["selectToggle"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},Object.defineProperty(Ww.prototype,"scene",{get:function(){return this.impl.scene},set:function(){throw"Do not set viewer.scene"}}),Object.defineProperty(Ww.prototype,"sceneAfter",{get:function(){return this.impl.sceneAfter},set:function(){throw"Do not set viewer.sceneAfter"}}),Ww.createHeadlessViewer=function(){var e=new Ww;return e.impl.initialize(),e.impl.setLightPreset(0),e},Ww._getDefaultBVHOptions=function(e){let t;return rn?t={consolidation:{frags_per_leaf_node:65535,frags_per_inner_node:65535,frags_per_leaf_node_transparent:512,frags_per_inner_node_transparent:0,max_polys_per_node:fn||sn?75e4:3e6,max_size_ratio:6,sortFuncType:Gw.Private.BVHSortFuncType.DIAMETER,per_tile_consolidation:!0,max_drawcalls_per_node:fn||sn?100:30,consolidation_polycount_limit:1e4,want_sort:!0},isWeakDevice:F()}:e.useConsolidation&&(t={},bv.applyBVHDefaults(t)),t},Ww.prototype.start=function(e,t,i,n,r){if(this.started)return 0;this.started=!0;var o=this,s=o.initialize(r);return 0!==s?(n&&setTimeout((function(){n(s)}),0),s):(setTimeout((function(){o.setUp(o.config)}),0),e&&this.loadModel(e,t,i,n),0)},Ww.prototype.startWithDocumentNode=function(e,t,i){var n=this;return new Promise((function(r,o){if(n.started)return 0;n.started=!0;var s=n.initialize();0===s?(setTimeout((function(){n.setUp(n.config)}),0),n.loadDocumentNode(e,t,i).then(r).catch(o)):setTimeout((function(){o(s)}),0)}))},Ww.prototype.registerUniversalHotkeys=function(){var e,t,i,n=this;e=function(){return n.navigation.setRequestFitToView(!0),Qe.track("viewer.fit_to_view",{from:"Keyboard"}),!0},n._hotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[Hy.f],onPress:e}]),e=function(){return n.navigation.setRequestHomeView(!0),!0},n._hotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[Hy.h],onPress:e},{keycodes:[Hy.HOME],onPress:e}]),t=function(){return n.objectContextMenu&&n.objectContextMenu.hide()||n.dispatchEvent({type:Rn}),!0},n._hotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[Hy.ESCAPE],onRelease:t}]),e=function(){return i=n.getActiveNavigationTool(),n.setActiveNavigationTool("pan")},t=function(){return n.setActiveNavigationTool(i)};var r=[{keycodes:[Hy.SHIFT],onPress:e,onRelease:t},{keycodes:[Hy.SPACE],onPress:e,onRelease:t}];n._hotkeyManager.pushHotkeys("Autodesk.Pan",r,{tryUntilSuccess:!0})},Ww.prototype.createControls=function(){var e=this,t=e.impl;return e.navigation=new zy(t.camera),e.__initAutoCam(t),e.utilities=new jy(t,e.autocam,e.navigation),e.clickHandler=new qy(t,e.navigation,e.utilities),e.toolController=new Wy(t,e,e.autocam,e.utilities,e.clickHandler),e.toolController.registerTool(new Xy(e)),e.toolController.registerTool(e._hotkeyManager),e.toolController.activateTool(e._hotkeyManager.getName()),e.registerUniversalHotkeys(),e.toolController.registerTool(new Zy(t,e,this.config.navToolsConfig),(e=>{e||this.setActiveNavigationTool()})),e.toolController.setModalityMap({section:{explode:!1,pan:!1,dolly:!1},explode:{section:!1,pan:!1,dolly:!1},measure:{"box-selection":!1},calibration:{"box-selection":!1},orbit:{},dolly:{},pan:{},fov:{},bimwalk:{},"box-selection":{measure:!1,calibration:!1}}),e.toolController},Ww.prototype.initialize=function(e){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);var t=this.getDimensions();if(this.canvas.width=t.width,this.canvas.height=t.height,N()&&this.getWindow().devicePixelRatio&&(this.canvas.width/=this.getWindow().devicePixelRatio,this.canvas.height/=this.getWindow().devicePixelRatio),this.impl.initialize(e),!this.impl.glrenderer()){var i=function(){if(Gw.getGlobal().WebGLRenderingContext){for(var e=Gw.getGlobal().document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=!1,n=0;n<4;n++)try{if((i=e.getContext(t[n]))&&"function"==typeof i.getParameter)return 1}catch(e){}return 0}return-1}();if(i<=0)return-1===i?st.BROWSER_WEBGL_NOT_SUPPORTED:st.BROWSER_WEBGL_DISABLED}var n,r=this;N()?this.onResizeCallback=function(){clearTimeout(n),n=setTimeout(r.resize.bind(r),500)}:this.onResizeCallback=function(){var e=r.impl.camera.clientWidth,t=r.impl.camera.clientHeight,i=r.container.clientWidth,n=r.container.clientHeight;e===i&&t===n||r.resize()};this.addWindowEventListener("resize",this.onResizeCallback),this.onPixelRatioChanged=()=>{var e;if(null===(e=r.impl)||void 0===e||!e.glrenderer())return;const t=r.getWindow().devicePixelRatio;matchMedia(`(resolution: ${t}dppx)`).addEventListener("change",r.onPixelRatioChanged,{once:!0}),r.impl.glrenderer().setPixelRatio(t),r.resize()},this.onPixelRatioChanged(),this.onScrollCallback=function(){r.impl.canvasBoundingclientRectDirty=!0},this.addWindowEventListener("scroll",this.onScrollCallback),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.initializePrefListeners(),this.setDefaultNavigationTool("orbit"),this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var o=this.config&&this.config.canvasConfig?this.config.canvasConfig:Ww.kDefaultCanvasConfig;this.setCanvasClickBehavior(o),o.disableSpinner||(this.loadSpinner=this._loadingSpinner.createDom(this.container)),this.viewerState=new Yy(this),this.config&&Object.prototype.hasOwnProperty.call(this.config,"startOnInitialize")&&!this.config.startOnInitialize||this.run();const s=Gw.getGlobal();return s.NOP_VIEWER||(s.NOP_VIEWER=this),s.NOP_VIEWERS=s.NOP_VIEWERS||[],s.NOP_VIEWERS.push(this),this.addEventListener(Zn,(function(e){r.onModelAdded(e.model,e.preserveTools)})),this.addEventListener(Wn,(function(e){var t;e.model.is2d()&&!e.model.isLeaflet()&&r.navigation.setMinimumLineWidth(null===(t=e.model.loader)||void 0===t||null===(t=t.svf)||void 0===t?void 0:t.minLineWidth);const i=e.model.getGeometryList();e.model.hasEdges=!1;for(let t=0;t<(null==i?void 0:i.getCount());t++){const n=i.getGeometry(t);if(n&&(n.isLine||n.iblines)){e.model.hasEdges=!0;break}}})),this.addEventListener(to,(async function(e){(e.model.isConsolidated()||e.model.isConsolidating())&&(e.model.unconsolidate(!0,!0),await this.impl._consolidateModelInternal(e.model)),this.impl.invalidate(!0,!0)})),this.addEventListener(io,(async function(e){e.model.isConsolidated()||e.model.isConsolidating()?(e.model.unconsolidate(!0,!0),await this.impl._consolidateModelInternal(e.model)):e.model.chooseMemoryTypes(),this.impl.invalidate(!0,!0)})),this.dispatchEvent(kn),this.trackADPSettingsOptions(),this.trackADPExtensionsLoaded(),Ww.ViewerCount++,0},Ww.prototype.setUp=function(e){var t;if(!this.impl)return;if(this.config=e||{},this.config.extensions=this.config.extensions||[],Array.isArray(this.config.extensions))for(var i=this.config.extensions,n=0;n<i.length;++n)this.loadExtension(i[n],this.config);"fedramp"===(null===(t=this.config.region)||void 0===t?void 0:t.toLowerCase())||this.loadExtension("Autodesk.Viewing.MixpanelExtension"),"true"===fe("lmv_viewer_debug")&&this.loadExtension("Autodesk.Debug",this.config);var r=this.config.canvasConfig||Ww.kDefaultCanvasConfig;this.setCanvasClickBehavior(r),this._onAggregatedSelectionChanged=this._onAggregatedSelectionChanged.bind(this),this.addEventListener(pr,this._onAggregatedSelectionChanged)},Ww.prototype.tearDown=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.clearSelection(),this.removeEventListener(pr,this._onAggregatedSelectionChanged),this.loadedExtensions){for(var t in this.loadedExtensions)try{this.unloadExtension(t)}catch(e){rt.error("Failed to unload extension: "+t,e,at(st.VIEWER_INTERNAL_ERROR)),rt.track({category:"error_unload_extension",extensionId:t,error_message:e.message,call_stack:e.stack})}this.loadedExtensions=null}for(this.toolController&&(this.toolController.enableMouseButtons(!1),this.toolController.deactivateTool("gestures")),rt.reportRuntimeStats(!0),this._loadingSpinner.show(),this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null);this.trackADPTimer.length>0;)clearTimeout(this.trackADPTimer.pop());e&&this.impl.unloadCurrentModel(),this.impl.setCutPlaneSet("__set_view",void 0)},Ww.prototype._onAggregatedSelectionChanged=function(){if(this.navigation.getSelectionSetsPivot()){const e=this.impl.selector.getAggregateSelection();if(e.length){const t=this.impl.get3DBounds(e);this.utilities.setPivotPoint(t.getCenter(new(v().Vector3)),!0,!0),this.utilities.pivotActive(this.navigation.getPivotSetFlag(),!0)}}},Ww.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},Ww.prototype.localize=function(){hs.localize()},Ww.prototype.__initAutoCam=function(e){var t=this,i=e.camera;i.pivot||(i.pivot=new(v().Vector3)(0,0,0)),i.target||(i.target=new(v().Vector3)(0,0,0)),i.worldup||(i.worldup=i.up.clone()),t.autocamCamera=i.clone(),t.autocamCamera.target=i.target.clone(),t.autocamCamera.pivot=i.pivot.clone(),t.autocamCamera.worldup=i.worldup.clone(),t.autocam=new tb(t.autocamCamera,t.navigation,t.canvas),t.autocam.setGlobalManager(this.globalManager),t.autocam.registerCallbackCameraChanged((function(e){t.autocamCamera.isPerspective!==i.isPerspective&&(t.autocamCamera.isPerspective?t.navigation.toPerspective():t.navigation.toOrthographic()),t.navigation.setVerticalFov(t.autocamCamera.fov,!1),t.navigation.setView(t.autocamCamera.position,t.autocamCamera.target),t.navigation.setPivotPoint(t.autocamCamera.pivot),t.navigation.setCameraUpVector(t.autocamCamera.up),e&&t.navigation.setWorldUpVector(t.autocamCamera.worldup),t.impl.syncCamera(e)})),t.autocam.registerCallbackPivotDisplay((function(e){t.utilities?t.utilities.pivotActive(e,!1):t.impl.controls.pivotActive(e,!1)})),t.autocam.registerCallbackTransitionCompleted((function(){t.fireEvent({type:Ur})})),t.addEventListener("cameraChanged",(function(e){var i=e.camera;t.autocam.sync(i)})),t.autocam.sync(i)},Ww.prototype.uninitialize=function(){var e;this.removeWindowEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,this.removeWindowEventListener("scroll",this.onScrollCallback),this.onScrollCallback=null,this.canvas?this.canvas.removeEventListener("mousedown",this.onMouseDown):this.container&&this.container.removeEventListener("mousedown",this.onMouseDown),this.onMouseDown=null,this.canvas?this.canvas.removeEventListener("mouseup",this.onMouseUp):this.container&&this.container.removeEventListener("mouseup",this.onMouseUp),this.onMouseUp=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,Lw.canvas===this.canvas&&(Lw.canvas=null),this.canvas=null,this.canvasWrap=null,this.viewerState=null,rt.reportRuntimeStats(),rt.track({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.overlays&&(this.overlays.dtor(),this.overlays=null),this.loadSpinner=null,this._loadingSpinner.destroy(),this._loadingSpinner=null,this.prefs&&this.prefs.clearListeners(),this.prefs=null,this.profile=null,this.profileManager=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,this._hotkeyManager.popHotkeys("Autodesk.FitToView"),this._hotkeyManager.popHotkeys("Autodesk.Home"),this._hotkeyManager.popHotkeys("Autodesk.Escape"),this._hotkeyManager.popHotkeys("Autodesk.Pan"),this._hotkeyManager.popHotkeys("Autodesk.Orbit"),this._hotkeyManager=null,Ww.ViewerCount--,0===Ww.ViewerCount&&ip(),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this._displayEdges&&(this.removeEventListener(Wn,this._displayEdges),this._displayEdges=null),this._setDoubleSided&&(this.removeEventListener(Zn,this._setDoubleSided),this._setDoubleSided=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.contextMenu=null,this.contextMenuCallbacks=null,this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this._forgeLogo=null,this.dispatchEvent(Fn),this.listeners={};const t=Gw.getGlobal();t.NOP_VIEWER===this&&(t.NOP_VIEWER=null);const i=null===(e=t.NOP_VIEWERS)||void 0===e?void 0:e.indexOf(this);-1!==i&&(t.NOP_VIEWERS.splice(i,1),0===t.NOP_VIEWERS.length&&(t.NOP_VIEWERS=null)),rt.log("viewer destroy")},Ww.prototype.finish=function(){this.tearDown(),this.uninitialize()},Ww.prototype.setLoadHeuristics=function(e){var t=e.bubbleNode;if(t){var i=t.findViewableParent();if(i){var n=i.name();e.fileExt=n.slice(n.length-3).toLowerCase();void 0===e.isAEC&&-1!==["rvt","nwd","nwc","ifc"].indexOf(e.fileExt)&&(e.isAEC=!0)}}if(e.isAEC){if(void 0===e.useConsolidation){let t=fe("useConsolidation")||"";e.useConsolidation="true"===t||"false"!==t&&void 0}void 0===e.useConsolidation&&(e.useConsolidation=!F()&&!S()),void 0===e.createWireframe&&(e.createWireframe=!F()),void 0===e.disablePrecomputedNodeBoxes&&(e.disablePrecomputedNodeBoxes=!0)}else void 0===e.createWireframe&&(e.createWireframe=!F()&&this.prefs.get("edgeRendering"));e.bvhOptions||(e.bvhOptions=Ww._getDefaultBVHOptions(e))},Ww.prototype.trackADPSettingsOptions=function(){var e=this;this.trackADPTimer.push(setTimeout((function(){if(e.prefs){var t={category:"settingOptionsStatus",switchSheetColorWhiteToBlack:e.prefs.get("swapBlackAndWhite"),leftHandedMouseSetup:e.prefs.get("leftHandedMouseSetup"),openPropertiesOnSelect:e.prefs.get("openPropertiesOnSelect"),orbitPastWorldPoles:e.prefs.get("orbitPastWorldPoles"),reverseMouseZoomDirection:e.prefs.get("reverseMouseZoomDir"),fusionStyleOrbit:e.prefs.get("fusionOrbit"),setPivotWithLeftMouseButton:e.prefs.get("clickToSetCOI"),zoomTowardPivot:e.prefs.get("zoomTowardsPivot"),viewCubeActsOnPivot:e.prefs.get("alwaysUsePivot"),showViewCube:e.prefs.get("viewCube"),environmentImageVisible:e.prefs.get("envMapBackground"),displayEdges:e.prefs.get("edgeRendering"),displayPoints:e.prefs.get("pointRendering"),displayLines:e.prefs.get("lineRendering"),ghostHiddenObjects:e.prefs.get("ghosting"),groundReflection:e.prefs.get("groundReflection"),groundShadow:e.prefs.get("groundShadow"),ambientShadows:e.prefs.get("ambientShadows"),antiAliasing:e.prefs.get("antialiasing"),progressiveModelDisplay:e.prefs.get("progressiveRendering"),smoothNavigation:e.prefs.get("optimizeNavigation")};rt.track(t)}}),3e4))},Ww.prototype.trackADPExtensionsLoaded=function(){var e=this,t={category:"loaded_extensions"};this.trackADPTimer.push(setTimeout((function(){if(e.loadedExtensions)for(var i in e.loadedExtensions)t[i]=i;rt.track(t)}),3e4))},Ww.prototype.activateDefaultNavigationTools=function(e){if(!S()){var t=e?"pan":"orbit";this.setDefaultNavigationTool(t),this.setActiveNavigationTool(t),this.toolController&&(this.toolController.enableMouseButtons(!0),this.toolController.activateTool("gestures"))}},Ww.prototype.registerDimensionSpecificHotkeys=function(e){if(this._hotkeyManager)if(e)this._hotkeyManager.popHotkeys("Autodesk.Orbit");else{var t,i=this,n=[{keycodes:[Hy.ALT],onPress:function(){return t=i.getActiveNavigationTool(),i.setActiveNavigationTool("orbit")},onRelease:function(){return i.setActiveNavigationTool(t)}}];this._hotkeyManager.pushHotkeys("Autodesk.Orbit",n,{tryUntilSuccess:!0})}},Ww.prototype.onModelAdded=function(e,t){var i;e.is2d()&&!e.isLeaflet()&&this.navigation.setMinimumLineWidth(null===(i=e.loader)||void 0===i||null===(i=i.svf)||void 0===i?void 0:i.minLineWidth);1===this.impl.modelQueue().getModels().length&&this.initializeFirstModelPresets(e,t)},Ww.prototype.initializeFirstModelPresets=function(e,t,i){if(e.is2d()&&this.activateLayerState("Initial"),i||e.getData().loadOptions.preserveView||(this.setActiveNavigationTool(),this.impl.setViewFromFile(e,!0),this.toolController.recordHomeView()),this.registerDimensionSpecificHotkeys(e.is2d()),t||this.activateDefaultNavigationTools(e.is2d()),this.navigation.setIs2D(this.impl.modelQueue().areAll2D()),e.isLeaflet()){var n=e.getData();this.navigation.setConstraints2D(n.bbox,n.maxPixelPerUnit)}else this.navigation.setConstraints2D()},Ww.prototype.loadModel=async function(e,t,i,n,r){var o,s,a=this,l=a.impl._reserveLoadingFile();if(void 0===(t=t||{}).skipPropertyDb){var c=fe("skipPropertyDb")||"";t.skipPropertyDb="true"===c||"false"!==c&&void 0}function u(e,t,i){a._loadingSpinner.hide(),n&&n(e,t,i)}var h=e.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),d=h?h[1]:null,f=this.config&&this.config.loaderExtensions&&this.config.loaderExtensions[d]||d in kw&&kw[d];if(f&&!this.isExtensionLoaded(f))try{await this.loadExtension(f,this.config)}catch(e){return a.impl._removeLoadingFile(l),n&&n(st.VIEWER_INTERNAL_ERROR,e.toString()),!1}let p;if(p=t&&t.fileLoader?t.fileLoader:Ra.getFileLoaderForExtension(d,t.mimeType),!p)return a.impl._removeLoadingFile(l),rt.error("File extension not supported:"+d,at(st.UNSUPORTED_FILE_EXTENSION)),u(st.UNSUPORTED_FILE_EXTENSION,"File extension not supported",0),!1;this.setLoadHeuristics(t),this.impl.hasModels()||this._loadingSpinner.show(),"function"==typeof p.getExistingInstance&&(s=p.getExistingInstance(e,t,this.config)),s||(s=new p(this.impl,this.config)),a.impl._addLoadingFile(l,s);var m=s.loadFile(e,t,(function(e,n){if(a.impl){if(a.impl._removeLoadingFile(s),e)return a.dispatchEvent({type:Gn,error:e,loader:s}),void u(e.code,e.msg,e.args);n.getData().underlayRaster=t.underlayRaster&&n.getLeaflet(),t.loadAsHidden?a.impl.modelQueue().addHiddenModel(n):a.impl.addModel(n),n.loader&&n.loader.notifiesFirstPixel&&a._loadingSpinner instanceof Uw?a.addEventListener(qr,(function(){a._loadingSpinner.hide()}),{once:!0}):a._loadingSpinner.hide(),!S()&&a._forgeLogo&&(a._forgeLogo.style.display="block"),i&&i(n)}}),r);if(m||a.impl._removeLoadingFile(s),this.fireEvent({type:Vn,loader:s}),t.skipPrefs)void 0===this.prefs.get(Pn.DISPLAY_UNITS)&&this.prefs.set(Pn.DISPLAY_UNITS,new xs(ms)),void 0===this.prefs.get(Pn.DISPLAY_UNITS_PRECISION)&&this.prefs.set(Pn.DISPLAY_UNITS_PRECISION,new xs(vs));else if(!S()&&!this.profile){let e=this.chooseProfile(t);this.setProfile(e,!1)}t.pdfRenderingMode=this._curOptions&&this._curOptions.enableVectorRasterSwitch&&(null===(o=this._curAvDocument)||void 0===o?void 0:o.getPdfRenderingMode()),km.setModelLoadStartedTimestamp();const g=Object.assign(function(e,t,i,n){const{bubbleNode:r,pdfRenderingMode:o}=n,s={url:e,lmvFileExtension:t,returnValue:i};if(r){s.isOtg=r.isOtg()&&ke.isOtgBackend(),s.isSVF2=r.isSVF2()&&ke.isSVF2Backend(),s.geometrySize=r.data.size||0,s.viewable_type=r.is2D()?"2d":"3d";const e=r.findViewableParent();try{var a;const t=e&&e.name(),i=t&&t.lastIndexOf("."),n=i>=0&&t.substring(i+1),l=null===(a=r.data)||void 0===a||null===(a=a.extractor)||void 0===a?void 0:a.includes("pdf");n?(s.seedFileExt=n.toLowerCase(),"pdf"===n.toLowerCase()&&o&&(s.pdf_rendering_mode=o)):l&&o&&(s.pdf_rendering_mode=o)}catch(e){}}return s}(e,d,m,t),{is_enabled_HLOD:rn});if(Qe.appendCommonPropsForModelLoad(g),"pdf"===d){var v;(t.loadAsHidden||t.disableUnderlayRaster||!(null!==(v=t.leafletOptions)&&void 0!==v&&v.tempRasterPath))&&Qe.track("viewer.model.load",g),Qe.track("viewer.model.load.vector",g)}else Qe.track("viewer.model.load",g);return m},Ww.prototype.isLoadDone=function(){let{geometry:e=!0,propDb:t=!0,textures:i=!0,hidden:n=!1,onlyModels:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!r){if(!this.started)return!0;if(this.impl._hasLoadingFile())return!1}if(i&&Autodesk.Viewing.Private.TextureLoader.requestsInProgress()>0)return!1;const o=n=>{if(!n)return!1;const r=!t||!n.getPropertyDb()||n.getPropertyDb().isLoadDone();return(e||i?n.isLoadDone():n.modelRootLoaded)&&r};return r?Array.isArray(r)?r.every(o):o(r):this.getVisibleModels().every(o)&&(!n||this.getHiddenModels().every(o))},Ww.prototype.waitForLoadDone=function(e){return new Promise(((t,i)=>{var{geometry:n=!0,propDb:r=!0,textures:o=!0,hidden:s=!1,onlyModels:a}=e||{};const l={geometry:n=n||o,propDb:r,textures:o,hidden:s,onlyModels:a},c=()=>this.started&&(this.impl._hasLoadingFile()||this.impl.modelQueue().getModels().length>0||this.impl.modelQueue().getHiddenModels().length>0);var u,h=!a&&c();if(h&&this.isLoadDone(l))return void t();const d=()=>{(h=h||c())&&this.isLoadDone(l)&&(u(),t())},f=e=>{u();const t=new Error("Error loading model");t.loader=e.loader,t.error=e.error,i(t)};u=()=>{n&&this.removeEventListener(Wn,d),r&&(this.removeEventListener(qn,d),this.removeEventListener(Kn,d)),o&&this.removeEventListener(jn,d),this.removeEventListener(Vn,d),this.removeEventListener(Zn,d),this.removeEventListener($n,d),this.removeEventListener(Gn,f),this.removeEventListener(Hn,d),this.removeEventListener(Fn,t)},n&&this.addEventListener(Wn,d),r&&(this.addEventListener(qn,d),this.addEventListener(Kn,d)),o&&this.addEventListener(jn,d),this.addEventListener(Vn,d),this.addEventListener(Zn,d),this.addEventListener($n,d),this.addEventListener(Gn,f),this.addEventListener(Hn,d,{priority:-1e6}),this.addEventListener(Fn,(()=>i(new Error("Promise reject because viewer finished"))))}))},Ww.prototype.unloadModel=function(e){e||(e=this.model),this.impl.unloadModel(e)},Ww.prototype.updateViewerStateForPdfReload=function(e){this._curAvDocument=e.getDocument(),this._curManifest=e},Ww.prototype.loadDocumentNode=function(e,t){var i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._curAvDocument=e,this._curManifest=t;const r=n.leafletOptions||{};let o=e.getViewableUrn(t,r),s=t.findPropertyDbPath();o=e.getFullPath(o),s=e.getFullPath(s);const a=e.getAcmSessionId(o),l=Object.assign({sharedPropertyDbPath:s,acmSessionId:a,bubbleNode:t,applyRefPoint:!1,loadOptions:r,page:r.page||1},n);this._curOptions=l;var c=t.search(Oa.PDF_PAGE_NODE),u=t.search(Oa.LEAFLET_NODE);this._curOptions.enableVectorRasterSwitch=n.enableVectorRasterSwitch&&c.length>0&&u.length>0;const h="pdf"===t.getInputFileType(),d=null===(i=t.data)||void 0===i||null===(i=i.extractor)||void 0===i?void 0:i.includes("pdf");if(this._isPdfModelWithVectorAndRasterRepr=(h||d)&&c.length>0&&u.length>0,r.tempRasterPath&&(l.loadOptions.tempRasterPath=r.tempRasterPath),!l.keepCurrentModels&&this.impl.hasModels()){let e=this.config;this.tearDown(),this.setUp(e)}const f=t.findParentGeom2Dor3D(),p=null==f?void 0:f.extensions();Array.isArray(p)&&p.forEach((e=>{this.loadExtension(e,this.config)}));const m=r.isPdf?this.loadExtension("Autodesk.PDF",this.config):Promise.resolve(),g=!l.disableUnderlayRaster&&r.tempRasterPath,v=g?this._loadTempRasterModel(e,l,t):Promise.resolve();return m.then((()=>v)).then((e=>new Promise(((i,n)=>{g&&e&&e!==this.getUnderlayRaster(t)?n("load canceled"):this.loadModel(o,l,(e=>{l.loadAsHidden||l.preserveView||"view"!==t.type()||this.setView(t,{skipTransition:!0}),i(e)}),n)}))))},Ww.prototype.unloadDocumentNode=function(e){let t=this.impl.findModel(e,!0);if(t)return this.impl.unloadModel(t),!0;if(!this.impl.loaders)return!1;for(let t=0;t<this.impl.loaders.length;t++){let i=this.impl.loaders[t];if((i.options&&i.options.bubbleNode)===e)return i.dtor(),this.impl.loaders.splice(t,1),!0}return!1},Ww.prototype._loadTempRasterModel=function(e,t,i){return new Promise(((n,r)=>{if(t.loadAsHidden)return n();t.underlayRaster=!0,t.loadOptions.fitPaperSize=!0;const o=e=>{var t,n;const r=e.getDocumentNode();return r&&(null===(t=r.getDocument())||void 0===t?void 0:t.getPath())===(null===(n=i.getDocument())||void 0===n?void 0:n.getPath())&&r.guid()===i.guid()&&!e.isLeaflet()},s=e=>{let{model:t}=e;o(t)&&(2===this.getVisibleModels().length&&this.initializeFirstModelPresets(t,!1,!0),this.removeEventListener(Zn,s))};this.addEventListener(Zn,s);const a=e=>{let{model:t}=e;o(t)&&(t.changePaperVisibility(!0),this.removeEventListener($n,a),this.removeEventListener(Zn,s),this.removeEventListener(Wn,c))};let l;this.addEventListener($n,a);const c=e=>{let{model:t}=e;o(t)&&(t.changePaperVisibility(!0),this.removeEventListener($n,a),l&&(this.unloadModel(l),l=null),this.removeEventListener(Wn,c))};this.addEventListener(Wn,c);const u=e.getFullPath(t.loadOptions.tempRasterPath);this.loadModel(u,t,(e=>{t.loadOptions.fitPaperSize=void 0,t.underlayRaster=void 0,t.hideBackground=!0,l=e,n(e)}),(e=>{if(t.loadOptions.fitPaperSize=void 0,t.underlayRaster=void 0,e===st.LOAD_CANCELED)return r("load canceled");n()}))}))},Ww.prototype.getDimensions=function(){if(this.container){var e={};return this.getScreenMode()===$a.kFullScreen?(e.width=screen.width,e.height=screen.height):e=this.container.getBoundingClientRect(),{width:e.width,height:e.height}}return null},Ww.prototype.resize=function(){this.container.clientWidth>0&&this.container.clientHeight>0&&this.impl.resize(this.container.clientWidth,this.container.clientHeight)},Ww.prototype.getHotkeyManager=function(){return this._hotkeyManager},Ww.prototype.getCamera=function(){return this.impl.camera},Ww.prototype.getState=function(e){return this.viewerState.getState(e)},Ww.prototype.restoreState=function(e,t,i){var n=this.viewerState.restoreState(e,t,i);return n&&this.dispatchEvent({type:Nn,value:n}),n},Ww.prototype.getViewpointCamData=function(e){const t=e.position,i=e.target,n=e.up,r=e.isPerspective?0:1;return[t.x,t.y,t.z,i.x,i.y,i.z,n.x,n.y,n.z,e.aspect,e.fov*(Math.PI/180),e.orthoScale,r]},Ww.prototype.setView=function(e,t){var i,n;if(!(e&&e instanceof Oa))return!1;const r=e.findParentGeom2Dor3D();let o=r&&this.impl.findModel(r,!0)||this.model;if(!o)return!1;let s,a=!!t&&t.skipTransition,l=!t||t.useExactCamera,c=!!t&&t.skipViewpointExtra;if(e.getViewBox())return this.setViewFromViewBox(e.getViewBox(),e.name(),a),this.dispatchEvent({type:jr,view:e}),!0;let u,h,d,f=null===(i=o.loader)||void 0===i?void 0:i.svf,p=e.data.isViewpoint&&f?null===(n=f.viewpoints)||void 0===n?void 0:n[e.data.entry]:null,m=e.data.camera,g=o.isOTG(),y=!1;if(this.showAll(),!c&&p){const e=p.camera;m=this.getViewpointCamData(e);const t=f.overrideSets[p.overrideSet];if(t){const{defaultMaterialIndex:e,materialOverrides:i,flagOverrides:n,defaultFlags:r}=t,s=o.getFragmentList(),a=s.fragments.length;if(s.materialIdMapOriginal||s.storeOriginalMaterials(),(e||i)&&(y=o.isConsolidated()||o.isConsolidating(),y&&o.unconsolidate(!1,!0)),e){const t=g?f.getMaterialHash(e):this.impl.matman()._getMaterialHash(o,e),i=this.impl.matman()._materials[t];if(i)for(let e=0;e<a;e++)this.model.getFragmentList().setMaterial(e,i)}if(i){e||o.getFragmentList().restoreOriginalMaterials();for(let e=0;e<i.length;e++){const t=i[e].dbId,n=i[e].materialIndex;if(!Number.isFinite(t)||!Number.isFinite(n))continue;const r=g?f.getMaterialHash(n):this.impl.matman()._getMaterialHash(o,n),s=this.impl.matman()._materials[r];s&&o.getInstanceTree().enumNodeFragments(t,(e=>{o.getFragmentList().setMaterial(e,s)}),!0)}}if(r&&(1===r?this.hideAll():2===r&&this.showAll()),n)if(0===n.length)this.showAll();else for(let e=0;e<n.length;e++){const{flags:t,dbId:i}=n[e];Number.isFinite(t)&&Number.isFinite(i)&&(1===t?this.hide(i,o):2===t&&this.show(i,o))}y&&this.impl._consolidateModelInternal(o,!0).then((()=>{this.impl.invalidate(!0,!0)}))}}if(s=this.getCameraFromViewArray(m,o),!s)return!1;this.impl.setViewFromCamera(s,a,l);const b=p??e.data;u=b.sectionPlane,h=b.sectionBox,d=b.sectionBoxTransform;const x=o.getModelToViewerTransform();if(u){let e=[];for(let t=0;t<u.length;t+=4){const i=new(v().Plane)(new(v().Vector3)(u[t+0],u[t+1],u[t+2]),u[t+3]);x&&i.applyMatrix4(x),e.push(new(v().Vector4)(i.normal.x,i.normal.y,i.normal.z,i.constant))}this.impl.setCutPlaneSet("__set_view",e)}else if(h&&d){let t;if(e.data.isViewpoint){const e=new(v().Box3);e.set(h.min,h.max);const i=e.max.clone().sub(e.min),n=(new(v().Matrix4)).compose(e.getCenter(),new(v().Quaternion)(d.x,d.y,d.z,d.w),new(v().Vector3)(i.x,i.y,i.z)),r=(new(v().Matrix4)).copy(x).multiply(n);t=Kp.box2CutPlanes(new(v().Box3)(new(v().Vector3)(-.5,-.5,-.5),new(v().Vector3)(.5,.5,.5)),r)}else{const e=(new(v().Matrix4)).fromArray([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15]]);let i=new(v().Vector3)(h[0],h[1],h[2]),n=new(v().Vector3)(h[3],h[4],h[5]),r=new(v().Box3)(i,n);const o=new(v().Matrix4);x&&o.copy(x),o.multiply(e),t=Kp.box2CutPlanes(r,o)}this.impl.setCutPlaneSet("__set_view",t)}else this.impl.setCutPlaneSet("__set_view",void 0);return this.dispatchEvent({type:jr,view:e}),!0},Ww.prototype.setViewType=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setViewType is not applicable to 2D"):this.prefs.set(Mn.VIEW_TYPE,e)},Ww.prototype.setViewFromArray=function(e){var t=this.getCameraFromViewArray(e);this.impl.setViewFromCamera(t,!1,!0)},Ww.prototype.getCameraFromViewArray=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.model;const i=null==t?void 0:t.getModelToViewerTransform();return Oa.readCameraFromArray(e,i)},Ww.prototype.getViewArrayFromCamera=function(){var e=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0};return this.impl.getViewArrayFromCamera(e)},Ww.prototype.setViewFromViewBox=function(e,t,i){var n=this.model;if(!n||n.is2d()){if(t&&t.length){var r,o=n.getData().metadata.views||[];for(r=0;r<o.length&&o[r].name!=t;r++);if(r<o.length){var s=o[r].layer_state;s&&this.activateLayerState(s)}}this.impl.setViewFromViewBox(this.model,e,t,i)}else rt.warn("Viewer3D.setViewFromViewBox is not applicable to 3D")},Ww.prototype.activateLayerState=function(e){this.impl.layers.activateLayerState(e),this.dispatchEvent({type:Rr})},Ww.prototype.getLayerStates=function(){return this.impl.layers.getLayerStates()},Ww.prototype.setViewFromFile=function(e){this.setActiveNavigationTool(),this.impl.setViewFromFile(e||this.model)},Ww.prototype.getProperties=function(e,t,i){this.model?this.model.getProperties(e,t,i):i&&i(st.BAD_DATA,"Properties failed to load since model does not exist")},Ww.prototype.getObjectTree=function(e,t){this.model?this.model.getObjectTree(e,t):t&&t(st.BAD_DATA,"ObjectTree failed to load since model does not exist")},Ww.prototype.setCanvasClickBehavior=function(e){if(Object.prototype.hasOwnProperty.call(this.impl.controls,"setClickBehavior")&&this.impl.controls.setClickBehavior(e),this.clickHandler&&this.clickHandler.setClickBehavior(e),e&&e.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),e&&e.disableTwoFingerSwipe){var t=this.toolController.getTool("gestures");t&&t.disableTwoFingerSwipe()}},Ww.prototype.search=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{searchHidden:!1};this.searchText=e,this.model?this.model.search(e,t,i,n,r):i&&i(st.BAD_DATA,"Search failed since model does not exist")},Ww.prototype.getHiddenNodes=function(e){return e=e||this.model,this.impl.visibilityManager.getHiddenNodes(e)},Ww.prototype.getIsolatedNodes=function(e){return(e=e||this.model)&&e.is2d()?(rt.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes(e)},Ww.prototype.isolate=function(e,t){(t=t||this.model)&&this.impl.visibilityManager.isolate(e,t)},Ww.prototype.setBackgroundColor=function(e,t,i,n,r,o){this.impl.setClearColors(e,t,i,n,r,o)},Ww.prototype.setBackgroundOpacity=function(e){this.impl.setClearAlpha(e)},Ww.prototype.toggleSelect=function(e,t,i){(t=t||this.model)&&t.is2d()?rt.warn("Viewer3D.toggleSelect is not yet implemented for 2D"):this.impl.selector.toggleSelection(e,t,i)},Ww.prototype.select=function(e,t,i){"number"==typeof e&&(e=[e]),t=t||this.model,this.impl.selector.setSelection(e,t,i)},Ww.prototype.clearSelection=function(){this.impl.selector.clearSelection()},Ww.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},Ww.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},Ww.prototype.setSelectionMode=function(e){this.prefs.set(Mn.SELECTION_MODE,e)},Ww.prototype.getSelection=function(){return this.impl.selector.getSelection()},Ww.prototype.lockSelection=function(e,t,i){i=i||this.model,this.impl.selector.lockSelection(e,t,i)},Ww.prototype.unlockSelection=function(e,t){this.impl.selector.unlockSelection(e,t)},Ww.prototype.isSelectionLocked=function(e,t){return this.impl.selector.isNodeSelectionLocked(e,t)},Ww.prototype.getAggregateSelection=function(e){var t=this.impl.selector.getAggregateSelection();if(e)for(var i=0;i<t.length;i++)for(var n=0;n<t[i].selection.length;n++)e(t[i].model,t[i].selection[n]);return t},Ww.prototype.setAggregateSelection=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.impl.selector.setAggregateSelection(e,t)},Ww.prototype.getAggregateIsolation=function(){return this.impl.visibilityManager.getAggregateIsolatedNodes()},Ww.prototype.setAggregateIsolation=function(e){this.impl.visibilityManager.aggregateIsolate(e)},Ww.prototype.getAggregateHiddenNodes=function(){return this.impl.visibilityManager.getAggregateHiddenNodes()},Ww.prototype.hide=function(e,t){t=t||this.model,this.impl.visibilityManager.hide(e,t)},Ww.prototype.show=function(e,t){t=t||this.model,this.impl.visibilityManager.show(e,t)},Ww.prototype.showAll=function(){this.impl.visibilityManager.aggregateIsolate([]),this.impl.layers.showAllLayers(),this.fireEvent({type:_r})},Ww.prototype.hideAll=function(){this.getVisibleModels().forEach((e=>{this.hide(e.getRootId(),e)})),this.fireEvent({type:Er})},Ww.prototype.toggleVisibility=function(e,t){this.impl.visibilityManager.toggleVisibility(e,t)},Ww.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},Ww.prototype.isNodeVisible=function(e,t){return t=t||this.model,this.impl.isNodeVisible(e,t)},Ww.prototype.lockVisible=function(e,t,i){i=i||this.model,this.impl.visibilityManager.lockNodeVisible(e,t,i)},Ww.prototype.toggleLockVisible=function(e,t){this.impl.visibilityManager.toggleVisibleLocked(e,t)},Ww.prototype.isVisibleLocked=function(e,t){return this.impl.visibilityManager.isNodeVisibleLocked(e,t)},Ww.prototype.explode=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.model&&(this.model.is2d()?rt.warn("Viewer3D.explode is not applicable to 2D"):this.impl.explode(e,t)&&rt.track({name:"explode_count",aggregate:"count"}))},Ww.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(rt.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},Ww.prototype.getExplodeOptions=function(){return this.model&&this.model.is2d()?(rt.warn("Viewer3D.getExplodeOptions is not applicable to 2D"),0):this.impl.getExplodeOptions()},Ww.prototype.lockExplode=function(e,t,i){return(i=i||this.model)&&i.is2d()?(rt.warn("Viewer3D.lockExplode is not applicable to 2D"),0):this.impl.lockExplode(e,t,i)},Ww.prototype.isExplodeLocked=function(e,t){return(t=t||this.model)&&t.is2d()?(rt.warn("Viewer3D.isExplodeLocked is not applicable to 2D"),0):this.impl.isExplodeLocked(e,t)},Ww.prototype.toggleLockExplode=function(e,t){return(t=t||this.model)&&t.is2d()?(rt.warn("Viewer3D.toggleLockExplode is not applicable to 2D"),0):this.impl.lockExplode(e,!this.isExplodeLocked(e,t),t)},Ww.prototype.setQualityLevel=function(e,t){this.model&&this.model.is2d()?rt.warn("Viewer3D.setQualityLevel is not applicable to 2D"):(this.prefs.set(Mn.AMBIENT_SHADOWS,e),this.prefs.set(Mn.ANTIALIASING,t))},Ww.prototype.setGhosting=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setGhosting is not applicable to 2D"):this.prefs.set(Mn.GHOSTING,e)},Ww.prototype.setGroundShadow=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setGroundShadow is not applicable to 2D"):this.prefs.set(Mn.GROUND_SHADOW,e)},Ww.prototype.setGroundReflection=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setGroundReflection is not applicable to 2D"):this.prefs.set(Mn.GROUND_REFLECTION,e)},Ww.prototype.setEnvMapBackground=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setEnvMapBackground is not applicable to 2D"):this.prefs.set(Mn.ENV_MAP_BACKGROUND,e)},Ww.prototype.setFirstPersonToolPopup=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D"):this.prefs.set(Mn.FIRST_PERSON_TOOL_POPUP,e)},Ww.prototype.getFirstPersonToolPopup=function(){if(!this.model||!this.model.is2d())return this.prefs.get("firstPersonToolPopup");rt.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D")},Ww.prototype.setBimWalkToolPopup=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setBimWalkToolPopup is not applicable to 2D"):this.prefs.set(Mn.BIM_WALK_TOOL_POPUP,e)},Ww.prototype.getBimWalkToolPopup=function(){if(!this.model||!this.model.is2d())return this.prefs.get("bimWalkToolPopup");rt.warn("Viewer3D.getBimWalkToolPopup is not applicable to 2D")},Ww.prototype.setProgressiveRendering=function(e){this.prefs.set(Pn.PROGRESSIVE_RENDERING,e)},Ww.prototype.setGrayscale=function(e){this.model&&this.model.is3d()?rt.warn("Viewer3D.setGrayscale is not applicable to 3D"):this.prefs.set(In.GRAYSCALE,e)},Ww.prototype.setSwapBlackAndWhite=function(e){this.model&&this.model.is3d()?rt.warn("Viewer3D.setSwapBlackAndWhite is not applicable to 3D"):this.prefs.set(In.SWAP_BLACK_AND_WHITE,e)},Ww.prototype.setOptimizeNavigation=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D"):this.prefs.set(Mn.OPTIMIZE_NAVIGATION,e)},Ww.prototype.initializePrefListeners=function(){var e=this;this.prefs.addListeners(Pn.KEY_MAP_CMD,(e=>{this.impl.toggleCmdMapping(e,this.toolController)})),this.prefs.addListeners(Mn.ANTIALIASING,(e=>{const t=this.prefs.get(Mn.AMBIENT_SHADOWS);this.impl.togglePostProcess(t,e)})),this.prefs.addListeners(Mn.AMBIENT_SHADOWS,(e=>{const t=this.prefs.get(Mn.ANTIALIASING);this.impl.togglePostProcess(e,t)})),this.prefs.addListeners(Mn.GROUND_SHADOW,(e=>{this.impl.toggleGroundShadow(e)})),this.prefs.addListeners(Mn.GROUND_REFLECTION,(e=>{this.impl.toggleGroundReflection(e)})),this.prefs.addListeners(Mn.ENV_MAP_BACKGROUND,(e=>{this.impl.toggleEnvMapBackground(e)})),this.prefs.addListeners(Pn.PROGRESSIVE_RENDERING,(e=>{this.impl.toggleProgressive(e)})),this.prefs.addListeners(Mn.VIEW_TYPE,(e=>{const t=this.prefs.get(Mn.VIEW_TYPE),i=this.impl.getModelCamera(this.model);if(i){const e=i.isPerspective;if(!isNaN(e)){const i=e?Ln.PERSPECTIVE:Ln.ORTHOGRAPHIC;this.prefs.setDefault(Mn.VIEW_TYPE,i),t===Ln.DEFAULT&&(this.prefs[Mn.VIEW_TYPE]=i)}}this.autocam.setViewType(e)})),this.prefs.addListeners(In.GRAYSCALE,(e=>{this.impl.toggleGrayscale(e)})),this.prefs.addListeners(In.SWAP_BLACK_AND_WHITE,(e=>{this.impl.toggleSwapBlackAndWhite(e)})),this.isFirstLoad=!0,this.prefs.addListeners(In.VECTOR_VIEWING,(e=>{!this.isFirstLoad&&this._curAvDocument&&this._curManifest&&this._curOptions&&this._isPdfModelWithVectorAndRasterRepr&&new Promise((e=>setTimeout(e,200))).then((()=>{this.unloadDocumentNode(this._curManifest);const e={};e.enableVectorRasterSwitch=this._curOptions.enableVectorRasterSwitch,this.loadDocumentNode(this._curAvDocument,this._curManifest,e)})),this.isFirstLoad=!1})),this.prefs.addListeners(Mn.OPTIMIZE_NAVIGATION,(e=>{this.impl.setOptimizeNavigation(e)})),this.prefs.addListeners(Mn.GHOSTING,(e=>{this.impl.toggleGhosting(e)})),this.prefs.addListeners(Mn.LINE_RENDERING,(e=>{this.impl.hideLines(!e)})),this.prefs.addListeners(Pn.POINT_RENDERING,(e=>{this.impl.hidePoints(!e)})),this.prefs.addListeners(Mn.EDGE_RENDERING,(e=>{this._displayEdges=()=>{this.impl.setDisplayEdges(e)},e||this.model&&this.model.isLoadDone()?this._displayEdges():this.addEventListener(Wn,this._displayEdges)})),this.prefs.addListeners(Mn.LIGHT_PRESET,(e=>{let t=!1;if("string"==typeof e){for(var i=e,n=-1,r=0;r<xo.length;r++)if(xo[r].name===i){n=r;break}-1===n&&(rt.warn("Invalid Prefs3D.LIGHT_PRESET: "+e),rt.warn("Setting to default light preset."),t=!0),e=n}this.impl.setLightPreset(e,t)})),this.prefs.addListeners(Mn.ALWAYS_USE_PIVOT,(e=>{this.navigation.setUsePivotAlways(e)})),this.prefs.addListeners(Pn.REVERSE_MOUSE_ZOOM_DIR,(e=>{this.navigation.setReverseZoomDirection(e)})),this.prefs.addListeners(Mn.REVERSE_HORIZONTAL_LOOK_DIRECTION,(e=>{this.navigation.setReverseHorizontalLookDirection(e)})),this.prefs.addListeners(Mn.REVERSE_VERTICAL_LOOK_DIRECTION,(e=>{this.navigation.setReverseVerticalLookDirection(e)})),this.prefs.addListeners(Mn.ZOOM_TOWARDS_PIVOT,(e=>{this.navigation.setZoomTowardsPivot(e)})),this.prefs.addListeners(Mn.SELECTION_SETS_PIVOT,(e=>{this.navigation.setSelectionSetsPivot(e)})),this.prefs.addListeners(Mn.ORBIT_PAST_WORLD_POLES,(e=>{this.navigation.setOrbitPastWorldPoles(e)})),this.prefs.addListeners(Pn.LEFT_HANDED_MOUSE_SETUP,(e=>{this.navigation.setUseLeftHandedInput(e),Ka.setUseLeftHandedInput(e)})),this.prefs.addListeners(Pn.WHEEL_SETS_PIVOT,(e=>{this.navigation.setWheelSetsPivot(e)})),this.prefs.addListeners(Mn.SELECTION_MODE,(e=>{this.impl.selector.setSelectionMode(e)})),this.prefs.addListeners(Pn.BACKGROUND_COLOR_PRESET,(e=>{if(e)try{var t=JSON.parse(e);this.impl.setClearColors(t[0],t[1],t[2],t[3],t[4],t[5])}catch(e){rt.warn("Invalid Prefs.BACKGROUND_COLOR_PRESET: "+t)}})),this.prefs.addListeners(Mn.EXPLODE_STRATEGY,(e=>{BS.setStrategy(e)&&this.impl.refreshExplode()})),this.prefs.addListeners(In.LOADING_ANIMATION,(e=>{this.impl.onLoadingAnimationChanged(e)}));const t={};this.prefs.addListeners(Mn.FORCE_DOUBLE_SIDED,(i=>{this._setDoubleSided=function(n){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=n.model,s=function(e){return"boolean"==typeof i?i:!!i[e.id]}(o);const a=o.getData();Object.prototype.hasOwnProperty.call(t,o.id)||(t[o.id]=!!a.doubleSided);const l=s||!!a.doubleSided;l!==t[o.id]&&(e.impl.setDoubleSided(l,o,r),t[o.id]=l)};var n=this.impl.modelQueue().getModels();0===n.length?this.addEventListener(Zn,this._setDoubleSided):(n.forEach((e=>{this._setDoubleSided({model:e},!1)})),this.impl.sceneUpdated())}))},Ww.prototype.setNavigationLock=function(e){const t=this.navigation.getIsLocked();return t!==e&&(this.navigation.setIsLocked(e),this.dispatchEvent({type:Bn,id:this.getActiveNavigationTool()})),t},Ww.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},Ww.prototype.setNavigationLockSettings=function(e){this.navigation.setLockSettings(e),this.dispatchEvent({type:Bn,id:this.getActiveNavigationTool()})},Ww.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},Ww.prototype.setActiveNavigationTool=function(e){if(e===this._pushedTool||!e&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}return(!e||e===this.getDefaultNavigationToolName())&&null===this._pushedTool?(this.dispatchEvent({type:Bn,id:this.getDefaultNavigationToolName()}),!0):!!this.impl.controls.activateTool(e)&&(this._pushedTool=e,this.dispatchEvent({type:Bn,id:this._pushedTool}),!0)},Ww.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},Ww.prototype.setDefaultNavigationTool=function(e){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool);var t=this._pushedTool;this._pushedTool=null,t&&this.impl.controls.deactivateTool(t),this.impl.controls.activateTool(e),this._defaultNavigationTool=e,t&&(this.impl.controls.activateTool(t),this._pushedTool=t)},Ww.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},Ww.prototype.getFOV=function(){return this.navigation.getVerticalFov()},Ww.prototype.setFOV=function(e){this.navigation.setVerticalFov(e,!0)},Ww.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},Ww.prototype.setFocalLength=function(e){this.navigation.setFocalLength(e,!0)},Ww.prototype.hideLines=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.hideLines is not applicable to 2D"):this.prefs.set(Mn.LINE_RENDERING,!e)},Ww.prototype.hidePoints=function(e){this.prefs.set(Pn.POINT_RENDERING,!e)},Ww.prototype.setDisplayEdges=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setDisplayEdges is not applicable to 2D"):this.prefs.set(Mn.EDGE_RENDERING,e)},Ww.prototype.applyCamera=function(e,t){this.impl.setViewFromCamera(e,!0),t&&this.fitToView()},Ww.prototype.fitToView=function(e,t,i){var n=[];e&&(e.length>0&&e[0].model?n=e:e.length>0&&n.push({model:t||this.model,selection:e})),this.impl.fitToView(n,i)},Ww.prototype.setClickConfig=function(e,t,i){var n=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in n){var r=n[e];if(t in r)return r[t]=i,!0}return!1},Ww.prototype.getClickConfig=function(e,t){var i=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in i){var n=i[e];if(t in n)return n[t]}return null},Ww.prototype.setClickToSetCOI=function(e,t){!1!==t&&this.prefs.set(Mn.CLICK_TO_SET_COI,e);var i=this.getClickConfig("click","onObject");e?-1===i.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):i.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},Ww.prototype.setProfile=function(e,t){if(!e)return!1;this.profile=e,this.profile.apply(this.prefs,t);const i=this.profile.extensions&&this.profile.extensions.unload||[],n=this.profile.extensions&&this.profile.extensions.load||[];i.forEach((e=>{this.isExtensionLoaded(e)&&this.unloadExtension(e)})),n.forEach((e=>{this.isExtensionLoaded(e)||this.loadExtension(e,this.config)})),this.dispatchEvent({type:Autodesk.Viewing.PROFILE_CHANGE_EVENT,profile:e})},Ww.prototype.initSettings=function(e){if(!this.profile){const t=new Os(e);this.setProfile(t)}},Ww.prototype.setLightPreset=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setLightPreset is not applicable to 2D"):this.prefs.set(Mn.LIGHT_PRESET,e)},Ww.prototype.setUsePivotAlways=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setUsePivotAlways is not applicable to 2D"):this.prefs.set(Mn.ALWAYS_USE_PIVOT,e)},Ww.prototype.setReverseZoomDirection=function(e){this.prefs.set(Pn.REVERSE_MOUSE_ZOOM_DIR,e)},Ww.prototype.setReverseHorizontalLookDirection=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"):this.prefs.set(Mn.REVERSE_HORIZONTAL_LOOK_DIRECTION,e)},Ww.prototype.setReverseVerticalLookDirection=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"):this.prefs.set(Mn.REVERSE_VERTICAL_LOOK_DIRECTION,e)},Ww.prototype.setZoomTowardsPivot=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setZoomTowardsPivot is not applicable to 2D"):this.prefs.set(Mn.ZOOM_TOWARDS_PIVOT,e)},Ww.prototype.setOrbitPastWorldPoles=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"):this.prefs.set(Mn.ORBIT_PAST_WORLD_POLES,e)},Ww.prototype.setUseLeftHandedInput=function(e){this.prefs.set(Pn.LEFT_HANDED_MOUSE_SETUP,e)},Ww.prototype.setDisplayUnits=function(e){this.prefs.set(Pn.DISPLAY_UNITS,e)},Ww.prototype.setDisplayUnitsPrecision=function(e){null==e&&(e=""),this.prefs.set(Pn.DISPLAY_UNITS_PRECISION,e)},Ww.prototype.setLayerVisible=function(e,t,i){var n=this.impl.layers;null===e?t?n.showAllLayers():n.hideAllLayers():(Array.isArray(e)||(e=[e]),i&&n.hideAllLayers(),this.impl.setLayerVisible(e,t)),this.dispatchEvent({type:Rr})},Ww.prototype.isLayerVisible=function(e){return!!(e&&e.isLayer&&this.impl.isLayerVisible(e))},Ww.prototype.anyLayerHidden=function(){for(var e=this.impl.getLayersRoot(),t=e&&e.children,i=t?t.length:0,n=0;n<i;++n)if(!this.impl.layers.isLayerVisible(t[n]))return!0;return!1},Ww.prototype.allLayersHidden=function(){for(var e=this.impl.getLayersRoot(),t=e&&e.children,i=t?t.length:0,n=0;n<i;++n)if(this.impl.layers.isLayerVisible(t[n]))return!1;return!0},Ww.prototype.hideHiddenObjects=function(){let e=this.impl.model;this.impl.handleInitialVisibility(e),Qe.track("viewer.hideHiddenObjects",{})},Ww.prototype.setGroundShadowColor=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setGroundShadowColor is not applicable to 2D"):this.impl.setGroundShadowColor(e)},Ww.prototype.setGroundShadowAlpha=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D"):this.impl.setGroundShadowAlpha(e)},Ww.prototype.setGroundReflectionColor=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D"):this.impl.setGroundReflectionColor(e)},Ww.prototype.setGroundReflectionAlpha=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D"):this.impl.setGroundReflectionAlpha(e)},Ww.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(rt.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},Ww.prototype.setCutPlanes=function(e){this.model&&this.model.is2d()?rt.warn("Viewer3D.getCutPlanes is not applicable to 2D"):this.impl.setCutPlaneSet("__set_view",e)},Ww.prototype.getScreenShot=function(e,t,i,n){return IS.getScreenShotLegacy(this,e,t,i,n)},Ww.prototype.setContextMenu=function(e){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=e||null},Ww.prototype.setDefaultContextMenu=function(){var e=Autodesk.Viewing.Extensions;return!(!e||!e.ViewerObjectContextMenu)&&(this.setContextMenu(new e.ViewerObjectContextMenu(this)),!0)},Ww.prototype.triggerContextMenu=function(e){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(e),!!this.contextMenu&&(this.contextMenu.show(e),!0)},Ww.prototype.triggerSelectionChanged=function(e){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(e)},Ww.prototype.triggerDoubleTapCallback=function(e){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(e)},Ww.prototype.triggerSingleTapCallback=function(e){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(e)},Ww.prototype.triggerSwipeCallback=function(e){this.config&&this.config.onTriggerSwipeCallback&&this.config.onTriggerSwipeCallback(e)},Ww.prototype.initContextMenu=function(){(!this.config||!Object.prototype.hasOwnProperty.call(this.config,"disableBrowserContextMenu")||this.config.disableBrowserContextMenu)&&(this.onDefaultContextMenu=function(e){e.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var e=this,t=this.canvas||this.container;this.onMouseDown=function(t){Ka.isRightClick(t)&&(e.startX=t.clientX,e.startY=t.clientY)},t.addEventListener("mousedown",this.onMouseDown),this.onMouseUp=function(t){if(Ka.isRightClick(t)&&t.clientX===e.startX&&t.clientY===e.startY){if(this.viewer.impl.isRightBtnSelectionEnabled()){const e=this.viewer.impl.clientToViewport(t.clientX,t.clientY),i=this.viewer.impl.hitTestViewport(e,!1),n=null==i?void 0:i.dbId,r=this.viewer.getSelection();if(void 0!==n&&!r.includes(n))return;if(void 0===n&&r.length)return}e.triggerContextMenu(t)}return!0},t.addEventListener("mouseup",this.onMouseUp,!1)},Ww.prototype.registerContextMenuCallback=function(e,t){this.contextMenuCallbacks[e]=t},Ww.prototype.unregisterContextMenuCallback=function(e){return e in this.contextMenuCallbacks&&(delete this.contextMenuCallbacks[e],!0)},Ww.prototype.runContextMenuCallbacks=function(e,t){for(var i in this.contextMenuCallbacks)Object.prototype.hasOwnProperty.call(this.contextMenuCallbacks,i)&&this.contextMenuCallbacks[i](e,t)},Ww.prototype.setModelUnits=function(e){this.model&&(this.model.getData().overriddenUnits=e)},Ww.prototype.worldToClient=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.impl.camera;return this.impl.worldToClient(e,t)},Ww.prototype.clientToWorld=function(e,t,i,n,r){return this.impl.clientToWorld(e,t,i,n,r)},Ww.prototype.modelHasTopology=function(){return!(!this.model||!this.model.hasTopology())},Ww.prototype.setSelectionColor=function(e,t){this.impl.setSelectionColor(e,t)},Ww.prototype.set2dSelectionColor=function(e,t){this.impl.set2dSelectionColor(e,t)},Ww.prototype.setTheme=function(e){for(var t=this.container.classList,i=0;i<t.length;++i){-1!==t[i].indexOf("-theme")&&t.remove(t[i--])}t.add(e)},Ww.prototype.setThemingColor=function(e,t,i,n){(i=i||this.model).setThemingColor(e,t,n),this.impl.invalidate(!0)},Ww.prototype.clearThemingColors=function(e){(e=e||this.model).clearThemingColors(),this.impl.invalidate(!0)},Ww.prototype.setMaterialsToDefaults=function(e){const t=(e||this.model).getFragmentList();if(!t)return;const i=e.isConsolidated()||e.isConsolidating();i&&e.unconsolidate(!1,!0),t.restoreOriginalMaterials(),i&&this.impl._consolidateModelInternal(e,!0).then((()=>{this.impl.invalidate(!0,!0)}))},Ww.prototype.transferModel=function(e,t){var i,n=this.impl.findModel(e);if(n){var r=[];this.getAggregateSelection((function(t,i){t.id==e&&r.push(i)}));var o=this.impl.visibilityManager.getIsolatedNodes(n),s=this.impl.visibilityManager.getHiddenNodes(n),a=this.impl.matman().exportModelMaterials(n);this.impl.unloadModel(n,!0),null===(i=n.getFragmentList())||void 0===i||i.dispose(this.impl.glrenderer()),n.isAEC()&&n.is3d()&&t.impl.setLightPresetForAec(),t.impl.setRenderingPrefsFor2D(n.is2d()),t.impl.addModel(n),t.impl.matman().importModelMaterials(a,e),t._loadingSpinner.hide(),n.loader&&n.loader.viewer3DImpl===this.impl&&(n.loader.viewer3DImpl=t.impl),n.getData().loadDone&&t.impl.onLoadComplete(n),t.impl.selector.setSelection(r,n),(o.length||s.length)&&t.impl.visibilityManager.aggregateRestore([{model:n,isolatedIds:o,hiddenIds:s}])}},Ww.prototype.hideModel=function(e){var t=this.impl.modelQueue();return!!(e="number"==typeof e?t.findModel(e):e)&&(this.impl.removeModel(e),t.addHiddenModel(e),!0)},Ww.prototype.showModel=function(e,t){var i=this.impl.modelQueue();return!!(e="number"==typeof e?i.findHiddenModel(e):e)&&(i.removeHiddenModel(e),this.impl.addModel(e,t),!0)},Ww.prototype.getVisibleModels=function(){return this.impl.modelQueue().getModels().slice()},Ww.prototype.getHiddenModels=function(){return this.impl.modelQueue().getHiddenModels().slice()},Ww.prototype.getAllModels=function(){return this.impl.modelQueue().getAllModels().slice()},Ww.prototype.getFirstModel=function(){return this.impl.is2d?this.impl.get2DModels()[0]:this.impl.get3DModels()[0]},Ww.prototype.getUnderlayRaster=function(e){return this.getAllModels().find((t=>{var i,n;const r=t.getDocumentNode();return r&&(null===(i=r.getDocument())||void 0===i?void 0:i.getPath())===(null===(n=e.getDocument())||void 0===n?void 0:n.getPath())&&r.guid()===e.guid()&&t.getData().underlayRaster}))},Ww.prototype.restoreDefaultSettings=function(){var e=this.model,t=e.is2d()?"2d":"3d";this.prefs.reset(t),this.impl.setupLighting(e),e.isAEC()&&e.is3d()&&this.impl.setLightPresetForAec(),this.impl.setRenderingPrefsFor2D(!e.is3d()),this.fireEvent({type:Br})},Ww.prototype.disableHighlight=function(e){this.impl.disableHighlight(e)},Ww.prototype.disableSelection=function(e){e&&this.clearSelection(),this.impl.disableSelection(e)},Ww.prototype.isHighlightDisabled=function(){return this.impl.selector.highlightDisabled},Ww.prototype.isHighlightPaused=function(){return this.impl.selector.highlightPaused},Ww.prototype.isHighlightActive=function(){return!(this.impl.selector.highlightDisabled||this.impl.selector.highlightPaused)},Ww.prototype.isSelectionDisabled=function(){return this.impl.selector.selectionDisabled},Ww.prototype.activateExtension=function(e,t){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].activate(t):(rt.warn("Extension is not loaded or doesn't exist"),!1)},Ww.prototype.deactivateExtension=function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].deactivate():(rt.warn("Extension is not loaded or doesn't exist"),!1)},Ww.prototype.isExtensionActive=function(e,t){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].isActive(t):(rt.warn("Extension is not loaded or doesn't exist"),!1)},Ww.prototype.isExtensionLoaded=function(e){return this.loadedExtensions&&e in this.loadedExtensions},Ww.prototype.getLoadedExtensions=function(){return this.loadedExtensions||[]},Ww.prototype.getExtensionModes=function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].getModes():(console.warn("Extension is not loaded or doesn't exist"),[])},Ww.prototype.reorderElements=function(e){var t=e.getAttribute("layer-order-id"),i=this.containerLayerOrder.indexOf(t),n=null;if(-1!==i)for(var r=i+1;r<this.containerLayerOrder.length&&!n;r++)n=this.container.querySelector('[layer-order-id="'+this.containerLayerOrder[r]+'"]');n?this.container.insertBefore(e,n):this.container.appendChild(e)},Ww.prototype.appendOrderedElementToViewer=function(e){var t=this.container.querySelector('[layer-order-id="'+e+'"]');if(t)return t;var i=this.getDocument().createElement("div");return i.setAttribute("layer-order-id",e),this.reorderElements(i),i},Ww.prototype.hitTest=function(e,t,i){return this.impl.hitTest(e,t,i)},Ww.prototype.refresh=function(e){this.impl.invalidate(e,!1,!e,!e)},Ww.prototype.chooseProfile=function(e){let t=this.profileManager.PROFILE_DEFAULT;return this.config&&this.config.profileSettings?t=new Os(this.config.profileSettings):e&&e.useFileProfile?t=this.profileManager.getProfileOrDefault(e.fileExt):e.isAEC&&(t=this.profileManager.PROFILE_AEC),t};var Qw=!1;function Zw(e){for(var t,i=Autodesk.Viewing.Private,n=0,r=0;r<e.length;r++){var o=e[r],s=o.getData();if(s){var a=o.getConsolidation();if(a&&(n+=a.byteSize),o.isLeaflet())Qw||(console.warn("Memory tracking not implemented for leaflets."),Qw=!0);else{if(!s.isOTG)n+=o.getGeometryList().geomMemory;var l=s.fragments;l&&(n+=Kw(l));var c=o.getFragmentList();c&&(n+=Xw(c));var u=s.bvh;u&&(n+=Yw(u));var h=s.instanceTree;h&&(n+=(t=void 0,qw((t=h.nodeAccess).children)+qw(t.nameSuffixes)+qw(t.names)+qw(t.nodeBoxes)+qw(t.nodes)))}}}return isFinite(n)||i.logger.warn("Memory estimate result was not a number"),n}function $w(e){var t=e.impl.geomCache(),i=t?t.byteSize:0,n=e.impl.modelQueue(),r=n.getModels(),o=n.getHiddenModels();return i+Zw(r)+Zw(o)}function Jw(e,t){var i=e,n=0,r=t;function o(e){var t;return e.lruTimestamp===n||(null===(t=e.getData())||void 0===t?void 0:t.loadOptions.keepHiddenModel)}this.updateModelTimestamps=function(e){n++;for(var t=0;t<e.length;t++){e[t].lruTimestamp=n}},this.memoryExceeded=function(){return $w(i)>=this.getMemLimit()},this.getMemLimit=function(){return void 0!==r?r:qi},this.setMemLimit=function(e){r=e},this.cleanup=function(e){var t=e||i.impl.unloadModel.bind(i.impl);if(this.memoryExceeded()){for(var n=function(){for(var e=i.impl.modelQueue().getHiddenModels(),t=[],n=0;n<e.length;n++){var r=e[n];o(r)||t.push(r)}return t.sort((function(e,t){return e.lurTimestamp-t.lruTimestamp})),t}(),r=0;r<n.length;r++){var s=n[r];if((s.isConsolidated()||s.isConsolidating())&&(s.unconsolidate(!0),!this.memoryExceeded()))return}var a=i.impl.geomCache();for(r=0;r<n.length;r++)if(t(s=n[r]),a&&a.cleanup(),!this.memoryExceeded())return}}}let eC={getUrlForBubbleNode:function(e,t){if(!e)return Promise.reject(new Error("Missing instance of BubbleNode"));var i=e.findParentGeom2Dor3D();if(!i)return Promise.reject(new Error("No thumbnail available."));const n=(t=t||{}).size||200,r=e.getRootNode();return(r.data.isVectorPDF||i.data.isVectorPDF)&&r.data.getPDF?new Promise((t=>{let i=e.data,o=r.data.getPDF(),s=n,a=n,l=`${i.guid}/thumbnail/${s}x${a}`;!function(e,t,i,n,r,o){var s=Rs.getItem(r);s?o(s):e.getPage(t).then((e=>{var t=c().document.createElement("canvas");t.width=i,t.height=n;var s=t.getContext("2d"),a={scale:1},l=e.getViewport(a),u=Math.min(t.width/l.width,t.height/l.height);e.render({canvasContext:s,viewport:e.getViewport({scale:u})}).promise.then((()=>{e.cleanup(),t.toBlob((e=>{var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){Rs.setItem(r,t.result),o(t.result)}}),"image/png")}))}))}(o,i.page,s,a,l,t)})):new Promise(((t,i)=>{var o={urn:r.urn(),width:n,height:n,guid:encodeURIComponent(e.guid()),acmsession:ke.getAcmSession()},s={responseType:"blob",skipAssetCallback:!0,size:n,guid:o.guid,acmsession:o.acmSession};let a="urn:"+o.urn;e.data.thumbnailUrn&&(a=r.getDocument().getFullPath(e.data.thumbnailUrn));var l=void 0;if(!c().USE_OTG_DS_PROXY){var u=Pe();l=ya[u].UPSTREAM;const e=ba(u,ke.getApiFlavor());s.apiData=e}ei.getThumbnail(Fe({endpoint:l}),a,(e=>{var i=new FileReader;i.onload=e=>{var i=e.target.result;t(i)},i.readAsDataURL(e)}),(()=>{i(new Error("Thumbnail is unavailable."))}),s)}))}};const tC=Autodesk.Viewing,iC=tC.Private,nC={BimWalk:"Autodesk.BimWalk",Bookmarks:"Autodesk.AEC.CanvasBookmarkExtension",Levels:"Autodesk.AEC.LevelsExtension",CrossFade:"Autodesk.CrossFadeEffects",Hyperlinks:"Autodesk.AEC.HyperlinkExtension",Minimap:"Autodesk.AEC.Minimap3DExtension",DropMe:"Autodesk.AEC.DropMeExtension",ZoomWindow:"Autodesk.Viewing.ZoomWindow",FusionOrbit:"Autodesk.Viewing.FusionOrbit",Disciplines:"Autodesk.AEC.DisciplinesExtension",DiffTool:"Autodesk.DiffTool",ModelStructure:"Autodesk.ModelStructure",ModelAlignment:"Autodesk.ModelAlignment",SheetAlignment:"Autodesk.SheetAlignment",ModelSheetTransition:"Autodesk.ModelSheetTransition"},rC={ALIGNMENT_SERVICE_FAILED:"alignmentServiceFailure",ENVIRONMENT_CHANGED:"environmentChanged"},oC={LocalStorage:()=>new Autodesk.ModelAlignmentService.AlignmentServiceLS},sC=[nC.ModelAlignment,nC.SheetAlignment],aC=e=>{return e instanceof tC.BubbleNode?e.getModelKey():e instanceof tC.Model?null===(t=e.getDocumentNode())||void 0===t?void 0:t.getModelKey():"string"==typeof e?e:void console.error("makeKey: Input must be key, model, or BubbleNode");var t},lC=e=>isFinite(e.x)&&isFinite(e.y)&&isFinite(e.z),cC=e=>{let t=e.getUpVector();return t&&(new THREE.Vector3).fromArray(t)},uC=e=>lC(e.position)&&lC(e.target)&&lC(e.up)&&isFinite(e.orthoScale),hC=(e,t,i)=>{let n=0;const r=new THREE.Vector3;for(let o=0;o<e.length;o++){const s=e[o].getBoundingBox();if(i.intersectsBox(s)===Autodesk.Viewing.Private.FrustumIntersector.OUTSIDE)continue;const a=s.getSize(r).length;s.distanceToPoint(t)>50*a||n++}return n},dC={enabled:!1,diffBubbles:void 0,primaryBubbles:void 0,diffBubbleLabel:void 0,primaryBubbleLabel:void 0,progressCallback:void 0,supportBubbles:void 0,refNames:void 0,customCompute:void 0},fC=(e,t)=>{if(!e)return;let i=e.getVisibleModels();i=i.filter((e=>{return t=e.getBoundingBox(),lC(t.min)&&lC(t.max);var t}));let n,r,o,s,a=e.impl.camera.clone(),l=new Autodesk.Viewing.Private.FrustumIntersector;const c=new THREE.Vector3;for(let e=0;e<i.length;e++){const t=i[e];n||(n=cC(t));const u=t.getDefaultCamera();if(!u||!uC(u))continue;const h=t.getBoundingBox();a.position.copy(u.position),a.target.copy(u.target),a.up.copy(u.up),a.isPerspective=u.isPerspective,a.near=h.distanceToPoint(a.position),a.far=a.near+h.getSize(c).length,a.updateMatrixWorld(),a.updateProjectionMatrix(),l.reset(a);const d=hC(i,u.position,l);(!r||d>=o)&&(r=u,o=d,s=t)}r&&(r.pivot=r.target,r.worldup=n,r.fov=45,t&&t(r,s),e.autocam.sync(r),e.autocam.setHomeViewFrom(r))};class pC{constructor(e){this.color=e,this.enabled=!0,this.active=!1}setEnabled(e,t){t!==this.enabled&&(this.enabled=t,this.active&&!t?(e.clearThemingColors(),this.active=!1):this.update(e))}update(e){if(this.active||!this.enabled)return;const t=e.myData.fragments.fragId2dbId;for(let i=0;i<t.length;i++){const n=t[i];e.setThemingColor(n,this.color)}this.active=!0}}const mC=new Set;class gC{constructor(){this.globalOffset=void 0,this.refPoint=void 0,this.modelItems={},this.resetOnNextModelAdd=!0,this.resetTriggeringBubble=null,this.memTracker=null,this.cameraInitialized=!1,this.is3D=void 0,this.pendingCamera=null,this.extensionLoaded={},this.loadersInProgress={},this.diff={...dC},this.modelIsGhosted={},this.diffCache=[],this.onDiffDone=void 0,this.waitForFirstModel=!1,this.loadPendingPromises={},this.onLoad=[],this.onUnload=[],this.modelThemingStates={},tC.getGlobal().LMV_MAIN_VIEW=this,this.pendingAlignmentFetches=[],Autodesk.Viewing.EventDispatcher.prototype.apply(this)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.useConsolidation=void 0===t.useConsolidation||t.useConsolidation,this.initViewerInstance(e,t),this.memTracker=new tC.ModelMemoryTracker(this.viewer,t.memoryLimit),this.viewer.impl.showTransparencyWhenMoving(),t.useDynamicGlobalOffset&&(this.dynamicGlobalOffset=new Yv(this.viewer)),this.options=t,this._registerLmvEventListeners(),this._loadExtensions()}initViewerInstance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=t.viewerClass||(t.headlessViewer?tC.Viewer3D:tC.GuiViewer3D);t.viewerConfig&&(t.viewerConfig.disabledExtensions||={},t.viewerConfig.disabledExtensions.hyperlink=!0),t.multiViewerFactory?this.viewer=t.multiViewerFactory.createViewer(e,t.viewerConfig,i):this.viewer=new i(e,t.viewerConfig),this.viewer.start(void 0,void 0,void 0,void 0,t.viewerStartOptions),t.propagateInputEventTypes&&(this.viewer.toolController.propagateInputEventTypes=t.propagateInputEventTypes,this.viewer.canvas.style.outline="none")}destroy(){var e;this.dynamicGlobalOffset=null,this.memTracker=null,this.modelItems=null,null===(e=this.viewer)||void 0===e||e.finish(),this.viewer=null,tC.getGlobal().LMV_MAIN_VIEW=null}_onError(){console.error(...arguments)}reset(){this.hideAll(),this.pendingCamera=null,this.cameraInitialized=!1,this.resetOnNextModelAdd=!0,this._stopActiveTools(),this._unloadDiffTool(!0),this.refPoint=void 0,this.loadersInProgress={}}getModel(e){const t=this._getItem(e);return t&&t.model}getModelAndWait(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((i=>{const n=()=>{const t=this.getModel(e);if(t)return this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,n),this.onLoad.splice(this.onLoad.indexOf(n),1),i(t)};if(!(t&&!this.isVisible(e))){const t=this.getModel(e);if(t)return i(t)}this.viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,n),this.onLoad.push(n)}))}isEmpty(){return!this.getVisibleNodes().length}_initForEnvironmentChange(e,t){if(this.areAllNodes2D()&&e.is3D()){let i;if(this.is3D=t,!t){const t=e=>e.visible&&e.node&&e.node.is2D();i=Object.values(this.modelItems).filter(t)[0],e=i.node}this._updateExtensions(e),this._updateRefPoint(e),t?(this.resetOnNextModelAdd=!0,this.resetTriggeringBubble=e):i.model&&(this._resetOnModeSwitch(i.model),this.viewer.impl.setUp2DMode(i.model,!1),this.viewer.getExtension("Autodesk.ViewCubeUi",(e=>e.displayViewCube(!1,!1)))),this.fireEvent({type:rC.ENVIRONMENT_CHANGED,is3D:this.is3D})}}_needsReset(e){return!!this.resetOnNextModelAdd&&(!this.resetTriggeringBubble||this.resetTriggeringBubble===e)}async show(e,t){this.isEmpty()?this._initForFirstViewable(e):this._initForEnvironmentChange(e,!0);const i=e.getModelKey();let n,r=this.getModel(i);var o;r?(this.viewer.updateViewerStateForPdfReload(e),this.modelItems[i].visible=!0,this._showModel(r),n=Promise.resolve(r)):(n=null===(o=this.modelItems[i])||void 0===o?void 0:o.loadingPromise,n||(n=this.load(e,t)),this.modelItems[i].visible=!0);return this._updateModelTimestamps(),await this._consolidateVisibleModels(),n}hide(e){let t=this._getItem(e);t&&(!this.options.unloadUnfinishedModels||t.model&&t.model.isLoadDone()?t.model&&this.viewer.hideModel(t.model.id):this.unload(t.node),t.visible=!1,fC(this.viewer,this.options.cameraValidator),this._updateUpVector(),this._cleanupModels(),this._initForEnvironmentChange(t.node,!1))}isVisible(e){const t=this._getItem(e);return t&&t.visible}hideAll(){for(let e in this.modelItems)this.hide(e)}getVisibleNodes(){let e=[];for(let t in this.modelItems){let i=this.modelItems[t];i.visible&&e.push(i.node)}return e}areAllNodes2D(){const e=this.getVisibleNodes();return!!e.length&&e.every((e=>!(e instanceof Autodesk.Viewing.BubbleNode)||e.is2D()))}isOtgManifestMissing(e){if(e.is2D())return!1;let t=e.getOtgGraphicsNode();if(t&&!t.error)return!1;if(t?this._onError(`Otg translation failed for viewable '${e.name()}'. Error:`,t.error):this._onError(`Otg node missing for viewable '${e.name()}'.`),this.onViewerNotification){const t=tC.i18n.t("Model translation failed for view '%(viewableName)'",{viewableName:e.name()});this.onViewerNotification("error",t)}return!0}load(e){var t,i;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=aC(e);let o=this.modelItems[r];if(o||(o={model:null,node:e,visible:!1,url:null,loadingPromise:null,error:!1},this.modelItems[r]=o),o.loadingPromise)return o.loadingPromise;if(o.model)return Promise.resolve(o.model);if(this.options.disableSvf&&this.isOtgManifestMissing(e))return o.error=!0,Promise.reject("OTG manifest missing");if(o.error)return Promise.reject("Model load failed already");if(e.is3D()){if(this.waitForFirstModel)return new Promise(((e,t)=>{this.loadPendingPromises[r]={resolve:e,reject:t}}));this.options.ignoreGlobalOffset||this.globalOffset||(this.waitForFirstModel=!0)}let s=e.getRootNode().getDocument();const a={globalOffset:this.globalOffset,applyRefPoint:!0,applyScaling:this.options.viewerUnits,isAEC:!0,loadAsHidden:!0,bubbleNode:e,disablePrecomputedNodeBoxes:!0,preserveView:!0,onFragmentListLoadProgress:()=>this._updateDiffLoadProgress(),disable3DModelLayers:!0,keepCurrentModels:!0,headlessViewer:this.options.headlessViewer,leafletOptions:{fitPaperSize:!0}},l=this._onModelLoaded.bind(this),c=t=>this._onModelLoadFailed(e,t),u=null===(t=(i=this.options).getCustomLoadOptions)||void 0===t?void 0:t.call(i,e);return u&&Object.assign(a,u),n&&Object.assign(a,n),a.bvhOptions=tC.Viewer3D._getDefaultBVHOptions(Object.assign({useConsolidation:!0},a)),a.useConsolidation=!1,o.loadingPromise=new Promise(((t,i)=>{this._applyAlignmentService(e,a).then((()=>(this.viewer||i(),this.viewer.loadDocumentNode(s,e,a)))).then((e=>{this.viewer||i(),l(e),t(e)})).catch((e=>{c(e),i(e)}))})),o.loadingPromise}unloadUnderlayRaster(e){const t=this.viewer.getUnderlayRaster(e);t&&this.viewer.unloadModel(t)}unload(e){this.unloadUnderlayRaster(e),this.viewer.unloadDocumentNode(e);const t=this._getItem(e);t&&(t.loadingPromise&&this._onModelLoadEnded(t),t.model&&delete this.loadersInProgress[t.model.id]);let i=aC(e);delete this.modelItems[i];const n=this.modelThemingStates[i];n&&(n.active=!1),this.onUnload.forEach((t=>t(e)))}unloadAll(e){let t=Object.keys(this.modelItems).slice();for(var i=0;i<t.length;i++){let n=t[i],r=this.modelItems[n];e&&!e(r)||this.unload(r.node)}}setCameraGlobal(e){this.pendingCamera={position:e.position&&(new THREE.Vector3).copy(e.position),target:e.target&&(new THREE.Vector3).copy(e.target),up:e.up&&(new THREE.Vector3).copy(e.up),fov:e.fov,isPerspective:e.isPerspective,ignoreGlobalOffset:e.ignoreGlobalOffset},this._applyPendingCameraWhenReady()}setCamera(e){this.viewer.impl.setViewFromCamera(e,!0),this.cameraInitialized=!0}startBimWalk(){this.bimWalkStartPending=!0,this._startBimWalkWhenReady()}stopBimWalk(){let e=this.viewer.getExtension(nC.BimWalk);e&&e.isActive()&&e.deactivate(),this.bimWalkStartPending=!1}isBimWalkActive(){let e=this.viewer.getExtension("Autodesk.BimWalk");return e&&e.activeStatus||this.bimWalkStartPending}switchView(e,t){return this.reset(),this.setNodes(e,t)}setNodes(e,t){e=(e=e||[])instanceof tC.BubbleNode?[e]:e,this.fetchAlignmentsForNodes(e);const i=e.filter((e=>!this.isVisible(e)));let n={};e.forEach((e=>{n[e.getModelKey()]=!0}));this.getVisibleNodes().filter((e=>void 0===n[e.getModelKey()])).forEach((e=>{this.hide(e)}));const r=i.map((e=>this.show(e)));return this._setDiff(t),Promise.all(r)}getFloorSelector(){return this.levelsExtension&&this.levelsExtension.floorSelector}setBookmarks(e){this.bookmarks=e,this._updateBookmarks()}isLoadDone(){for(let e in this.modelItems){const t=this.modelItems[e],i=t&&t.model,n=!i&&!t.error,r=i&&!i.isLoadDone(),o=i&&i.getPropertyDb()&&!i.getPropertyDb().isLoadDone(),s=iC.TextureLoader.requestsInProgress()>0;if(n||r||o||s)return!1}return!0}waitForLoadDone(){return new Promise((e=>{this.isLoadDone()&&e();const t=()=>{this.isLoadDone()&&(this.viewer.removeEventListener(tC.GEOMETRY_LOADED_EVENT,t),this.viewer.removeEventListener(tC.OBJECT_TREE_CREATED_EVENT,t),this.viewer.removeEventListener(tC.TEXTURES_LOADED_EVENT,t),this.onUnload.splice(this.onUnload.indexOf(t),1),e())};this.viewer.addEventListener(tC.GEOMETRY_LOADED_EVENT,t),this.viewer.addEventListener(tC.OBJECT_TREE_CREATED_EVENT,t),this.viewer.addEventListener(tC.TEXTURES_LOADED_EVENT,t),this.onUnload.push(t)}))}setAlignmentService(e){this.alignmentService=e,sC.forEach((e=>this._connectModelAlignment(e)))}async fetchAlignments(e){if(!this.isUsingAlignmentService())return;const t=(async()=>{const t=await this.getAlignmentService();await t.fetchItems(e)})();return this.pendingAlignmentFetches.push(t),await t}fetchAlignmentsForNodes(e){const t=null==e?void 0:e.filter((e=>e.is3D())),i=null==t?void 0:t.map((e=>e.getRootNode().urn()));this.fetchAlignments(i)}static findDiffSupportModel(e){if(!e.is2D())return null;const t=e.data.phaseNames,i=Array.isArray(t)?t[0]:t;return i?e.getMasterView(i):(console.warn(`A sheet node must have a phase name. Missing for sheet: ${e.name}`),null)}static findDiffSupportModels(e){e.supportBubbles.diff=gC.findDiffSupportModel(e.diffBubbles[0]),e.supportBubbles.primary=gC.findDiffSupportModel(e.primaryBubbles[0])}updateHomeCamera(){fC(this.viewer,this.options.cameraValidator)}_setDiff(e){if(e){Object.assign(this.diff,e,{enabled:!0});const t=e.supportBubbles;if(t)if(t.autoDetect&&gC.findDiffSupportModels(e),t.diff&&t.primary)this.load(t.primary),this.load(t.diff);else{const t=e.diffBubbles&&e.diffBubbles[0];t&&t.is2D()&&console.warn("Could not find support models for 2D diff."),this.diff.supportBubbles=null}!e.empty&&e.progressCallback&&this._signalDiffLoadProgress(0,!0),this.diffStartTime=performance.now()}else Object.assign(this.diff,dC);this.diffNeedsUpdate=!0,this._updateDiff()}_updateUpVector(){let e;if(this.areAllNodes2D())e=new THREE.Vector3(0,1,0);else{const t=e=>e.visible&&e.node&&e.node.is3D(),i=Object.values(this.modelItems).filter(t)[0];e=i&&i.model?cC(i.model):new THREE.Vector3(0,0,1)}this.viewer.navigation.setWorldUpVector(e,!1,!0)}_showModel(e){if(e.is3d()&&!e.hasGeometry()){const t=e.getDocumentNode().getRootNode().children[0].name();return void console.warn("Ignored model with empty geometry: ",t)}this.viewer.showModel(e.id,!0),fC(this.viewer,this.options.cameraValidator),this._updateUpVector()}_resetOnModeSwitch(e){this.viewer.getExtension(nC.ZoomWindow)&&this.viewer.unloadExtension(nC.ZoomWindow),this.options.headlessViewer||this.viewer.createUI(e,!0);const t=this.viewer.setNavigationLock(!1);this.viewer.activateDefaultNavigationTools(!this.is3D),this.viewer.setNavigationLock(t),this.viewer.navigation.setIs2D(!this.is3D),this._loadExtension(nC.ZoomWindow).catch((e=>this._onError(e))),this._startBimWalkWhenReady()}_onModelAdded(e){const t=e.model;if(this.cameraInitialized||this._initCamera(t),t.getData().underlayRaster)return;t.is3d()&&this.options.useDynamicGlobalOffset&&(t.setGlobalOffset(this.viewer.impl.camera.globalOffset),this.viewer.impl.onModelTransformChanged(t));const i=e.model.getDocumentNode();if(this._needsReset(i)&&(this.resetTriggeringBubble=null,this.resetOnNextModelAdd=!1,this._resetOnModeSwitch(t)),(e=>{const t=e.getData(),i=t.loadOptions.bubbleNode;if(e.is3d()&&t.metadata.stats&&!t.metadata.stats.num_fragments){const e=i.name(),t=i.getRootNode().children[0].name();console.warn(`Empty View "${e}" in model "${t}".`)}})(t),i){const e=i.getModelKey();delete this.modelIsGhosted[e],this._updateGhosting()}}async _onGeometryLoaded(e){await this._consolidateVisibleModels(),this.viewer&&(this._updateDiff(),this.loadersInProgress[e.model.id]=100)}_onExtensionLoaded(e){const t=e.extensionId;this._startBimWalkWhenReady(),t===nC.Levels&&(this.levelsExtension=this.viewer.getExtension(nC.Levels)),t===nC.Bookmarks&&this._updateBookmarks(),sC.includes(t)&&this.alignmentService&&this._connectModelAlignment(t)}_registerLmvEventListeners(){this.viewer.addEventListener(tC.GEOMETRY_LOADED_EVENT,this._onGeometryLoaded.bind(this)),this.viewer.addEventListener(tC.MODEL_ADDED_EVENT,this._onModelAdded.bind(this)),this.viewer.addEventListener(tC.EXTENSION_LOADED_EVENT,this._onExtensionLoaded.bind(this)),this.viewer.addEventListener(tC.PROGRESS_UPDATE_EVENT,this._onProgressUpdate.bind(this)),this.viewer.addEventListener(tC.MODEL_ROOT_LOADED_EVENT,this._updateDiff.bind(this))}async _consolidateVisibleModels(){if(this._cleanupModels(),F()&&!this.viewer.impl.useDeferredConsolidation)return;let e=fe("useConsolidation");if("false"===e||!1===this.options.useConsolidation&&"true"!==e)return;if(this.viewer.impl.isWebGPU()&&!Ji)return t="Consolidation is currently not supported for WebGPU",void(mC.has(t)||(console.warn(t),mC.add(t)));var t;const i=this.viewer.getVisibleModels();for(let e=0;e<i.length;e++){const t=i[e];if(!Ji&&this.memTracker.memoryExceeded())return void iC.logger.info("Memory limit exceeded. Skipping consolidation.");if(!(t&&t.isLoadDone()))return;if(t.is2d()||t.isSceneBuilder())return;if(t.isConsolidating()&&(await t.getConsolidationPromise(),!this.viewer))return;if(!t.isConsolidated()){if(!Gg(t)&&(await this.viewer.impl.consolidateModel(t),!this.viewer))return;this._cleanupModels()}}}_cleanupModels(){this._updateModelTimestamps();this.memTracker.cleanup((e=>{const t=e.getDocumentNode(),i=this._getItem(t);i&&i.visible||this.unload(t)}))}_updateModelTimestamps(){let e=this.viewer.getVisibleModels().slice();const t=this._getDiffSupportModels();this.diff.enabled&&t&&(t.diff&&e.push(t.diff),t.primary&&e.push(t.primary)),this.memTracker.updateModelTimestamps(e)}_stopActiveTools(){const e=this.viewer.getExtension("Autodesk.Section");e&&e.isActive()&&e.enableSectionTool(!1),this.stopBimWalk();const t=!this.options.headlessViewer&&this.viewer.getPropertyPanel(!1);t&&t.isVisible()&&t.setVisible(!1)}_onModelLoaded(e){let t=this._getItem(e);t&&(e.is3d()&&(this.options.useDynamicGlobalOffset?e.setGlobalOffset(this.viewer.impl.camera.globalOffset):this.waitForFirstModel&&!this.options.ignoreGlobalOffset&&(this.globalOffset=(new THREE.Vector3).copy(e.myData.globalOffset),this._onGlobalOffsetChanged())),t.model=e,t.visible&&this._showModel(t.model),this._updateModelTimestamps(),this._updateDiffLoadProgress(),this._updateModelTheming(e),this._onModelLoadEnded(t))}_onModelLoadFailed(e,t){this._onError(`Failed to load model: ${e.name()}. Error code: ${t}`);const i=this._getItem(e);i&&(i.error=!0,this._onModelLoadEnded(i))}_onModelLoadEnded(e){e.loadingPromise=null;const t=e.node;t.is3D()&&this.waitForFirstModel&&(this.waitForFirstModel=!1,Object.keys(this.loadPendingPromises).forEach((e=>{var t;const i=null===(t=this.modelItems[e])||void 0===t?void 0:t.node;if(!i)return;const{resolve:n,reject:r}=this.loadPendingPromises[e];this.load(i).then((e=>{n(e)})).catch((e=>{r(e)}))})),this.loadPendingPromises={}),this.onLoad.forEach((e=>e(t)))}_initCamera(e,t){this.viewer.impl.setViewFromFile(e,!t),this.options.cameraValidator&&this.options.cameraValidator(this.viewer.impl.camera,e),this.viewer.impl.controls.recordHomeView(),this.cameraInitialized=!0,this.pendingCamera&&this._applyPendingCameraWhenReady()}_getItem(e){var t;let i=aC(e);return null===(t=this.modelItems)||void 0===t?void 0:t[i]}_updateRefPoint(e){if(this.options.useDynamicGlobalOffset)return;if(!(this.isEmpty()||this.areAllNodes2D())||!e.is3D()||this.options.ignoreGlobalOffset)return;const t=e.getAecModelData();if(!t)return;let i=t.refPointTransformation;if(!i)return;const n={x:i[9],y:i[10],z:0};if(this.isUsingAlignmentService()){var r;const t=e.getRootNode().urn(),i=null===(r=this.alignmentService)||void 0===r?void 0:r.getTransform(t);if(void 0===i)return;i&&(n.x=i.elements[12],n.y=i.elements[13])}if(this.refPoint=n,this.options.viewerUnits){const e=Autodesk.Viewing.Private.convertUnits("ft",this.options.viewerUnits,1,1);this.refPoint.x*=e,this.refPoint.y*=e,this.refPoint.z*=e}const o=this.globalOffset&&THREE.Vector3.prototype.distanceToSquared.call(this.refPoint,this.globalOffset);(!this.globalOffset||o>4e6)&&(this.globalOffset=(new THREE.Vector3).copy(this.refPoint),this.unloadAll((e=>e.model&&e.model.is3d())),this._onGlobalOffsetChanged())}_onGlobalOffsetChanged(){const e=this.viewer.getExtension(nC.Bookmarks);e&&e.resetGlobalOffset(this.globalOffset)}_getDefaultExtensions(){return[{name:nC.CrossFade,getLoadingCondition:()=>!tC.isMobileDevice()},{name:nC.Levels,getOptions:()=>this.viewer.config},{name:nC.ModelStructure,getOptions:()=>this.viewer.config},{name:nC.Hyperlinks,getOptions:()=>({loadViewableCb:(e,t)=>{this.onHyperlink?this.onHyperlink(e,t):this.switchView([e])}})},{name:nC.Minimap,getLoadingCondition:()=>!this.options.disableMinimap,getOptions:()=>({trackUsage:this._trackMinimapUsage?this._trackMinimapUsage.bind(this):void 0})},{name:nC.Bookmarks,getLoadingCondition:()=>this.is3D,getOptions:()=>({globalOffset:this.globalOffset,onBookmark:(e,t)=>{this.onBookmark?this.onBookmark(e,t):this.switchView([e]),t.isPerspective&&this.startBimWalk()},clusterfck:this.options.clusterfck,clusteringThreshold:110})},{name:nC.DropMe,getLoadingCondition:()=>!1===this.is3D,getOptions:()=>({enableGuidance:!0,onDrop:this._handleDropMe.bind(this),getTransformForNode:this._getTransformForNode.bind(this),getMain3DView:this._findMain3DView.bind(this),onHandleViewIn3D:this._handleViewIn3D.bind(this)})}]}async _loadExtensions(){this.extensions=this.options.extensions||this._getDefaultExtensions();const e=[];return this.extensions.forEach((t=>{t.getLoadingCondition&&!t.getLoadingCondition(this)||(e.push(this._loadExtension(t.name,t.getOptions&&t.getOptions(this),t.onLoadedCB)),this.extensionLoaded[t.name]=!0)})),Promise.all(e)}async _loadExtension(e,t,i){if(this.viewer.impl.isWebGPU()&&["Autodesk.CrossFadeEffects","Autodesk.SheetAlignment"].includes(e))return void console.warn("Skipped extension because it does not support WebGPU yet: ",e);const n=this.options.extensionOptions,r=n&&n[e],o=Object.assign({},t,r),s=this.viewer.loadExtension(e,o);return i&&s.then((e=>{i(this,e)})).catch((e=>{i(this,null,e)})),s}_updateExtensions(e){const t=(e,t,i,n,r)=>{const o=this.extensionLoaded[e];!o&&i?this._loadExtension(e,t,n).catch((e=>this._onError(e))):o&&!i&&(r&&r(this),this.viewer.unloadExtension(e)),this.extensionLoaded[e]=i};this.extensions.forEach((i=>{i.getLoadingCondition&&t(i.name,i.getOptions&&i.getOptions(this),i.getLoadingCondition(this,e),i.onLoadedCB,i.onBeforeUnloadCB)}))}_initForFirstViewable(e){this.is3D!==e.is3D()&&(this.resetOnNextModelAdd||(this.reset(),this.resetTriggeringBubble=e),this.is3D=e.is3D()),this._updateExtensions(e),this._updateRefPoint(e)}_updateBookmarks(){let e=this.viewer.getExtension(nC.Bookmarks);e&&e.resetBookmarks(this.bookmarks)}_applyPendingCameraWhenReady(){if(!this.cameraInitialized)return;let e=this.pendingCamera;this.pendingCamera=null;let t=this.viewer.impl.camera;e.position&&t.position.copy(e.position),e.target&&t.target.copy(e.target),e.up&&t.up.copy(e.up),e.fov&&(t.fov=e.fov),void 0!==e.isPerspective&&(t.isPerspective=e.isPerspective);const i=this.globalOffset||this.viewer.model.getData().globalOffset;!this.is3D||this.options.ignoreGlobalOffset||e.ignoreGlobalOffset||(t.position.sub(i),t.target.sub(i)),this.viewer.impl.syncCamera()}_findMain3DView(e){const t=e.getMasterViews();if(t[0])return t[0];const i=null==e?void 0:e.getRootNode();if(!i)return;const n=null==i?void 0:i.search(tC.BubbleNode.MODEL_NODE),r=n.filter((e=>e.name().toLowerCase().startsWith("{3d")))[0];return r||n[0]}_handleDropMe(e,t,i,n,r){if(this.onDrop)this.onDrop(e,t,i,n);else if(n){if(this.switchView(n),e&&t){let i={position:e,target:e.clone().add(t),isPerspective:!0,ignoreGlobalOffset:r};this.setCameraGlobal(i)}}else console.warn("DropMe handler: Document does not contain a 3D view to switch to")}async _handleViewIn3D(e,t,i,n){if(i&&!this.options.ignoreGlobalOffset){const i=this.globalOffset||this.viewer.model.getData().globalOffset;e=e.clone().add(i),t=t.clone().add(i)}let r={position:e,target:t,isPerspective:!0};this.setCameraGlobal(r);const o=await this.viewer.getExtensionAsync(nC.BimWalk);o.activate(),o.disableGravityUntilNextMove(),n&&n()}_startBimWalkWhenReady(){if(!this.bimWalkStartPending)return;let e=!this.resetOnNextModelAdd,t=this.viewer.getExtension(nC.BimWalk),i=this.viewer.getExtension(nC.FusionOrbit);e&&t&&i&&(t.activate(),this.bimWalkStartPending=!1)}_unloadDiffTool(e){this.viewer.getExtension(nC.DiffTool)&&(e&&(this.diffCache.length=0),this.viewer.unloadExtension(nC.DiffTool))}_onProgressUpdate(e){e.model&&e.state===tC.ProgressState.LOADING&&(this.loadersInProgress[e.model.id]=e.percent,this._updateDiffLoadProgress())}_getDiffSupportModels(){if(this.diff.supportBubbles)return{diff:this.getModel(this.diff.supportBubbles.diff),primary:this.getModel(this.diff.supportBubbles.primary)}}_diffSupportModelsReady(){const e=this._getDiffSupportModels(),t=e.diff&&e.diff.isLoadDone(),i=e.primary&&e.primary.isLoadDone();return t&&i}_updateGhosting(){let e={};this.diff.enabled&&this.diffBubbles&&(e=this.diffBubbles.forEach((t=>e[t.getModelKey()])));for(let t in this.modelItems){let i=this.getModel(t);if(!i)continue;let n=this.diff.enabled&&!e[t];n!=!!this.modelIsGhosted[t]&&(i.setAllVisibility(!n),n?this.modelIsGhosted[t]=!0:delete this.modelIsGhosted[t])}this.viewer.refresh(!0)}getModels(e){return e.map((e=>this.getModel(e)))}setModelTheming(e){e=e||{};const t=this.modelThemingStates;this.modelThemingStates={};for(let i in e){let n=t[i];const r=e[i],o=this.getModel(i);if(n){!n.color.equals(r)&&(n.color.copy(r),n.active=!1)}else n=new pC(r);this.modelThemingStates[i]=n,o&&this._updateModelTheming(o)}for(let i in t){const n=t[i],r=!e[i],o=this.getModel(i);r&&n.active&&o&&this.viewer.clearThemingColors(o)}}_signalDiffLoadProgress(e,t){if(t||e!==this._lastDiffLoadPercent){const t=tC.i18n.t("Loading Model for Change Visualization");this.diff.progressCallback(e,t),this._lastDiffLoadPercent=e}}_updateDiffLoadProgress(){if(!this.diffNeedsUpdate||!this.diff.enabled||this.diff.empty||!this.diff.progressCallback)return;const e=this.getModels(this.diff.diffBubbles),t=this.getModels(this.diff.primaryBubbles),i=e.concat(t),n=this._getDiffSupportModels();n&&i.push(n.diff,n.primary);const r=i.filter(Boolean).length;if(r<i.length){const e=Math.floor(10*r/i.length);return void this._signalDiffLoadProgress(e)}if(!this.is3D){const e=(e,t)=>e+(0|this.loadersInProgress[t.id]),t=i.reduce(e,0),n=100*i.length,r=10+Math.floor(90*t/n);return void this._signalDiffLoadProgress(r)}const o=i.reduce(((e,t)=>e+t.getData().fragsLoadedNoGeom),0),s=i.reduce(((e,t)=>e+t.getData().metadata.stats.num_fragments),0),a=10+Math.floor(90*o/s);this._signalDiffLoadProgress(a)}_updateDiff(){if(!this.diffNeedsUpdate)return;if(this._updateGhosting(),this._updateDiffLoadProgress(),!this.diff.enabled)return this._unloadDiffTool(),void this._updateAllModelTheming();const e=this.getModels(this.diff.diffBubbles),t=this.getModels(this.diff.primaryBubbles);if(this.diff.customCompute){let i=t,n=e;const r=[this.diff.customCompute].flat();for(const e of r)[i,n]=e.init(i,n)}for(let i=0;i<e.length;i++){const n=e[i],r=t[i],o=n instanceof tC.Model&&(n.isOTG()||n.isLoadDone()),s=r instanceof tC.Model&&(r.isOTG()||r.isLoadDone());if(!o||!s)return;if(!n.getPropertyDb()||!r.getPropertyDb())return}let i;if(!!this.diff.supportBubbles){if(!this._diffSupportModelsReady())return;i=this._getDiffSupportModels()}const n=performance.now()-this.diffStartTime;console.log("Time for loading diff models: ",n),this._updateAllModelTheming(),this._setDiffModels(e,t,i)}_setDiffModels(e,t,i){if(this.diffNeedsUpdate=!1,!t.length)return void this._unloadDiffTool();const n=this.viewer.getExtension(nC.DiffTool);if(n)n.replaceModels(e,t,i);else{const n={diffModels:e,primaryModels:t,supportModels:i,availableDiffModes:["overlay","sidebyside"],diffMode:"overlay",customCompute:this.diff.customCompute,versionA:this.diff.primaryBubbleLabel,versionB:this.diff.diffBubbleLabel,refNames:this.diff.refNames,mimeType:"application/vnd.autodesk.revit",hotReload:!0,diffCache:this.diffCache,useSplitScreenExtension:!0,showDetailsSection:!0,progress:(e,t)=>{this.diff.progressCallback&&(t!==Autodesk.DiffTool.DIFFTOOL_PROGRESS_STATES.LoadingPropDb?(100===e&&this.onDiffDone&&this.onDiffDone(),this.diff.progressCallback(e,tC.i18n.t("Computing change visualization"))):this.diff.progressCallback(e,tC.i18n.t("Loading element properties")))},excludeFromDiff:(e,t)=>this.levelsExtension&&!this.levelsExtension.floorSelector.isVisible(e,t),setNodesOff:e=>{const t=this.levelsExtension;t&&t.floorSelector._floorSelectorFilter.reApplyFilter(e)},hideModeSwitchButton:!0,externalUi:this.diff.externalUi,attachDetachViewerEventHandlers:this.diff.attachDetachViewerEventHandlers,onDiffModeChanged:this.diff.onDiffModeChanged,onInitialized:this.diff.onInitialized};this._loadExtension(nC.DiffTool,n).catch((e=>this._onError(e)))}}_updateModelTheming(e){const t=aC(e),i=this.modelThemingStates[t];if(!i)return;const n=!this.viewer.getExtension(nC.DiffTool);i.setEnabled(e,n),i.update(e),this.viewer.impl.invalidate(!0)}_updateAllModelTheming(){for(let e in this.modelItems){let t=this.getModel(e);t&&this._updateModelTheming(t)}}async getAlignmentService(){return this.alignmentService||(this._alignmentServicePromise?await this._alignmentServicePromise:(this._alignmentServicePromise=this._initAlignmentService(),await this._alignmentServicePromise,this._alignmentServicePromise=null)),this.alignmentService}isUsingAlignmentService(){return this.options.createModelAlignmentService||this.alignmentService}async _initAlignmentService(){const e=this.options.createModelAlignmentService;if(!e)return;await this.viewer.loadExtension("Autodesk.ModelAlignmentService").then((async()=>{const t=await e();this.viewer&&this.setAlignmentService(t)}))}async _getTransformForNode(e){const t=await this.getAlignmentService();if(!t)return;await Promise.all(this.pendingAlignmentFetches);const i=e.getRootNode().urn(),n=e.is2D()?e.name():void 0;return await t.loadTransform(i,n)}async _applyAlignmentService(e,t){if(e.is2D())return;if(this.alignmentServiceFailed)return;const i=await this._getTransformForNode(e);this._checkAlignmentService()&&(!function(){iC.analytics.track(...arguments)}("viewer.modelalignment.alignment_loaded",{hasAlignmentTransform:Boolean(i)}),i&&(t.applyRefPoint=!1,t.placementTransform=i,t.applyPlacementInModelUnits=!0))}_checkAlignmentService(){if(this.alignmentServiceFailed||!this.alignmentService)return!1;if(this.alignmentService.isWorking())return!0;const e=hs.t("Failed to connect to alignment service: Model alignment support is temporarily unavaible. Models with alignment transforms may not appear correctly and alignment editing is disabled.");this.fireEvent({type:rC.ALIGNMENT_SERVICE_FAILED,message:e}),iC.logger.error("AggregatedView: Disabled alignment due to alignment service connection error."),this.alignmentServiceFailed=!0}_connectModelAlignment(e){const t=this.viewer.getExtension(e);t&&t.setAlignmentService(this.alignmentService)}}gC.ExtNames=nC,gC.AlignmentServices=oC,gC.Events=rC;const vC=e=>isFinite(e.x)&&isFinite(e.y)&&isFinite(e.z),yC=e=>{const t=e.isPerspective||isFinite(e.orthoScale);return vC(e.position)&&vC(e.target)&&vC(e.up)&&t};class bC{constructor(){this.cacheObj={}}setItem(e,t){this.cacheObj[e]=t}getItem(e){return this.cacheObj[e]}}class xC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{useLocalStorage:!0};this.aggregatedView=e,this.options=t,this.key=void 0,this.options.useLocalStorage?this.cache=Autodesk.Viewing.Private.LocalStorage:this.cache=new bC,this.unloadCb=this.saveCamera.bind(this),this.addWindowEventListener("beforeunload",this.unloadCb)}destroy(){this.unsetKey(),this.removeWindowEventListener("beforeunload",this.unloadCb)}setKey(e){this.key=e}unsetKey(){this.key=void 0}saveCamera(){if(!this.aggregatedView.cameraInitialized||!this.key)return;const e=this.aggregatedView.viewer.impl.camera;if(!yC(e))return;const t=this.aggregatedView.isBimWalkActive(),i=this.aggregatedView.is3D?this.aggregatedView.globalOffset:void 0;this.saveStartCamera(this.key,this.aggregatedView.viewer.impl.camera,t,i)}saveStartCamera(e,t,i,n,r){const o=JSON.stringify({offset:n,position:t.position,target:t.target,up:t.up,orthoScale:t.orthoScale,isPerspective:t.isPerspective,fov:t.fov,startBimWalk:i,ignoreGlobalOffset:r});this.cache.setItem(e,o)}clearItem(e){this.cache.setItem(e)}loadCamera(){if(!this.key)return!1;let e;try{const t=this.cache.getItem(this.key);e=JSON.parse(t)}catch(e){}if(!(e&&e.position&&e.target&&e.up))return!1;const t=e=>new THREE.Vector3(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z)),i={position:t(e.position),target:t(e.target),up:t(e.up),isPerspective:Boolean(e.isPerspective),fov:parseFloat(e.fov),ignoreGlobalOffset:Boolean(e.ignoreGlobalOffset)};if(e.orthoScale&&(i.orthoScale=parseFloat(e.orthoScale)),!yC(i))return!1;const n=e.offset?t(e.offset):void 0;if(n){if(!vC(n))return;i.position.add(n),i.target.add(n)}this.aggregatedView.setCameraGlobal(i),e.startBimWalk&&this.aggregatedView.startBimWalk()}}function _C(e){var t,i;const n=null===(t=e.impl)||void 0===t||null===(t=t.model)||void 0===t?void 0:t.getDocumentNode(),r=null==n||null===(i=n.search(Autodesk.Viewing.BubbleNode.LEAFLET_NODE)[0])||void 0===i?void 0:i._raw();if(!r)return null;const o={};return new Autodesk.Viewing.Document(n.getRootNode()._raw(),"").getLeafletParams(o,n,r),o}function EC(e){const t=new Autodesk.Viewing.Private.TexQuadConfig,i=_C(e);if(!i)return null;t.initFromLoadOptions(null,i);return t.getBBox()}function SC(e){const t=EC(e);if(!t)return null;return Kp.getNormalizingMatrix(null,t)}fo.call(xC.prototype);var AC={leafletToPdfWorld:function(e,t){const i=SC(e);if(!i)return null;let n;if(t.applyMatrix4(i),e.model.isLeaflet()){const t=e.model.getMetadata("page_dimensions"),i=new THREE.Box3(new THREE.Vector3,new THREE.Vector3(t.page_width,t.page_height,0));n=Kp.getNormalizingMatrix(void 0,i)}else n=Kp.getNormalizingMatrix(e.model);return t.applyMatrix4(n.invert()),t},pdfToLeafletWorld:function(e,t){const i=Kp.getNormalizingMatrix(e.model);t.applyMatrix4(i);let n=SC(e);return n?(t.applyMatrix4(n.invert()),t):null},getLeafletLoadOptions:_C,getLeafletBoundingBox:EC,getLeafletNormalizingMatrix:SC},wC={SNAP_VERTEX:0,SNAP_MIDPOINT:1,SNAP_CIRCLE_CENTER:2,SNAP_EDGE:3,SNAP_FACE:4,SNAP_CIRCULARARC:5,SNAP_CURVEDEDGE:6,SNAP_CURVEDFACE:7,RASTER_PIXEL:8,SNAP_INTERSECTION:9},CC={MEASUREMENT_DISTANCE:1,MEASUREMENT_ANGLE:2,MEASUREMENT_AREA:3,CALIBRATION:4,MEASUREMENT_CALLOUT:5,MEASUREMENT_SPOT:6,MEASUREMENT_ARC:7},TC={[CC.MEASUREMENT_DISTANCE]:"Distance",[CC.MEASUREMENT_ANGLE]:"Angle",[CC.MEASUREMENT_AREA]:"Area",[CC.CALIBRATION]:"Calibration",[CC.MEASUREMENT_CALLOUT]:"Callout",[CC.MEASUREMENT_SPOT]:"Spot",[CC.MEASUREMENT_ARC]:"Arc"};const MC=1e-4;function IC(e,t){if(!e)return null;if(e.isPerpendicular)return e.intersectPoint;switch(e.geomType){case wC.SNAP_VERTEX:case wC.RASTER_PIXEL:case wC.SNAP_MIDPOINT:case wC.SNAP_CIRCLE_CENTER:return e.getGeometry();case wC.SNAP_EDGE:var i=KC(e.getGeometry()),n=i[0].clone(),r=i[1].clone();return WC(e.intersectPoint,n,r);case wC.SNAP_FACE:return YC(e.intersectPoint,e.getGeometry().vertices[0],e.faceNormal);case wC.SNAP_CIRCULARARC:if(t&&t.model&&t.model.is2d()){var o=e.snapPoint;return e.geomType=wC.SNAP_VERTEX,e.geomVertex=o,o}return e.circularArcCenter;case wC.SNAP_CURVEDEDGE:return $C(e.intersectPoint,e.getGeometry());case wC.SNAP_CURVEDFACE:return e.intersectPoint;case wC.SNAP_INTERSECTION:return e.snapPoint;default:return null}}function PC(e,t,i,n){if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return!1;var r=IC(e,i);if(n&&i)if(t.geomType===wC.SNAP_EDGE){var o=new(v().Vector3),s=new(v().Vector3),a=t.getGeometry();if(o.subVectors(t.intersectPoint,r).normalize(),s.subVectors(a.vertices[0],a.vertices[1]).normalize(),ZC(o,s,.05))if(u=jC(r,a.vertices[0],a.vertices[1],!0))return n.onMouseMove(zC(u,i))&&n.setPerpendicular(!0),t.geomVertex=u,t.intersectPoint=u,!0}else if(t.geomType===wC.SNAP_FACE){var l=new(v().Vector3),c=t.getGeometry();if(l.subVectors(t.intersectPoint,r).normalize(),QC(t.faceNormal,l,.05)){var u=YC(r,c.vertices[0],t.faceNormal);return n.onMouseMove(zC(u,i))&&n.setPerpendicular(!0),t.geomVertex=u,t.intersectPoint=u,!0}}}function LC(e,t,i,n){i.model.is2d()&&(n.viewportIndex2d=i.model.isPdf?n.viewportIndex2d:n.viewportIndex2d||n.id,i.model.pageToModel(e,t,n.viewportIndex2d))}function RC(e,t){var i;let n;const r=e.viewportIndex2d,o=null==t||null===(i=t.model)||void 0===i||null===(i=i.getData())||void 0===i?void 0:i.viewports;var s;o&&void 0!==r&&(n=null===(s=o[r])||void 0===s?void 0:s.units);return n}function DC(e,t,i,n){if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return null;var r=IC(e,n).clone(),o=IC(t,n).clone();if(!r||!o)return null;if(qC(r,o,MC))return null;LC(r,o,n,e);const s=RC(e,n);if(i){i=UC(i);var a=r.distanceTo(o);return{distanceXYZ:kC(a,i),distanceX:kC(a=Math.abs(r.x-o.x),i),distanceY:kC(a=Math.abs(r.y-o.y),i),distanceZ:0,type:CC.MEASUREMENT_DISTANCE,units:s}}return{distanceXYZ:r.distanceTo(o),distanceX:Math.abs(r.x-o.x),distanceY:Math.abs(r.y-o.y),distanceZ:Math.abs(r.z-o.z),type:CC.MEASUREMENT_DISTANCE,units:s}}function OC(e,t){if(e.is3d())return 0;if(e.isPdf())return 0;var i=e.getMetadata("page_dimensions","page_width",null),n=e.getMetadata("page_dimensions","logical_width",null),r=e.getMetadata("page_dimensions","page_height",null),o=e.getMetadata("page_dimensions","logical_height",null);if(!(i&&n&&r&&o))return 0;var s=i/n,a=r/o,l=new(v().Vector3)(0,0,0),c=new(v().Vector3)(s,a,0);return e.pageToModel(l,c,t),l.distanceTo(c)}function BC(e,t){var i=[];for(var n in e)if(e.hasOwnProperty(n)){var r=IC(e[n],t);r&&i.push(r)}if(3!==i.length||function(e){for(var t=0;t<e.length;t++)for(var i=0;i<e.length;i++)if(t!==i&&qC(e[t],e[i],MC))return!0;return!1}(i))return null;var o=new(v().Vector3),s=new(v().Vector3);return o.subVectors(i[0],i[1]),s.subVectors(i[2],i[1]),XC(o,s)}function NC(e,t,i,n){if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return null;if(!e.circularArcRadius)return null;var r=IC(e,n).clone(),o=IC(t,n).clone();const s=e.circularArcCenter;var a=s instanceof v().Vector3?s.clone():new(v().Vector3)(s.x,s.y,s.z);if(!r||!o)return null;if(qC(r,o,MC))return 0;n.model.is2d()&&(n.model.pageToModel(r,o,e.viewportIndex2d),n.model.pageToModel(a,null,e.viewportIndex2d));var l=function(){var e=new(v().Vector3),t=new(v().Vector3);e.subVectors(r,a),t.subVectors(o,a);var i=e.length()*t.length(),n=e.dot(t);return Math.acos(n/i)*e.length()}();return i?kC(l,i=UC(i)):l}function UC(e){var t=Math.log(e)/Math.log(10),i=Math.floor(t);return 1<e/Math.pow(10,i)&&i++,Math.pow(10,i)}function kC(e,t){return Math.floor(e/t+.5)*t}function FC(e,t,i,n){switch(t){case CC.MEASUREMENT_DISTANCE:return DC(o=e[1],e[2],OC(i.model,o.viewportIndex2d),i);case CC.MEASUREMENT_ANGLE:var r=BC(e,i);return r?{angle:n&&n.angleOuter?360-r:r,type:t}:null;case CC.MEASUREMENT_AREA:return function(e,t){var i,n=[];for(var r in e)if(e.hasOwnProperty(r)){var o=IC(e[r],t);o&&n.push(o.clone())}var s=IC(e[1],t);s&&n.push(s.clone());for(var a=0;a<n.length;a+=2)t.model.pageToModel(n[a],n[a+1],e[1].viewportIndex2d);var l=0,c=0;for(a=0;a<n.length-1;a++)l+=n[a].x*n[a+1].y,c+=n[a].y*n[a+1].x;var u=Math.abs((l-c)/2);let h;const d=e[1].viewportIndex2d,f=null==t||null===(i=t.model)||void 0===i||null===(i=i.getData())||void 0===i?void 0:i.viewports;var p;return f&&Number.isInteger(d)&&(h=null===(p=f[d])||void 0===p?void 0:p.units),{area:u,type:CC.MEASUREMENT_AREA,units:h}}(e,i);case CC.MEASUREMENT_ARC:var o;return{arc:NC(o=e[1],e[2],OC(i.model,o.viewportIndex2d),i),type:t};case CC.MEASUREMENT_SPOT:{const n=IC(e[1],i);let r=n?n.clone():null;const o=i.model.getData().globalOffset;return r&&o&&r.add(o),LC(r,new(v().Vector3),i,e[1]),{spot:n,modelSpot:r,type:t,units:RC(e[1],i)}}default:return null}}function VC(e,t,i,n,r,o){var s=0,a=new(v().Vector3),l=new(v().Vector3);const c=i.vertices.length;for(var u=0;u<c;u+=3){const e=i.vertices[u],t=i.vertices[u+1],n=i.vertices[u+2];a.subVectors(t,e),l.subVectors(n,e),s+=a.length()*l.length()*Math.sin(a.angleTo(l))/2}return my(s=yy(e.model.getUnitString(),n,o,s,"square"),n?n+"^2":null,3,r)}function GC(e,t,i,n,r,o){var s=i.radius;if(s){if(e.model.is2d()){var a=i.center.clone();const n=i.vertices[0].clone();e.model.pageToModel(a,n,t.getPick(1).viewportIndex2d),s=a.distanceTo(n)}return my(s=yy(e.model.getUnitString(),n,o,s),n,3,r)}}function zC(e,t,i){var n=t.navigation.getCamera(),r=t.navigation.getScreenViewport(),o=new(v().Vector3)(e.x,e.y,e.z);return o=o.project(n),i=i||0,new(v().Vector2)(Math.round((o.x+1)/2*r.width)+i,Math.round((1-o.y)/2*r.height)+i)}function HC(e,t){var i=t.navigation.getCamera(),n=t.navigation.getScreenViewport(),r=new(v().Vector3);return r.x=e.x/n.width*2-1,r.y=-(e.y/n.height*2-1),r.z=0,r=r.unproject(i)}function WC(e,t,i){var n,r=new(v().Vector3),o=new(v().Vector3);return r.subVectors(t,e),o.subVectors(i,t),n=r.dot(o),r.subVectors(i,t),n=-n/r.dot(r),r.subVectors(i,t),r.multiplyScalar(n),r.add(t)}function jC(e,t,i,n){var r,o,s=new(v().Vector3),a=new(v().Vector3);return s.subVectors(t,e),a.subVectors(i,t),o=s.dot(a),s.subVectors(i,t),(o=-o/s.dot(s))<0?r=n?null:t:o>1?r=n?null:i:(s.subVectors(i,t),s.multiplyScalar(o),r=s.add(t)),r}function qC(e,t,i){return!(!e||!t)&&(Math.abs(e.x-t.x)<=i&&Math.abs(e.y-t.y)<=i&&Math.abs(e.z-t.z)<=i)}function KC(e){var t=[];const i=e.vertices,n=i.length;for(var r=0;r<n;++r){var o=!1;const e=i[r];for(var s=0;s<n;++s){const t=i[s];if(s!==r&&t.equals(e)){o=!0;break}}o||t.push(e)}return t.length<2&&(t[0]=i[0],t[1]=i[1]),t}function XC(e,t){return 180*e.angleTo(t)/Math.PI}function YC(e,t,i){var n=new(v().Vector3),r=i.clone(),o=new(v().Vector3);o.subVectors(e,t);var s=-r.dot(o)/r.dot(r);return n.addVectors(e,r.multiplyScalar(s)),n}function QC(e,t,i){return i=i||MC,1-Math.abs(e.dot(t))<i}function ZC(e,t,i){return i=i||MC,Math.abs(e.dot(t))<i}function $C(e,t){for(var i,n=Number.MAX_VALUE,r=0;r<t.vertices.length;r++){const s=t.vertices[r];var o=e.distanceTo(s);n>o&&(i=s,n=o)}return i}function JC(e,t){e.impl.overlayScenes[t]||e.impl.createOverlayScene(t)}function eT(e,t,i){(e.classList.contains(t)&&!i||!e.classList.contains(t)&&i)&&e.classList.toggle(t,i)}function tT(){this.clear()}tT.prototype.clear=function(){this.geomType=null,this.modelId=null,this.fragId=null,this.fragPos=null,this.snapNode=null,this.geomVertex=null,this.geomEdge=null,this.geomFace=null,this.radius=null,this.intersectPoint=null,this.faceNormal=null,this.viewportIndex2d=null,this.circularArcCenter=null,this.circularArcRadius=null,this.fromTopology=!1,this.isPerpendicular=!1,this.snapPoint=null},tT.prototype.copyTo=function(e){e.modelId=this.modelId,e.fragId=this.fragId,e.fragPos=this.fragPos,e.snapNode=this.snapNode,e.geomVertex=this.geomVertex,e.geomFace=this.geomFace,e.geomEdge=this.geomEdge,e.radius=this.radius,e.geomType=this.geomType,e.intersectPoint=this.intersectPoint,e.faceNormal=this.faceNormal,e.viewportIndex2d=this.viewportIndex2d,e.circularArcCenter=this.circularArcCenter,e.circularArcRadius=this.circularArcRadius,e.fromTopology=this.fromTopology,e.isPerpendicular=this.isPerpendicular,e.snapPoint=this.snapPoint},tT.prototype.clone=function(){var e=new tT;return this.copyTo(e),e},tT.prototype.isEmpty=function(){return!this.getGeometry()};let iT=null,nT=null,rT=null;const oT=(e,t)=>(nT=nT||new THREE.Vector3,rT=rT||new THREE.Vector3,nT.set(0,0,0),rT.set(e,0,0),nT.applyMatrix4(t),rT.applyMatrix4(t),nT.distanceTo(rT));function sT(e,t,i){this.measurementType=e,this.id=t,this.picks=[],this.closedArea=!1,this.isRestored=!1,this.options=i,this.resetMeasureValues()}function aT(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.getPriority=function(){return 0},this.register=function(){},this.deregister=function(){},this.activate=function(e,t){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}function lT(e){var t=["hottouch"],i={SHIFT:0,ALT:0,CONTROL:0},n=null,r=null,o=!1,s=!1,a=null,l=16,c=17,u=18;this.active=!1,this.getNames=function(){return t},this.getName=function(){return t[0]},this.activate=function(e){this.active=!0},this.deactivate=function(e){this.active=!1},this.isActive=function(){return this.active},this.__checkStart=function(){a&&(this.controller.distributeEvent("handleGesture",a),a=null)},this.update=function(){if(this.controller.getIsLocked())return!1;var t=e.getActiveNavigationTool(),i=!1===o&&!0===s;if(i||!0===o&&!1===s){var a=i?"worldup":"fov";if(t===a)return!1;if(t===n)return e.setActiveNavigationTool(a),n=a,this.__checkStart(),!1;r=t,e.setActiveNavigationTool(a),n=a,this.__checkStart()}else n&&(e.setActiveNavigationTool(r),n=null,r=null);return!1},this.resetKeys=function(){i.SHIFT=0,i.CONTROL=0,i.ALT=0},this.updateModifierState=function(e){i.CONTROL=e.ctrlKey?1:0,i.SHIFT=e.shiftKey?1:0,i.ALT=e.altKey?1:0},this.handleGesture=function(t){if(t===a)return!1;switch(t.type){case"drag3start":e.navigation.isActionEnabled("fov")&&(a=t,o=!0);break;case"drag3move":case"rotatemove":break;case"drag3end":o=!1;break;case"rotatestart":e.navigation.isActionEnabled("roll")&&(a=t,s=!0);break;case"rotateend":s=!1}return!1},this.handleKeyDown=function(e,t){switch(this.updateModifierState(e),t){case l:i.SHIFT=1;break;case c:i.CONTROL=1;break;case u:i.ALT=1}return!1},this.handleKeyUp=function(e,t){switch(this.updateModifierState(e),t){case l:i.SHIFT=0;break;case c:i.CONTROL=0;break;case u:i.ALT=0}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),!1},this.handleButtonUp=function(e,t){return this.updateModifierState(e),!1},this.handleMouseMove=function(e){return this.updateModifierState(e),!1},this.handleBlur=function(e){return this.resetKeys(),!1}}function cT(e){var t=.001,i=e.navigation,n=i.getCamera(),r=["fov"],o=!1,s=0,a=null,l=null,c=!1,u=0,h=-5,d=-1,f=h,p=new(v().Vector3),m=new(v().Vector3),g=new(v().Vector3),y=null;function b(e){return e<0&&e>-3?-3:e>0&&e<3?3:e}this.getNames=function(){return r},this.getName=function(){return r[0]},this.activate=function(e){u=0},this.deactivate=function(e){f=h},this.getCursor=function(){return 0!==u&&f===h?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(e){var i=m.x-p.x,n=m.y-p.y,r=m.z-p.z;Math.abs(i)<t&&(i=0),Math.abs(n)<t&&(n=0),Math.abs(r)<t&&(r=0),e.set(i,n,r)},this.stepMotionDelta=function(e,t){t?(p.x+=.6*e.x,p.y+=.6*e.y,p.z+=.6*e.z):p.copy(m)},this.getAccumulatedWheelDelta=function(){var e=Date.now(),t=0;return l&&e-l>100?(t=b(s),s=0,a=null,l=null,c=!1):a&&e-a>100&&(c?Math.abs(s)>=3&&(t=s,s=0):(t=b(s),c=!0,s=0)),t},this.update=function(){var e=!1,t=f>h;if(f>h){this.controller.setIsLocked(!0),this.getMotionDelta(g);var r=g.x,s=g.y,a=g.z;if(0!==r||0!==s||0!==a)if(t=!0,f>=0)s=-s,0!==(a=Math.abs(r)>Math.abs(s)?r:s)&&(a*=-1,i.setVerticalFov(i.getVerticalFov()*(1+a),!0));else{var l=this.getAccumulatedWheelDelta()/3;0!==l&&i.setFocalLength(i.getFocalLength()+l,!0)}this.stepMotionDelta(g,!0),f===d&&Math.abs(a)<1e-5&&(this.interactionEnd(d),e=!0)}return t?this.utilities.pivotActive(i.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!o&&(e||f>h)&&(f>d&&p.copy(m),f=h,this.controller.setIsLocked(!1)),n.dirty},this.interactionStart=function(e,t){(t||e>f)&&(f=e,o=!0),i.toPerspective()},this.interactionEnd=function(e){e===f&&(e!==d&&this.utilities.pivotActive(!1),o=!1)},this.handleWheelInput=function(e){if(f>d)return!1;i.getReverseZoomDirection()&&(e*=-1),m.z+=e,s+=e;var t=Date.now();return a||(a=t),l=t,0!=e&&this.interactionStart(d),!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return this.handleButtonUp(e,0);case"drag3start":return y="drag",this.handleButtonDown(e,0);case"drag3move":return"drag"===y&&this.handleMouseMove(e);case"drag3end":return"drag"===y&&this.handleButtonUp(e,0),y=null,!1}return!1},this.handleButtonDown=function(e,t){return u+=1<<t,2!==t&&(p.x=.5*(e.normalizedX+1),p.y=1-.5*(e.normalizedY+1),m.copy(p),this.interactionStart(t),!0)},this.handleButtonUp=function(e,t){return u-=1<<t,2!==t&&(m.x=.5*(e.normalizedX+1),m.y=1-.5*(e.normalizedY+1),this.interactionEnd(t),!0)},this.handleMouseMove=function(e){return m.x=.5*(e.normalizedX+1),m.y=1-.5*(e.normalizedY+1),f>d},this.handleBlur=function(e){return this.interactionEnd(f),!1}}function uT(e,t){var i,n=t.navigation,r=n.getCamera(),o=["worldup"],s=this,a=(i=new(v().Vector3),function(e,t,n,r){var o=new(v().Vector3)(e,t,n),s=r.dot(o);return i.copy(r),i.multiplyScalar(s),o.sub(i)});var l=2*Math.PI,c=.001,u=1e-5,h=!1,d=!1,f=!1,p=new function(e,t){var i=2*Math.tan(v().Math.degToRad(15)),r=new(v().MeshPhongMaterial)({color:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),o=new(v().Vector3),s=new(v().Vector3),c=new(v().Quaternion),h=new(v().PerspectiveCamera)(30,t.aspect,t.near,t.far),d=t,f=1,p=1,m=null,g=null,y=null,b=null,x=null,_=null,E=null,S=null,A=null,w=new Array(6),C=0,T=!1,M=!0,I=0,P=5*Math.PI/180,L=7*Math.PI/180,R=1,D=1e3,O=.1;function B(e,t){var i=Math.abs(e-t);return i>l?i:Math.min(l-i,i)}function N(e,t){var i=V(e);return i.distanceToSquared(t)<u||(s.set(-t.x,-t.y,-t.z),i.distanceToSquared(s)<u)}function U(e){return e>l?e:e<=0?e+Math.PI:e-Math.PI}function k(e,t,i){var n,r=e.clone().normalize(),o=new Array(3),l=new Array(6);o[0]=a(1,0,0,r),o[1]=a(0,1,0,r),o[2]=a(0,0,1,r);var u=t.clone().cross(r).normalize();for(n=0;n<3;++n){var h=o[n];l[n]=h.length(),l[n]<O?w[n]=D:(h.multiplyScalar(1/l[n]),w[n]=Math.atan2(u.dot(h),t.dot(h)))}for(w[3]=U(w[0]),w[4]=U(w[1]),w[5]=U(w[2]),l[3]=l[0],l[4]=l[1],l[5]=l[2],function(e,t){for(var i=P+L+2*Math.PI/180,n=0;n<6;++n)if(w[n]!==D)for(var r=n+1;r<6;++r)if(w[r]!==D&&B(w[n],w[r])<i){if(e[n]<e[r]&&!N(n,t)||N(r,t)){w[n]=D;break}w[r]=D}}(l,i),n=0;n<6;++n)if(w[n]!==D){var d=s.set(0,0,1);c.setFromAxisAngle(d,w[n]);var f=s.set(0,.54,0);f.applyQuaternion(c),S[n].position.copy(f),S[n].visible=!0}else S[n].visible=!1}function F(e,t,i,o,s){return _||(_=function(){_=new(v().Object3D);var e=new(v().RingGeometry)(.5-.01*f,.5,60),t=new(v().Mesh)(e,r);g=t;var i=.007*f,n=new(v().BoxGeometry)(.93,i,i),o=new(v().BoxGeometry)(i,.93,i),s=new(v().BoxGeometry)(i,i,.93);y=new(v().Mesh)(n,r),b=new(v().Mesh)(o,r),x=new(v().Mesh)(s,r),_.add(y),_.add(b),_.add(x),E=new(v().Mesh)(new(v().CircleGeometry)(.005),r),_.add(E),S=new Array(6),A=new Array(6);for(var a=0;a<6;++a){var l=.005*f,c=.0025*f;S[a]=new(v().Mesh)(new(v().CircleGeometry)(l,16),r),A[a]=new(v().Mesh)(new(v().CircleGeometry)(c,16),r),A[a].visible=!1,S[a].add(A[a]),t.add(S[a])}return _.add(t),_}()),n.orient(g,t,h.position,o),k(i,s,o),_.scale.x=e,_.scale.y=e,_.scale.z=e,_.position.copy(t),_}function V(e){if(o.set(0,0,0),e>=0){var t=e>=3?-1:1;0===(e%=3)&&(o.x=t),1===e&&(o.y=t),2===e&&(o.z=t)}return T&&o.multiplyScalar(-1),o}function G(e,t){for(var i=B(w[0],e),n=0,r=1;r<6;++r){var o=B(w[r],e);o<i&&(i=o,n=r)}return i,i<t?n:-1}function z(e){n.setWorldUpVector(e,!0)}function H(e){if(0!==e){var t=30*Math.PI/180,i=s.copy(h.position).sub(m).normalize();c.setFromAxisAngle(i,e);var r=n.getWorldUpVector(),o=Math.abs(i.angleTo(r));(o<t||Math.PI-o<t)&&r.copy(n.getCameraUpVector()),r.applyQuaternion(c),z(r)}}function W(e,t,i,n){return e<t&&V(i).distanceToSquared(n)<u}function j(e,t){e.dot(t)<0&&(t=t.clone().multiplyScalar(-1)),n.orient(E,m,h.position,t),E.position.copy(t.multiplyScalar(.495));for(var i=!1,r=M?L:P,o=0;o<6;++o){var s=B(w[o],C),a=W(s,r,o,e);a&&(i=!0);var l=a?4:3*(1-3*s/Math.PI);l<1&&(l=1),l*=f,A[o].visible=a;var c=S[o];c.scale.x=l,c.scale.y=l,c.scale.z=l}return y.visible=i,b.visible=i,x.visible=i,i}function q(e){(C+=e)>Math.PI?C-=l:C<=-Math.PI&&(C=l+C);var t=function(){if(!M){var e=G(C,P);if(e>=0)return 0,M=!0,C=w[e],V(e)}return!1}();if(t)I=C,z(t);else if(function(){if(M){if(G(C,L)<0)return M=!1,!0;0}return!1}()){H(C-I),I=0}else{if(M)return!1;H(e)}return!0}e.createOverlayScene("roll",null,null,h),this.updateRollCamera=function(e,t){h.position.copy(d.position),h.quaternion.copy(d.quaternion),h.up.copy(d.up),h.aspect=d.aspect,e&&t&&(h.near=t-e,h.far=t+e),h.updateProjectionMatrix()},this.isSnapped=function(){return M},this.resize=function(){var e=R*i,t=e*d.aspect,n=(d.aspect<1?t:e)*p;_.scale.x=n,_.scale.y=n,_.scale.z=n},this.start=function(t,i){this.updateHUD(t,i),e.addOverlay("roll",_)},this.updateHUD=function(e,t){m=e,t<.35?t=.35:t>.8&&(t=.8),p=t,f=.8/t;var r=o.copy(e).sub(d.position),s=(R=r.length())*i,a=s*d.aspect,l=(d.aspect<1?a:s)*t;this.updateRollCamera(l,R);var c=n.getWorldUpVector(),u=n.getCameraUpVector();F(l,e,r,c,u),C=0,I=0;var h=c.dot(u);T=h<0,M=j(c,u)},this.handleRoll=function(e,t,i){if(this.updateRollCamera(),j(n.getWorldUpVector(),n.getCameraUpVector()),0!==e||0!==t){var r=i.x-e-.5,o=i.y-t-.5,s=i.x-.5,a=i.y-.5;return q(Math.atan2(a,s)-Math.atan2(o,r))}return!1},this.handleRollTouch=function(e){this.updateRollCamera(),j(n.getWorldUpVector(),n.getCameraUpVector());var t=e-C;return Math.abs(t)>.001&&q(t)},this.end=function(){e.removeOverlay("roll",_)}}(e,r),m=new(v().Vector3),g=new(v().Vector3),y=new(v().Vector3),b=null,x=0;this.getNames=function(){return o},this.getName=function(){return o[0]},this.activate=function(e){t.addEventListener(Sr,this.handleCameraChange),f=!1},this.deactivate=function(e){p.end(),t.removeEventListener(Sr,this.handleCameraChange),this.utilities.restorePivot(),b=null,h=!1,f=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(e){var t=g.x-m.x,i=g.y-m.y,n=g.z-m.z;Math.abs(t)<c&&(t=0),Math.abs(i)<c&&(i=0),Math.abs(n)<c&&(n=0),e.set(t,i,n)},this.stepMotionDelta=function(){m.copy(g)},this.update=function(){if(!f){var e=n.getEyeVector(),t=.5*(r.near+r.far);e.normalize().multiplyScalar(t);var i=e.add(r.position);this.utilities.savePivot(),this.utilities.setPivotPoint(i,!0,!0),this.utilities.pivotActive(!0);p.start(i,.65),f=!0}var o=d;this.getMotionDelta(y);var s=y.x,a=y.y,l=y.z;return(d||"roll"===b||h&&(0!==s||0!==a||0!==l))&&(d="roll"===b?p.handleRollTouch(x):p.handleRoll(s,a,g)),this.stepMotionDelta(),r.dirty&&(o=!0),o},this.handleResize=function(){p.resize(),d=!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return b="drag",this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return b=null,this.handleButtonUp(e,0);case"rotatestart":return t.removeEventListener(Sr,this.handleCameraChange),b="roll",x=v().Math.degToRad(e.rotation),{x:.5*(e.normalizedX+1),y:1-.5*(e.normalizedY+1)},function(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY,r=Math.sqrt(t*t+i*i),o=n.getScreenViewport();return r/Math.min(o.width,o.height)}(e),!0;case"rotatemove":return x=v().Math.degToRad(e.rotation),"roll"===b;case"rotateend":return t.addEventListener(Sr,this.handleCameraChange),x=v().Math.degToRad(e.rotation),b=null,!1}return!1},this.handleWheelInput=function(e){return!0},this.handleCameraChange=function(){var e=n.getEyeVector(),t=.5*(r.near+r.far);e.normalize().multiplyScalar(t);var i=e.add(r.position);p.updateHUD(i,.65)},this.handleButtonDown=function(e,i){return m.x=.5*(e.normalizedX+1),m.y=1-.5*(e.normalizedY+1),g.copy(m),h=!0,b=null,this.controller.setIsLocked(!0),t.removeEventListener(Sr,s.handleCameraChange),!0},this.handleButtonUp=function(e,i){return g.x=.5*(e.normalizedX+1),g.y=1-.5*(e.normalizedY+1),h=!1,d=!0,this.controller.setIsLocked(!1),t.addEventListener(Sr,s.handleCameraChange),!0},this.handleMouseMove=function(e){return g.x=.5*(e.normalizedX+1),g.y=1-.5*(e.normalizedY+1),!0},this.handleBlur=function(e){return h=!1,b=null,!1}}tT.prototype.applyMatrix4=function(e){if(this.geomEdge&&this.geomEdge.applyMatrix4(e),this.geomFace&&this.geomFace.applyMatrix4(e),this.geomVertex&&this.geomVertex.applyMatrix4(e),this.intersectPoint&&this.intersectPoint.applyMatrix4(e),this.circularArcCenter&&this.circularArcCenter.applyMatrix4(e),this.snapPoint&&this.snapPoint.applyMatrix4(e),this.faceNormal){iT=iT||new THREE.Matrix4;const t=iT.getNormalMatrix(e);this.faceNormal.applyMatrix4(t)}this.radius=oT(this.radius,e),this.circularArcRadius=oT(this.circularArcRadius,e)},tT.prototype.getFace=function(){return this.geomFace},tT.prototype.getEdge=function(){return this.geomEdge},tT.prototype.getVertex=function(){return this.geomVertex},tT.prototype.getGeometry=function(){switch(this.geomType){case wC.SNAP_VERTEX:case wC.SNAP_MIDPOINT:case wC.SNAP_INTERSECTION:case wC.SNAP_CIRCLE_CENTER:case wC.RASTER_PIXEL:return this.geomVertex;case wC.SNAP_EDGE:return this.geomEdge;case wC.SNAP_FACE:return this.geomFace;case wC.SNAP_CIRCULARARC:case wC.SNAP_CURVEDEDGE:return this.geomEdge;case wC.SNAP_CURVEDFACE:return this.geomFace}return null},tT.prototype.setGeometry=function(e,t){switch(e){case wC.SNAP_VERTEX:case wC.SNAP_MIDPOINT:case wC.SNAP_INTERSECTION:case wC.SNAP_CIRCLE_CENTER:case wC.RASTER_PIXEL:this.geomVertex=t;break;case wC.SNAP_EDGE:this.geomEdge=t;break;case wC.SNAP_FACE:this.geomFace=t;break;case wC.SNAP_CIRCULARARC:case wC.SNAP_CURVEDEDGE:this.geomEdge=t;break;case wC.SNAP_CURVEDFACE:this.geomFace=t;break;default:return}this.geomType=e},sT.prototype.clone=function(){var e;const t=new sT(this.measurementType,this.id,this.options);return t.closedArea=this.closedArea,t.isRestored=this.isRestored,t.picks=this.clonePicks(),t.angle=this.angle,t.distanceX=this.distanceX,t.distanceY=this.distanceY,t.distanceZ=this.distanceZ,t.distanceXYZ=this.distanceXYZ,t.arc=this.arc,t.spot=null===(e=this.spot)||void 0===e?void 0:e.clone(),t.result=Object.assign({},this.result),t},sT.prototype.resetMeasureValues=function(){this.angle=0,this.distanceX=0,this.distanceY=0,this.distanceZ=0,this.distanceXYZ=0,this.arc=0,this.spot=null,this.result=null},sT.prototype.setPick=function(e,t){var i=this.picks[e]=t;return i.id=parseInt(e),i},sT.prototype.getPick=function(e){var t=this.picks[e];return t||(t=this.setPick(e,new tT)),t},sT.prototype.clonePicks=function(e){var t=[];for(var i in this.picks)if(Object.prototype.hasOwnProperty.call(this.picks,i)){var n=this.picks[i];t.push(n.clone())}return t},sT.prototype.countPicks=function(){return Object.keys(this.picks).length},sT.prototype.getMaxNumberOfPicks=function(){switch(this.measurementType){case CC.MEASUREMENT_SPOT:return 1;case CC.MEASUREMENT_DISTANCE:case CC.MEASUREMENT_CALLOUT:case CC.MEASUREMENT_ARC:return 2;case CC.MEASUREMENT_ANGLE:return 3;case CC.MEASUREMENT_AREA:return this.closedArea?this.countPicks():Number.MAX_VALUE-1}},sT.prototype.hasPick=function(e){return this.picks[e]&&!this.picks[e].isEmpty()||this.isRestored},sT.prototype.isComplete=function(){var e=this.countPicks()===this.getMaxNumberOfPicks();for(var t in this.picks)if(Object.prototype.hasOwnProperty.call(this.picks,t)&&!(e=e&&this.hasPick(t)))break;return e},sT.prototype.isEmpty=function(){var e=!0;for(var t in this.picks)if(Object.prototype.hasOwnProperty.call(this.picks,t)&&!(e=e&&!this.hasPick(t)))break;return e},sT.prototype.clearPick=function(e){this.picks[e]&&this.picks[e].clear(),this.resetMeasureValues()},sT.prototype.clearAllPicks=function(){for(var e in this.picks)Object.prototype.hasOwnProperty.call(this.picks,e)&&this.clearPick(e)},sT.prototype.hasEqualPicks=function(e,t){return!(!e||!t)&&(e.geomType===t.geomType&&qC(IC(e),IC(t),MC))},sT.prototype.computeResult=function(e,t){if(this.resetMeasureValues(),!t.model)return this.result=null,!1;var i=this.result=FC(e,this.measurementType,t,this.options);if(null===i)return!this.isComplete();switch(i.type){case CC.MEASUREMENT_DISTANCE:return this.distanceXYZ=i.distanceXYZ,this.distanceX=i.distanceX,this.distanceY=i.distanceY,this.distanceZ=i.distanceZ,!0;case CC.MEASUREMENT_ANGLE:return this.angle=isNaN(i.angle)?0:i.angle,!0;case CC.MEASUREMENT_AREA:return this.area=i.area,!0;case CC.MEASUREMENT_ARC:return this.arc=i.arc,!0;case CC.MEASUREMENT_SPOT:return this.spot=i.spot,this.modelSpot=i.modelSpot,this.units=i.units,!0;case CC.MEASUREMENT_CALLOUT:return!0;default:return!1}},sT.prototype.getGeometry=function(e){return{type:this.picks[e].geomType,geometry:this.picks[e].getGeometry()}},sT.prototype.attachIndicator=function(e,t,i){this.indicator=new i(e,this,t),this.indicator.init()};const hT=c();function dT(){this.ios=hT.webkit,this.android=hT.JSINTERFACE,this.iosSend=function(e,t){return hT.webkit.messageHandlers.callbackHandler.postMessage({command:e,data:t})},this.androidSend=hT.JSINTERFACE}var fT=dT.prototype;fT.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},fT.onSelectionChanged=function(e){this.ios?this.iosSend("selectionChanged",e):this.android&&this.androidSend.onSelectionChanged(e)},fT.onLongTap=function(e,t){this.ios?this.iosSend("onLongTap",[e,t]):this.android&&this.androidSend.onLongTap(e,t)},fT.onSingleTap=function(e,t){this.ios?this.iosSend("onSingleTap",[e,t]):this.android&&this.androidSend.onSingleTap(e,t)},fT.onDoubleTap=function(e,t){this.ios?this.iosSend("onDoubleTap",[e,t]):this.android&&this.androidSend.onDoubleTap(e,t)},fT.setRTCSession=function(e){this.ios?this.iosSend("setRTCSession",{id:e}):this.android&&this.androidSend.setRTCSessionID(e)},fT.putProperties=function(e,t){this.ios?this.iosSend("putProperties",{name:e,value:t}):this.android&&this.androidSend.putProperties(e,t)},fT.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},fT.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},fT.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},fT.setPauseUI=function(){this.ios?this.iosSend("setPauseUI"):this.android&&this.androidSend.setToPaused()},fT.getDeviceAvailableMemory=function(){return this.ios?this.iosSend("getDeviceAvailableMemory"):this.android?this.androidSend.getDeviceAvailableMemory():void 0},fT.onDeviceMemoryInsufficient=function(){return this.ios?this.iosSend("onDeviceMemoryInsufficient"):this.android?this.androidSend.onDeviceMemoryInsufficient():void 0},fT.updateAnimationTime=function(e){this.ios?this.iosSend("updateAnimationTime",e):this.android&&this.androidSend.updateAnimationTime(e)},fT.setLoadingProgress=function(e,t){this.ios?this.iosSend("setLoadingProgress",{state:e,progress:t}):this.android&&this.androidSend.setLoadingProgress(e,t)},fT.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},fT.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},fT.putSheets=function(e,t){this.ios?this.iosSend("putSheets",[e,t]):this.android&&this.androidSend.putSheets(e,t)},fT.putAllSheets=function(e){this.ios?this.iosSend("putAllSheets",e):this.android&&this.androidSend.putAllSheets(e)},fT.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},fT.instanceTree=function(e){this.ios?this.iosSend("instanceTree",e):this.android&&this.androidSend.instanceTree(e)},fT.loadSheetFailed=function(){this.ios?this.iosSend("loadSheetFailed"):this.android&&this.androidSend.loadSheetFailed()},fT.sheetSelected=function(e){this.ios?this.iosSend("sheetSelected",e):this.android&&this.androidSend.sheetSelected(e)},"undefined"!=typeof window&&(hT.MobileCallbacks=dT);const pT="toolbarCreated",mT="settingsPanelCreated",gT="viewCubeCreated",vT={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools",MEASURETOOLSID:"measureTools"};function yT(){}function bT(e,t){this._id=e,this._isCollapsible=!t||t.collapsible,this._toolTipElement=null,this._listeners={},this.container=this.getDocument().createElement("div"),this.container.id=e,this.addClass("adsk-control")}function xT(e,t){bT.call(this,e,t);var i=this;this._state=xT.State.INACTIVE;var n=this.getDocument();this.icon=n.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",(function(e){i.getState()!==xT.State.DISABLED&&(i.dispatchEvent(xT.Event.CLICK),i.onClick&&i.onClick(e)),e.stopPropagation()})),O()?this.container.addEventListener("touchstart",Q):(this.container.addEventListener("mouseover",(function(e){i.onMouseOver(e)})),this.container.addEventListener("mouseout",(function(e){i.onMouseOut(e)}))),this.addClass("adsk-button"),this.addClass(xT.StateToClassMap[this._state])}var _T,ET;function ST(e,t){bT.call(this,e,t);var i=this;this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(e){var t={type:ST.Event.SIZE_CHANGED,childEvent:e};i.dispatchEvent(t)}}yT.instances=[],yT.displayError=function(e,t,i,n,r,o){var s=e.ownerDocument,a=s.createElement("div");a.className="alert-box error",e.appendChild(a);var l=n;l||(l="img-item-not-found");var c=s.createElement("div");c.className="alert-box-image "+l,a.appendChild(c);var u=s.createElement("div");u.className="alert-box-msg",a.appendChild(u);var h=i;h||(h=hs.t("Error Occurred",{defaultValue:"Error Occurred"}));var d=s.createElement("div");d.className="alert-box-title",d.textContent=h,d.setAttribute("data-i18n",h),u.appendChild(d);var f=s.createElement("div");if(f.className="alert-box-text",f.textContent=t,f.setAttribute("data-i18n",t),u.appendChild(f),r){var p=s.createElement("div");p.className="alert-box-content",u.appendChild(p);var m=s.createElement("ul");m.className="alert-box-content";for(var g=0;g<r.length;g++){var v=r[g];if(v){var y=s.createElement("li"),b=this.extractList(v);if(b.list.length){var x=this.generateListElement(list,s);m.appendChild(x)}y.innerHTML=b.msg,y.setAttribute("data-i18n",b.msg),m.appendChild(y)}}p.appendChild(m)}var _=s.createElement("div");_.className="alert-box-ok",_.textContent=hs.t("OK",{defaultValue:"OK"});var E={alertBox:a,container:e,tag:o};_.addEventListener("click",(function(t){a.style.visibility="hidden",e.removeChild(a),yT.instances.splice(yT.instances.indexOf(E),1)})),a.appendChild(_),a.style.visibility="visible",yT.instances.push(E)},yT.displayErrors=function(e,t,i){var n=e.ownerDocument,r=n.createElement("div");r.className="alert-box errors",e.appendChild(r);var o=t;o||(o="img-item-not-found");var s=n.createElement("div");s.className="alert-box-image "+o,r.appendChild(s);var a=n.createElement("div");a.className="alert-box-msg errors",r.appendChild(a);for(var l=0;l<i.length;l++){var c=i[l].header;c||(c=hs.t("Error",{defaultValue:"Error"}));var u=n.createElement("div");u.className="alert-box-title errors",u.textContent=c,a.appendChild(u);var h=n.createElement("div");h.className="alert-box-text errors";var d=i[l].msg;if((b=this.extractList(d)).list.length){var f=n.createElement("div"),p=this.generateListElement(b.list,n);f.appendChild(p),h.textContent=b.msg,h.appendChild(f)}else h.textContent=d;if(a.appendChild(h),i[l].hints){var m=n.createElement("ul");m.className="alert-box-content";for(var g=i[l].hints,v=0;v<g.length;v++){var y=g[v];if(y){var b,x=n.createElement("li");if(m.appendChild(x),(b=this.extractList(y)).list.length){p=this.generateListElement(b.list,n);m.appendChild(p)}x.innerHTML=b.msg}}a.appendChild(m)}}var _=n.createElement("div");_.className="alert-box-ok",_.textContent=hs.t("OK",{defaultValue:"OK"});var E={alertBox:r,container:e};_.addEventListener("click",(function(t){r.style.visibility="hidden",e.removeChild(r),yT.instances.splice(yT.instances.indexOf(E),1)})),r.appendChild(_),r.style.visibility="visible",yT.instances.push(E)},yT.extractList=function(e){var t={msg:e,list:[]};if(e&&-1!=e.indexOf("<ul>")){var i=e.split("<ul>");t.msg=i[0],i=i[1].split("</ul>"),t.list=i[0].split(", "),1===t.list.length&&(t.list=i[0].split(","))}return t},yT.generateListElement=function(e,t){for(var i=t.createElement("ul"),n=0;n<e.length;n++){var r=t.createElement("li");r.textContent=e[n],r.setAttribute("data-i18n",e[n]),i.appendChild(r)}return i},yT.dismissByTag=function(e){var t=yT.instances.findIndex((t=>t&&t.tag===e));if(-1==t)return!1;var i=yT.instances[t];return i.alertBox.style.visibility="hidden",i.container.removeChild(i.alertBox),yT.instances.splice(t,1),!0},yT.dismiss=function(){if(yT.instances.length>0){var e=yT.instances.pop();return e.alertBox.style.visibility="hidden",e.container.removeChild(e.alertBox),!0}return!1},fo.call(bT.prototype),bT.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},Ba.prototype.apply(bT.prototype),bT.prototype.constructor=bT,bT.prototype.container=null,bT.prototype.getId=function(){return this._id},bT.prototype.setVisible=function(e){if(!this.container.classList.contains("adsk-hidden")===e)return!1;e?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");var t={type:bT.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:e};return this.dispatchEvent(t),!0},bT.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},bT.prototype.setToolTip=function(e){return(!this._toolTipElement||this._toolTipElement.getAttribute("tooltipText")!==e)&&(this._toolTipElement||(this._toolTipElement=this.getDocument().createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",e),this._toolTipElement.setAttribute("tooltipText",e),this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(e,{defaultValue:e}),!0)},bT.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},bT.prototype.setCollapsed=function(e){if(!this._isCollapsible||this.isCollapsed()===e)return!1;e?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");var t={type:bT.Event.COLLAPSED_CHANGED,isCollapsed:e};return this.dispatchEvent(t),!0},bT.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},bT.prototype.isCollapsible=function(){return this._isCollapsible},bT.prototype.addClass=function(e){this.container.classList.add(e)},bT.prototype.removeClass=function(e){this.container.classList.remove(e)},bT.prototype.getPosition=function(){var e=this.container.getBoundingClientRect();return{top:e.top,left:e.left}},bT.prototype.getDimensions=function(){var e=this.container.getBoundingClientRect();return{width:e.width,height:e.height}},bT.prototype.setDisplay=function(e){this.container.style.display=e},bT.prototype.removeFromParent=function(){return!!this.parent&&this.parent.removeControl(this)},xT.Event={VISIBILITY_CHANGED:bT.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:bT.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},xT.State={ACTIVE:0,INACTIVE:1,DISABLED:2},xT.StateToClassMap=(_T=xT.State,(ET={})[_T.ACTIVE]="active",ET[_T.INACTIVE]="inactive",ET[_T.DISABLED]="disabled",ET),xT.prototype=Object.create(bT.prototype),xT.prototype.constructor=xT,xT.prototype.setState=function(e){if(e===this._state)return!1;this.removeClass(xT.StateToClassMap[this._state]),this.addClass(xT.StateToClassMap[e]),this._state=e;var t={type:xT.Event.STATE_CHANGED,state:e};return this.dispatchEvent(t),!0},xT.prototype.setIcon=function(e){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=e,this.icon.classList.add(e)},xT.prototype.getState=function(){return this._state},xT.prototype.onClick=function(e){},xT.prototype.onMouseOver=function(e){},xT.prototype.onMouseOut=function(e){},ST.Event={VISIBILITY_CHANGED:bT.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:bT.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},ST.prototype=Object.create(bT.prototype),ST.prototype.constructor=ST,ST.prototype.addControl=function(e,t){e.setGlobalManager(this.globalManager);var i=t&&void 0!==t.index?t.index:this._controls.length;if(null!==this.getControl(e.getId()))return!1;var n={type:ST.Event.CONTROL_ADDED,control:e,index:i};return i<this._controls.length?(this.container.insertBefore(e.container,this._controls[i].container),this._controls.splice(i,0,e)):(this.container.appendChild(e.container),this._controls.push(e)),e.addEventListener(bT.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),e.addEventListener(bT.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),e instanceof ST&&e.addEventListener(ST.Event.SIZE_CHANGED,this.handleChildSizeChanged),e.parent=this,this.dispatchEvent(n),this.dispatchEvent(ST.Event.SIZE_CHANGED),!0},ST.prototype.indexOf=function(e){for(var t=0;t<this._controls.length;t++){var i=this._controls[t];if(i===e||"string"==typeof e&&e===i.getId())return t}return-1},ST.prototype.removeControl=function(e){var t="string"==typeof e?this.getControl(e):e;if(!t)return!1;var i=this._controls.indexOf(t);if(-1===i)return!1;this._controls.splice(i,1),this.container.removeChild(t.container);var n={type:ST.Event.CONTROL_REMOVED,control:t,index:i};return t.removeEventListener(bT.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),t.removeEventListener(bT.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),t instanceof ST&&t.removeEventListener(ST.Event.SIZE_CHANGED,this.handleChildSizeChanged),t.parent=void 0,this.dispatchEvent(n),this.dispatchEvent(ST.Event.SIZE_CHANGED),!0},ST.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e===this._controls[t].getId())return this._controls[t];return null},ST.prototype.getControlId=function(e){return e<0||e>=this._controls.length?null:this._controls[e].getId()},ST.prototype.getNumberOfControls=function(){return this._controls.length},ST.prototype.setCollapsed=function(e){if(!this._isCollapsible)return!1;var t=!1;return this._controls.forEach((function(i){i.isCollapsible()&&i.setCollapsed(e)&&(t=!0)})),t&&(e?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.dispatchEvent({type:ST.Event.COLLAPSED_CHANGED,isCollapsed:e})),t};var AT={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unlock","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You dont have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We cant display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>Theres nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-item-not-found","globalized-msg":"Viewer-ModeIsEmpty","default-msg":"<title>Model is empty</title><message>Model is empty, there is no geometry for the viewer to show.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},13:{img:"img-unsupported","globalized-msg":"Viewer-FileExtNotSupported","default-msg":{title:"Sorry",message:"The file extension loaded into the Viewer is not supported",hints:["Try a different file"]}},15:{img:"img-unsupported","globalized-msg":"Viewer-WebGlContextLost","default-msg":{title:"WebGL context lost",message:"Unable to recover from software mode. Please restart your browser and reload the Viewer.",hints:["If you continue to encounter this issue when viewing this model, we recommend switching to a different browser."]}}};function wT(){}function CT(){}function TT(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.ownerDocument;this.bg=i.createElement("div"),this.bg.className="progressbg",this.fg=i.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),e.appendChild(this.bg),this.lastValue=-1,this.fg.style.transform="scale(0, 1)",this.labels=[],this.showLabel=t,this.registerLabel(e,"ProgressLoading"),this.registerLabel(e,"ProgressLoading"),this.registerLabel(e,"ProgressRendering"),this.registerLabel(e,"ProgressOptimizing")}function MT(e,t,i,n,r){var o=this;this.tbody=n;var s=r&&r.insertAtIndex?r.insertAtIndex:-1;this.hideStepper=r&&r.hideStepper;var a=r&&r.hideCaption;this.sliderRow=this.tbody.insertRow(s),this.sliderRow.classList.add("switch-slider-row");var l=this.getDocument(),c=this.sliderRow.insertCell(0);function u(e){e.target!=o.stepperElement&&(o.stepperElement.value=o.sliderElement.value),o.fireChangeEvent()}this.caption=l.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=hs.t(e),a&&(this.caption.style.display="none"),c.appendChild(this.caption),c=this.sliderRow.insertCell(1),this.sliderElement=l.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=e+"_slider",this.sliderElement.min=t,this.sliderElement.max=i,this.sliderElement.style.width="85%",c.appendChild(this.sliderElement),c=this.sliderRow.insertCell(2),this.stepperElement=l.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=e+"_stepper",this.stepperElement.min=t,this.stepperElement.max=i,this.stepperElement.step=1,this.stepperElement.style.width="64px",this.hideStepper&&(this.stepperElement.style.display="none"),c.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",(function(e){e.target!=o.sliderElement&&(o.sliderElement.value=o.stepperElement.value),o.fireChangeEvent()}),!1),this.sliderElement.addEventListener("change",u,!1),this.sliderElement.addEventListener("input",u,!1)}function IT(e,t,i,n,r,o){var s=this;this.tbody=t;var a=o&&o.insertAtIndex?o.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(a),this.sliderRow.classList.add("switch-slider-row");var l=this.getDocument(),c=this.sliderRow.insertCell(0);if(this.caption=l.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=hs.t(e,null==o?void 0:o.i18nOptions),c.appendChild(this.caption),o&&!0===o.betaLabel){let e=l.createElement("div");e.setAttribute("data-i18n","BETA"),e.textContent=hs.t("BETA",null==o?void 0:o.i18nOptions),e.classList.add("switch-slider-row-beta-label"),this.caption.appendChild(e)}c=this.sliderRow.insertCell(1),n&&(this.description=l.createElement("div"),this.description.setAttribute("data-i18n",n),this.description.textContent=hs.t(n,null==o?void 0:o.i18nOptions),c.appendChild(this.description),c=this.sliderRow.insertCell(2));var u=l.createElement("label");u.classList.add("switch"),this.checkElement=l.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=e+"_check",this.checkElement.checked=i,u.appendChild(this.checkElement);var h=l.createElement("div");h.classList.add("slider"),u.appendChild(h),c.appendChild(u),this.blockEvent=!1,this.checked=i,this.checkElement.addEventListener("change",(function(e){s.fireChangeEvent()}),!1),O()&&(this.sliderRowHammer=new ye.A.Manager(this.sliderRow,{recognizers:[[ye.A.Tap]],handlePointerEventMouse:!1,inputClass:ye.A.TouchInput}),this.sliderRowHammer.on("tap",(function(e){e.preventDefault(),e.target.click()}))),this.checkElement.addEventListener("click",(function(e){e.stopPropagation()}),!1),this.sliderRow.addEventListener("click",(function(e){s.checkElement.disabled||(s.checkElement.checked=!s.checkElement.checked,s.fireChangeEvent())}),!1),r&&this.setGlobalManager(r)}function PT(e,t,i,n){this.tbody=t;var r=n&&n.insertAtIndex?n.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(r);var o=this.getDocument(),s=this.sliderRow.insertCell(0);this.caption=o.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=hs.t(e),s.appendChild(this.caption),s.colSpan="3",this.blockEvent=!1,this.removeFromParent=function(){this.tbody.removeChild(this.sliderRow),this.tbody=null,this.sliderRow=null,this.caption=null}}function LT(e,t,i,n){this.tbody=t;var r=n&&n.insertAtIndex?n.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(r),this.sliderRow.insertCell();var o=this.sliderRow.insertCell();this.sliderRow.insertCell();var s=this.getDocument();this.caption=s.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=hs.t(e),this.caption.classList.add("adsk-button"),this.caption.classList.add("table-button"),o.appendChild(this.caption),this.removeFromParent=function(){this.tbody.removeChild(this.sliderRow),this._onClick&&(this.caption.removeEventListener("click",this._onClick),this._onClick=null),this.tbody=null,this.sliderRow=null,this.caption=null},this.setOnClick=function(e){this._onClick=e,this.caption.addEventListener("click",e,!1)}}function RT(e,t,i,n,r,o,s){var a=this;this.tbody=t;var l=s&&s.insertAtIndex?s.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(l);var c=this.getDocument();this.dropdownElement=c.createElement("select"),this.dropdownElement.id=e+"_dropdown",this.dropdownElement.classList.add("option-drop-down");for(var u=0;u<i.length;u++){var h=c.createElement("option");h.value=u,h.setAttribute("data-i18n",i[u]),h.textContent=hs.t(i[u]),this.dropdownElement.add(h)}this.selectedIndex=this.dropdownElement.selectedIndex=n;var d=this.sliderRow.insertCell(0);this.caption=c.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=hs.t(e),d.appendChild(this.caption),r?(d.colSpan="2",this.sliderRow=this.tbody.insertRow(l),(d=this.sliderRow.insertCell(0)).appendChild(this.dropdownElement),d.colSpan="2",this.dropdownElement.classList.add("tabcell")):(d=this.sliderRow.insertCell(1)).appendChild(this.dropdownElement),d.style.paddingLeft=(s&&void 0!==s.paddingLeft?s.paddingLeft:5)+"px",d.style.paddingRight=(s&&void 0!==s.paddingRight?s.paddingRight:5)+"px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",(function(e){a.fireChangeEvent()}),!1)}function DT(e,t,i){this.resizeCallback=t;var n=this.getDocument(),r=n.createElement("div");r.classList.add("docking-panel-footer");var o=n.createElement("div");o.classList.add("docking-panel-footer-resizer"),r.appendChild(o);var s=!1,a=e.getBoundingClientRect(),l={x:0,y:0},c=n.createElement("div");c.classList.add("adsk-viewing-viewer"),c.classList.add("docking-panel-resize-overlay");var u=function(t){s=!0,a=e.getBoundingClientRect(),this.getDocument().body.appendChild(c),this.addDocumentEventListener("touchmove",d),this.addDocumentEventListener("touchcancel",h),this.addDocumentEventListener("touchend",h),this.addDocumentEventListener("mousemove",d),this.addDocumentEventListener("mouseup",h),t.preventDefault(),t.stopPropagation()};u=u.bind(this);var h=function(e){var t=this.getDocument();t.body.contains(c)&&(t.body.removeChild(c),this.removeDocumentEventListener("touchmove",d),this.removeDocumentEventListener("touchcancel",h),this.removeDocumentEventListener("touchend",h),this.removeDocumentEventListener("mousemove",d),this.removeDocumentEventListener("mouseup",h),e.preventDefault(),e.stopPropagation())};h=h.bind(this);var d=function(t){"touchmove"===t.type&&(t.canvasX=t.touches[0].screenX,t.canvasY=t.touches[0].screenY),s&&(s=!1,l.x=t.canvasX||t.clientX,l.y=t.canvasY||t.clientY);var i=(t.canvasX||t.clientX)-l.x,n=(t.canvasY||t.clientY)-l.y,r=parseInt(a.width+i),o=parseInt(a.height+n);e.style.width=r+"px",e.style.height=o+"px",this.resizeCallback&&this.resizeCallback(r,o),t.preventDefault(),t.stopPropagation()};d=d.bind(this),o.addEventListener("touchstart",u),o.addEventListener("mousedown",u),e.style.resize="none",e.appendChild(r),this.footer=r,this.resizer=o}function OT(e,t,i,n,r){this.tbody=t;var o=r&&r.insertAtIndex?r.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(o),this.sliderRow.classList.add("switch-slider-row");var s=this.getDocument(),a=this.sliderRow.insertCell(0);this.caption=s.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=hs.t(e),a.appendChild(this.caption),a=this.sliderRow.insertCell(1),i&&(this.description=s.createElement("div"),this.description.setAttribute("data-i18n",i),this.description.textContent=hs.t(i),a.appendChild(this.description),a=this.sliderRow.insertCell(2))}wT.prototype.constructor=wT,wT.reportError=function(e,t,i,n,r,o){if(wT.currentError=null,wT.currentErrors=null,t){var s={category:"error",code:t,message:i,httpStatusCode:n,httpStatusText:r};rt.track(s,!0),wT.currentError=[e,t,i,o];var a=AT[t];if(a){(f={defaultValue:""}).defaultValue=a["default-msg"];var l=a.img,c=a["globalized-msg"],u=this.parseErrorString(c,f);if(t===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||t===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var h=Ws()||"http://www.autodesk.com/a360-browsers",d=0;d<u.hints.length;d++){-1!==u.hints[d].indexOf('href="WEBGL_HELP"')&&(u.hints[d]=u.hints[d].replace('href="WEBGL_HELP"','href="'+h+'"'))}yT.displayError(e,u.msg,u.header,l,u.hints)}else{l="img-unsupported";var f={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"};this.parseArguments(i,f),(u=this.parseErrorString(t,f)).header||(u.header="warning"===o?hs.t("header-warning"):""),yT.displayError(e,u.msg,u.header,l,u.hints,t)}}},wT.reportErrors=function(e,t){if(wT.currentError=null,wT.currentErrors=null,t){wT.currentErrors=[e,t];for(var i={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},n=[],r=0;r<t.length;r++)if(t[r].code){this.parseArguments(t[r].message,i);var o=this.parseErrorString(t[r].code,i);o.header||(o.header="warning"===t[0].type?hs.t("header-warning",{defaultValue:"Warning"}):""),n.push(o);var s={category:"error",code:t[r].code,message:t[r].message};rt.track(s,!0)}if(n.length){yT.displayErrors(e,"img-unsupported",n)}}},wT.parseArguments=function(e,t){if(e)if("string"==typeof e)t.defaultValue=e;else{t.defaultValue=e[0];for(var i=1;i<e.length;i++){t[(i-1).toString()]=e[i]}}},wT.parseErrorString=function(e,t){var i={msg:null,msgList:null,header:null,hints:null};if(!e)return i;if("object"==typeof t.defaultValue){var n=t.defaultValue;return i.header=n.title,i.msg=n.message,i.hints=n.hints.concat(),i}var r=hs.t(e,t);if(!r)return i;if(-1!=r.indexOf("<title>")){var o=r.split("<title>")[1].split("</title>");i.header=o[0],r=o[1]}if(r&&-1!=r.indexOf("<message>")){o=r.split("<message>")[1].split("</message>");i.msg=o[0],r=o[1]}else i.msg=r;if(r&&-1!=r.indexOf("<hint>")){i.hints=[];for(var s=r.split("<hint>"),a=0;a<s.length;a++){var l=s[a].split("</hint")[0];i.hints.push(l)}}return i},wT.localize=function(){if(yT.instances.length>0)if(yT.dismiss(),wT.currentError){var e=wT.currentError.shift(),t=wT.currentError;wT.reportError(e,t[0],t[1],t[2])}else{e=wT.currentErrors.shift();var i=wT.currentErrors[0];wT.reportErrors(e,i)}},wT.dismissError=function(e){return yT.dismissByTag(e)},CT.instances=[],CT.displayMessage=function(e,t,i,n,r){let o=e.ownerDocument,s=o.defaultView||o.parentWindow;function a(e){var t=s.getComputedStyle(e),i=parseInt(t["margin-top"]),n=parseInt(t["margin-bottom"]);return e.getBoundingClientRect().height+i+n}function l(e,t,i){var n=s.getComputedStyle(e,null);if(!Array.isArray(t))return n[t];for(var r=i||{},o=0;o<t.length;o++){var a=t[o];r[a]=n[a]}return r}if(!(CT.instances.length>0)){var c=t.msgTitleKey,u=t.msgTitleDefaultValue||c,h=t.messageKey,d=t.messageDefaultValue||h,f=t.buttonText,p=t.checkboxChecked||!1,m=t.position||"center",g=o.createElement("div");if(g.classList.add("docking-panel"),g.classList.add("hud"),"top"===m&&g.classList.add("top"),e.appendChild(g),c){var v,y=o.createElement("div");y.classList.add("docking-panel-title"),y.classList.add("docking-panel-delimiter-shadow"),y.textContent=hs.t(c,{defaultValue:u}),y.setAttribute("data-i18n",c),g.appendChild(y),i&&((v=o.createElement("div")).classList.add("docking-panel-close"),v.addEventListener("click",(function(e){CT.dismiss(),i&&i(e)})),g.appendChild(v));var b=l(y,["width","font-size"]),x=function(e){var t=e.textContent,i=o.createElement("span");l(e,["font-size","font-weight","text-transform","padding","white-space","font-family"],i.style),i.textContent=t,i.style.position="absolute",i.style.top="10000px",i.style.left="-10000px",o.body.appendChild(i);var n=i.offsetWidth;return o.body.removeChild(i),n}(y),_=parseFloat(b["font-size"]),E=v?parseFloat(l(v,"width")):0,S=parseFloat(b.width)-E;y.style["font-size"]=x>S?S/x*_+"px":`${_}px`}var A=o.createElement("div");A.classList.add("hud-client"),A.classList.add("docking-panel-container-solid-color-b"),g.appendChild(A);var w=o.createElement("div");w.className="hud-message",w.textContent=hs.t(h,{defaultValue:d}),w.setAttribute("data-i18n",d),A.appendChild(w);var C=a(w);if(n){var T=o.createElement("div");T.classList.add("docking-panel-primary-button"),T.classList.add("hud-button"),T.textContent=hs.t(f,{defaultValue:f}),T.setAttribute("data-i18n",f),T.addEventListener("click",n),A.appendChild(T),C+=a(T)}if(r){var M=o.createElement("div"),I=o.createElement("input");I.className="hud-checkbox",I.type="checkbox",I.checked=p,M.appendChild(I);var P="Do not show this message again",L=o.createElement("label");L.setAttribute("for",P),L.setAttribute("data-i18n",P),L.textContent=hs.t(P,{defaultValue:P}),M.appendChild(L),I.addEventListener("change",r),A.appendChild(M),C+=a(r)}A.style.height=C+"px",g.style.height=C+(y?a(y):0)+"px";var R={hudMessage:g,container:e};CT.instances.push(R)}},CT.dismiss=function(){if(CT.instances.length>0){var e=CT.instances.pop();return e.hudMessage.style.visibility="hidden",e.container.removeChild(e.hudMessage),!0}return!1},TT.prototype.registerLabel=function(e,t){const i=e.ownerDocument.createElement("div");i.className="progresslb",i.style.opacity="0",i.setAttribute("data-i18n",t),i.textContent=hs.t(t),this.labels.push(i),e.appendChild(i)},TT.prototype.setPercent=function(e,t){e!=this.lastValue&&(this.lastValue=e,e>=100?(this.bg.style.opacity="0",this.labels.forEach((e=>e.style.opacity="0"))):(this.bg.style.opacity="1",this.fg.style.transform=`scale(${e/100}, 1)`,this.showLabel&&this.labels.forEach(((e,i)=>e.style.opacity=t===i?"1":"0"))))},TT.prototype.setStyle=function(e){!this.fg.classList.contains(e)&&this.fg.classList.add(e)},TT.prototype.removeStyle=function(e){this.fg.classList.contains(e)&&this.fg.classList.remove(e)},MT.prototype.constructor=MT,Ba.prototype.apply(MT.prototype),MT.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var e=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(e)}},MT.prototype.setValue=function(e){this.blockEvent=!0,this.value=e,this.sliderElement.value=e,this.stepperElement.value=e,this.blockEvent=!1},MT.prototype.setDisabled=function(e){this.sliderElement.disabled=e,this.stepperElement.disabled=e,this.caption.disabled=e},fo.call(MT.prototype),IT.prototype.constructor=IT,Ba.prototype.apply(IT.prototype),fo.call(IT.prototype),IT.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var e=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(e)}},IT.prototype.setChecked=function(e){this.checkElement.checked!=e&&(this.checkElement.checked=e,this.fireChangeEvent())},IT.prototype.setValue=function(e){this.blockEvent=!0,this.checked=e,this.checkElement.checked=e,this.blockEvent=!1},IT.prototype.getValue=function(){return this.checkElement.checked},IT.prototype.setDisabled=function(e){this.checkElement.disabled=e,this.caption.disabled=e},IT.prototype.setVisibility=function(e){this.sliderRow.style.display=e?"table-row":"none"},fo.call(PT.prototype),fo.call(LT.prototype),RT.prototype.constructor=RT,Ba.prototype.apply(RT.prototype),RT.prototype.setSelectedIndex=function(e){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=e,this.blockEvent=!1},RT.prototype.setSelectedValue=function(e){this.blockEvent=!0,this.dropdownElement.selectedValue=e,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},RT.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex;var e=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(e)}},RT.prototype.setDisabled=function(e){this.dropdownElement.disabled=e,this.caption.disabled=e},fo.call(RT.prototype),fo.call(DT.prototype),fo.call(OT.prototype);class BT{constructor(e,t,i){this._parentDiv=e,this._renderRowFn=t,this._onClickFn=i,this._onRowClick=this._onRowClick.bind(this);const n=this.getDocument(),r=n.createElement("div");r.classList.add("settings-container"),this._parentDiv.appendChild(r),this._myContainer=r,this._myContainer.addEventListener("click",this._onRowClick,{capture:!0});const o=n.createElement("div");o.classList.add("settings-table"),this._rowsContainer=o,r.appendChild(o)}setData(e,t){this._removeAllRows(),this._items=e;for(let t=0;t<e.length;++t)this._addRow(t);this._updateSelection(t)}removeFromParent(){this._myContainer.removeEventListener("click",this._onRowClick,{capture:!0}),this._removeAllRows(),this._parentDiv.removeChild(this._myContainer),this._parentDiv=null,this._myContainer=null,this._rowsContainer=null,this._onClickFn=null,this._items=null}_addRow(e){const t=this._items[e],i=this.getDocument(),n=i.createElement("div");this._renderRowFn(n,t,{domDocument:i}),n.setAttribute("data-index",e),this._rowsContainer.appendChild(n)}_removeAllRows(){for(var e=this._rowsContainer.children;e.length;)this._rowsContainer.removeChild(e[0])}_updateSelection(e){const t=this._rowsContainer.children;for(let i=0;i<t.length;i++){const n=t[i];i===e?n.classList.add("border-select"):n.classList.remove("border-select")}}_onRowClick(e){for(var t,i=e.target;i!==this._myContainer&&!(t=i.getAttribute("data-index"));)i=i.parentNode;if(t){var n=parseInt(t);this._onClickFn(n)}}}function NT(e,t,i,n){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.movedSinceCreate=!1,this.parentContainer=e;var r=this.getDocument();this.container=r.createElement("div"),this.container.id=t,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=i,n=n||{},Object.prototype.hasOwnProperty.call(n,"localizeTitle")||(n.localizeTitle=!0),Object.prototype.hasOwnProperty.call(n,"addFooter")||(n.addFooter=!0),this.options=n,this.container.classList.add("docking-panel"),e.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)}function UT(e){var t=this;this.viewer=e,this.setGlobalManager(e.globalManager),NT.call(this,e.container,"RenderOptionsPanel","Rendering Options");let i=this.getDocument();this.table=i.createElement("table"),this.table.className="adsk-lmv-tftable",this.tbody=i.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0,this.saoToggle=new IT("AO Enabled",this.tbody,!0),this.saoToggle.setGlobalManager(this.globalManager),this.addEventListener(this.saoToggle,"change",(function(i){var n=t.saoToggle.checked;e.prefs.set("ambientShadows",n),e.setQualityLevel(n,e.impl.renderer().settings.antialias)})),this.saoRadius=new MT("AO Radius",0,200,this.tbody),this.saoRadius.setGlobalManager(this.globalManager),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=.01,this.addEventListener(this.saoRadius,"change",(function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()})),this.saoIntensity=new MT("AO Intensity",0,3,this.tbody),this.saoIntensity.setGlobalManager(this.globalManager),this.saoIntensity.setValue(.4),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.01,this.addEventListener(this.saoIntensity,"change",(function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()})),this.groundShadowAlpha=new MT("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setGlobalManager(this.globalManager),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",(function(i){e.setGroundShadowAlpha(parseFloat(t.groundShadowAlpha.value))})),this.groundShadowColor=new IT("Shadow Color",this.tbody),this.groundShadowColor.setGlobalManager(this.globalManager),this.groundShadowColor.checkElement.value="#000000",this.groundShadowColor.checkElement.type="color",this.addEventListener(this.groundShadowColor,"change",(function(i){var n=t.groundShadowColor.checkElement.value;e.setGroundShadowColor(new THREE.Color(parseInt(n.substr(1,7),16)))})),this.groundReflectionAlpha=new MT("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setGlobalManager(this.globalManager),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",(function(i){e.setGroundReflectionAlpha(parseFloat(t.groundReflectionAlpha.value))})),this.groundReflectionColor=new IT("Reflection Color",this.tbody),this.groundReflectionColor.setGlobalManager(this.globalManager),this.groundReflectionColor.checkElement.value="#000000",this.groundReflectionColor.checkElement.type="color",this.addEventListener(this.groundReflectionColor,"change",(function(i){var n=t.groundReflectionColor.checkElement.value;e.setGroundReflectionColor(new THREE.Color(parseInt(n.substr(1,7),16)))}));for(var n=[],r=0;r<xo.length;r++)n.push(xo[r].name);this.envSelect=new RT("Environment",this.tbody,n,e.impl.currentLightPreset()),this.envSelect.setGlobalManager(this.globalManager),this.addEventListener(this.envSelect,"change",(function(i){var n=t.envSelect.selectedIndex;e.setLightPreset(n)}));var o=e.impl.renderer().getToneMapMethod();this.toneMapMethod=new RT("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],o),this.toneMapMethod.setGlobalManager(this.globalManager),this.addEventListener(this.toneMapMethod,"change",(function(){var i=t.toneMapMethod.selectedIndex;e.impl.setTonemapMethod(i)})),this.exposureBias=new MT("Exposure Bias",-30,30,this.tbody),this.exposureBias.setGlobalManager(this.globalManager),this.exposureBias.setValue(e.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",(function(i){e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)})),this.exposureBias.setDisabled(0==o),this.whiteScale=new MT("Light Intensity",-5,20,this.tbody),this.whiteScale.setGlobalManager(this.globalManager);var s=0;e.impl.dir_light1&&(s=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(s),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",(function(i){e.impl.dir_light1.intensity=Math.pow(2,t.whiteScale.value),e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)})),this.fovAngle=new MT("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setGlobalManager(this.globalManager),this.fovAngle.setValue(e.getFOV()),this.addEventListener(this.fovAngle,"change",(function(i){e.setFOV(parseFloat(t.fovAngle.value))})),this.frameRate=new MT("Frame rate",1,100,this.tbody),this.frameRate.setGlobalManager(this.globalManager),this.frameRate.setValue(e.impl.getFrameRate()),this.frameRate.sliderElement.step=this.frameRate.stepperElement.step=1,this.addEventListener(this.frameRate,"change",(function(i){e.impl.setFrameRate(t.frameRate.value)})),this.addEventListener(this.viewer,Sr,(function(i){var n=parseFloat(t.fovAngle.value),r=e.getFOV();n!=r&&t.fovAngle.setValue(r)})),this.addEventListener(this.viewer,Ir,(function(e){t.syncUI()})),this.addEventListener(this.viewer,Nn,(function(e){t.syncUI()})),this.addVisibilityListener((function(e){e&&t.resizeToContent()}))}fo.call(BT.prototype),fo.call(NT.prototype),NT.prototype.onSetGlobalManager=function(e){this.footerInstance&&this.footerInstance.setGlobalManager(e)},NT.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer),this.options.addFooter&&(this.footer=this.createFooter(),this.container.appendChild(this.footer))},NT.prototype.uninitialize=function(){for(var e=0;e<this.listeners.length;++e){var t=this.listeners[e];t.target.removeEventListener(t.eventId,t.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},NT.prototype.addVisibilityListener=function(e){this.visibilityCallbacks.push(e)},NT.prototype.setVisible=function(e){if(e){var t=this.getContainerBoundingRect();if(this.container.dockRight){var i=t.width,n=300,r=this.container.lastWidth||this.container.style.width;r||(r=this.container.getBoundingClientRect().width),r&&(n=parseInt(r)),this.container.style.left=i-n+"px"}if(this.container.dockBottom){var o=t.height,s=300,a=this.container.lastHeight||this.container.style.height;a||(a=this.container.getBoundingClientRect().height),a&&(s=parseInt(a));var l=o-s;this.container.style.top=l>0?l+"px":0}this.container.style.maxHeight=t.height+"px",this.container.style.maxWidth=t.width+"px",this.container.style.display="block",this.bringToFront()}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(var c=0;c<this.visibilityCallbacks.length;c++)this.visibilityCallbacks[c](e)},NT.prototype.isVisible=function(){return"block"===this.container.style.display},NT.prototype.visibilityChanged=function(){},NT.prototype.initializeMoveHandlers=function(e){var t,i,n,r,o,s,a,l,c=this.container,u=this;function h(e){var h=c.style.minWidth?parseInt(c.style.minWidth):u.kMinWdth,d=c.style.minHeight?parseInt(c.style.minHeight):u.kMinHeight,f=u.getContainerBoundingRect();c.style.maxWidth&&parseInt(c.style.width)>parseInt(c.style.maxWidth)&&(c.style.width=c.style.maxWidth),c.style.maxHeight&&parseInt(c.style.height)>parseInt(c.style.maxHeight)&&(c.style.height=c.style.maxHeight),parseInt(c.style.width)<h&&(c.style.width=h+"px"),parseInt(c.style.height)<d&&(c.style.height=d+"px"),"touchmove"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),a+=e.screenX-n,l+=e.screenY-r,t=o+a,i=s+l;var p=parseInt(c.style.width),m=parseInt(c.style.height);isNaN(p)&&(p=u.container.getBoundingClientRect().width),isNaN(m)&&(m=u.container.getBoundingClientRect().height),t<5&&(t=0),i<5&&(i=0),c.dockRight=!1,c.dockBottom=!1,f.width-5<t+p&&(t=f.width-p,c.dockRight=!0),f.height-5<i+m&&(i=f.height-m,c.dockBottom=!0),c.style.left=t+"px",c.style.top=i+"px",c.style.maxWidth=f.width-t+"px",c.style.maxHeight=f.height-i+"px",n=e.screenX,r=e.screenY,u.onMove(e,t,i)}function d(e){u.removeWindowEventListener("mousemove",h),u.removeWindowEventListener("mouseup",d),u.removeWindowEventListener("touchmove",h),u.removeWindowEventListener("touchend",d),u.onEndMove(e,t,i)}function f(e){"touchstart"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),n=e.screenX,r=e.screenY,a=0,l=0,o=u.container.offsetLeft,s=u.container.offsetTop,u.addWindowEventListener("mousemove",h,!1),u.addWindowEventListener("mouseup",d,!1),u.addWindowEventListener("touchmove",h,!1),u.addWindowEventListener("touchend",d,!1),e.preventDefault(),u.onStartMove(e,o,s)}u.addEventListener(e,"mousedown",f),u.addEventListener(e,"touchstart",f)},NT.prototype.initializeCloseHandler=function(e){var t=this;t.addEventListener(e,"click",(function(){t.setVisible(!1)}),!1)},NT.prototype.createScrollContainer=function(e){var t=this.getDocument().createElement("div"),i=t.classList;return i.add("docking-panel-scroll"),i.add("docking-panel-container-solid-color-a"),i.add(e&&e.left?"left":"right"),e&&e.heightAdjustment&&(t.style.height="calc(100% - "+e.heightAdjustment+"px)"),e&&e.marginTop&&(t.style.marginTop=e.marginTop+"px"),t.id=this.container.id+"-scroll-container",this.container.appendChild(t),this.scrollContainer=t,this.scrollEaseCurve=e&&e.scrollEaseCurve||[0,0,.29,1],this.scrollEaseSpeed=e&&e.scrollEaseSpeed||.003,t},NT.prototype.createTitleBar=function(e){var t=this.getDocument().createElement("div");t.classList.add("docking-panel-title"),t.textContent=e;var i=this;return i.addEventListener(t,"click",(function(e){i.movedSinceLastClick||i.onTitleClick(e),i.movedSinceLastClick=!1})),i.addEventListener(t,"mousedown",(function(){i.bringToFront()})),i.addEventListener(t,"dblclick",(function(e){i.onTitleDoubleClick(e)})),t},NT.prototype.createFooter=function(){var e=new DT(this.container);return e.setGlobalManager(this.globalManager),this.footerInstance=e,this.container.style.resize="none",e.footer},NT.prototype.setTitle=function(e,t){t&&t.localizeTitle?(this.title.setAttribute("data-i18n",e),e=hs.t(e,t.i18nOpts)):this.title.removeAttribute("data-i18n"),this.title.textContent=e},NT.prototype.createCloseButton=function(){var e=this.getDocument().createElement("div");return e.className="docking-panel-close",this.initializeCloseHandler(e),e},NT.prototype.onStartMove=function(){},NT.prototype.onEndMove=function(){},NT.prototype.onMove=function(){this.movedSinceLastClick=!0,this.movedSinceCreate=!0},NT.prototype.onTitleClick=function(){},NT.prototype.onTitleDoubleClick=function(){},NT.prototype.addEventListener=function(e,t,i){e.addEventListener(t,i),this.listeners.push({target:e,eventId:t,callback:i})},NT.prototype.removeEventListener=function(e,t,i){for(var n=0;n<this.listeners.length;++n){var r=this.listeners[n];if(r.target===e&&r.eventId===t&&r.callback===i)return e.removeEventListener(t,i),this.listeners.splice(n,1),!0}return!1},NT.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},NT.prototype.resizeToContent=function(e){if(this.isVisible()){var t=this.getContentSize().height,i=this.container.getBoundingClientRect(),n=this.getContainerBoundingRect(),r=this.container.querySelector(".docking-panel-footer");r&&(t+=r.getBoundingClientRect().height);var o=n.height;o-=i.top-n.top+75,e&&void 0!==e.maxHeight&&(o=Math.min(o,e.maxHeight)),t>o&&(t=o),this.container.style.maxHeight=o.toString()+"px",this.container.style.height=t.toString()+"px"}},NT.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},NT.prototype.animateScroll=function(e,t,i){var n=this.scrollEaseCurve,r=this.scrollEaseSpeed,o=this.scrollContainer;var s=performance.now();requestAnimationFrame((function a(l){var c=(l-s)*r;c=Math.min(c,1);var u=function(e,t){var i=3*e[1],n=3*(e[3]-e[1])-i;return(((1-i-n)*t+n)*t+i)*t}(n,c),h=e+(t-e)*u;o.scrollTop=h,i&&i(h),c<1&&requestAnimationFrame(a)}))},NT.prototype.onViewerResize=function(e,t,i,n,r,o){var s=this.container,a=s.getBoundingClientRect(),l=a.width,c=a.height;if(!l||!c)return!1;var u=a.top,h=a.bottom,d=a.left,f=a.right;return r<l&&(l=Math.round(r),s.style.width=l+"px"),o<c&&(c=Math.round(o),s.style.height=c+"px"),(n<f||s.dockRight)&&(d=Math.round(n-l-i),s.style.left=d+"px"),(t<h||s.dockBottom)&&((u=Math.round(t-c-e))<0&&(u=0),s.style.top=u+"px"),s.style.maxWidth=Math.round(r)+"px",s.style.maxHeight=Math.round(o)+"px",!0},NT.prototype.bringToFront=function(){var e=this.scrollContainer?this.scrollContainer.scrollTop:0;this.parentContainer.appendChild(this.container),this.scrollContainer&&(this.scrollContainer.scrollTop=e)},UT.prototype=Object.create(NT.prototype),UT.prototype.constructor=UT,UT.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},UT.prototype.syncUI=function(){var e=this.viewer.impl,t=0;e.dir_light1&&(t=0!=e.dir_light1.intensity?Math.log(e.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(t),this.exposureBias.setValue(e.renderer().getExposureBias());var i=e.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(i),this.envSelect.setSelectedIndex(e.currentLightPreset()),this.exposureBias.setDisabled(0==i),this.saoToggle.setValue(e.renderer().getAOEnabled()),this.saoRadius.setDisabled(!e.renderer().getAOEnabled()),this.saoIntensity.setDisabled(!e.renderer().getAOEnabled()),this.saoRadius.setValue(e.renderer().getAORadius()),this.saoIntensity.setValue(e.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV())},UT.prototype.uninitialize=function(){NT.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,this.whiteScale=null,this.fovAngle=null,this.viewer=null};const kT=40;function FT(e,t,i,n){NT.call(this,e,t,i,n),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0,this.shown=!1;var r=this,o=n&&void 0!==n.width?n.width:340;this.container.style.maxWidth="800px",this.container.style.minWidth=o+"px",this.container.style.top="10px",this.container.style.left=e.offsetWidth/2-170+"px",this.container.style.position="absolute";var s=this.getDocument();this.tabContainer=s.createElement("div"),this.tabContainer.classList.add("docking-panel-container-solid-color-b"),this.tabContainer.classList.add("settings-tabs"),this.tabContainer.classList.add("docking-panel-delimiter-shadow"),this.container.appendChild(this.tabContainer),this.tabs=s.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=n&&n.heightAdjustment?n.heightAdjustment:179,n&&n.hideTabBar&&(this.heightAdjustment-=kT,this.tabContainer.style.display="none",this.tabContainer.style.height=0),this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.tablesContainer=s.createElement("div"),this.tablesContainer.classList.add("settings-tabs-tables-container"),n&&n.hideTabBar&&(this.scrollContainer.style.top=90-kT+"px"),this.scrollContainer.appendChild(this.tablesContainer),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",(function(e){var t=e.toElement||e.relatedTarget;if(r.mouseOver)return!0;for(var i=r.getWindow();t&&t.parentNode&&t.parentNode!=i;){if(t.parentNode==this||t==this){t.preventDefault&&t.preventDefault(),r.mouseOver=!0;for(var n=0;n<r.panelTabs.length;n++)r.panelTabs[n].classList.remove("selectedmouseout");return!0}t=t.parentNode}})),this.addEventListener(this.container,"mouseout",(function(e){var t=e.toElement||e.relatedTarget;if(r.mouseOver){for(var i=r.getWindow();t&&t.parentNode&&t.parentNode!=i;){if(t.parentNode==this||t==this)return t.preventDefault&&t.preventDefault(),!1;t=t.parentNode}r.mouseOver=!1;for(var n=0;n<r.panelTabs.length;n++)r.panelTabs[n].classList.contains("tabselected")&&r.panelTabs[n].classList.add("selectedmouseout")}})),this.expandID=function(e){return t+"-"+e}}function VT(e,t){ST.call(this,e,t);var i=this;this._activeButton=null,this._handleButtonStateChange=function(e){var t=xT.State;e.state===t.ACTIVE?(i._activeButton=e.target,i.dispatchEvent({type:VT.Event.ACTIVE_BUTTON_CHANGED,button:e.target,isActiveButton:!0}),i._controls.forEach((function(i){i!==e.target&&i.getState()!==t.DISABLED&&i.setState(t.INACTIVE)}))):e.target===i._activeButton&&(i._activeButton=null,i.dispatchEvent({type:VT.Event.ACTIVE_BUTTON_CHANGED,button:e.target,isActiveButton:!1}))}}function GT(e,t){ST.call(this,e,t),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar"),t&&t.alignVertically&&this.addClass("adsk-toolbar-vertical")}function zT(e,t){null!=t&&t.globalManager&&this.setGlobalManager(t.globalManager),GT.call(this,e,t),this.onToolbarUpdated=(null==t?void 0:t.onToolbarUpdated)||function(){},this.screenModeDelegate=null==t?void 0:t.screenModeDelegate,this.navigation=null==t?void 0:t.navigation,this.onClickViewerOption=(null==t?void 0:t.onClickViewerOption)||function(){},this.onClickRenderOptions=(null==t?void 0:t.onClickRenderOptions)||function(){},this.onClickFullScreen=(null==t?void 0:t.onClickFullScreen)||function(){},this.navTools=new VT(vT.NAVTOOLSID),this.modelTools=new ST(vT.MODELTOOLSID),this.settingsTools=new ST(vT.SETTINGSTOOLSID),this.addControl(this.navTools),this.addControl(this.modelTools),this.addControl(this.settingsTools)}function HT(){this.getContainerBoundingRect=function(){var e=this.parentContainer.getBoundingClientRect(),t={height:0,width:0,left:0,bottom:0,right:0,top:0},i=this.getDocument().getElementsByClassName("toolbar-menu");return i&&i.length>0&&(t=i[0].getBoundingClientRect()),{height:e.height-t.height,width:e.width,left:e.left,bottom:e.bottom-t.height,right:e.right,top:e.top}}}FT.prototype=Object.create(NT.prototype),FT.prototype.constructor=FT,FT.prototype.setVisible=function(e){e&&(this.container.style.display="block",this.shown||(this.resizeToContent(),this.container.style.left=this.parentContainer.offsetWidth/2-this.container.getBoundingClientRect().width/2+"px"),this.shown=!0),NT.prototype.setVisible.call(this,e)},FT.prototype.addTab=function(e,t,i){var n=this;if(void 0!==this.tabIdToIndex[e])return!1;var r=i&&void 0!==i.className?i.className:null,o=i&&void 0!==i.width?i.width:200,s=i&&void 0!==i.index?i.index:this.panelTabs.length;var a=this.getDocument(),l=a.createElement("li");l._id=e,l.id=this.expandID(l._id),l.classList.add(r);var c=a.createElement("a"),u=a.createElement("span");u.setAttribute("data-i18n",t),u.textContent=hs.t(t),c.appendChild(u),l.appendChild(c),this.tabs.appendChild(l);var h=a.createElement("table");h._id=e+"-table",h.id=this.expandID(h._id),h.classList.add("settings-table"),h.classList.add("adsk-lmv-tftable"),h.classList.add(r);var d=a.createElement("tbody");return d.style.display="table",d.style.width="100%",h.appendChild(d),this.tablesContainer.appendChild(h),this.addEventListener(l,"touchstart",Q),this.addEventListener(l,"click",(function(){n.selectTab(e)})),this.panelTabs.push(l),this.tabIdToIndex[e]=s,o>(this.container.style.minWidth?parseInt(this.container.style.minWidth):0)&&(this.container.style.minWidth=o+"px"),!0},FT.prototype.removeTab=function(e){var t=this.tabIdToIndex[e];if(!t)return!1;this.panelTabs.splice(t,1);var i=this.getDocument().getElementById(this.expandID(e));this.tabs.removeChild(i),this.tabIdToIndex={};for(var n=this.panelTabs.length,r=0;r<n;r++){var o=this.panelTabs[r];this.tabIdToIndex[o._id]=r,this.removeEventListener(o,"touchstart",Q)}return!0},FT.prototype.resizeTabs=function(){for(var e=this.tabs.getElementsByTagName("li"),t=100/e.length,i=0;i<e.length;i++)e[i].style.width=t+"%"},FT.prototype.hasTab=function(e){var t=this.tabIdToIndex[e];return void 0!==this.panelTabs[t]},FT.prototype.selectTab=function(e){if(this.isTabSelected(e))return!1;for(var t=this.getDocument(),i=this.panelTabs.length,n=0;n<i;n++){var r=this.panelTabs[n],o=t.getElementById(this.expandID(r._id+"-table"));e===r._id?(r.classList.add("tabselected"),o.classList.add("settings-selected-table"),this.mouseOver||r.classList.add("selectedmouseout")):(r.classList.remove("tabselected"),o.classList.remove("settings-selected-table"),this.mouseOver||this.panelTabs[n].classList.remove("selectedmouseout"))}return this.scrollContainer.scrollTop=0,!0},FT.prototype.isTabSelected=function(e){var t=this.tabIdToIndex[e],i=this.panelTabs[t];return i&&i.classList.contains("tabselected")},FT.prototype.getSelectedTabId=function(){for(var e in this.tabIdToIndex)if(this.isTabSelected(e))return e;return null},FT.prototype.addLabel=function(e,t){var i=this.tabIdToIndex[e];if(-1===i)return!1;var n=new PT(t,this.tablesContainer.childNodes[i].tBodies[0]);return n.setGlobalManager(this.globalManager),n.sliderRow.classList.add("logical-group"),n},FT.prototype.addButton=function(e,t){var i=this.tabIdToIndex[e];if(void 0===i)return null;var n=new LT(t,this.tablesContainer.childNodes[i].tBodies[0]);return n.setGlobalManager(this.globalManager),this.addControl(e,n)},FT.prototype.addCheckbox=function(e,t,i,n,r,o){var s=this.tabIdToIndex[e];if(void 0===s)return null;var a=new IT(t,this.tablesContainer.childNodes[s].tBodies[0],i,r,this.globalManager,o);return a.changeListener=function(e){var t=e.detail.target.checked;n(t)},this.addEventListener(a,"change",a.changeListener),this.addControl(e,a)},FT.prototype.addRow=function(e,t,i,n){if(void 0===this.tabIdToIndex[e])return null;var r=new OT(t,this.getDocument().getElementById(this.expandID(e+"-table")).tBodies[0],i,n);return r.setGlobalManager(this.globalManager),this.addControl(e,r)},FT.prototype.addSlider=function(e,t,i,n,r,o,s){if(void 0===this.tabIdToIndex[e])return null;var a=new MT(t,i,n,this.getDocument().getElementById(this.expandID(e+"-table")).tBodies[0],s);a.setGlobalManager(this.globalManager),a.setValue(r);var l=1;return s&&s.step&&(l=s.step),a.sliderElement.step=a.stepperElement.step=l,this.addEventListener(a,"change",(function(e){o(e)})),this.addControl(e,a)},FT.prototype.addSliderV2=function(e,t,i,n,r,o,s,a){(a=a||{}).hideStepper=!0,a.hideCaption=!0;const l=[];return l.push(this.addRow(e,t,i,a)),l.push(this.addSlider(e,t,n,r,o,s,a)),l},FT.prototype.addDropDownMenu=function(e,t,i,n,r,o){if(void 0===this.tabIdToIndex[e])return null;var s=new RT(t,this.getDocument().getElementById(this.expandID(e+"-table")).tBodies[0],i,n,null,this.globalManager,o);return s.setGlobalManager(this.globalManager),this.addEventListener(s,"change",(function(e){r(e)})),this.addControl(e,s)},FT.prototype.addControl=function(e,t,i){if(void 0===this.tabIdToIndex[e])return null;if(!Object.prototype.hasOwnProperty.call(t,"sliderRow")){var n=i&&i.insertAtIndex?i.insertAtIndex:-1,r=i&&i.caption?i.caption:null,o=this.getDocument(),s=o.getElementById(this.expandID(e+"-table"));n>s.length&&(n=-1);var a=s.tBodies[0].insertRow(n),l=a.insertCell(0);if(r){var c=o.createElement("div");c.setAttribute("data-i18n",r),c.textContent=hs.t(r),l.appendChild(c),l=a.insertCell(1)}else l.colSpan=3;l.appendChild(t),t.sliderRow=a,t.tbody=s.tBodies[0]}var u=this.expandID("adsk_settings_control_id_"+this.controlIdCount.toString());return this.controlIdCount=this.controlIdCount+1,this.controls[u]=t,t.parent=this,u},FT.prototype.removeButton=function(e){return this.removeControl(e)},FT.prototype.removeCheckbox=function(e){return this.removeControl(e)},FT.prototype.removeSlider=function(e){return this.removeControl(e)},FT.prototype.removeDropdownMenu=function(e){return this.removeControl(e)},FT.prototype.removeControl=function(e){var t;if("object"==typeof e&&e.tbody){for(var i in t=e,this.controls)if(this.controls[i]===t){e=i;break}}else t=this.controls[e];if(void 0===t)return!1;if(t.removeFromParent)t.removeFromParent();else{var n=t.tbody,r=t.sliderRow.rowIndex;n.deleteRow(r)}return delete this.controls[e],t.parent=void 0,!0},FT.prototype.getControl=function(e){return this.controls[e]||null},FT.prototype.getContentSize=function(){for(var e=this.heightAdjustment,t=0,i=this.getDocument(),n=0;n<this.panelTabs.length;n++){var r=this.panelTabs[n],o=i.getElementById(this.expandID(r._id+"-table")),s=o?o.clientHeight:0;t=Math.max(t,s)}return{height:e+t,width:this.container.clientWidth}},FT.prototype.sizeToContent=function(e){var t=this.getContentSize().height+this.heightAdjustment,i=e.clientHeight-this.heightAdjustment,n=Math.min(t,i);this.container.style.height=parseInt(n)+"px"},FT.prototype.addSimpleList=function(e,t,i){var n=new BT(e,t,i);return n.setGlobalManager(this.globalManager),n},FT.prototype.removeSimpleList=function(e){return!!e&&(e.removeFromParent(),!0)},VT.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:bT.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:bT.Event.COLLAPSED_CHANGED,CONTROL_ADDED:ST.Event.CONTROL_ADDED,CONTROL_REMOVED:ST.Event.CONTROL_REMOVED,SIZE_CHANGED:ST.Event.SIZE_CHANGED},VT.prototype=Object.create(ST.prototype),VT.prototype.constructor=VT,VT.prototype.addControl=function(e,t){return e instanceof xT&&(!!ST.prototype.addControl.call(this,e,t)&&(e.addEventListener(xT.Event.STATE_CHANGED,this._handleButtonStateChange),!0))},VT.prototype.removeControl=function(e){var t="string"==typeof e?this.getControl(e):e;return!(null===t||!ST.prototype.removeControl.call(this,t))&&(t.removeEventListener(xT.Event.STATE_CHANGED,this._handleButtonStateChange),!0)},VT.prototype.getActiveButton=function(){return this._activeButton},GT.Event={VISIBILITY_CHANGED:bT.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:bT.Event.COLLAPSED_CHANGED,CONTROL_ADDED:ST.Event.CONTROL_ADDED,CONTROL_REMOVED:ST.Event.CONTROL_REMOVED,SIZE_CHANGED:ST.Event.SIZE_CHANGED},GT.prototype=Object.create(ST.prototype),GT.prototype.constructor=GT,fo.call(zT.prototype),zT.prototype=Object.create(GT.prototype),zT.prototype.constructor=zT,zT.prototype.initRenderOptionsButton=function(){this.settingsTools&&!this.renderOptionsButton&&(this.renderOptionsButton=new xT("toolbar-renderOptionsTool"),this.renderOptionsButton.setToolTip("Rendering options"),this.renderOptionsButton.setIcon("adsk-icon-settings-render"),this.renderOptionsButton.onClick=this.onClickRenderOptions,this.settingsTools.addControl(this.renderOptionsButton))},zT.prototype.initSettingsOptionsButton=function(){var e=new xT("toolbar-settingsTool");this.viewerOptionButton=e,e.setIcon("adsk-icon-settings"),e.setToolTip("Settings"),this.viewerOptionButton.onClick=this.onClickViewerOption,this.settingsTools.addControl(e)},zT.prototype.initModelTools=function(){if(!this.settingsTools.fullscreenbutton){var e=new xT("toolbar-fullscreenTool",{collapsible:!1});e.setToolTip("Full screen"),e.setIcon("adsk-icon-fullscreen"),e.onClick=this.onClickFullScreen,this.settingsTools.addControl(e),this.settingsTools.fullscreenbutton=e,this.updateFullscreenButton(this.screenModeDelegate.getMode())}},zT.prototype.updateFullscreenButton=function(e){var t="adsk-icon-fullscreen";switch(e){case $a.kNormal:this.screenModeDelegate.isModeSupported($a.kFullBrowser)||(t="adsk-icon-fullscreen");break;case $a.kFullBrowser:t=this.screenModeDelegate.isModeSupported($a.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case $a.kFullScreen:t="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(t)},zT.prototype.updateToolbarButtons=function(e,t){var i,n,r;r=e>310,(n=this.modelTools.getControl("toolbar-explodeTool"))&&n.setVisible(r),r=e>380?"block":"none",(n=this.modelTools.getControl("toolbar-collaborateTool"))&&n.setDisplay(r),r=e>515?"block":"none";var o=this.navTools.getControl("toolbar-cameraSubmenuTool");o&&(o.setDisplay(r),(n=o.subMenu.getControl("toolbar-homeTool"))&&n.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(n=o.subMenu.getControl("toolbar-fitToViewTool"))&&n.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(n=o.subMenu.getControl("toolbar-focalLengthTool"))&&n.setDisplay(this.navigation.isActionEnabled("fov")?"block":"none"),(n=o.subMenu.getControl("toolbar-rollTool"))&&n.setDisplay(this.navigation.isActionEnabled("roll")?"block":"none")),r=e>700?"block":"none",(n=this.modelTools.getControl("toolbar-measureTool"))&&n.setDisplay(r),(n=this.modelTools.getControl("toolbar-sectionTool"))&&n.setDisplay(r),r=e>740?"block":"none",(n=this.navTools.getControl("toolbar-beelineTool"))&&n.setDisplay(this.navigation.isActionEnabled("walk")?r:"none"),(n=this.navTools.getControl("toolbar-firstPersonTool"))&&n.setDisplay(this.navigation.isActionEnabled("walk")?r:"none"),(n=this.navTools.getControl("toolbar-zoomTool"))&&n.setDisplay(this.navigation.isActionEnabled("zoom")?r:"none"),(n=this.navTools.getControl("toolbar-panTool"))&&n.setDisplay(this.navigation.isActionEnabled("pan")?r:"none"),(n=this.navTools.getControl("toolbar-orbitTools"))&&n.setDisplay(this.navigation.isActionEnabled("orbit")?r:"none"),null===(i=this.onToolbarUpdated)||void 0===i||i.call(this,e,t)},zT.prototype.registerCustomizeToolbarCB=function(e){this.onToolbarUpdated=e};class WT{constructor(e,t){this._width=e||60,this._height=t||60}createThumbnail(e,t){return new Promise((t=>{var i=this.getDocument().createElement("canvas");i.width=this._width,i.height=this._height;var n=i.getContext("2d"),r=n.createLinearGradient(0,0,0,i.height),o=e.bgColorGradient,s=jT(o[0],o[1],o[2]),a=jT(o[3],o[4],o[5]);r.addColorStop(0,s),r.addColorStop(1,a),n.fillStyle=r,n.fillRect(0,0,i.width,i.height),i.toBlob((function(e){var i=URL.createObjectURL(e);t(i)}))}))}}function jT(e,t,i){return e=parseInt(e),t=parseInt(t),i=parseInt(i),"#"+qT(e)+qT(t)+qT(i)}function qT(e){if(0===e)return"00";for(var t="",i=e>255?255:e;0!==i;){var n=i%16;i=i/16|0,t=KT[n.toString()]+t}return t.length>1?t:"0"+t}fo.call(WT.prototype);const KT={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"};var XT=r(38221),YT=r.n(XT);const QT=Autodesk.Viewing,ZT=QT.Private;let $T=0,JT={Navigation:"navigationtab",Configuration:"performancetab",Appearance:"appearance",Environment:"environment"};var eM=0;function tM(e,t){var i,n,r;let o={...e};if(this.viewer=null,e instanceof Autodesk.Viewing.GuiViewer3D||e instanceof Autodesk.Viewing.Viewer3D){const t=e;o={preferences:t.prefs,globalManager:t.globalManager,addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t),container:t.container,version:t.config.viewerVersion,onRestoreDefaults:t.restoreDefaultSettings.bind(t),detectIfModelsHaveEdge:sM.bind(this),loadExtension:t.loadExtension.bind(t),unloadExtension:t.unloadExtension.bind(t),width:400,heightAdjustment:110},this.viewer=t}this.options=o,this.preferences=o.preferences,this.is3dMode=!t.is2d();const s="pdf"===(null===(i=t.getDocumentNode())||void 0===i?void 0:i.getInputFileType()),a=null===(n=t.getDocumentNode())||void 0===n||null===(n=n.data)||void 0===n||null===(n=n.extractor)||void 0===n?void 0:n.includes("pdf");this.isPdfFile=s||a,this.enableVectorRasterSwitch=null==e||null===(r=e._curOptions)||void 0===r?void 0:r.enableVectorRasterSwitch,this.visible=!1,this._externalButtonIds=[],this._externalButtonsLabel=null,FT.call(this,this.options.container,"ViewerSettingsPanel"+$T+++"-"+eM++,"Settings",o),this.container.classList.add("viewer-settings-panel"),this.setGlobalManager(this.options.globalManager),this.addTab(JT.Configuration,"Configuration",{className:"performance"}),this.addTab(JT.Navigation,"Navigation",{className:"navigation"}),this.addTab(JT.Appearance,"Appearance",{className:"appearance"}),this.is3dMode?this.addTab(JT.Environment,"Environment",{className:"environment"}):this.container.classList.add("for-2d-model"),this.createRestoreDefaultSettingsButton(),this.modelPreferenceCount=0,this.createNavigationPanel(),this.createConfigurationPanel(),this.createAppearancePanel(),this.modelPreferenceCount&&rt.log("Model locked ("+this.modelPreferenceCount+") render settings in UI."),this.selectTab(JT.Configuration),this.footer=this.createFooter(),this.createVersionLabel(this.footer),this.syncUI=this.syncUI.bind(this),this.options.addEventListener(Br,this.syncUI),this.options.addEventListener(Nn,this.syncUI),this.updateEdgeToggle=this.updateEdgeToggle.bind(this),this.options.addEventListener(Wn,this.updateEdgeToggle),this.sendAnalyticsDebounced=YT()(oM,500)}function iM(e,t,i){e.createThumbnail(i).then((e=>{t.src=e,t.onload=function(){URL.revokeObjectURL(e)}}))}function nM(e,t){const i=!QT.FeatureFlags.isEnabled(Ns.LargeModelExperienceOptOut),n=QT.FeatureFlags.isEnabled(Us.WebGPUBackend);if(!i||!n)return;const r=e.largeModelExperienceChkBoxId,o=e.getControl(r);if(o)if(t&&!an)o.setValue(!1),o.setDisabled(!0),o.sliderRow.style.opacity=.5;else{o.setDisabled(!1),o.sliderRow.style.opacity="";const t=e.preferences.get(Mn.LARGE_MODEL_EXPERIENCE);e.setControlValue(r,t)}}function rM(e,t,i){const n={i18nOptions:{nsSeparator:!1,keySeparator:!1},betaLabel:!0};i&&(QT.FeatureFlags.isEnabled(Ns.LargeModelExperienceOptOut)||(e.largeModelExperienceChkBoxId=e.addCheckbox(t,"Large model experience","Improves your overall experience viewing large models. The changes will take effect on the next page load.",!1,void 0,Mn.LARGE_MODEL_EXPERIENCE,n))),QT.FeatureFlags.isEnabled(Us.WebGPUBackend)&&(e.webgpuChkBoxId=e.addCheckbox(t,"WebGPU Graphics","Use WebGPU for rendering (requires page reload). Not all features are supported, may cause instabilities.",!1,(t=>nM(e,t)),Pn.WEBGPU,n))}function oM(e,t){ZT.analytics.track("viewer.settings.changed",{setting_name:e,setting_value:t})}function sM(){if(!this.is3dMode)return!1;let e=!1;const t=this.viewer.impl.modelQueue().getModels();for(let i=0;i<t.length;i++){if(t[i].hasEdges){e=!0;break}}return e}function aM(e,t){t||(t={}),t.startOnInitialize=!1,Ww.call(this,e,t),this.toolbar=null,this.dockingPanels=[],this.onFullScreenModeEvent=this.onFullScreenModeEvent.bind(this),this.onProgressBarUpdate=this.onProgressBarUpdate.bind(this),this.progressInModelLoad=!1,this.progressInModelOptimizing=!1}function lM(){}function cM(e,t,i,n){this.myDelegate=e,this.mySelectedNodes=[],this.myOptions=n||{},this.parentContainer=i;this.groupClassName=this.myOptions.groupClassName||"expanded",this.leafClassName=this.myOptions.leafClassName||"expanded",this.selectedClassName=this.myOptions.selectedClassName||"selected",this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={};var r=this.myRootContainer=this.createHtmlElement_(i,"div","treeview"),o=this.rootElem=this.createElement_(t,r,n,0);this.setInputHandlers_(),n&&n.excludeRoot&&o.classList.add("exclude")}function uM(e,t,i,n){NT.call(this,e,t,i,n),this.title.classList.add("docking-panel-delimiter-shadow"),this.container.classList.add("property-panel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:70,marginTop:0}),this.highlightableElements={};var r=this;var o=function(){var e=new lM;function t(e){return"category"===e.type}return e.setGlobalManager(r.globalManager),e.getTreeNodeId=function(e){return e.name+(Object.prototype.hasOwnProperty.call(e,"value")?e.value:"")+(Object.prototype.hasOwnProperty.call(e,"category")?e.category:"")},e.getTreeNodeClass=function(e){return t(e)?r.getCategoryClass(e):r.getPropertyClass(e)},e.isTreeNodeGroup=function(e){return t(e)},e.onTreeNodeClick=function(e,i,n){t(i)?r.onCategoryClick(i,n):r.onPropertyClick(i,n)},e.onTreeNodeRightClick=function(e,i,n){t(i)?r.onCategoryRightClick(i,n):r.onPropertyRightClick(i,n)},e.onTreeNodeDoubleClick=function(e,i,n){t(i)?r.onCategoryDoubleClick(i,n):r.onPropertyDoubleClick(i,n)},e.onTreeNodeIconClick=function(e,i,n){t(i)?r.onCategoryIconClick(i,n):r.onPropertyIconClick(i,n)},e.createTreeNode=function(e,i,n){var o=null;(o=t(e)?r.displayCategory(e,i,n):r.displayProperty(e,i,n))&&(r.highlightableElements[this.getTreeNodeId(e)]=o)},e}();this.tree=new cM(o,null,this.scrollContainer,{}),this.tree.setGlobalManager(this.globalManager)}function hM(e){e=String(e);var t=' target="blank" class="propertyLink" ';return[{pattern:/\b(?:https?|ftp):\/\/[a-z0-9-+&@#/%?=~_|()!:,.;]*[a-z0-9-+&@#/%=~_|()]/gim,value:"<a"+t+'href="$&">$&</a>'},{pattern:/(^|[^/])(www\.[\S]+(\b|$))/gim,value:"$1<a"+t+'href="http://$2">$2</a>'}].reduce((function(e,t){return e.replace(t.pattern,t.value)}),e)}function dM(e){this.viewer=e,this.setGlobalManager(e.globalManager),this.currentNodeIds=[],this.currentModel=null,this.currentSelections=[],this.isDirty=!0,this.propertyNodeId=null,this.normalTitle="Properties",this.loadingTitle="Object Properties Loading",this._viewDbId=null,this.onProperties=this.onProperties.bind(this),this.onPropertySet=this.onPropertySet.bind(this),this.onPropError=this.onPropError.bind(this),this.setPropertiesIntoUI=this.setPropertiesIntoUI.bind(this),this.setAggregatedPropertiesIntoUI=this.setAggregatedPropertiesIntoUI.bind(this),this._onDisplayUnitPreferenceChanged=this._onDisplayUnitPreferenceChanged.bind(this),uM.call(this,e.container,"ViewerPropertyPanel",this.loadingTitle)}function fM(e){var t=e.getDocumentNode(),i=t&&t.findViewableParent();return!(!i||-1===i.name().toLocaleLowerCase().indexOf(".sld"))}function pM(e,t){Na.call(this,e,t),this.name="propertiesmanager",this._panel=null,this._onIsolateEvent=this._onIsolateEvent.bind(this),this._onSelectionChangeEvent=this._onSelectionChangeEvent.bind(this),this._onPrefChange=this._onPrefChange.bind(this),this._onContextMenu=this._onContextMenu.bind(this)}tM.prototype=Object.create(FT.prototype),tM.prototype.constructor=tM,HT.call(tM.prototype),tM.prototype.uninitialize=function(){var e,t,i,n,r,o;this._onBgEnvironmentChange&&this._onBgEnvironmentReset&&(this.preferences.removeListeners(ZT.Prefs3D.LIGHT_PRESET,this._onBgEnvironmentChange,this._onBgEnvironmentReset),this._onBgEnvironmentChange=null,this._onBgEnvironmentReset=null),null===(e=(t=this.options).removeEventListener)||void 0===e||e.call(t,Br,this.syncUI),null===(i=(n=this.options).removeEventListener)||void 0===i||i.call(n,Nn,this.syncUI),null===(r=(o=this.options).removeEventListener)||void 0===r||r.call(o,Wn,this.updateEdgeToggle),FT.prototype.uninitialize.call(this),this.envSelect=null},tM.prototype.setVisible=function(e){this.visible=e,FT.prototype.setVisible.call(this,e),e&&this.sizeToContent(),e&&this.createEnvironmentPanel()},tM.prototype.addCheckbox=function(e,t,i,n,r,o,s){const{preferences:a}=this;var l=a[o];n="boolean"==typeof l?l:n;var c=FT.prototype.addCheckbox.call(this,e,t,n,(function(e){o&&(a.set(o,e),ZT.analytics.track("viewer.settings.changed",{setting_name:o,setting_value:e})),r&&r(e)}),i,s),u=this.getControl(c);return u.saveKey=o,o?a.addListeners(o,(function(e){u.setValue(e)}),(function(e){u.setValue(e),r&&r(e)})):u.sliderRow.classList.add("logical-group"),a.hasTag(o,"no-storage")&&(u.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),c},tM.prototype.addDropDownMenu=function(e,t,i,n,r,o,s){const{preferences:a}=this;o&&(r=n.indexOf(a.get(o)));const l=FT.prototype.addDropDownMenu.call(this,e,t,i,r,(function(e){o&&("displayUnits"==o?a.set(o,new xs(ms,n[e.detail.value])):"displayUnitsPrecision"==o?a.set(o,new xs(vs,n[e.detail.value])):a.set(o,n[e.detail.value]),ZT.analytics.track("viewer.settings.changed",{setting_name:o,setting_value:n[e.detail.value]}))}),s),c=this.getControl(l);return o?a.addListeners(o,(function(e){c.setSelectedIndex(n.indexOf(e))}),(function(e){c.setSelectedIndex(n.indexOf(e))})):c.sliderRow.classList.add("logical-group"),a.hasTag(o,"no-storage")&&(c.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),l},tM.prototype.addSliderV2=function(e,t,i,n,r,o,s,a){const{preferences:l}=this;var c=l.get(a);o="number"==typeof c?c:o,a&&!Object.prototype.hasOwnProperty.call(l,a)&&l.add(a,o,["2d","3d"]);var u=FT.prototype.addSliderV2.call(this,e,t,i,n,r,o,(function(e){var t="number"==typeof e?e:Number(e.detail.value);a&&l.set(a,t)}),s),h=this.getControl(u[1]);return h.saveKey=a,a?l.addListeners(a,(function(e){h.setValue(e)})):h.sliderRow.classList.add("logical-group"),l.hasTag(a,"no-storage")&&(h.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),u},tM.prototype.addGrid=function(e,t,i,n){const{preferences:r}=this;var o=e,s=this.getDocument(),a=s.createElement("div");a.classList.add("environments-container"),o.appendChild(a);var l=s.createElement("div");l.classList.add("environments-lighting-table"),a.appendChild(l);var c=new WT(42,26);c.setGlobalManager(this.globalManager);for(var u=0;u<t.length;u++){let e=t[u];var h=s.createElement("div");h.classList.add("settings-environment-cell"),h.index=u;var d=s.createElement("img");d.classList.add("settings-environment-image"),iM(c,d,e),h.appendChild(d);var f=s.createElement("span");f.textContent=hs.t(e.name),f.classList.add("settings-environment-name"),f.setAttribute("data-i18n",e.name),h.appendChild(f),h.addEventListener("click",(function(){r.set(n,this.index)})),l.appendChild(h)}return this.preferences.addListeners(n,i),l},tM.prototype.updateEnvironmentSelection=function(){if(this.is3dMode&&this.envTabCreated){var e=this.preferences.get("lightPreset");if("string"==typeof e){e=xo.map((e=>e.name)).indexOf(e)}for(var t=this.gridTable.querySelectorAll(".settings-environment-cell"),i=0;i<t.length;i++)t[i].index===e?t[i].classList.add("border-select"):t[i].classList.remove("border-select")}},tM.prototype.removeCheckbox=function(e){return this.preferences.removeListeners(e.saveKey),this.removeEventListener(e,"change",e.changeListener),FT.prototype.removeCheckbox.call(this,e)},tM.prototype.createNavigationPanel=function(){var e=JT.Navigation;function t(){return this.addSliderV2(e,"Drag Speed","Changes sensitivity of mouse movement with the zoom tool",5,300,this.options.initialZoomDragSpeed,{step:5},Pn.ZOOM_DRAG_SPEED)[1]}function i(){return this.addSliderV2(e,"Scroll Speed","Changes sensitivity of the mouse scroll wheel when zooming",.1,3,this.options.initialZoomScrollScale,{step:.1},Pn.ZOOM_SCROLL_SPEED)[1]}this.is3dMode&&(this.addLabel(e,"ViewCube"),this.addCheckbox(e,"Show ViewCube","Toggles availability of the ViewCube navigation control",!0,void 0,Mn.VIEW_CUBE),F()||this.addCheckbox(e,"ViewCube acts on pivot","When enabled, the ViewCube orbits the view around the active pivot point When disabled, it orbits around the center of the view",!1,void 0,Mn.ALWAYS_USE_PIVOT),this.addLabel(e,"Orbit"),this.addCheckbox(e,"Fusion style orbit","Enables Fusion-style orbit overlay and gives the ability to lock orbit axis",!1,(e=>{e?this.options.loadExtension("Autodesk.Viewing.FusionOrbit",null):this.options.unloadExtension("Autodesk.Viewing.FusionOrbit",null)}),Pn.FUSION_ORBIT),this.addCheckbox(e,"Orbit past world poles","Allows view rotation to continue past the models North Pole",!0,void 0,Mn.ORBIT_PAST_WORLD_POLES),this.addLabel(e,"Zoom"),F()||(this.addCheckbox(e,"Zoom towards pivot","When disabled, zooming operations are centered at the current cursor location",!1,void 0,Mn.ZOOM_TOWARDS_PIVOT),this.addCheckbox(e,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,void 0,Pn.REVERSE_MOUSE_ZOOM_DIR),this.scrollSpeed=i.call(this)),this.dragSpeed=t.call(this),this.addLabel(e,"Mouse"),F()||(this.addCheckbox(e,"Left handed mouse setup","Swaps the buttons on the mouse",!1,void 0,Pn.LEFT_HANDED_MOUSE_SETUP),this.addCheckbox(e,"Set pivot with left mouse button","Change left-click behavior to set new pivot point (overrides select object)",!1,void 0,Mn.CLICK_TO_SET_COI)),this.addCheckbox(e,"Open properties on select","Always show properties upon selecting object",!0,void 0,Pn.OPEN_PROPERTIES_ON_SELECT)),this.is3dMode||(this.addLabel(e,"Zoom"),this.addCheckbox(e,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,void 0,Pn.REVERSE_MOUSE_ZOOM_DIR),F()||(this.scrollSpeed=i.call(this)),this.dragSpeed=t.call(this),this.addLabel(e,"Mouse"),this.addCheckbox(e,"Open properties on select","Always show properties upon selecting object",!0,void 0,Pn.OPEN_PROPERTIES_ON_SELECT),F()||this.addCheckbox(e,"Left handed mouse setup","Swaps the buttons on the mouse",!1,void 0,Pn.LEFT_HANDED_MOUSE_SETUP))},tM.prototype.addConfigButton=function(e,t){if(!t)throw new Error("Must register a function callback.");this._externalButtonsLabel||(this._externalButtonsLabel=this.addLabel(JT.Configuration,"More"));var i=this.addButton(JT.Configuration,e);return this.getControl(i).setOnClick((()=>{this.setVisible(!1),t()})),this._externalButtonIds.push(i),i},tM.prototype.removeConfigButton=function(e){var t=this._externalButtonIds.indexOf(e);if(-1===t)return!1;var i=this.getControl(e);return!!i&&(this.removeControl(i),this._externalButtonIds.splice(t,1),0===this._externalButtonIds.length&&null!==this._externalButtonsLabel&&(this._externalButtonsLabel.removeFromParent(),this._externalButtonsLabel=null),!0)},tM.prototype.updateEdgeToggle=function(){const e=document.getElementById(this.edgeCheckboxName+"_check");if(!e)return;if(!this.is3dMode)return;this.options.detectIfModelsHaveEdge()?e.disabled=!1:(e.disabled=!0,e.checked=!1)},tM.prototype.createConfigurationPanel=function(){var e=JT.Configuration;this.is3dMode?(this.addLabel(e,"Performance Optimization"),this.optimizeNavigationhkBoxId=this.addCheckbox(e,"Disable shadow effect","Provides faster response(but degrades quality) while navigating",F(),void 0,Mn.OPTIMIZE_NAVIGATION),this.progressiveRenderChkBoxId=this.addCheckbox(e,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,void 0,Pn.PROGRESSIVE_RENDERING),rM(this,e,this.is3dMode),this.addLabel(e,"Display"),this.ghosthiddenChkBoxId=this.addCheckbox(e,"Ghost hidden objects","Leave hidden objects slightly visible",!0,void 0,Mn.GHOSTING),this.displayLinesId=this.addCheckbox(e,"Display Lines","Toggles display of line objects",!0,void 0,Mn.LINE_RENDERING),this.displayPointsId=this.addCheckbox(e,"Display Points","Toggles display of point objects",!0,void 0,Pn.POINT_RENDERING),this.edgeCheckboxName="Display edges",this.displayEdgesId=this.addCheckbox(e,this.edgeCheckboxName,"Shows outline of model surfaces",!1,(e=>{this.getControl(this.displayEdgesId).setValue(e),this.updateEdgeToggle()}),Mn.EDGE_RENDERING),this.updateEdgeToggle(),this.displaySectionHatchesId=this.addCheckbox(e,"Display Section Hatches","Shows hatch pattern for section planes this does not apply to section boxes",!0,null,ZT.Prefs3D.DISPLAY_SECTION_HATCHES)):(this.addLabel(e,"Performance Optimization"),this.progressiveRenderChkBoxId=this.addCheckbox(e,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,void 0,Pn.PROGRESSIVE_RENDERING),rM(this,e,this.is3dMode),this.isPdfFile&&this.enableVectorRasterSwitch&&(this.vectorViewingChkBoxId=this.addCheckbox(e,"Vector Viewing","Provides increased zooming, snapping and access to PDF vector data. If turned off, all PDFs will be rasterized.",!0,void 0,In.VECTOR_VIEWING)),this.addLabel(e,"Display")),this.displayUnitsId=this.addDropDownMenu(e,"Display Units",ZT.displayUnits,ZT.displayUnitsEnum,null,ZT.Prefs.DISPLAY_UNITS),this.displayUnitsPrecisionId=this.addDropDownMenu(e,"Precision",ZT.displayUnitsPrecision,ZT.displayUnitsPrecisionEnum,null,ZT.Prefs.DISPLAY_UNITS_PRECISION),this.is3dMode&&this._addSelectionModeOption()},tM.prototype._addSelectionModeOption=function(){const e=JT.Configuration;this.addLabel(e,"Selection");const t=[],i=[];let n=0;for(let e in Autodesk.Viewing.SelectionMode)t[n]=e,i[n]=Autodesk.Viewing.SelectionMode[e],n++;const r=t.map((e=>e.split("_").map((e=>e.charAt(0)+e.slice(1).toLowerCase())).join(" ")));this.selectionModeId=this.addDropDownMenu(e,"Selection Mode",r,i,null,ZT.Prefs3D.SELECTION_MODE)},tM.prototype.createAppearancePanel=function(){var e=JT.Appearance;this.is3dMode?(this.addLabel(e,"Visual Quality Optimization"),this.antialiasingChkBoxId=this.addCheckbox(e,"Anti-aliasing","Remove jagged edges from lines",!0,void 0,Mn.ANTIALIASING),this.ambientshadowsChkBoxId=this.addCheckbox(e,"Ambient shadows","Improve shading of occluded surfaces",!0,void 0,Mn.AMBIENT_SHADOWS),this.groundShadowChkBoxId=this.addCheckbox(e,"Ground shadow","Add simulated ground surface shadows",!0,void 0,Mn.GROUND_SHADOW),this.groundReflectionChkBoxId=this.addCheckbox(e,"Ground reflection","Add simulated ground surface reflections",!1,void 0,Mn.GROUND_REFLECTION)):(this.addLabel(e,"Existing behavior"),this.swapBlackAndWhiteChkBoxId=this.addCheckbox(e,"2D Sheet Color","Switch sheet color white to black",!0,void 0,In.SWAP_BLACK_AND_WHITE),this.loadingAnimationChkBoxId=this.addCheckbox(e,"Loading Animation","Animate lines during loading",!0,void 0,In.LOADING_ANIMATION))},tM.prototype.createEnvironmentPanel=function(){if(this.is3dMode&&!this.envTabCreated){this.envTabCreated=!0;var e=JT.Environment,t=this.tablesContainer.childNodes[3];this.gridTable=t,this.addLabel(e,"Environment"),this.envMapBackgroundChkBoxId=this.addCheckbox(e,"Environment Image Visible","Shows lighting environment as background",!0,void 0,Mn.ENV_MAP_BACKGROUND);var i=t.tBodies[0].insertRow(-1).insertCell(0),n=this.getDocument();this.caption=n.createElement("div"),this.caption.setAttribute("data-i18n","Environments and Lighting Selection"),this.caption.textContent=hs.t("Environments and Lighting Selection"),this.caption.classList.add("settings-row-title"),i.appendChild(this.caption),i.colSpan="3",this.envSelect=this.addGrid(t,xo,this.updateEnvironmentSelection.bind(this),ZT.Prefs3D.LIGHT_PRESET),this.updateEnvironmentSelection(),this.envSelect.classList.add("with-environment")}},tM.prototype.createVersionLabel=function(e){if(e){var t=this.getDocument();this.versionDiv=t.createElement("div"),this.versionDiv.textContent=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:LMV_VIEWER_VERSION;"@"===e.charAt(0)&&(e="0.0.0");return"v"+e}(this.options.version),this.versionDiv.className="docking-panel-version-label",this.addEventListener(this.versionDiv,"click",(e=>{e.shiftKey&&navigator.clipboard.writeText(this.versionDiv.textContent)})),e.appendChild(this.versionDiv)}},tM.prototype.createRestoreDefaultSettingsButton=function(){var e=this.getDocument();this.restoreDiv=e.createElement("div"),this.restoreDiv.classList.add("docking-panel-container-solid-color-b"),this.restoreDiv.classList.add("restore-defaults-container"),this.restoreButton=e.createElement("div"),this.restoreButton.className="docking-panel-tertiary-button",this.restoreButton.setAttribute("data-i18n","Restore all default settings"),this.restoreButton.textContent=hs.t("Restore all default settings"),this.restoreDiv.appendChild(this.restoreButton),this.addEventListener(this.restoreDiv,"touchstart",Q),this.addEventListener(this.restoreDiv,"click",(()=>{var e,t;null===(e=(t=this.options).onRestoreDefaults)||void 0===e||e.call(t),ZT.analytics.track("viewer.settings.default")}),!1),this.scrollContainer.appendChild(this.restoreDiv)},tM.prototype.selectTab=function(e){FT.prototype.selectTab.call(this,e),this.sizeToContent()},tM.prototype.sizeToContent=function(){FT.prototype.sizeToContent.call(this,this.options.container)},tM.prototype.onViewerResize=function(e,t,i,n,r,o){this.sizeToContent()},tM.prototype.syncUI=function(){var e=this.preferences;this.setControlValue(this.antialiasingChkBoxId,e.get("antialiasing")),this.setControlValue(this.ambientshadowsChkBoxId,e.get("ambientShadows")),this.setControlValue(this.groundShadowChkBoxId,e.get("groundShadow")),this.setControlValue(this.groundReflectionChkBoxId,e.get("groundReflection")),this.setControlValue(this.envMapBackgroundChkBoxId,e.get("envMapBackground")),this.setControlValue(this.progressiveRenderChkBoxId,e.get("progressiveRendering")),this.setControlValue(this.largeModelExperienceChkBoxId,e.get(Mn.LARGE_MODEL_EXPERIENCE)),this.setControlValue(this.webGPUChkBoxId,e.get(Pn.WEBGPU)),this.setControlValue(this.swapBlackAndWhiteChkBoxId,e.get("swapBlackAndWhite")),this.setControlValue(this.vectorViewingChkBoxId,e.get(ZT.Prefs2D.VECTOR_VIEWING)),this.setControlValue(this.loadingAnimationChkBoxId,e.get("loadingAnimation")),this.setControlValue(this.ghosthiddenChkBoxId,e.get("ghosting")),this.setControlValue(this.displayLinesId,e.get("lineRendering")),this.setControlValue(this.displayPointsId,e.get("pointRendering")),this.setControlValue(this.displayEdgesId,e.get("edgeRendering")),this.setControlValue(this.displaySectionHatchesId,e.get("displaySectionHatches")),this.setControlValue(this.scrollSpeed,e.get("zoomScrollSpeed")),this.setControlValue(this.dragSpeed,e.get("zoomDragSpeed")),this.updateEnvironmentSelection();QT.FeatureFlags.isEnabled(Us.WebGPUBackend)&&e.get(Pn.WEBGPU)&&nM(this,!0)},tM.prototype.setControlValue=function(e,t){var i=this.getControl(e);i&&i.setValue(t)},aM.prototype=Object.create(Ww.prototype),aM.prototype.constructor=aM,aM.prototype.initialize=function(e){var t=Ww.prototype.initialize.call(this,e);if(t>0)return wT.reportError(this.container,t),t;var i=this;if(this.toolController){var n=new lT(this);this.toolController.registerTool(n),this.toolController.activateTool(n.getName())}return this.addEventListener(On,this.onFullScreenModeEvent),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new TT(this.container,rn),this.addEventListener(Dn,this.onProgressBarUpdate),this.addEventListener(Un,(function(e){var t;i.resizePanels(),null===(t=i.toolbar)||void 0===t||t.updateToolbarButtons(e.width,e.height)})),this.addEventListener(Bn,(function(){var e;null===(e=i.toolbar)||void 0===e||e.updateToolbarButtons(i.container.clientWidth,i.container.clientHeight)})),this.initEscapeHandlers(),this.localize(),this.addEventListener(zr,function(){for(var e=this.container,t=e.childElementCount,i=0;i<t;++i)e.children[i].classList.add("hide-while-context-lost");wT.reportError(this.container,st.WEBGL_LOST_CONTEXT),this.localize()}.bind(this)),this.addEventListener(Hr,function(){for(var e=this.container,t=e.childElementCount,i=0;i<t;++i)e.children[i].classList.remove("hide-while-context-lost");wT.dismissError(st.WEBGL_CONTEXT_LOST_EVENT)}.bind(this)),this.run(),0},aM.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.viewerOptionButton=null),this.removeEventListener(On,this.onFullScreenModeEvent),this.removeEventListener(Dn,this.onProgressBarUpdate),this.progressbar=null,this.debugMenu=null,this.modelStats=null,this.toolbar=null,Ww.prototype.uninitialize.call(this)},aM.prototype.setUp=function(e){e||(e={}),e.startOnInitialize=!1,Ww.prototype.setUp.call(this,e)},aM.prototype.tearDown=function(e){Ww.prototype.tearDown.call(this,e),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.debugMenu=null,this.removeEventListener(Wn,this.checkGeometry),this.checkGeometry=null},aM.prototype.onPostExtensionLoad=function(e){var t,i=this.getToolbar();i&&e.onToolbarCreated&&e.onToolbarCreated(i),null===(t=this.toolbar)||void 0===t||t.updateToolbarButtons(this.container.clientWidth,this.container.clientHeight)},aM.prototype.loadModel=function(e,t,i,n,r){var o=this;t={...t,addViews:function(e,t){var i,n;let r=null===(i=t.getDocumentNode())||void 0===i?void 0:i.getNamedViews();function o(e,t,i){if(e.children)for(let t=e.children.length-1;t>=0;t--)o(e.children[t],e,t);else{let n=r.find((t=>t.data.name==e.name));n&&(n.data.isViewpoint=!0,n.data.entry=e.entry,t.children.splice(i,1))}}if(r){var s;let t=null===(s=e.children)||void 0===s?void 0:s.length;for(;t--;)o(e.children[t],e,t)}let a=null===(n=t.getDocumentNode())||void 0===n?void 0:n.getRootNode();if(a){const t=new Autodesk.Viewing.BubbleNode(e);t.parent=a.children[0],a.children[0].children.push(t)}}};var s=Ww.prototype.loadModel.call(this,e,t,(function(e){setTimeout((function(){t&&(t.loadAsHidden||t.headlessViewer)||function(e){o.running?o.createUI(e):rt.error("createUI expects the viewer to be running.",at(st.VIEWER_INTERNAL_ERROR))}(e),i&&(i.call(i,e),i=null)}),0)}),(function(e){e!==st.LOAD_CANCELED?wT.reportError(o.container,e):rt.warn("A load was canceled"),n&&n.apply(n,arguments)}),r);return s},aM.prototype.createUI=function(e,t){if(this.model!==e&&!t)return;var i=this;const n=this._createToolbar();this.checkGeometry=function(e){setTimeout((function(){if(i.impl&&!i.impl.is2d&&e.model&&!e.model.hasGeometry()){var t=st.BAD_DATA_MODEL_IS_EMPTY;wT.reportError(i.container,t,"Model is empty"),i._loadingSpinner.hide()}}),0)};var r=this.config.disabledExtensions||{};const o=e=>-1===(this.profile&&this.profile.extensions.unload?this.profile.extensions.unload:[]).indexOf(e);this.initModelTools(e),c().ENABLE_DEBUG&&this.initDebugTools(),"true"===fe("lmv_viewer_debug")&&this.loadExtension("Autodesk.Debug",this.config);var s=function(e){i.getExtension(e)&&i.unloadExtension(e)};e.is2d()&&(s("Autodesk.BimWalk"),s("Autodesk.Section"),s("Autodesk.Viewing.FusionOrbit"),s("Autodesk.Explode")),r.measure||s("Autodesk.Measure"),n&&(this.dispatchEvent({type:pT}),this.forEachExtension((e=>{e.onToolbarCreated&&e.onToolbarCreated(this.toolbar)})));var a="Autodesk.DefaultTools.NavTools",l=this.getExtension(a);l?l.updateUI(e.is3d()):this.loadExtension(a,i.config),this.resize(),e.is2d()?(this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),setTimeout((function(){if(!i.impl)return;const e={viewcube:"Autodesk.ViewCubeUi",measure:"Autodesk.Measure",hyperlink:"Autodesk.Hyperlink",layerManager:"Autodesk.LayerManager",propertiesPanel:"Autodesk.PropertiesManager"};F()||(e.boxSelection="Autodesk.BoxSelection");for(let t in e){const n=e[t];!r[t]&&o(n)&&i.loadExtension(n,i.config)}}),0)):(-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),setTimeout((function(){if(!i.impl)return;const e={viewcube:"Autodesk.ViewCubeUi",explode:"Autodesk.Explode",bimwalk:"Autodesk.BimWalk",fusionOrbit:"Autodesk.Viewing.FusionOrbit",measure:"Autodesk.Measure",section:"Autodesk.Section",layerManager:"Autodesk.LayerManager",modelBrowser:"Autodesk.ModelStructure",propertiesPanel:"Autodesk.PropertiesManager"};F()||(e.boxSelection="Autodesk.BoxSelection");for(let t in e){const n=e[t];!r[t]&&o(n)&&i.loadExtension(n,i.config)}!r.scalarisSimulation&&o("Autodesk.Viewing.ScalarisSimulation")&&i.model&&i.model.isScalaris&&i.loadExtension("Autodesk.Viewing.ScalarisSimulation",i.config)}),0),e.isLoadDone()?this.checkGeometry({model:e}):this.addEventListener(Wn,this.checkGeometry,{once:!0}))},aM.prototype.onFullScreenModeEvent=function(e){this.resizePanels(),this.toolbar.updateFullscreenButton(e.mode)},aM.prototype.onProgressBarUpdate=function(e){if(e.state==Gp.ROOT_LOADED||e.state==Gp.LOADING)this.progressInModelLoad=e.percent<100;else if(e.state!=Gp.OPTIMIZING||this.progressInModelLoad){if(this.progressInModelLoad||this.progressInModelOptimizing)return}else this.progressInModelOptimizing=e.percent<100;e.percent>=0&&this.progressbar.setPercent(e.percent,e.state)},aM.prototype.addOptionToggle=function(e,t,i,n,r){var o=r?this.prefs[r]:null;i="boolean"==typeof o?o:i;let s=this.getDocument();var a=s.createElement("li");a.className="toolbar-submenu-listitem";var l=s.createElement("input");l.className="toolbar-submenu-checkbox",l.type="checkbox",l.id=t,a.appendChild(l);var c=s.createElement("label");return c.setAttribute("for",t),c.setAttribute("data-i18n",t),c.textContent=hs.t(t),a.appendChild(c),e.appendChild(a),l.checked=i,l.addEventListener("touchstart",Q),c.addEventListener("touchstart",Q),a.addEventListener("touchstart",Q),l.addEventListener("click",(function(e){n(l.checked),e.stopPropagation()})),c.addEventListener("click",(function(e){e.stopPropagation()})),a.addEventListener("click",(function(e){e.stopPropagation(),l.checked=!l.checked,n(l.checked)})),r&&this.prefs.addListeners(r,(function(e){l.checked=e}),(function(e){l.checked=e,n(e)})),l},aM.prototype.addOptionList=function(e,t,i,n,r,o){var s=this.prefs[o];n="number"==typeof s?s:n;let a=this.getDocument();var l=a.createElement("select");l.className="option-drop-down",l.id="selectMenu_"+t;for(var c=0;c<i.length;c++){var u=a.createElement("option");u.value=c,u.setAttribute("data-i18n",i[c]),u.textContent=hs.t(i[c]),l.add(u)}var h=a.createElement("li");h.className="toolbar-submenu-select";var d=a.createElement("div");return d.className="toolbar-submenu-selectlabel",d.setAttribute("for",t),d.setAttribute("data-i18n",t),d.textContent=hs.t(t),h.appendChild(d),h.appendChild(l),e.appendChild(h),l.selectedIndex=n,l.onchange=function(e){var t=e.target.selectedIndex;r(t),e.stopPropagation()},l.addEventListener("touchstart",(function(e){e.stopPropagation()})),l.addEventListener("click",(function(e){e.stopPropagation()})),o&&this.prefs.addListeners(o,(function(e){l.selectedIndex=e}),(function(e){l.selectedIndex=e,r(e)})),l},aM.prototype.showViewer3dOptions=function(e){var t=this.getSettingsPanel(!0);e&&t.isVisible()&&t.setVisible(!1),t.setVisible(e)},aM.prototype.showRenderingOptions=function(e){e&&this._createRenderingOptionsPanel(),this.renderoptions&&this.renderoptions.setVisible(e)},aM.prototype._createRenderingOptionsPanel=function(){this.renderoptions||this.model.is2d()||(this.renderoptions=new UT(this),this.addPanel(this.renderoptions),this.toolbar.initRenderOptionsButton())},aM.prototype.showLayerManager=function(){rt.warn('viewer.showLayerManager() is now handled the extension "Autodesk.LayerManager" and will be removed in version 8.0.0.')},aM.prototype.initHotkeys=function(){rt.warn("viewer.initHotkeys() has been deprecated and will be removed in version 8.0.0.")},aM.prototype.setModelStructurePanel=function(e){rt.warn('viewer.setModelStructurePanel() is deprecated and will be removed in v8.0.0 - Use extension "Autodesk.ModelStructure".');var t=this.getExtension("Autodesk.ModelStructure");return!!t&&t.setModelStructurePanel(e)},aM.prototype.setLayersPanel=function(){rt.warn('viewer.setLayersPanel() is now handled the extension "Autodesk.LayerManager" and will be removed in version 8.0.0.')},aM.prototype.setPropertyPanel=function(e){rt.warn('viewer.setPropertyPanel() is now handled by extension "Autodesk.PropertiesManager" and will be removed in version 8.0.0.');var t=this.getExtension("Autodesk.PropertiesManager");return!!t&&t.setPanel(e)},aM.prototype.getPropertyPanel=function(e){rt.warn('viewer.getPropertyPanel() is now handled the extension "Autodesk.PropertiesManager" and will be removed in version 8.0.0.');var t=this.getExtension("Autodesk.PropertiesManager");return!t&&e&&(this.loadExtension("Autodesk.PropertiesManager"),t=this.getExtension("Autodesk.PropertiesManager")),t?t.getPanel():null},aM.prototype.setSettingsPanel=function(e){var t=this;return(e instanceof FT||!e)&&(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=e,e&&(this.addPanel(e),e.addVisibilityListener((function(i){var n;i&&t.onPanelVisible(e,t),null===(n=t.toolbar)||void 0===n||n.viewerOptionButton.setState(i?xT.State.ACTIVE:xT.State.INACTIVE)}))),!0)},aM.prototype.getSettingsPanel=function(e,t){return!this.viewerSettingsPanel&&e&&this.createSettingsPanel(t||this.model),this.viewerSettingsPanel},aM.prototype.createSettingsPanel=function(e){var t=new tM(this,e);this.setSettingsPanel(t),t.syncUI(),this.toolbar.initSettingsOptionsButton(),this.dispatchEvent({type:mT})},aM.prototype.initModelTools=function(e){this.createSettingsPanel(e),c().ENABLE_DEBUG&&this._createRenderingOptionsPanel(),this.canChangeScreenMode()&&L(this.getDocument())&&(this.toolbar.initModelTools(),this.toolbar.updateFullscreenButton(this.getScreenMode()))},aM.prototype.setPropertiesOnSelect=function(e){rt.warn('viewer.setPropertiesOnSelect() is now handled by viewer.prefs.set("openPropertiesOnSelect", <boolean>) and will be removed in version 8.0.0.'),this.prefs.set(Pn.OPEN_PROPERTIES_ON_SELECT,e)},aM.prototype.addDivider=function(e){var t=this.getDocument().createElement("li");return t.className="toolbar-submenu-horizontal-divider",e.appendChild(t),t},aM.prototype.initDebugTools=function(){if(this.debugMenu)return!1;var e=new ST("debugTools");this.debugMenu=e;var t=new xT("toolbar-debugTool");return t.setIcon("adsk-icon-bug"),e.addControl(t),this.debugMenu.debugSubMenuButton=t,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(e),!0},aM.prototype.removeDebugTools=function(){this.debugMenu&&(this.debugMenu.removeFromParent(),this.debugMenu=null)},aM.prototype.createDebugSubmenu=function(e){var t=this,i=this.getDocument().createElement("div");i.id="toolbar-debugToolSubmenu",i.classList.add("toolbar-submenu"),i.classList.add("toolbar-settings-sub-menu"),i.classList.add("adsk-hidden"),this.debugMenu.subMenu=i,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(i),this.initModelStats(),this.addDivider(i),this.addDivider(i);var n=Bi.Lang.getLanguages(),r=n.map((function(e){return e.label})),o=n.map((function(e){return e.symbol}));function s(){t.localize()}var a=t.selectedLanguage?t.selectedLanguage:0;this.addOptionList(i,"Language",r,a,(function(e){var i=o[e];t.selectedLanguage=e,Ui(i,s)}),null).parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu);this.addOptionList(i,"Error",["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"],0,(function(e){var i=e+1;wT.reportError(t.container,i,"")}),null).parentNode.style.paddingBottom="15px";var l=i.getBoundingClientRect();this.debugMenu.subMenu.style.width=l.width+"px",this.container.removeChild(i),e.container.appendChild(i);var c=l.left+l.width,u=this.container.getBoundingClientRect().right;if(c>u){var h=-(c-u+10)+"px";this.debugMenu.subMenu.style.left=h}e.onMouseOver=function(){i.classList.remove("adsk-hidden")},e.onMouseOut=function(){i.classList.add("adsk-hidden")},O()&&(e.onClick=function(){i.classList.toggle("adsk-hidden")})},aM.prototype.initModelStats=function(){var e=this;function t(){var t=e.model;const i=e=>(e/1e3).toFixed(2)+"s",n=t.loader.t1?i(t.loader.t1-t.loader.t0):"-",r=t.loader.firstPixelTimestamp?i(t.loader.firstPixelTimestamp-t.loader.t0):"-",o=t.loader.loadTime?i(t.loader.loadTime):"...";t&&(e.modelStats.innerHTML=`\n                Geometry Polygons: ${t.getGeometryList().geomPolyCount.toLocaleString()}<br>\n                Instance Polygons: ${t.getGeometryList().instancePolyCount.toLocaleString()}<br>\n                Fragments: &nbsp;${t.getFragmentList().getCount().toLocaleString()}<br>\n                Geometries: ${t.getGeometryList().getCount().toLocaleString()}<br>\n                <br>\n                Root data loaded: &nbsp;${n}<br>\n                First pixel drawn: ${r}<br>\n                Geometries loaded: ${o}<br>\n                `)}this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,(function(i){i&&!e.modelStats&&(!function(){let i=e.getDocument();e.modelStats=i.createElement("div"),e.modelStats.className="statspanel",e.container.appendChild(e.modelStats),e.addEventListener(Dn,t),e.addEventListener(Wn,t),e.fpsDisplay=i.createElement("div"),e.fpsDisplay.className="fps",e.container.appendChild(e.fpsDisplay)}(),t()),e.modelStats.style.visibility=i?"visible":"hidden",e.fpsDisplay.style.visibility=i?"visible":"hidden",e.impl.fpsCallback=i?function(t){e.fpsDisplay.textContent=""+(0|t)}:null}))},aM.prototype.initEscapeHandlers=function(){var e=this;this.addEventListener(Rn,(function(){if(!e.contextMenu||!e.contextMenu.hide())if(e.renderoptions&&e.renderoptions.isVisible())e.renderoptions.setVisible(!1);else if(e.impl.selector.hasSelection())e.clearSelection();else{if(e.getActiveNavigationTool()!==e.getDefaultNavigationToolName())return e.toolController&&e.toolController.setIsLocked(!1),e.setActiveNavigationTool(),void CT.dismiss();if(e.areAllVisible()){if(!yT.dismiss()){for(var t=0;t<e.dockingPanels.length;++t){var i=e.dockingPanels[t];if("none"!==i.container.style.display&&""!==i.container.style.display)return void i.setVisible(!1)}e.escapeScreenMode()}}else e.showAll()}}))},aM.prototype.getToolbar=function(){return this.toolbar},aM.prototype._createToolbar=function(){if(this.toolbar)return!1;const e=this;if(this.toolbar=new zT("guiviewer3d-toolbar",{globalManager:this.globalManager,navigation:this.navigation,screenModeDelegate:this.getScreenModeDelegate(),onClickFullScreen:e.nextScreenMode.bind(e),onClickRenderOptions:()=>{var e=this.renderoptions&&this.renderoptions.isVisible();this.renderoptions.setVisible(!e)},onClickViewerOption:()=>{e.getSettingsPanel(!0).isVisible()?e.showViewer3dOptions(!1):e.showViewer3dOptions(!0)}}),this._forgeLogo){const e=this._forgeLogo.getBoundingClientRect();this.toolbar.container.style.bottom=`${e.height+10}px`}return this.container.appendChild(this.toolbar.container),this.toolbar.updateToolbarButtons(this.container.clientWidth,this.container.clientHeight,this.navigation),!0},aM.prototype.showModelStructurePanel=function(e){rt.warn('viewer.showModelStructurePanel() is deprecated and will be removed in v8.0.0 - Use extension "Autodesk.ModelStructure".'),e?this.activateExtension("Autodesk.ModelStructure"):this.deactivateExtension("Autodesk.ModelStructure")},aM.prototype.onPanelVisible=function(e){this.dockingPanels.splice(this.dockingPanels.indexOf(e),1),this.dockingPanels.splice(0,0,e)},aM.prototype.localize=function(){this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),wT.localize(),Ww.prototype.localize.call(this)},aM.prototype.addPanel=function(e){return-1===this.dockingPanels.indexOf(e)&&(this.dockingPanels.push(e),!0)},aM.prototype.removePanel=function(e){var t=this.dockingPanels.indexOf(e);return t>-1&&(this.dockingPanels.splice(t,1),!0)},aM.prototype.resizePanels=function(e){e=e||{};var t=this.toolbar?this.toolbar.getDimensions().height:0,i=this.getDimensions(),n=i.height;e.dimensions&&e.dimensions.height?n=e.dimensions.height:e.dimensions={height:i.height,width:i.width},e.dimensions.height=n-t;var r=e?e.dockingPanels:null;r||(r=this.dockingPanels);var o,s,a=this.container.getBoundingClientRect(),l=a.top,c=a.bottom,u=a.left,h=a.right;e&&e.dimensions?(o=e.dimensions.width,c=l+(s=e.dimensions.height)):(o=a.width,s=a.height);for(var d=0;d<r.length;++d)r[d].onViewerResize(l,c,u,h,o,s)},aM.prototype.initExplodeSlider=function(){rt.warn('viewer.initExplodeSlider() has been replaced by extension "Autodesk.Explode". initExplodeSlier() will be removed in version 7.0.0.')},aM.prototype.registerCustomizeToolbarCB=function(e){var t,i;null===(t=this.toolbar)||void 0===t||t.registerCustomizeToolbarCB(e.bind(null,this)),null===(i=this.toolbar)||void 0===i||i.updateToolbarButtons(this.container.clientWidth,this.container.clientHeight)},Object.defineProperty(aM.prototype,"navTools",{get(){var e;return null===(e=this.toolbar)||void 0===e?void 0:e.navTools}}),Object.defineProperty(aM.prototype,"modelTools",{get(){var e;return null===(e=this.toolbar)||void 0===e?void 0:e.modelTools}}),Object.defineProperty(aM.prototype,"settingsTools",{get(){var e;return null===(e=this.toolbar)||void 0===e?void 0:e.settingsTools}}),Object.defineProperty(aM.prototype,"updateFullscreenButton",{get(){var e;return null===(e=this.toolbar)||void 0===e?void 0:e.updateFullscreenButton.bind(this)}}),Autodesk.Viewing.Private.GuiViewer3D=aM,fo.call(lM.prototype),lM.prototype.constructor=lM,lM.prototype.isTreeNodeGroup=function(e){throw"isTreeNodeGroup is not implemented."},lM.prototype.getTreeNodeId=function(e){throw"getTreeNodeId is not implemented."},lM.prototype.getTreeNodeIndex=function(e){throw"getTreeNodeIndex is not implemented."},lM.prototype.getTreeNodeParentId=function(e){throw"getTreeNodeParentId is not implemented."},lM.prototype.getTreeNodeLabel=function(e){return e.name},lM.prototype.getTreeNodeCount=function(){throw"getTreeNodeCount is not implemented."},lM.prototype.shouldCreateTreeNode=function(e){return!0},lM.prototype.forEachChild=function(e,t){for(var i=e.children?e.children.length:0,n=0;n<i;++n){t(e.children[n])}},lM.prototype.createTreeNode=function(e,t,i,n,r){var o=this.getDocument().createElement("label");t.appendChild(o);var s=this.getTreeNodeLabel(e);return i&&i.localize&&(o.setAttribute("data-i18n",s),s=hs.t(s)),o.textContent=s,o},lM.prototype.onTreeNodeClick=function(e,t,i){},lM.prototype.onTreeNodeIconClick=function(e,t,i){e.delegate().isTreeNodeGroup(t)&&e.setCollapsed(t,!e.isCollapsed(t))},lM.prototype.onTreeNodeDoubleClick=function(e,t,i){},lM.prototype.onTreeNodeRightClick=function(e,t,i){},lM.prototype.onTreeNodeReized=function(e){},lM.prototype.getTreeNodeClass=function(e){return""},lM.prototype.getTreeNodeParentMaxSize=function(e){return{width:0,height:0}},lM.prototype.getTreeNodeClientHeight=function(e){return 0},lM.prototype.getTreeNodeDepthOffset=function(e,t){return 0},lM.prototype.onTreeNodeHover=function(e,t,i){},lM.prototype.getScrollContainer=function(){return null},lM.prototype.dtor=function(){},cM.prototype.constructor=cM,fo.call(cM.prototype),cM.prototype.destroy=function(){this.myDelegate=null,this.parentContainer&&(this.parentContainer.removeChild(this.myRootContainer),this.myRootContainer=null,this.parentContainer=null)},cM.prototype.show=function(e){var t=this.myRootContainer;t.style.display=e?"block":"none"},cM.prototype.getRootContainer=function(){return this.myRootContainer},cM.prototype.getElementForNode=function(e){return"number"!=typeof e&&"string"!=typeof e&&(e=this.myDelegate.getTreeNodeId(e)),this.nodeToElement[e]},cM.prototype.delegate=function(){return this.myDelegate},cM.prototype.isCollapsed=function(e){return this.hasClass(e,"collapsed")},cM.prototype.setCollapsed=function(e,t,i){t?(this.addClass(e,"collapsed",i),this.removeClass(e,"expanded",i)):(this.addClass(e,"expanded",i),this.removeClass(e,"collapsed",i))},cM.prototype.setAllCollapsed=function(e){var t,i;e?(t=function(e){return e.classList.contains("expanded")},i=function(e){e.classList.add("collapsed"),e.classList.remove("expanded")}):(t=function(e){return e.classList.contains("collapsed")},i=function(e){e.classList.add("expanded"),e.classList.remove("collapsed")});for(var n=0;n<this.myGroupNodes.length;++n){var r=this.myGroupNodes[n];t(r)&&i(r)}},cM.prototype.addToSelection=function(e){var t=this;function i(e){return-1===t.mySelectedNodes.indexOf(e)&&(t.mySelectedNodes.push(e),!0)}for(var n=e.length,r=0;r<n;++r){var o=e[r];i(o)&&this.addClass(o,this.selectedClassName)}},cM.prototype.removeFromSelection=function(e){var t=this;function i(e){var i=t.mySelectedNodes.indexOf(e);return-1!==i&&(t.mySelectedNodes.splice(i,1),!0)}for(var n=e.length-1;n>=0;--n){var r=e[n];i(r)&&this.removeClass(r,this.selectedClassName)}},cM.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(e),this.mySelectedNodes},cM.prototype.getSelection=function(){return this.mySelectedNodes.concat()},cM.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},cM.prototype.isSelected=function(e){return this.hasClass(e,this.selectedClassName)},cM.prototype.scrollTo=function(e){var t=this.getElementForNode(e);if(t){var i=t.offsetTop;for(t=t.parentNode;t&&t!=this.myRootContainer;)i+=t.offsetTop,t=t.parentNode;var n=this.myRootContainer.parentNode;this.myDelegate.getScrollContainer()&&(n=this.myDelegate.getScrollContainer()),n.scrollTop=i}},cM.prototype.addClass=function(e,t,i){var n=this.getElementForNode(e);if(n){if(i){n=n.parentNode;for(var r=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;n&&n!==r;)n.classList.add(t),n=n.parentNode}else n.classList.add(t);return!0}return!1},cM.prototype.removeClass=function(e,t,i){var n=this.getElementForNode(e);if(n){if(i){n=n.parentNode;for(var r=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;n&&n!==r;)n.classList.remove(t),n=n.parentNode}else n.classList.remove(t);return!0}return!1},cM.prototype.hasClass=function(e,t){return this.getElementForNode(e).classList.contains(t)},cM.prototype.clear=function(){for(var e=this.myRootContainer;e.hasChildNodes();)e.removeChild(e.lastChild);this.nodeToElement={},this.nodeIdToNode={}},cM.prototype.createElement_=function(e,t,i,n){if(null==e)return null;if(!this.myDelegate.shouldCreateTreeNode(e))return null;var r,o=this;function s(t,r,s,a){var l=o.createHtmlElement_(t,r,s),c=o.myDelegate.getTreeNodeId(a);l.setAttribute("lmv-nodeId",c);var u=o.createHtmlElement_(l,"lmvheader"),h=o.createHtmlElement_(u,"icon");return h.addEventListener("mousedown",(function(e){e.stopPropagation(),e.preventDefault()}),!1),h.addEventListener("click",(function(t){o.myDelegate.onTreeNodeIconClick(o,e,t),t.stopPropagation(),t.preventDefault()}),!1),o.myDelegate.createTreeNode(e,u,i,r,n),l}var a=this.myDelegate.getTreeNodeId(e),l=o.myOptions.excludeRoot?1:0;o.myDelegate.isTreeNodeGroup(e)?(r=s(t,"group",o.groupClassName,e),o.nodeToElement[a]=r,o.nodeIdToNode[a]=e,n==l&&(r.style.left="0px"),o.myGroupNodes.push(r),o.myDelegate.forEachChild(e,(function(e){o.createElement_(e,r,i,n+1)}))):(r=s(t,"leaf",o.leafClassName,e),o.nodeToElement[a]=r,o.nodeIdToNode[a]=e,n==l&&(r.style.marginLeft="0px"));var c=o.myDelegate.getTreeNodeClass(e);return c&&r.classList.add(c),r},cM.prototype.setInputHandlers_=function(){var e=this,t=this.myRootContainer,i=null,n=function(n){var r=null,o=!1;do{n&&n!==t?n.hasAttribute("lmv-nodeId")?(r=n,o=!0):n=n.parentElement:(r=null,o=!0)}while(!o);if(r){var s=r.getAttribute("lmv-nodeId");return e.nodeIdToNode[s]||i}return i};O()&&(this.hammer=new ye.A.Manager(t,{recognizers:[Ky.doubletap,Ky.press],handlePointerEventMouse:!1,inputClass:ye.A.TouchInput}),this.hammer.on("doubletap",(function(t){var r=n(t.target);r!==i&&e.myDelegate.onTreeNodeDoubleClick(e,r,t)})),this.hammer.on("press",(function(t){var r=n(t.target);r!==i&&e.myDelegate.onTreeNodeRightClick(e,r,t)}))),t.addEventListener("click",(function(t){var r=n(t.target);r!==i&&(e.myDelegate.onTreeNodeClick(e,r,t),t.stopPropagation(),t.target.classList.contains("propertyLink")||t.preventDefault())}),!1),t.addEventListener("dblclick",(function(t){var r=n(t.target);r!==i&&(e.myDelegate.onTreeNodeDoubleClick(e,r,t),t.stopPropagation(),t.preventDefault())}),!1),t.addEventListener("contextmenu",(function(t){var r=n(t.target);r!==i&&(e.myDelegate.onTreeNodeRightClick(e,r,t),t.stopPropagation(),t.preventDefault())}),!1),t.addEventListener("mouseover",(function(t){var r=n(t.target);r!==i&&(e.myDelegate.onTreeNodeHover(e,r,t),t.stopPropagation(),t.preventDefault())}),!1),t.addEventListener("mouseout",(function(t){var i=t.toElement||t.relatedTarget;if(n(t.target)!=n(i)){e.myDelegate.onTreeNodeHover(e,-1,t),t.stopPropagation(),t.preventDefault()}}),!1)},cM.prototype.createHtmlElement_=function(e,t,i){var n=this.getDocument().createElement(t);return e.appendChild(n),i&&(n.className=i),n},cM.prototype.iterate=function(e,t){if(null!=e&&this.myDelegate.shouldCreateTreeNode(e)){var i=this.getElementForNode(e);if(i){t(e,i);var n=this;this.myDelegate.forEachChild(e,(function(e){n.iterate(e,t)}))}}},uM.prototype=Object.create(NT.prototype),uM.prototype.constructor=uM,uM.prototype.setAggregatedProperties=function(e){this.removeAllProperties();const t=Autodesk.Viewing.Private,i=this.viewer.prefs.get(t.Prefs.DISPLAY_UNITS);let n=this.viewer.prefs.get(t.Prefs.DISPLAY_UNITS_PRECISION);const r=Object.prototype.hasOwnProperty.call(e.map,"Name")?e.map.Name.map((e=>e.displayValue)):[];function o(e,t){const r=Number(e);e=isNaN(r)?e:r;var o="number"==typeof n?n:t.precision||by(e),s=xy(e,t.type,t.units,i);return my(s.displayValue,s.displayUnits,t.type,o)}const s=e.getValue2PropertiesMap("Name");if(s){const e=Object.keys(s);if(1===e.length){const t=e[0],i={name:"aggregate-name"};this.tree.createElement_({name:"Name",value:t,type:"property",category:"",css:i},this.tree.myRootContainer)}else{const e={name:"Name",type:"category",value:"Varies"},t=this.tree.createElement_(e,this.tree.myRootContainer);this.setCategoryCollapsed(e,!0);for(let e in s)this.tree.createElement_({name:e,value:"",type:"property",category:"Name"},t)}}let a=e.getKeysWithCategories().length>0;e.forEach(((t,i)=>{if("Name"===t)return;const n=e.getAggregation(t),s=e.getValue2PropertiesMap(t);if(!n&&!s)return;const l=i[0];if(l.hidden)return;const c=!!l.displayCategory;let u,h="";if(c)h=l.displayCategory,u=this.tree.getElementForNode({name:h}),u=u||this.tree.createElement_({name:h,type:"category"},this.tree.myRootContainer);else if(a){if(h="Other",u=this.tree.getElementForNode({name:h}),!u){let e=h;u=this.tree.createElement_({name:e,type:"category"},this.tree.myRootContainer);const t=u.children[0].children[1];t.setAttribute("data-i18n",e),e=hs.t(e),t.textContent=e,t.title=e}}else u=this.tree.myRootContainer;const d=Object.keys(s);if(1===d.length){let e=d[0];return e=Cy(i[0].type)?o(Number(e),l):e,void(u=this.tree.createElement_({name:l.displayName,value:e,type:"property",category:h,css:{name:"aggregate-name"}},u))}const f={name:l.displayName,value:"Varies",type:"category",category:h};if(u=this.tree.createElement_(f,u),this.setCategoryCollapsed(f,!0),h=l.displayName,(c||a)&&u.classList.add("indented"),n){const e={};for(let t in n){if("count"===t){e[t]=n[t];continue}if("mode"===t){e[t]=n[t].map((e=>o(e,l))).join(", ");continue}const i=n[t];e[t]=o(i,l)}this.tree.createElement_({map:e,default:"sum",type:"property",category:h},u)}const p=[];for(let e in s){const t=o(e,l),i=s[e];for(let e=0;e<i.length;++e){const t=r.indexOf(i[e]);t>-1&&r.splice(t,1)}p.push({name:i,value:t,type:"property",category:h})}r.length>0&&this.tree.createElement_({name:r,value:"--",type:"property",category:h},u),p.forEach((e=>{this.tree.createElement_(e,u)}))}))},uM.prototype.setProperties=function(e){this.removeAllProperties();var t=[],i=[];for(let r=0;r<e.length;r++){let o=e[r];if(!o.hidden){var n=e[r].displayCategory;n&&"string"==typeof n&&""!==n?t.push(o):i.push(o)}}if(t.length+i.length===0)return void this.showNoProperties();i[0]&&"Name"===i[0].displayName&&(this.addProperty(i[0].displayName,i[0].displayValue),i.shift());const r=Autodesk.Viewing.Private,o=this.viewer.prefs.get(r.Prefs.DISPLAY_UNITS);let s=this.viewer.prefs.get(r.Prefs.DISPLAY_UNITS_PRECISION);for(let e=0;e<t.length;e++){let i=t[e],n="number"==typeof s?s:i.precision||by(i.displayValue),r=xy(i.displayValue,i.type,i.units,o),a=my(r.displayValue,r.displayUnits,i.type,n);this.addProperty(i.displayName,a,i.displayCategory)}for(var a=t.length>0,l=0;l<i.length;l++){let e=i[l],t="number"==typeof s?s:e.precision||by(e.displayValue),n=xy(e.displayValue,e.type,e.units,o),r=my(n.displayValue,n.displayUnits,e.type,t);this.addProperty(e.displayName,r,a?"Other":"",a?{localizeCategory:!0}:{})}},uM.prototype.showNoProperties=function(){this.removeAllProperties();var e=this.tree.myRootContainer,t=this.getDocument().createElement("div");t.className="no-properties";var i="No properties to display";t.setAttribute("data-i18n",i),t.textContent=hs.t(i),e.appendChild(t)},uM.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},uM.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},uM.prototype.addProperty=function(e,t,i,n){if(this.tree.getElementForNode({name:e,value:t,category:i}))return!1;var r=null,o={name:e,value:t,type:"property"};return i?((r=this.tree.getElementForNode({name:i}))||(r=this.tree.createElement_({name:i,type:"category"},this.tree.myRootContainer,n&&n.localizeCategory?{localize:!0}:null)),o.category=i):r=this.tree.myRootContainer,this.tree.createElement_(o,r,n&&n.localizeProperty?{localize:!0}:null),!0},uM.prototype.hasProperties=function(){for(var e in this.highlightableElements)return!0;return!1},uM.prototype.removeProperty=function(e,t,i){var n={name:e,value:t,category:i},r=this.tree.getElementForNode(n);return!!r&&(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(n)],r.parentNode.removeChild(r),!0)},uM.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},uM.prototype.setCategoryCollapsed=function(e,t){var i=this.tree.delegate().getTreeNodeId(e);this.tree.setCollapsed(i,t)},uM.prototype.isCategoryCollapsed=function(e){var t=this.tree.delegate().getTreeNodeId(e);return this.tree.isCollapsed(t)},uM.prototype.getContentSize=function(){var e=this.tree.myRootContainer;return{height:e.clientHeight+55,width:e.clientWidth}},uM.prototype.highlight=function(e){function t(t){var i=t.innerHTML,n=i.replace(/(<highlight>|<\/highlight>)/gim,"");if(i!==n&&(t.innerHTML=n),e&&""!==e){var r=new RegExp("(\\b"+e+"\\b)","gim"),o=n.replace(r,"<highlight>$1</highlight>");t.innerHTML=o}}for(var i in this.highlightableElements)for(var n=this.highlightableElements[i],r=0;r<n.length;++r)t(n[r])},uM.prototype.displayCategory=function(e,t,i){var n=this.getDocument(),r=n.createElement("div"),o=e.name;i&&i.localize&&(r.setAttribute("data-i18n",o),o=hs.t(o)),r.textContent=o,r.title=o,r.className="category-name",t.appendChild(r);const s=[r];if(e.value){var a=n.createElement("div");a.textContent=e.value;var l=e.value;a.title=l,l=hM(l),a.innerHTML=l,a.className="category-value",t.appendChild(a),s.push(a)}return s},uM.prototype.displayProperty=function(e,t,i){var n,r=this.getDocument(),o=r.createElement("div");if(o.className="separator",e.map){n=r.createElement("select");for(let t in e.map){var s=r.createElement("option");s.value=t,t=t.charAt(0).toUpperCase()+t.slice(1),s.setAttribute("data-i18n",t),s.textContent=hs.t(t),n.add(s)}n.value=e.default,e.value=e.map[e.default],n.className="property-drop-down",o.innerText="="}else{n=r.createElement("div");var a=e.name;i&&i.localize&&(n.setAttribute("data-i18n",a),a=hs.t(a)),n.textContent=a,n.title=a,n.className="property-name"}var l=r.createElement("div");l.textContent=e.value;var c=e.value;l.title=c,c=hM(c),l.innerHTML=c,l.className="property-value",e.map&&n.addEventListener("change",(t=>{const i=t.target.value,n=e.map[i];l.title=n,l.innerHTML=n}),!1);const u=e.css;return u&&(u.name&&n.classList.add(u.name),u.value&&l.classList.add(u.value)),t.appendChild(n),t.appendChild(o),t.appendChild(l),[n,l]},uM.prototype.getCategoryClass=function(){return"category"},uM.prototype.getPropertyClass=function(){return"property"},uM.prototype.onCategoryClick=function(e){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},uM.prototype.onPropertyClick=function(){},uM.prototype.onCategoryIconClick=function(e){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},uM.prototype.onPropertyIconClick=function(){},uM.prototype.onCategoryDoubleClick=function(){},uM.prototype.onPropertyDoubleClick=function(){},uM.prototype.onCategoryRightClick=function(){},uM.prototype.onPropertyRightClick=function(){},dM.prototype=Object.create(uM.prototype),dM.prototype.constructor=dM,HT.call(dM.prototype),dM.prototype._onDisplayUnitPreferenceChanged=function(){this.isDirty=!0;const e=this.currentModel?this.currentModel.getRootId():null;if(null!==this.propertyNodeId&&this.propertyNodeId!==e){const e={model:this.currentModel};e.selection=Array.isArray(this.propertyNodeId)?this.propertyNodeId:[this.propertyNodeId],this.requestAggregatedNodeProperties(e)}else this.requestProperties()},dM.prototype.initialize=function(){uM.prototype.initialize.call(this);var e=this;this.viewer.prefs.addListeners(Autodesk.Viewing.Private.Prefs.DISPLAY_UNITS,this._onDisplayUnitPreferenceChanged),this.viewer.prefs.addListeners(Autodesk.Viewing.Private.Prefs.DISPLAY_UNITS_PRECISION,this._onDisplayUnitPreferenceChanged),e.addEventListener(e.viewer,pr,(function(t){t.selections&&t.selections.length?(e.currentNodeIds=t.selections[0].dbIdArray,e.currentModel=t.selections[0].model,e.currentSelections=[],t.selections.forEach((t=>{e.currentSelections.push({model:t.model,selection:t.dbIdArray})}))):e.resetCurrentModel(),e.isDirty=!0,e.requestProperties()})),e.addEventListener(e.viewer,xr,(function(t){t&&t.dbId&&(e.currentModel=t.model,e.requestAggregatedNodeProperties({model:t.model,selection:[t.dbId]}))})),e.addEventListener(e.viewer,vr,(function(t){e.isDirty=!0,e.requestProperties()})),e.addEventListener(e.viewer,qn,(function(t){e.currentModel===t.model&&(e.isDirty=!0,e.requestProperties())})),e.addEventListener(e.viewer,br,(function(t){e.isDirty=!0,e.requestProperties()})),e.viewer.addEventListener(Yn,(function(t){t.model===e.currentModel&&e.resetCurrentModel()}));var t=this.viewer.getAggregateSelection();t.length?(this.currentModel=t[0].model,this.currentNodeIds=t[0].selection,this.currentSelections=t):this.resetCurrentModel()},dM.prototype.resetCurrentModel=function(){var e=this.viewer?this.viewer.getVisibleModels():[];this.currentModel=1===e.length?e[0]:null,this.currentNodeIds=[],this.currentSelections=[]},dM.prototype.setTitle=function(e,t){e||(e="Object Properties",(t=t||{}).localizeTitle=!0),uM.prototype.setTitle.call(this,e,t)},dM.prototype.setVisible=function(e){NT.prototype.setVisible.call(this,e),this.requestProperties()},dM.prototype.visibilityChanged=function(){NT.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties()},dM.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentSelections.length>0?this.requestAggregatedNodeProperties(this.currentSelections):this.showDefaultProperties(),this.isDirty=!1)},dM.prototype.onProperties=function(e){if(!this.viewer||!this.currentModel)return;if(e.dbId!==this.propertyNodeId)return;var t,i=[],n=e.properties;if(n)for(var r=0,o=n.length;r<o;++r){var s=n[r];"__internalref__"===s.displayCategory&&i.push(s.displayValue)}const a=this.currentModel;t=a.is3d()&&fM(a)&&i.length>0?function(e,t,i){return new Promise((function(n,r){e.getBulkProperties2(t,{ignoreHidden:!0},(function(e){for(var t=0,r=e.length;t<r;++t)for(var o=e[t],s=0,a=o.properties.length;s<a;++s){for(var l=o.properties[s],c=!0,u=0,h=i.properties.length;u<h;++u)i.properties[u].displayName===l.displayName&&(c=!1,u=h);c&&i.properties.push(l)}n(i)}))}))}(a,i,e):Promise.resolve(e),t.then(this.setPropertiesIntoUI).catch((()=>{this.setProperties([]),this.highlight(""),this.resizeToContent(),this.respositionPanel()}))},dM.prototype.onPropertySet=function(e){if(!this.viewer||!this.currentModel)return;if(0===e.getVisibleKeys().length)return this.onPropError(),this.resizeToContent(),void this.respositionPanel();const t=e.map,i=[];let n;e.getValidIds(null,"__internalref__").forEach((e=>{t[e].forEach((e=>{i.includes(e.displayValue)||i.push(e.displayValue)}))}));const r=this.currentModel;n=r.is3d()&&fM(r)&&i.length>0?function(e,t,i){return new Promise(((n,r)=>{e.getPropertySet(t,(e=>{n(i.merge(e))}),r,{ignoreHidden:!0})}))}(r,i,e):Promise.resolve(e),n.then(this.setAggregatedPropertiesIntoUI).catch((e=>{rt.error(e),this.setProperties([]),this.highlight(""),this.resizeToContent(),this.respositionPanel()}))},dM.prototype.setAggregatedPropertiesIntoUI=function(e){const t=e.getDbIds().length;if(1===t){let t=Object.prototype.hasOwnProperty.call(e.map,"Name"),i=t?e.map.Name[0]:this.normalTitle;"object"==typeof i&&Object.prototype.hasOwnProperty.call(i,"displayValue")&&(t=!0,i=i.displayValue),this.setTitle(i,{localizeTitle:!t})}else this.setTitle("Properties %(value)",{localizeTitle:!0,i18nOpts:{value:`(${t})`}});this.setAggregatedProperties(e),this.highlight(this.viewer.searchText),this.resizeToContent(),this.respositionPanel()},dM.prototype.setPropertiesIntoUI=function(e){var t=e.name||this.normalTitle,i=!e.name;this.setTitle(t,{localizeTitle:i}),"name"in e&&e.properties&&e.properties.splice(0,0,{displayName:"Name",displayValue:e.name,displayCategory:null,attributeName:"Name",type:20,units:null,hidden:!1,precision:0}),this.setProperties(e.properties),this.highlight(this.viewer.searchText),this.resizeToContent(),this.respositionPanel()},dM.prototype.onPropError=function(){this.setTitle(this.normalTitle,{localizeTitle:!0}),this.showNoProperties()},dM.prototype.requestAggregatedNodeProperties=function(e){var t;1===(e=Array.isArray(e)?e:[e]).length&&1===(null===(t=e[0].selection)||void 0===t?void 0:t.length)&&(this.propertyNodeId=e[0].selection[0]);const i=[];e.forEach((e=>{var t,n;i.push(e.model.getPropertySetAsync(e.selection,{fileType:null===(t=e.model.getData())||void 0===t||null===(t=t.loadOptions)||void 0===t?void 0:t.fileExt,needsExternalId:null===(n=e.model.getData())||void 0===n||null===(n=n.loadOptions)||void 0===n?void 0:n.needsExternalId}))})),Promise.all(i).then((e=>{const t=e[0];for(let i=1;i<e.length;i++)t.merge(e[i]);this.onPropertySet(t)})).catch(this.onPropError)},dM.prototype.requestNodeProperties=function(e){const t=this.currentModel;this.propertyNodeId=e;const i=Array.isArray(e);(i?t.getPropertySet.bind(t):t.getProperties2.bind(t))(e,(e=>{this.viewer&&t===this.currentModel&&(i?this.onPropertySet(e):this.onProperties(e))}),this.onPropError)},dM.prototype.setNodeProperties=dM.prototype.requestNodeProperties,dM.prototype.requestViewProperties=function(e){if(null!==this._viewDbId){const e={model:this.currentModel,selection:[this._viewDbId]};return void this.requestAggregatedNodeProperties(e)}const t=this.currentModel,i=t.getRootId();this.propertyNodeId=i,t.getPropertySet([i],(n=>{if(!this.viewer)return;if(t!==this.currentModel)return;this._viewDbId=i;const r=e.name(),o=e.isSheet(),s=[],a=[],l=n.getValidIds("Sheet"),c=n.getValidIds("View");l.forEach((e=>{n.map[e].forEach((e=>{a.push(e.displayValue)}))})),c.forEach((e=>{n.map[e].forEach((e=>{s.push(e.displayValue)}))}));const u=o?a:s;if(0!==u.length){var h=this;t.getBulkProperties2(u,{propFilter:["name","dbId"],ignoreHidden:!0},(function(e){const s=[];for(let t=0;t<e.length;++t)if(-1!==r.indexOf(e[t].name)){const i=e[t].dbId;if(!o)return h._viewDbId=i,void h.requestAggregatedNodeProperties({model:h.currentModel,selection:[i]});s.push(i)}0!==s.length?function(e,t,i){return new Promise((function(n,r){i=i||e.myData.metadata.title,e.getBulkProperties2(t,{ignoreHidden:!0},(function(e){for(var t=0,r=e.length;t<r;++t){var o=e[t];if(o.name&&-1!==i.indexOf(o.name))for(var s=0,a=o.properties.length;s<a;++s){var l=o.properties[s];if("Sheet Number"===l.displayName&&-1!==i.indexOf(l.displayValue))return n(o)}}return n(null)}))}))}(t,s,r).then((function(e){e&&e.dbId&&e.dbId!==i?(h._viewDbId=e.dbId,h.requestAggregatedNodeProperties({model:h.currentModel,selection:[e.dbId]})):h.onPropertySet(n)})):h.onPropertySet(n)}))}else this.onPropertySet(n)}),this.onPropError)},dM.prototype.respositionPanel=function(){if(this.isVisible()){var e=this.viewer.toolController,t=e.lastClickX,i=e.lastClickY,n=this.container.getBoundingClientRect(),r=n.left,o=n.top,s=n.width,a=n.height,l=this.viewer.impl.getCanvasBoundingClientRect(),c=l.left,u=l.top,h=l.width,d=l.height;r<=t&&t<r+s&&o<=i&&i<o+a&&(t<r+s/2&&t+s<c+h?(this.container.style.left=Math.round(t-c)+"px",this.container.dockRight=!1):c<=t-s?(this.container.style.left=Math.round(t-c-s)+"px",this.container.dockRight=!1):t+s<c+h?(this.container.style.left=Math.round(t-c)+"px",this.container.dockRight=!1):i+a<u+d?(this.container.style.top=Math.round(i-u)+"px",this.container.dockBottom=!1):u<=i-a&&(this.container.style.top=Math.round(i-u-a)+"px",this.container.dockBottom=!1))}},dM.prototype.showDefaultProperties=function(){var e=this.currentModel?this.currentModel.getRootId():null;if(e){const t=this.currentModel.getDocumentNode();t&&!t.isMasterView()?this.requestViewProperties(t):this.requestAggregatedNodeProperties({model:this.currentModel,selection:[e]})}else this.propertyNodeId=null,this.setTitle(this.normalTitle,{localizeTitle:!0}),uM.prototype.showDefaultProperties.call(this)},dM.prototype.areDefaultPropertiesShown=function(){if(!this.currentModel)return!1;var e=this.currentModel.getRootId();return this.propertyNodeId===e},dM.prototype.uninitialize=function(){uM.prototype.uninitialize.call(this),this.viewer.prefs.removeListeners(Autodesk.Viewing.Private.Prefs.DISPLAY_UNITS,this._onDisplayUnitPreferenceChanged),this.viewer.prefs.removeListeners(Autodesk.Viewing.Private.Prefs.DISPLAY_UNITS_PRECISION,this._onDisplayUnitPreferenceChanged),this.viewer=null,this._viewDbId=null,this.currentModel=null,this.currentSelections=[],this.propertyNodeId=null,this.currentNodeIds=null},dM.prototype.onCategoryClick=function(e,t){uM.prototype.onCategoryClick.call(this,e,t),this.resizeToContent()},dM.prototype.onCategoryIconClick=function(e,t){uM.prototype.onCategoryIconClick.call(this,e,t),this.resizeToContent()},pM.prototype=Object.create(Na.prototype),pM.prototype.constructor=pM;var mM=pM.prototype;const gM=Autodesk.Viewing.Private;function vM(e,t){Na.call(this,e,t),this.viewer=e,this.options=t,this.name="viewersettings"}mM.load=function(){return this.viewer.addEventListener(mr,this._onIsolateEvent),this.viewer.addEventListener(pr,this._onSelectionChangeEvent),this.viewer.prefs.addListeners(Pn.OPEN_PROPERTIES_ON_SELECT,this._onPrefChange),this.viewer.registerContextMenuCallback(this.name,this._onContextMenu),!0},mM.unload=function(){this.viewer.removeEventListener(mr,this._onIsolateEvent),this.viewer.removeEventListener(pr,this._onSelectionChangeEvent),this.viewer.prefs.removeListeners(Pn.OPEN_PROPERTIES_ON_SELECT,this._onPrefChange),this.viewer.unregisterContextMenuCallback(this.name),this.deactivate(),this.setPanel(null),this._toolbarButton&&(this.viewer.settingsTools.removeControl(this._toolbarButton),this.viewer.settingsTools.propertiesbutton=null,this._toolbarButton=null)},mM.onToolbarCreated=function(){this.setDefaultPanel(),this._addToolbarButton()},mM.activate=function(){return!!this._panel&&(this._panel.setVisible(!0),!0)},mM.deactivate=function(){return this._panel&&this._panel.setVisible(!1),!0},mM.isActive=function(){return!!this._panel&&this._panel.isVisible()},mM.setPanel=function(e){return(e instanceof uM||!e)&&(this._panel&&(this._panel.setVisible(!1),this.viewer.removePanel(this._panel),this._panel.uninitialize()),this._panel=e,e&&(this.viewer.addPanel(e),e.addVisibilityListener((e=>{e&&this.viewer.onPanelVisible(this._panel),this._toolbarButton.setState(e?xT.State.ACTIVE:xT.State.INACTIVE)}))),!0)},mM.setDefaultPanel=function(){this.setPanel(new dM(this.viewer))},mM.getPanel=function(){return this._panel},mM.getToolbarButton=function(){return this._toolbarButton},mM._addToolbarButton=function(){if(!this._toolbarButton){var e=this._toolbarButton=new xT("toolbar-propertiesTool");e.setToolTip("Properties"),e.setIcon("adsk-icon-properties"),e.onClick=()=>{this._panel.setVisible(!this._panel.isVisible()),this._panel.isVisible()&&gM.analytics.track("viewer.properties",{action:"View List",from:"Toolbar"})},e.setVisible(!this.viewer.prefs.get("openPropertiesOnSelect")),this.viewer.settingsTools.addControl(e,{index:1}),this.viewer.settingsTools.propertiesbutton=e}},mM._onIsolateEvent=function(e){this._panel&&(this.viewer.prefs.get("openPropertiesOnSelect")||e.nodeIdArray[0]===e.model.getRootId())&&this._panel.setVisible(e.nodeIdArray.length>0||this.viewer.impl.selector.hasSelection())},mM._onSelectionChangeEvent=function(e){if(!this.viewer.prefs.get("openPropertiesOnSelect"))return;let t=!1;for(let i=0;i<e.selections.length;++i)if(e.selections[i].dbIdArray.length>0){t=!0;break}t?this.activate():this.deactivate()},mM._onPrefChange=function(e){this._toolbarButton&&this._toolbarButton.setVisible(!e)},mM._onContextMenu=function(e,t){if(this.isActive())return;if(!t.hasSelected)return;const i={title:"Show Properties",target:()=>{this.activate(),gM.analytics.track("viewer.properties",{action:"View List",from:"Contextual"})}};e.unshift(i)},vM.prototype=Object.create(Na.prototype),vM.prototype.constructor=vM;var yM=vM.prototype;function bM(e){this.parentDiv=e;var t=this.getDocument();this.container=t.createElement("div"),this.container.innerHTML=['<div class="path">','<svg width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<path d="M2.5,50a47.5,47.5 0 1,0 95,0a47.5,47.5 0 1,0 -95,0" vector-effect="non-scaling-stroke"/>','<path d="M 2.5 50 A 47.5 47.5 0 0 1 47.5 2.5" vector-effect="non-scaling-stroke"/>',"</svg>","</div>",'<div class="message" data-i18n="Spinner Loading">LOADING</div>'].join(""),this.container.className="loading-spinner"}yM.activate=function(){this.activeStatus||(this.viewer.showViewer3dOptions(!0),this.viewer.getSettingsPanel(!0).selectTab(JT.Performance),this.activeStatus=!0);return!0},yM.deactivate=function(){return this.activeStatus&&(this.viewer.showViewer3dOptions(!1),this.activeStatus=!1),!0},fo.call(bM.prototype),bM.prototype.addClass=function(e){this.container.classList.add(e)},bM.prototype.attachToDom=function(){return!this.container.parentNode&&(hs.localize(this.container),this.parentDiv.appendChild(this.container),!0)},bM.prototype.removeFromDom=function(){return!!this.container.parentNode&&(this.container.parentNode.removeChild(this.container),!0)},bM.prototype.setVisible=function(e){e?this.attachToDom():this.removeFromDom()};var xM=150,_M=300;function EM(e,t){this.dirty=!1,this.nextFrameId=0,this.scrollY=0,this.delegates=[],this.idToDelegate={},this.options=t;var i=this.getDocument();this.rootContainer=i.createElement("div"),this.rootContainer.classList.add("docking-panel-container-gradient"),this.rootContainer.classList.add("treeview"),this.rootContainer.classList.add("on-demand"),e.appendChild(this.rootContainer),this.paddingDiv=i.createElement("div"),this.paddingDiv.style.border=0,this.paddingDiv.style.margin=0,this.paddingDiv.style.padding=0,this.sizedDiv=e.parentNode,this.nodeCssTable=[[],["group"],["leaf"]],this.cssStringToNodeCssTable={"":0,group:1,leaf:2},this.nodeIndexToNodeCssTables={};for(var n=[],r=xM,o=0;o<r;++o){var s=LM(i);n[o]=s}this.elementsPool=n,this.elementsUsed=0,this.spinner=new bM(e),this.spinner.setGlobalManager(this.globalManager),this.spinner.addClass("tree-loading-spinner");for(o=0;o<r;++o){(s=n[o]).addEventListener("click",RM.bind(this)),s.addEventListener("dblclick",DM.bind(this)),s.addEventListener("contextmenu",OM.bind(this)),s.icon.addEventListener("click",BM.bind(this)),s.icon.addEventListener("mousedown",NM.bind(this))}wM(this)}function SM(e){if(e.dirty=!1,function(e){for(var t=e.elementsUsed,i=e.elementsPool,n=0;n<t;++n){var r=i[n];r.setAttribute("lmv-nodeId",""),r.className="";var o=r.header,s=o.childNodes.length-1;o._mouseDownListener&&(o.removeEventListener("mousedown",o._mouseDownListener),o._mouseDownListener=null);for(var a=0;a<s;++a)o.removeChild(o.lastChild);o.lastChild._mouseDownListener&&(o.lastChild.removeEventListener("mousedown",o.lastChild._mouseDownListener),o.lastChild._mouseDownListener=null),o.lastChild._clickListener&&(o.lastChild.removeEventListener("click",o.lastChild._clickListener),o.lastChild._clickListener=null)}e.clear()}(e),e.displayNoProperties(!1),0!==e.delegates.length)if(1===e.delegates.length&&e.delegates[0].isLoading())e.spinner.setVisible(!0);else{if(1===e.delegates.length&&e.delegates[0].isNotAvailable())return e.spinner.setVisible(!1),void e.displayNoProperties(!0);e.spinner.setVisible(!1),function(e){var t=e.rootContainer,i=function(e){return{width:0|e.sizedDiv.clientWidth,height:0|e.sizedDiv.clientHeight}}(e),n=i.height,r=0,o=0,s=!0;t.appendChild(e.paddingDiv);var a=e.delegates.slice(0),l=e.isExcludeRoot();for(;a.length;){var c=a.shift();let i={};const w=c.model.isOTG();if(w){const e=c.model.getFragmentList(),t=new Set;for(let i=0;i<e.getCount();i++){const n=e.getDbIds(i);e.isNotLoaded(i)||t.add(n)}i=c.instanceTree.nodeAccess.dbIdToIndexFiltered((e=>t.has(e)))}var u=c.modelDiv;t.appendChild(u);for(var h=[c.getRootId()],d={curr:l?-1:0,popIds:[]};h.length&&s;){if(r>e.scrollY+n+_M){s=!1;break}if(e.elementsUsed===e.elementsPool.length){s=!1;break}var f=h.shift();if(!w||i[f]){var p=r+(S=-1===d.curr?0:c.getTreeNodeClientHeight(f));if(S>0&&p+_M>=e.scrollY){var m=e.elementsPool[e.elementsUsed++];m.setAttribute("lmv-nodeId",f),c.createTreeNode(f,m.header);var g=c.getTreeNodeClass(f);g&&m.classList.add(g);var v=IM(e,c,f);if(v)for(var y=v.length,b=0;b<y;++b)m.classList.add(v[b]);if(c.instanceTree){const e=c.instanceTree.isNodeHidden(f);m.classList.toggle("dim",e),m.classList.toggle("visible",!e)}var x=c.getTreeNodeDepthOffset(f,d.curr);m.header.style.paddingLeft=x+"px",u.appendChild(m)}if(p+_M<e.scrollY&&(o=p),r=p,(A=AM(e,c,f,0===S))&&A.length>0){d.curr++;for(var _=A[A.length-1],E=d.popIds.length-1;E>=0&&d.popIds[E]===f;)d.popIds[E--]=_;d.popIds.push(_),h=A.concat(h)}for(;d.popIds.length>0&&f===d.popIds[d.popIds.length-1];)d.popIds.pop(),d.curr--}else for(;d.popIds.length>0&&f===d.popIds[d.popIds.length-1];)d.popIds.pop(),d.curr--}for(e.paddingDiv.style.height=o+"px";h.length;){var S,A;f=h.shift();r=p=r+(S=-1===d.curr?0:c.getTreeNodeClientHeight(f)),(A=AM(e,c,f))&&A.length&&(h=A.concat(h))}}t.style.height=r+"px"}(e)}else e.spinner.setVisible(!1)}function AM(e,t,i,n){if(!t.isTreeNodeGroup(i))return null;if(!n&&e.isCollapsed(t,i))return null;var r=[];return t.forEachChild(i,(function(e){r.push(e)})),r}function wM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.dirty&&!t||(t?SM(e):(e.dirty=!0,e.nextFrameId=requestAnimationFrame((function(){SM(e)}))))}function CM(e,t){return"number"!=typeof t&&"string"!=typeof t?e.threeDelegate.getTreeNodeId(0|t):t}function TM(e,t){for(var i=null;t&&t!==e.rootContainer;){if(t.hasAttribute("lmv-nodeId")){i=t;break}t=t.parentElement}if(!i)return null;var n=i.getAttribute("lmv-nodeId");return parseInt(n)}function MM(e,t){for(var i=null;t&&t!==e.rootContainer;){if(t.hasAttribute("lmv-modelId")){i=t;break}t=t.parentElement}if(!i)return null;var n=i.getAttribute("lmv-modelId");return parseInt(n)}function IM(e,t,i){if(t.isControlId(i))return t.getControlIdCss(i);var n=t.getTreeNodeIndex(i);return e.nodeCssTable[e.nodeIndexToNodeCssTables[t.model.id][n]]}function PM(e,t,i,n){var r=n.join(" "),o=e.cssStringToNodeCssTable[r]||e.nodeCssTable.length;o===e.nodeCssTable.length&&(e.nodeCssTable.push(n),e.cssStringToNodeCssTable[r]=o);var s=t.getTreeNodeIndex(i);e.nodeIndexToNodeCssTables[t.model.id][s]=o}function LM(e,t,i){var n=e.createElement("lmvheader"),r=e.createElement("icon");n.appendChild(r);var o=e.createElement("div");return o.header=n,o.icon=r,o.appendChild(n),o}function RM(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=TM(this,e.target);if(t){var i=MM(this,e.target),n=this.getDelegate(i);n&&(n.onTreeNodeClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function DM(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=TM(this,e.target);if(t){var i=MM(this,e.target),n=this.getDelegate(i);n&&(n.onTreeNodeDoubleClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function OM(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=TM(this,e.target);if(t){var i=MM(this,e.target),n=this.getDelegate(i);n&&(n.onTreeNodeRightClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function BM(e){var t=TM(this,e.target);if(t){var i=MM(this,e.target),n=this.getDelegate(i);n&&(n.onTreeNodeIconClick(this,t,e),e.stopPropagation(),e.preventDefault())}}function NM(e){e.stopPropagation(),e.preventDefault()}EM.prototype.constructor=EM,fo.call(EM.prototype),EM.prototype.pushDelegate=function(e){this.delegates.push(e),this.idToDelegate[e.model.id]=e,wM(this)},EM.prototype.removeDelegate=function(e){for(var t=0;t<this.delegates.length;++t){var i=this.delegates[t];if(i.model.id===e)return this.delegates.splice(t,1),delete this.idToDelegate[e],delete this.nodeIndexToNodeCssTables[e],i.dtor(),wM(this),!0}return!1},EM.prototype.setInstanceTree=function(e,t){if(e.setInstanceTree(t),wM(this),t){var i=new Uint8Array(e.getTreeNodeCount()),n=e.instanceTree.getRootId();e.forEachChild(n,(function(t){var n=e.getTreeNodeIndex(t);i[n]=e.isTreeNodeGroup(t)?1:2}),!0);var r=e.model.id;this.nodeIndexToNodeCssTables[r]=i;var o=0,s=0;t.enumNodeChildren(n,(function(e){s||(o=e),s++})),this.setAllCollapsed(e,!0);var a=this.options.excludeRoot,l=this.options.startCollapsed;a?(this.setCollapsed(e,n,!1),l||this.setCollapsed(e,o,!1)):l||this.setCollapsed(e,e.rootId,!1),wM(this,!0)}},EM.prototype.show=function(e){this.rootContainer.style.display=e?"block":"none"},EM.prototype.getRootContainer=function(){return this.rootContainer},EM.prototype.getDelegate=function(e){return this.idToDelegate[parseInt(e)]},EM.prototype.isCollapsed=function(e,t){var i=IM(this,e,t);return i&&-1!==i.indexOf("collapsed")},EM.prototype.setCollapsed=function(e,t,i,n){i?(this.addClass(e,t,"collapsed",n),this.removeClass(e,t,"expanded",n)):(this.addClass(e,t,"expanded",n),this.removeClass(e,t,"collapsed",n))},EM.prototype.setAllCollapsed=function(e,t){var i=function(t){this.addClass(e,t,"collapsed",!1),this.removeClass(e,t,"expanded",!1)}.bind(this),n=e.instanceTree.getRootId();this.iterate(e,n,(function(t){return e.isTreeNodeGroup(t)&&i(t),!0}))},EM.prototype.addToSelection=function(e,t){for(var i=t.length,n=0;n<i;++n)this.addClass(e,t[n],"selected",!1);wM(this)},EM.prototype.removeFromSelection=function(e,t){for(var i=t.length,n=0;n<i;++n)this.removeClass(e,t[n],"selected",!1);wM(this)},EM.prototype.setSelection=function(e,t){return this.clearSelection(e),this.addToSelection(e,t),this.selectedNodes},EM.prototype.clearSelection=function(e){var t=[],i=function(i){var n=IM(this,e,i);n&&-1!==n.indexOf("selected")&&(t[0]=i,this.removeFromSelection(e,t))}.bind(this),n=e.instanceTree.getRootId();e.forEachChild(n,i,!0)},EM.prototype.isSelected=function(e){var t=IM(this,delegate,e);return t&&-1!==t.indexOf("selected")},EM.prototype.scrollTo=function(e,t){var i=this.getDelegate(t.id);if(!i||!i.isNotAvailable()){var n=!1,r=[],o=function(t,i){if(!(n=n||e===t)){r.push(i.getTreeNodeClientHeight(t));var s=r.length,a=i.isTreeNodeGroup(t)&&-1!==IM(this,i,t).indexOf("expanded");i.forEachChild(t,(function(e){o(e,i)})),a||n||r.length>s&&r.splice(s)}}.bind(this);this.setCollapsed(i,e,!1,!0);var s=i.getRootId();if(o(s,i),!n)return-1;for(var a=0,l=r.length,c=this.isExcludeRoot()?1:0;c<l;++c)a+=r[c];if(1===this.delegates.length)return wM(this,!0),a;for(c=0;c<this.delegates.length;++c){var u=this.delegates[c];if(u===i)break;r=[],e=-1,n=!1,s=u.getRootId(),o(s,u),l=r.length;for(var h=0,d=0;d<l;++d)h+=r[d];a+=h}return wM(this,!0),a}},EM.prototype.addClass=function(e,t,i,n){function r(t,i,n){var r=IM(t,e,i);r&&(-1===r.indexOf(n)&&((r=r.slice(0)).push(n),r.sort(),PM(t,e,i,r)))}if(n)for(var o=e.getTreeNodeParentId(CM(this,t));o;)r(this,o,i),o=e.getTreeNodeParentId(o);else r(this,t,i);return wM(this),!0},EM.prototype.removeClass=function(e,t,i,n){function r(t,i,n){var r=IM(t,e,i);if(r){var o=r.indexOf(n);-1!==o&&((r=r.slice(0)).splice(o,1),PM(t,e,i,r))}}if(n)for(var o=e.getTreeNodeParentId(CM(this,t));o;)r(this,o,i),o=e.getTreeNodeParentId(o);else r(this,t,i);return wM(this),!0},EM.prototype.hasClass=function(e,t){return 1!==IM(this,delegate,e).indexOf(t)},EM.prototype.clear=function(){for(var e,t=this.rootContainer;e=t.lastChild;)t.removeChild(e);for(var i=0;i<this.delegates.length;++i)this.delegates[i].clean();this.elementsUsed=0},EM.prototype.iterate=function(e,t,i){null!=t&&e.shouldCreateTreeNode(t)&&i(t)&&e.forEachChild(t,function(t){this.iterate(e,t,i)}.bind(this))},EM.prototype.forEachDelegate=function(e){for(var t=0;t<this.delegates.length;++t)e(this.delegates[t])},EM.prototype.destroy=function(){this.clear(),cancelAnimationFrame(this.nextFrameId),this.rootContainer.parentNode.removeChild(this.rootContainer),this.rootContainer=null,this.rootId=-1,this.nodeCssTable=null,this.nodeIndexToNodeCssTables=null,this.cssStringToNodeCssTable=null,this.elementsPool=null,this.elementsUsed=-1,this.scrollY=-1},EM.prototype.setScroll=function(e){Math.abs(this.scrollY-e)>_M&&(this.scrollY=e,wM(this))},EM.prototype.displayNoProperties=function(e){var t=this.getDocument();if(e){if(!this.divNoProps){this.divNoProps=t.createElement("div");var i="Model Browser is not available";this.divNoProps.innerText=hs.t(i),this.divNoProps.setAttribute("data-i18n",i),this.divNoProps.classList.add("lmv-no-properties")}if(!this.divNoProps.parentNode)this.rootContainer.parentNode.appendChild(this.divNoProps)}else this.divNoProps&&this.divNoProps.parentNode&&this.divNoProps.parentNode.removeChild(this.divNoProps)},EM.prototype.isExcludeRoot=function(){return 1===this.delegates.length&&this.options.excludeRoot},EM.prototype.getDelegateCount=function(){return this.delegates.length};var UM=-1,kM=-2;function FM(e,t){lM.call(this),this.panel=e,this.model=t;let i=this.getDocument();this.modelDiv=i.createElement("div"),this.modelDiv.classList.add("model-div"),this.modelDiv.setAttribute("lmv-modelId",t.id),this.instanceTree=null,this.rootId=UM,this.state=1}function VM(e){var t=function(e){var t=e.getData();if(t&&t.loadOptions&&t.loadOptions.modelNameOverride)return t.loadOptions.modelNameOverride;return""}(e);if(t)return t;if(!e.getData())return"";var i=e.getDocumentNode();return i?i.getModelName():"Model"}function GM(e,t,i,n){NT.call(this,e,t,i,n),this.container.classList.add("model-structure-panel"),(n=n||{}).heightAdjustment||(n.heightAdjustment=40),n.marginTop||(n.marginTop=0),n.left=!0,this.createScrollContainer(n),this.onScroll=this.onScroll.bind(this),this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.style["overflow-x"]="hidden",this.options=n,this.tree=null,this._pendingModels=[],this.uiCreated=!1;var r=this;this.addVisibilityListener((function(e){e&&(r.uiCreated||r.createUI(),r.resizeToContent())}))}FM.prototype=Object.create(lM.prototype),FM.prototype.constructor=FM,FM.prototype.isLoading=function(){return 1===this.state},FM.prototype.isAvailable=function(){return 2===this.state},FM.prototype.isNotAvailable=function(){return 3===this.state},FM.prototype.isControlId=function(e){return e===UM||e===kM},FM.prototype.getControlIdCss=function(e){return null},FM.prototype.getRootId=function(){return this.rootId},FM.prototype.getTreeNodeId=function(e){return"object"==typeof e?(rt.warn("Object used instead of dbId. Fix it."),e.dbId):e},FM.prototype.getTreeNodeIndex=function(e){return this.instanceTree.nodeAccess.dbIdToIndex[e]},FM.prototype.getTreeNodeLabel=function(e){if(e===UM){var t=VM(this.model);return hs.t("Loading model",{name:t})}return e===kM||e===this.getRootId()?t=VM(this.model):e==re?"Object 0":this.instanceTree.getNodeName(e,!0)||"Object "+e},FM.prototype.getTreeNodeClass=function(e){return e===UM||e===kM?"message-unexpected":""},FM.prototype.getTreeNodeParentId=function(e){if(e===re)return 0;let t=this.instanceTree.nodeAccess.getParentId(e);return 0===t?re:t},FM.prototype.getTreeNodeCount=function(){return this.instanceTree.nodeAccess.getNumNodes()},FM.prototype.getTreeNodeClientHeight=function(e){return 36},FM.prototype.getTreeNodeDepthOffset=function(e,t){return 13+25*t},FM.prototype.isTreeNodeGroup=function(e){return!this.isControlId(e)&&this.instanceTree.getChildCount(e)>0},FM.prototype.shouldCreateTreeNode=function(e){return!0},FM.prototype.createTreeNode=function(e,t){let i=this,n=i.getDocument(),r=function(){var e=function(){i.removeDocumentEventListener("mouseup",e),this.classList.remove("highlight")}.bind(t);t.classList.add("highlight"),i.addDocumentEventListener("mouseup",e)};if(t.addEventListener("mousedown",r),t._mouseDownListener=r,!this.isControlId(e)){var o=n.createElement("div");o.dbId=e,o.classList.add("visibility");let i=function(e){e.preventDefault(),e.stopPropagation()};o.addEventListener("mousedown",i),o._mouseDownListener=i;let r=function(e){e.preventDefault(),e.stopPropagation();var t=parseInt(e.target.dbId);this.panel.onEyeIcon(t,this.model)}.bind(this);o.addEventListener("click",r),o._clickListener=r,t.appendChild(o)}if(e===UM){var s=n.createElement("img");s.src=de("res/ui/spinner.png"),s.style.animation="loading-spinner-perpetual-motion 1s infinite linear",s.style.float="right",s.style.marginRight="5px",s.style.width="20px",t.appendChild(s)}var a={localize:e===UM||e===kM};lM.prototype.createTreeNode.call(this,e,t,a)},FM.prototype.onTreeNodeRightClick=function(e,t,i){this.isControlId(t)||this.panel.onTreeNodeRightClick(e,t,this.model,i)},FM.prototype.onTreeNodeClick=function(e,t,i){this.isControlId(t)||this.panel.onTreeNodeClick(e,t,this.model,i)},FM.prototype.onTreeNodeDoubleClick=function(e,t,i){},FM.prototype.onTreeNodeIconClick=function(e,t,i){if(this.isTreeNodeGroup(t)){var n=e.isCollapsed(this,t);e.setCollapsed(this,t,!n)}},FM.prototype.onTreeNodeReized=function(e){},FM.prototype.forEachChild=function(e,t,i){this.isControlId(e)||this.instanceTree.enumNodeChildren(e,t,i)},FM.prototype.setInstanceTree=function(e){this.instanceTree=e,this.state=e?2:3,this.rootId=e?e.getRootId():kM,function(e){var t=e.instanceTree;if(!t)return;var i,n=e.rootId,r=t.getNodeName(n),o=0,s=0;t.enumNodeChildren(n,(function(e){s||(i=t.getNodeName(e),o=e),s++})),e.hasDoubleRoot=1===s&&r===i,e.rootId=e.hasDoubleRoot?o:n}(this)},FM.prototype.clean=function(){for(var e,t=this.modelDiv;e=t.lastChild;)t.removeChild(e)},FM.prototype.dtor=function(){this.model=null},GM.prototype=Object.create(NT.prototype),GM.prototype.constructor=GM,GM.prototype.uninitialize=function(){var e;this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.parentNode.removeChild(this.scrollContainer),null===(e=this.tree)||void 0===e||e.destroy(),NT.prototype.uninitialize.call(this)},GM.prototype.addModel=function(e){if(e)if(this.uiCreated)this.createTreeUI(e);else{if(-1!==this._pendingModels.indexOf(e))return;this._pendingModels.push(e)}},GM.prototype.unloadModel=function(e){if(e)if(this.uiCreated)this.removeTreeUI(e);else{var t=this._pendingModels.indexOf(e);if(-1===t)return;this._pendingModels.splice(t,1)}},GM.prototype.createUI=function(){if(!this.uiCreated){var e,t="";if(this.options&&this.options.defaultTitle?(t=this.options.defaultTitle,e=void 0===this.options.localizeTitle||!!this.options.localizeTitle):(t=this.modelTitle,e=!1),t||(t="Browser",e=!0),this.setTitle(t,{localizeTitle:e}),this.uiCreated=!0,this.tree=new EM(this.scrollContainer,this.options),this.tree.setGlobalManager(this.globalManager),0!==this._pendingModels.length){for(var i=0;i<this._pendingModels.length;++i)this.createTreeUI(this._pendingModels[i]);this._pendingModels=[]}}},GM.prototype.createTreeUI=function(e){if(this.tree.getDelegate(e.id))return!1;var t=new FM(this,e);t.setGlobalManager(this.globalManager),this.tree.pushDelegate(t);var i=this;return e.getObjectTree((function(e){i.setInstanceTree(t,e)}),(function(){i.setInstanceTree(t,null)})),!0},GM.prototype.setInstanceTree=function(e,t){this.tree.setInstanceTree(e,t)},GM.prototype.removeTreeUI=function(e){this.tree.removeDelegate(e.id)&&(this.scrollContainer.scrollTop=0,this.onScroll())},GM.prototype.onScroll=function(){this.tree.setScroll(this.scrollContainer.scrollTop)},GM.prototype.getNodeLabel=function(e){return this.myDelegate.getNodeLabel(e)},GM.prototype.onTreeNodeClick=function(){throw new Error("Method must be overriden.")},GM.prototype.onTreeNodeRightClick=function(){throw new Error("Method must be overriden.")},GM.prototype.onTitleClick=function(){},GM.prototype.onTitleDoubleClick=function(){};let zM="search-selected";var HM=50,WM=150,jM=100;function qM(e,t,i){let n=i;this.excludeRoot=t,(n instanceof Autodesk.Viewing.GuiViewer3D||n instanceof Autodesk.Viewing.Viewer3D)&&(rt.warn("Deprecated use of Viewer as parameter. Provide container instead"),n=i.container),this.results=[],this.resultCount=0,this.selectedIndex=-1;let r=this.getDocument();this.container=r.createElement("div"),this.container.classList.add("docking-panel"),this.container.classList.add("adsk-search-results"),this.container.results=r.createElement("div"),this.container.results.classList.add("docking-panel-scroll"),this.container.results.classList.add("docking-panel-container-solid-color-b"),this.container.results.addEventListener("scroll",XM.bind(this)),this.container.appendChild(this.container.results),e.insertBefore(this.container,e.firstChild),this.scrollingContainer=r.createElement("div"),this.scrollingContainer.classList.add("adsk-search-results-scrolling-panel"),this.scrollingContainer.addEventListener("click",KM.bind(this)),this.container.results.appendChild(this.scrollingContainer),this.footer=new DT(this.container,function(){var e=this.container.getBoundingClientRect(),t=n.getBoundingClientRect();t.right<e.right&&(this.container.style.width=t.right-e.left+"px"),t.bottom<e.bottom&&(this.container.style.height=t.bottom-e.top+"px")}.bind(this)),this.footer.setGlobalManager(this.globalManager),this.divNoResults=function(e){var t=e.createElement("div"),i=e.createElement("div"),n=e.createElement("div");t.classList.add("no-results-container"),t.style.display="none";var r="No Results";i.setAttribute("data-i18n",r),i.textContent=Autodesk.Viewing.i18n.translate(r),i.classList.add("no-results-title");var o="Try another term";return n.setAttribute("data-i18n",o),n.textContent=Autodesk.Viewing.i18n.translate(o),n.classList.add("no-results-description"),t.appendChild(i),t.appendChild(n),t.domTitle=i,t.domMessage=n,t}(r),this.scrollingContainer.appendChild(this.divNoResults),this.scrollY=0,this.dirty=!1,this.nextFrameId=0,this.it={init:function(e){return this.isDone=!1,this.results=e,this.indexRs=0,this.indexId=-1,this},done:function(){return this.isDone},next:function(){if(this.isDone)return this;for(this.indexId++;this.results.length!==this.indexRs&&this.indexId===this.results[this.indexRs].ids.length;)this.indexId=0,this.indexRs++;return this.isDone=this.indexRs===this.results.length,this},id:function(){return this.results[this.indexRs].ids[this.indexId]},delegate:function(){return this.results[this.indexRs].delegate}},this.elementsPool=[],this.elementsUsed=0;for(var o=0;o<WM;++o)this.elementsPool[o]=$M(r);this.setVisible(!1)}function KM(e){var t=e.target,i=this._getNodeAndModelIds(t);i&&(this.fireEvent({type:zM,id:i.nodeId,modelId:i.modelId}),e.preventDefault())}function XM(){var e=this.container.results.scrollTop;Math.abs(this.scrollY-e)>=jM&&(this.scrollY=e,YM(this))}function YM(e,t){e.dirty&&!t||(t?QM(e):(e.dirty=!0,e.nextFrameId=requestAnimationFrame((function(){QM(e)}))))}function QM(e){e.dirty=!1,function(e){for(var t=e.elementsUsed,i=e.elementsPool,n=0;n<t;++n){JM(i[n])}e.elementsUsed=0}(e),0!==e.resultCount?(e.setDisplayNoResults(!1),function(e){var t=e.container.results,i=0,n=t.clientHeight,r=e.scrollY,o=e.it.init(e.results),s=Math.max(0,e.scrollY-jM),a=0|Math.floor(s/HM),l=0;i=a*HM;for(;a;)a--,l++,o.next();var c=e.elementsPool[e.elementsUsed++];c.style.height=i+"px",e.scrollingContainer.appendChild(c);var u=!0;for(;u;){if(o.next(),o.done()){u=!1;break}if(i>r+n+jM){u=!1;break}if(e.elementsUsed===e.elementsPool.length){u=!1;break}var h=o.id(),d=o.delegate(),f=i+HM,p=e.elementsPool[e.elementsUsed++];ZM(h,d,p,e,l===e.selectedIndex),e.scrollingContainer.appendChild(p),i=f,l++}var m=e.resultCount*HM;e.scrollingContainer.style.height=m+"px"}(e)):e.setDisplayNoResults(!0)}function ZM(e,t,i,n,r){i.classList.add("search-result"),r?i.classList.add("selected"):i.classList.remove("selected"),i.setAttribute("lmv-nodeId",e),i.setAttribute("lmv-modelId",t.model.id),i.style.height=HM+"px";var o=t.instanceTree.getNodeName(e),s=n.searchString,a=o.toLowerCase().indexOf(s.toLowerCase()),l=o.substr(0,a),c=o.substr(a,s.length),u=o.substr(a+s.length);i.domPrefix.innerText=l,i.domMatch.innerText=c,i.domSufix.innerText=u;var h=function(e,t,i){var n=[],r=t.getRootId(),o=i.isRootExcluded(),s=t.instanceTree,a=e,l=!1;for(;a&&!l&&(a!==r||(l=!0,!o));){var c=s.getNodeName(a);n.unshift(c),a=s.getNodeParentId(a)}return n}(e,t,n);i.domPath.innerText=h.join(" > ")}function $M(e){var t=e.createElement("div"),i=e.createElement("div"),n=e.createElement("span"),r=e.createElement("span"),o=e.createElement("span"),s=e.createElement("span");return i.classList.add("search-result-container"),r.classList.add("search-match"),s.classList.add("search-path"),i.appendChild(n),i.appendChild(r),i.appendChild(o),i.appendChild(s),t.appendChild(i),t.domPrefix=n,t.domMatch=r,t.domSufix=o,t.domPath=s,t.domContainer=i,t}function JM(e){e.setAttribute("lmv-nodeId",""),e.setAttribute("lmv-modelId",""),e.domPrefix.innerText="",e.domMatch.innerText="",e.domSufix.innerText="",e.domPath.innerText="",e.style.height="0"}function eI(e,t){e.scrollTop+e.clientHeight<(t+1)*HM&&(e.scrollTop+=(t+1)*HM-(e.scrollTop+e.clientHeight)),e.scrollTop/HM>t&&(e.scrollTop=t*HM)}function tI(e,t,i){this._id=e,this._listeners={},this._options=i||{},this._searchFunction=this._options.searchFunction||function(){};var n=this.getDocument();this.container=n.createElement("div"),this.container.id=e,this.addClass("adsk-control"),this.addClass("adsk-searchbox"),this.addClass("empty");var r=n.createElement("input");r.classList.add("search-box"),r.classList.add("docking-panel-delimiter-shadow"),r.type="search",r.results=[],r.placeholder=hs.t("Search"),r.setAttribute("data-i18n","Search"),r.incremental="incremental",r.autosave=this.container.id+"search_autosave",this.container.insertBefore(r,this.scrollContainer),this.searchbox=r;var o=function(){c.searchbox.value="",c.addClass("empty")},s=function(){c.searchbox.classList.remove("searching"),c.searchResults.setVisible(!1)},a=n.createElement("div");a.className="search-box-icon",this.container.insertBefore(a,r.nextSibling);var l=n.createElement("div");l.className="search-box-close",l.addEventListener("click",(function(){o(),s()})),this.container.appendChild(l),this.searchResults=new qM(this.container,i.excludeRoot,t),this.searchResults.addEventListener(zM,(function(e){o(),s(),c.fireEvent(e)}));var c=this,u=!0;r.addEventListener("keydown",(function(e){var t=c.getWindow();if(38===(e=e||t.event).keyCode&&(c.searchResults.selectPrevious(),e.preventDefault()),40===e.keyCode&&(c.searchResults.selectNext(),e.preventDefault()),13===e.keyCode){var i=c.searchResults.getSelection();if(!i)return!1;o(),s(),c.fireEvent({type:tI.Events.ON_SEARCH_SELECTED,id:i.nodeId,modelId:i.modelId}),e.preventDefault()}}));var h=YT()((()=>{if(0===r.value.length)return c.container.classList.add("empty"),void s();c.container.classList.remove("empty"),r.value.length<3||function(){var e=r.value.trim();if(0!==e.length){u&&(rt.track({category:"search_node",name:"model_browser_tool"}),u=!1),r.classList.add("searching");var t=c._searchFunction(e);c.searchResults.setResults(e,t),c.searchResults.setVisible(!0)}else s()}()}),800);r.addEventListener("input",(function(){h()})),r.addEventListener("change",(function(e){var t=c.getDocument();e.target===t.activeElement&&h()})),r.addEventListener("focus",(function(){a.classList.add("focused")})),r.addEventListener("blur",(function(){a.classList.remove("focused")}))}qM.prototype.constructor=qM,Ba.prototype.apply(qM.prototype),fo.call(qM.prototype),qM.prototype.setPosition=function(e,t){this.container.style.left=e+"px",this.container.style.top=t+"px"},qM.prototype.setMinWidth=function(e){this.container.style.width=e+"px"},qM.prototype.setMaxWidth=function(e){this.container.style.maxHeight=e+"px"},qM.prototype.setVisible=function(e){this.container.style.display=e?"":"none"},qM.prototype.setResults=function(e,t){this.searchString=e,this.results=t,this.resultCount=function(e){for(var t=0,i=0;i<e.length;++i){t+=e[i].ids.length}return t}(t),this.selectedIndex=0==this.resultCount?-1:0,this.container.style.height=this.resultCount*HM+20+"px",this.container.results.scrollTop=0,this.scrollY=0,0===this.resultCount?this.container.classList.add("no-content"):this.container.classList.remove("no-content"),YM(this)},qM.prototype.getSelection=function(){var e=this.scrollingContainer.querySelector(".selected");if(!e)return null;var t=this._getNodeAndModelIds(e);return t||null},qM.prototype.isRootExcluded=function(){return!(this.results&&this.results.length>1)&&(!(this.modelCount>1)&&this.excludeRoot)},qM.prototype.uninitialize=function(){this.setVisible(!1),this.container=null,this.container.parentNode&&this.container.parentNode.removeChild(this.container),cancelAnimationFrame(this.nextFrameId),this.clearListeners()},qM.prototype.setDisplayNoResults=function(e){this.divNoResults.style.display=e?"":"none"},qM.prototype.selectNext=function(){0!==this.resultCount&&(this.selectedIndex=Math.min(this.resultCount-1,this.selectedIndex+1),eI(this.container.results,this.selectedIndex),YM(this))},qM.prototype.selectPrevious=function(){0!==this.resultCount&&(this.selectedIndex=Math.max(0,this.selectedIndex-1),eI(this.container.results,this.selectedIndex),YM(this))},qM.prototype._getNodeAndModelIds=function(e){for(;!e.hasAttribute("lmv-nodeId");)if(!(e=e.parentNode)||e===this.scrollingContainer)return;return{nodeId:parseInt(e.getAttribute("lmv-nodeId")),modelId:parseInt(e.getAttribute("lmv-modelId"))}},tI.prototype=Object.create(bT.prototype),tI.prototype.constructor=tI,tI.Events={ON_SEARCH_SELECTED:zM};const iI=e=>({onSearchSelected:function(t){var i=t.id,n=e.impl.findModel(t.modelId);e.setAggregateIsolation([{model:n,ids:[i]}])},onVisibilityIconClick:function(t,i){e.toggleVisibility(t,i)},onCreateUI:function(t){e.resizePanels&&e.resizePanels({dockingPanels:[t]}),t.scrollContainer.addEventListener("contextmenu",function(t){e.contextMenu.show(t)}.bind(t))},onIsolate:function(t,i){if(e.setAggregateIsolation([{model:i,ids:[t]}]),e.fitToView([t],i,!1),i){var n={type:xr,dbId:t,model:i};e.dispatchEvent(n)}},onToggleMultipleOverlayedSelection:function(t){e.impl.selector.setAggregateSelection(t.map((t=>({model:e.impl.findModel(parseInt(t.modelId)),ids:t.ids}))));var i=e.getAggregateSelection();e.fitToView(i)},onToggleOverlayedSelection:function(t,i,n){n?e.select([],void 0,i):(e.select(t,i),e.fitToView([t],i,!1))},onTreeNodeRightClick:function(t){e.contextMenu.show(t)},onSelectOnly:function(t,i){e.select(t,i)},onDeselectAll:function(){e.clearSelection()},onSelectToggle:function(t,i){e.toggleSelect(t,i)},onShowAll:function(){e.showAll()},onFocus:function(){e.fitToView()},onHide:function(t,i){e.hide(t,i)},onShow:function(t,i){e.show(t,i)},onToggleVisibility:function(t,i){e.toggleVisibility(t,i)},getAggregateIsolation:e.getAggregateIsolation.bind(e),getAggregateHiddenNodes:e.getAggregateHiddenNodes.bind(e),getAggregateSelection:e.getAggregateSelection.bind(e),globalManager:e.globalManager,container:e.container,removeEventListener:e.removeEventListener.bind(e),addEventListener:e.addEventListener.bind(e)}),nI=Autodesk.Viewing.Private;var rI={click:{onObject:["isolate"]},clickShift:{onObject:["toggleMultipleOverlayedSelection"]},clickCtrl:{onObject:["toggleVisibility"]}};function oI(e,t,i){let n={...i}||{},r=t;e instanceof Autodesk.Viewing.GuiViewer3D||e instanceof Autodesk.Viewing.Viewer3D?(rt.warn("Deprecated use of Viewer as parameter. Use options callbacks instead"),n={...n,...iI(e)}):n={...e},this.visible=!1,this._trackNodeClick=!0,n.defaultTitle="Model",n.excludeRoot=void 0===n.excludeRoot||n.excludeRoot,n.startCollapsed=void 0!==n.startCollapsed&&n.startCollapsed,n.scrollEaseCurve=n.scrollEaseCurve||[0,0,.29,1],n.scrollEaseSpeed=void 0!==n.scrollEaseSpeed?n.scrollEaseSpeed:.003,n.addFooter=void 0===n.addFooter||n.addFooter,this.clickConfig=n&&n.docStructureConfig?n.docStructureConfig:rI,this.isMac=-1!==navigator.userAgent.search("Mac OS"),n.hideSearch?(n.heightAdjustment=70,GM.call(this,n.container,n.container.id+"ViewerModelStructurePanel",r,n),this.scrollContainer.classList.add("no-search")):(n.heightAdjustment=104,GM.call(this,n.container,n.container.id+"ViewerModelStructurePanel",r,n),this.searchbox=new tI(n.container.id+"ViewerModelStructurePanel-Searchbox",n.container,{excludeRoot:n.excludeRoot,searchFunction:sI.bind(this)}),this.searchbox.setGlobalManager(this.globalManager),n.onSearchSelected&&this.searchbox.addEventListener(zM,n.onSearchSelected),this.container.appendChild(this.searchbox.container)),this.setGlobalManager(n.globalManager),this._ignoreScroll=!1,this.selectedNodes={},this.onViewerSelect=this.onViewerSelect.bind(this),this.onViewerIsolate=this.onViewerIsolate.bind(this),this.onViewerHide=this.onViewerHide.bind(this),this.onViewerShow=this.onViewerShow.bind(this)}function sI(e){var t=this.tree,i=e.toLowerCase(),n=[];return t.forEachDelegate((function(e){var r=e.getRootId(),o=[];t.iterate(e,r,(function(t){var n=e.instanceTree&&e.instanceTree.getNodeName(t);return n&&-1!==n.toLowerCase().indexOf(i)&&o.push(t),!0})),n.push({ids:o,delegate:e})})),nI.analytics.track("viewer.model_browser",{from:"Panel",action:"Search"}),n}oI.prototype=Object.create(GM.prototype),oI.prototype.constructor=oI,HT.call(oI.prototype),oI.prototype.uninitialize=function(){var e,t,i,n,r,o,s,a;null===(e=(t=this.options).removeEventListener)||void 0===e||e.call(t,pr,this.onViewerSelect),null===(i=(n=this.options).removeEventListener)||void 0===i||i.call(n,gr,this.onViewerIsolate),null===(r=(o=this.options).removeEventListener)||void 0===r||r.call(o,vr,this.onViewerHide),null===(s=(a=this.options).removeEventListener)||void 0===s||s.call(a,br,this.onViewerShow),this.searchResults&&(this.searchResults.uninitialize(),this.searchResults=null),GM.prototype.uninitialize.call(this)},oI.prototype.resizeToContent=function(){var e=this.scrollContainer,t=this.tree?this.tree.getRootContainer():null;if(e&&t){var i="calc(100% + "+e.scrollLeft+"px)";t.style.width=i}},oI.prototype.createUI=function(){var e,t,i,n,r,o,s,a,l,c;if(!this.uiCreated){GM.prototype.createUI.call(this),this.scrollContainer.classList.remove("left");var u=function(){this.visible&&this.resizeToContent(),requestAnimationFrame(u)}.bind(this);u(),null===(e=(t=this.options).onCreateUI)||void 0===e||e.call(t,this);var h=this.options,d=h.maxHeight?h.maxHeight:"calc("+this.container.style.maxHeight+" - 30px)";this.container.style.top="10px",this.container.style.left="10px",this.container.style.height=d,this.container.style.maxHeight=d,null===(i=(n=this.options).addEventListener)||void 0===i||i.call(n,pr,this.onViewerSelect),null===(r=(o=this.options).addEventListener)||void 0===r||r.call(o,gr,this.onViewerIsolate),null===(s=(a=this.options).addEventListener)||void 0===s||s.call(a,vr,this.onViewerHide),null===(l=(c=this.options).addEventListener)||void 0===l||l.call(c,br,this.onViewerShow)}},oI.prototype.onViewerSelect=function(e){this.setSelection(e.selections),this._ignoreScroll||this.scrollToSelection(e.selections),this._ignoreScroll=!1},oI.prototype.onViewerIsolate=function(e){this.setIsolation(e.isolation)},oI.prototype.onViewerHide=function(e){this.setHidden(e.nodeIdArray.slice(),e.model,!0)},oI.prototype.onViewerShow=function(e){this.setHidden(e.nodeIdArray.slice(),e.model,!1)},oI.prototype.setVisible=function(e){GM.prototype.setVisible.call(this,e),this.visible!==e&&(this.visible=e,this.visible&&this.sync())},oI.prototype.sync=function(){var e,t,i,n,r,o,s=(null===(e=(t=this.options).getAggregateIsolation)||void 0===e?void 0:e.call(t))||[],a=(null===(i=(n=this.options).getAggregateHiddenNodes)||void 0===i?void 0:i.call(n))||[],l=(null===(r=(o=this.options).getAggregateSelection)||void 0===r?void 0:r.call(o))||[];if(this.setIsolation(s),0===s.length)for(var c=0;c<a.length;++c){var u=a[c].model,h=a[c].ids;this.setHidden(h,u,!0)}this.setSelection(l),this.scrollToSelection(l)},oI.prototype.removeTreeUI=function(e){delete this.selectedNodes[e.id],GM.prototype.removeTreeUI.call(this,e)},oI.prototype.setHidden=function(e,t,i){for(var n=this.tree,r=n.getDelegate(t.id),o=i?function(e){return n.addClass(r,e,"dim",!1),n.removeClass(r,e,"visible",!1),!0}:function(e){return n.removeClass(r,e,"dim",!1),n.addClass(r,e,"visible",!1),!0},s=0;s<e.length;++s)n.iterate(r,e[s],o)},oI.prototype.setIsolation=function(e){var t=this.tree;if(0!==e.length){var i=[];e.length&&this.tree.forEachDelegate(function(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].model===t.model){n=r;break}-1===n&&i.push(t)}.bind(this));for(let i=0;i<e.length;++i){const r=e[i].model,o=r.getData().instanceTree;if(!o)continue;const s=o.getRootId(),a=t.getDelegate(r.id);t.iterate(a,s,(function(e){return t.removeClass(a,e,"dim",!1),t.removeClass(a,e,"visible",!1),!0}));var n=e[i].ids;0!==n.length&&(1===n.length&&n[0]===s||(this.setHidden([s],r,!0),this.setHidden(n,r,!1)))}for(let e=0;e<i.length;++e){const n=i[e],r=n.model,o=n.instanceTree;if(!o)continue;const s=o.getRootId();t.iterate(n,s,(function(e){return t.removeClass(n,e,"dim",!1),t.removeClass(n,e,"visible",!1),!0})),this.setHidden([s],r,!0)}}else t.forEachDelegate(function(e){var i=e.model,n=e.instanceTree;if(n){var r=n.getRootId();t.iterate(e,r,(function(i){return t.removeClass(e,i,"dim",!1),t.removeClass(e,i,"visible",!1),!0})),this.setHidden([r],i,!1)}}.bind(this))},oI.prototype.setSelection=function(e){var t,i,n,r,o,s,a,l=this.tree;for(var c in this.selectedNodes)if(o=this.selectedNodes[c],(s=l.getDelegate(c))&&(a=s.instanceTree)){for(i=0;i<o.length;++i)for(n=a.getNodeParentId(o[t]);n;)l.removeClass(s,n,"ancestor-selected"),n=a.getNodeParentId(n);l.clearSelection(s)}for(this.selectedNodes={},t=0;t<e.length;++t)if(r=e[t].model,o=e[t].dbIdArray||e[t].selection,(s=l.getDelegate(r.id))&&(a=s.instanceTree)){for(i=0;i<o.length;++i)for(n=a.getNodeParentId(o[t]);n;)l.addClass(s,n,"ancestor-selected"),n=a.getNodeParentId(n);l.setSelection(s,o),this.selectedNodes[r.id]=o.concat()}},oI.prototype.scrollToSelection=function(e){var t=e[0];if(t){var i=t.model,n=t.dbIdArray||t.selection,r=this.tree.scrollTo(n[0],i),o=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=r;var s=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=o,this.options.scrollEaseSpeed>0?this.animateScroll(o,s,function(e){this.tree.setScroll(e)}.bind(this)):(this.scrollContainer.scrollTop=s,this.tree.setScroll(s))}},oI.prototype.onEyeIcon=function(e,t){var i,n;null===(i=(n=this.options).onVisibilityIconClick)||void 0===i||i.call(n,e,t),nI.analytics.track("viewer.model_browser",{from:"Panel",action:"Toggle Visibility"})},oI.prototype.onTreeNodeClick=function(e,t,i,n){if(this._trackNodeClick&&(rt.track({category:"node_selected",name:"model_browser_tool"}),this._trackNodeClick=!1),!this.isMac||!n.ctrlKey){var r="click";this.ctrlDown(n)&&(r+="Ctrl"),n.shiftKey&&(r+="Shift"),n.altKey&&(r+="Alt");var o=["toggleOverlayedSelection"],s=this.clickConfig[r];s&&(o=s.onObject),nI.analytics.track("viewer.model_browser",{from:"Panel",action:"Select"}),this.handleAction(o,t,i)}},oI.prototype.onTreeNodeRightClick=function(e,t,i,n){if(this.isMac&&n.ctrlKey&&0===n.button)return this.clickConfig&&this.clickConfig.clickCtrl&&this.handleAction(this.clickConfig.clickCtrl.onObject,t,i),null;this.options.onTreeNodeRightClick&&this.options.onTreeNodeRightClick(n)},oI.prototype.handleAction=function(e,t,i){var n,r,o,s,a,l,c,u,h,d,f,p,m,g,v,y;for(var b in e)switch(e[b]){case"toggleOverlayedSelection":this.toggleOverlayedSelection(t,i);break;case"toggleMultipleOverlayedSelection":this.toggleMultipleOverlayedSelection(t,i);break;case"selectOnly":this.options.onSelectOnly&&this.options.onSelectOnly(t,i);break;case"deselectAll":null===(n=(r=this.options).onDeselectAll)||void 0===n||n.call(r,t,i);break;case"selectToggle":null===(o=(s=this.options).onSelectToggle)||void 0===o||o.call(s,t,i);break;case"isolate":null===(a=(l=this.options).onIsolate)||void 0===a||a.call(l,t,i);break;case"showAll":null===(c=(u=this.options).onShowAll)||void 0===c||c.call(u,t,i);break;case"focus":null===(h=(d=this.options).onFocus)||void 0===h||h.call(d,t,i);break;case"hide":null===(f=(p=this.options).onHide)||void 0===f||f.call(p,t,i);break;case"show":null===(m=(g=this.options).onShow)||void 0===m||m.call(g,t,i);break;case"toggleVisibility":null===(v=(y=this.options).onToggleVisibility)||void 0===v||v.call(y,t,i)}},oI.prototype.toggleOverlayedSelection=function(e,t){var i,n,r=this.selectedNodes[t.id],o=r?r.indexOf(e):-1;this._ignoreScroll=!0,null===(i=(n=this.options).onToggleOverlayedSelection)||void 0===i||i.call(n,e,t,-1!==o)},oI.prototype.toggleMultipleOverlayedSelection=function(e,t){var i=this.selectedNodes[t.id],n=i?i.indexOf(e):-1;if(-1===n?(i||(i=this.selectedNodes[t.id]=[]),i.push(e)):i.splice(n,1),this.options.onToggleMultipleOverlayedSelection){var r=[];for(var o in this.selectedNodes)if(Object.prototype.hasOwnProperty.call(this.selectedNodes,o)){var s=this.selectedNodes[o];r.push({modelId:o,ids:s})}this.options.onToggleMultipleOverlayedSelection(r)}this._ignoreScroll=!0},oI.prototype.ctrlDown=function(e){return this.isMac&&e.metaKey||!this.isMac&&e.ctrlKey};const aI=Autodesk.Viewing.Private;function lI(e,t){Na.call(this,e,t),this.viewer=e,this.options=t,this.name="modelstructure",this._modelstructure=null,this._onLoadModel=this._onLoadModel.bind(this),this._onUnloadModel=this._onUnloadModel.bind(this)}lI.prototype=Object.create(Na.prototype),lI.prototype.constructor=lI;var cI=lI.prototype;function uI(e,t){xT.call(this,e,t),this.arrowButton=new xT(e+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new VT(e+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild);var i=this;this.arrowButton.onClick=function(){i.subMenu.setVisible(!i.subMenu.isVisible())},this.toggleFlyoutVisible=function(){i.subMenu.setVisible(!i.subMenu.isVisible())},this.onClick=function(){i.subMenu.setVisible(!i.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(e){e.isActiveButton?(i.setIcon(e.target.getActiveButton().iconClass),i.setToolTip(e.target.getActiveButton().getToolTip()),i.setState(xT.State.ACTIVE),i.onClick=e.button.onClick):i.setState(xT.State.INACTIVE)},this.subMenu.addEventListener(VT.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var n=me('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(n,this.subMenu.container.firstChild),n.addEventListener("click",(function(e){i.subMenu.setVisible(!1),e.stopPropagation()}))}cI.load=function(){return this.viewer.addEventListener(Zn,this._onLoadModel),this.viewer.addEventListener(Hn,this._onLoadModel),this.viewer.addEventListener(Yn,this._onUnloadModel),this.viewer.addEventListener($n,this._onUnloadModel),!0},cI.unload=function(){return this.deactivate(),this.setModelStructurePanel(null),this._structureButton&&(this.viewer.settingsTools.removeControl(this._structureButton),this.viewer.settingsTools.structurebutton=null,this._structureButton=null),this.viewer.removeEventListener(Zn,this._onLoadModel),this.viewer.removeEventListener(Hn,this._onLoadModel),this.viewer.removeEventListener(Yn,this._onUnloadModel),this.viewer.removeEventListener($n,this._onUnloadModel),!0},cI.onToolbarCreated=function(){const e=new xT("toolbar-modelStructureTool");e.setToolTip("Model browser"),e.setIcon("adsk-icon-structure"),e.onClick=()=>{!this._modelstructure.isVisible()?this.activate():this.deactivate()};const t=this.viewer.settingsTools;t.addControl(e,{index:0}),t.structurebutton=e,this._structureButton=e,this.restoreDefaultPanel()},cI.activate=function(){return!!this._modelstructure&&(this._modelstructure.setVisible(!0),aI.analytics.track("viewer.model_browser",{action:"View List"}),!0)},cI.deactivate=function(){return this._modelstructure&&this._modelstructure.setVisible(!1),!0},cI.isActive=function(){return!!this._modelstructure&&this._modelstructure.isVisible()},cI.setModelStructurePanel=function(e){if(e===this._modelstructure)return!1;if(this._modelstructure&&(this._modelstructure.setVisible(!1),this.viewer.removePanel(this._modelstructure),this._modelstructure.uninitialize()),this._modelstructure=e,this.viewer.modelstructure=e,!e)return!0;this.viewer.addPanel(this._modelstructure);for(var t=this.viewer.impl.modelQueue().getModels(),i=0;i<t.length;++i)this._modelstructure.addModel(t[i]);return this._modelstructure.addVisibilityListener((e=>{e&&this.viewer.onPanelVisible(this._modelstructure),this._structureButton.setState(e?xT.State.ACTIVE:xT.State.INACTIVE)})),!0},cI.restoreDefaultPanel=function(){const e=this.viewer.config;var t={docStructureConfig:e.docStructureConfig,hideSearch:F(),excludeRoot:e.modelBrowserExcludeRoot,startCollapsed:e.modelBrowserStartCollapsed},i=e.defaultModelStructureTitle||"Browser",n=new oI({...t,...iI(this.viewer)},i);this.setModelStructurePanel(n)},cI._onLoadModel=function(e){this._modelstructure&&this._modelstructure.addModel(e.model)},cI._onUnloadModel=function(e){this._modelstructure&&this._modelstructure.unloadModel(e.model)},uI.prototype=Object.create(xT.prototype),uI.prototype.constructor=uI,uI.prototype.addControl=function(e){this.subMenu.addControl(e),e.addEventListener(xT.Event.CLICK,this.toggleFlyoutVisible)},uI.prototype.removeControl=function(e){this.subMenu.removeControl(e),e.removeEventListener(xT.Event.CLICK,this.toggleFlyoutVisible)},uI.prototype.setState=function(e){if(e===xT.State.INACTIVE){var t=this.subMenu.getActiveButton();t&&t.setState(xT.State.INACTIVE)}xT.prototype.setState.call(this,e)},uI.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},uI.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(xT.State.INACTIVE))};var hI="dolly",dI="freeorbit",fI="orbit",pI="worldup",mI="fittoview";function gI(e,t){Na.call(this,e,t),this.name="navtools",this.modes=["pan",hI,dI,fI,"fov",pI,mI],this.onToolChanged=this.onToolChanged.bind(this),this.onNavigationModeChanged=this.onNavigationModeChanged.bind(this),this.navToolsConfig=t.navToolsConfig||{}}gI.prototype=Object.create(Na.prototype),gI.prototype.constructor=gI;var vI=gI.prototype;function yI(e,t,i){return function(){e.isActive(i)?e.deactivate():e.activate(i)}}vI.load=function(){var e=this.viewer,t=new cT(e);if(e.toolController.registerTool(t),!this.navToolsConfig.isAECCameraControls){var i=new uT(e.impl,e);e.toolController.registerTool(i)}return this.initFocalLengthOverlay(),e.addEventListener(Mr,this.onToolChanged),e.addEventListener(Bn,this.onNavigationModeChanged),!0},vI.updateUI=function(e){e!==this.is3d&&(this._destroyUI(),this._createUI(e))},vI.onToolbarCreated=function(){var e=!this.viewer.impl.is2d;this._createUI(e)},vI.navActionDisplayMode=function(e){return this.viewer.navigation.isActionEnabled(e)?"block":"none"},vI._createUI=function(e){var t=this.viewer.getToolbar().getControl(vT.NAVTOOLSID);if(e){var i=new uI("toolbar-orbitTools");i.setToolTip("Orbit"),i.setIcon("adsk-icon-orbit-constrained"),i.setDisplay(this.navActionDisplayMode("orbit")),this.createOrbitSubmenu(i),t.addControl(i),t.orbittoolsbutton=i,i.setState(xT.State.ACTIVE),t.returnToDefault=function(){i.setState(xT.State.ACTIVE)}}var n=new xT("toolbar-panTool");n.setToolTip("Pan"),n.setIcon("adsk-icon-pan"),n.onClick=yI(this,0,"pan"),n.setDisplay(this.navActionDisplayMode("pan")),t.addControl(n),t.panbutton=n,e||(t.returnToDefault=function(){n.setState(xT.State.ACTIVE)},t.returnToDefault());var r=new xT("toolbar-zoomTool");if(r.setToolTip("Zoom"),r.setIcon("adsk-icon-zoom"),r.onClick=yI(this,0,hI),r.setDisplay(this.navActionDisplayMode("zoom")),t.addControl(r),t.dollybutton=r,this.navToolsConfig.isAECCameraControls)t.addControl(this.createFitViewButton(t));else{var o=new uI("toolbar-cameraSubmenuTool");o.setToolTip("Camera interactions"),o.setIcon("adsk-icon-camera"),o.saveAsDefault(),this.createCameraSubmenu(o,e),t.addControl(o),t.camerabutton=o}this.is3d=e},vI.createOrbitSubmenu=function(e){var t=this.viewer.getToolbar().getControl(vT.NAVTOOLSID),i=new xT("toolbar-freeOrbitTool");i.setToolTip("Free orbit"),i.setIcon("adsk-icon-orbit-free"),i.onClick=yI(this,0,dI),e.addControl(i),t.freeorbitbutton=i;var n=new xT("toolbar-orbitTool");n.setToolTip("Orbit"),n.setIcon("adsk-icon-orbit-constrained"),n.onClick=yI(this,0,fI),e.addControl(n),t.orbitbutton=n,e.onClick=n.onClick},vI.createFitViewButton=function(e,t){var i=this.viewer,n=new xT("toolbar-fitToViewTool");return n.setToolTip("Fit to view"),n.setIcon("adsk-icon-fit-to-view"),n.onClick=function(){i.impl.fitToView(i.impl.selector.getAggregateSelection());Autodesk.Viewing.Private.analytics.track("viewer.fit_to_view",{from:"UI"});var e=i.getDefaultNavigationToolName();i.setActiveNavigationTool(e),t&&t.restoreDefault()},n.setDisplay(this.navActionDisplayMode("gotoview")),e.fittoviewbutton=n,n},vI.createCameraSubmenu=function(e,t){var i=this,n=this.viewer,r=n.getToolbar().getControl(vT.NAVTOOLSID);if(O()){var o=new xT("toolbar-homeTool");o.setToolTip("Home"),o.setIcon("adsk-icon-home"),o.onClick=function(){n.navigation.setRequestHomeView(!0);var t=n.getDefaultNavigationToolName();i.activate(t),e.restoreDefault()},o.setDisplay(this.navActionDisplayMode("gotoview")),e.addControl(o),r.homebutton=o}if(e.addControl(this.createFitViewButton(r,e)),t){var s=new xT("toolbar-focalLengthTool");s.setToolTip("Focal length"),s.setIcon("adsk-icon-fov"),s.onClick=yI(this,0,"fov"),s.setDisplay(this.navActionDisplayMode("fov")),e.addControl(s),r.fovbutton=s}var a=new xT("toolbar-rollTool");a.setToolTip("Roll"),a.setIcon("adsk-icon-roll"),a.onClick=yI(this,0,pI),a.setDisplay(this.navActionDisplayMode("roll")),e.addControl(a),r.rollbutton=a},vI.onToolChanged=function(e){if("fov"===e.toolName&&this.showFocalLengthOverlay(e.active),e.active)switch(e.toolName){case"dolly":this.handleAltRelease("dollybutton");break;case"pan":this.handleAltRelease("panbutton");break;case"worldup":this.handleAltRelease("rollbutton");break;case"fov":this.handleAltRelease("fovbutton")}},vI.onNavigationModeChanged=function(e){if(this.viewer.getDefaultNavigationToolName()===e.id){var t=this.viewer.getToolbar();if(!t)return;var i=t.getControl(vT.NAVTOOLSID);if(!i)return;i.returnToDefault&&i.returnToDefault()}},vI.handleAltRelease=function(e){var t=this.viewer.getToolbar();if(t){var i=t.getControl(vT.NAVTOOLSID),n=i&&i[e];n&&n.setState(xT.State.ACTIVE)}},vI.initFocalLengthOverlay=function(){const e=this.getDocument();var t=this.focallength=e.createElement("div");t.classList.add("message-panel"),t.classList.add("docking-panel"),t.classList.add("focal-length"),t.classList.add("docking-panel-container-solid-color-b");var i=e.createElement("table"),n=e.createElement("tbody");i.appendChild(n),t.appendChild(i),this.viewer.container.appendChild(t);var r=n.insertRow(-1),o=r.insertCell(0);o.classList.add("name"),o.setAttribute("data-i18n","Focal Length"),o.textContent=hs.t("Focal Length"),(o=r.insertCell(1)).classList.add("value"),o.textContent="",this.fovCell=o,t.style.visibility="hidden"},vI.showFocalLengthOverlay=function(e){var t=this,i=this.viewer,n=0;function r(e){if(e){CT.displayMessage(i.container,{msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."})}else CT.dismiss()}function o(e){e&&s(),t.focallength&&(t.focallength.style.visibility=e?"visible":"hidden")}function s(){var e=i.getFocalLength();n!==e&&(n=e,t.fovCell.textContent=e.toString()+" mm")}function a(){if(s(),"fov"===i.toolController.getActiveToolName()){var e=i.navigation.getCamera(),t=e&&!e.isPerspective;o(!t),r(t)}}var l=i.navigation.getCamera(),c=l&&!l.isPerspective;o(e&&!c),r(e&&c),e?i.addEventListener(Sr,a):i.removeEventListener(Sr,a)},vI.unload=function(){return this._destroyUI(),!0},vI._destroyUI=function(){var e=this.viewer,t=e.getToolbar();if(!t)return!0;var i=t.getControl(vT.NAVTOOLSID);if(!i)return!0;function n(e){e&&(e.subMenu.removeEventListener(VT.Event.ACTIVE_BUTTON_CHANGED,e.subMenuActiveButtonChangedHandler(i)),i.removeControl(e.getId()),e.onClick=null)}function r(e){e&&(i.removeControl(e.getId()),e.onClick=null)}return this.is3d&&(n(i.orbittoolsbutton),i.orbittoolsbutton=null,r(i.orbitbutton),i.orbitbutton=null,r(i.freeorbitbutton),i.freeorbitbutton=null,r(i.fovbutton),i.fovbutton=null),r(i.panbutton),i.panbutton=null,r(i.dollybutton),i.dollybutton=null,n(i.camerabutton),i.camerabutton=null,r(i.rollbutton),i.rollbutton=null,r(i.fittoviewbutton),i.fittoviewbutton=null,this.focallength&&(e.container.removeChild(this.focallength),this.focallength=null),e.removeEventListener(Mr,this.onToolChanged),this.onToolChanged=null,e.removeEventListener(Bn,this.onNavigationModeChanged),this.onNavigationModeChanged=null,!0},vI.activate=function(e){if(this.isActive(e))return!1;if(e===mI)return this.viewer.impl.fitToView(this.viewer.impl.selector.getAggregateSelection()),!0;if(-1!=this.modes.indexOf(e)){const t=this.viewer.getDefaultNavigationToolName();return-1===this.modes.indexOf(t)&&this.viewer.activateDefaultNavigationTools(this.viewer.model.is2d()),this.viewer.setActiveNavigationTool(e),!0}return!1},vI.deactivate=function(){return this.viewer.setActiveNavigationTool(),!0},vI.isActive=function(e){return this.viewer.getActiveNavigationTool()===e};const bI=Autodesk.Viewing.GlobalManagerMixin;class xI extends aT{constructor(e){var t;super(),t=this,this.names=["explode"],this.viewer=e,this.setGlobalManager(this.viewer.globalManager),this.active=!1,this.activate=()=>{this.active=!0},this.deactivate=function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&t.setScale(0),t.active=!1},this.isActive=()=>this.active}setScale(e){let t=e,i=this.viewer.getExplodeOptions();return this.viewer.explode(t,i)}getScale(){return this.viewer.getExplodeScale()}setMagnitude(e){let t=this.viewer.getExplodeScale(),i=this.viewer.getExplodeOptions();return i.magnitude=e,this.viewer.explode(t,i)}getMagnitude(){return this.viewer.getExplodeOptions().magnitude}setDepthDampening(e){let t=this.viewer.getExplodeScale(),i=this.viewer.getExplodeOptions();return i.depthDampening=e,this.viewer.explode(t,i)}getDepthDampening(){return this.viewer.getExplodeOptions().depthDampening}}bI.call(xI.prototype);class _I{constructor(e){this.ext=e;const t=e.viewer,i=new xT("toolbar-explodeTool");i.setIcon("adsk-icon-explode"),i.setToolTip("Explode model"),t.modelTools.addControl(i);let n=me('<div class="docking-panel docking-panel-container-solid-color-b explode-submenu"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>');const r=t.getToolbar().container.querySelector("#toolbar-explodeTool").parentNode;N()?n.classList.add("ios"):k()&&n.classList.add("android"),r.appendChild(n),i.addEventListener(Autodesk.Viewing.UI.Control.Event.VISIBILITY_CHANGED,(function(e){e.isVisible?n.classList.add("visible"):n.classList.remove("visible")}));const o=n.querySelector(".explode-slider");o.addEventListener("input",(function(){e.setScale(o.value)})),n.onclick=function(e){e.stopPropagation()};var s=i.container.querySelector(".adsk-control-tooltip");i.onClick=function(){e.isActive()?e.deactivate():(e.activate(),rt.track({category:"tool_changed",name:"explode"}))},this._slider=o,this._explodeButton=i,this._explodeSubmenu=n,this._tooltip=s,t.explodeSlider=o,t.explodeSubmenu=n,this._onExplode=this._onExplode.bind(this)}activate(){this._explodeSubmenu.classList.add("visible"),this._explodeButton.setState(xT.State.ACTIVE),this._tooltip.style.display="none";let e=this.ext.getScale();this._slider.value=e,this.ext.viewer.addEventListener(Ar,this._onExplode)}deactivate(){this._explodeButton.setState(xT.State.INACTIVE),this._hideSlider(this),this.ext.viewer.removeEventListener(Ar,this._onExplode)}destroy(){const e=this.ext.viewer;this._slider&&(this._explodeButton&&this._explodeButton.removeFromParent(),this._slider=null,this._explodeButton=null,this._explodeSubmenu=null,this._tooltip=null,e.explodeSlider=null,e.explodeSubmenu=null)}setUIEnabled(e){this._explodeButton&&(e?(this._explodeButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),this._wasActive&&this.ext.activate()):(this._wasActive=this.ext.isActive(),this._hideSlider(this),this._explodeButton.setState(Autodesk.Viewing.UI.Button.State.DISABLED)))}_hideSlider(){this._explodeSubmenu.classList.remove("visible"),this._tooltip.style.display=""}_onExplode(e){this._slider.value=e.scale}}var EI=Autodesk.Viewing.Private;function SI(e,t){Na.call(this,e,t),this.viewer=e,this.options=t,this.name="fullscreen"}SI.prototype=Object.create(Na.prototype),SI.prototype.constructor=SI;var AI=SI.prototype;function wI(e,t){Na.call(this,e,t),this.viewer=e,this.options=t,this.name="gohome"}AI.activate=function(){return this.activeStatus||(this.viewer.nextScreenMode(),this.activeStatus=!0),!0},AI.deactivate=function(){return this.activeStatus&&(this.viewer.escapeScreenMode(),this.activeStatus=!1),!0},wI.prototype=Object.create(Na.prototype),wI.prototype.constructor=wI;var CI=wI.prototype;CI.activate=function(){return this.viewer.navigation.setRequestHomeView(!0),!0},CI.deactivate=function(){return!1};const TI=Autodesk.Viewing,MI=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n");function II(){var e,t,i,n,r,o=["fusion orbit","fusion orbit constrained"],s=0,a=1,l=2,c=.005,u=.005,h=1,d={},f=O(),p=!1,m={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},g=this;this.setViewer=function(e){this.viewer=e,this.navapi=e?e.navigation:null,e&&this.setGlobalManager(e.globalManager)};var v=function(e){m.buttons[e.touches?0:e.button]=!0,m.src=e.target.className,m.x=0,m.y=0,m.dx=0,m.dy=0,m.firstMove=!0,m.mode=void 0,"ring"===m.src?m.mode=l:"edgemark-area"===m.src&&("layout-ver"===e.target.parentNode.className?m.mode=s:"layout-hor"===e.target.parentNode.className&&(m.mode=a)),S(),e.stopPropagation()},y=function(e){m.buttons[e.touches?0:e.button]=!1,m.src=void 0},b=function(e){m.buttons[0]&&(x(e),_(),m.firstMove=!1)},x=function(e){var t=e.touches?e.touches[0].pageX:e.pageX,i=e.touches?e.touches[0].pageY:e.pageY;m.firstMove||(m.dx=t-m.x,m.dy=i-m.y),m.x=t,m.y=i},_=function(){switch(m.mode){case l:if(!g.navapi.isActionEnabled("roll"))return;break;case s:case a:if(!g.navapi.isActionEnabled("orbit"))return}var e=r.target.clone().sub(r.position).normalize(),t=e.clone().cross(r.up).normalize(),i=t.clone().cross(e).normalize();if(r.up.copy(i),m.mode===l){var o=new THREE.Vector3(m.x-d.center.x,m.y-d.center.y,0),f=new THREE.Vector3(m.dx,m.dy,0).add(o);o.normalize(),f.normalize();var p=o.clone().cross(f),v=Math.asin(p.z);r.up.applyAxisAngle(e,-v*h)}else{var y,b;m.mode===s?(b=-m.dx*c,n&&(r.up=zy.snapToAxis(r.up.clone())),y=r.up):m.mode===a&&(b=-m.dy*u,n?(m.firstMove&&(r.up=zy.snapToAxis(r.up.clone())),y=e.clone().cross(r.up).normalize()):y=t,r.up.applyAxisAngle(y,b));var x=g.navapi.getPivotPoint(),_=r.position.clone().sub(x);_.applyAxisAngle(y,b),r.position.addVectors(x,_);var E=r.target.clone().sub(x);E.applyAxisAngle(y,b),r.target.addVectors(x,E)}r.dirty=!0},E=function(e,t){var i=t||e.clone().sub(r.position).normalize();return new THREE.Plane(i,-i.x*e.x-i.y*e.y-i.z*e.z)},S=function(){var e=r.target.clone().sub(r.position).normalize(),t=E(r.position,e).distanceToPoint(r.pivot);r.pivot.copy(e).multiplyScalar(t).add(r.position)},A=function(e){e.touches||0!==e.button||S()},w=function(){p&&g.viewer.setActiveNavigationTool()},C=function(e,t){var i,n=g.viewer.impl.hitTest(e,t);if(n&&n.intersectPoint)i=n.intersectPoint;else{var o=g.viewer.impl.viewportToRay(g.viewer.impl.clientToViewport(e,t));i=new THREE.Vector3,o.intersectPlane(E(r.target),i)}var s=r.position.clone().sub(function(){var e=r.target.clone().sub(r.position).normalize(),t=g.viewer.impl.rayIntersect(new THREE.Ray(r.position,e));return t&&t.intersectPoint?t.intersectPoint:r.target}()).add(i);g.navapi.setRequestTransition(!0,s,i,r.fov)};this.register=function(){(e=me(MI)).style.display="none",this.viewer.canvasWrap.insertBefore(e,this.viewer.canvasWrap.firstChild),(t=e.querySelector(".ring")).addEventListener("mousedown",v),Array.prototype.forEach.call(e.querySelectorAll(".edgemark-area"),(function(e){e.addEventListener("mousedown",v),f&&e.addEventListener("touchstart",v)})),this.addWindowEventListener("mouseup",y),this.addWindowEventListener("mousemove",b),(i=e.querySelector(".outside")).addEventListener("mousedown",w);var n=e.querySelector(".circle");n.addEventListener("mousedown",A),f&&(t.addEventListener("touchstart",v),this.addWindowEventListener("touchend",y),this.addWindowEventListener("touchmove",b),i.addEventListener("touchstart",w),n.addEventListener("touchstart",A)),r=this.viewer.impl.camera},this.deregister=function(){this.removeWindowEventListener("mouseup",y),this.removeWindowEventListener("mousemove",b),i.removeEventListener("mousedown",w),f&&(this.removeWindowEventListener("touchend",y),this.removeWindowEventListener("touchmove",b),i.removeEventListener("touchstart",w)),this.viewer.canvasWrap.removeChild(e),e=void 0,t=void 0,i=void 0},this.activate=function(t){e.style.display="",this.handleResize(),n="fusion orbit constrained"===t;var i=this.viewer.toolController.isToolActivated("hyperlink");i&&this.viewer.toolController.deactivateTool("hyperlink"),n?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),i&&this.viewer.toolController.activateTool("hyperlink"),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(){e.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.get("zoomTowardsPivot"))},this.getNames=function(){return o},this.getName=function(){return o[0]},this.update=function(){return!1},this.handleSingleClick=function(e){return C(e.canvasX,e.canvasY),!0},this.handleDoubleClick=function(){return!0},this.handleSingleTap=function(e){return C(e.canvasX,e.canvasY),!0},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(){return!1},this.handleButtonUp=function(){return!1},this.handleMouseMove=function(e){var t=this.viewer.impl.getCanvasBoundingClientRect(),n=(t.width>t.height?new THREE.Vector2(((e.canvasX+.5)/t.width*2-1)*t.width/t.height,-(e.canvasY+.5)/t.height*2+1):new THREE.Vector2((e.canvasX+.5)/t.width*2-1,(-(e.canvasY+.5)/t.height*2+1)*t.height/t.width)).length()>1.2;return p!==n&&(i.style.cursor=n?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",p=n),!1},this.handleGesture=function(){return S(),!1},this.handleBlur=function(){return!1},this.handleResize=function(){var i=e.getBoundingClientRect();const n=this.getWindow();d.left=i.left+n.pageXOffset,d.top=i.top+n.pageYOffset,d.width=i.width,d.height=i.height,d.center={},d.center.x=d.left+d.width/2,d.center.y=d.top+d.height/2;var r=.8*(n.innerWidth>n.innerHeight?n.innerHeight:n.innerWidth);e.style.width=e.style.height=r+"px",e.style.top=e.style.left="calc(50% - "+r/2+"px)",t.style.borderWidth=.1*r+"px"}}TI.GlobalManagerMixin.call(II.prototype);const PI="fusionfreeorbit",LI="fusionorbit";function RI(e,t){Na.call(this,e,t),this.name=LI,this.modes=[LI,PI]}RI.prototype=Object.create(Na.prototype),RI.prototype.constructor=RI;var DI=RI.prototype;function OI(e){Autodesk.Viewing.Private.RenderContext.call(this),this.originalInit=this.init.bind(this),this.init=function(t,i,n){var r;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.canvas=e,this.ctx2D=this.canvas.getContext("2d");const s=!0!==(null===(r=o.webglInitParams)||void 0===r?void 0:r.alpha),a=Object.assign({},o,{offscreen:!0,removeAlphaInOutput:s});this.originalInit(t,i,n,a),this.glrenderer=t;const l=this.glrenderer.getPixelRatio();this.setSize(i/l,n/l)},this.renderToCanvas=function(){this.ctx2D&&(this.getOffscreenTarget()||0!=this.widthWithPixelRatio&&0!=this.heightWithPixelRatio&&(this.ctx2D.clearRect(0,0,this.widthWithPixelRatio,this.heightWithPixelRatio),this.ctx2D.drawImage(this.glrenderer.domElement,0,this.glrenderer.domElement.height-this.heightWithPixelRatio,this.widthWithPixelRatio,this.heightWithPixelRatio,0,0,this.widthWithPixelRatio,this.heightWithPixelRatio)))},this.originalSetSize=this.setSize.bind(this),this.setSize=function(e,t,i,n){if(!n){const i=this.glrenderer.getPixelRatio();this.width=e,this.height=t,this.widthWithPixelRatio=e*i,this.heightWithPixelRatio=t*i,this.canvas.width=this.widthWithPixelRatio,this.canvas.height=this.heightWithPixelRatio,this.canvas.style.width=`${this.width}px`,this.canvas.style.height=`${this.height}px`}this.prepareViewport(i,n),this.restoreViewport()},this.prepareViewport=function(e,t){this.glrenderer.pushViewport();const i=this.glrenderer.getPixelRatio(),n=this.glrenderer.domElement.width/i,r=this.glrenderer.domElement.height/i;(n<this.width||r<this.height)&&this.glrenderer.setSize(Math.max(this.width,n),Math.max(this.height,r)),this.originalSetSize(this.width,this.height,e,t)},this.restoreViewport=function(){this.glrenderer.popViewport()}}DI.load=function(){var e=this.viewer;return this.tool=new II,this.tool.setViewer(e),e.toolController.registerTool(this.tool),this._onToolChanged=this._onToolChanged.bind(this),!0},DI._updateActiveState=function(e,t){this.activeStatus=e,this.mode=t},DI._onToolChanged=function(e){if("fusion orbit constrained"===e.toolName||"fusion orbit"===e.toolName){const t=this._toolbar.getControl(vT.NAVTOOLSID),i="fusion orbit"===e.toolName?t.freeorbitbutton:t.orbitbutton,n=e.active?xT.State.ACTIVE:xT.State.INACTIVE;i.setState(n),this._updateActiveState(!n)}},DI.onToolbarCreated=async function(e){var t=this,i=this.viewer,n=e.getControl(vT.NAVTOOLSID);n&&n.orbitbutton||await i.loadExtension("Autodesk.DefaultTools.NavTools",i.config),this._toolbar=e,this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this._onToolChanged),this.classicBehavior={},this.classicBehavior.orbitOnClick=n.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=n.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=n.returnToDefault,n.freeorbitbutton.onClick=function(){var e=n.freeorbitbutton.getState();e===xT.State.INACTIVE?t.activate(PI):e===xT.State.ACTIVE&&t.deactivate()},n.orbitbutton.onClick=function(){var e=n.orbitbutton.getState();e===xT.State.INACTIVE?t.activate(LI):e===xT.State.ACTIVE&&t.deactivate()},n.returnToDefault=function(){n.orbittoolsbutton&&n.orbittoolsbutton.setState(xT.State.ACTIVE)},n.orbittoolsbutton.setState(xT.State.INACTIVE),i.prefs.get("fusionOrbitConstrained")?(n.orbittoolsbutton.onClick=n.orbitbutton.onClick,n.orbittoolsbutton.setIcon(n.orbitbutton.iconClass),i.setDefaultNavigationTool("orbit")):(n.orbittoolsbutton.onClick=n.freeorbitbutton.onClick,n.orbittoolsbutton.setIcon(n.freeorbitbutton.iconClass),i.setDefaultNavigationTool("freeorbit")),i.setActiveNavigationTool(),n.returnToDefault&&n.returnToDefault()},DI.unload=function(){var e=this.viewer;if(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this._onToolChanged),this.classicBehavior){var t=e.getToolbar().getControl(vT.NAVTOOLSID);t&&(t.orbitbutton&&(t.orbitbutton.onClick=this.classicBehavior.orbitOnClick),t.freeorbitbutton&&(t.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),t.returnToDefault=this.classicBehavior.returnToDefault,t.orbittoolsbutton&&(t.orbitbutton?t.orbittoolsbutton.onClick=t.orbitbutton.onClick:t.orbittoolsbutton.onClick=null,t.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),t.orbittoolsbutton.setState(xT.State.ACTIVE))),this.classicBehavior=null}return e.setActiveNavigationTool("orbit"),e.setDefaultNavigationTool("orbit"),e.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,this._toolbar=null,!0},DI.activate=function(e){if(!this.isActive(e)){switch(e){default:case LI:this.viewer.setActiveNavigationTool("fusion orbit constrained"),this.mode=LI;break;case PI:this.viewer.setActiveNavigationTool("fusion orbit"),this.mode=PI}return this.activeStatus=!0,!0}},DI.deactivate=function(){return this.activeStatus&&(this.viewer.setActiveNavigationTool(),this.activeStatus=!1),!0},za.registerExtension("Autodesk.PropertiesManager",pM),za.registerExtension("Autodesk.ViewerSettings",vM),za.registerExtension("Autodesk.ModelStructure",lI),za.registerExtension("Autodesk.DefaultTools.NavTools",gI),za.registerExtension("Autodesk.Explode",class extends Na{constructor(e,t){super(e,t),this.viewer=e,this.options=t,this.name="explode",this.tool=null,this.explodeUI=null}load(){return this.tool=new xI(this.viewer),this.viewer.toolController.registerTool(this.tool,this.setActive.bind(this)),!0}unload(){return this.deactivate(),this.explodeUI&&(this.explodeUI.destroy(),this.explodeUI=null),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0}onToolbarCreated(e){this.explodeUI=new _I(this,e)}activate(){return!!this.isActive()||!!this.explodeUI&&(this.explodeUI.activate(),this.viewer.toolController.activateTool("explode"),!0)}deactivate(){return!this.isActive()||(!this.explodeUI||(this.explodeUI.deactivate(),this.viewer.toolController.deactivateTool("explode"),!0))}isActive(){return this.tool.isActive()}getScale(){return this.tool.getScale()}setScale(e){return this.tool.setScale(e)}getMagnitude(){return this.tool.getMagnitude()}setMagnitude(e){return this.tool.setMagnitude(e)}getDepthDampening(){return this.tool.getDepthDampening()}setDepthDampening(e){return this.tool.setDepthDampening(e)}setStrategy(e){e!==this.getStrategy()&&this.viewer.prefs.set(EI.Prefs3D.EXPLODE_STRATEGY,e)}getStrategy(){return this.viewer.prefs.get(EI.Prefs3D.EXPLODE_STRATEGY)}setUIEnabled(e){this.explodeUI.setUIEnabled(e),e||this.tool.deactivate(!1)}}),za.registerExtension("Autodesk.FullScreen",SI),za.registerExtension("Autodesk.GoHome",wI),za.registerExtension("Autodesk.Viewing.FusionOrbit",RI),OI.prototype=Object.create(lx.prototype),OI.prototype.constructor=OI;const BI=new Map;function NI(e,t,i,n){if(BI.has(n)){return new(BI.get(n))(e,t,i)}function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.sharedResources=i,this.resizeObserver=null,n.call(this,e,t),Autodesk.Viewing.Private.IsUsingWebGPU()||(this.renderContext=new OI(this.canvas),this.sharedResources.mrtFlags?this.renderContext.mrtFlags=this.sharedResources.mrtFlags:this.sharedResources.mrtFlags=this.renderContext.mrtFlags)}r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.initialize=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={glrenderer:this.sharedResources.glrenderer,materialManager:this.sharedResources.materialManager,renderer:this.renderContext},i=Object.assign({},e,t),r=n.prototype.initialize.call(this,i);return this.overrideAPIs(),this.sharedResources.geomCache&&this.sharedResources.geomCache.initialized&&this.impl.setGeomCache(this.sharedResources.geomCache),this.resizeObserver=new ResizeObserver((e=>{const t=e[0].contentRect,i=Math.floor(t.width),n=Math.floor(t.height);i&&n&&(this.impl.resize(i,n,!0),this.dispatchEvent({type:Autodesk.Viewing.VIEWER_RESIZE_EVENT,width:i,height:n}),this.impl.tick(performance.now()))})),this.resizeObserver.observe(this.container),r},r.prototype.uninitialize=function(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.originalLoadDocumentNode=null,this.loadDocumentNode=n.prototype.loadDocumentNode,n.prototype.uninitialize.call(this)},r.prototype.overrideAPIs=function(){var e=this;if(!this.impl.isWebGPU()){const e=this.impl.tick.bind(this.impl);this.impl.tick=()=>{if(!this.impl||!this.impl.glrenderer())return;this.impl.renderer().prepareViewport(),this.restoreViewerState();const t=performance.now();e(t),this.impl.renderer().restoreViewport()},this.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,(()=>{this.renderContext.renderToCanvas()}),{priority:-1e3})}const t=this.impl.setLightPreset.bind(this.impl);this.impl.setLightPreset=(e,i,n)=>{if(this.impl.is2d){this.impl.initLights();const t=Autodesk.Viewing.Private.LightPresets[e].bgColorGradient;this.setBackgroundColor(...t),this.impl.setCurrentLightPreset(e);const i=_u(this.impl.clearColorTop,this.impl.clearColorBottom);this.impl.renderer().setCubeMap(i);const n=Autodesk.Viewing.Private.LightPresets[e].tonemap;this.impl.renderer().setTonemapMethod(n||0)}else t(e,i,n)};const i=this.toolController.__invokeStack.bind(this.toolController);this.toolController.__invokeStack=function(){return e.restoreViewerState(),i(...arguments)};const n=this.impl.unloadModel.bind(this.impl);this.impl.unloadModel=(e,t)=>{const i=e.leechViewerKey;let r=!1;const o=this.sharedResources.loadedModels[i];return o&&(o.usedByViewersCounter--,r=t||o.forceKeepResources||o.usedByViewersCounter>0,r||delete this.sharedResources.loadedModels[i]),n(e,t=t||r)},this.originalLoadDocumentNode=this.loadDocumentNode.bind(this),this.loadDocumentNode=function(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((r,o)=>{const s=function(e,t){let i=e.getModelKey();return i+=".ref:"+!!t.applyRefPoint,i+=".g:"+(t.globalOffset?[t.globalOffset.x,t.globalOffset.y,t.globalOffset.z]:[0,0,0]).toString(),t.placementTransform&&(i+=".p:"+t.placementTransform.toArray().toString()),t.customHash&&(i+=".h:"+t.customHash),i}(i,n),a=e.sharedResources.loadedModels[s];if(a){const t=e.onModelLoaded(a.model,n);r(t)}else e.originalLoadDocumentNode(t,i,n).then((t=>{t.leechViewerKey=s,e.sharedResources.loadedModels[s]={model:t,usedByViewersCounter:1,loadingViewer:e},r(t)})).catch(o)}))};const r=this.impl.geomCache.bind(this.impl);this.impl.geomCache=()=>(this.sharedResources.geomCache&&this.sharedResources.geomCache.initialized||(this.sharedResources.geomCache=r()),this.sharedResources.geomCache)},r.prototype.setViewerProfile=function(e,t){if(t.loadAsHidden)return;t.isAEC=e.isAEC();const i=this.chooseProfile(t);delete i.settings.lineRendering,delete i.settings.pointRendering,this.setProfile(i)},r.prototype.setViewerLight=function(e,t){if(!t.loadAsHidden)if(this.impl.is2d){this.impl.setLightPreset(go);const e=this.impl.clearColorTop.clone().multiplyScalar(255),i=this.impl.clearColorBottom.clone().multiplyScalar(255);t.isAEC?this.impl.setLightPresetForAec():this.impl.setLightPreset(mo),this.impl.toggleEnvMapBackground(!1),this.setBackgroundColor(e.x,e.y,e.z,i.x,i.y,i.z)}else this.impl.toggleEnvMapBackground(this.profile.settings.envMapBackground)},r.prototype.cleanViewerBeforeLoadModel=function(e){if(!e.keepCurrentModels&&this.impl.hasModels()){let e=this.config;this.tearDown(),this.setUp(e)}!this.impl.hasModels()&&this._loadingSpinner&&this._loadingSpinner.show()};const o=new THREE.Vector4(0,0,-1,-1e20);function s(e){const t=!e,i=e&&!e.isLoadDone(),n=e&&e.getPropertyDb()&&!e.getPropertyDb().isLoadDone();return!(t||i||n)}return r.prototype.syncCutPlanes=function(){const e=this.impl.getAllCutPlanes()||[o],t=this.impl.matman(),i=Math.max(e.length,t._cutplanes.length);t._cutplanes.length=0;let n=0;for(;n<e.length;n++)t._cutplanes.push(e[n].clone());for(;n<i;n++)t._cutplanes.push(o);t.forEach((e=>{e.doNotCut||(e.cutplanes=t._cutplanes)}),!1,!0)},r.prototype.restoreViewerState=function(){this.sharedResources.lastRenderedViewer!==this&&(this.syncCutPlanes(),this.impl.is2d&&this.impl.updateCameraMatrices(),this.sharedResources.lastRenderedViewer=this)},r.prototype.onModelLoaded=function(e,t){const i=e.leechViewerKey;this.sharedResources.loadedModels[i].forceKeepResources=!0,this.cleanViewerBeforeLoadModel(t);const n=this.cloneModelToViewer(e);return this.addModelToViewer(n,t),delete this.sharedResources.loadedModels[i].forceKeepResources,n},r.prototype.addModelToViewer=function(e,t){this.impl.modelQueue().addHiddenModel(e),t.loadAsHidden||(this.setViewerProfile(e,t),this.showModel(e),this.setViewerLight(e,t),!t.headlessViewer&&this.createUI&&this.createUI(e)),this._loadingSpinner&&this._loadingSpinner.hide()},r.prototype.cloneModelToViewer=function(e){const t=e.clone(),i=e.leechViewerKey;t.leechViewerKey=i;const n=this.sharedResources.loadedModels[i];n.usedByViewersCounter++;const r=n.loadingViewer,o=()=>this.impl.invalidate(!1,!0,!1);r.addEventListener(Autodesk.Viewing.LOADER_REPAINT_REQUEST_EVENT,o,{priority:-1e3}),function(e,t){return new Promise((i=>{s(t)&&i();const n=()=>{s(t)&&(e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,n),e.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,n),i())};e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,n),e.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,n)}))}(r,t).then((()=>{setTimeout((()=>{t.setInnerAttributes(e.getInnerAttributes()),this.impl.onLoadComplete(t)}),1),r.removeEventListener(Autodesk.Viewing.LOADER_REPAINT_REQUEST_EVENT,o)}));const a=i=>{i.model===e&&t.setInnerAttributes(e.getInnerAttributes()),this.impl.invalidate(!1,!0)};return r.addEventListener(Autodesk.Viewing.MODEL_TRAVERSAL_CONTROLLER_ADDED,a),r.addEventListener(cm,a),r.addEventListener(um,a),t},BI.set(n,r),new r(e,t,i,n)}class UI{constructor(){if(this.sharedResources={loadedModels:{}},!Autodesk.Viewing.Private.IsUsingWebGPU()){const e=Autodesk.Viewing.Private.createRenderer(void 0,{alpha:!0}),t=new wf(e);this.sharedResources={...this.sharedResources,glrenderer:e,materialManager:t}}}createViewer(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Autodesk.Viewing.Viewer3D;return NI(e,t,this.sharedResources,i)}destroy(){this.sharedResources=null}}const kI={eventName:pr,cb:(e,t,i)=>{const n=e.getAggregateSelection();if(t.impl.model)if(n.length>0)for(let e=0;e<n.length;e++){const i=n[e],r=i.model,o=i.selection;for(let e=0;e<t.impl.modelQueue().getModels().length;e++){const i=t.impl.modelQueue().getModels()[e];i&&i.getDocumentNode()&&r.getDocumentNode()&&i.getDocumentNode().originModel===r.getDocumentNode().originModel?(t.impl.is2d?t.select(o,i):(t.showAll(),t.select(o,i),t.isolate(o,i)),t.fitToView(o)):!t.impl.is2d&&i.visibilityManager&&i.visibilityManager.setAllVisibility(!1)}}else t.clearSelection(),t.impl.is2d||t.showAll()}},FI={onSelectionChanged:kI};class VI{constructor(e){this.viewer=e}search(e){return new Promise(((e,t)=>{}))}getProviderId(){return"Search Provider Id"}}class GI{constructor(e){this.viewer=e,this.searchProviders=new Map}addSearchProvider(e){this.searchProviders.has(e)||this.searchProviders.set(e,new e(this.viewer))}search(e){return new Promise(((t,i)=>{const n=this.prepareSearchInput(e),r=[];this.searchProviders.forEach((e=>{const t=e.search(n),i=e.getProviderId();t.id=i,r.push(t)})),Promise.all(r).then((e=>{const i={};e.forEach(((e,t)=>{const n=r[t].id;i[n]=e})),t(i)})).catch(i)}))}removeAllProviders(){this.searchProviders.clear()}removeProvider(e){this.searchProviders.delete(e)}prepareSearchInput(e){return e.toLowerCase()}}const zI={SearchManager:GI,ModelPartsSearchProvider:class extends VI{constructor(e){super(e)}search(e){return new Promise(((t,i)=>{const n=this.viewer.getVisibleModels(),r=[];0===n.length&&t(r);for(let t=0;t<n.length;t++){const i=n[t],o=[],s=i.getInstanceTree();i.getObjectTree((t=>{t.enumNodeChildren(t.getRootId(),(t=>{const i=s&&s.getNodeName(t);i&&-1!==i.toLowerCase().indexOf(e)&&o.push(t)}),!0)})),r.push({ids:o,model:i})}t(r)}))}getProviderId(){return"ModelPartsSearchProvider"}},PropertiesSearchProvider:class extends VI{constructor(e){super(e)}search(e){return new Promise(((t,i)=>{const n=this.viewer.getVisibleModels(),r=[];0===n.length&&t(r);for(let o=0;o<n.length;o++){const s=n[o];s.search(e,(e=>{r.push({ids:e,model:s}),r.length===n.length&&t(r)}),i)}}))}getProviderId(){return"PropertiesSearchProvider"}},TextSearchProvider:class extends VI{constructor(e){super(e),e.loadExtension("Autodesk.StringExtractor")}search(e){return new Promise((t=>{this.viewer.getExtensionAsync("Autodesk.StringExtractor").then((i=>i.getDocumentStrings().then((i=>{const n=[],r=this.viewer.impl.get2DModels();for(let t=0;t<r.length;t++){const o=r[t].id,s=!r[t].isLeaflet(),a=i[o];if(!a)continue;const l=a.strings,c=this.searchStrings(l,e,o,s);n.push({modelId:o,searchResult:c})}t(n)}))))}))}searchStrings(e,t,i,n){let r=[];if(n)for(let n=0;n<e.length;n++){let o=0;const s=[];for(;-1!==o;)o=e[n].string.toLowerCase().indexOf(t,o),-1!==o&&(s.push(o),o+=1);if(s.length>0){const o=this.splitOccurrences(e[n],s,t,i);r=r.concat(o)}}else for(let i=0;i<e.length;i++)-1!==e[i].string.toLowerCase().indexOf(t)&&r.push(e[i]);return r}splitOccurrences(e,t,i,n){const r=this.viewer.impl.findModel(n),o=[];let s=1/72;const a=r.getData();function l(t,i){const n=e.stringCharWidths.slice(t,i);if(!n.length)return 0;return n.reduce(((e,t)=>e+t))}if(r){const n=a.metadata.page_dimensions.page_units;s*=Autodesk.Viewing.Private.convertUnits(Autodesk.Viewing.Private.ModelUnits.INCH,n,1,1);const c=a.scaleX,u=(r.getData().scaleY||s)*e.stringHeight;for(let n=0;n<t.length;n++){const r={string:i};let a=l(0,t[n]),h=l(t[n],t[n]+i.length);if(e.stringWidth){const t=l(0,e.string.length),i=e.stringWidth/t*s;a*=i,h*=i}else a*=c,h*=c;const d=e.angle||0,f=Math.cos(d)*a,p=Math.sin(d)*a;let m=e.stringPosition[0]+f,g=e.stringPosition[1]+p,v=m+h,y=g+u;const b=new THREE.Vector2(m,g),x=new THREE.Vector2(v,y),_=new THREE.Box2(b,x);r.boundingBox=_,r.angle=e.angle,o.push(r)}}return o}getProviderId(){return"TextSearchProvider"}}};var HI=r(77431),WI=r.n(HI),jI=r(73560),qI=r.n(jI);let KI={uniforms:v().UniformsUtils.merge([v().UniformsLib.common,v().UniformsLib.bump,v().UniformsLib.normalmap,v().UniformsLib.lights,v().UniformsLib.fog,Zd.CutPlanesUniforms,Zd.IdUniforms,Zd.ThemingUniform,Zd.ShadowMapUniforms,Zd.WideLinesUniforms,{emissive:{type:"c",value:new(v().Color)(0)},specular:{type:"c",value:new(v().Color)(1118481)},shininess:{type:"f",value:30},reflMipIndex:{type:"f",value:0},texMatrix:{type:"m3",value:new(v().Matrix3)},texMatrixBump:{type:"m3",value:new(v().Matrix3)},texMatrixAlpha:{type:"m3",value:new(v().Matrix3)},irradianceMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1}}]),vertexShader:WI(),fragmentShader:qI()};v().ShaderLib.firefly_phong=KI;var XI=r(21175),YI=r.n(XI),QI=r(27608),ZI=r.n(QI);let $I={uniforms:v().UniformsUtils.merge([v().UniformsLib.common,v().UniformsLib.fog,v().UniformsLib.shadowmap,Zd.CutPlanesUniforms,Zd.IdUniforms,Zd.ThemingUniform,Zd.PointSizeUniforms,Zd.WideLinesUniforms,Zd.DepthTextureTestUniforms]),vertexShader:YI(),fragmentShader:ZI()};v().ShaderLib.firefly_basic=$I;var JI=r(91342),eP=r.n(JI);let tP={uniforms:v().UniformsUtils.merge([Zd.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tID:{type:"t",value:null},resolution:{type:"v2",value:new(v().Vector2)(1/1024,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},tFill:{type:"t",value:null},tPaper:{type:"t",value:null},style:{type:"i",value:0},idEdges:{type:"i",value:1},normalEdges:{type:"i",value:1},depthEdges:{type:"i",value:1},brightness:{type:"f",value:0},contrast:{type:"f",value:0},grayscale:{type:"i",value:0},preserveColor:{type:"i",value:0},levels:{type:"f",value:6},repeats:{type:"f",value:3},rotation:{type:"f",value:0},outlineRadius:{type:"f",value:1},outlineNoise:{type:"i",value:0},tGraphite1:{type:"t",value:null},tGraphite2:{type:"t",value:null},tGraphite3:{type:"t",value:null},tGraphite4:{type:"t",value:null},tGraphite5:{type:"t",value:null},tGraphite6:{type:"t",value:null},tGraphite7:{type:"t",value:null},tGraphite8:{type:"t",value:null}}]),vertexShader:cb(),fragmentShader:eP()};const iP=Tm`
    @fragment
    fn main(
        @builtin(position) coord : vec4f,
        @location(0) @interpolate(linear) vUv: vec2f
    ) -> @location(0) vec4f {
        var outColor = vec4f(vUv, 0.0, 1.0);
        return outColor;
    }
`,nP=Tm`
    @group(0) @binding(1) var texture: texture_2d<f32>;
    @group(0) @binding(2) var texSampler: sampler;

    @fragment
    fn main(
      @builtin(position) coord: vec4f,
      @location(0) @interpolate(linear) vUv: vec2f
    ) -> @location(0) vec4f {
        var outColor = textureSample(texture, texSampler, vUv);
        return outColor;
    }
`,rP=Tm`
    ${t_}

    @group(0) @binding(1) var texture: texture_2d<f32>;
    @group(0) @binding(2) var texSampler: sampler;

    @fragment
    fn main(
        @builtin(position) coord: vec4f,
        @location(0) @interpolate(linear) vUv: vec2f
    ) -> @location(0) vec4f {

        var packedDepth = textureSample(texture, texSampler, vUv);
        var depth       = unpackDepth10(packedDepth.rgb);
        return vec4f(depth, 0, 0, 1);
    }
`,oP=Tm`
    // Note that pack_normals chunk is only needed for int-packed vertex-normals.
    // The rgb10-packed normals need unpackNormals10 instead.
    ${t_}

    @group(0) @binding(1) var texture: texture_2d<f32>;
    @group(0) @binding(2) var texSampler: sampler;

    @fragment
    fn main(
        @builtin(position) coord: vec4f,
        @location(0) @interpolate(linear) vUv: vec2f
    ) -> @location(0) vec4f {

        var packedNormal = textureSample(texture, texSampler, vUv);
        var normal       = unpackNormal10(packedNormal.xyz);
          return vec4f(normal, 1.0f);
    }
`;class sP{#Dt;#ys;#qa;#Ka;#Xa;#Ya;#Qa;#Za;#Ir=[];#$a;#Ja;#el;#tl;#il=0;#nl=0;#rl=0;#Vi;constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.#Dt=e,this.#Vi=t,this.setFragmentShader(),this.setVertexShader();const n=new oE;this.setUniforms(n,i)}setFragmentShader(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:iP,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main";this.#$a=e,this.#Ja=t,this.#Xa=null,this.#ys=null}setVertexShader(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ex,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mainFlipY";this.#el=e,this.#tl=t,this.#Ka=null,this.#ys=null}setSourceTextureUniform(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.#il=e,this.#nl=t,this.#rl=i;const n=this.getUniforms(i);n.isAssigned(e)||n.addTexture(e),n.isAssigned(t)||n.addSampler(t)}setUniforms(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.#Ir[t]=e}getUniforms(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.#Ir[e]}get uniforms(){return this.getUniforms()}createPipeline(){let e="auto";if(this.#Ir.length>0){const t=[];for(let e=0;e<this.#Ir.length;e++){const i=this.#Ir[e];t[e]=i.layout}e=this.#Dt.createPipelineLayout({bindGroupLayouts:t})}this.#ys=this.#Dt.createRenderPipeline({layout:e,vertex:{module:this.#Ka,entryPoint:this.#tl},fragment:{module:this.#Xa,entryPoint:this.#Ja,targets:[{format:this.#Ya}]},primitive:{topology:"triangle-list",cullMode:"back"}})}init(e){if((e=e||this.#Za)&&(!this.#ys||this.#Za!==e)){for(let e in this.#Ir)this.#Ir[e].update(this.#Dt);this.#Qa=e.createView(),this.#Za=e,this.#Ka||(this.#Ka=this.#Dt.createShaderModule({code:this.#el})),this.#Xa||(this.#Xa=this.#Dt.createShaderModule({code:this.#$a})),this.#ys&&this.#Ya===e.format||(this.#Ya=e.format,this.createPipeline()),this.#qa||(this.#qa={colorAttachments:[{view:void 0,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]})}}run(e,t){if(!this.#Dt)return;if(t){this.getUniforms(this.#rl).setTexture(t,this.#il)}this.init(e);let i=this.#Dt.createCommandEncoder();this.#qa.colorAttachments[0].view=this.#Qa;let n=i.beginRenderPass(this.#qa);this.#Ir.forEach(((e,t)=>{n.setBindGroup(t,e.bindGroup)})),n.setPipeline(this.#ys),n.draw(3),n.end(),this.#Dt.queue.submit([i.finish()])}}function aP(e,t,i,n){let r=new sP(e);r.setSourceTextureUniform(),r.setFragmentShader(n),r.run(i,t)}function lP(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC;const n=e.createTexture({size:[t.width,t.height],format:t.format,usage:i});return aP(e,t,n,nP),n}const cP="rgba8unorm",uP="bgra8unorm",hP="rgba8uint",dP="rgb10a2unorm",fP="depth32float",pP="depth24plus",mP="r32float",gP="rgba32float",vP={unknown:"unknown",uint8:"uint8",float32:"float32"};function yP(e){switch(e){case cP:case uP:case hP:case dP:return vP.uint8;case fP:case mP:case gP:return vP.float32}return console.error("Unsupported format: "+e),vP.unknown}function bP(e){switch(e){case cP:case uP:case hP:case dP:return 4;case fP:case pP:case mP:return 1;case gP:return 4;default:return console.error("Unsupported format: "+e),0}}function xP(e){switch(e){case vP.uint8:return Uint8Array;case vP.float32:return Float32Array;default:return null}}async function _P(e){const t=await async function(e){return new Promise((t=>{e.toBlob(t)}))}(e);return URL.createObjectURL(t)}const EP=(e,t)=>{t.r=.5*(e.r+1)*255,t.g=.5*(e.g+1)*255,t.b=.5*(e.b+1)*255,t.a=255};const SP=(e,t)=>{const i=e.r|e.g<<8|e.b<<16|e.a<<24,n=i?(1103515245*i+12345)%2**31:0;t.r=255&n,t.g=n>>8&255,t.b=n>>16&255,t.a=255},AP=(e,t)=>{const i=255*e.r;t.r=i,t.g=i,t.b=i,t.a=255};class wP{width=0;height=0;data=null;format=null;constructor(){}init(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.width=e,this.height=t,this.format=i,n)this.data=r?n.slice():n;else{const n=bP(i),r=yP(i),o=e*t*n;this.data=function(e,t){return new(xP(e))(t)}(r,o)}return this}static async createFromTexture(e,t){const i=t.usage&GPUTextureUsage.COPY_SRC,n=t.usage&GPUTextureUsage.TEXTURE_BINDING;if(!i&&!n)return console.error("GPUTexture must have COPY_SRC or TEXTURE_BINDING usage for readback."),null;let r=i?t:lP(e,t);const o=await(new wP).mapFromTexture(e,r),s=(new wP).copyFrom(o,0,0,t.width,t.height);return o.unmap(),s}isEmpty(){return null===this.data}copyFrom(e,t,i,n,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(this.isEmpty()){const t=o+n,i=s+r;this.init(t,i,e.format)}const a=bP(e.format);for(let l=0;l<r;l++){const r=e.width*(i+l)+t,c=r+n,u=e.data.subarray(a*r,a*c),h=this.width*(s+l)+o,d=h+n;this.data.set(u,a*h,a*d)}return this}async mapFromTexture(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.width,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.height;const s=function(e){switch(e){case"depth24plus":case"depth32float":case"bgra8unorm":case"rgba8uint":case"rgb10a2unorm":case"r32float":return 4;case"rgba32float":return 16;default:throw new Error("Unsupported texture format: "+e)}}(t.format);let a=(l=t.width*s,256*Math.ceil(l/256));var l;let c=a*t.height;const u=a/s,h=e.createBuffer({size:c,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),d=e.createCommandEncoder(),f=[i,n,0];d.copyTextureToBuffer({texture:t,origin:f},{buffer:h,bytesPerRow:a},[r,o]),e.queue.submit([d.finish()]),await h.mapAsync(GPUMapMode.READ);const p=new(xP(yP(t.format)))(h.getMappedRange());return this.init(u,o,t.format,p,!1),this.unmap=()=>{h.unmap(),h.destroy()},this}static async createFromColorTarget(e){const t=e.getRenderTargets(),i=e.getDevice(),n=t.getColorTarget();return await wP.createFromTexture(i,n)}static async createFromViewDepthTarget(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.getRenderTargets(),n=e.getDevice(),r=i.getViewDepthTarget();let o=r;if(t){const e=n.createTexture({size:[r.width,r.height],format:"r32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});aP(n,r,e,rP),o=e}return await wP.createFromTexture(n,o)}static async createFromNormalsTarget(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.getRenderTargets(),n=e.getDevice(),r=i.getNormalsTarget();let o=r;if(t){const e=n.createTexture({size:[r.width,r.height],format:"rgba32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});aP(n,r,e,oP),o=e}return await wP.createFromTexture(n,o)}static async createFromIdTarget(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.getRenderTargets(),n=e.getDevice(),r=i.getIdTarget(t);return await wP.createFromTexture(n,r)}swizzelRGChannels(){const e=this.format===wP.Formats.rgba8unorm,t=this.format===wP.Formats.bgra8unorm;if(!e&&!t)return console.error("SwizzelRGChannels only supported for rgba8unorm and bgra8unorm formats."),null;for(var i=0;i<this.data.length;i+=4){const e=this.data[i];this.data[i]=this.data[i+2],this.data[i+2]=e}return this.format=e?wP.Formats.bgra8unorm:wP.Formats.rgba8unorm,this}toGreyScaleDepth(){return this.toColorImage(AP)}toColorizedNormals(){return this.toColorImage(EP)}toColorizedIds(){return this.toColorImage(SP)}fillAlpha(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;(e=>{switch(e){case cP:case uP:case hP:return!0;default:return!1}})(this.format)||console.error("fillComponent only supported for rgba8unorm, bgra8unorm, and rgba8uint formats.");const t=255*e;for(let e=0;e<this.data.length;e+=4)this.data[e+3]=t}getPixel(e,t,i){const n=bP(this.format),r=n*(t*this.width+e);i.r=this.data[r],n>1&&(i.g=this.data[r+1]),n>2&&(i.b=this.data[r+2]),n>3&&(i.a=this.data[r+3])}setPixel(e,t,i){const n=bP(this.format),r=n*(t*this.width+e);this.data[r]=i.r,n>1&&(this.data[r+1]=i.g),n>2&&(this.data[r+2]=i.b),n>3&&(this.data[r+3]=i.a)}toColorImage(e){const t=(new wP).init(this.width,this.height,cP),i={r:0,g:0,b:0,a:0},n={r:0,g:0,b:0,a:0};for(var r=0;r<this.height;r++)for(var o=0;o<this.width;o++)this.getPixel(o,r,i),e(i,n),t.setPixel(o,r,n);return t}toCanvas(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.width,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.height,o=this;"r32float"===this.format&&(o=this.toColorImage(AP)),e=e||c().document.createElement("canvas"),e.width=n,e.height=r;var s,a=e.getContext("2d"),l=new Uint8ClampedArray(o.data);return s=new ImageData(l,n,r),a.putImageData(s,t,i,0,0,n,r),e}async toImageUrl(){return _P(this.toCanvas())}async showInNewTab(){const e=await this.toImageUrl();window.open(e)}}const CP=1e-6;const TP={x:0,y:0,z:0};class MP{constructor(e,t,i){this.getVertex=e,this.bbox=t,this.boxSize=this.bbox.getSize().length(),i||(i=CP),i>0?(this.precisionTolerance=i,this.scale=1/this.precisionTolerance):(this.precisionTolerance=-i*this.boxSize,this.scale=1/this.precisionTolerance),this.snapBaseX=this.bbox.min.x,this.snapBaseY=this.bbox.min.y,this.snapBaseZ=this.bbox.min.z,this.xymap={}}findOrAddPoint(e,t,i,n){let r,o=0|(e-this.snapBaseX)*this.scale,s=0|(t-this.snapBaseY)*this.scale,a=0|(i-this.snapBaseZ)*this.scale,l=1/0;for(let n=o-1;n<=o+1;n++){let o=this.xymap[n];if(o)for(let n=s-1;n<=s+1;n++){let s=o[n];if(s)for(let n=a-1;n<=a+1;n++){let o=s[n];if(void 0===o)continue;this.getVertex(o,TP);let a=TP,c=(a.x-e)*(a.x-e)+(a.y-t)*(a.y-t)+(a.z-i)*(a.z-i);c<l&&(r=o,l=c)}}}if(Math.sqrt(l)>this.precisionTolerance&&(r=void 0),void 0===r){let e=this.xymap[o];e||(e=this.xymap[o]={});let t=e[s];return t||(t=e[s]={}),t[a]=n,n}return r}}let IP=new rl,PP=new rl,LP=new rl,RP=new rl,DP=new rl;class OP{constructor(e,t,i){let n=e.boundingBox||i,r=new yc;n&&r.copy(n),this.geom=e,this.myVerts=function(e,t){var i=new Float32Array(3*Tl(e));return Hl(e,(function(e,n,r,o){t&&t.expandByPoint(e),i[3*o]=e.x,i[3*o+1]=e.y,i[3*o+2]=e.z})),i}(e,n?null:r);let o=new MP(this.getV.bind(this),r,-1/65536);this.remap=new Array(Tl(e));for(let e=0,t=0;e<this.myVerts.length;e+=3,t++)this.remap[t]=o.findOrAddPoint(this.myVerts[e],this.myVerts[e+1],this.myVerts[e+2],t);t&&function(e,t){let i=new rl;for(let n=0;n<e.length;n+=3)i.x=e[n],i.y=e[n+1],i.z=e[n+2],i.applyMatrix4(t),e[n]=i.x,e[n+1]=i.y,e[n+2]=i.z}(this.myVerts,t)}getV(e,t){t.x=this.myVerts[3*e],t.y=this.myVerts[3*e+1],t.z=this.myVerts[3*e+2]}getNormal(e,t,i,n){this.getV(e,IP),this.getV(t,PP),this.getV(i,LP),PP.sub(IP),LP.sub(IP),PP.cross(LP),n.copy(PP).normalize()}}function BP(e,t,i,n){if("isLines"in e&&e.isLines||"indexlines"in e||"iblines"in e)return;let r=new OP(e,t,i);var o={},s=[];function a(e,t,i){var a=r.remap[e],l=r.remap[t],c=r.remap[i];if(a!==l&&a!==c&&l!==c){var u=!1;if(a>l){var h=a;a=l,l=h,u=!0}var d=o[a];if(d){var f=d[l];if(void 0===f)d[l]=u?-i-1:i;else{if(n)s.push(e),s.push(t);else{r.getNormal(e,t,i,RP),f<0?r.getNormal(l,a,r.remap[-f-1],DP):r.getNormal(a,l,r.remap[f],DP);var p=RP.dot(DP);Math.abs(p)<.25&&(s.push(e),s.push(t))}delete d[l]}}else o[a]={},o[a][l]=i}}for(var l in jl(e,(function(e,t,i,n,r,o){a(n,r,o),a(r,o,n),a(o,n,r)})),o)for(var c in o[l])s.push(parseInt(l)),s.push(parseInt(c));s.length<2||(e.iblines=new Uint16Array(s.length),e.iblines.set(s))}function NP(e){var t=e||function(e,t){return e<t},i=[],n=[];function r(e,o,s){if(o||(o=0),s||(s=n.length),o>=s)return s;if(s===o+1){var a=i[n[o]];return t(a,e)?s:o}var l=parseInt(o+(s-o)/2),c=i[n[l-1]];return t(e,c)?r(e,o,l):t(c,e)?r(e,l,s):l-1}this.add=function(e){var t=r(e);if(t==n.length)return i.push(e),void n.push(i.length-1);i.push(e),n.splice(t,0,i.length-1)},this.size=function(){return n.length},this.get=function(e){return i[n[e]]},this.removeAt=function(e){var t=n[e];i[t]=void 0,n.splice(e,1)},this.toString=function(){for(var e="",t=0,i=this.size();t<i;++t)e+=this.get(t),t<i-1&&(e+=", ");return e}}function UP(){let e,t,i,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=0;const s=[],a=[];let l,c,u,h;const d=r.timeSlice||15,f=r.sliceDelay||0,p=r.delay??-1;function m(e){o&&clearTimeout(o),o=0,i=e,s.length=0,a.length=0,l=null,c=-1,u=0,h=0}function g(){o=0;const r=performance.now()+d;for(;performance.now()<r;){var l;if(!x())return m(null),void(null===(l=t)||void 0===l||l());e(a[h],s[u],n,h+1>=a.length,!i||c>=i.length)}o=setTimeout((()=>g()),f)}function v(){if(i&&c<i.length)for(;++c<i.length;){if(l=i[c].getInstanceTree(),s.length=0,l)l.enumNodeChildren(i[c].getRootId(),(function(e){s.push(e)}),!0);else{var e;const t=i[c].getFragmentList();null!=t&&null!==(e=t.fragments)&&void 0!==e&&e.dbId2fragId&&s.push(...Object.keys(t.fragments.dbId2fragId).map((e=>parseInt(e))))}if(s.length>0)return n=i[c],n}return n=null,!1}function y(e){if(l)return!l.isNodeHidden(e)&&!l.isNodeOff(e);return!i[c].getFragmentList().dbIdIsGhosted[e]}function b(){if(u>=s.length)return!1;for(;++u<s.length;){const e=s[u];if(r.includeHidden||y(e)){a.length=0;const t=i[c].getFragmentList();if(l)l.enumNodeFragments(e,(function(e){t.isFragVisible(e)&&a.push(e)}),!1);else if(t){let i=t.fragments.dbId2fragId[e];Array.isArray(i)||(i=[i]),i=i.filter((e=>t.isFragVisible(e))),a.push(...i)}if(a.length>0)return!0}}return!1}function x(){if(++h<a.length)return!0;for(h=0;;){if(b())return!0;if(!v())return!1;u=-1}}this.start=function(i,n,r){Array.isArray(i)||(i=[i]),m(i),e=n,t=r,n&&(p>=0?o=setTimeout((()=>g()),p):g())},this.stop=function(){m(null)}}function kP(e,t,i){this.level=e,this.x=t,this.y=i}function FP(e){var t=((1<<2*e.level)-1)/3,i=1<<e.level;return t+e.y*i+e.x}function VP(e){for(var t=new kP(0,0,0);FP(t)<=e;)t.level++;t.level--;var i=e-FP(t),n=1<<t.level;return t.y=Math.floor(i/n),t.x=i%n,t}function GP(){this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1}function zP(){var e=[],t=0;const i=new GP;function n(e,t){var n=t||i;const r=[n.offsetX,n.offsetY,n.offsetX+n.scaleX,n.offsetY,n.offsetX+n.scaleX,n.offsetY+n.scaleY,n.offsetX,n.offsetY+n.scaleY],o=e.getAttribute("uv");if(o){for(let e=0;e<r.length;e+=2){const t=e/2;o.setXY(t,r[e],r[e+1])}o.needsUpdate=!0,sn&&(e.vbNeedsUpdate=!0,e.dispose())}else e.setAttribute("uv",new(v().BufferAttribute)(new Float32Array(r),2))}this.acquireQuadGeom=function(i){var r=e[t];return r?n(r,i):(r=this.createQuadGeom(i),e[t]=r),t++,r},this.createQuadGeom=function(e){var t=new(v().BufferGeometry);return t.setAttribute("position",new(v().BufferAttribute)(new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0]),3)),t.setIndex([0,1,2,0,2,3]),t.computeVertexNormals(),n(t,e),t},this.reset=function(){t=0},this.dispose=function(){for(var t=0;t<e.length;t++){var i=e[t];i&&(i.dispose(),i.needsUpdate=!0)}e=[]}}kP.prototype={constructor:kP,copy:function(){return new kP(this.level,this.x,this.y)},isValid:function(){return Number.isInteger(this.level)&&this.level>=0&&Number.isInteger(this.x)&&Number.isInteger(this.y)},getChild:function(e){var t=1&e?1:0,i=2&e?1:0;return new kP(this.level+1,2*this.x+t,2*this.y+i)},getParent:function(){return 0===this.level?null:new kP(this.level-1,Math.floor(this.x/2),Math.floor(this.y/2))},getParentAtLevel:function(e){if(e<0||e>this.level)return null;var t=this.level-e;return new kP(e,Math.floor(this.x>>t),Math.floor(this.y>>t))},toString:function(){return"("+this.level+", "+this.x+", "+this.y+")"},equals:function(e,t,i){return e instanceof kP?this.equals(e.level,e.x,e.y):this.level===e&&this.x===t&&this.y===i}},GP.prototype.toVec4=function(){return new(v().Vector4)(this.offsetX,this.offsetY,this.scaleX,this.scaleY)},GP.prototype.copyTo=function(e){e.offsetX=this.offsetX,e.offsetY=this.offsetY,e.scaleX=this.scaleX,e.scaleY=this.scaleY};var HP=r(86546),WP=r.n(HP),jP=r(4965),qP=r.n(jP);let KP={uniforms:v().UniformsUtils.merge([v().UniformsLib.common,Zd.CutPlanesUniforms,Zd.IdUniforms,Zd.ThemingUniform,{selectionColor:{type:"v4",value:new(v().Vector4)(0,0,1,0)},viewportBounds:{type:"v4",value:new(v().Vector4)(0,0,1,1)},modelLocalMatrix:{type:"m4",value:new(v().Matrix4)}}]),vertexShader:WP(),fragmentShader:qP()};const XP="$frameBindGroup\n$objectUniforms\n\nstruct VertexInput {\n    @location(0) position: vec3f,\n    @location(1) normal: u32,\n    @location(2) uv: vec2f,\n    @builtin(instance_index) instance: u32\n}\n\nstruct VertexOutput {\n    @builtin(position) position: vec4f,\n    @location(0) uv: vec2f\n}\n\n// Since corresponding ShaderMaterial instance is created for the WebGL initially,\n// we must keep the same structure (up to supported types in CustomShaderPipeline), even if they are not used.\nstruct Uniform {\n    diffuse              : vec3f,\n    opacity              : f32,\n    offsetRepeat         : vec4f, // used\n    flipEnvMap           : f32,\n    reflectivity         : f32,\n    refractionRatio      : f32,\n    morphTargetInfluences: f32,\n    cutplanesHideInterior: i32,\n    hatchParams          : vec2f,\n    hatchTintColor       : vec3f,\n    hatchTintIntensity   : f32,\n    dbId                 : vec3f,\n    modelId              : vec3f,\n    themingColor         : vec4f,\n    selectionColor       : vec4f, // used\n    viewportBounds       : vec4f,\n    modelLocalMatrix     : mat4x4f\n}\n\n@group(2) @binding(0) var<uniform> modelUniforms: Uniform;\n\n@vertex\nfn vsmain(in: VertexInput)\n-> VertexOutput {\n\n    let objectUniforms = getObjectUniforms(in.instance);\n    var modelViewMatrix = uniforms.viewMatrix * objectUniforms.modelMatrix;\n    var position = uniforms.projectionMatrix * modelViewMatrix * vec4f(in.position.xy, 0.0, 1.0);\n    let uv = in.uv * modelUniforms.offsetRepeat.zw + modelUniforms.offsetRepeat.xy;\n\n    return VertexOutput(\n        position,\n        uv\n    );\n}\n\n// Need to make sure that the output matches the render pass the pipeline is being set to\n// In this case we have MainPass.#mainPassDescriptorProg and CommonRenderTargets.NumIdTargets\nstruct PixelOutput {\n    @location(0) color: vec4f,\n    @location(1) normal: vec4f,\n    @location(2) viewDepth: vec4f,\n    @location(3) dbId: vec4u,\n    @location(4) modelId: vec4u,\n}\n\n@group(2) @binding(1) var defaultTexture: texture_2d<f32>;\n@group(2) @binding(2) var defaultSampler: sampler;\n\n@fragment\nfn psmain(in: VertexOutput)\n-> PixelOutput {\n    var color = textureSample(defaultTexture, defaultSampler, in.uv);\n    var finalColor = mix(color.rgb, modelUniforms.selectionColor.rgb, modelUniforms.selectionColor.a);\n    return PixelOutput(\n        vec4(finalColor, 1.0),\n        vec4f(0),\n        vec4f(0),\n        vec4u(0),\n        vec4u(0)\n    );\n}\n";var YP=0,QP=1,ZP=2;const $P=c().document;var JP=function(e,t){this.timeStamps=e,this.mesh=t,this.state=YP};function eL(){this.urlPattern=null,this.tileSize=null,this.maxLevel=null,this.skippedLevels=[],this.textureLoader=null,this.texWidth=0,this.texHeight=0,this.maxActiveTiles=F()?0:400,this.cacheSize=F()?0:150,this.onRootLoaded=null,this.levelOffset=0,this.getRootTileSize=function(){return 1*(this.tileSize<<this.maxLevel)},this.getQuadWidth=function(){return this.scale*this.texWidth/this.getRootTileSize()},this.getQuadHeight=function(){return this.scale*this.texHeight/this.getRootTileSize()},this.getPageToModelTransform=function(e,t){var i=e/this.getQuadWidth(),n=t/this.getQuadHeight();return new al(!0).set(i,0,0,0,0,n,0,0,0,0,1,0,0,0,0,1)},this.getBBox=function(){var e=this.getQuadWidth(),t=this.getQuadHeight();if(this.fitPaperSize)return new(v().Box3)(new(v().Vector3),new(v().Vector3)(e,t,0));var i=1-t;return new(v().Box3)(new(v().Vector3)(0,i,0),new(v().Vector3)(e,1,0))},this.valid=function(){return"string"==typeof this.urlPattern&&this.urlPattern.length>0&&"number"==typeof this.tileSize&&this.tileSize>0&&"number"==typeof this.maxLevel&&this.maxLevel>0&&"number"==typeof this.texWidth&&this.texWidth>0&&"number"==typeof this.texHeight&&this.texHeight>0},this.initForSimpleImage=function(e){this.urlPattern=decodeURIComponent(e),this.maxLevel=0,this.levelOffset=0,this.scale=1,this.tileSize=-1,this.texWidth=-1,this.texHeight=-1,this.isSimpleImage=!0},this.isLevelPresent=function(e){return!this.skippedLevels[e]},this.initFromLoadOptions=function(e,t,i,n){if(this.urlPattern=decodeURIComponent(e),this.textureLoader=i,this.options=n,t){this.tileSize=t.tileSize,this.maxLevel=(r=t.texWidth,o=t.texHeight,s=t.tileSize,a=Math.ceil(Math.log2(r)),l=Math.ceil(Math.log2(o)),Math.max(a,l)-Math.log2(s)),this.texWidth=t.texWidth,this.texHeight=t.texHeight,this.levelOffset=t.levelOffset,this.zips=t.zips;const e=!(!t.paperWidth||!t.paperHeight);this.fitPaperSize=t.fitPaperSize&&e,this.paperHeight=t.paperHeight,this.scale=this.fitPaperSize?t.paperWidth*this.getRootTileSize()/this.texWidth:1,this.skippedLevels=function(e){var t=[];if(e.zips){i=(i=(i=(i=e.urlPattern.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).replace(/\\{x\\}/,"[0-9]+")).replace(/\\{y\\}/,"[0-9]+")).replace(/\\{z\\}/,"([0-9]+)");var i=new RegExp("^"+i+"$");t.length=e.maxLevel+1,t.fill(!0);var n=0;e.zips.forEach((function(r){Object.keys(r.fileTable).forEach((function(r){var o=i.exec(r);if(o&&o[1]){var s=parseInt(o[1])-e.levelOffset;s>=0&&s<=e.maxLevel&&(t[s]=!1,++n)}}))})),0===n&&(t.length=0,rt.info("No leaflet levels found - assume all are present"))}return t}(this),"number"==typeof t.maxLevel&&function(e,t,i){for(;i>0&&e.skippedLevels[i];)--i;var n=t-i;n>0&&(e.texWidth>>=n,e.texHeight>>=n,e.maxLevel=i)}(this,this.maxLevel,t.maxLevel),this.maxActiveTiles=t.maxActiveTiles||this.maxActiveTiles,this.cacheSize=t.cacheSize||this.cacheSize}else this.options&&(this.options.loadOptions={});var r,o,s,a,l}}function tL(e,t){this.isModelIteratorTexQuad=!0;var i=e,n=1,r=e.getBBox(),o=[];let s=null,a=null;const l=new(v().Matrix4),c=new(v().Matrix4),u=new(v().Matrix4),h=new(v().Vector3),d=new(v().Quaternion),f=new(v().Vector3),p=new Autodesk.Viewing.Private.FrustumIntersector;let m,g=1,y=1;const b=new(v().Vector4)(0,0,0,0),x=(new(v().Vector4)).copy(b);let _=0;var E=t,S=null,A=!1,w=!1,C=!1,T=new(v().Color),M=[],I=[],P=[];this.registerView=function(){var e=o.indexOf(void 0);-1===e&&(e=o.length);var t=new(v().Scene);return t.ignoreFadeMaterial=!0,i.placementTransform&&t.matrix.copy(i.placementTransform),t.matrixAutoUpdate=!1,o[e]=t,P[e]=0,M[e]=!0,e},this.registerView();var L=0,R=0,D=!1,O=[],B=null,N=!1,U=new zP;function k(e){var t=i.maxLevel-e;return i.texWidth>>t}function F(e){var t=i.maxLevel-e;return i.texHeight>>t}function V(e){var t=k(e.level),n=F(e.level),r=e.x*i.tileSize,o=e.y*i.tileSize;return r>=t||o>=n}function G(e){var t=k(e.level),n=F(e.level),r=e.x*i.tileSize,o=e.y*i.tileSize,s=Math.max(0,Math.min(i.tileSize,t-r)),a=Math.max(0,Math.min(i.tileSize,n-o)),l=1*i.tileSize;return new(v().Vector2)(s/l,a/l)}function z(e){return i.scale/(1<<e)}function H(e){return z(e.level)*e.x*n}function W(e){var t=z(e.level);return(i.fitPaperSize?i.paperHeight:1)-(e.y+1)*t*n}function j(e){return I[FP(e)]}function q(e){var t=j(e);return t instanceof JP&&t.state===ZP}function K(e,t,i){var r;if(t)B||(B=U.createQuadGeom()),r=B;else{var o=function(e,t){for(var i=e.getParent();i;){var n=j(i),r=n&&n.state===ZP;if(r&&t&&n.mesh.material.map.needsUpdate&&i.level>0&&(r=!1),r)break;i=i.getParent()}return i}(e);t=Z(o).material;var s=function(e,t){var i=1<<e.level-t.level,n=1/i,r=n,o=G(t);n/=o.x,r/=o.y;var s=t.x*i,a=t.y*i,l=e.x-s,c=e.y-a,u=G(e);l*=n,c=1-(c*=r)-r*u.y;var h=new GP;return h.offsetX=l,h.offsetY=c,h.scaleX=n*u.x,h.scaleY=r*u.y,h}(e,o);r=U.acquireQuadGeom(s)}var a=new(v().Mesh)(r,t);a.tile=e,a.modelId=_,a.themingColor=x;var l=z(e.level),c=G(e),u=(1-c.y)*l*n,h=H(e),d=W(e);return a.position.set(h,d+u,0),a.scale.set(l*c.x*n,l*c.y*n,1),t.uniforms.offsetRepeat.value.set(t.map.offset.x,t.map.offset.y,t.map.repeat.x,t.map.repeat.y),a}this.setAggressivePrefetching=function(e){N=e},this.getScene=function(e){return o[e=e||0]},this.getModelMatrix=function(){return s},this.getInverseModelMatrix=function(){return s?(a||(a=s.clone().invert()),a):null},this.setModelMatrix=function(e){e?(s=s||new(v().Matrix4),s.copy(e)):s=null,a=null},this.nextBatch=function(e){return M[e=e||0]?null:(M[e]=!0,o[0].renderImportance=w?-1:void 0,o[0])},this.getSceneCount=function(){return 1},this.done=function(e){return M[e||0]},this.rayCast=function(e,t){return null},this.getVisibleBounds=function(e,t){let n=r;S&&(n=n.clone().intersect(S)),e&&(e.copy(n),i.placementTransform&&e.applyMatrix4(i.placementTransform),s&&e.applyMatrix4(s)),t&&(t.copy(n),i.placementTransform&&t.applyMatrix4(i.placementTransform),s&&t.applyMatrix4(s))},this.setViewBounds=function(e){S=e,E.setViewportBoundsForModel(_,S)},this.getViewBounds=function(){return S},this.setDoNotCut=function(e){return A=e},this.getDoNotCut=function(){return A};var X=function(e){for(var t=e.image,i=1;(i*=2)<t.width;);for(var n=1;(n*=2)<t.height;);if(i!==t.width||n!==t.height){var r=$P.createElement("canvas");r.width=i,r.height=n;var o=r.getContext("2d");o.drawImage(t,0,0);var s,a,l=o.getImageData(0,0,i,n),c=new Uint32Array(l.data.buffer,0,i*n);if(t.height<n){var u=t.height*i;for(s=t.height;s<n;++s,u+=i)for(a=0;a<t.width;++a)c[u+a]=c[u+a-i]}if(t.width<i){var h=0;for(s=0;s<n;++s,h+=i)for(a=t.width;a<i;++a)c[h+a]=c[h+a-1]}o.putImageData(l,0,0),e.image=r,e.flipY&&e.offset.set(0,1-t.height/n),e.repeat.set(t.width/i,t.height/n)}},Y=this;function Q(t){var n=FP(t),o=I[n];if(!o||o.state===YP){o||(o=new JP(P.slice()),I[n]=o),o.state=QP;var s=function(e){var t=i.levelOffset?i.levelOffset:0;return i.urlPattern.replace("{x}",e.x).replace("{y}",e.y).replace("{z}",e.level+t)}(t);R++,i.textureLoader(s,(function(n,a){!function(n){if(!Y||!n)return;0===i.maxLevel&&(-1===i.texWidth&&(i.texWidth=n.image.width),-1===i.texHeight&&(i.texHeight=n.image.height),-1===i.tileSize&&(i.tileSize=Math.max(n.image.width,n.image.height)),i.options&&(i.options.loadOptions.texWidth=i.texWidth,i.options.loadOptions.texHeight=i.texHeight),r=e.getBBox()),X(n),n.minFilter=v().LinearMipMapLinearFilter,n.magFilter=v().LinearFilter,n.anisotropy=Math.min(4,Math.max(i.maxAnisotropy,1));const a=Lb(KP);a.supportsMrtNormals=!0,a.supportsViewportBounds=!0,a.map=a.uniforms.map.value=n,a.side=v().DoubleSide,a.doNotCut=Y.getDoNotCut(),a.tile=t,a.disableEnvMap=!0,-1!==s.toLowerCase().indexOf(".png")&&(a.transparent=!0,a.alphaTest=.01),sn&&(a.webGPU={labelPrefix:"Leaflet Shader",shader:XP,textureBindings:[{uniformKey:"map",binding:1,samplerBinding:2}]});var l=K(t,a);o.mesh=l,o.state=ZP,R--,D=!0;var c=n&&n.image?n.image.src:null;c&&v().Cache&&v().Cache.get(c)&&v().Cache.remove(c),0===t.level&&i.onRootLoaded&&(_=i.onRootLoaded()),l.themingColor=x,l.modelId=_,a.name=`model:${_}|${s}`,E.addMaterial(a.name,a,!0),E.setMaterialViewportBounds(a,S),Y._updateMaterialVisibility(a),Y._updateMaterialSelection(a)}(n)}),(function(e){i.onDone(e,null),console.error(e)}))}}function Z(e){var t=FP(e),i=I[t];return i&&i.state===ZP?i.mesh:null}function $(e,t){var i=H(e)*g,n=W(e)*y;t.set(i,n,0)}function J(e,t){var i=z(e.level),n=(H(e)+i)*g,r=(W(e)+i)*y;t.set(n,r,0)}this.requestRootTile=function(){Q(new kP(0,0,0))};var ee,te,ie,ne=(ee=new(v().Vector3),te=new(v().Vector3),ie=new(v().Box3),function(e,t){return $(e,ee),J(e,te),ie.set(ee,te),t.intersectsBox(ie)>0}),re=function(){var e=new(v().Vector3),t=new(v().Vector3);return function(i,n,r){var o=z(i.level);$(i,e),J(i,t);var s=Kp.pointToMinMaxBoxDistance2(r,e,t);return(ne(i,n)?100:1)*(o*o)/(s=Math.max(s,1e-4))}}(),oe=function(){const e=new(v().Vector3),t=new(v().Vector3);return function(n,r,o){$(n,e),J(n,t);const s=Math.abs(function(e,t,i,n){var r=e.clone();return r.max(i),r.min(n),r.sub(e).dot(t)}(r.position,o,e,t)),a=i.getPixelRatio(),l=r.pixelsPerUnitAtDistance(s)*a;return(t.y-e.y)*l}}();function se(e,t){this.tile=e,this.prio=t}function ae(e,t){return e.prio>t.prio}function le(e,t){var i=I[FP(e)];i&&i.timeStamps[t]!==P[t]&&(i.timeStamps[t]=P[t],L++)}function ce(e,t,i){e.sort((function(e,n){var r=re(e,t,i);return re(n,t,i)-r}));for(var n=0,r=0;r<e.length;r++){var o=j(e[r]);if(!o||o.state!==QP){if(R>=5)break;Q(e[r]),n++}}return n}function ue(e){if(e&&e.mesh&&e.mesh.material){var t=e.mesh.material;E.removeMaterial(t.name),t.map.dispose(),t.map.needsUpdate=!0;t.dispatchEvent({type:"dispose"}),t.needsUpdate=!0}}function he(e){for(var t=0;t<P.length;t++){if(!!o[t]&&e.timeStamps[t]===P[t])return!0}return!1}this.dispose=function(){var e;for(e in I)ue(I[e]);B&&(B.dispose(),B.needsUpdate=!0),U.dispose()},this.dtor=function(){this.dispose(),Y=null,E=null},this.reset=function(e,t,n){const r=(n=n||0)>0,a=o[n];var b,x;for(({camera:t,frustum:e}=function(e,t,i){const n=e.matrixWorld;if(s?n.multiplyMatrices(s,e.matrix):n.copy(e.matrix),n.equals(u))g=1,y=1;else{n.decompose(h,d,f),l.makeRotationFromQuaternion(d),l.setPosition(h),g=f.x,y=f.y,m=i.clone(m),c.copy(l).invert(),m.transformCurrentView(c),m.updateCameraMatrices();const e=t.cutPlanes,r=t.areaCullThreshold;(t=p).areaCullThreshold=r,t.reset(m,e),i=m}return{camera:i,frustum:t}}(a,e,t)),b=0;b<a.children.length;b++){a.children[b].dispatchEvent({type:"removed"})}if(a.children.length=0,P[n]++,L=0,U.reset(),!q(new kP(0,0,0)))return M[n]=!0,!1;var _=new NP(ae),E=new kP(0,0,0),S=re(E,e,t.position);_.add(new se(E,S));for(var A=t.getWorldDirection(new(v().Vector3)),w=[],C=[],T=[];_.size()>0;){if(x=_.get(0).tile,_.removeAt(0),V(x))continue;var B=!0;x.level===i.maxLevel&&(B=!1);oe(x,t,A)<i.tileSize&&i.isLevelPresent(x.level)&&(B=!1);var k=ne(x,e);if(k&&(!q(x)&&i.isLevelPresent(x.level)&&T.push(x),le(x,n)),!k&&w.length+C.length>i.maxActiveTiles&&(B=!1),B)for(let i=0;i<4;i++){const n=x.getChild(i);S=re(n,e,t.position),_.add(new se(n,S))}else k?w.push(x):C.push(x)}var F=0;D=!1;var G=!0;for(b=0;b<w.length;++b){var z=Z(x=w[b]);z&&z.material.map.needsUpdate&&!N&&(F<5||r?F++:(z=K(x,null),D=!0,G=!1)),z||(z=K(x,null),G=!1),a.add(z)}M[n]=!1;var H=ce(T,e,t.position);L+=R;var W=[];for(b=0;b<C.length&&!(L>=i.maxActiveTiles);b++)if(q(x=C[b]))for(let e=0;e<=x.level;e++){if(le(x.getParentAtLevel(e),n),L>i.maxActiveTiles)break}else W.push(x),L++;if(H+=ce(W,e,t.position),N){for(W=[],b=0;b<w.length;++b)if((x=w[b]).level!==i.maxLevel&&i.isLevelPresent(x.level+1))for(let t=0;t<4;t++){const i=x.getChild(t);!V(i)&&ne(i,e)&&(q(i)||(W.push(i),L++))}H+=ce(W,e,t.position)}if(r||function(e,t,n){var r=Object.keys(I),o=r.length,s=e-(i.cacheSize-o);if(!(s<=0)){r.sort((function(e,i){var r=I[e].timeStamps[0],o=I[i].timeStamps[0];if(r!==o)return r-o;var s=VP(e),a=VP(i);return re(s,t,n)-re(a,t,n)}));for(var a=Math.min(s,r.length),l=0;l<a;l++){var c=r[l];if(0!==VP(c).level){var u=I[c];if(u.state===ZP){if(he(u))break;ue(u),delete I[c]}}}}}(H,e,t.position),G&&O.length>0){var j=O.splice(0,O.length);setTimeout((function(){for(var e=0;e<j.length;e++)j[e](n)}),1)}return G},this.callWhenRefined=function(e){O.push(e)},this.update=function(){return D},this.setDpiScale=function(e){n=e},this.getDpiScale=function(){return n},this.setThemingColor=function(e){x.copy(e)},this.clearThemingColor=function(){x.copy(b)},this.unregisterView=function(e){o[e]=void 0,P[e]=void 0,M[e]=void 0;for(var t=o.length;t>0&&!o[t-1];)t--;o.length=t,P.length=t,M.length=t},this._updateMaterialVisibility=function(e){!e.defines.GHOSTED^!w&&(w?e.defines.GHOSTED=1:delete e.defines.GHOSTED,e.needsUpdate=!0)},this.setVisibility=function(e){w=!e,E.forEachInModel(_,!1,(e=>{this._updateMaterialVisibility(e)}))},this._updateMaterialSelection=function(e){e.uniforms.selectionColor.value.set(T.r,T.g,T.b,C?.6:0)},this.highlightSelection=function(e){C=e,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T,E.forEachInModel(_,!1,(e=>{this._updateMaterialSelection(e)}))}}const iL={Index:0,IndexEdges:1,Position:2,Normal:3,TextureUV:4,Color:5},nL=0,rL=1,oL=2,sL=3,aL=4,lL=5,cL=6,uL=7,hL=8,dL=9,fL=10,pL={TRIANGLES:0,LINES:1,POINTS:2,WIDE_LINES:3},mL={position:iL.Position,normal:iL.Normal,index:iL.Index,indexlines:iL.IndexEdges,color:iL.Color},gL={};gL[iL.Position]="position",gL[iL.Normal]="normal",gL[iL.Index]="index",gL[iL.IndexEdges]="indexlines",gL[iL.Color]="color",gL[iL.TextureUV]="uv";const vL={};function yL(e){var t=e[0];e[0]=e[1],e[1]=e[2],e[2]=t}function bL(e){var t=[];for(let i=0;i<e.length;i+=2)t.push([e[i],e[i+1]]);for(const e of t)if(e[0]>e[1]){var i=e[0];e[0]=e[1],e[1]=i}t.sort((function(e,t){return e[0]-t[0]}));var n=t[0],r=0;e[r]=n[0],e[r+1]=n[1]-n[0],r+=2;for(let i=1;i<t.length;i++,r+=2)n=t[i],e[r]=n[0]-t[i-1][0],e[r+1]=n[1]-n[0]}function xL(e){if(e.length){e[1]+=e[0],e[2]+=e[0];for(var t=3;t<e.length;t+=3)e[t]+=e[t-3],e[t+1]+=e[t],e[t+2]+=e[t]}}function _L(e){if(e.length){e[1]+=e[0];for(var t=2;t<e.length;t+=2)e[t]+=e[t-2],e[t+1]+=e[t]}}function EL(e){var t=gL[e];return t||(console.error("Unknown vertex attribute"),iL.TextureUV)}function SL(){}function AL(e){this.buffer=e,this.readOffset=0,this.meshFlag=0,this.numBuffers=0,this.numAttributes=0,this.bufferOffsets=[],this.attributes=[],this.buffers=[]}function wL(e){var t=new SL;if(!e.vb)return console.error("Unexpected non-interleaved vertex buffer"),null;const i=e.vb,n=e.vbstride,r=e.ib,o=e.iblines,s=[i.byteLength,r.byteLength];o&&s.push(o.byteLength);var a,l,c=Object.keys(e.attributes),u=0;e.isLines&&(u|=pL.LINES),e.isWideLines&&(u|=pL.WIDE_LINES),e.isPoints&&(u|=pL.POINTS),t.beginHeader(u,c.length,s);for(var h=0;h<c.length;h++){var d=e.attributes[c[h]],f=(a=c[h],l=void 0,void 0!==(l=mL[a])?l:(0===a.indexOf("uv")||console.warn("Unknown attribute name"),iL.TextureUV));"index"===c[h]?t.addAttribute(f,d,0,1):"indexlines"===c[h]?t.addAttribute(f,d,0,2):t.addAttribute(f,d,n,0)}t.endHeader();var p=Buffer.from(i.buffer,i.byteOffset,i.byteLength);return t.addBuffer(p),e.isLines?bL(r):function(e){var t=[];for(let i=0;i<e.length;i+=3)t.push([e[i],e[i+1],e[i+2]]);for(i of t)for(;i[0]>i[1]||i[0]>i[2];)yL(i);t.sort((function(e,t){return e[0]-t[0]}));var i=t[0],n=0;e[n]=i[0],e[n+1]=i[1]-i[0],e[n+2]=i[2]-i[0],n+=3;for(let r=1;r<t.length;r++,n+=3)i=t[r],e[n]=i[0]-t[r-1][0],e[n+1]=i[1]-i[0],e[n+2]=i[2]-i[0]}(r),p=Buffer.from(r.buffer,r.byteOffset,r.byteLength),t.addBuffer(p),o&&(bL(o),p=Buffer.from(o.buffer,o.byteOffset,o.byteLength),t.addBuffer(p)),t.end()}vL[nL]=1,vL[rL]=2,vL[oL]=1,vL[sL]=2,vL[aL]=1,vL[lL]=2,vL[cL]=1,vL[uL]=2,vL[hL]=4,vL[dL]=4,vL[fL]=4,SL.prototype.beginHeader=function(e,t,i){var n=8,r=i.length;for(n+=4*(r-1),n+=5*t;n%4!=0;)n++;var o=0;for(let e=0;e<i.length;e++)o+=i[e];this.buffer=Buffer.alloc(n+o),this.writeOffset=0;for(let e=0;e<4;e++)this.writeOffset=this.buffer.writeUInt8("OTG0".charCodeAt(e),this.writeOffset);this.writeOffset=this.buffer.writeUInt16LE(e,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(r,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(t,this.writeOffset);var s=i[0];for(let e=1;e<i.length;e++)this.writeOffset=this.buffer.writeUInt32LE(s,this.writeOffset),s+=i[e]},SL.prototype.addAttribute=function(e,t,i,n){this.writeOffset=this.buffer.writeUInt8(e,this.writeOffset),e===iL.Index||e===iL.IndexEdges?(this.writeOffset=this.buffer.writeUInt8(function(e){var t=sL,i=e.bytesPerItem||2;return 1===i?t=oL:2===i?t=sL:4===i&&(t=fL),t<<4|15&e.itemSize}(t),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(t.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(i||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(n,this.writeOffset)):(this.writeOffset=this.buffer.writeUInt8(function(e){var t=hL,i=e.bytesPerItem||4;return 1===i?t=e.normalized?cL:oL:2===i&&(t=e.normalized?uL:sL),t<<4|15&e.itemSize}(t),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(t.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(i||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(n,this.writeOffset))},SL.prototype.endHeader=function(){for(;this.writeOffset%4!=0;)this.writeOffset=this.buffer.writeUInt8(0,this.writeOffset)},SL.prototype.addBuffer=function(e){e.copy(this.buffer,this.writeOffset),this.writeOffset+=e.length},SL.prototype.end=function(){return this.writeOffset!==this.buffer.length&&console.error("Incorrect encoding buffer size"),this.buffer},AL.prototype.readNodeJS=function(){if("OTG0"!==this.buffer.toString("ascii",0,4))return console.error("Invalid OTG header"),!1;if(this.readOffset=4,this.meshFlag=this.buffer.readUInt16LE(this.readOffset),this.readOffset+=2,this.numBuffers=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numAttributes=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numBuffers){this.bufferOffsets.push(0);for(var e=1;e<this.numBuffers;e++){var t=this.buffer.readUInt32LE(this.readOffset);this.readOffset+=4,this.bufferOffsets.push(t)}}for(let e=0;e<this.numAttributes;e++){var i={};i.name=this.buffer.readUInt8(this.readOffset),this.readOffset++;var n=this.buffer.readUInt8(this.readOffset);this.readOffset++,i.itemSize=15&n,i.type=n>>4,i.bytesPerItem=vL[i.type],i.normalized=i.type===aL||i.type===lL||i.type===cL||i.type===uL,i.itemOffset=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,i.itemStride=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,i.bufferIndex=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.attributes.push(i)}for(;this.readOffset%4!=0;)this.readOffset++;for(let e=0;e<this.bufferOffsets.length;e++){var r,o=this.readOffset+this.bufferOffsets[e];r=e<this.bufferOffsets.length-1?this.readOffset+this.bufferOffsets[e+1]:this.buffer.length,this.buffers.push(this.buffer.slice(o,r))}return!0},AL.prototype.readWeb=function(){var e=new xp(this.buffer);if("OTG0"!==e.getString(4))return console.error("Invalid OTG header"),!1;if(this.meshFlag=e.getUint16(),this.numBuffers=e.getUint8(),this.numAttributes=e.getUint8(),this.numBuffers){this.bufferOffsets.push(0);for(let i=1;i<this.numBuffers;i++){var t=e.getUint32();this.bufferOffsets.push(t)}}for(let t=0;t<this.numAttributes;t++){var i={};i.name=e.getUint8();var n=e.getUint8();i.itemSize=15&n,i.type=n>>4,i.bytesPerItem=vL[i.type],i.normalized=i.type===aL||i.type===lL||i.type===cL||i.type===uL,i.itemOffset=e.getUint8()/4,i.itemStride=e.getUint8()/4,i.bufferIndex=e.getUint8(),this.attributes.push(i)}for(;e.offset%4!=0;)e.offset++;for(let t=0;t<this.bufferOffsets.length;t++){var r,o=e.offset+this.bufferOffsets[t];r=t<this.bufferOffsets.length-1?e.offset+this.bufferOffsets[t+1]:e.byteLength,this.buffers.push(this.buffer.subarray(o,r))}return!0},AL.prototype.read=function(){return S()&&this.buffer instanceof Buffer?this.readNodeJS():this.readWeb()};var CL=new yc;CL.min.x=-.5,CL.min.y=-.5,CL.min.z=-.5,CL.max.x=.5,CL.max.y=.5,CL.max.z=.5;var TL={center:{x:0,y:0,z:0},radius:Math.sqrt(.75)};function ML(e,t){var i=new AL(e);if(!i.read())return console.error("Failed to parse OTG geometry"),null;var n={vblayout:{},vb:new Float32Array(i.buffers[0].buffer,i.buffers[0].byteOffset,i.buffers[0].byteLength/4),isLines:(3&i.meshFlag)===pL.LINES,isWideLines:(3&i.meshFlag)===pL.WIDE_LINES,isPoints:(3&i.meshFlag)===pL.POINTS,boundingBox:CL,boundingSphere:TL};let r=0;for(var o=0;o<i.attributes.length;o++){var s=i.attributes[o];if(s.name===iL.Index){var a=i.buffers[1];1===s.bytesPerItem?n.indices=a:2===s.bytesPerItem?n.indices=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/s.bytesPerItem):4===s.bytesPerItem&&(n.indices=new Uint32Array(a.buffer,a.byteOffset,a.byteLength/s.bytesPerItem)),n.isLines?_L(n.indices):xL(n.indices)}else if(s.name===iL.IndexEdges){if(!t){var l=i.buffers[2];1===s.bytesPerItem?n.iblines=l:2===s.bytesPerItem?n.iblines=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/s.bytesPerItem):4===s.bytesPerItem&&(n.iblines=new Uint32Array(l.buffer,l.byteOffset,l.byteLength/s.bytesPerItem)),_L(n.iblines)}}else{var c=EL(s.name);"uv"===c&&(r++,r>1&&(c+=r.toString())),n.vbstride?n.vbstride!==s.itemStride&&console.error("Unexpected vertex buffer stride mismatch."):n.vbstride=s.itemStride,s.itemOffset>=s.itemStride||(n.vblayout[c]={bytesPerItem:s.bytesPerItem,offset:s.itemOffset,normalized:s.normalized,itemSize:s.itemSize})}}return{mesh:n,packId:0,meshIndex:0}}const IL=function(e,t){t.min.x<e.min.x&&(e.min.x=t.min.x),t.min.y<e.min.y&&(e.min.y=t.min.y),t.min.z<e.min.z&&(e.min.z=t.min.z),t.max.x>e.max.x&&(e.max.x=t.max.x),t.max.y>e.max.y&&(e.max.y=t.max.y),t.max.z>e.max.z&&(e.max.z=t.max.z)};var PL=16383,LL={dt_object:0,dt_void:1,dt_byte:2,dt_int:3,dt_float:4,dt_double:5,dt_varint:6,dt_point_varint:7,dt_byte_array:32,dt_int_array:33,dt_float_array:34,dt_double_array:35,dt_varint_array:36,dt_point_varint_array:37,dt_arc:38,dt_circle:39,dt_circular_arc:40,dt_string:63,dt_last_data_type:127},RL={st_object_member:0,st_fill:1,st_fill_off:2,st_clip_off:3,st_layer:4,st_link:5,st_line_weight:6,st_miter_angle:7,st_miter_length:8,st_line_pattern_ref:9,st_back_color:10,st_color:11,st_markup:12,st_object_id:13,st_markup_id:14,st_reset_rel_offset:15,st_font_ref:16,st_begin_object:32,st_clip:33,st_line_caps:34,st_line_join:35,st_line_pattern_def:36,st_font_def:37,st_viewport:38,st_sheet:42,st_arc:43,st_polyline:44,st_raster:45,st_text:46,st_polytriangle:47,st_dot:48,st_end_object:63,st_last_semantic_type:127};const DL=.0075;function OL(e){return 1&e?-(e>>>1):e>>>1}function BL(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.metadata=e,this.scaleX=1,this.scaleY=1,this.bbox={min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}},this.is2d=!0,this.layersMap={},this.fontDefs={},this.fontCount=0,this.fontId=0,this.manifestAvailable=!1,this.geomMetricsSum=0,this.objectMemberQueue=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[],viewables:[]},e){var r=e.page_dimensions;this.paperWidth=r.page_width,this.paperHeight=r.page_height,this.scaleX=this.paperWidth/r.plot_width,this.scaleY=this.paperHeight/r.plot_height,this.hidePaper=r.hide_paper;var o=this.paperWidth,s=this.paperHeight;this.bbox.max.x=o,this.bbox.max.y=s;var a=e.page_dimensions||{};if(isFinite(a.paper_rotation)&&0!==a.paper_rotation){var l=a.paper_rotation*Math.PI/180,c=Math.cos(l),u=Math.sin(l),h=o*c,d=o*u,f=-s*u,p=s*c;this.bbox.min.x=Math.min(0,h,f,h+f),this.bbox.max.x=Math.max(0,h,f,h+f),this.bbox.min.y=Math.min(0,d,p,d+p),this.bbox.max.y=Math.max(0,d,p,d+p)}isFinite(a.paper_offset_x)&&0!==a.paper_offset_x&&(this.bbox.min.x+=a.paper_offset_x,this.bbox.max.x+=a.paper_offset_x),isFinite(a.paper_offset_y)&&0!==a.paper_offset_y&&(this.bbox.min.y+=a.paper_offset_y,this.bbox.max.y+=a.paper_offset_y);var m=0;for(var g in this.layersMap[0]=m++,e.layers){var v=parseInt(g);this.layersMap[v]=m++}if(this.layerCount=m,this.createLayerGroups(e.layers),e.geom_metrics){var y=Object.keys(e.geom_metrics).map((function(t){return e.geom_metrics[t]}));this.geomMetricsSum=y.reduce(((e,t)=>e+t))}}this.hidePaper=this.hidePaper||n.modelSpace,this.noShadow=!!n.noShadow,this.hasPageShadow=!1,this.opCount=0,this.excludeTextGeometry=n.excludeTextGeometry,this.extendStringsFetching=n.extendStringsFetching,this.fontFaces=[],this.fontFamilies=[],this.viewports=[{}],this.currentVpId=0,this.viewports[0].geom_metrics=this.currentGeomMetrics={arcs:0,circles:0,circ_arcs:0,viewports:0,clips:0,colors:0,db_ids:0,dots:0,fills:0,layers:0,line_caps:0,line_joins:0,line_patterns:0,line_pat_refs:0,plines:0,pline_points:0,line_weights:0,links:0,miters:0,ptris:0,ptri_indices:0,ptri_points:0,rasters:0,texts:0,strings:[]},this.clips=[0],this.strings=[],this.stringDbIds=[],this.stringBoxes=[],this.extendStringsFetching&&(this.stringCharWidths=[],this.stringAngles=[],this.stringPositions=[],this.stringHeights=[]),this.currentStringNumber=-1,this.currentStringBox=new yc,this.linkBoxes=[],this.currentLinkBox=new yc,this.objectNumber=0,this.currentFakeId=-2,this.imageNumber=0,this.linkNumber=0,this.maxObjectNumber=0,this.objectStack=[],this.objectNameStack=[],this.parseObjState={polyTriangle:{},viewport:{},clip:{},raster:{},text:{},fontDef:{},uknown:{}},this.layer=0,this.bgColor="number"==typeof n.bgColor?n.bgColor:4294967295,this.contrastColor=this.color=this.fillColor=4278190080,this.hidePaper&&(this.contrastColor=4294967040),this.isMobile=n&&!!n.isMobile;var b=this.isMobile,x=this.isMobile;if(this.max_vcount=this.isMobile?PL:void 0,this.currentVbb=new cf(b,void 0,this.max_vcount,x),this.meshes=[],this.numCircles=this.numEllipses=this.numPolylines=this.numLineSegs=0,this.numPolytriangles=this.numTriangles=0,this.error=!1,this.offsetX=0,this.offsetY=0,t){this.manifestAvailable=!0,this.imageId2URI={};for(var _=t.assets,E=0,S=_.length;E<S;++E){var A=_[E];if(-1!==A.mime.indexOf("image/")){var w=A.id;w=w.substr(0,w.indexOf(".")),this.imageId2URI[w]=i+A.URI}"Autodesk.CloudPlatform.PropertyAttributes"===A.type&&this.propertydb.attrs.push({path:A.URI}),"Autodesk.CloudPlatform.PropertyValues"===A.type&&this.propertydb.values.push({path:A.URI}),"Autodesk.CloudPlatform.PropertyIDs"===A.type&&this.propertydb.ids.push({path:A.URI}),"Autodesk.CloudPlatform.PropertyViewables"===A.type&&this.propertydb.viewables.push({path:A.URI}),"Autodesk.CloudPlatform.PropertyOffsets"===A.type&&-1===A.id.indexOf("rcv")&&this.propertydb.offsets.push({path:A.URI}),"Autodesk.CloudPlatform.PropertyAVs"===A.type&&this.propertydb.avs.push({path:A.URI})}}}BL.prototype.load=function(e,t){if(t instanceof Uint8Array||(t=new Uint8Array(t)),this.data=t,this.parse(),this.stringBoxes.length){var i=new Float32Array(this.stringBoxes.length);i.set(this.stringBoxes),this.stringBoxes=i}e.loadDoneCB(!0)},BL.prototype.loadFrames=function(e){this.loadContext=e;var t=e.data;if(t)t instanceof Uint8Array||(t=new Uint8Array(t)),this.data=t;else if(e.finalFrame&&(this.data=null,this.stringBoxes.length)){var i=new Float32Array(this.stringBoxes.length);i.set(this.stringBoxes),this.stringBoxes=i}this.parseFrames(e.finalFrame),e.loadDoneCB(!0)},BL.prototype.pushMesh=function(e){this.meshes.push(e),e.material={skipEllipticals:!this.currentVbb.numEllipticals,skipCircles:!this.currentVbb.numCirculars,skipTriangleGeoms:!this.currentVbb.numTriangleGeoms,skipMiterLines:!this.currentVbb.numMiterLines,useInstancing:this.currentVbb.useInstancing,unpackPositions:!!e.unpackXform},this.currentImage&&(e.material.image=this.currentImage,e.material.image.name=this.imageNumber++,this.currentImage=null)},BL.prototype.flushBuffer=function(e,t){if(this.currentVbb.vcount||t){var i=t;if(i=i||this.currentVbb.isFull(e)){if(this.currentVbb.vcount){var n=this.currentVbb.toMesh();IL(this.bbox,n.boundingBox),this.pushMesh(n),this.currentVbb.reset(0)}this.loadContext&&this.loadContext.loadDoneCB(!0,t)}}},BL.prototype.tx=function(e){return this.sx(e)},BL.prototype.ty=function(e){return this.sy(e)},BL.prototype.sx=function(e){return e*this.scaleX},BL.prototype.sy=function(e){return e*this.scaleY},BL.prototype.invertColor=function(e){var t=e>>16&255,i=e>>8&255,n=255&e;return(e>>24&255)<<24|(t=255-t)<<16|(i=255-i)<<8|(n=255-n)},BL.prototype.mapColor=function(e,t){if(!this.hidePaper||0!==this.bgColor)return e;var i=255&e;return i<127||i===(65280&e)>>8&&i===(16711680&e)>>16&&t&&(e&=1442840575),e},BL.prototype.parsePointPositions=function(){var e=this.stream.getVarints(),t=this.stream.getVarints();return e=OL(e),t=OL(t),e+=this.offsetX,t+=this.offsetY,this.offsetX=e,this.offsetY=t,[this.tx(e),this.ty(t)]},BL.prototype.parserAssert=function(e,t,i){return e!=t&&(rt.warn("Expect "+t+"; actual type is "+e+"; in function "+i),this.error=!0,!0)},BL.prototype.unhandledTypeWarning=function(e,t){rt.warn("Unhandled semantic type : "+t+" in function "+e)},BL.prototype.parseObject=function(){var e=this.stream.getVarints();switch(this.objectStack.push(e),e){case RL.st_sheet:this.objectNameStack.push("sheet"),this.objectMemberQueue.unshift("paperColor");break;case RL.st_viewport:this.objectNameStack.push("viewport"),this.objectMemberQueue.unshift("units","transform");break;case RL.st_clip:this.objectNameStack.push("clip"),this.objectMemberQueue.unshift("contourCounts","points","indices");break;case RL.st_polytriangle:this.objectNameStack.push("polyTriangle"),this.objectMemberQueue.unshift("points","indices","colors");break;case RL.st_raster:this.objectNameStack.push("raster"),this.objectMemberQueue.unshift("position","width","height","imageId");break;case RL.st_text:this.currentStringNumber=this.strings.length,0===this.objectNumber&&(this.objectNumber=this.currentFakeId--),this.currentStringBox.makeEmpty(),this.objectNameStack.push("text"),this.objectMemberQueue.unshift("string","position","height","widthScale","rotation","oblique","charWidths");break;case RL.st_font_def:this.objectNameStack.push("fontDef"),this.objectMemberQueue.unshift("name","fullName","flags","spacing","panose");break;case RL.st_end_object:if(this.objectStack.pop(),this.objectStack.length){switch(this.objectStack.pop()){case RL.st_polytriangle:this.actOnPolyTriangle();break;case RL.st_viewport:this.actOnViewport();break;case RL.st_clip:this.actOnClip();break;case RL.st_raster:this.actOnRaster();break;case RL.st_text:this.actOnText();break;case RL.st_font_def:this.actOnFontDef()}var t=this.objectNameStack.pop(),i=this.parseObjState[t];for(var n in i)i[n]=null}else this.parserAssert(0,1,"parseEndObject (Stack Empty)");this.objectMemberQueue.length=0;break;default:this.objectNameStack.push("unknown"),this.error=!0,this.unhandledTypeWarning("parseObject",e)}},BL.prototype.initSheet=function(e){if(!this.hidePaper&&(this.bgColor=e,this.metadata)){var t=this.paperWidth,i=this.paperHeight,n={x:0,y:0},r={x:t,y:0},o={x:0,y:i},s=this.metadata.page_dimensions||{};if(isFinite(s.paper_rotation)&&0!==s.paper_rotation){var a=s.paper_rotation*Math.PI/180,l=Math.cos(a),c=Math.sin(a);r.y=t*c,r.x=t*l,o.x=-i*c,o.y=i*l}isFinite(s.paper_offset_x)&&0!==s.paper_offset_x&&(n.x=s.paper_offset_x),isFinite(s.paper_offset_y)&&0!==s.paper_offset_y&&(n.y=s.paper_offset_y);var u=this.currentVbb,h=[n.x,n.y,n.x+r.x,n.y+r.y,n.x+r.x+o.x,n.y+r.y+o.y,n.x+o.x,n.y+o.y],d=[e,e,e,e],f=[0,1,2,0,2,3];if(!this.noShadow){var p=t*DL,m={x:r.x*p/t,y:r.y*p/t},g={x:o.x*p/i,y:o.y*p/i},v={x:n.x+m.x,y:n.y+m.y},y={x:n.x+r.x,y:n.y+r.y},b=4283782485;h=h.concat([v.x-g.x,v.y-g.y,v.x-g.x+r.x,v.y-g.y+r.y,v.x+r.x,v.y+r.y,v.x,v.y,y.x,y.y,y.x+m.x,y.y+m.y,y.x+m.x-g.x+o.x,y.y+m.y-g.y+o.y,y.x-g.x+o.x,y.y-g.y+o.y]),d=d.concat([b,b,b,b,b,b,b,b]),f=f.concat([4,5,6,4,6,7,8,9,10,8,10,11]),this.hasPageShadow=!0}this.addPolyTriangle(h,d,f,4294967295,-1,0,!1),u.addSegment(n.x,n.y,n.x+r.x,n.y+r.y,0,1e-6,4278190080,-1,0,this.currentVpId),u.addSegment(n.x+r.x,n.y+r.y,n.x+r.x+o.x,n.y+r.y+o.y,0,1e-6,4278190080,-1,0,this.currentVpId),u.addSegment(n.x+r.x+o.x,n.y+r.y+o.y,n.x+o.x,n.y+o.y,0,1e-6,4278190080,-1,0,this.currentVpId),u.addSegment(n.x+o.x,n.y+o.y,n.x,n.y,0,1e-6,4278190080,-1,0,this.currentVpId)}},BL.prototype.setObjectMember=function(e){if(!this.objectMemberQueue.length)return rt.warn("Unexpected object member. "+e+" on object "+this.objectNameStack[this.objectNameStack.length-1]),!1;var t=this.objectMemberQueue.shift(),i=this.objectNameStack[this.objectNameStack.length-1];return"sheet"==i&&"paperColor"==t?(this.initSheet(e),!0):!!i&&(this.parseObjState[i][t]=e,!0)},BL.prototype.parseString=function(){var e=this.stream,t=e.getVarints(),i=e.getVarints(),n=e.getString(i);if(t===RL.st_object_member){if(this.setObjectMember(n))return}else rt.info("Unexpected opcode semantic type for string.");return n},BL.prototype.actOnFontDef=function(){var e=this.parseObjState.fontDef;this.fontDefs[++this.fontCount]=e,this.fontId=this.fontCount},BL.prototype.parsePoint=function(){var e=this.stream.getVarints(),t=this.parsePointPositions();if(e===RL.st_object_member){if(this.setObjectMember(t))return}else rt.info("Unexpected opcode semantic type for point.");return t},BL.prototype.parsePointsArray=function(){var e=this.stream,t=e.getVarints(),i=e.getVarints();if(i){i/=2;for(var n,r=[],o=0;o<i;++o)n=this.parsePointPositions(),r.push(n[0]),r.push(n[1]);switch(t){case RL.st_polyline:return void this.actOnPolylinePointsArray(r);case RL.st_dot:return void this.actOnDot(r);case RL.st_object_member:if(this.setObjectMember(r))return;break;default:rt.info("Unexpected opcode semantic type for points array.")}return r}},BL.prototype.parseIntArray=function(){for(var e=this.stream,t=e.getVarints(),i=e.getVarints(),n=[],r=0;r<i;++r)n.push(e.getUint32());if(t===RL.st_object_member){if(this.setObjectMember(n))return}else this.unhandledTypeWarning("parseIntArray",t);return n},BL.prototype.parseDoubleArray=function(){for(var e=this.stream,t=e.getVarints(),i=e.getVarints(),n=[],r=0;r<i;++r)n.push(e.getFloat64());if(t===RL.st_object_member){if(this.setObjectMember(n))return}else this.unhandledTypeWarning("parseDoubleArray",t);return n},BL.prototype.parseByteArray=function(){for(var e=this.stream,t=e.getVarints(),i=e.getVarints(),n=[],r=0;r<i;++r)n.push(e.getUint8());if(t===RL.st_object_member){if(this.setObjectMember(n))return}else this.unhandledTypeWarning("parseByteArray",t);return n},BL.prototype.parseVarintArray=function(){for(var e=this.stream,t=e.getVarints(),i=[],n=e.getVarints(),r=0;r<n;++r)i.push(e.getVarints());if(t===RL.st_object_member){if(this.setObjectMember(i))return}else this.unhandledTypeWarning("parseVarIntArray",t);return i},BL.prototype.parseInt=function(){var e=this.stream,t=e.getVarints(),i=e.getUint32();switch(t){case RL.st_color:this.color=this.mapColor(i,!1),this.currentGeomMetrics.colors++;break;case RL.st_fill:this.fill=!0,this.fillColor=this.mapColor(i,!0),this.currentGeomMetrics.fills++;break;case RL.st_object_member:if(this.setObjectMember(i))return;default:this.unhandledTypeWarning("parseInt",t)}return i},BL.prototype.parseVoid=function(){var e=this.stream.getVarints();if(e===RL.st_fill_off)this.fill=!1,this.currentGeomMetrics.fills++;else this.unhandledTypeWarning("parseVoid",e)},BL.prototype.parseVarint=function(){var e=this.stream,t=e.getVarints(),i=e.getVarints();switch(t){case RL.st_line_weight:this.lineWeight=this.tx(i),this.currentGeomMetrics.line_weights++;break;case RL.st_line_caps:this.currentGeomMetrics.line_caps++;break;case RL.st_line_join:this.currentGeomMetrics.line_joins++;break;case RL.st_object_id:case RL.st_markup_id:this.objectNumber=i,this.maxObjectNumber=Math.max(this.maxObjectNumber,i),this.currentGeomMetrics.db_ids++;break;case RL.st_link:this.linkNumber&&(this.linkBoxes[this.linkNumber]=this.currentLinkBox.clone(),this.currentLinkBox.makeEmpty()),this.linkNumber=i;break;case RL.st_layer:this.currentGeomMetrics.layers++,this.layer=this.layersMap[i];break;case RL.st_font_ref:this.fontId=i;break;case RL.st_object_member:if(this.setObjectMember(i))return}return i},BL.prototype.parseFloat=function(){var e=this.stream,t=e.getVarints(),i=e.getFloat32();switch(t){case RL.st_miter_angle:case RL.st_miter_length:break;case RL.st_object_member:if(this.setObjectMember(i))return}return i},BL.prototype.parseCircularArc=function(){var e=this.stream,t=e.getVarints();if(!this.parserAssert(t,RL.st_arc,"parseCircularArc")){var i=this.parsePointPositions(),n=e.getVarints(),r=e.getFloat32(),o=e.getFloat32();this.actOnCircularArc(i[0],i[1],r,o,this.sx(n))}},BL.prototype.parseCircle=function(){var e=this.stream,t=e.getVarints();if(!this.parserAssert(t,RL.st_arc,"parseCircle")){var i=this.parsePointPositions(),n=e.getVarints();this.actOnCompleteCircle(i[0],i[1],this.sx(n))}},BL.prototype.parseArc=function(){var e=this.stream,t=e.getVarints();if(!this.parserAssert(t,RL.st_arc,"parseArc")){var i=this.parsePointPositions(),n=e.getVarints(),r=e.getVarints(),o=e.getFloat32(),s=e.getFloat32(),a=e.getFloat32();this.actOnArc(i[0],i[1],s,a,this.sx(n),this.sy(r),o)}},BL.prototype.parseDataType=function(){var e=this.stream.getVarints();switch(e){case LL.dt_void:this.parseVoid();break;case LL.dt_int:this.parseInt();break;case LL.dt_object:this.parseObject();break;case LL.dt_varint:this.parseVarint();break;case LL.dt_point_varint:this.parsePoint();break;case LL.dt_float:this.parseFloat();break;case LL.dt_point_varint_array:this.parsePointsArray();break;case LL.dt_circular_arc:this.parseCircularArc();break;case LL.dt_circle:this.parseCircle();break;case LL.dt_arc:this.parseArc();break;case LL.dt_int_array:this.parseIntArray();break;case LL.dt_varint_array:this.parseVarintArray();break;case LL.dt_byte_array:this.parseByteArray();break;case LL.dt_string:this.parseString();break;case LL.dt_double_array:this.parseDoubleArray();break;default:this.error=!0,rt.info("Data type not supported yet: "+e)}},BL.prototype.readHeader=function(){var e=this.stream=new xp(this.data),t=e.getString(3);if("F2D"!==t)return rt.error("Invalid F2D header : "+t,at(st.BAD_DATA)),!1;var i=e.getString(2);if("01"!==i)return rt.error("Only support f2d major version 1; actual version is : "+i,at(st.BAD_DATA)),!1;if("."!==e.getString(1))return rt.error("Invalid version delimiter.",at(st.BAD_DATA)),!1;e.getString(2);return!0},BL.prototype.parse=function(){if(this.readHeader()){for(var e=this.stream;e.offset<e.byteLength&&(this.parseDataType(),!this.error);)this.opCount++;this.linkNumber&&(this.linkBoxes[this.linkNumber]=this.currentLinkBox.clone(),this.currentLinkBox.makeEmpty()),this.flushBuffer(0,!0),this.currentVbb=null,this.stream=null,this.data=null,rt.info("F2d parse: data types count : "+this.opCount)}},BL.prototype.parseFrames=function(e){if(this.data)for(var t=this.stream=new xp(this.data);t.offset<t.byteLength&&(this.parseDataType(),!this.error);)this.opCount++;else e||rt.warn("Unexpected F2D parse state: If there is no data, we only expect a flush command, but flush was false.");e&&this.flushBuffer(0,!0),this.stream=null,this.data=null},BL.prototype.actOnPolylinePointsArray=function(e){this.flushBuffer();for(var t=e.length/2,i=0,n=e[0],r=e[1],o=1;o<t;++o){var s=e[2*o],a=e[2*o+1];this.currentVbb.addSegment(n,r,s,a,i,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId),i+=Math.sqrt((s-n)*(s-n)+(a-r)*(a-r)),n=s,r=a}this.numPolylines++,this.numLineSegs+=t-1,this.currentGeomMetrics.plines++,this.currentGeomMetrics.pline_points+=t-1},BL.prototype.actOnDot=function(e){this.currentGeomMetrics.dots++;var t=e[0],i=e[1];this.actOnCompleteCircle(t,i,this.sx(1),!0)},BL.prototype.actOnCompleteCircle=function(e,t,i,n){this.flushBuffer(),this.numCircles++,n||this.currentGeomMetrics.circles++,this.fill?this.currentVbb.addSegment(e,t,e,t,0,2*i,this.color,this.objectNumber,this.layer,this.currentVpId):this.currentVbb.addArc(e,t,0,2*Math.PI,i,i,0,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},BL.prototype.actOnCircularArc=function(e,t,i,n,r){this.numCircles++,this.currentGeomMetrics.circ_arcs++,this.flushBuffer(),this.currentVbb.addArc(e,t,i,n,r,r,0,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},BL.prototype.actOnArc=function(e,t,i,n,r,o,s){this.numEllipses++,this.currentGeomMetrics.arcs++,this.flushBuffer(),this.currentVbb.addArc(e,t,i,n,r,o,s,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},BL.prototype.actOnRaster=function(){if(this.manifestAvailable){this.flushBuffer(4,!0);var e=this.parseObjState.raster,t=e.position,i=e.imageId,n=this.imageId2URI[i],r=this.sx(e.width),o=this.sy(e.height),s=t[0]+.5*r,a=t[1]-.5*o;this.currentVbb.addTexturedQuad(s,a,r,o,0,4278255615,this.objectNumber,this.layer,this.currentVpId),this.currentImage={dataURI:n},this.flushBuffer(0,!0),this.currentGeomMetrics.rasters++}},BL.prototype.actOnClip=function(){var e=this.parseObjState.clip;this.parseObjState.clip={},this.clips.push(e),this.currentGeomMetrics.clips++},BL.prototype.actOnText=function(){this.strings[this.currentStringNumber]=this.parseObjState.text.string,this.currentGeomMetrics.texts++,this.currentGeomMetrics.strings.push(this.parseObjState.text.string),this.stringDbIds[this.currentStringNumber]=this.objectNumber,this.stringBoxes.push(this.currentStringBox.min.x,this.currentStringBox.min.y,this.currentStringBox.max.x,this.currentStringBox.max.y),this.extendStringsFetching&&(this.stringCharWidths.push(this.parseObjState.text.charWidths),this.stringAngles.push(this.parseObjState.text.rotation),this.stringPositions.push(this.parseObjState.text.position),this.stringHeights.push(this.parseObjState.text.height)),this.currentStringBox.makeEmpty(),this.currentStringNumber=-1,this.objectNumber<-1&&(this.objectNumber=0)};var NL=new rl;function UL(e,t){let i,n=0,r=e.length-1;for(;n<=r;){if(i=(n+r)/2|0,t===e[i])return i;t<e[i]?r=i-1:n=i+1}return-1}function kL(e){var t,i,n,r,o,s,a,l,c,u,h,d,f,p,m,g,v,y=this,b=!1,x=!1;let _={};for(var E in e.attrs){"pdb version 2"===(t=pt(e.attrs[E]))[0]&&(b=!0);for(var S=1;S<t.length;S++){if("Layer"===t[S][0])m=S;switch(t[S][1]){case"__parent__":c=S;break;case"__child__":l=S;break;case"__name__":u=S;break;case"__instanceof__":h=S;break;case"__viewable_in__":d=S;break;case"__externalref__":f=S;break;case"__node_flags__":p=S}b&&t[S][2]===Ey.DbKey&&(t[S][6]=t[S][6]|Sy.afDirectStorage)}break}for(let t in e.avs){let i=e.avs[t];i[0]==="[".charCodeAt(0)?n=gt(e.avs[t],0):(n=i,x=!0),delete e.avs;break}for(let t in e.offsets){let r=e.offsets[t];r[0]==="[".charCodeAt(0)?(i=gt(r,1))[i.length-1]=n.length/2:i=new Int32Array(r.buffer,r.byteOffset,r.byteLength/4),delete e.offsets;break}for(let t in e.values){r=e.values[t],o=vt(r);break}this.setIdsBlob=function(e){s=e,a=vt(e)};for(let t in e.ids){this.setIdsBlob(e.ids[t]);break}function A(e){for(var t={},i=0,n=e.length;i<n;i++){var r=e[i];Array.isArray(r)||(r=[r]);for(var o=0;o<r.length;o++){var s=r[o],a=t[s];void 0===a?t[s]=i:Array.isArray(a)?a.push(i):t[s]=[a,i]}}return t}this.getObjectCount=function(){return i.length-1},this.getValueAt=function(e){return mt(r,o[e])},this.getIntValueAt=function(e){return function(e,t){var i=0,n=t;for(34==e[n]&&n++;n<e.length-1;){var r=e[n];if(44==r&&(10==e[n+1]||13==e[n+1]))break;if(10==r||13==r||34==r)break;r>=48&&r<=57&&(i=10*i+(r-48)),n++}return i}(r,o[e])},this.getIdAt=function(e){return mt(s,a[e])},this.externalIdsLoaded=function(){return Boolean(s)},this.getAttrValue=function(e,i,n){var r=t[e];return r[6]&Sy.afDirectStorage&&r[2]===Ey.DbKey?i:n?this.getIntValueAt(i):this.getValueAt(i)},this._getObjectProperty=function(e,i){var n=t[e],r=n[5]?n[5]:n[0],o=this.attributeHidden(e);return{displayName:r,displayValue:y.getAttrValue(e,i),displayCategory:n[1],attributeName:n[0],type:n[2],units:n[3],hidden:o,precision:n[7]||0}},this.getObjectProperties=function(e,i,n,r,o){var s={dbId:e,properties:[]},a=!1,l=i&&-1!==i.indexOf("externalId"),c=this.externalIdsLoaded();l&&!c&&console.error("Requesting externalID requires loading of the externalID table");var d=c&&(!i||l);if(d&&(s.externalId=this.getIdAt(e),i&&1===i.length))return s;var f=null;if(this.enumObjectProperties(e,(function(e,l){if(e!=h){var c=t[e];if(!(i&&-1===i.indexOf(c[0])&&-1===i.indexOf(c[5])||o&&-1===o.indexOf(c[1])||r&&(r.indexOf(c[0])>-1||r.indexOf(c[5])>-1)))if(e==u){var d=y.getAttrValue(e,l);a=!0,s.name=d}else{var p=y.attributeHidden(e);if(n&&p)return;var m=y._getObjectProperty(e,l);s.properties.push(m)}}else{var g=y.getObjectProperties(y.getAttrValue(e,l),i,!0,r,o);g&&g.properties&&(f=g)}})),f){var p={},m=s.properties;for(let e=0;e<m.length;e++)p[m[e].displayName]=1;s.name||(s.name=f.name);var g=f.properties;for(let e=0;e<g.length;e++)Object.prototype.hasOwnProperty.call(p,g[e].displayName)||m.push(g[e])}return o&&!s.properties.length?null:!i||s.properties.length||d||a?s:null},this.getExternalIdMapping=function(e){var t={};if(a&&"length"in a)for(var i=1,n=a.length;i<n;++i){var r=this.getIdAt(i);e&&!0!==e[r]||(t[r]=i)}return t},this.findRootNodes=function(){var e=[],t=[];return this.enumObjects((function(i){var n=!1,r=!1,o=!1;y.enumObjectProperties(i,(function(e,t){e==c?y.getAttrValue(e,t,!0)&&(r=!0):e==l?n=!0:e==u&&(o=!0)})),o&&!r&&(n?e.push(i):t.push(i))})),e.length>0?e:t},this.nodeHasChild=function(e){let t=!1;return this.enumObjectProperties(e,(function(e){if(e===l)return t=!0,!0})),t},this.getNodeNameAndChildren=function(e,t){var i,n,r=e.dbId;if(this.enumObjectProperties(r,(function(r,o){var s;if(r===c);else if(r!=l||t)r===u?e.name=y.getAttrValue(r,o):r===p?e.flags=y.getAttrValue(r,o,!0):r===h&&(n=o);else if((s=y.getAttrValue(r,o,!0))!==e.dbId){var a={dbId:s,parent:e.dbId};i?i.push(a):i=[a]}})),(!e.name||!e.flags)&&n){const t=y.getAttrValue(h,n,!0);let i=_[t];i||(_[t]=i={dbId:t,name:null,flags:null},y.getNodeNameAndChildren(i,!0)),i.name&&!e.name&&(e.name=i.name),"number"!=typeof e.flags&&"number"==typeof i.flags&&(e.flags=i.flags)}return i},this.buildDbIdToFragMap=A;this.buildObjectTree=function(e,t,i,n){var r;t&&(r=A(t)),g={},v=0;var o=this.buildObjectTreeRec(e,0,r,0,i,n);return v>0&&console.warn("Property database integrity not guaranteed ("+v+")."),g=null,_={},o},this.buildObjectTreeRec=function(e,t,i,n,r,o){if(g[e])return v++,0;g[e]=t||e,n>r[0]&&(r[0]=n);var s,a={dbId:e},l=this.getNodeNameAndChildren(a),c=[];if(l)for(var u=0;u<l.length;u++){this.buildObjectTreeRec(l[u].dbId,e,i,n+1,r,o)&&c.push(l[u].dbId)}if(i){var h=i[e];void 0!==h&&(s=Array.isArray(h)?h:[h])}var d=a.flags||0;void 0===d&&(d=s&&s.length?6:(c.length,0));var f=c.length+(s?s.length:0);return f&&o.setNode(e,t,a.name,d,c,s),f},this.getSearchTerms=function(e){for(var t=(e=e.toLowerCase()).match(/"[^"]+"|[^\s]+/g)||[],i=t.length;i--;)t[i]=t[i].replace(/"/g,"");var n=[];for(i=0;i<t.length;i++)t[i].length>1&&n.push(t[i]);return n},this.bruteForceSearch=function(e,i,n){const r=this.getSearchTerms(e);if(0===r.length)return[];var s=[];const a=null==n?void 0:n.searchHidden,l=null==n?void 0:n.includeInherited,c={};for(let e=0;e<r.length;e++){for(var u=[],d=[],f=0,p=o.length;f<p;f++){var m=this.getValueAt(f);null!==m&&(-1!==m.toString().toLowerCase().indexOf(r[e])&&d.push(f))}0!==d.length?(d.sort((function(e,t){return e-t})),this.enumObjects((function(e){y.enumObjectProperties(e,(function(n,r){if(l&&n===h){const t=parseInt(y.getAttrValue(n,r));c[t]=c[t]||[],c[t].push(e)}if(!a&&y.attributeHidden(n))return;if(-1!==UL(d,r)){if(i&&i.length&&-1===i.indexOf(t[n][0]))return;return u.push(e),!0}}))})),s.push(u)):s.push(u)}const g=(e,t)=>{const i=new Set(e);for(let n=0;n<e.length;++n){const r=e[n];if(!(r in t))continue;const o=t[r];for(let t=0;t<o.length;++t){const n=o[t];i.has(n)||(e.push(n),i.add(n))}}};if(1===s.length)return l&&g(s[0],c),s[0];var v={},b=s[0];for(let e=0;e<b.length;e++)v[b[e]]=1;for(let e=1;e<s.length;e++){b=s[e];var x={};for(let e=0;e<b.length;e++)1===v[b[e]]&&(x[b[e]]=1);v=x}u=[];for(let e in v)u.push(parseInt(e));return l&&g(u,c),u},this.bruteForceFind=function(e){var i=[];return this.enumObjects((function(n){var r=!1;y.enumObjectProperties(n,(function(i){var n=t[i],o=n[0],s=n[5];if(o===e||s===e)return r=!0,!0})),r&&i.push(n)})),i},this.getLayerToNodeIdMapping=function(){var e={};return this.enumObjects((function(t){y.enumObjectProperties(t,(function(i,n){if(i==m){var r=y.getAttrValue(i,n);return Array.isArray(e[r])||(e[r]=[]),e[r].push(t),!0}}))})),e},this.getAttributeDef=function(e){var i=t[e];return{name:i[0],category:i[1],dataType:i[2],dataTypeContext:i[3],description:i[4],displayName:i[5],flags:i[6],precision:i.length>7?i[7]:0}},this.enumAttributes=function(e){for(var i=1;i<t.length&&!e(i,this.getAttributeDef(i),t[i]);i++);},this.enumObjectProperties=x?function(e,t){let r=i[e],o=i[e+1],s=n,a=0;for(;r<o;){let e=s[r++],i=127&e,n=7;for(;128&e;)e=s[r++],i|=(127&e)<<n,n+=7;for(a+=i,e=s[r++],i=127&e,n=7;128&e;)e=s[r++],i|=(127&e)<<n,n+=7;if(t(a,i))break}}:function(e,t){let r=2*i[e],o=2*i[e+1];for(let e=r;e<o;e+=2){if(t(n[e],n[e+1]))break}};let w={};function C(e,t,r){let o=i[e],s=i[e+1],a=n,l=[],c=[];r=r||{};let u=0;for(;o<s;){let e=a[o++],i=127&e,n=7;for(;128&e;)e=a[o++],i|=(127&e)<<n,n+=7;for(u+=i,e=a[o++],i=127&e,n=7;128&e;)e=a[o++],i|=(127&e)<<n,n+=7;if(u===h){let e=y.getAttrValue(u,i);c.push(e)}else t&&!t[u]||(r[u]=i,l.push(u),l.push(i))}for(let e=0;e<c.length;e++){let i=c[e],n=w[i];n||(w[i]=n=C(i));for(let e=0;e<n.length;e+=2){let i=n[e],o=n[e+1];t&&!t[i]||(r[i]||y.attributeHidden(i)||(r[i]=o,l.push(i),l.push(o)))}}return l}this.getPropertiesSubsetWithInheritance=x?C:function(e,t,r){let o=2*i[e],s=2*i[e+1],a=[],l=[];r=r||{};for(let e=o;e<s;e+=2){let i=n[e],o=n[e+1];if(i===h){let e=y.getAttrValue(i,o);l.push(e)}else t&&!t[i]||(r[i]=o,a.push(i),a.push(o))}for(let e=0;e<l.length;e++){let i=l[e],n=w[i];n||(w[i]=n=C(i));for(let e=0;e<n.length;e+=2){let i=n[e],o=n[e+1];t&&!t[i]||(r[i]||y.attributeHidden(i)||(r[i]=o,a.push(i),a.push(o)))}}return a},this.findLayers=function(){var e={name:"root",id:1,index:1,children:[],isLayer:!1,childCount:0};if(void 0===m)return e;var t=[],i=this;return this.enumObjects((function(e){i.enumObjectProperties(e,(function(e,n){if(e===m){var r=i.getValueAt(n);return r&&-1===t.indexOf(r)&&t.push(r),!0}}))})),t.sort((function(e,t){return e.localeCompare(t,void 0,{sensitivity:"base",numeric:!0})})),e.childCount=t.length,e.children=t.map((function(e,t){return{name:e,index:t+1,id:t+1,isLayer:!0}})),e},this.enumObjects=function(e,t,n){var r=i.length-1;t="number"==typeof t?Math.max(t,1):1,n="number"==typeof n?Math.min(r,n):r;for(var o=t;o<n&&!e(o);o++);},this.getAttrChild=function(){return l},this.getAttrParent=function(){return c},this.getAttrName=function(){return u},this.getAttrLayers=function(){return m},this.getAttrInstanceOf=function(){return h},this.getAttrViewableIn=function(){return d},this.getAttrXref=function(){return f},this.getAttrNodeFlags=function(){return p},this.attributeHidden=function(e){return 1&t[e][6]||e==c||e==l||e==d||e==f},this._attributeIsBlacklisted=function(e){var i=t[e],n=i[0],r=i[1];return!(!Object.prototype.hasOwnProperty.call(wy,r)||-1===wy[r].indexOf(n))||!(!Object.prototype.hasOwnProperty.call(Ay,r)||-1===Ay[r].indexOf(n))},this._ignoreAttribute=function(e,i){var n=t[i],r=n[0],o=n[1];return e[o]&&e[o].has(r)},this.findParent=function(e){let t=null;return y.enumObjectProperties(e,(function(e,i){e===c&&(t=y.getAttrValue(e,i,!0))})),t},this._getAttributeAndValueIds=function(e,t,i){let n=this.getPropertiesSubsetWithInheritance(e),r=i&&Object.keys(i).length>=1;for(let e=0;e<n.length;e+=2){let o=n[e];this._attributeIsBlacklisted(o)||this.attributeHidden(o)||(r&&this._ignoreAttribute(i,o)||t.push({attrId:o,valId:n[e+1]}))}t.sort((function(e,t){return e.attrId-t.attrId}))},this.findDifferences=function(e,t,i){var n={changedIds:[]},r=t&&t.dbIds,o=t&&t.listPropChanges;o&&(n.propChanges=[]);let s=t&&t.propertyFilter||{};var a=this,l=e,c=[],u=[],h={result:[],dbId:-1},d={result:[],dbId:-1},f=function(e){var t=0,i=0;if(c.length=0,u.length=0,a._getAttributeAndValueIds(e,c,s,!0,h),l._getAttributeAndValueIds(e,u,s,!0,d),c.length&&u.length){for(var r=!1,f=void 0;t<c.length&&i<u.length;){var p=c[t],m=u[i],g=p&&p.attrId,v=p&&p.valId,b=m&&m.attrId,x=m&&m.valId;if(g!==b||v!==x){if(r=!0,!o)break;var _=void 0===b||b>g,E=void 0;void 0===g||g>b?((E=l._getObjectProperty(b,x)).displayValueB=E.displayValue,E.displayValue=void 0,i++):_?((E=a._getObjectProperty(g,v)).displayValueB=void 0,t++):((E=a._getObjectProperty(g,v)).displayValueB=y.getAttrValue(b,x),t++,i++),f||(f=[]),f.push(E)}else t++,i++}r&&(n.changedIds.push(e),o&&n.propChanges.push(f))}},p=-1,m=function(e,t){var n=Math.floor(100*e/t);n!=p&&(i&&i(n),p=n)};if(r)for(var g=0;g<r.length;g++){f(r[g]),m(g,r.length)}else{var v=Math.min(a.getObjectCount(),this.getObjectCount());for(let e=1;e<v;e++)f(e),m(e,v)}return n},this.numberOfAttributes=function(){var e;return(null===(e=t)||void 0===e?void 0:e.length)??0},this.numberOfValues=function(){var e;return(null===(e=o)||void 0===e?void 0:e.length)??0},this.dtor=function(){t=null,i=null,n=null,r=null,o=null,s=null,a=null,l=0,c=0,u=0,h=0,d=0,f=0,p=0}}
/*!
MIT License

Copyright (c) 2019 Fyrestar

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
function FL(e,t){for(let i in t){const n=t[i];if("@"===i[0]){const t=i.substr(1);e=e.replace(t,n)}else if("?"===i[0]){const t=i.substr(1);e=e.replace(t,n+"\n"+t)}else e=e.replace(i,i+"\n"+n)}return e}function VL(e,t){const i=(t.header||"")+"\n";let n=(t.vertexHeader||"")+"\n"+e.vertexShader,r=(t.fragmentHeader||"")+"\n"+e.fragmentShader;return t.vertexEnd&&(n=n.replace(/\}(?=[^\}]*$)/g,t.vertexEnd+"\n}")),t.fragmentEnd&&(r=r.replace(/\}(?=[^\}]*$)/g,t.fragmentEnd+"\n}")),void 0!==t.vertex&&(n=FL(n,t.vertex)),void 0!==t.fragment&&(r=FL(r,t.fragment)),e.vertexShader=i+n,e.fragmentShader=i+r,e}BL.prototype.addPolyTriangle=function(e,t,i,n,r,o,s){var a=this,l=null,c=-1;function u(e,t){if(e>t){var i=e;e=t,t=i}if(l[e]){var n=l[e],r=n.lastIndexOf(t);-1==r?n.push(t):n[r]=-1}else l[e]=[t]}function h(i,s){if(i>s){var u=i;i=s,s=u}var h=l[i];h&&(-1!=h.indexOf(s)&&(a.flushBuffer(4),a.currentVbb.addSegment(e[2*i],e[2*i+1],e[2*s],e[2*s+1],0,c,a.mapColor(t?t[i]:n,!0),r,o,a.currentVpId),t&&t[i]!=t[s]&&rt.warn("Gouraud triangle encountered. Will have incorrect antialiasing.")))}if(this.objectStack[this.objectStack.length-1]==RL.st_text&&(c=-.5),s){l=new Array(e.length/2);for(let e=0,t=i.length;e<t;e+=3){let t=i[e],n=i[e+1],r=i[e+2];u(t,n),u(n,r),u(r,t)}}if(-1!==this.currentStringNumber||this.linkNumber){let t=e.length/2;for(let i=0;i<t;++i)NL.set(e[2*i],e[2*i+1],0),-1!==this.currentStringNumber&&this.currentStringBox.expandByPoint(NL),this.linkNumber&&this.currentLinkBox.expandByPoint(NL)}if(this.currentVbb.useInstancing){let a=i.length;for(let l=0;l<a;l+=3){let a=i[l],c=i[l+1],u=i[l+2];this.flushBuffer(4),this.currentVbb.addTriangleGeom(e[2*a],e[2*a+1],e[2*c],e[2*c+1],e[2*u],e[2*u+1],this.mapColor(t?t[a]:n,!0),r,o,this.currentVpId),s&&(h(a,c),h(c,u),h(u,a))}}else{var d=e.length/2;this.flushBuffer(d);for(var f=this.currentVbb,p=f.vcount,m=0;m<d;++m){var g=e[2*m],v=e[2*m+1];f.addVertexPolytriangle(g,v,this.mapColor(t?t[m]:n,!0),r,o,this.currentVpId)}f.addIndices(i,p),s&&function(){for(var i=0,s=l.length;i<s;i++){var u=l[i];if(u)for(var h=0;h<u.length;h++){var d=u[h];-1!=d&&(a.flushBuffer(4),a.currentVbb.addSegment(e[2*i],e[2*i+1],e[2*d],e[2*d+1],0,c,a.mapColor(t?t[i]:n,!0),r,o,a.currentVpId),t&&t[i]!=t[d]&&rt.warn("Gouraud triangle encountered. Will have incorrect antialiasing."))}}}()}},BL.prototype.actOnPolyTriangle=function(){var e=this.parseObjState.polyTriangle;this.parseObjState.polyTriangle={};var t=e.points,i=e.indices,n=e.colors;if(t&&i){if(this.objectStack[this.objectStack.length-1]==RL.st_text){if(this.excludeTextGeometry)return}else this.currentGeomMetrics.ptris++,this.currentGeomMetrics.ptri_points+=t.length/2,this.currentGeomMetrics.ptri_indices+=i.length;this.numPolytriangles++,this.numTriangles+=i.length/3,this.addPolyTriangle(t,n,i,this.color,this.objectNumber,this.layer,!0)}else rt.warn("Malformed polytriangle.")},BL.prototype.actOnViewport=function(){var e=this.parseObjState.viewport;this.parseObjState.viewport={},e.geom_metrics=this.currentGeomMetrics={arcs:0,circles:0,circ_arcs:0,viewports:0,clips:0,colors:0,db_ids:0,dots:0,fills:0,layers:0,line_caps:0,line_joins:0,line_patterns:0,line_pat_refs:0,plines:0,pline_points:0,line_weights:0,links:0,miters:0,ptris:0,ptri_indices:0,ptri_points:0,rasters:0,texts:0,strings:[]},this.viewports.push(e),this.currentVpId=this.viewports.length-1},BL.prototype.createLayerGroups=function(e){var t=this.layersRoot={name:"root",id:"root",childrenByName:{},isLayer:!1},i=0,n=0;for(var r in e){var o=parseInt(r),s=e[r],a="string"==typeof s?s:s.name;a||(a=r);var l=a.split("|"),c=t;if(l.length>1)for(var u=0;u<l.length-1;++u){var h=l[u],d=c.childrenByName[h];d||(d={name:h,id:"group-"+i++,childrenByName:{},isLayer:!1},c.childrenByName[h]=d),c=d}c.childrenByName[a]={name:a,index:o,id:n++,childrenByName:{},isLayer:!0}}!function e(t){var i=Object.keys(t.childrenByName).map((function(e){return t.childrenByName[e]}));if(delete t.childrenByName,i.length){t.children=i,t.childCount=0;for(var n=0;n<i.length;++n)t.childCount+=e(i[n]);i.sort((function(e,t){return e.isLayer&&!t.isLayer?-1:!e.isLayer&&t.isLayer?1:e.name.localeCompare(t.name,void 0,{sensitivity:"base",numeric:!0})}))}return t.isLayer?1:t.childCount}(this.layersRoot)};var GL={};function zL(e,t,i,n){if(!e)return NaN;var r,o=(e=e.toString()).trim();if(0==o.length)return NaN;var s=i.join("| *"),a=n.join("| *");if(r=o.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+") *$")))return parseFloat(r[1])/parseFloat(r[2])/t;if(r=o.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+s+")? *$")))return parseFloat(r[1])/parseFloat(r[2]);var l;if(!(r=o.match(/^[+-]? *(?:\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?/i)))return NaN;if(l=parseFloat(r[0].replace(/ */g,"")),0==(o=(o=o.slice(r[0].length)).replace("-"," ")).length||isNaN(l))return l;var c=Math.sign(l);return 0===c&&(c=1),o.match(new RegExp("^(?: *)(?:"+a+") *$","i"))?l/t:(r=o.match(new RegExp("^ +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+") *$","i")))?(l+c*parseFloat(r[1])/parseFloat(r[2]))/t:(r=o.match(new RegExp("^(?: *)(?:"+s+"|-| +-?) *","i")))?0==(o=o.slice(r[0].length).trim()).length?r[0].match(/-/)?NaN:l:(r=o.match(new RegExp("^(\\d+(?:\\.\\d*)?)(?: *)(?:"+a+")? *$")))?l+c*parseFloat(r[1])/t:(r=o.match(new RegExp("^(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+")? *$")))?l+c*(parseFloat(r[1])/parseFloat(r[2]))/t:(r=o.match(new RegExp("^(\\d+) +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+")? *$")))?l+c*(parseFloat(r[1])+parseFloat(r[2])/parseFloat(r[3]))/t:NaN:NaN}GL.parseFeet=function(e){return zL(e,12,["ft","feet","'","`","",""],["in","inch",'\\"',"''","``","",""])},GL.parseMeter=function(e){return zL(e,100,["m","meter"],["cm","centimeter"])},GL.parseNumber=function(e,t){switch(t){case"ft":case"decimal-ft":case"ft-and-fractional-in":case"ft-and-decimal-in":case"decimal-in":case"fractional-in":return GL.parseFeet(e);default:return GL.parseMeter(e)}},GL.parsePositiveNumber=function(e,t){var i=GL.parseNumber(e,t);return i>=0?i:NaN};const HL={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2};function WL(e,t,i){this.root=e,this.handler=i.animationHandler,this.data=this.handler.init(t),this.hierarchy=this.handler.parse(e),this.viewer=i.viewer,this.animator=i,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=HL.LINEAR,this.setStartAndEndKeyTime()}function jL(e,t){function i(e,t,i,n,r,o,s){var a=.5*(i-e),l=.5*(n-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*r+t}var n,r,o,s,a,l,c,u,h,d=[],f=[];return o=(n=(e.length-1)*t)-(r=Math.floor(n)),d[0]=0===r?r:r-1,d[1]=r,d[2]=r>e.length-2?r:r+1,d[3]=r>e.length-3?r:r+2,l=e[d[0]],c=e[d[1]],u=e[d[2]],h=e[d[3]],a=o*(s=o*o),f[0]=i(l[0],c[0],u[0],h[0],o,s,a),f[1]=i(l[1],c[1],u[1],h[1],o,s,a),f[2]=i(l[2],c[2],u[2],h[2],o,s,a),f}function qL(){this.animations=[]}function KL(e,t,i){WL.call(this,e,t,i),this.localMatrix=new(v().Matrix4),this.root.getAnimTransform(),this.relativeTransform=!t.custom||!t.custom.transform||"abs"!==t.custom.transform}var XL,YL,QL,ZL,$L,JL;function eR(e,t,i){WL.call(this,e,t,i),this.followCam=!0}function tR(e,t,i){let n;WL.call(this,{},e,i),this.fragPointers=[],this.nodeChildren=[],this.nodeFragments=[];const r=this.viewer.model.getData().instanceTree;r.enumNodeChildren(t,(e=>{this.nodeChildren.push(e)}),!0),r.enumNodeFragments(e.id,(e=>{this.nodeFragments.push(e),n=this.viewer.getFragmentProxy(this.viewer.model,e),n&&(this.fragPointers.push(n),n.setMaterial(this.viewer.matman().cloneMaterial(n.getMaterial(),this.viewer.model)))}),!0),this.nodeId=t,this.epsilon=.1}function iR(e,t,i){var n=this;null===e&&(e=function(e,t,i){var r=this.getDocument(),o=n.container=r.createElement("div"),s=e.name;o.id=s,o.style.cursor="pointer",o.style.visibility=i;var a=r.createElement("div");a.id=s+"-txt",a.style.cssText="display: none;position: absolute;z-index: 1;",o.appendChild(a);var l=r.createElement("img"),c=e.custom&&e.custom.att&&1===e.custom.att;l.src=c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",l.id=s+"-img",l.style.cssText="display: block;position: absolute;z-index: 1;",o.appendChild(l),t.api.container.appendChild(o),o.addEventListener("click",(function(){a.style.display="none"===a.style.display?"block":"none"}));var u=new(v().SphereGeometry)(.01),h=new(v().MeshPhongMaterial)({color:32512,opacity:.6,transparent:!0}),d=new(v().Mesh)(u,h);return d.visible=!1,void 0===t.overlayScenes.annotation&&t.createOverlayScene("annotation"),t.addOverlay("annotation",d),d}.call(this,t,i.viewer,"hidden")),WL.call(this,e,t,i),this.id=t.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,(function(t){n.updateText(e.position,n.text)}))}function nR(e,t,i){this.viewer=i.viewer,null===e&&(e=this.createPolyline([])),WL.call(this,e,t,i),this.epsilon=.1}function rR(e,t){this.animations=[],this.viewer=e,this.setGlobalManager(e.globalManager),this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=t,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new qL,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2,this.followCam=!0,this._speedMod=1,this._loops=!1}fo.call(WL.prototype),WL.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var e=this.data.hierarchy[0].keys;this.startKeyTime=e[0].time,this.endKeyTime=e[e.length-1].time}else this.startKeyTime=this.endKeyTime=0},WL.prototype.keyTypes=[],WL.prototype.defaultKey={},WL.prototype.play=function(e){this.currentTime=void 0!==e?e:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},WL.prototype.pause=function(){!0===this.isPaused?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},WL.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},WL.prototype.goto=function(e){this.isPlaying||this.play(),this.isPaused||this.pause();var t=e-this.currentTime;this.update(t)},WL.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e];void 0===i.animationCache&&(i.animationCache={}),void 0===i.animationCache[this.data.name]&&(i.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:i.matrix});for(var n=i.animationCache[this.data.name],r=0;r<this.keyTypes.length;r++){for(var o=this.keyTypes[r],s=this.data.hierarchy[e].keys[0],a=this.getNextKeyWith(o,e,1);a.time<this.currentTime&&a.index>s.index;)s=a,a=this.getNextKeyWith(o,e,a.index+1);n.prevKey[o]=s,n.nextKey[o]=a}}this.setStartAndEndKeyTime()},WL.prototype.getNextKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(this.interpolationType===HL.CATMULLROM||this.interpolationType===HL.CATMULLROM_FORWARD?i=i<n.length-1?i:n.length-1:i%=n.length;i<n.length;i++)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[0]},WL.prototype.getPrevKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(i=this.interpolationType===HL.CATMULLROM||this.interpolationType===HL.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+n.length;i>=0;i--)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[n.length-1]},WL.prototype.isPlayingOutOfRange=function(){return!1===this.isPaused&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},WL.prototype.resetIfLooped=function(){!0===this.loop&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())},qL.prototype.init=function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof THREE.Quaternion)){var n=e.hierarchy[t].keys[i].rot;Array.isArray(n)||(n=[n._x,n._y,n._z,n._w]),e.hierarchy[t].keys[i].rot=(new THREE.Quaternion).fromArray(n)}for(let i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(let i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}return e.initialized=!0,e},qL.prototype.parse=function(e){var t=[];return function e(t,i){if(i.push(t),t.children&&!(t instanceof THREE.Camera))for(var n=0;n<t.children.length;n++)e(t.children[n],i)}(e,t),t},qL.prototype.play=function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},qL.prototype.stop=function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},qL.prototype.update=function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)},KL.prototype=Object.create(WL.prototype),KL.prototype.constructor=KL,KL.prototype.keyTypes=["pos","rot","scl"],KL.prototype.defaultKey={pos:0,rot:0,scl:0},KL.prototype.update=(XL=[],YL=new(v().Vector3),QL=new(v().Vector3),ZL=new(v().Quaternion),$L=new(v().Matrix4),JL=new(v().Matrix4),function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,i=this.hierarchy.length;t<i;t++){for(var n=this.hierarchy[t],r=n.animationCache[this.data.name],o=0;o<this.keyTypes.length;o++){var s=this.keyTypes[o],a=r.prevKey[s],l=r.nextKey[s];if(l.time<=this.currentTime||a.time>=this.currentTime){for(a=this.data.hierarchy[t].keys[0],l=this.getNextKeyWith(s,t,1);l.time<this.currentTime&&l.index>a.index;)a=l,l=this.getNextKeyWith(s,t,l.index+1);r.prevKey[s]=a,r.nextKey[s]=l}var c=a[s],u=l[s];if(l.time!==a.time&&void 0!==c&&void 0!==u){var h=(this.currentTime-a.time)/(l.time-a.time);if(h<0&&(h=0),h>1&&(h=1),"pos"===s)if(this.interpolationType===HL.LINEAR)QL.x=c[0]+(u[0]-c[0])*h,QL.y=c[1]+(u[1]-c[1])*h,QL.z=c[2]+(u[2]-c[2])*h,n.position.copy(QL);else{XL[0]=this.getPrevKeyWith("pos",t,a.index-1).pos,XL[1]=c,XL[2]=u,XL[3]=this.getNextKeyWith("pos",t,l.index+1).pos;var d=jL(XL,h=.33*h+.33);if(QL.x=d[0],QL.y=d[1],QL.z=d[2],n.position.copy(QL),this.interpolationType===HL.CATMULLROM_FORWARD){var f=jL(XL,1.01*h);YL.set(f[0],f[1],f[2]),YL.sub(vector),YL.y=0,YL.normalize();var p=Math.atan2(YL.x,YL.z);n.rotation.set(0,p,0)}}else"rot"===s?(ZL.slerpQuaternions(c,u,h),n.quaternion.copy(ZL)):"scl"===s&&(QL.x=c[0]+(u[0]-c[0])*h,QL.y=c[1]+(u[1]-c[1])*h,QL.z=c[2]+(u[2]-c[2])*h,n.scale.copy(QL))}}if(!this.relativeTransform){var m=$L.compose(n.position,n.quaternion,n.scale),g=JL;n.getOriginalWorldMatrix(g),g.invert(),$L.multiplyMatrices(m,g).decompose(n.position,n.quaternion,n.scale)}n.updateAnimTransform()}}),eR.prototype=Object.create(WL.prototype),eR.prototype.constructor=eR,eR.prototype.keyTypes=["pos","up","target","fov","perspective"],eR.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},eR.prototype.setFollowCamera=function(e){this.followCam=e},eR.prototype.update=function(){var e=[],t=new(v().Vector3),i=new(v().Vector3);return function(n){if(!1!==this.isPlaying&&(this.currentTime+=n*this.timeScale,this.resetIfLooped(),this.followCam&&!this.isPlayingOutOfRange())){for(var r=0,o=this.hierarchy.length;r<o;r++){for(var s=this.hierarchy[r],a=s.animationCache[this.data.name],l=0;l<this.keyTypes.length;l++){var c=this.keyTypes[l],u=a.prevKey[c],h=a.nextKey[c];if(h.time<=this.currentTime||u.time>=this.currentTime){for(u=this.data.hierarchy[r].keys[0],h=this.getNextKeyWith(c,r,1);h.time<this.currentTime&&h.index>u.index;)u=h,h=this.getNextKeyWith(c,r,h.index+1);a.prevKey[c]=u,a.nextKey[c]=h}var d=u[c],f=h[c];if(h.time!==u.time&&void 0!==d&&void 0!==f){var p,m=(this.currentTime-u.time)/(h.time-u.time);if(m<0&&(m=0),m>1&&(m=1),"pos"===c)p=s.position;else if("up"===c)p=s.up;else if("target"===c)p=s.target;else{if("fov"===c){s.setFov(d+(f-d)*m);continue}if("perspective"===c){(m>.5?f:d)?s.toPerspective():s.toOrthographic();continue}}if(this.interpolationType===HL.LINEAR)i.x=d[0]+(f[0]-d[0])*m,i.y=d[1]+(f[1]-d[1])*m,i.z=d[2]+(f[2]-d[2])*m,p.copy(i);else{e[0]=this.getPrevKeyWith(c,r,u.index-1)[c],e[1]=d,e[2]=f,e[3]=this.getNextKeyWith(c,r,h.index+1)[c];var g=jL(e,m=.33*m+.33);if(i.x=g[0],i.y=g[1],i.z=g[2],p.copy(i),this.interpolationType===HL.CATMULLROM_FORWARD){var v=jL(e,1.01*m);t.set(v[0],v[1],v[2]),t.sub(p),t.y=0,t.normalize();var y=Math.atan2(t.x,t.z);s.rotation.set(0,y,0)}}}}s.matrixAutoUpdate=!0,s.matrixWorldNeedsUpdate=!0}s.lookAt(s.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}}(),tR.prototype=Object.create(WL.prototype),tR.prototype.constructor=tR,tR.prototype.keyTypes=["vis","opa"],tR.prototype.defaultKey={viz:1,opa:1},tR.prototype.getPrevAndNextKeys=function(e,t){let i=this.data.hierarchy[e].keys[0],n=this.getNextKeyWith(t,e,1);for(;n.time<this.currentTime&&n.index>i.index;)i=n,n=this.getNextKeyWith(t,e,n.index+1);return{prevKey:i,nextKey:n}},tR.prototype.update=function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,i=this.hierarchy.length;t<i;t++){var n=this.hierarchy[t].animationCache[this.data.name],r=n.prevKey.vis,o=n.prevKey.vis,s=n.prevKey.opa,a=n.prevKey.opa;if(o.time<=this.currentTime||r.time>=this.currentTime){const{prevKey:e,nextKey:i}=this.getPrevAndNextKeys(t,"vis");r=e,o=i,n.prevKey.vis=r,n.nextKey.vis=o}if(a.time<=this.currentTime||s.time>=this.currentTime){const{prevKey:e,nextKey:i}=this.getPrevAndNextKeys(t,"opa");s=e,a=i,n.prevKey.opa=s,n.nextKey.opa=a}let e=r.vis,i=o.vis;if(void 0!==e&&void 0!==i&&r.time!==o.time){const t=Math.abs(this.currentTime-o.time)<this.epsilon?i:e;this.viewer.visibilityManager.setNodeOff(this.nodeId,!t,this.viewer.model,this.nodeChildren,this.nodeFragments)}if(e=s.opa,i=a.opa,void 0===e&&1===r.vis&&(e=1),void 0!==e&&void 0!==i&&s.time!==a.time){let t=(this.currentTime-s.time)/(a.time-s.time);t<0&&(t=0),t>1&&(t=1);const n=e+(i-e)*t;for(let e=0;e<this.fragPointers.length;++e){const t=this.fragPointers[e].getMaterial();t.transparent=1!==n,t.opacity=n}n>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1,this.viewer.model,this.nodeChildren,this.nodeFragments)}}},iR.prototype=Object.create(WL.prototype),iR.prototype.constructor=iR,iR.prototype.keyTypes=["pos","text","vis"],iR.prototype.defaultKey={pos:0,text:"",vis:1},iR.prototype.stop=function(){WL.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},iR.prototype.updateText=function(e,t){var i=function(e,t,i){var n=e.clone(),r=new(v().Matrix4);return t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),n.applyProjection(r),{x:(n.x+1)*i.width/2+i.offsetLeft-12,y:(1-n.y)*i.height/2+i.offsetTop+12}}(e,this.viewer.camera,this.viewer.canvas),n=this.getDocument(),r=n.getElementById(this.id+"-txt");r&&(r.innerHTML=t,r.style.left=i.x+"px",r.style.top=i.y+"px",this.text=t),(r=n.getElementById(this.id+"-img"))&&(r.style.left=i.x+"px",r.style.top=i.y-24+"px")},iR.prototype.update=function(){var e=[],t=new(v().Vector3),i=new(v().Vector3);return function(n){if(!1!==this.isPlaying&&(this.currentTime+=n*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){var r=this.getDocument();if(this.isPaused&&this.currentTime<this.startKeyTime)(x=r.getElementById(this.id))&&(x.style.visibility=this.state);else for(var o=0,s=this.hierarchy.length;o<s;o++){for(var a=this.hierarchy[o],l=a.animationCache[this.data.name],c=0;c<this.keyTypes.length;c++){var u=this.keyTypes[c],h=l.prevKey[u],d=l.nextKey[u];if(d.time<=this.currentTime||h.time>=this.currentTime){for(h=this.data.hierarchy[o].keys[0],d=this.getNextKeyWith(u,o,1);d.time<this.currentTime&&d.index>h.index;)h=d,d=this.getNextKeyWith(u,o,d.index+1);l.prevKey[u]=h,l.nextKey[u]=d}var f=h[u],p=d[u];if(d.time!==h.time&&void 0!==f&&void 0!==p){var m=(this.currentTime-h.time)/(d.time-h.time);if(m<0&&(m=0),m>1&&(m=1),"pos"===u){if(this.interpolationType===HL.LINEAR)i.x=f[0]+(p[0]-f[0])*m,i.y=f[1]+(p[1]-f[1])*m,i.z=f[2]+(p[2]-f[2])*m,a.position.copy(i);else if(this.interpolationType===HL.CATMULLROM||this.interpolationType===HL.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",o,h.index-1).pos,e[1]=f,e[2]=p,e[3]=this.getNextKeyWith("pos",o,d.index+1).pos;var g=jL(e,m=.33*m+.33);if(i.x=g[0],i.y=g[1],i.z=g[2],a.position.copy(i),this.interpolationType===HL.CATMULLROM_FORWARD){var v=jL(e,1.01*m);t.set(v[0],v[1],v[2]),t.sub(vector),t.y=0,t.normalize();var y=Math.atan2(t.x,t.z);a.rotation.set(0,y,0)}}}else if("text"===u){var b=Math.abs(this.currentTime-d.time)<this.epsilon?p:f;this.updateText(a.position,b)}else if("vis"===u){var x;if(x=r.getElementById(this.id)){var _=Math.abs(this.currentTime-d.time)<this.epsilon?p:f;x.style.visibility=_?"visible":"hidden"}}}}a.matrixAutoUpdate=!0,a.matrixWorldNeedsUpdate=!0}}}}(),nR.prototype=Object.create(WL.prototype),nR.prototype.constructor=nR,nR.prototype.keyTypes=["points","vis"],nR.prototype.defaultKey={points:[],vis:1},nR.prototype.stop=function(){WL.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},nR.prototype.update=function(){function e(e){e.root&&(e.viewer.removeOverlay("polyline",e.root),e.root=null)}return function(t){if(!1!==this.isPlaying&&(this.currentTime+=t*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&this.currentTime<this.startKeyTime)e(this);else for(var i=0,n=this.hierarchy.length;i<n;i++)for(var r=this.hierarchy[i].animationCache[this.data.name],o=0;o<this.keyTypes.length;o++){var s=this.keyTypes[o],a=r.prevKey[s],l=r.nextKey[s];if(l.time<=this.currentTime||a.time>=this.currentTime){for(a=this.data.hierarchy[i].keys[0],l=this.getNextKeyWith(s,i,1);l.time<this.currentTime&&l.index>a.index;)a=l,l=this.getNextKeyWith(s,i,l.index+1);r.prevKey[s]=a,r.nextKey[s]=l}var c=a[s],u=l[s];if(l.time!==a.time&&void 0!==c&&void 0!==u){var h=(this.currentTime-a.time)/(l.time-a.time);if(h<0&&(h=0),h>1&&(h=1),"points"===s){var d=h<.5?c:u;this.viewer.removeOverlay("polyline",this.root),this.root=null;for(var f=[],p=0;p<d.length;p++){var m=d[p].slice();if(0===p)m[0]=c[p][0]+(u[p][0]-c[p][0])*h,m[1]=c[p][1]+(u[p][1]-c[p][1])*h,m[2]=c[p][2]+(u[p][2]-c[p][2])*h;else if(p===d.length-1){var g=c.length-1,y=u.length-1;m[0]=c[g][0]+(u[y][0]-c[g][0])*h,m[1]=c[g][1]+(u[y][1]-c[g][1])*h,m[2]=c[g][2]+(u[y][2]-c[g][2])*h}var b=new(v().Vector3)(m[0],m[1],m[2]);f.push(b)}this.root=this.createPolyline(f)}else if("vis"===s){var x=Math.abs(this.currentTime-l.time)<this.epsilon?u:c;this.root.visible=x,x||e(this)}}}}}(),nR.prototype.createPolyline=function(e){var t=new(v().Geometry);t.isLines=!0;for(var i=0;i<e.length;i++)t.vertices.push(e[i]);t.computeLineDistances();var n=new(v().LineDashedMaterial)({color:0,dashSize:1,gapSize:.5,linewidth:1}),r=new(v().Line)(t,n,v().LineStrip);return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",r),r},fo.call(rR.prototype),rR.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},rR.prototype.add=function(e){if(!(!e.hierarchy||e.hierarchy.length<1||!e.hierarchy[0].keys||e.hierarchy[0].keys.length<2)){var t=null,i=this;if("camera"===e.type?(t=new eR(i.viewer.camera,e,i),i.animations.push(t)):"annotation"===e.type?(t=new iR(null,e,i),i.animations.push(t)):"polyline"===e.type?(t=new nR(null,e,i),i.animations.push(t)):"mesh"===e.type?i.viewer.model.getData().instanceTree.enumNodeFragments(e.id,(function(n){var r=i.viewer.getFragmentProxy(i.viewer.model,n);r&&(t=new KL(r,e,i),i.animations.push(t))}),!0):"visibility"===e.type&&(t=new tR(e,e.id,i),i.animations.push(t)),i.animations.forEach((e=>e.setGlobalManager(this.globalManager))),t){for(var n=0,r=e.hierarchy.length;n<r;n++)for(var o=e.hierarchy[n].keys,s=0;s<o.length;s++)void 0===o[s].xk&&i.keys.push(o[s].time);!function(e){e.sort((function(e,t){return e-t})),function(e,t,i){for(t=e.length;i=--t;)for(;i--;)e[t]!==e[i]||e.splice(i,1)}(e)}(i.keys)}this.updateFlag|=this.UPDATE_SCENE}},rR.prototype.update=function(e){e*=this._speedMod,this.animationHandler.update(e);var t=this.updateFlag;return this.isPlaying&&!this.isPaused&&(this.currentTime+=e,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&(this._loops?this.play(0,this.onPlayCallback):this.pause()),t|=this.UPDATE_SCENE),this.updateFlag=0,t},rR.prototype.play=function(e,t){if(this.onPlayCallback=t,this.currentTime>=this.duration&&this.goto(0),this.isPlaying)this.pause();else{for(var i=0;i<this.animations.length;i++){this.animations[i].play(e)}this.isPlaying=!0,this.isPaused=!1}},rR.prototype.setFollowCamera=function(e){this.followCam=e;for(var t=0;t<this.animations.length;t++){var i=this.animations[t];i.setFollowCamera&&i.setFollowCamera(e)}},rR.prototype.isFollowingCamera=function(){return this.followCam},rR.prototype.setSpeedModifier=function(e){this._speedMod=e},rR.prototype.getSpeedModifier=function(){return this._speedMod},rR.prototype.setLooping=function(e){this._loops=e},rR.prototype.isLooping=function(){return this._loops},rR.prototype.pause=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t.isPaused===this.isPaused&&t.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},rR.prototype.pauseCameraAnimations=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t instanceof eR&&t.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},rR.prototype.stop=function(){for(var e=0;e<this.animations.length;e++){this.animations[e].stop()}this.isPlaying=!1,this.isPaused=!1},rR.prototype.goto=function(e){if(void 0!==e){for(var t=0;t<this.animations.length;t++){this.animations[t].goto(e)}this.isPlaying=!1,this.isPaused=!0,this.currentTime=e,this.updateFlag|=this.UPDATE_SCENE}},rR.prototype.next=function(){var e=function(e,t){for(var i=-1,n=0;n<t.length;n++)if(t[n]>e){i=t[n];break}return i<0?t[t.length-1]:i}(this.currentTime,this.keys);this.goto(e)},rR.prototype.prev=function(){var e=function(e,t){for(var i=-1,n=t.length-1;n>-1;n--)if(t[n]<e){i=t[n];break}return i<0?t[0]:i}(this.currentTime,this.keys);this.goto(e)};const oR=Autodesk.Viewing,sR=oR.Private;var aR=S()?10:F()?2:6,lR=function(e){this.viewer3DImpl=e,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.tmpMatrix=new(v().Matrix4),this.tmpBox=new(v().Box3),this.fetchingTopology=!1,this.loadTime=0,this.notifiesFirstPixel=!0};lR.prototype.dtor=function(){if(this.svfWorker&&(this.svfWorker.terminate(),this.svfWorker=null,rt.debug("SVF loader dtor: on svf worker.")),this.pack_workers){for(var e=0;e<this.pack_workers.length;e++)this.pack_workers[e].terminate();this.pack_workers=null,rt.debug("SVF loader dtor: on geom worker.")}this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.tmpMatrix=null,this.tmpBox=null,this.svf=null,this.model=null,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadTime=0,this.viewer3DImpl=null},lR.prototype.createWorker=fi,lR.prototype.startWorkers=function(){for(var e=this.svf,t=Math.min(e.geompacks.length,oR.NUM_WORKER_THREADS||aR),i=0;i<t;i++){var n=e.geompacks[this.next_pack++];n.loading=!0,S()?this.loadGeometryPack(n.id,n.uri):(e=>{setTimeout((()=>{this.loadGeometryPack(e.id,e.uri)}),200*i)})(n)}},lR.prototype.createModel=function(e){var t=this.model=new Dy(e);return t.loader=this,t.initialize(),t},lR.prototype.isValid=function(){return this.viewer3DImpl},lR.prototype.loadFile=function(e,t,i,n){if(!this.viewer3DImpl)return rt.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return rt.log("Loading of SVF already in progress. Ignoring new request."),!1;this.loading=!0;var r=e.indexOf("urn:");if(-1!=r){var o=(e=decodeURIComponent(e)).substr(r,e.substr(r).indexOf("/"));rt.log("Extracted URN: "+o);var s=o.lastIndexOf(":");this.svfUrn=o.substr(s+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e;var a=this.currentLoadPath.lastIndexOf("/");return-1!=a&&(this.basePath=this.currentLoadPath.substr(0,a+1)),this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t,this.loadSvfCB(e,t,i,n),!0},lR.prototype.loadSvfCB=function(e,t,i,n){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null,this.failedToLoadPacksCount=0;var r=!0,o=this,s={url:ni(e),basePath:this.currentLoadPath,objectIds:t.ids,globalOffset:t.globalOffset,fragmentTransformsDouble:t.fragmentTransformsDouble,placementTransform:t.placementTransform,applyRefPoint:t.applyRefPoint,queryParams:this.queryParams,bvhOptions:t.bvhOptions||{isWeakDevice:F()},applyScaling:t.applyScaling,applyPlacementInModelUnits:t.applyPlacementInModelUnits,loadInstanceTree:t.loadInstanceTree};this.viewer3DImpl._signalNoMeshes();var a=this.svfWorker=this.createWorker();return a.addEventListener("message",(async function(e){var t=function(){a.terminate(),o.svfWorker=null,a=null};if(r&&n&&(r=!1,n()),e.data&&e.data.manifest)o.interceptManifest(e.data.manifest),s.operation="LOAD_SVF_CONTD",s.manifest=e.data.manifest,a.doOperation(s);else if(e.data&&e.data.svf){var l=o.svf=e.data.svf;o.failedToLoadSomeGeometryPacks&&(i&&i(o.failedToLoadSomeGeometryPacks),o.failedToLoadSomeGeometryPacks=null),await o.onModelRootLoadDone(l),i&&i(null,o.model),o.svf.viewpointTreeRoot&&o.options.addViews&&o.options.addViews(o.svf.viewpointTreeRoot,o.model),o.viewer3DImpl.api.dispatchEvent({type:Hn,svf:l,model:o.model}),l.loadDone=!1;var c=!1;l.metadata&&l.metadata.gltf&&(c=!0),c||(0==l.geompacks.length?o.onGeomLoadDone():o.startWorkers()),1==e.data.progress&&(o.loading=!1,t()),l.fragments.polygonCounts||(l.fragments.polygonCounts=new Int32Array(l.fragments.length)),e.data.bvh&&(l.bvh=e.data.bvh,o.model.setBVH(new Nf(l.bvh.nodes,l.bvh.useLeanNodes,l.bvh.primitives,o.options.bvhOptions)),o.viewer3DImpl.api.dispatchEvent({type:zn,loader:o,model:o.model}))}else e.data&&e.data.bvh?(o.svf&&!o.svf.bvh&&(o.svf.bvh=e.data.bvh,o.model.setBVH(new Nf(o.svf.bvh.nodes,o.svf.bvh.useLeanNodes,o.svf.bvh.primitives,o.options.bvhOptions)),o.viewer3DImpl.api.dispatchEvent({type:zn,loader:o,model:o.model})),o.loading=!1,t()):e.data&&e.data.mesh?(o.processReceivedMesh(e.data),1===e.data.progress&&(o.onGeomLoadDone(),o.loading=!1,t())):e.data&&e.data.progress?1==e.data.progress&&(o.loading=!1,t()):e.data&&e.data.error?(o.loading=!1,t(),rt.error("Error while processing SVF: "+JSON.stringify(e.data.error.args)),i&&i(e.data.error,null)):e.data&&e.data.debug?rt.debug(e.data.message):(rt.error("SVF download failed.",at(st.NETWORK_FAILURE)),o.loading=!1,t())})),s.operation="LOAD_SVF",s.interceptManifest=!!this.interceptManifest,a.doOperation(Fe(s)),!0},lR.prototype.loadGeometryPack=function(e,t){var i,n,r,o,s=this;if(this.svf&&this.isValid()){var a=this.pack_workers;if(a||(a=this.pack_workers=[]),a.length<(oR.NUM_WORKER_THREADS||aR)){var l=!0;for(r=0;r<a.length;r++)if(0===a[r].queued){l=!1;break}if(l){var c=this.createWorker();c.addEventListener("message",(function(e){if(e.data&&e.data.meshes){for(var t=e.data.meshes,i=0;i<t.length;i++){var n=t[i];if(n){var r={packId:e.data.packId,meshIndex:i,mesh:n};s.processReceivedMesh(r)}}if(e.data.progress>=1){s.pack_workers[e.data.workerId].queued-=1,s.loadedPacksCount++,s.viewer3DImpl.signalProgress(100*s.loadedPacksCount/s.svf.geompacks.length,Gp.LOADING,s.model);var a=!0;for(o=0;o<s.pack_workers.length;o++)if(0!=s.pack_workers[o].queued){a=!1;break}if(a){for(o=0;o<s.pack_workers.length;o++)s.pack_workers[o].terminate();s.pack_workers=null}s.loadedPacksCount+s.failedToLoadPacksCount==s.svf.geompacks.length&&s.onGeomLoadDone()}}else if(e.data&&e.data.progress){if(s.pack_workers[e.data.workerId].queued-=1,s.next_pack<s.svf.geompacks.length){var l=null;if(!l||l.loading)for(;s.next_pack<s.svf.geompacks.length&&(l=s.svf.geompacks[s.next_pack++]).loading;);l&&!l.loading?(l.loading=!0,s.loadGeometryPack(l.id,l.uri)):s.svf.fragments.packIds=null}}else e.data&&e.data.debug?rt.debug(e.data.message):e.data&&e.data.error?(++s.failedToLoadPacksCount,s.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}):s.pack_workers[e.data.workerId].queued-=2})),c.queued=0,a.push(c)}}var u=0,h=a[0].queued;for(r=1;r<a.length;r++)a[r].queued<h&&(u=r,h=a[r].queued);(i=a[u]).queued+=2,n=u;var d={operation:"LOAD_GEOMETRY",url:ni(this.svf.basePath+t),packId:parseInt(e),workerId:n,createWireframe:this.options.createWireframe||this.model.getMetadata("renderEnvironmentDisplayEdges","value",!1),packNormals:this.options.packNormals,queryParams:this.queryParams};i.doOperation(Fe(d))}},lR.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,i=this.svf,n=i.fragments,r=this.model,o=n.mesh2frag[t];if(void 0===o)return void rt.warn("Mesh "+t+" was not referenced by any fragments.");Array.isArray(o)||(o=[o]);const s=r.getFragmentList().getGeometryId(o[0]),a=Dc(e);void 0!==e.packId&&(a.packId=e.packId),void 0!==e.meshIndex&&(a.meshIndex=e.meshIndex);const l=r.getGeometryList().addGeometry(a,o.length,s),c=Bc(a);for(var u=0;u<o.length;u++){var h=0|o[u];if(i.loadOptions.skipHiddenFragments)if(!(n.visibilityFlags[h]&ll.MESH_VISIBLE))continue;r.getFragmentList().getOriginalWorldMatrix(h,this.tmpMatrix);var d=n.materials[h].toString(),f=this.viewer3DImpl.matman().findMaterial(r,d);f&&!f.texturesLoaded&&Hu.loadMaterialTextures(r,f,this.viewer3DImpl),n.polygonCounts&&(n.polygonCounts[h]=c);var p=this.viewer3DImpl.setupMesh(this.model,a,d,this.tmpMatrix);r.activateFragment(h,p,!!i.placementTransform)}return this.options.onMeshReceived&&this.options.onMeshReceived(this.model,l,o),n.mesh2frag[t]=null,n.numLoaded+=o.length,this.viewer3DImpl.signalNewGeometryAdded(l,this.model),r.getGeometryList().geomPolyCount>i.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),i.numRepaints++,i.nextRepaintPolys+=1e4*Math.pow(1.5,i.numRepaints),this.viewer3DImpl.api.dispatchEvent({type:zn,loader:this,model:this.model})),l},lR.prototype.setupCamera=function(e){return e.position=(new(v().Vector3)).copy(e.position),e.target=(new(v().Vector3)).copy(e.target),e.up=(new(v().Vector3)).copy(e.up),isFinite(e.position.x+e.position.y+e.position.z+e.target.x+e.target.y+e.target.z+e.up.x+e.up.y+e.up.z)||(e.target=this.svf.bbox.getCenter(new(v().Vector3)),e.position.copy(e.target),e.position.z+=this.svf.bbox.max.z-this.svf.bbox.min.z,e.up.set(0,1,0)),isFinite(e.aspect)||(e.aspect=1),isFinite(e.fov)||(e.fov=90),isFinite(e.orthoScale)||(e.orthoScale=1),e},lR.prototype.onModelRootLoadDone=async function(e){e.fragments.numLoaded=0,e.nextRepaintPolys=0,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=this.basePath,e.loadOptions=this.options,e.verylargebbox&&this.viewer3DImpl.setNearRadius(this.options.nearRadius||1);var t=Date.now();rt.log("SVF load: "+(t-this.t0));var i=this.createModel(e);this.options.skipPropertyDb||this.loadPropertyDb();var n=await this.convertMaterials(i);if(this.viewer3DImpl.matman().hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0),this.t1=t,e.bbox=(new(v().Box3)).copy(e.bbox),e.refPointTransform&&(e.refPointTransform=new al(!0).copy(e.refPointTransform)),e.placementTransform&&(e.placementTransform=new al(!0).copy(e.placementTransform)),e.placementWithOffset&&(e.placementWithOffset=new al(!0).copy(e.placementWithOffset)),e.cameras)for(var r=0;r<e.cameras.length;r++)this.setupCamera(e.cameras[r]);rt.log("scene bounds: "+JSON.stringify(e.bbox));var o={category:"metadata_load_stats",urn:e.urn,has_topology:!!e.topologyPath,has_animations:!!e.animations,cameras:e.cameras?e.cameras.length:0,lights:e.lights?e.lights.length:0,materials:n,is_mobile:F()};rt.track(o),this.viewer3DImpl.signalProgress(5,Gp.ROOT_LOADED,this.model)},lR.prototype.convertMaterials=async function(e){var t,i=this.viewer3DImpl.matman(),n=e.getData(),r=0;if(!n.materials)return r;if(n.gltfMaterials){var o=n.materials.materials;for(t in o){var s=o[t],a=ou.convertMaterialGltf(s,n),l=i._getMaterialHash(e,t);i.addMaterial(l,a,!1),r++,this.viewer3DImpl._signalNewMaterialAdded(a,this.model)}return r}var c=n.materials.materials,u=n.proteinMaterials?n.proteinMaterials.materials:null;for(t in c){var h=u&&u[t]&&ou.isPrismMaterial(u[t]),d=h?u[t]:c[t];h&&await ou.loadMaterialConverterPrismLibrary(),i.convertOneMaterial(e,d,i._getMaterialHash(e,t)),this.viewer3DImpl._signalNewMaterialAdded(d,this.model),r++}return r},lR.prototype.makeBVH=function(e){var t=performance.now(),i=e.materials?e.materials.materials:null,n=new Bf(e.fragments,i);n.build(this.options.bvhOptions||{isWeakDevice:F()});var r=new Nf(n.nodes.getRawData(),n.nodes.is_lean_node,n.primitives,this.options.bvhOptions),o=performance.now();return rt.log("BVH build time: "+(o-t)),r},lR.prototype.onGeomLoadDone=async function(){this.svf.loadDone=!0,Hu.loadModelTextures(this.model,this.viewer3DImpl),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null,this.svf.fragments.visibilityFlags=null;var e=Date.now(),t="Fragments load time: "+(e-this.t1);this.loadTime=e-this.t0;var i=this.firstPixelTimestamp-this.t0;t+=" (first pixel time: "+i+")",this.svf.bvh&&!this.svf.placementTransform||this.model.setBVH(this.makeBVH(this.svf)),rt.log(t),(this.options.useConsolidation||Ji)&&await this.viewer3DImpl.consolidateModel(this.model,this.options.consolidationMemoryLimit);var n={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().getCount(),fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};i>0&&(n.first_pixel_time=i),rt.track(n,!0);const r=this.model.getGeometryList(),o={load_time:this.loadTime,polygons:r.geomPolyCount,fragments:this.model.getFragmentList().getCount(),mem_usage:r.gpuMeshMemory,time_to_first_pixel:i,viewable_type:"3d",url:this.currentLoadPath,urn:this.svfUrn};sR.analytics.track("viewer.model.loaded",o),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},lR.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new rp(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},lR.prototype.fetchTopologyFile=function(e,t){if(!this.fetchingTopology){this.fetchingTopology=!0;var i=this.createWorker();i.addEventListener("message",(function(e){if(e.data["status-topology"])return n=(new Date).getTime(),o=Math.round((n-a)/1e3),void rt.log("Topology file downloaded. ("+o+" seconds). Processing...");var s=e.data["fetch-topology"];s&&(r=(new Date).getTime(),o=Math.round((r-n)/1e3),s.topology?rt.log("Topology file processed successfully! ("+o+" seconds)."):rt.log("Topology file processed, but an error ocurred. ("+o+" seconds)."),t(s),l.fetchingTopology=!1,i.terminate(),i=null)}));var n,r,o,s={path:e,queryParams:this.queryParams},a=(new Date).getTime();rt.log("Fetching topology file..."),s.operation="FETCH_TOPOLOGY",i.doOperation(Fe(s));var l=this}},lR.prototype.is3d=function(){return!0},Ra.registerFileLoader("svf",["svf"],lR);const cR=Autodesk.Viewing.Private,uR={GEOMETRY:"geometry",VERTEX_BUFFER:"vertexBuffer"};function hR(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new(v().Matrix4),this.logger=rt,this.loadTime=0}hR.prototype.dtor=function(){this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null,rt.debug("F2D loader dtor: on streaming worker.")),this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null,rt.debug("F2D loader dtor: on parsing worker.")),this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.loading=!1,this.tmpMatrix=null,this.logger=null,this.loadTime=0,this.svf=null,this.model=null,this.options=null},hR.prototype.isValid=function(){return!!this.viewer3DImpl},hR.prototype.loadFile=function(e,t,i,n){if(!this.viewer3DImpl)return rt.log("F2D loader was already destructed. So no longer usable."),!1;if(this.loading)return rt.log("Loading of F2D already in progress. Ignoring new request."),!1;this.loading=!0;var r=e.indexOf("urn:");if(-1!=r){var o=(e=decodeURIComponent(e)).substr(r,e.substr(r).indexOf("/"));rt.log("Extracted URN: "+o);var s=o.lastIndexOf(":");this.svfUrn=o.substr(s+1)}else this.svfUrn=e;return this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t,this.options.placementTransform?this.modelScale=this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=this.options.modelScale||1,this.isf2d=!0,this.loadFydoCB(e,t,i,n),!0},hR.prototype.loadFydoCB=function(e,t,i,n){this.t0=Date.now();var r=ni(e);this.streamingWorker=fi("F2DStreamWorker",!0),this.parsingWorker=fi("F2DParseWorker");var o=this,s=!0,a=function(){o.parsingWorker.terminate(),o.parsingWorker=null};this.streamingWorker.addEventListener("message",(function(e){var a;o.isValid()&&(s&&n&&(s=!1,n()),e.data&&"F2DBLOB"==e.data.type?(a={operation:"PARSE_F2D",data:e.data.buffer,metadata:e.data.metadata,manifest:e.data.manifest,basePath:e.data.basePath,f2dLoadOptions:{modelSpace:t.modelSpace,bgColor:t.bgColor,noShadow:t.noShadow,isMobile:F(),excludeTextGeometry:t.excludeTextGeometry,outputType:t.outputType||uR.VERTEX_BUFFER,extendStringsFetching:t.extendStringsFetching},url:r},o.parsingWorker.doOperation(a,[a.data]),o.streamingWorker.terminate(),o.streamingWorker=null):e.data&&"F2DSTREAM"==e.data.type?(a={operation:"PARSE_F2D_FRAME",data:e.data.frames,url:r,f2dLoadOptions:{modelSpace:t.modelSpace,bgColor:t.bgColor,noShadow:t.noShadow,isMobile:F(),excludeTextGeometry:t.excludeTextGeometry,outputType:t.outputType||uR.VERTEX_BUFFER,extendStringsFetching:t.extendStringsFetching}},e.data.metadata&&(a.metadata=e.data.metadata,a.manifest=e.data.manifest),e.data.finalFrame&&(a.finalFrame=!0,o.streamingWorker.terminate(),o.streamingWorker=null,o.fileMemorySize/=2),e.data.progress&&o.viewer3DImpl.signalProgress(100*e.data.progress,Gp.LOADING),o.parsingWorker.doOperation(a,a.data?[a.data]:void 0)):e.data&&"F2DAssetURL"==e.data.type||e.data&&e.data.progress||(e.data&&e.data.debug?rt.debug(e.data.message):e.data&&e.data.error?(o.loading=!1,o.streamingWorker.terminate(),o.streamingWorker=null,i&&i(e.data.error)):(rt.error("F2D download failed.",at(st.NETWORK_FAILURE)),o.loading=!1,o.streamingWorker.terminate(),o.streamingWorker=null)))}),!1);var l=t.outputType===uR.GEOMETRY?function(e){if(o.isValid()&&(s&&n&&(s=!1,n()),e.data&&e.data.f2d)){o.svf=e.data.f2d;const t=e.data.f2d.geometry;a(),rt.info("Num polylines: "+t.numPolylines),rt.info("Line segments: "+t.numLineSegs),rt.info("Circular arcs: "+t.numCircles),rt.info("Ellipitcal arcs:"+t.numEllipses),o.onModelRootLoadDone(o.svf),i&&i(null,o.model),o.viewer3DImpl.api.dispatchEvent({type:Hn,svf:o.svf,model:o.model}),o.onGeomLoadDone()}}:function(e){var t,r;if(o.isValid())if(s&&n&&(s=!1,n()),e.data&&e.data.f2d){for(t=o.svf=e.data.f2d,a(),rt.info("Num polylines: "+t.numPolylines),rt.info("Line segments: "+t.numLineSegs),rt.info("Circular arcs: "+t.numCircles),rt.info("Ellipitcal arcs:"+t.numEllipses),rt.info("Plain triangles:"+t.numTriangles),rt.info("Total # of op codes generated by fydo.parse: "+t.opCount),o.onModelRootLoadDone(o.svf),i&&i(null,o.model),o.viewer3DImpl.api.dispatchEvent({type:Hn,svf:o.svf,model:o.model}),r=0;r<t.meshes.length;r++)o.processReceivedMesh2D(t.meshes[r],r);t.meshes=null,o.onGeomLoadDone(),o.loading=!1}else if(e.data&&e.data.f2dframe){var l=0;if(e.data.meshes){var c=e.data.bbox;o.svf.bbox=(new(v().Box3)).copy(c),o.svf.modelSpaceBBox=o.svf.bbox.clone(),o.svf.placementTransform&&o.svf.bbox.applyMatrix4(o.svf.placementTransform),l=e.data.baseIndex}else o.svf=e.data.f2dframe,l=e.data.baseIndex;if((t=o.svf).fragments&&t.fragments.initialized||(o.onModelRootLoadDone(t),i&&i(null,o.model),o.viewer3DImpl.api.dispatchEvent({type:Hn,svf:t,model:o.model})),e.data.meshes&&e.data.meshes.length)for(r=0;r<e.data.meshes.length;r++)o.processReceivedMesh2D(e.data.meshes[r],l+r);if(e.data.finalFrame){var u=e.data.cumulativeProps;for(var h in u)t[h]=u[h];a(),o.onGeomLoadDone(),o.loading=!1}}else e.data&&e.data.progress||(e.data&&e.data.debug?rt.debug(e.data.message):e.data&&e.data.error?(o.loading=!1,a(),rt.error("Error while processing F2d: "+JSON.stringify(e.data.error.args)),i&&i(e.data.error)):(rt.error("F2D download failed.",at(st.NETWORK_FAILURE)),o.loading=!1,a()))};this.parsingWorker.addEventListener("message",l,!1);var c={operation:"STREAM_F2D",url:r,objectIds:t.ids,queryParams:this.queryParams};return this.streamingWorker.doOperation(ke.initLoadContext(c)),!0},hR.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,i=this.svf,n=i.fragments,r=n.mesh2frag[t];if(void 0===r)return void rt.warn("Mesh "+t+" was not referenced by any fragments.");Array.isArray(r)||(r=[r]);var o=e.mesh;o.dbIds[-1]&&this.options.hideBackground&&this.model.changePaperVisibility(!1);const s=Oc.meshToGeometry(e);if(s.unpackXform=o.unpackXform,o.texData){var a=new(v().DataTexture)(new Uint8Array(o.texData.buffer),o.texData.length,1,v().RGBAFormat,v().UnsignedByteType,v().UVMapping,v().ClampToEdgeWrapping,v().ClampToEdgeWrapping,v().NearestFilter,v().NearestFilter,0);a.generateMipmaps=!1,a.flipY=!1,a.needsUpdate=!0,s.tIdColor=a,s.vIdColorTexSize=new(v().Vector2)(o.texData.length,1)}var l=r.length,c=this.model;c.getGeometryList().addGeometry(s,l,e.meshIndex+1);const u=Bc(s);for(var h=0;h<r.length;h++){var d=0|r[h];c.getFragmentList().getOriginalWorldMatrix(d,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new(v().Matrix4)).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var f=n.materials[d].toString();n.polygonCounts&&(n.polygonCounts[d]=u);var p=this.viewer3DImpl.setupMesh(this.model,s,f,this.tmpMatrix);c.activateFragment(d,p)}n.mesh2frag[t]=null,n.numLoaded+=r.length;var m=n.numLoaded;i.geomPolyCount>i.nextRepaintPolys&&(i.numRepaints++,i.nextRepaintPolys+=1e4*Math.pow(1.5,i.numRepaints),this.viewer3DImpl.api.dispatchEvent({type:zn,loader:this,model:this.model})),m%20==0&&this.viewer3DImpl.api.dispatchEvent({type:zn,loader:this,model:this.model})},hR.prototype.processReceivedMesh2D=function(e,t){t>=this.bufferCount&&(this.bufferCount=t+1);var i={mesh:e,is2d:!0,packId:"0",meshIndex:t},n="0:"+t,r=this.svf.fragments;if(!r.fragId2dbId[t]){var o=Object.keys(i.mesh.dbIds).map((function(e){return parseInt(e)}));r.fragId2dbId[t]=o;for(var s=0;s<o.length;s++){var a=o[s],l=r.dbId2fragId[a];Array.isArray(l)?l.push(t):r.dbId2fragId[a]=void 0!==l?[l,t]:t}const n=this.model.getFragmentList();if(e.material.modelScale=this.modelScale,e.material.opacity=this.options.opacity,e.material.doNotCut=this.options.doNotCut||(null==n?void 0:n.getDoNotCut()),null!=n&&n.viewBounds){const t=n.viewBounds;e.material.viewportBounds=new(v().Vector4)(t.min.x,t.min.y,t.max.x,t.max.y)}var c=this.viewer3DImpl,u=this;r.materials[t]=this.viewer3DImpl.matman().create2DMaterial(this.model,e.material,!1,!1,(function(e,t){var i=t.getData();null==i||!i.loadDone||i.texLoadDone||Hu.requestsInProgress()||(i.texLoadDone=!0,c.onTextureLoadComplete(t)),F()&&Hu.requestsInProgress()||c.api.dispatchEvent({type:zn,loader:u,model:t})})),r.length++}r.mesh2frag[n]=t,this.processReceivedMesh(i)},hR.prototype.onModelRootLoadDone=function(e){var t,i;e.fragments={},e.fragments.mesh2frag={},e.fragments.materials=[],e.fragments.fragId2dbId=[],e.fragments.dbId2fragId={},e.fragments.length=0,e.fragments.initialized=!0,e.fragments.numLoaded=0,e.nextRepaintPolys=1e4,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath="";var n=this.currentLoadPath.lastIndexOf("/");-1!==n&&(e.basePath=this.currentLoadPath.substr(0,n+1)),e.placementTransform=null===(t=this.options.placementTransform)||void 0===t?void 0:t.clone(),e.placementWithOffset=null===(i=this.options.placementTransform)||void 0===i?void 0:i.clone(),e.loadOptions=this.options,e.texLoadDone=!1;var r=Date.now();rt.log("F2D load: "+(r-this.t0)),this.t1=r,e.bbox=(new(v().Box3)).copy(e.bbox),e.modelSpaceBBox=e.bbox.clone(),e.placementTransform&&e.bbox.applyMatrix4(e.placementTransform);var o=this.model=new Dy(e);o.loader=this,o.initialize(),this.options.skipPropertyDb||(this.svf.propDbLoader=new rp(this.sharedDbPath,this.model,this.viewer3DImpl.api)),rt.log("scene bounds: "+JSON.stringify(e.bbox));var s={category:"metadata_load_stats",urn:e.urn,layers:e.layerCount};rt.track(s),this.viewer3DImpl.setDoNotCut(o,!!this.options.doNotCut),this.viewer3DImpl.signalProgress(5,Gp.ROOT_LOADED,this.model)},hR.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var e=Date.now(),t="Fragments load time: "+(e-this.t1);this.loadTime+=e-this.t0,Hu.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipPropertyDb||this.loadPropertyDb(),rt.log(t);var i={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().getCount(),urn:this.svfUrn};rt.track(i,!0);var n=this.model.getGeometryList();const r={load_time:this.loadTime,polygons:n.geomPolyCount,fragments:this.model.getFragmentList().getCount(),mem_usage:n.gpuMeshMemory,viewable_type:"2d",url:this.currentLoadPath,urn:this.svfUrn};cR.analytics.track("viewer.model.loaded",r),this.currentLoadPath=null,this.isf2d=void 0,this.viewer3DImpl.onLoadComplete(this.model)},hR.prototype.loadPropertyDb=function(){this.svf.propDbLoader&&this.svf.propDbLoader.load()},hR.prototype.is3d=function(){return!1},Ra.registerFileLoader("f2d",["f2d"],hR);const dR=Autodesk.Viewing.Private;function fR(e){var t=e;this.isLeafletLoader=!0,this.loading=!1;var i=function(e,t){var i=[80,75,1,2],n=t;if(e[n++]!==i[0]||e[n++]!==i[1]||e[n++]!==i[2]||e[n++]!==i[3])return rt.error("invalid file header signature"),null;var r={};return r.version=e[n++],r.os=e[n++],r.needVersion=e[n++]|e[n++]<<8,r.flags=e[n++]|e[n++]<<8,r.compression=e[n++]|e[n++]<<8,r.time=e[n++]|e[n++]<<8,r.date=e[n++]|e[n++]<<8,r.crc32=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,r.compressedSize=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,r.plainSize=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,r.fileNameLength=e[n++]|e[n++]<<8,r.extraFieldLength=e[n++]|e[n++]<<8,r.fileCommentLength=e[n++]|e[n++]<<8,r.diskNumberStart=e[n++]|e[n++]<<8,r.internalFileAttributes=e[n++]|e[n++]<<8,r.externalFileAttributes=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24,r.relativeOffset=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,r.filename=String.fromCharCode.apply(null,e.slice(n,n+=r.fileNameLength)),r.extraField=e.slice(n,n+=r.extraFieldLength),r.comment=e.slice(n,n+r.fileCommentLength),r.length=n-t,r},n=function(e){var t=function(e){var t=[80,75,3,4],i=0;if(e[i++]!==t[0]||e[i++]!==t[1]||e[i++]!==t[2]||e[i++]!==t[3])return rt.error("invalid local file header signature"),null;var n={};return n.needVersion=e[i++]|e[i++]<<8,n.flags=e[i++]|e[i++]<<8,n.compression=e[i++]|e[i++]<<8,n.time=e[i++]|e[i++]<<8,n.date=e[i++]|e[i++]<<8,n.crc32=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,n.compressedSize=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,n.plainSize=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,n.fileNameLength=e[i++]|e[i++]<<8,n.extraFieldLength=e[i++]|e[i++]<<8,n.filename=String.fromCharCode.apply(null,e.slice(i,i+=n.fileNameLength)),n.extraField=e.slice(i,i+=n.extraFieldLength),n.length=i,n}(e);if(!t)return null;var i=t.length,n=t.compressedSize;return e.slice(i,i+n)};this.continueLoadFile=function(e,i,n,r,o,s){var a,l,c=this;if(!c.loading)return void n({code:st.LOAD_CANCELED,msg:"Load canceled"},null);null!==(a=i.loadOptions)&&void 0!==a&&a.loadFromZip?l="{z}/{x}_{y}."+i.loadOptions.mime.split("/")[1]:l=e;o.initFromLoadOptions(l,i.loadOptions,s,i);let u=null;r&&r(),!o.valid()&&o.initForSimpleImage(e),o.onRootLoaded=function(){if(!c.loading)return void n({code:st.LOAD_CANCELED,msg:"Load canceled"},null);var r=new function(n){var r;this.bbox=new(v().Box3),this.basePath=e,this.is2d=!0,this.urn=null===(r=i.bubbleNode)||void 0===r?void 0:r.getRootNode().urn();var s=n&&n.paperWidth>=0?n.paperWidth:o.texWidth,a=n&&n.paperHeight>=0?n.paperHeight:o.texHeight;this.pageToModelTransform=o.getPageToModelTransform(s,a),this.metadata={},this.metadata.page_dimensions={};var l=this.metadata.page_dimensions;l.page_width=s,l.page_height=a,l.page_units=n&&n.paperUnits,this.loadDone=!0,this.isLeaflet=!0,t.signalProgress(100,Gp.LOADING),o.texWidth>0&&(this.maxPixelPerUnit=o.texWidth/o.getQuadWidth(),o.isSimpleImage&&(this.maxPixelPerUnit*=10))}(i.loadOptions);r.loadOptions=i,r.bbox.copy(o.getBBox()),r.modelSpaceBBox=r.bbox.clone(),i.placementTransform&&(r.placementTransform=i.placementTransform.clone(),r.placementWithOffset=i.placementTransform.clone(),r.bbox.applyMatrix4(i.placementTransform));const s=new Dy(r);return s.addTraversalController("Custom",u),s.loader=c,t.api.dispatchEvent({type:Hn,svf:r,model:s}),u.callWhenRefined((function(){var e,t=Date.now();r.loadTime=t-c.t0,rt.log("SVF load: "+r.loadTime);const i={load_time:r.loadTime,total_raster_pixels:null===(e=r.loadOptions.bubbleNode)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.totalRasterPixels,viewable_type:"2d",url:r.basePath,urn:r.urn};dR.analytics.track("viewer.model.loaded",i)})),n(null,s),c.loading=!1,s.id},o.onDone=n,o.getPixelRatio=t.glrenderer().getPixelRatio,o.maxAnisotropy=t.glrenderer().getMaxAnisotropy(),o.placementTransform=i.placementTransform,u=new tL(o,t.getMaterials()),u.requestRootTile()},this.loadFile=function(e,t,r,o){if(this.loading)return rt.log("Loading of Leaflet already in progress. Ignoring new request."),!1;var s=this;this.loading=!0,this.options=t,this.t0=Date.now();var a=new eL,l=null,c=t.acmSessionId;if(t.loadOptions&&t.loadOptions.loadFromZip){l=function(e,t,i){for(var r,o=e.split("/")[0]-a.levelOffset,s=0;s<a.zips.length;s++)if(o<=a.zips[s].zipMaxLevel){r=a.zips[s];break}if(!r)return i("Failed loading texture - tile's level doesn't exists."),!1;var l=r.fileTable[e];if(!l)return i("Failed loading texture - entry does not exist inside fileTable."),!1;var u={extractImage:n},h=l.relativeOffset,d=l.relativeOffset+l.contentSize;r.rawData?u.rawData=r.rawData.slice(h,d):u.range={min:h,max:d},Hu.loadTextureWithSecurity(r.urnZip,v().UVMapping,t,i,c,!0,u)};t.loadOptions.zips.forEach((function(n){var u=n.centralDirOffset,h=n.centralDirLength,d=n.centralDirEntries;!function(e,t,i,n,r,o){var s=null,a={};De()||(t&&(s="acmsession="+t),a.range={min:i,max:n+i});var l=Fe({queryParams:s});ei.getItem(l,e,r,o,a)}(n.urnZip,c,u,h,(function(c){De()&&(n.rawData=c,c=c.slice(u,u+h));var f=function(e,t,n){for(var r,o=0,s={},a=null,l=0;l<n;++l){if(!(r=i(e,o)))return null;a&&(a.contentSize=r.relativeOffset-a.relativeOffset),o+=r.length,s[r.filename]=r,a=r}return a.contentSize=t-a.relativeOffset,s}(c,u,d);if(!f)return r("Failed parsing central directory of the zip.",null),!1;n.fileTable=f,t.loadOptions.zips.every((function(e){return Object.keys(e.fileTable).length>0}))&&s.continueLoadFile(e,t,r,o,a,l)}),(function(e){rt.error("Zip download failed: "+e.statusText,at(st.NETWORK_FAILURE)),r("Zip download failed: "+e.statusText,null)}))}))}else l=function(e,t,i){Hu.loadTextureWithSecurity(e,v().UVMapping,t,i,c,!0)},this.continueLoadFile(e,t,r,o,a,l);return!0},this.dtor=function(){this.loading=!1}}fR.prototype.is3d=function(){return!1},fR.prototype.isPageCoordinates=function(){var e;return!(null===(e=this.options)||void 0===e||null===(e=e.loadOptions)||void 0===e||!e.fitPaperSize)},Ra.registerFileLoader("Leaflet",["jpeg","jpg","png"],fR);class pR{constructor(e){this.viewer3DImpl=e}loadFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const r=t.width||100,o=t.height||100;n&&n(),this.svf={is2d:!0,viewports:[],layersMap:{0:0},layerCount:1,bbox:new THREE.Box3(new THREE.Vector3(0,0,0),new THREE.Vector3(r,o,0)),fragments:{length:1,fragId2dbId:[0],dbId2fragId:{},transforms:new Float32Array(12),boxes:[0,0,0,r,o,0]},loadOptions:{bubbleNode:new Autodesk.Viewing.BubbleNode({urn:"Dummy_urn",guid:"Dummy_guid"})},metadata:{page_dimensions:{page_width:r,page_height:o,logical_width:r,logical_height:o,logical_offset_x:0,logical_offset_y:0,page_units:"inch"}},strings:[],stringDbIds:[],loadDone:!0};const s=new Autodesk.Viewing.Model(this.svf);s.initialize(),s.loader=this,this.model=s,i(null,s),this.viewer3DImpl.api.dispatchEvent({type:Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,svf:this.svf,model:s}),this.viewer3DImpl.onLoadComplete(s)}dtor(){}is2d(){return!0}is3d(){return!1}}const mR=c();function gR(){this.stop=null,this.isRunning=!0}function vR(e,t,i,n,r){var o=performance.now(),s=1e3*i,a=0,l=new gR;l.stop=function(){a&&mR.cancelAnimationFrame(a),l.isRunning=!1},l.skip=function(){l.isRunning&&(n(t),l.stop(),r&&r())};var c=function(i){var u=(i-o)/s;u=Math.max(u,0),u=Math.min(u,1),n(e+u*(t-e)),u<1?a=mR.requestAnimationFrame(c):(l.isRunning=!1,r&&r())};return c(o),l}class yR{constructor(e,t,i){this.setValueCb=t,this.animTime=i,this.fadeAnim=null,this.targetValue=e,this.curValue=e,t(e),this.pendingFinishedCallbacks=[]}stopAnim(){this.fadeAnim&&(this.fadeAnim.stop(),this.fadeAnim=null)}_onAnimEnded(){this.pendingFinishedCallbacks.forEach((e=>e())),this.pendingFinishedCallbacks.length=0}fadeTo(e,t){const i=this.fadeAnim&&this.fadeAnim.isRunning;if(!i&&this.curValue==e)return void(t&&t());if(t&&this.pendingFinishedCallbacks.push(t),i&&e===this.targetValue)return;this.stopAnim();this.targetValue=e,this.fadeAnim=vR(this.curValue,this.targetValue,this.animTime,(e=>{e=xR(e),this.curValue=e,this.setValueCb(e)}),(()=>this._onAnimEnded()))}skipAnim(){this.fadeAnim&&this.fadeAnim.skip()}setValue(e){this.stopAnim(),this.curValue=e,this.setValueCb(e)}}function bR(e,t,i){return(1-i)*e+i*t}function xR(e){return THREE.Math.smootherstep(e,0,1)}function _R(e){var t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3,a=0,l=0,c=new THREE.Quaternion,u=new THREE.Quaternion,h=new THREE.Vector3,d=new THREE.Quaternion,f=new THREE.Object3D;new THREE.Matrix4;function p(e,t,i,n){Autodesk.Viewing.Navigation.prototype.orient(f,i,t,n),e.copy(f.quaternion)}this.init=function(e,h,d,f){let m=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.copy(e.position),i.copy(e.target),n.copy(m?e.worldup:e.up),r.copy(h),o.copy(d),s.copy(m?e.worldup:f),a=t.distanceTo(i),l=r.distanceTo(o),p(c,t,i,n),p(u,r,o,s)},this.updateCamera=function(e,i){var n=xR(e);i.position.lerpVectors(t,r,n),d.slerpQuaternions(c,u,n),d.normalize();var o=bR(a,l,n);!function(e,t,i){h.set(0,0,-i).applyQuaternion(t),e.target.addVectors(e.position,h),h.set(0,1,0).applyQuaternion(t),e.up.copy(h)}(i,d,o),i.dirty=!0},this.updateViewerCamera=function(e,t){this.updateCamera(e,t.impl.camera),t.impl.syncCamera(),t.impl.invalidate(!0,!0)}}var ER;function SR(e,t,i,n){let r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];ER||(ER=new _R),i=i||2;var o=e.impl.camera;ER.init(o,t.position,t.target,t.up,r);return vR(0,1,i,(function(t){ER.updateViewerCamera(t,e)}),n)}function AR(e,t,i){var n=1,r=null,o=t,s=void 0,a=i;function l(t){n=t,e.impl.setGroundShadowAlpha(t)}function c(){r=null,a&&a(s)}this.shadowOn=function(){r&&s||(r&&!s&&(r.stop(),r=null),n>=1||(r=vR(n,1,o*(1-n),l,c),s=!0))},this.shadowOff=function(){r&&!s||(r&&s&&(r.stop(),r=null),n<=0||(r=vR(n,0,o*n,l,c),s=!1))},this.isFading=function(){return r&&r.isRunning}}function wR(e){const t={},i=de("wasm.worker.js");return new Promise(((t,r)=>{(function(e){const t=Autodesk.Viewing.Private;return new Promise((function(i){if(t.ENABLE_INLINE_WORKER){let t=new XMLHttpRequest;t.open("GET",e,!0),t.withCredentials=!1,t.onload=function(){let e,n=c();n.URL=n.URL||n.webkitURL;try{e=new Blob([t.responseText],{type:"application/javascript"})}catch(i){let n=new BlobBuilder;n.append(t.responseText),e=n.getBlob()}i(URL.createObjectURL(e))},t.send()}else i(e)}))})(i).then((function(i){const o=new Worker(i),s={},a=de(e);o.postMessage({eventType:"INITIALIZE",eventData:a}),o.addEventListener("message",(function(e){if("INITIALIZED"===e.data.eventType){e.data.eventData.forEach((e=>{s[e]=function(){return n(e,o,(t=>{t.postMessage({eventData:{method:e,arguments:Array.from(arguments)}})}))}}));const i="getBuffer";return s[i]=function(){return n(i,o,(e=>{e.postMessage({eventType:"GET_BUFFER"})}))},void t(s)}})),o.addEventListener("error",(function(e){r(e)}))}))}));function n(e,i,n){return new Promise(((r,o)=>{const s=function(e,i){let n,r;t&&Object.prototype.hasOwnProperty.call(t,e)?(n=t[e][0],r=n.inUse):(t[e]=[],r=!0);r&&(n={channel:new MessageChannel,inUse:!1},t[e].push(n),i.postMessage({eventType:"SET_CHANNEL_PORT",eventData:{method:e,port:n.channel.port2}},[n.channel.port2]));return n}(e,i),a=s.channel;s.inUse=!0,n(a.port1),a.port1.onmessage=function(i){s.inUse=!1;const n=i.data.eventType,a=i.data.eventData;"ERROR"===n?o(a):r(a),function(e,t){for(let i=1;i<t.length;i++){if(t[i].channel===e.channel)return t.splice(i,1),!0}}(s,t[e])}}))}}function CR(e,t){try{WebAssembly.instantiateStreaming||(WebAssembly.instantiateStreaming=async(e,t)=>{const i=await(await e).arrayBuffer();return await WebAssembly.instantiate(i,t)})}catch(e){throw new Error("WebAssembly is not supported for the current browser.")}if(!e)throw new Error("Expecting a wasm file path.");let i=256,n=256;t&&t.memory&&(i=t.memory.initial,n=t.memory.maximum),this._wasmPath=e,this._memory=new WebAssembly.Memory({initial:i,maximum:n})}function TR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.viewer=e,this.setGlobalManager(e.globalManager),this.menus=[],this.container=null,this.open=!1,this._onDOMevent=this._onDOMevent.bind(this),this.onHide=t.onHide}CR.prototype.constructor=CR,CR.prototype.instantiate=function(){const e={env:{abortStackOverflow:e=>{throw new Error("overflow")},table:new WebAssembly.Table({initial:0,maximum:0,element:"anyfunc"}),__table_base:0,memory:this._memory,__memory_base:1024,STACKTOP:0,STACK_MAX:this.getBuffer().byteLength}};return new Promise(((t,i)=>{try{WebAssembly.instantiateStreaming(fetch(this._wasmPath),e).then((e=>{const i=e.instance.exports;this.proxy=i,t(i)}))}catch(e){i(e)}}))},CR.prototype.getBuffer=function(){return this._memory.buffer},TR.prototype.constructor=TR,fo.call(TR.prototype),TR.prototype.show=function(e,t){var i=this.viewer.container.getBoundingClientRect();Array.isArray(e.changedPointers)&&e.changedPointers.length>0&&(e.clientX=e.changedPointers[0].clientX,e.clientY=e.changedPointers[0].clientY);var n=e.clientX-i.left,r=e.clientY-i.top;this.open||(this.showMenu(t,n,r),this.open=!0),this._startX=e.clientX,this._startY=e.clientY},TR.prototype.showMenu=function(e,t,i,n){var r,o=[],s=this.getDocument(),a=s.createElement("div");a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.zIndex="10";var l=s.createElement("div");l.classList.add("menu"),l.classList.add("docking-panel"),l.classList.add("docking-panel-container-solid-color-a"),a.appendChild(l),this.viewer.container.appendChild(a),this.container=a,this.menus.push(l);let c=!1;for(var u=0;u<e.length;++u){var h=e[u],d=h.title,f=h.target,p=h.icon,m=h.shortcut,g=h.divider;let t=Array.isArray(f);t&&!e.isChild?c=!0:t=!1,g?(r=this.createDivider(),l.appendChild(r)):(r=this.createMenuItem(d,p,m,t),l.appendChild(r),"function"==typeof f?this.addCallbackToMenuItem(r,f):t?o.push({menuItem:r,target:f}):rt.warn("Invalid context menu option:",d,f))}if(!c){const e=l.children;for(let t=0;t<e.length;t++){const i=e[t],n=i.getElementsByClassName("menu-item-expand");n.length>0&&i.removeChild(n[0])}}var v=l.getBoundingClientRect(),y=v.width,b=v.height,x=this.viewer.container.getBoundingClientRect(),_=x.width,E=x.height;(n=!!n||O()&&!this.viewer.navigation.getUseLeftHandedInput())&&(t-=y),t<0&&(t=0),_<t+y&&(t=_-y)<0&&(t=0),i<0&&(i=0),E<i+b&&(i=E-b)<0&&(i=0),l.style.top=Math.round(i)+"px",l.style.left=Math.round(t)+"px";const S=(e,t)=>{const i=e.getElementsByClassName("menu-item-expand");e.removeChild(i[0]);const n=e.getElementsByClassName("menu-item-icon");n.length>0&&e.insertBefore(n[0],e.childNodes[e.length-1]),this.setMenuExpand(e,!0,t)};let A=!1;for(u=0;u<o.length;++u){var w=o[u];const e=(r=w.menuItem).getBoundingClientRect(),s=this.viewer.container.getBoundingClientRect(),a=e.right-e.left;A=s.right-e.right<a||n,A&&S(r,!0),t=Math.round((A?e.left:e.right)-s.left),i=Math.round(e.top-s.top),this.addSubmenuCallbackToMenuItem(r,w.target,t,i,A)}if(o.length>0&&A){const e=l.children;for(let t=0;t<e.length;t++){const i=e[t];i.children.length>2&&-1!==i.children[2].className.indexOf("menu-item-expand")&&S(i,!1)}}this.container.addEventListener("touchend",this._onDOMevent),this.container.addEventListener("mousedown",this._onDOMevent),this.container.addEventListener("mouseup",this._onDOMevent),O()||this.container.addEventListener("mousemove",this._onDOMevent)},TR.prototype._onDOMevent=function(e){switch(e.type){case"touchend":this._isContextMenu(e)||this.hide();break;case"mousedown":this._startX=e.clientX,this._startY=e.clientY;break;case"mouseup":this._isContextMenu(e)||(this.hide(),Ka.isRightClick(e)&&e.clientX===this._startX&&e.clientY===this._startY&&this.viewer.triggerContextMenu(e));break;case"mousemove":{if(!this.currentItem||this.menus.length<2)break;const t=this._isInside(e,this.currentItem),i=this._isInside(e,this.menus[1]);t||i?this.currentItem.backgroundColor&&(this.currentItem.style.backgroundColor=this.currentItem.backgroundColor):(this.hideMenu(this.menus[1]),this.currentItem.style.backgroundColor=null,this.currentItem=null);break}}},TR.prototype.createMenuItem=function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var r=this.getDocument().createElement("div");return r.className="menu-item",i=i||"",this.setMenuItemIcon(r,t),this.setMenuItemText(r,e),this.setMenuExpand(r,!1,n),this.setMenuItemShortcut(r,i),r},TR.prototype.createDivider=function(){var e=this.getDocument(),t=e.createElement("div");t.className="menu-divider-container";var i=e.createElement("div");return i.className="menu-divider",t.appendChild(i),t},TR.prototype.setMenuItemIcon=function(e,t){var i=this.getDocument().createElement("div");i.classList.add("menu-item-icon"),t&&i.classList.add(t),e.appendChild(i)},TR.prototype.setMenuItemText=function(e,t){var i=this.getDocument().createElement("div");i.classList.add("menu-item-text"),i.setAttribute("data-i18n",t),i.textContent=hs.t(t),e.appendChild(i)},TR.prototype.setMenuItemShortcut=function(e,t){var i=this.getDocument().createElement("div");i.classList.add("menu-item-shortcut"),i.textContent=t,e.appendChild(i)},TR.prototype.setMenuExpand=function(e,t,i){var n=this.getDocument().createElement("div");n.classList.add("menu-item-expand"),t?(n.style.transform="scale(-1)",e.insertBefore(n,e.childNodes[0])):e.appendChild(n);const r=0|i;n.style.opacity=r},TR.prototype.addCallbackToMenuItem=function(e,t){var i=this;e.addEventListener("click",(function(e){return i.hide(),t(),e.preventDefault(),!1}),!1)},TR.prototype.addSubmenuCallbackToMenuItem=function(e,t,i,n,r){var o=this;t.isChild=!0,O()?e.addEventListener("click",(function(){o.open=!0,o.currentItem=e,o.showMenu(t,i,n,r)}),!1):e.addEventListener("mouseenter",(function(){o.open=!0,o.currentItem=e;const s=o.getWindow().getComputedStyle(o.currentItem).getPropertyValue("background-color");o.currentItem.backgroundColor=s,o.showMenu(t,i,n,r)}),!1)},TR.prototype.hideMenu=function(e){const t=e=>{e.removeEventListener("touchend",this._onDOMevent),e.removeEventListener("mousedown",this._onDOMevent),e.removeEventListener("mouseup",this._onDOMevent),O()||e.removeEventListener("mousemove",this._onDOMevent),e.parentNode.removeChild(e)};e&&-1!==this.menus.indexOf(e)&&e.parentNode&&(t(e.parentNode),this.menus.splice(this.menus.indexOf(e),1)),0===this.menus.length?(this.open=!1,this.container=null):1===this.menus.length&&(this.container=this.menus[0].parentNode)},TR.prototype.hide=function(){if(this.open){for(;this.menus.length>0;)this.hideMenu(this.menus[0]);return this.onHide&&this.onHide(),!0}return!1},TR.prototype._isContextMenu=function(e){for(let i=0;i<this.menus.length;i++){const n=this.menus[i];for(var t=e.target;t!==this.container;){if(t===n)return!0;t=t.parentNode}}return!1},TR.prototype._isInside=function(e,t){var i=this.viewer.container.getBoundingClientRect();Array.isArray(e.changedPointers)&&e.changedPointers.length>0&&(e.clientX=e.changedPointers[0].clientX,e.clientY=e.changedPointers[0].clientY);var n=Math.ceil(e.clientX-i.left),r=Math.ceil(e.clientY-i.top);const o=t.getBoundingClientRect(),s=Math.floor(o.top-i.top)-1,a=Math.floor(o.left-i.left)-1,l=Math.ceil(o.bottom-i.top),c=Math.ceil(o.right-i.left);return r>=s&&r<=l&&n>=a&&n<=c};let MR=c(),IR=MR.document;function PR(){}function LR(e,t,i){this.myDelegate=e,this.mySelectedIds=[];var n="browserview";this.myRootContainerId=i+"-"+n,this.idToElement={},this.myRootContainer=IR.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add(n),IR.getElementById(i).appendChild(this.myRootContainer),this.createElements(t,this.myRootContainer)}PR.prototype.constructor=PR,PR.prototype.getNodeId=function(e){throw"getId is not implemented."},PR.prototype.getNodeLabel=function(e){return e.name},PR.prototype.getNodeClass=function(e){return""},PR.prototype.hasThumbnail=function(e){return!1},PR.prototype.getThumbnailOptions=function(e){return null},PR.prototype.getThumbnail=function(e){return null},PR.prototype.onNodeClick=function(e,t,i){},PR.prototype.onNodeHover=function(e,t,i){},PR.prototype.selectItem=function(e){},PR.prototype.deselectItem=function(e){},PR.prototype.hasContent=function(e){return!1},PR.prototype.addContent=function(e,t){},LR.prototype.constructor=LR,LR.prototype.show=function(e){e?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},LR.prototype.getRootContainer=function(){return this.myRootContainer},LR.prototype.delegate=function(){return this.myDelegate},LR.prototype.addToSelection=function(e){var t=this;function i(e){return-1==t.mySelectedIds.indexOf(e)&&(t.mySelectedIds.push(e),!0)}for(var n=0,r=e.length;n<r;++n){var o=e[n];if(i(o)){var s=t.idToElement[o];void 0===s?t.myDelegate.selectItem(o):s.classList.add("selected")}}},LR.prototype.removeFromSelection=function(e){var t=this;function i(e){var i=t.mySelectedIds.indexOf(e);return-1!=i&&(t.mySelectedIds.splice(i,1),!0)}for(var n=e.length-1;n>=0;--n){var r=e[n];if(i(r)){var o=this.idToElement[r];void 0===o?t.myDelegate.deselectItem(r):o.classList.remove("selected")}}},LR.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(e),this.mySelectedIds},LR.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},LR.prototype.createElements=function(e,t){if(e)for(var i=0;i<e.length;i++){var n=e[i];this.createElement(n,t)}},LR.prototype.createElement=function(e,t){var i=this,n=i.myDelegate.getNodeId(e),r=IR.createElement("item");t.appendChild(r),this.idToElement[n]=r,r.onmouseover=function(){i.myDelegate.onNodeHover(i,e)},r.onclick=function(t){i.myRootContainer.querySelector(".flipped").removeClass("flipped"),i.myDelegate.onNodeClick(i,e,t)};var o=IR.createElement("div");o.classList.add("card"),r.appendChild(o);var s=IR.createElement("div");s.classList.add("browserElement"),o.appendChild(s);var a=i.myDelegate.getNodeLabel(e),l=IR.createElement("label");l.innerHTML=a,s.appendChild(l),l.onclick=function(t){i.myDelegate.onNodeClick(i,e,t)};var c=i.myDelegate.getThumbnail(e);if(c){var u=IR.createElement("img");u.classList.add("thumb");var h=i.myDelegate.getThumbnailOptions(e);Uy.requestThumbnailWithSecurity(h,(function(e,t){e?rt.error("Failed to load thumbnail: "+c,at(st.NETWORK_FAILURE)):(u.src=MR.URL.createObjectURL(t),u.onload=function(){MR.URL.revokeObjectURL(u.src)})})),s.appendChild(u),u.onclick=function(t){i.myDelegate.onNodeClick(i,e,t)}}i.myDelegate.hasContent(e)&&i.myDelegate.addContent(e,o),r.classList.add(i.myDelegate.getNodeClass(e))};var RR=r(15227);RR.externalExtensions.push({src:"./extensions/DiffTool/DiffTool.js",ids:["Autodesk.DiffTool"]}),RR.externalExtensions.forEach((e=>{let t=(0,RR.getExtensionEntryKey)(e),i=`extensions/${t}/${t}.min.js`,n=e.dependencies;e.ids.forEach((e=>{za.registerExternalExtension(e,i,n)}))}));const DR=Bi.Lang,OR=Us,BR=Ka.isMiddleClick,NR=Ka.isRightClick,UR=$,kR=globalThis.ENABLE_DEBUG;let FR=!0;function VR(e){FR=e}function GR(e){this.viewer=e,this.setGlobalManager(e.globalManager),this.contextMenu=new TR(e)}function zR(e){GR.call(this,e)}GR.prototype.constructor=GR,fo.call(GR.prototype),GR.prototype.show=function(e){const t=this.viewer.getSelectionCount(),i=this.viewer.getSelectionVisibility(),n=this.viewer.impl.getCanvasBoundingClientRect(),r=n.width,o=n.height,s=e.clientX-n.left,a=e.clientY-n.top,l={event:e,numSelected:t,hasSelected:0<t,hasVisible:i.hasVisible,hasHidden:i.hasHidden,canvasX:s,canvasY:a,normalizedX:s/r*2-1,normalizedY:(o-a)/o*2-1},c=this.buildMenu(e,l);this.viewer.runContextMenuCallbacks(c,l),c&&0<c.length&&this.contextMenu.show(e,c)},GR.prototype.hide=function(){return this.contextMenu.hide()},GR.prototype.buildMenu=function(){return null},zR.prototype=Object.create(GR.prototype),zR.prototype.constructor=zR,zR.prototype.buildMenu=function(e,t){if(!this.viewer.model)return;var i=this,n=[],r=this.viewer.navigation,o=this.viewer.model.is2d();const s=Autodesk.Viewing.Private.analytics;t.hasSelected&&(n.push({title:"Isolate",target:function(){var e=i.viewer.getAggregateSelection();i.viewer.clearSelection(),i.viewer.impl.visibilityManager.aggregateIsolate(e),rt.track({name:"isolate_count",aggregate:"count"}),s.track("viewer.object.visibility",{action:"Isolate"})}}),t.hasVisible&&n.push({title:"Hide Selected",target:function(){const e=i.viewer.impl.selector.getAggregateSelection();i.viewer.clearSelection(),i.viewer.impl.visibilityManager.aggregateHide(e),s.track("viewer.object.visibility",{action:"Hide Selected"})}}),t.hasHidden&&n.push({title:"Show Selected",target:function(){var e=i.viewer.getSelection();i.viewer.clearSelection(),i.viewer.show(e),s.track("viewer.object.visibility",{action:"Show Selected"})}})),o&&n.push({title:"Show All Layers",target:function(){i.viewer.setLayerVisible(null,!0),s.track("viewer.object.visibility",{action:"Show All Layers"})}}),n.push({title:"Show All Objects",target:function(){i.viewer.showAll(),rt.track({name:"showall",aggregate:"count"}),s.track("viewer.object.visibility",{action:"Show All Objects"})}});var a=i.viewer.getAggregateSelection();if(!o&&1===a.length&&r.isActionEnabled("gotoview")&&n.push({title:"Focus",target:function(){if((a=i.viewer.getAggregateSelection()).length>0){var e=a[0];i.viewer.fitToView(e.selection,e.model)}else 0===a.length&&i.viewer.fitToView();rt.track({name:"fittoview",aggregate:"count"})}}),!o){var l=this.viewer.impl.getCanvasBoundingClientRect(),c=e.clientX-l.left,u=e.clientY-l.top,h=this.viewer.clientToWorld(c,u,!1);h&&n.push({title:"Pivot",target:()=>{this.viewer.navigation.setPivotPoint(h.point)}})}return t.hasSelected&&n.push({title:"Clear Selection",target:function(){i.viewer.clearSelection(),rt.track({name:"clearselection",aggregate:"count"})}}),n};var HR=r(31320),WR=r.n(HR);const jR=Autodesk.Viewing.UI;function qR(e){if(!(e instanceof jR.DockingPanel))throw new Error("Invalid docking panel");this.dockingPanel=e;let t=this.dockingPanel.getDocument();this.datatableDiv=t.createElement("div"),this.datatableDiv.setAttribute("id","datatable"),this.datatableDiv.setAttribute("class","datatable"),e.container.appendChild(this.datatableDiv),e.footerInstance&&(e.footerInstance.resizeCallback=this._fitHeaderColumns.bind(this)),this.groupedByColumn=!1,this.aggregated=!1}function KR(e,t){this._id=e,this._listeners={},this._options=t||{},this._filterFunction=this._options.filterFunction||function(){};var i=this.getDocument();this.container=i.createElement("div"),this.container.id=e,this.addClass("adsk-control"),this.addClass("adsk-filterbox"),this.addClass("empty");var n=i.createElement("input");n.classList.add("filter-box"),n.classList.add("docking-panel-delimiter-shadow"),n.type="search",n.placeholder=hs.t("Enter filter term"),n.setAttribute("data-i18n","Enter filter term"),n.incremental="incremental",n.autosave=this.container.id+"filter",this.container.appendChild(n),this.filterbox=n;var r=this,o=function(e){0===(e=e.trim()).length?r.container.classList.add("empty"):r.container.classList.remove("empty"),r._filterFunction&&r._filterFunction(e)},s=i.createElement("div");s.className="filter-box-icon",this.container.insertBefore(s,n.nextSibling);var a=i.createElement("div");a.className="filter-box-close",a.addEventListener("click",(function(){r.filterbox.value="",r.addClass("empty")})),this.container.appendChild(a),n.addEventListener("keydown",(function(e){var t=r.getWindow();13===(e=e||t.event).keyCode&&r.filterbox.blur()})),n.addEventListener("input",(function(){o(this.value)})),n.addEventListener("change",(function(){o(this.value)})),n.addEventListener("focus",(function(){s.classList.add("focused")})),n.addEventListener("blur",(function(){s.classList.remove("focused")}))}qR.prototype._createColumns=function(e){let t=this.dockingPanel.getDocument();var i=t.createElement("div");i.setAttribute("id","columnArea"),i.setAttribute("class","clusterize-headers");var n='<table id="headersArea"><thead><tr id ="columnRow"></tr></thead></table>';i.innerHTML=n,this.datatableDiv.appendChild(i);var r=i.querySelector("tr");e.forEach((function(e){var i=t.createElement("th");i.appendChild(t.createTextNode(e)),r.appendChild(i)})),n=this.datatableDiv.querySelector("table"),this._makeTableSortable(n)},qR.prototype._createRows=function(){var e=this.dockingPanel.getDocument().createElement("div");e.innerHTML='<div id="scrollArea" class="clusterize-scroll"><table id="bodyArea" class="table-striped"><tbody id="contentArea" class="clusterize-content"><tr class="clusterize-no-data"><td>Loading data</td></tr></tbody></table></div>',this.datatableDiv.appendChild(e)},qR.prototype.setData=function(e,t){if(t.length!==e[0].length)throw new Error("Column length should be same as the row length");this._createColumns(t),this._createRows();var i=this;this.rowData=e,this.clusterize=new(WR())({rows:this.rowData.map((function(e){return"<tr>"+e.map((function(e){return"<td>"+e+"</td>"})).join(" ")+"</tr>"})),scrollId:"scrollArea",contentId:"contentArea",callbacks:{clusterChanged:function(){i._fitHeaderColumns(),i._syncHeaderWidth(),i.groupedByColumn&&i._updateClusterGroup()}}}),this.datatableDiv.querySelector(".clusterize-scroll").addEventListener("scroll",(function(){var e=this.scrollLeft;n(e)}));var n=function(e){i.datatableDiv.querySelector("#headersArea").style.setProperty("margin-left",-e+"px")}},qR.prototype.destroyTable=function(){this.clusterize.destroy(!0),this.clusterize=null,this.rowData=null,this.groupedByColumn=!1},qR.prototype._makeTableSortable=function(e){var t,i=this,n=e.tHead;if(n&&n.rows[0]&&(n=n.rows[0].cells),n)for(t=n.length;--t>=0;)!function(e){var t=1;n[e].addEventListener("click",(function(){i._sortTable(e,t=1-t)}))}(t)},qR.prototype._sortTable=function(e,t){var i=this.rowData;this.sortFunction||this.restoreDefaultSortFunction();var n=this.sortFunction&&this.sortFunction.bind(this),r=(i=i.sort(n(e,t))).map((function(e){return"<tr>"+e.map((function(e){return"<td>"+e+"</td>"})).join(" ")+"</tr>"}));this.clusterize.update(r);var o=this.datatableDiv.querySelector("#bodyArea");o.classList.contains("table-striped")||o.classList.add("table-striped")},qR.prototype.setSortFunction=function(e){this.sortFunction=e},qR.prototype.getSortFunction=function(){return this.sortFunction},qR.prototype.restoreDefaultSortFunction=function(){this.sortFunction=function(e,t){return t=-(+t||-1),function(i,n){return t*i[e].localeCompare(n[e])}}},qR.prototype.getGroupByColumn=function(e){var t=this.rowData,i={};for(let r=0;r<t.length;r++){var n=t[r][e];i[n]||(i[n]=[]),i[n].push(r)}return i},qR.prototype.groupByColumn=function(e){var t=this.rowData,i={};for(let r=0;r<t.length;r++){let o=t[r];var n=o[e];if(i[n]||(i[n]=[]),i[n].length>0)o="<tr class= 'subrow'>"+o.map((function(e){return"<td>"+e+"</td>"})).join(" ")+"</tr>";else{const e=o.length;o="<tr class= 'parentrow'>"+o.map((function(t,i){return e===i+1?"<td>"+t+'<span value="click"></span></td>':"<td>"+t+"</td>"})).join(" ")+"</tr>"}i[n].push(o)}var r=[];for(let e in i){var o=i[e];for(let e=0;e<o.length;e++){let t=o[e];r.push(t)}}this.clusterize.update(r);var s=this.datatableDiv.querySelector("#bodyArea");s.classList.contains("table-striped")&&s.classList.remove("table-striped"),this.datatableDiv.querySelectorAll(".subrow").forEach((e=>{this._slideDown(e),e.style.fontSize="14px"}));var a=this._fitHeaderColumns.bind(this),l=this._expandContent.bind(this);this.datatableDiv.querySelectorAll("span").forEach((e=>{e.addEventListener("click",(function(e){l(this,e),a()}))})),this._fitHeaderColumns(),this.groupedByColumn||(this.groupedByColumn=!0)},qR.prototype._updateClusterGroup=function(){var e=this._fitHeaderColumns.bind(this),t=this._expandContent.bind(this);this.datatableDiv.querySelectorAll("span").forEach((i=>{i.addEventListener("click",(function(i){t(this,i),e()}))})),this.datatableDiv.querySelectorAll(".subrow").forEach((e=>{this._slideDown(e),e.style.fontSize="14px"}))},qR.prototype._expandContent=function(e){var t=!1;"collapsed"===e.className&&(t=!0);var i=t?14:0,n=e.closest("tr"),r=this._nextUntil(n,":not(.subrow)");for(let e=0;e<r.length;e++)this._slideToggle(r[e],500),r[e].style.fontSize=i+"px";e.classList.toggle("collapsed")},qR.prototype._nextUntil=function(e,t,i){var n=[];for(e=e.nextElementSibling;e&&!e.matches(t);)!i||e.matches(i)?(n.push(e),e=e.nextElementSibling):e=e.nextElementSibling;return n},qR.prototype._slideToggle=function(e,t){return"none"===this.dockingPanel.getWindow().getComputedStyle(e).display?this._slideDown(e,t):this._slideUp(e,t)},qR.prototype._slideUp=function(e,t){e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.boxSizing="border-box",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")},qR.prototype._slideDown=function(e,t){let i=this.dockingPanel.getWindow();e.style.removeProperty("display");let n=i.getComputedStyle(e).display;"none"===n&&(n="block"),e.style.display=n;e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,e.offsetHeight,e.style.boxSizing="border-box",e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height="21pxpx",e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),i.setTimeout((()=>{e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)},qR.prototype.getAggregate=function(e,t){var i,n=this.rowData,r=null;switch(e){case"MIN":r=function(){var e=n[0][t];for(let i=1;i<n.length;i++)e>n[i][t]&&(e=n[i][t]);return e||0}();break;case"MAX":r=function(){var e=n[0][t];for(let i=1;i<n.length;i++)e<n[i][t]&&(e=n[i][t]);return e||0}();break;case"SUM":r=o();break;case"AVG":i=o()/n.length,r=(i=parseFloat(i))||0;break;case"COUNT":r=n.length}return r;function o(){var e=0;for(let i=0;i<n.length;i++)e+=parseFloat(n[i][t]);return e||0}},qR.prototype.aggregate=function(e,t){var i=this.datatableDiv.querySelector(".clusterize-content").querySelector("tr:not(.clusterize-extra-row):not(.first)");if(!i)return;for(var n=[],r=0;r<i.children.length;r++)n.push(i.children[r].clientWidth);var o=this.getAggregate(e,t);let s=this.dockingPanel.getDocument();if(!this.aggregated){var a=s.createElement("div");a.setAttribute("id","aggregate"),a.setAttribute("class","aggregate-headers");a.innerHTML='<table id="aggregateArea"><tbody></tbody></table>',this.datatableDiv.appendChild(a)}for(var l=this.datatableDiv.querySelector("#aggregateArea"),c=0;c<l.rows.length;c++){if(l.rows[c].cells[t].innerText.indexOf(e)>-1)return}for(var u=0;u<l.rows.length;u++){var h=l.rows[u].cells[t];if(0===h.innerText.length)return h.appendChild(s.createTextNode(e+": ")),void h.appendChild(s.createTextNode(o))}for(var d=l.insertRow(l.rows.length),f=0;f<n.length;f++){var p=s.createElement("td");d.appendChild(p),p.style.setProperty("min-width",n[f]+"px","important"),f===t&&(p.appendChild(s.createTextNode(e+": ")),p.appendChild(s.createTextNode(o)))}this.aggregated=!0},qR.prototype.clearAggregates=function(){for(var e=this.datatableDiv.querySelectorAll(".aggregate-headers"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},qR.prototype._fitHeaderColumns=function(){var e=this.datatableDiv.querySelector(".clusterize-content"),t=this.datatableDiv.querySelector("#headersArea"),i=e.querySelector("tr:not(.clusterize-extra-row):not(.first)");if(i){for(var n=[],r=[],o=0;o<i.children.length;o++)r.push(i.children[o].clientWidth);if(r.toString()!=n.toString()){for(var s=t.querySelector("tr"),a=0;a<s.children.length;a++)s.children[a].style.setProperty("clientWidth",r[a]+"px","important"),s.children[a].style.setProperty("min-width",r[a]+"px","important");if(this.aggregated)for(var l=this.datatableDiv.querySelector("#aggregateArea"),c=0;c<l.rows.length;c++)for(var u=l.rows[c],h=0;h<u.children.length;h++)u.children[h].style.setProperty("clientWidth",r[h]+"px","important"),u.children[h].style.setProperty("min-width",r[h]+"px","important");n=r}}},qR.prototype._syncHeaderWidth=function(){var e=this.datatableDiv.querySelector(".clusterize-content"),t=this.datatableDiv.querySelector("#headersArea");t.style.setProperty("clientWidth",e.width),t.style.setProperty("min-idth",e.width)},KR.prototype=Object.create(bT.prototype),KR.prototype.constructor=KR;const XR={down:{pointer:"pointerdown",mouse:"mousedown",touch:"touchstart"},up:{pointer:"pointerup",mouse:"mouseup",touch:"touchend"},move:{pointer:"pointermove",mouse:"mousemove",touch:"touchmove"}};function YR(e,t,i){const n=(arguments.length>3&&void 0!==arguments[3]&&arguments[3]?"remove":"add")+"EventListener",r=function(e){const t=[];return Autodesk.Viewing.isMobileDevice()||t.push(XR[e].mouse),Autodesk.Viewing.isTouchDevice()&&t.push(XR[e].touch),t}(t);for(const t of r)e[n](t,i)}class QR{constructor(e,t){this.container=e,this.isDragging=!1,this.resizeHandlerElement=null,this.onMoveCB=t,this.panelSizeThreshold=20,this.margin=16,this.initResizeHandlerElement()}onDown(e){this.isDragging=!0,e.preventDefault()}onUp(e){this.isDragging=!1}onMove(e){if(this.isDragging){"touchmove"===e.type&&(e.pageX=e.touches[0].pageX,e.pageY=e.touches[0].pageY);const t=this.container.getBoundingClientRect(),i=this.getTargetWidthPercentage(e,t);this.panelSizeThreshold<i&&i<100-this.panelSizeThreshold&&this.onMoveCB(i)}}getTargetWidthPercentage(e,t){}initResizeHandlerElement(){this.resizeHandlerElement=document.createElement("div"),this.handlerSplitLine=document.createElement("div"),this.resizeHandlerElement.appendChild(this.handlerSplitLine),YR(this.resizeHandlerElement,"down",this.onDown.bind(this)),this.onUpBinded=this.onUp.bind(this),this.onMoveBinded=this.onMove.bind(this),YR(document,"move",this.onMoveBinded),YR(document,"up",this.onUpBinded),this.resizeHandlerElement.className="resize-handler",this.handlerSplitLine.className="resize-handler-center-mark"}setPosition(e){}terminate(){this.resizeHandlerElement.parentNode.removeChild(this.resizeHandlerElement),this.resizeHandlerElement=null,YR(document,"up",this.onUpBinded,!0),YR(document,"move",this.onMoveBinded,!0)}}class ZR extends QR{initResizeHandlerElement(){super.initResizeHandlerElement(),this.resizeHandlerElement.classList.add("vertical"),this.handlerSplitLine.classList.add("vertical"),this.resizeHandlerElement.style.width=`${this.margin}px`}getTargetWidthPercentage(e,t){return(e.pageX-t.left)/t.width*100}setPosition(e){this.resizeHandlerElement.style.left=`calc(${e}% - ${this.margin/2}px)`}}class $R extends QR{initResizeHandlerElement(){super.initResizeHandlerElement(),this.resizeHandlerElement.classList.add("horizontal"),this.handlerSplitLine.classList.add("horizontal"),this.resizeHandlerElement.style.height=`${this.margin}px`}getTargetWidthPercentage(e,t){return(e.pageY-t.top)/t.height*100}setPosition(e){this.resizeHandlerElement.style.top=`calc(${e}% - ${this.margin/2}px)`}}class JR{constructor(e){this._splitType=e||JR.SplitType.Vertical,this.onResizeHandlerMove=this.onResizeHandlerMove.bind(this)}createSplitViewLayout(e,t,i){if(this.targetContainer=e,this.splitViewContainer=document.createElement("div"),this.splitViewContainer.classList.add("split-view-container"),this.targetContainer.parentNode.replaceChild(this.splitViewContainer,this.targetContainer),this.firstViewerContainer=this.wrapViewerContainer(t),this._splitType===JR.SplitType.Vertical)this._resizeHandler=new ZR(this.splitViewContainer,this.onResizeHandlerMove);else{if(this._splitType!==JR.SplitType.Horizontal)return void console.error("unknown splitType");this._resizeHandler=new $R(this.splitViewContainer,this.onResizeHandlerMove)}this._resizeHandler&&this.splitViewContainer.appendChild(this._resizeHandler.resizeHandlerElement),this.secondViewerContainer=this.wrapViewerContainer(i),this.onResizeHandlerMove(50)}wrapViewerContainer(e){const t=document.createElement("div");return t.className="split-view-viewer-container",e&&t.appendChild(e),this.splitViewContainer.appendChild(t),t}restoreMainViewer(){this._resizeHandler&&(this._resizeHandler.terminate(),this._resizeHandler=null),this.splitViewContainer&&(this.splitViewContainer.parentNode.replaceChild(this.targetContainer,this.splitViewContainer),this.splitViewContainer=null,this.targetContainer=null,this.firstViewerContainer=null,this.secondViewerContainer=null)}onResizeHandlerMove(e){this._resizeHandler&&this._resizeHandler.setPosition(e),this._splitType===JR.SplitType.Vertical?(this.firstViewerContainer.style.width=`${e}%`,this.secondViewerContainer.style.width=100-e+"%",this.secondViewerContainer.style.left=`${e}%`):this._splitType===JR.SplitType.Horizontal&&(this.firstViewerContainer.style.height=`${e}%`,this.secondViewerContainer.style.height=100-e+"%",this.secondViewerContainer.style.top=`${e}%`)}}JR.SplitType={Vertical:"vertical",Horizontal:"horizontal"},hs.translate=hs.t.bind(hs),hs.localize=()=>{};const eD=oy,tD={};var iD=Object.assign||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])};iD(tD,e),tD.MeasurementTypes=CC,tD.MeasurementTypesToAnalytics=TC,tD.SnapType=wC,tD.Events={MEASUREMENT_CHANGED_EVENT:"measurement-changed",MEASUREMENT_COMPLETED_EVENT:"measurement-completed",UNITS_CALIBRATION_STARTS_EVENT:"units_calibration_starts_event",FINISHED_CALIBRATION_FOR_DIMENSION_EVENT:"finished_calibration_for_dimension_event",CALIBRATION_REQUIRED_EVENT:"calibration-required",OPEN_CALIBRATION_PANEL_EVENT:"open-calibration-panel",CLOSE_CALIBRATION_PANEL_EVENT:"close-calibration-panel",CLEAR_CALIBRATION_SIZE_EVENT:"clear-calibration-size",FINISHED_CALIBRATION:"finished-calibration",DISPLAY_UNITS_CHANGED:"display-units-changed",PRECISION_CHANGED:"precision-changed",MEASUREMENT_MODE_ENTER:"measure-mode-enter",MEASUREMENT_MODE_LEAVE:"measure-mode-leave",DELETE_MEASUREMENT:"delete-measurement",SELECT_MEASUREMENT:"select-measurement",MEASURE_TOOL_ACTIVE:"measure-tool-active"},tD.Measurement=sT,tD.SnapResult=tT;const nD=d.Autodesk,rD={},oD={},sD={},aD={},lD=v(),cD={Autodesk:nD,av:rD,avp:oD,avu:sD,ave:aD,THREE:lD};p(cD,t,"avp"),p(cD,n,"avu"),p(cD,i,"ave"),p(cD,s,"av",["Private","UI","Extensions"]);const uD=cD;(function(e){var t=Autodesk.Viewing,i=t.Private,n=t.UI,r=t.Extensions;let o=function(t,i,n){e[n]instanceof Object?t[n]=i[n]:Object.defineProperty(t,n,{get:()=>i[n],set(e){i[n]=e},enumerable:!0,configurable:!0})};for(let i in e.av)o(t,e.av,i);for(let t in e.avp)o(i,e.avp,t);for(let t in e.avu)o(n,e.avu,t);for(let t in e.ave)o(r,e.ave,t);t.getGlobal().THREE=e.THREE,t.getGlobal().LMV=e,i.isRightClick=t.isRightClick,i.isMiddleClick=t.isMiddleClick})(cD)})(),LMV=o})();
//# sourceMappingURL=viewer3D.min.js.map