/*!
 * LMV v7.105.0
 *
 * Copyright 2025 Autodesk, Inc.
 * All rights reserved.
 *
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 *
 * Autodesk Viewer SDK Usage Limitations:
 *
 * The Autodesk Viewer SDK JavaScript must be delivered from an
 * Autodesk-hosted URL.
 */(()=>{var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{default:()=>c});const i={radiansToDegrees:e=>e*(180/Math.PI),degreesToRadians:e=>e*(Math.PI/180),applyRotation:(e,t,i,n)=>{e instanceof Array||(e=[e]),e.forEach((e=>{e.sub(i),e.applyAxisAngle(n,t),e.add(i)}))},getSignedAngle:(e,t,i)=>{const n=e.angleTo(t),s=e.clone().cross(t).normalize();return n*(i.dot(s)>0?1:-1)},swapBoundingBoxY:e=>([e.max.y,e.min.y]=[e.min.y,e.max.y],e)},n=i,s={worldToClient:(e,t,i)=>{var n=new THREE.Vector4(t.x,t.y,t.z,1);return n.applyMatrix4(i.matrixWorldInverse),n.applyMatrix4(i.projectionMatrix),n.w>0&&(n.x/=n.w,n.y/=n.w,n.z/=n.w),e.impl.viewportToClient(n.x,n.y)},getCameraEyeVector:e=>e.target.clone().sub(e.position).normalize(),getCameraRightVector:e=>{const t=s.getCameraEyeVector(e);return(new THREE.Vector3).crossVectors(t,e.up).normalize()},getCameraUpVector:e=>{const t=s.getCameraRightVector(e),i=s.getCameraEyeVector(e);return(new THREE.Vector3).crossVectors(t,i).normalize()},getCameraRotation:e=>n.getSignedAngle(s.getCameraUpVector(e),new THREE.Vector3(0,1,0),s.getCameraEyeVector(e))},r=s,o={getModelExtension:e=>{const t=e&&e.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/);return t?t[1]:null}},a=o;class h{constructor(e){this.viewer=e.viewer,this.navigationDistance=this.viewer.impl.is2d?50:350,this.navigationVelocity=this.viewer.impl.is2d?.7:1.1,this.documents=e.documents,this.sheets=e.sheets,this.extension=e,this.names=["gesture-document-navigation"],this.leftDirection=new THREE.Vector3(1,0,0),this.rightDirection=new THREE.Vector3(-1,0,0),this.upDirection=new THREE.Vector3(0,1,0),this.downDirection=new THREE.Vector3(0,-1,0),this.eyeVector=new THREE.Vector3(0,0,1),this.currentDirection=null}getNames(){return this.names}getName(){return this.names[0]}activate(e){e===this.getName()&&(this.isActive=!0)}deactivate(e){e===this.getName()&&(this.isActive=!1)}isActive(){return this.isActive}getPriority(){return 100}_isCanvasContainsViewport(){const e=Autodesk.Viewing.ScreenShot.getSceneClientBounds(this.viewer,this.viewer.navigation.getCamera()),t=this.viewer.impl.getCanvasBoundingClientRect();return e.min.x>t.left&&e.max.x<t.right&&e.min.y>t.height-t.bottom&&e.max.y<t.height-t.top}onDrag(e){const t=new THREE.Vector3(e.canvasX,e.canvasY,0).sub(this.startPoint),i=t.length();let s=n.getSignedAngle(t,this.leftDirection,this.eyeVector);s<0&&(s+=2*Math.PI);let r,o,a=null;s>5/4*Math.PI&&s<7/4*Math.PI&&this.sheets.length>1?(this.currentDirection=this.upDirection,0===this.extension.currentSheetIndex?this.extension.options.enableCyclicSwipe&&(a=this.sheets.length-1):a=this.extension.currentSheetIndex-1,r=!0):s>1/4*Math.PI&&s<=3/4*Math.PI&&this.sheets.length>1?(this.currentDirection=this.downDirection,this.extension.currentSheetIndex===this.sheets.length-1?this.extension.options.enableCyclicSwipe&&(a=0):a=this.extension.currentSheetIndex+1,r=!0):s>3/4*Math.PI&&s<=5/4*Math.PI&&this.documents.length>1?(this.currentDirection=this.leftDirection,this.extension.currentDocumentIndex===this.documents.length-1?this.extension.options.enableCyclicSwipe&&(a=0):a=this.extension.currentDocumentIndex+1,o=!0):(s>7/4*Math.PI||s<=1/4*Math.PI)&&this.documents.length>1&&(this.currentDirection=this.rightDirection,0===this.extension.currentDocumentIndex?this.extension.options.enableCyclicSwipe&&(a=this.documents.length-1):a=this.extension.currentDocumentIndex-1,o=!0);const h=null!==a&&(r||o);if(h&&i>=this.navigationDistance){if(r){const{guid:e}=this.sheets[a];this.extension.changeSheetRequired(e)}else if(o){const{urn:e,guid:t}=this.documents[a];this.extension.changeDocumentRequired(e,t)}this.changing=!0}return h}_isSwipeEnabled(){return this.viewer.model.is3d()||this._isCanvasContainsViewport()}handleGesture(e){switch(e.type){case"dragstart":return this.isSwipeEnabled=this._isSwipeEnabled(),this.isSwipeEnabled&&(this.startPoint=new THREE.Vector3(e.canvasX,e.canvasY,0)),this.swiping=!1,this.changing=!1,!1;case"dragmove":return!!this.changing||!!(this.swiping||this.isSwipeEnabled&&Math.abs(e.overallVelocity)>this.navigationVelocity)&&(this.swiping=!0,this.onDrag(e));case"dragend":return this.changing&&this.viewer.model.is3d()}return!1}}class c extends Autodesk.Viewing.Extension{async load(){const e=this.viewer.impl.model.getDocumentNode(),t=e.getRootNode().lmvDocument;this.currentGuid=e.guid(),this.currentUrn=t.myData.urn,this.documents=[{urn:this.currentUrn,guid:this.currentGuid}];const i=(e=>{const t=e.getRoot().findAllViewables()[0],i=a.getModelExtension(t.name());function n(e,t){if("folder"!==e.type()&&"view"!==e.type()&&"geometry"!==e.type())return null;if("geometry"===e.type()&&e.data.role!==t)return null;const i={guid:e.guid(),name:e.name(),type:e.type()};if("geometry"===e.type()&&(i.order=e.data.order,i.status=e.data.status,i.role=e.data.role,i.hasThumbnail=e.data.hasThumbnail&&"true"===e.data.hasThumbnail.toLowerCase()),e.children){const s=e.children.map((e=>n(e,t))).filter((e=>!!e));s.length>0&&(i.children=s)}return"folder"!==e.type()||i.children?i:null}const s=e=>{if(!e)return[];const t=new Autodesk.Viewing.BubbleNode(e).search({type:"geometry"});return t?t.map((e=>e.data)):null},r=e=>(e.forEach((e=>{"pdf"===i&&e.children&&e.children.length>1&&(e.children=[e.children[0]])})),"pdf"===i?e.sort((function(e,t){return e.order-t.order})):e.sort((function(e,t){return e.name.localeCompare(t.name)})),e),o=e=>e.filter((e=>!("nwd"===i&&"2d"===e.role)));if("pdf"===i)return[{type:"PDF",sheets:o(r(s(n(t,"2d"))))}];{const e=o(r(s(n(t,"3d"))));return[{type:"2D",sheets:o(r(s(n(t,"2d"))))},{type:"3D",sheets:e}]}})(t),n=i[0]&&i[0].sheets||[],s=i[1]&&i[1].sheets||[];this.sheets=[...n,...s],this.pivot=new THREE.Vector3,this.currentSheetIndex=this.sheets.findIndex((e=>e.guid===this.currentGuid)),this.updateCurrentDocumentIndex(),this.tool=new h(this),this.viewer.toolController.registerTool(this.tool);const r=this.viewer.toolController.setIsLocked(!1);this.viewer.toolController.activateTool(this.tool.getName()),this.viewer.toolController.setIsLocked(r);const o=this.getCache();if(this.viewer.impl.is2d){if(this.viewer.fitToView(void 0,void 0,!0),o.direction){const e=this.getTranslation(o.direction),t=e.clone().negate();await this.translateCamera(t,!0),this.viewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,(async()=>{await this.translateCamera(e,!1),o.direction=void 0}),{once:!0})}}else o.direction=void 0;return!0}unload(){return this.tool&&(this.viewer.toolController.deregisterTool(this.tool),this.tool=null),this.viewer=null,this.options=null,!0}updateNextDocument(e,t){this.documents.push({urn:e,guid:t}),this.updateCurrentDocumentIndex()}updatePrevDocument(e,t){this.documents.unshift({urn:e,guid:t}),this.updateCurrentDocumentIndex()}updateCurrentDocumentIndex(){this.currentDocumentIndex=this.documents.findIndex((e=>e.urn===this.currentUrn&&e.guid===this.currentGuid))}async prepareChange(e){const t=()=>{this.getCache().direction=this.tool.currentDirection,e()};if(this.viewer.model.is3d())t();else{const e=this.getTranslation(this.tool.currentDirection);await this.translateCamera(e,!1),t()}}changeSheetRequired(e){this.options.enableSheetSwipe&&e&&this.prepareChange((()=>{this.viewer.dispatchEvent({type:Autodesk.Viewing.GestureDocumentNavigationEvents.CHANGE_SHEET_REQUIRED,guid:e})}))}changeDocumentRequired(e,t){e&&this.prepareChange((()=>{this.viewer.dispatchEvent({type:Autodesk.Viewing.GestureDocumentNavigationEvents.CHANGE_DOCUMENT_REQUIRED,urn:e,guid:t})}))}getTranslation(e){const t=this.viewer.getCamera(),i=Math.max(t.top-t.bottom,t.right-t.left),s=e.clone().multiplyScalar(i),o=r.getCameraRotation(t),a=r.getCameraEyeVector(t);return n.applyRotation(s,-o,this.pivot,a),s}async translateCamera(e,t){this.viewer.utilities.autocam.endInteraction();const i=this.viewer.getCamera(),n=i.position.clone().add(e),s=i.target.clone().add(e);t?this.viewer.navigation.setView(n,s):(this.viewer.navigation.setRequestTransitionWithUp(!0,n,s,i.fov,i.up),await Autodesk.Viewing.EventUtils.waitUntilTransitionEnded(this.viewer))}}Autodesk.Viewing.GestureDocumentNavigationEvents={},Autodesk.Viewing.GestureDocumentNavigationEvents.CHANGE_DOCUMENT_REQUIRED="change.document.required",Autodesk.Viewing.GestureDocumentNavigationEvents.CHANGE_SHEET_REQUIRED="change.sheet.required",c.extensionName="Autodesk.BIM360.GestureDocumentNavigation",Autodesk.Viewing.theExtensionManager.registerExtension(c.extensionName,c)})(),Autodesk.Extensions.GestureDocumentNavigation=t})();
//# sourceMappingURL=GestureDocumentNavigation.min.js.map