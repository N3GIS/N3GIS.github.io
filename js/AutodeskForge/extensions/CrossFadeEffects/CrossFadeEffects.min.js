/*!
 * LMV v7.105.0
 *
 * Copyright 2025 Autodesk, Inc.
 * All rights reserved.
 *
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 *
 * Autodesk Viewer SDK Usage Limitations:
 *
 * The Autodesk Viewer SDK JavaScript must be delivered from an
 * Autodesk-hosted URL.
 */(()=>{var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{default:()=>d});const s={DECAL:0,CROSSFADE:1};function r(e){var t=[],r=[!0,!0],i=e,a=new THREE.Color,d=[],n=s.DECAL,o=!0;this.setModelTargetIndex=function(e,t){d[e]=t},this.setSaoHeuristicEnabled=function(e){o=e},this.getRenderSao=function(e){if(!o)return!0;var t=e.modelId&&d[e.modelId];if(void 0===t)return!0;for(var s=t,r=this.getCrossFadeOpacity(t),i=0;i<2;i++){var a=this.getCrossFadeOpacity(i);a>r&&(s=i,r=a)}return s==t},this.setCrossFadeOpacity=function(e,t){var s="crossFadeOpacity"+e;i.uniforms[s].value=t},this.getCrossFadeOpacity=function(e){var t="crossFadeOpacity"+e;return i.uniforms[t].value},this.updateBlendPass=function(e){void 0===e&&(e=t.length);var s="NUM_CROSSFADE_TARGETS",r=e||void 0;i.material.defines[s]!==r&&(e?i.material.defines[s]=r:delete i.material.defines[s],i.material.needsUpdate=!0);for(var a=0;a<e;a++){var d="tCrossFadeTex"+a;i.uniforms[d].value=t[a]}var o="TARGET_FADE_MODE";i.material.defines[o]!==n&&(i.material.defines[o]=n,i.material.needsUpdate=!0)},this.setFadeMode=function(e){e===s.DECAL||e===s.CROSSFADE?(n=e,this.updateBlendPass()):console.error("Unexpected fade mode enum")},this.clearTarget=function(e){e.setClearColor(a,0);for(var s=0;s<t.length;s++)r[s]&&(e.setRenderTarget(t[s]),e.clear(!0,!0,!1))},this.setClearEnabled=function(e,t){r[e]=t},this.disposeTargets=function(){for(var e=0;e<t.length;e++){var s=t[e];s&&s.dispose(),t[e]=null}},this.dtor=function(){this.disposeTargets(),this.updateBlendPass(),this.setCrossFadeOpacity(0,0),this.setCrossFadeOpacity(1,0)},this.chooseColorTarget=function(e,s){var r=e.modelId&&d[e.modelId];return void 0===r?s:t[r]},this.updateTargets=function(e,s,r,i){for(var a=0;a<2;a++){var d=t[a];!r&&d&&d.width===e&&d.height===s||(d&&d.dispose(),(d=new THREE.WebGLRenderTarget(e,s,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:i?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1})).texture.generateMipmaps=!1,t[a]=d)}},this.beginRenderToFadeTarget=function(e,s){this.updateBlendPass(0);var r=t[e];s.setOffscreenTarget(r),this.setClearEnabled(e,!1)},this.endRenderFadeTarget=function(e){e.setOffscreenTarget(null),this.updateBlendPass()}}r.FadeMode=s;const i=Autodesk.Viewing,a=i.Private;class d extends i.Extension{constructor(e,t){super(e,t),this.crossFade=null,this.clientId=null,this.onClientChanged=null}load(){return this.setCrossFadeEnabled(!0),!0}unload(){this.setCrossFadeEnabled(!1)}acquireControl(e,t){this.clientId=e,this.onClientChanged&&this.onClientChanged(),this.onClientChanged=t}setModelTargetIndex(e,t){this.crossFade.setModelTargetIndex(e,t),this.viewer.impl.invalidate(!0)}setModelTargetIndexForAll(e){const t=this.viewer.getVisibleModels();for(let s=0;s<t.length;s++){const r=t[s];this.setModelTargetIndex(r.id,e)}}setCrossFadeOpacity(e,t){var s;this.crossFade.setCrossFadeOpacity(e,t),null===(s=this.viewer.impl)||void 0===s||s.invalidate(!0)}getCrossFadeOpacity(e){return this.crossFade.getCrossFadeOpacity(e)}setCrossFadeEnabled(e){if(e===Boolean(this.crossFade))return;let t=this.viewer.impl.renderer();if(e){let e=t.getBlendPass();this.crossFade=new r(e),t.setCrossFade(this.crossFade)}else this.crossFade.dtor(),t.setCrossFade(null);let s=t.getColorTarget();if(s){const e=this.viewer.impl.glrenderer().getPixelRatio();t.setSize(s.width/e,s.height/e)}}renderFadingImage(e,t){let s=performance.now();this.viewer.impl.tick(s);let r=this.viewer.impl.renderer();this.crossFade.beginRenderToFadeTarget(e,r),this.viewer.impl.invalidate(!0,!0,!0);let i=this.viewer.impl.targetFrameBudget;t&&(this.viewer.impl.targetFrameBudget=t),s=performance.now(),this.viewer.impl.tick(s),this.targetFrameBudget=i,this.crossFade.endRenderFadeTarget(r)}releaseFadingImage(e){this.setClearEnabled(e,!0)}setClearEnabled(e,t){this.crossFade.setClearEnabled(e,t)}fadeTarget(e,t,s,r,i){return a.fadeValue(t,s,r,(t=>{this.setCrossFadeOpacity(e,t)}),i)}fadeImage(e,t,s,i){let d=this.viewer.impl.modelQueue(),n=d.getModels().slice();for(let e=0;e<n.length;e++){let t=n[e];d.hideModel(t.id)}return this.crossFade.setFadeMode(r.FadeMode.CROSSFADE),a.fadeValue(e,t,s,(e=>{this.setCrossFadeOpacity(0,1-e),this.setCrossFadeOpacity(1,e),this.viewer.impl.renderer().presentBuffer()}),(()=>{this.crossFade.setFadeMode(r.FadeMode.CROSSFADE);for(let e=0;e<n.length;e++){let t=n[e];d.showModel(t.id)}i&&i()}))}fadeToViewerState(e,t){this.renderFadingImage(0,300),e(),this.renderFadingImage(1,300);var s=this.viewer.impl.renderer(),r=s.getAOEnabled();s.setAOEnabled(!1),this.fadeImage(0,1,t,(()=>{this.releaseFadingImage(0),this.releaseFadingImage(1),s.setAOEnabled(r)}))}}Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CrossFadeEffects",d)})(),Autodesk.Extensions.CrossFadeEffects=t})();
//# sourceMappingURL=CrossFadeEffects.min.js.map