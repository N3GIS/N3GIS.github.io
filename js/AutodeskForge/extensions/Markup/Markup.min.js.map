{"version":3,"file":"Markup/Markup.min.js","mappings":"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","sources":["webpack://Autodesk.Extensions/./extensions/Markup/core/Markups.css","webpack://Autodesk.Extensions/./extensions/Markup/gui/MarkupsGui.css","webpack://Autodesk.Extensions/./node_modules/css-loader/dist/runtime/api.js","webpack://Autodesk.Extensions/./node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/insertBySelector.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/insertStyleElement.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/styleDomAPI.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/styleTagTransform.js","webpack://Autodesk.Extensions/webpack/bootstrap","webpack://Autodesk.Extensions/webpack/runtime/compat get default export","webpack://Autodesk.Extensions/webpack/runtime/define property getters","webpack://Autodesk.Extensions/webpack/runtime/hasOwnProperty shorthand","webpack://Autodesk.Extensions/webpack/runtime/make namespace object","webpack://Autodesk.Extensions/webpack/runtime/nonce","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupTypes.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/EditAction.js","webpack://Autodesk.Extensions/./extensions/Markup/core/StyleUtils.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupEvents.js","webpack://Autodesk.Extensions/./extensions/Markup/core/Markup.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetStyle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditMode.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteArrow.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetArrow.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeArrow.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupArrow.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateArrow.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteRectangle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetRectangle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeRectangle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupRectangle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateRectangle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteText.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetCallout.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetSize.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditorTextAutosize.js","webpack://Autodesk.Extensions/./extensions/Markup/core/DomElementStyle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditorTextInput.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeCallout.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupCallout.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateCallout.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteCallout.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetText.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeText.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupText.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateText.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteCircle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetCircle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeCircle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupCircle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateCircle.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteCloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetCloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeCloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupCloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateCloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupPen.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModePen.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteFreehand.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetFreehand.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeFreehand.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupFreehand.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateFreehand.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeletePolyline.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetPolyline.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModePolyline.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupPolyLine.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreatePolyline.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeletePolycloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetPolycloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModePolycloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupPolycloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreatePolycloud.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteHighlight.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetHighlight.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeHighlight.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupHighlight.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateHighlight.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteDimension.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetDimension.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeDimension.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupDimension.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateDimension.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/DeleteStamp.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetStamp.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/EditModeStamp.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupStamp.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CreateStamp.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupsCoreUtils.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/EditActionGroup.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/EditActionManager.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/CloneMarkup.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-clipboard/Clipboard.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-input/InputHandler.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetPosition.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-actions/SetRotation.js","webpack://Autodesk.Extensions/./extensions/Markup/core/EditFrame.js","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupTool.js","webpack://Autodesk.Extensions/./extensions/Markup/core/EditModeManager.js","webpack://Autodesk.Extensions/./extensions/Markup/core/edit-modes/BuiltinEditModes.js","webpack://Autodesk.Extensions/./extensions/Markup/core/Markups.css?c41a","webpack://Autodesk.Extensions/./extensions/Markup/core/MarkupsCore.js","webpack://Autodesk.Extensions/./extensions/Markup/gui/MarkupsGui.css?0643","webpack://Autodesk.Extensions/./extensions/Markup/gui/MarkupsGui.js","webpack://Autodesk.Extensions/./extensions/Markup/Markup.js"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger:after{content:\"\";position:absolute;top:-15px;bottom:-15px;left:-15px;right:-15px}.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger.rotation-bridge:after{top:0;bottom:0px}.adsk-viewing-viewer .selector-box{position:absolute;border:1px dashed #0696d7;background:rgba(6,150,215,.05);z-index:1;cursor:move;box-sizing:border-box}.adsk-viewing-viewer .selector-drag-point,.adsk-viewing-viewer .selector-rotate-point{position:absolute;height:8px;width:8px;border-radius:8px;background:#fff;border-color:rgba(107,120,127,.7);border-width:1px;border-style:solid}.adsk-viewing-viewer .selector-rotate-point{top:calc(100% + 22px);left:calc(50% + 1px);transform:translate3d(-50%, 0px, 0px)}.adsk-viewing-viewer .selector-drag-point.selected,.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge){background:#0696d7;border-color:#0696d7}.adsk-viewing-viewer .rotation-bridge{position:absolute;background-color:rgba(0,0,0,0);height:30px;width:0px;top:100%;left:calc(50% + 1px);border:unset;border-left:1px dashed #0696d7}.adsk-viewing-viewer .selector-drag-point.sdp-handle-n{top:-6px;left:calc(50% - 4px);position:relative}.adsk-viewing-viewer .selector-drag-point.sdp-handle-s{top:calc(100% - 14px);left:calc(50% - 4px);position:relative}.adsk-viewing-viewer .selector-drag-point.sdp-handle-w{left:-6px;top:50%;transform:translate3d(0, -50%, 0)}.adsk-viewing-viewer .selector-drag-point.sdp-handle-e{right:-6px;top:50%;transform:translate3d(0, -50%, 0)}.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw{top:-6px;left:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne{top:-6px;right:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw{bottom:-6px;left:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-se{bottom:-6px;right:-6px}`, \"\",{\"version\":3,\"sources\":[\"webpack://./extensions/Markup/core/Markups.css\"],\"names\":[],\"mappings\":\"AAAA,2EAA2E,UAAU,CAAC,iBAAiB,CAAC,SAAS,CAAC,YAAY,CAAC,UAAU,CAAC,WAAW,CAAC,2FAA2F,KAAK,CAAC,UAAU,CAAC,mCAAmC,iBAAiB,CAAC,yBAAyB,CAAC,8BAA8B,CAAC,SAAS,CAAC,WAAW,CAAC,qBAAqB,CAAC,sFAAsF,iBAAiB,CAAC,UAAU,CAAC,SAAS,CAAC,iBAAiB,CAAC,eAAe,CAAC,iCAAiC,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,4CAA4C,qBAAqB,CAAC,oBAAoB,CAAC,qCAAqC,CAAC,8HAA8H,kBAAkB,CAAC,oBAAoB,CAAC,sCAAsC,iBAAiB,CAAC,8BAA8B,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,CAAC,oBAAoB,CAAC,YAAY,CAAC,8BAA8B,CAAC,uDAAuD,QAAQ,CAAC,oBAAoB,CAAC,iBAAiB,CAAC,uDAAuD,qBAAqB,CAAC,oBAAoB,CAAC,iBAAiB,CAAC,uDAAuD,SAAS,CAAC,OAAO,CAAC,iCAAiC,CAAC,uDAAuD,UAAU,CAAC,OAAO,CAAC,iCAAiC,CAAC,wDAAwD,QAAQ,CAAC,SAAS,CAAC,wDAAwD,QAAQ,CAAC,UAAU,CAAC,wDAAwD,WAAW,CAAC,SAAS,CAAC,wDAAwD,WAAW,CAAC,UAAU\",\"sourcesContent\":[\".adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger:after{content:\\\"\\\";position:absolute;top:-15px;bottom:-15px;left:-15px;right:-15px}.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger.rotation-bridge:after{top:0;bottom:0px}.adsk-viewing-viewer .selector-box{position:absolute;border:1px dashed #0696d7;background:rgba(6,150,215,.05);z-index:1;cursor:move;box-sizing:border-box}.adsk-viewing-viewer .selector-drag-point,.adsk-viewing-viewer .selector-rotate-point{position:absolute;height:8px;width:8px;border-radius:8px;background:#fff;border-color:rgba(107,120,127,.7);border-width:1px;border-style:solid}.adsk-viewing-viewer .selector-rotate-point{top:calc(100% + 22px);left:calc(50% + 1px);transform:translate3d(-50%, 0px, 0px)}.adsk-viewing-viewer .selector-drag-point.selected,.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge){background:#0696d7;border-color:#0696d7}.adsk-viewing-viewer .rotation-bridge{position:absolute;background-color:rgba(0,0,0,0);height:30px;width:0px;top:100%;left:calc(50% + 1px);border:unset;border-left:1px dashed #0696d7}.adsk-viewing-viewer .selector-drag-point.sdp-handle-n{top:-6px;left:calc(50% - 4px);position:relative}.adsk-viewing-viewer .selector-drag-point.sdp-handle-s{top:calc(100% - 14px);left:calc(50% - 4px);position:relative}.adsk-viewing-viewer .selector-drag-point.sdp-handle-w{left:-6px;top:50%;transform:translate3d(0, -50%, 0)}.adsk-viewing-viewer .selector-drag-point.sdp-handle-e{right:-6px;top:50%;transform:translate3d(0, -50%, 0)}.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw{top:-6px;left:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne{top:-6px;right:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw{bottom:-6px;left:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-se{bottom:-6px;right:-6px}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.adsk-icon-markup:before{content:\"a\"}.lmv-markup-gui-toolbar{position:absolute;top:0;margin:5px 5px;color:#000}.lmv-markup-gui-toolbar-content>*{margin:0 2px}.lmv-markup-gui-style-options{display:inline-block}`, \"\",{\"version\":3,\"sources\":[\"webpack://./extensions/Markup/gui/MarkupsGui.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB,WAAW,CAAC,wBAAwB,iBAAiB,CAAC,KAAK,CAAC,cAAc,CAAC,UAAU,CAAC,kCAAkC,YAAY,CAAC,8BAA8B,oBAAoB\",\"sourcesContent\":[\".adsk-icon-markup:before{content:\\\"a\\\"}.lmv-markup-gui-toolbar{position:absolute;top:0;margin:5px 5px;color:#000}.lmv-markup-gui-toolbar-content>*{margin:0 2px}.lmv-markup-gui-style-options{display:inline-block}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","\"use strict\";\n\nvar stylesInDOM = [];\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n}\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n    identifiers.push(identifier);\n  }\n  return identifiers;\n}\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n  return updater;\n}\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n    var newLastIdentifiers = modulesToDom(newList, options);\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n      var _index = getIndexByIdentifier(_identifier);\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","\"use strict\";\n\nvar memo = {};\n\n/* istanbul ignore next  */\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target);\n\n    // Special case to return head of iframe instead of iframe itself\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n    memo[target] = styleTarget;\n  }\n  return memo[target];\n}\n\n/* istanbul ignore next  */\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n  target.appendChild(style);\n}\nmodule.exports = insertBySelector;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\nmodule.exports = insertStyleElement;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement) {\n  var nonce = typeof __webpack_nonce__ !== \"undefined\" ? __webpack_nonce__ : null;\n  if (nonce) {\n    styleElement.setAttribute(\"nonce\", nonce);\n  }\n}\nmodule.exports = setAttributesWithoutAttributes;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n  var needLayer = typeof obj.layer !== \"undefined\";\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n  css += obj.css;\n  if (needLayer) {\n    css += \"}\";\n  }\n  if (obj.media) {\n    css += \"}\";\n  }\n  if (obj.supports) {\n    css += \"}\";\n  }\n  var sourceMap = obj.sourceMap;\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  }\n\n  // For old IE\n  /* istanbul ignore if  */\n  options.styleTagTransform(css, styleElement, options.options);\n}\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n  styleElement.parentNode.removeChild(styleElement);\n}\n\n/* istanbul ignore next  */\nfunction domAPI(options) {\n  if (typeof document === \"undefined\") {\n    return {\n      update: function update() {},\n      remove: function remove() {}\n    };\n  }\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\nmodule.exports = domAPI;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\nmodule.exports = styleTagTransform;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nc = undefined;","\n// These are all the supported markup types.\n\n    export const MARKUP_TYPE_ARROW = \"arrow\";\n    export const MARKUP_TYPE_TEXT = \"label\";\n    export const MARKUP_TYPE_RECTANGLE = \"rectangle\";\n    export const MARKUP_TYPE_CIRCLE = \"ellipse\";\n    export const MARKUP_TYPE_CLOUD = \"cloud\";\n    export const MARKUP_TYPE_FREEHAND = \"freehand\";\n    export const MARKUP_TYPE_HIGHLIGHT = \"highlight\";\n    export const MARKUP_TYPE_POLYLINE = \"polyline\";\n    export const MARKUP_TYPE_POLYCLOUD = \"polycloud\";\n    export const MARKUP_TYPE_CALLOUT = \"callout\";\n    export const MARKUP_TYPE_DIMENSION = \"dimension\";\n    export const MARKUP_TYPE_STAMP = \"stamp\";","'use strict';\n\n    /**\n     * Base class for all markup edit actions.\n     *\n     * EditActions encapsulate {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}\n     * operations (such as creation, edition and deletion) that hook into the undo/redo system.\n     *\n     * The minimum set of methods to implement on an EditAction extension are:\n     * - execute()\n     * - undo()\n     * - redo()\n     *\n     * A good set of classes to check their implementation are:\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.CreateCircle|CreateCircle}.\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.DeleteCircle|DeleteCircle}.\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.SetCircle|SetCircle}.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     * @param {String} type - An identifier for the EditAction.\n     * @param {number} targetId - The id of the markup being affected.\n     */\n    export function EditAction(editor, type, targetId) {\n\n        this.type =  type;\n        this.editor = editor;\n        this.targetId = targetId;\n        this.addToHistory = true;\n        this.selectOnExecution = true;\n    }\n\n    /**\n     * Performs the action.\n     */\n    EditAction.prototype.execute = function() {\n\n        this.editor.actionManager.execute(this);\n    };\n\n    /**\n     * @abstract\n     */\n    EditAction.prototype.redo = function() {\n\n    };\n\n    /**\n     * @abstract\n     */\n    EditAction.prototype.undo = function() {\n\n    };\n\n    /**\n     * Provides a mechanism to merge consecutive actions of the same type.\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.EditAction} action - Action to check if it can be merged with 'this'.\n     * @returns {boolean} Returns true if merge has been applied. Parameter will be discarded.\n     */\n    EditAction.prototype.merge = function(action) {\n\n        return false;\n    };\n\n    /**\n     * Provides a mechanism to check whether the action yields no results.\n     * @returns {boolean} Returns true if no changes happen with this action.\n     */\n    EditAction.prototype.isIdentity = function() {\n\n        return false;\n    };\n\n","\n/**\n *\n * @param {*} attributes\n * @param {*} editor\n */\nexport var createStyle = function(attributes, editor) {\n\n    var style = {};\n\n    for(var i = 0; i < attributes.length; ++i) {\n\n        style[attributes[i]] = null;\n    }\n\n    var defaults = getStyleDefaultValues(style, editor);\n\n    for(let i = 0; i < attributes.length; ++i) {\n\n        var attribute = attributes[i];\n        style[attribute] = defaults[attribute].values[defaults[attribute].default].value;\n    }\n\n    return style;\n};\n\n/**\n *\n * @param source\n * @param destination\n * @returns {*}\n */\nexport var copyStyle = function(source, destination) {\n\n    for(var attribute in destination) {\n        if (Object.prototype.hasOwnProperty.call(source, attribute)) {\n            destination[attribute] = source[attribute];\n        }\n    }\n\n    return destination;\n};\n\n/**\n *\n * @param source\n * @param destination\n * @returns {*}\n */\nexport var isStyleEqual = function(source, destination) {\n\n    for(var attribute in destination) {\n        if (Object.prototype.hasOwnProperty.call(source, attribute)  && source[attribute] !== destination[attribute]) {\n            return false;\n        }\n    }\n\n    return true;\n};\n\n/**\n *\n * @param source\n * @returns {{}}\n */\nexport var cloneStyle = function(source) {\n\n    var clone = {};\n\n    for(var attribute in source) {\n        clone[attribute] = source[attribute];\n    }\n\n    return clone;\n};\n\n/**\n *\n * @param style\n * @param editor\n * @returns {{}}\n */\nexport var getStyleDefaultValues = function(style, editor) {\n\n    function getWidths(normalWidth) {\n\n        return {\n            values: [\n                {name:'Thin', value: normalWidth / 3},\n                {name:'Normal', value: normalWidth},\n                {name:'Thick', value: normalWidth * 3},\n                {name:'Very Thick', value: normalWidth * 9}],\n            default: 1\n        };\n    }\n\n    function getLineJoins() {\n\n        return {\n            values: [\n                {name:'Miter', value: 'miter'},\n                {name:'Round', value: 'round'},\n                {name:'Bevel', value: 'bevel'}],\n            default: 0\n        };\n    }\n\n    function getFontSizes(normalWidth) {\n\n        return {\n            values: [\n                {name:'Thin', value: normalWidth / 2},\n                {name:'Normal', value: normalWidth},\n                {name:'Thick', value: normalWidth * 4}],\n            default: 1\n        };\n    }\n\n    function getColors() {\n\n        return {\n            values: [\n                {name:'red', value: '#ff0000'},\n                {name:'green', value: '#00ff00'},\n                {name:'blue', value: '#0000ff'},\n                {name:'white', value: '#ffffff'},\n                {name:'black', value: '#000000'},\n                {name:'yellow', value: '#ffff00'}],\n            default: 0\n        };\n    }\n\n    function getOpacities(defaultTransparent) {\n\n        return {\n            values: [\n                {name:'100%', value: 1.00},\n                {name:'75%', value:  0.75},\n                {name:'50%', value: 0.50},\n                {name:'25%', value: 0.25},\n                {name:'0%', value: 0.00}],\n            default: (defaultTransparent ? 4 : 0)\n        };\n    }\n\n    function getFontFamilies() {\n\n        // TODO: Localize?\n        // TODO: Validate fonts with design\n        // Source: http://www.webdesigndev.com/web-development/16-gorgeous-web-safe-fonts-to-use-with-css\n        return {\n            values:[\n                {name:'Arial', value: 'Arial'},\n                {name:'Arial Black', value: 'Arial Black'},\n                {name:'Arial Narrow', value: 'Arial Narrow'},\n                {name:'Century Gothic', value: 'Century Gothic'},\n                {name:'Courier New', value: 'Courier New'},\n                {name:'Georgia', value: 'Georgia'},\n                {name:'Impact', value: 'Impact'},\n                {name:'Lucida Console', value: 'Lucida Console'},\n                {name:'Tahoma', value: 'Tahoma'},\n                {name:'Verdana', value: 'Verdana'}\n            ],\n            default: 0\n        };\n    }\n\n    function getFontStyles() {\n        return {\n            values:[\n                {name:'Normal', value: 'normal'},\n                {name:'Italic', value: 'italic'}],\n            default: 0\n        };\n    }\n\n    function getFontWeights() {\n        return {\n            values:[\n                {name:'Normal', value: 'normal'},\n                {name:'Bold', value: 'bold'}],\n            default: 0};\n    }\n\n    function getSvgString() {\n        return {\n            values: [\n                {\n                    name: 'DefaultValue',\n                    value: '<svg height=\"100\" width=\"100\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" stroke=\"black\" stroke-width=\"3\" fill=\"red\" /></svg>'\n                }\n            ],\n            default: 0\n        };\n    }\n\n    var values = cloneStyle(style);\n    var normaStrokeWidth = editor.getStrokeWidth();\n    var normaFontWidth = editor.getFontWidth();\n\n    for(var attribute in values) {\n\n        switch(attribute) {\n            case 'stroke-width':\n                values[attribute] = getWidths(normaStrokeWidth);\n                break;\n\n            case 'stroke-linejoin':\n                values[attribute] = getLineJoins();\n                break;\n\n            case 'font-size':\n                values[attribute] = getFontSizes(normaFontWidth);\n                break;\n\n            case 'font-family':\n                values[attribute] = getFontFamilies();\n                break;\n\n            case 'font-style':\n                values[attribute] = getFontStyles();\n                break;\n\n            case 'font-weight':\n                values[attribute] = getFontWeights();\n                break;\n\n            case 'stroke-color':\n            case 'fill-color':\n                values[attribute] = getColors();\n                break;\n\n            case 'stroke-opacity': {\n                let defaultTransparent = false;\n                values[attribute] = getOpacities(defaultTransparent);\n                break;\n            }\n\n            case 'fill-opacity': {\n                let defaultTransparent = true;\n                values[attribute] = getOpacities(defaultTransparent);\n                break;\n            }\n\n            case 'text-data':\n                values[attribute] = getSvgString();\n                break;\n\n            default:\n                break;\n        }\n    }\n\n    return values;\n};\n","'use strict';\n\n/**\n * Fired whenever the drawing tool changes. For example, when the Arrow drawing\n * tool changes into the Rectangle drawing tool.\n *\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_EDITMODE_CHANGED\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n */\nexport const EVENT_EDITMODE_CHANGED = \"EVENT_EDITMODE_CHANGED\";\n\n/**\n * Fired when Edit mode has been enabled, which allows the end user to start\n * drawing markups over the Viewer canvas.\n *\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_EDITMODE_ENTER\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n */\nexport const EVENT_EDITMODE_ENTER = \"EVENT_EDITMODE_ENTER\";\n\n/**\n * Fired when Edit mode has been disabled, preventing the end user from\n * drawing markups over the Viewer canvas.\n *\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_EDITMODE_LEAVE\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n */\nexport const EVENT_EDITMODE_LEAVE = \"EVENT_EDITMODE_LEAVE\";\n\n/**\n * Fired when a drawn markup has been selected by the end user with a click command.\n *\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_MARKUP_SELECTED\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {object}\n * @property {Markup} markup The selected markup\n */\nexport const EVENT_MARKUP_SELECTED = \"EVENT_MARKUP_SELECTED\";\n\n/**\n * Fired when a drawn markup is being dragged over the Viewer canvas.\n *\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_MARKUP_DRAGGING\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n */\nexport const EVENT_MARKUP_DRAGGING = \"EVENT_MARKUP_DRAGGING\";\n\n/**\n * Internal usage only.\n *\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_MARKUP_ENTER_EDITION\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n * @private\n */\nexport const EVENT_MARKUP_ENTER_EDITION = \"EVENT_MARKUP_ENTER_EDITION\";\n\n/**\n * Internal usage only.\n *\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_MARKUP_CANCEL_EDITION\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n * @private\n */\nexport const EVENT_MARKUP_CANCEL_EDITION = \"EVENT_MARKUP_CANCEL_EDITION\";\n\n/**\n * Internal usage only.\n *\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_MARKUP_DELETE_EDITION\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n * @private\n */\nexport const EVENT_MARKUP_DELETE_EDITION = \"EVENT_MARKUP_DELETE_EDITION\";\n\n/**\n * @typedef {object} EventHistoryChangedData\n The event data to identify the action and target for MarkupCore.EVENT_HISTORY_CHANGED event.\n * @property {string} action A string identifier for the action taken, like redo, undo, cancel, execute, clear\n * @property {number} targetId A number targetId based on the action.\n */\n\n/**\n * Fired whenever a new undo or redo action is available.\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_HISTORY_CHANGED\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {object}\n * @property {EventHistoryChangedData} data The event data to identify the action and target\n *\n */\nexport const EVENT_HISTORY_CHANGED = \"EVENT_HISTORY_CHANGED\";\n\n/**\n * Fired when a markup creation begins.\n * For example, as soon as the user starts dragging with the mouse\n * to draw an arrow on the screen.\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_EDITMODE_CREATION_BEGIN\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n */\nexport const EVENT_EDITMODE_CREATION_BEGIN = \"EVENT_EDITMODE_CREATION_BEGIN\";\n\n/**\n * Fired when a markup has been created.\n * For example, as soon as the user stops dragging and releases the\n * mouse button to finish drawing an arrow on the screen\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_EDITMODE_CREATION_END\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n */\nexport const EVENT_EDITMODE_CREATION_END = \"EVENT_EDITMODE_CREATION_END\";\n\n/**\n * Fired when a markup is no longer selected.\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_MARKUP_DESELECT\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {object}\n * @property {number} markupId The id of the selected markup\n */\nexport const EVENT_MARKUP_DESELECT = \"EVENT_MARKUP_DESELECT\";\n\n/**\n * The selected markup is being modified, i.e, resizing, rotating, moving around\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_EDITFRAME_EDITION_START\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n */\nexport const EVENT_EDITFRAME_EDITION_START = \"EVENT_EDITFRAME_EDITION_START\";\n\n/**\n * The selected markup is no longer being modified\n * @event Autodesk.Viewing.Extensions.MarkupsCore#EVENT_EDITFRAME_EDITION_END\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @type {string}\n */\nexport const EVENT_EDITFRAME_EDITION_END = \"EVENT_EDITFRAME_EDITION_END\";","'use strict';\n\nimport { addTraitEventDispatcher, renderToCanvas, radiansToDegrees,\n         checkPolygon, checkLineSegment, isTouchDevice } from './MarkupsCoreUtils';\nimport { createStyle, copyStyle, cloneStyle } from './StyleUtils';\nimport * as MarkupEvents from './MarkupEvents';\n\n    var av = Autodesk.Viewing;\n\n    /**\n     * Base class for all markups.\n     *\n     * A Markup is a class that is capable of rendering itself as an Svg node.<br>\n     * It can also render itself into a canvas-2d context.\n     * Component within {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore} extension.\n     *\n     * Any class extending Markup should contain at least the following methods:\n     * - getEditMode()\n     * - set()\n     * - updateStyle()\n     * - setParent()\n     * - setRotation()\n     * - setSize()\n     * - setPosition()\n     * - renderToCanvas()\n     * - setMetadata()\n     *\n     * A good reference is the rectangle markup implementation available in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupRectangle|MarkupRectangle}.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     *\n     * @param {number} id - Identifier, populated with return value of {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#getId getId()}.\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension\n     * @param {Array} styleAttributes - Attributes for customization. Related to {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#setStyle setStyle()}.\n     * @constructor\n     */\n    export function Markup(id, editor, styleAttributes) {\n\n        this.id = id;\n        this.type = \"\";\n        this.editor = editor;\n        this.viewer = editor.viewer;\n        this.setGlobalManager(this.viewer.globalManager);\n        this.position = {x: 0, y: 0};\n        this.size = {x:0, y:0};\n        this.rotation = 0;\n        this.style = createStyle(styleAttributes, this.editor);\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\n        this.highlightColor = '#0696D7';\n        this.constraintWidth = false;\n        this.constraintHeight = false;\n        this.constraintRotation = false;\n        this.minWidth = -10000;\n        this.minHeight = -10000;\n        this.highlighted = false;\n        this.selected = false;\n\n        // bind to this to pass this.globalManager\n        this.checkLineSegment = checkLineSegment.bind(this);\n        this.checkPolygon = checkPolygon.bind(this);\n        this.renderToCanvasX = renderToCanvas.bind(this);\n\n        addTraitEventDispatcher(this);\n    }\n\n    av.GlobalManagerMixin.call(Markup.prototype);\n    var proto = Markup.prototype;\n\n    proto.destroy = function () {\n\n        this.unselect();\n        this.setParent(null);\n    };\n\n    /**\n     * Specifies the parent layer which will contain the markup.\n     * @param {HTMLElement} parent\n     */\n    proto.setParent = function(parent) {\n\n        var div = this.shape;\n        div.parentNode && div.parentNode.removeChild(div);\n        parent && parent.appendChild(div);\n    };\n\n    /**\n     * Clones (deep-copy) the markup. Used internally by the copy/cut/paste mechanism in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore}.\n     *\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} clone of the current markup\n     */\n    proto.clone = function() {\n\n        var clone = Object.create(this.__proto__);\n        var overrides = this.getCloneOverrides();\n\n        for (var name in this) {\n\n            if(!Object.prototype.hasOwnProperty.call(this, name)) {\n                continue;\n            }\n\n            var member = this[name];\n\n            // Is there an override for this member?\n            if (Object.prototype.hasOwnProperty.call(overrides, name)) {\n                clone[name] = overrides[name];\n                continue;\n            }\n\n            // Member is null or undefined?\n            if (member === null || member === undefined) {\n                clone[name] = member;\n                continue;\n            }\n\n            // Member has a clone function?\n            if (member['clone'] instanceof Function) {\n                clone[name] = member.clone();\n                continue;\n            }\n\n            // Is it a function?\n            if (member instanceof Function) {\n                clone[name] = member.bind(clone);\n                continue;\n            }\n\n            // Is it an html node?\n            if (member.nodeType) {\n                clone[name] = member.cloneNode(true);\n                continue;\n            }\n\n            // Is it the globalManager?\n            if (member instanceof av.GlobalManager) {\n                av.GlobalManagerMixin.call(clone);\n                clone.setGlobalManager(member);\n                continue;\n            }\n\n            // Just a plain object?\n            if (member instanceof Object) {\n                clone[name] = JSON.parse(JSON.stringify(member));\n                continue;\n            }\n\n            // Ok, it seems it's just a primitive type.\n            clone[name] = member;\n        }\n\n        this.cloneShape(clone);\n        return clone;\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.shape.markup = clone.shape.childNodes.item(0);\n        clone.shape.hitarea = clone.shape.childNodes.item(1);\n        clone.bindDomEvents();\n    };\n\n    /**\n     * Used internally by\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#clone clone()},\n     * provides a mechanism to avoid cloning specific attributes.<br>\n     * Developers only need to override this method when creating new Markup types.\n     * When overriding, first call the super() implementation and then include additional attribute/value pairs to it.\n     * @returns {Object} containing attributes that need not to be cloned.\n     */\n    proto.getCloneOverrides = function() {\n\n        return {\n            viewer: this.viewer,\n            editor: this.editor,\n            hammer: null,\n            listeners: {}\n        };\n    };\n\n    /**\n     * Used internally to select a markup.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_SELECTED.\n     */\n    proto.select = function () {\n\n        if (this.selected) {\n            return;\n        }\n\n        this.selected = true;\n        this.highlighted = false;\n        this.updateStyle();\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_SELECTED, markup: this});\n    };\n\n    /**\n     * Used internally to signal that the current markup has been unselected.<br>\n     * No event is fired.\n     */\n    proto.unselect = function() {\n\n        this.selected = false;\n    };\n\n    proto.highlight = function(highlight) {\n\n        if (this.interactionsDisabled) {\n            return;\n        }\n\n        this.highlighted = highlight;\n        this.updateStyle();\n    };\n\n    /**\n     * Returns a copy of the markup's style.\n     * @returns {Object}\n     */\n    proto.getStyle = function() {\n\n        return cloneStyle(this.style);\n    };\n\n    /**\n     * Used internally to set the style object. Triggers a re-render of the markup (Svg)\n     * @param {Object} style - Dictionary with key/value pairs\n     */\n    proto.setStyle = function(style) {\n\n        copyStyle(style, this.style);\n        this.updateStyle();\n    };\n\n    /**\n     * Used internally and implemented by specific Markup types to render themselves as Svg.\n     */\n    proto.updateStyle = function () {\n\n    };\n\n    /**\n     * Used internally to notify the markup that it is now being edited.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_ENTER_EDITION.\n     */\n    proto.edit = function() {\n\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_ENTER_EDITION, markup: this});\n    };\n\n    /**\n     * Used internally to signal that it is no longer being edited.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_CANCEL_EDITION.\n     */\n    proto.cancel = function() {\n\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, markup: this});\n    };\n\n    /**\n     * Used internally to signal that the markup is being deleted.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_DELETE_EDITION.\n     */\n    proto.deleteMarkup = function() {\n\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_DELETE_EDITION, markup: this});\n    };\n\n    /**\n     * Used internally to get the {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode EditMode}\n     * associated with the current Markup.<br>\n     * Implemented by classes extending this one.\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.EditMode}\n     */\n    proto.getEditMode = function() {\n\n        console.warn('EditMode of markup type' + this.type + ' not defined.' );\n        return null;\n    };\n\n    /**\n     * Used internally to get the markup's position in browser pixel space.<br>\n     * Notice that (0,0) is top left.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientSize|getClientSize()}.\n     * @returns {*}\n     */\n    proto.getClientPosition = function() {\n\n        var position = this.position;\n        return this.editor.positionFromMarkupsToClient(position.x, position.y);\n    };\n\n    /**\n     * Used internally to get the markup's bounding rect in browser pixel space.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientPosition|getClientPosition()}.\n     * @returns {*}\n     */\n    proto.getClientSize = function () {\n\n        var size = this.size;\n        return this.editor.sizeFromMarkupsToClient(size.x, size.y);\n    };\n\n    /**\n     * Used internally to get the markup's bounding rect in browser pixel space, including the stroke width.<br>\n     * @returns {Object} a rectangle with right, top, left, bottom attributes\n     */\n    proto.getBoundingRect = function () {\n\n        var rotation = this.rotation;\n\n        if (rotation !== 0) { // Undo rotation to find a tight bounding rect\n            this.setRotation(0);\n        }\n\n        var parentRect = this.viewer.impl.getCanvasBoundingClientRect();\n\n        var boundRect = this.shape.markup.getBoundingClientRect();\n        var top = boundRect.top - parentRect.top;\n\n        var strokeWidth = this.style['stroke-width'] || 0;\n        var offset = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\n\n        if (rotation !== 0) {\n            this.setRotation(rotation);\n        }\n\n        return {\n            x: boundRect.left - parentRect.left - offset,\n            y: top - offset,\n            width: boundRect.width + 2*offset,\n            height: boundRect.height + 2*offset\n        };\n    };\n\n    /**\n     * Changes the rotation of the markup to the given angle.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\n     *\n     * @param {Number} angle\n     */\n    proto.setRotation = function(angle) {\n\n        this.rotation = angle;\n        this.updateStyle();\n    };\n\n    proto.getRotation = function () {\n\n        return this.rotation;\n    };\n\n    /**\n     * Used by the EditFrame to move the markup in Client Space coordinates\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\n     */\n    proto.setPosition = function(x,y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.isWidthConstrained = function() {\n\n        return this.constraintWidth;\n    };\n\n    proto.isHeightConstrained = function() {\n\n        return this.constraintHeight;\n    };\n\n    proto.isRotationConstrained = function() {\n\n        return this.constraintRotation;\n    };\n\n    proto.setMinWidth = function(minWidth) {\n        this.minWidth = minWidth;\n    };\n\n    proto.setMinHeight = function(minHeight) {\n        this.minHeight = minHeight;\n    };\n\n    proto.getMinWidth = function() {\n        return this.minWidth;\n    };\n\n    proto.getMinHeight = function() {\n        return this.minHeight;\n    };\n\n    /**\n     * Used to disable highlight on annotations while a new annotation is being created.\n     * @param {Boolean} disable - Whether (mouse) interactions are enable.\n     */\n    proto.disableInteractions = function(disable) {\n\n        this.interactionsDisabled = disable;\n    };\n\n    /**\n     *\n     * @param width\n     */\n    proto.setStrokeWidth = function(width) {\n\n    };\n\n    proto.constrainsToBounds = function(bounds) {\n\n    };\n\n    proto.onMouseDown = function(event) {\n\n        if (this.interactionsDisabled) {\n            return;\n        }\n\n        this.select();\n        this.editor.editFrame.startDrag(event);\n    };\n\n    /**\n     *\n     * @param idTarget\n     * @returns *\n     */\n    proto.generatePoint3d = function(idTarget) {\n\n        var viewer = this.viewer;\n        var polygon = this.generateBoundingPolygon();\n        var self = this;\n\n        function checkLineSegmentAux(a, b) {\n\n            var point2d = self.checkLineSegment(a.x, a.y, b.x, b.y, idTarget);\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\n            return point3d && point3d.point;\n        }\n\n        function checkPolygonAux(polygon) {\n\n            var point2d = self.checkPolygon(polygon, idTarget);\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\n            return point3d && point3d.point;\n        }\n\n        // Try to avoid expensive calculations by checking some lines segments first.\n        // If line check cannot find a point the costly one by area is used.\n        // A ----midAB---- B\n        // |               |\n        // |     center    |\n        // |               |\n        // C --------------D\n\n        var xVertices = polygon.xVertices;\n        var yVertices = polygon.yVertices;\n\n        var midAB = new THREE.Vector2(xVertices[0] + xVertices[1], yVertices[0] + yVertices[1]).multiplyScalar(0.5);\n        var midAC = new THREE.Vector2(xVertices[0] + xVertices[3], yVertices[0] + yVertices[3]).multiplyScalar(0.5);\n        var midDB = new THREE.Vector2(xVertices[2] + xVertices[1], yVertices[2] + yVertices[1]).multiplyScalar(0.5);\n        var midDC = new THREE.Vector2(xVertices[2] + xVertices[3], yVertices[2] + yVertices[3]).multiplyScalar(0.5);\n        var center = midAC.clone().add(midDB).multiplyScalar(0.5);\n\n        var point3d =\n            checkLineSegmentAux(center, midDB) ||\n            checkLineSegmentAux(center, midAC) ||\n            checkLineSegmentAux(center, midAB) ||\n            checkLineSegmentAux(center, midDC);\n\n        return point3d || checkPolygonAux(polygon);\n    };\n\n    /**\n     *\n     * @returns {{min: {x: number, y: number}, max: {x: number, y: number}}}\n     */\n    proto.generateBoundingBox = function() {\n\n        var boundingBox = {min: {x: 0,y: 0}, max: {x: 0, y: 0}};\n\n        // Get bounding box from markup bounding polygon.\n        var polygon = this.generateBoundingPolygon();\n\n        var vertexCount = polygon.vertexCount;\n        var xVertices = polygon.xVertices;\n        var yVertices = polygon.yVertices;\n\n        var bbX0 = Number.POSITIVE_INFINITY;\n        var bbY0 = Number.POSITIVE_INFINITY;\n        var bbX1 = Number.NEGATIVE_INFINITY;\n        var bbY1 = Number.NEGATIVE_INFINITY;\n\n        for(var i = 0; i < vertexCount; ++i) {\n\n            var bbX = xVertices[i];\n            var bbY = yVertices[i];\n\n            bbX0 = Math.min(bbX0, bbX);\n            bbY0 = Math.min(bbY0, bbY);\n            bbX1 = Math.max(bbX1, bbX);\n            bbY1 = Math.max(bbY1, bbY);\n        }\n\n        boundingBox.min.x = bbX0;\n        boundingBox.min.y = bbY0;\n        boundingBox.max.x = bbX1;\n        boundingBox.max.y = bbY1;\n\n        return boundingBox;\n    };\n\n    /**\n     *\n     * @returns {{vertexCount: number, xVertices: Float32Array, yVertices: Float32Array}}\n     */\n    proto.generateBoundingPolygon = function() {\n\n        var position = this.getClientPosition();\n        var halfSize = this.getClientSize();\n\n        halfSize.x *= 0.5;\n        halfSize.y *= 0.5;\n\n        var lt = new THREE.Vector3(-halfSize.x,-halfSize.y).add(position);\n        var rt = new THREE.Vector3( halfSize.x,-halfSize.y).add(position);\n        var rb = new THREE.Vector3( halfSize.x, halfSize.y).add(position);\n        var lb = new THREE.Vector3(-halfSize.x, halfSize.y).add(position);\n\n        if (this.rotation !== 0) {\n\n            var m1 = new THREE.Matrix4().makeTranslation(-position.x, -position.y, 0);\n            var m2 = new THREE.Matrix4().makeRotationZ(this.rotation);\n            var m3 = new THREE.Matrix4().makeTranslation(position.x, position.y, 0);\n            var transform = m3.multiply(m2).multiply(m1);\n\n            lt.applyMatrix4(transform);\n            rt.applyMatrix4(transform);\n            rb.applyMatrix4(transform);\n            lb.applyMatrix4(transform);\n        }\n\n        return { // packed for fast access in test algorithm.\n            vertexCount: 4,\n            xVertices : new Float32Array([lt.x, rt.x, rb.x, lb.x]),\n            yVertices : new Float32Array([lt.y, rt.y, rb.y, lb.y])\n        };\n    };\n\n    /**\n     * Implemented by extending classes.<br>\n     * Gets called automatically when\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#generateData|generateData()}\n     * @returns {null|Element} - Either null (default) or the metadata Svg node\n     */\n    proto.setMetadata = function() {\n\n        return null; // No metadata is injected by default.\n    };\n\n    proto.setMouseDisabledWhenTouching = function(event) {\n\n        if (event.isFirst) {\n            this.shape.removeEventListener('mousedown', this.onMouseDownBinded);\n        } else if (event.isFinal) {\n            var _this = this;\n            setTimeout(function() {\n                _this.shape.addEventListener('mousedown', _this.onMouseDownBinded);\n            }, 10);\n        }\n    };\n\n    proto.bindDomEvents = function() {\n\n        if (isTouchDevice()) {\n\n            this.hammer = new av.Hammer.Manager(this.shape, {\n                recognizers: [\n                    av.GestureRecognizers.singletap\n                ],\n                handlePointerEventMouse: false,\n                inputClass: av.Hammer.TouchInput\n            });\n\n            this.onSingleTapBinded = function(event) {\n\n                this.onMouseDown(event);\n            }.bind(this);\n\n            this.onHammerInputBinded = function(event) {\n\n                this.setMouseDisabledWhenTouching(event);\n            }.bind(this);\n\n            this.hammer.on('singletap', this.onSingleTapBinded);\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\n        }\n\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\n        this.onMouseOutBinded = function() {\n\n            this.highlight(false);\n        }.bind(this);\n\n        this.onMouseOverBinded = function() {\n\n            this.highlight(true);\n        }.bind(this);\n\n        this.shape.addEventListener('mousedown', this.onMouseDownBinded);\n        this.shape.addEventListener('mouseout', this.onMouseOutBinded);\n        this.shape.addEventListener('mouseover', this.onMouseOverBinded);\n    };\n\n    proto.renderToCanvas = function(ctx, viewBox, width, height, callback) {\n\n        this.renderToCanvasX(this.shape, viewBox, width, height, ctx, callback);\n    };\n\n    proto.getPath = function() {\n\n    };\n\n    proto.getTransform = function() {\n\n        return [\n            'translate(', this.position.x, ',', this.position.y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')'\n        ].join(' ');\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param style\n     * @constructor\n     */\n    export function SetStyle(editor, markup, style) {\n\n        EditAction.call(this, editor, 'SET-STYLE', markup.id);\n\n        this.newStyle = cloneStyle(style);\n        this.oldStyle = markup.getStyle();\n    }\n\n    SetStyle.prototype = Object.create(EditAction.prototype);\n    SetStyle.prototype.constructor = SetStyle;\n\n    var proto = SetStyle.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setStyle(this.newStyle);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setStyle(this.oldStyle);\n    };\n","'use strict';\n\nimport * as MarkupEvents from '../MarkupEvents';\nimport { createStyle, copyStyle } from '../StyleUtils';\nimport { addTraitEventDispatcher, removeTraitEventDispatcher, sign } from '../MarkupsCoreUtils';\nimport { SetStyle } from '../edit-actions/SetStyle';\n\nconst av = Autodesk.Viewing;\n\n    /**\n     * Base class for all markup edit modes.\n     *\n     * An EditMode is responsible for handling user input to create and edit a\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     *\n     * Any class extending Markup should contain at least the following methods:\n     * - deleteMarkup()\n     * - onMouseDown()\n     * - onMouseMove()\n     *\n     * A good reference is the Circle EditMode implementation available in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle|EditModeCircle}.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension.\n     * @param {String} type - An identifier for the EditMode type. Not to be confused by the Markup's id.\n     * @param {Array} styleAttributes - Attributes for customization.\n     * @constructor\n     */\n    export function EditMode(editor, type, styleAttributes) {\n\n        this.editor = editor;\n        this.viewer = editor.viewer;\n        this.setGlobalManager(this.viewer.globalManager);\n        this.type = type;\n        this.selectedMarkup = null;\n        this.dragging = false;\n        this.draggingAnnotationIniPosition = null;\n        this.draggingMouseIniPosition = new THREE.Vector2();\n        this.initialX = 0;\n        this.initialY = 0;\n        this.minSize = 9; // In pixels\n        this.creating = false;\n        this.size = {x: 0, y: 0};\n        this.style = createStyle(styleAttributes, this.editor);\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\n\n        this.CREATION_METHOD_DRAG = 'CREATION_METHOD_DRAG';\n        this.CREATION_METHOD_CLICK = 'CREATION_METHOD_CLICK';\n        this.CREATION_METHOD_CLICKS = 'CREATION_METHOD_CLICKS';\n        this.creationMethod = this.CREATION_METHOD_DRAG;\n\n        addTraitEventDispatcher(this);\n    }\n\n    av.GlobalManagerMixin.call(EditMode.prototype);\n    var proto = EditMode.prototype;\n\n    proto.destroy = function() {\n\n        this.unselect();\n        removeTraitEventDispatcher(this);\n    };\n\n    proto.unselect = function() {\n\n        var fireEv = false;\n        var selectedMarkup = this.selectedMarkup;\n        var selectedId = null;\n\n        if (selectedMarkup) {\n            selectedId = selectedMarkup.id;\n            selectedMarkup.unselect();\n            this.selectedMarkup = null;\n            fireEv = true;\n        }\n\n        this.editor.editFrame.setMarkup(null);\n\n        if (fireEv) {\n            this.dispatchEvent({ type: MarkupEvents.EVENT_MARKUP_DESELECT, markupId: selectedId });\n        }\n    };\n\n    proto.creationBegin = function() {\n\n        if (this.creating) {\n            return;\n        }\n\n        this.creating = true;\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN });\n    };\n\n    proto.creationEnd = function(isCancelling) {\n\n        if (!this.creating) {\n            return false;\n        }\n\n        if (this.creationMethod !== this.CREATION_METHOD_CLICK) {\n\n            if (this.selectedMarkup && !this.isMinSizeValid()) {\n\n                this.creationCancel();\n                isCancelling = true;\n            } else {\n\n                if (this.creationMethod === this.CREATION_METHOD_DRAG) {\n                    this.finishDragging();\n                }\n\n                if (this.selectedMarkup) {\n\n                    // Opened on mouse down.\n                    this.editor.closeActionGroup();\n                    this.selectedMarkup = null;\n                }\n            }\n        }\n\n        this.creating = false;\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_END, creationCancelled: !!isCancelling });\n        return true;\n    };\n\n    proto.creationCancel = function() {\n\n        this.editor.cancelActionGroup();\n        this.creationEnd(true);\n        this.selectedMarkup = null; // No need to call unselect\n    };\n\n    /**\n     *\n     * @param style\n     */\n    proto.setStyle = function(style) {\n\n        this.style = style;\n\n        var selectedMarkup = this.selectedMarkup;\n        if(!selectedMarkup) {\n            return;\n        }\n\n        var setStyle = new SetStyle(this.editor, selectedMarkup, style);\n        setStyle.execute();\n    };\n\n    proto.getStyle = function() {\n\n        return this.style;\n    };\n\n    proto.setSelection = function(markup) {\n\n        if (this.selectedMarkup !== markup) {\n            this.unselect();\n            markup && markup.select();\n        }\n\n        this.selectedMarkup = markup;\n\n        var editor = this.editor;\n        markup && editor.bringToFront(markup);\n\n        if (this.isTextInputHelperActive() && editor.editFrame.markup) {\n            this.textInputHelper.setEditFrame();\n        } else if (!this.creating) {\n            editor.editFrame.setMarkup(markup);\n        }\n    };\n\n    proto.getSelection = function() {\n\n        return this.selectedMarkup;\n    };\n\n    /**\n     *\n     * @param [markup] If provided deletes markup (has to have same type that the edit mode), otherwise deletes selected one.\n     * @param [cantUndo] If true to not add deletion to undo history.\n     * @returns {boolean}\n     */\n    proto.deleteMarkup = function (markup, cantUndo) {\n\n        return false;\n    };\n\n    /**\n     * Used by classes extending EditMode to validate the minimum size (in screen coordinates) of the markup.\n     * See minSize attribute\n     * @return {Boolean} Whether current size is valid for creating the markup\n     * @private\n     */\n    proto.isMinSizeValid = function() {\n\n        if (this.minSize !== 0) {\n\n            var tmp = this.editor.sizeFromMarkupsToClient(this.size.x, this.size.y);\n            return (tmp.x*tmp.x + tmp.y*tmp.y) >= (this.minSize * this.minSize);\n\n        }\n        return true;\n    };\n\n    /**\n     * @private\n     */\n    proto.startDragging = function() {\n\n        var selectedMarkup = this.selectedMarkup;\n        var mousePosition = this.editor.getMousePosition();\n\n        if (selectedMarkup) {\n\n            this.dragging = true;\n            this.draggingAnnotationIniPosition = selectedMarkup.getClientPosition();\n            this.draggingMouseIniPosition.set(mousePosition.x, mousePosition.y);\n        }\n    };\n\n    /**\n     * @private\n     */\n    proto.finishDragging = function() {\n\n        var dragging = this.dragging;\n        var selectedMarkup = this.selectedMarkup;\n\n        this.dragging = false;\n\n        if (selectedMarkup && dragging) {\n\n            selectedMarkup.finishDragging();\n        }\n    };\n\n    /**\n     *\n     * @returns {{x: number, y: number}}\n     */\n    proto.getFinalMouseDraggingPosition = function() {\n\n        var editor = this.editor;\n        var bounds = editor.getBounds();\n        var mousePosition = editor.getMousePosition();\n\n        var initialX = this.initialX;\n        var initialY = this.initialY;\n\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\n\n        if (finalX == initialX &&\n            finalY == initialY) {\n            finalX++;\n            finalY++;\n        }\n\n        // Make equal x/y when shift is down\n        if (editor.input.makeSameXY) {\n            var dx = Math.abs(finalX - initialX);\n            var dy = Math.abs(finalY - initialY);\n\n            var maxDelta = Math.max(dx, dy);\n\n            // These calculations have the opportunity to go beyond 'bounds'.\n            finalX = initialX + maxDelta * sign(finalX - initialX);\n            finalY = initialY + maxDelta * sign(finalY - initialY);\n        }\n\n        return { x:finalX, y:finalY };\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n    };\n\n    proto.onMouseMove = function (event) {\n        if (!this.selectedMarkup || !this.creating) {\n            return false;\n        }\n        return true;\n    };\n\n    proto.onMouseDown = function () {\n\n    };\n\n    /**\n     * Handler to mouse up events, used to start annotations creation.\n     * It will cancel the creation of a markup if its minSize conditions are not met.\n     *\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseUp = function(event) {\n\n        if (this.creationMethod !== this.CREATION_METHOD_DRAG) {\n            return false;\n        }\n\n        return this.creationEnd();\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if (this.creationMethod !== this.CREATION_METHOD_CLICKS) {\n            return;\n        }\n\n        this.creationEnd();\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        if (this.creating) {\n            this.creationCancel();\n        }\n    };\n\n    /**\n     *\n     * @returns {{x: *, y: *}}\n     */\n    proto.getDraggingPosition = function () {\n\n        var mousePosition = this.editor.getMousePosition();\n\n        var dx = mousePosition.x - this.draggingMouseIniPosition.x;\n        var dy = mousePosition.y - this.draggingMouseIniPosition.y;\n\n        return {\n            x: this.draggingAnnotationIniPosition.x + dx,\n            y: this.draggingAnnotationIniPosition.y + dy\n        };\n    };\n\n    /**\n     *\n     * @param x\n     * @param y\n     * @param bounds\n     * @returns {boolean}\n     * @orivate\n     */\n    proto.isInsideBounds = function (x, y, bounds) {\n\n        return x >= bounds.x && x <= bounds.x + bounds.width &&\n               y >= bounds.y && y <= bounds.y + bounds.height;\n    };\n\n    /*\n     * Decides whether to use the snapper in the current edit mode or not.\n     *\n     * @returns {boolean}\n     */\n    proto.useWithSnapping = function () {\n        return this.viewer.model.is2d();\n    };\n\n\n    proto.isTextInputHelperActive = function() {\n        return this.textInputHelper && this.textInputHelper.isActive();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateArrow } from './CreateArrow';\n\n    /**\n     *\n     * @param editor\n     * @param arrow\n     * @constructor\n     */\n    export function DeleteArrow(editor, arrow) {\n\n        // Confusing naming here. Arrow.tail is the starting point of the arrow,\n        // and arrow.head is the final point. In CreateArrow the head argument\n        // is the first point of the arrow and the tail argument is the second\n        // point of the argument. So construct CreateArrow with the tail before\n        // the head.\n        EditAction.call(this, editor, 'DELETE-ARROW', arrow.id);\n        this.createArrow = new CreateArrow(\n            editor,\n            arrow.id,\n            arrow.tail,\n            arrow.head,\n            arrow.getStyle());\n    }\n\n    DeleteArrow.prototype = Object.create(EditAction.prototype);\n    DeleteArrow.prototype.constructor = DeleteArrow;\n\n    var proto = DeleteArrow.prototype;\n\n    proto.redo = function() {\n\n        this.createArrow.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createArrow.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param arrow\n     * @param head\n     * @param tail\n     * @constructor\n     */\n    export function SetArrow(editor, arrow, head, tail) {\n\n        EditAction.call(this, editor, 'SET-ARROW', arrow.id);\n\n        this.newHead = {x: head.x, y: head.y};\n        this.newTail = {x: tail.x, y: tail.y};\n        this.oldHead = {x: arrow.head.x, y: arrow.head.y};\n        this.oldTail = {x: arrow.tail.x, y: arrow.tail.y};\n    }\n\n    SetArrow.prototype = Object.create(EditAction.prototype);\n    SetArrow.prototype.constructor = SetArrow;\n\n    var proto = SetArrow.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newHead, this.newTail);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldHead, this.oldTail);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newHead = action.newHead;\n            this.newTail = action.newTail;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, head, tail) {\n\n        var arrow = this.editor.getMarkup(targetId);\n        if(!arrow) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(arrow.head.x - head.x) >= epsilon || Math.abs(arrow.head.y - head.y) >= epsilon ||\n            Math.abs(arrow.tail.x - tail.x) >= epsilon || Math.abs(arrow.tail.y - tail.y) >= epsilon) {\n\n            // Confusing naming here. in arrow.set the first two numbers are\n            // the point you drag from and the second two are the point you\n            // drag to. So the head point is actually where the tail of the\n            // arrow is positioned and the tail point is the head is positioned.\n            arrow.set(head.x, head.y, tail.x, tail.y);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return (\n            this.newHead.x === this.oldHead.x &&\n            this.newHead.y === this.oldHead.y &&\n            this.newTail.x === this.oldTail.x &&\n            this.newTail.y === this.oldTail.y);\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeleteArrow } from '../edit-actions/DeleteArrow';\nimport { CreateArrow } from '../edit-actions/CreateArrow';\nimport { SetArrow } from '../edit-actions/SetArrow';\nimport * as MarkupTypes from '../MarkupTypes';\n\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeArrow(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_ARROW, styleAttributes);\n    }\n\n    EditModeArrow.prototype = Object.create(EditMode.prototype);\n    EditModeArrow.prototype.constructor = EditModeArrow;\n\n\n    var proto = EditModeArrow.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteArrow = new DeleteArrow(this.editor, markup);\n            deleteArrow.addToHistory = !cantUndo;\n            deleteArrow.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        this.size.x = 0;\n        this.size.y = 0;\n\n        // Snap to parallel/perpendicular of underlying vectors\n        this.lineSnapped = null;\n        if (editor.snapper) {\n            var geomType = editor.snapper.getGeometryType();\n            if (geomType === MeasureCommon.SnapType.SNAP_VERTEX ||\n                geomType === MeasureCommon.SnapType.SNAP_EDGE ||\n                geomType === MeasureCommon.SnapType.SNAP_MIDPOINT ||\n                geomType === MeasureCommon.SnapType.SNAP_CIRCLE_CENTER)\n            {\n                this.lineSnapped = editor.snapper.getEdge();\n            }\n        }\n\n        // Calculate head and tail.\n        var arrowMinSize = this.style['stroke-width'] * 3.5;\n\n        var head = this.head = editor.positionFromClientToMarkups(this.initialX, this.initialY);\n        var tail = {\n            x: head.x + Math.cos( Math.PI * 0.25) * arrowMinSize,\n            y: head.y + Math.sin(-Math.PI * 0.25) * arrowMinSize\n        };\n        // Constrain head and tail inside working area.\n        var constrain = function(head, tail, size, bounds) {\n\n            if (this.isInsideBounds(tail.x, tail.y, bounds)) {\n                return;\n            }\n\n            tail.y = head.y + Math.sin( Math.PI * 0.25) * size;\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\n                return;\n            }\n\n            tail.x = head.x + Math.cos(-Math.PI * 0.25) * size;\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\n                return;\n            }\n\n            tail.y = head.y + Math.sin(-Math.PI * 0.25) * size;\n\n        }.bind(this);\n\n        constrain( head, tail, arrowMinSize, editor.getBounds());\n\n        // Create arrow.\n        editor.beginActionGroup();\n\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\n\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\n            tail.x = head.x + arrowVector.x;\n            tail.y = head.y + arrowVector.y;\n        }\n\n        var arrowId = editor.getId();\n        var create = new CreateArrow(editor, arrowId, head, tail, this.style);\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(arrowId);\n        this.creationBegin();\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n        var final = this.getFinalMouseDraggingPosition();\n        var initialX = this.initialX;\n        var initialY = this.initialY;\n\n        // Snap to parallel/perpendicular of underlying vectors\n        if (editor.snapper && !editor.snapper.isSnapped() && this.lineSnapped) {\n            var start = editor.project(this.lineSnapped.vertices[0]);\n            var end = editor.project(this.lineSnapped.vertices[1]);\n            var p = new THREE.Vector3(final.x, final.y, start.z);\n\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\n\n            // select an arbitrary point on the perpendicular line\n            var k = -(start.x - end.x) / (start.y - end.y);\n            var b = initialY - k * initialX;\n            var x = initialX + 1;\n            var y = k * x + b;\n            var pEnd = new THREE.Vector3(x, y, start.z);\n\n            var pStart = new THREE.Vector3(initialX, initialY, start.z);\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\n\n            // Snap to parallel of underlying vectors\n            if (parallel.distanceTo(p) <= 20) {\n                final.x = parallel.x;\n                final.y = parallel.y;\n            }\n            // Snap to perpendicular of underlying vectors\n            else if (perpendicular.distanceTo(p) <= 20) {\n                final.x = perpendicular.x;\n                final.y = perpendicular.y;\n            }\n        }\n\n        var head = this.head;\n        var tail = editor.positionFromClientToMarkups(final.x, final.y);\n\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\n        var arrowMinSize = selectedMarkup.style['stroke-width'] * 3.5;\n\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\n\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\n            tail.x = head.x + arrowVector.x;\n            tail.y = head.y + arrowVector.y;\n        }\n\n        this.size = editor.sizeFromClientToMarkups((final.x - initialX), (final.y - initialY));\n\n        var setArrow = new SetArrow(editor, selectedMarkup, head, tail);\n        setArrow.execute();\n        return true;\n    };","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n    updateMarkupPathSvgHitarea, checkLineSegment, addMarkupMetadata } from './MarkupsCoreUtils';\nimport { cloneStyle } from './StyleUtils';\nimport { EditModeArrow } from './edit-modes/EditModeArrow';\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupArrow(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n        this.checkLineSegment = checkLineSegment.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_ARROW;\n        this.constraintHeight = true;\n\n        // Create head and tail.\n        this.head = new THREE.Vector3();\n        this.tail = new THREE.Vector3();\n        this.size.y = this.style['stroke-width'] * 3;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupArrow.prototype = Object.create(Markup.prototype);\n    MarkupArrow.prototype.constructor = MarkupArrow;\n\n    var proto = MarkupArrow.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeArrow(this.editor);\n    };\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     * Notice that for the arrow, the top left is the \"tail\" of the arrow and\n     * the bottom right is the \"head\" of it.\n     *\n     * @param {Number} xO - tail\n     * @param {Number} yO - tail\n     * @param {Number} xF - head\n     * @param {Number} yF - head\n     */\n    proto.set = function(xO, yO, xF, yF) {\n\n        var vO = new THREE.Vector2(xO, yO);\n        var vF = new THREE.Vector2(xF, yF);\n        var vDir = vF.clone().sub(vO).normalize();\n\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\n\n        var head = this.head;\n        var tail = this.tail;\n\n        head.set(xF, yF, 0);\n        tail.set(xO, yO, 0);\n\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the rotation of the markup to the given angle.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\n     *\n     * @param {Number} angle\n     */\n    proto.setRotation = function(angle) {\n\n        this.rotation = angle;\n\n        var xF = Math.cos(-angle);\n        var yF = Math.sin(-angle);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(this.size.x*0.5);\n\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.head.set(vF.x, vF.y, 0);\n        this.tail.set(vO.x, vO.y, 0);\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the namespace.SetSize edit action\n     * @param {{x: Number, y: Number}} position - arrow's center\n     * @param {Number} width - Arrow's length\n     * @param {Number} height - We ignore this one because we use the arrow's stroke width instead\n     */\n    proto.setSize = function(position, width, height) {\n\n        var xF = Math.cos(-this.rotation);\n        var yF = Math.sin(-this.rotation);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(width*0.5);\n\n        var vCenter = new THREE.Vector2(position.x, position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.head.set(vF.x, vF.y, 0);\n        this.tail.set(vO.x, vO.y, 0);\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n\n        this.updateStyle();\n    };\n\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var strokeWidth = style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var transform = this.getTransform();\n\n        this.size.y = strokeWidth * 3;\n        this.style['fill-color'] = style['stroke-color'];\n        this.style['fill-opacity'] = style['stroke-opacity'];\n\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Used by the EditFrame to move the markup in Client Space coordinates\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\n     */\n    proto.setPosition = function (x, y) {\n\n        var head = this.head;\n        var tail = this.tail;\n\n        var dx = head.x - tail.x;\n        var dy = head.y - tail.y;\n\n        var xo = x + dx * 0.5;\n        var yo = y + dy * 0.5;\n\n        head.x = xo;\n        head.y = yo;\n\n        tail.x = xo - dx;\n        tail.y = yo - dy;\n\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\n\n        this.updateStyle();\n    };\n\n    proto.generatePoint3d = function(idTarget) {\n\n        var head = this.editor.positionFromMarkupsToClient(this.head.x, this.head.y);\n        var tail = this.editor.positionFromMarkupsToClient(this.tail.x, this.tail.y);\n\n        var direction = head.clone().sub(tail).normalize();\n\n        var point2d = this.checkLineSegment(head.x, head.y, head.x + direction.x * 200, head.y + direction.y * 200, idTarget);\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\n\n        return point3d && point3d.point;\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.head = [this.head.x, this.head.y].join(\" \");\n        metadata.tail = [this.tail.x, this.tail.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        // To build the arrow we need 7 points in total\n        // The 'default' arrow built here has the following characteristics:\n        //\n        // 1. It is built horizontally facing right\n        // 2. It's bounding rectangle has length: this.size.x\n        // 3. It's bounding rectangle has height: 2 * this.strokeWidth\n        // 4. The arrow tail's thickness is: this.strokeWidth\n        // 5. The arrow head's length is: 2/3 of (point 3)\n        // 6. The arrow head's thickness is: (point 3)\n        // 7. The arrow generated is centered in its local (0,0), meaning that\n        //    two points are placed with negative x values, and all other have\n        //    positive x values:\n        //\n        //                            (3)\\\n        //                              \\  \\\n        //             (1)-------------(2)   \\\n        //              |         (0)        (4)\n        //             (7)-------------(6)   /\n        //                              /  /\n        //                            (5)/\n        //\n\n        var sizeX = this.size.x;\n        var sizeY = this.size.y;\n        var sizeYOver3 = sizeY/3;\n        var strokeWidth = this.style['stroke-width'];\n        var tailW = sizeX - strokeWidth * 3;\n        var headW = sizeX - tailW;\n        var spikeOffset = strokeWidth * 0.3;\n\n        return [\n            'M', -sizeX * 0.5        , -sizeY * 0.5 + sizeYOver3,    // (1)\n            'l',  tailW              ,  0,                           // (2)\n            'l', -spikeOffset        , -sizeYOver3,                  // (3)\n            'l',  headW + spikeOffset,  sizeYOver3 * 1.5,            // (4)\n            'l', -headW - spikeOffset,  sizeYOver3 * 1.5,            // (5)\n            'l',  spikeOffset        , -sizeYOver3,                  // (6)\n            'l', -tailW              ,  0,                           // (7)\n            'z'\n        ];\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupArrow } from '../MarkupArrow';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     * @constructor\n     */\n    export function CreateArrow(editor, id, head, tail, style) {\n\n        EditAction.call(this, editor, 'CREATE-ARROW', id);\n\n        this.selectOnExecution = false;\n        this.tail = tail;\n        this.head = head;\n        this.style = cloneStyle(style);\n    }\n\n    CreateArrow.prototype = Object.create(EditAction.prototype);\n    CreateArrow.prototype.constructor = CreateArrow;\n\n    var proto = CreateArrow.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var arrow = new MarkupArrow(this.targetId, editor);\n\n        editor.addMarkup(arrow);\n\n        // Confusing naming here. in arrow.set the first two numbers are\n        // the point you drag from and the second two are the point you\n        // drag to. So the head point is actually where the tail of the\n        // arrow is positioned and the tail point is the head is positioned.\n\n        //TODO: In MarkupArrow \"set\" function has tail x, tail y, head x, head y but used here in the opposite way\n        arrow.set(this.head.x, this.head.y, this.tail.x, this.tail.y);\n        arrow.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateRectangle } from './CreateRectangle';\n\n    /**\n     *\n     * @param editor\n     * @param rectangle\n     * @constructor\n     */\n    export var DeleteRectangle = function(editor, rectangle) {\n\n        EditAction.call(this, editor, 'DELETE-RECTANGLE', rectangle.id);\n        this.createRectangle = new CreateRectangle(\n            editor,\n            rectangle.id,\n            rectangle.position,\n            rectangle.size,\n            rectangle.rotation,\n            rectangle.getStyle());\n    };\n\n    DeleteRectangle.prototype = Object.create(EditAction.prototype);\n    DeleteRectangle.prototype.constructor = DeleteRectangle;\n\n    var proto = DeleteRectangle.prototype;\n\n    proto.redo = function() {\n\n        this.createRectangle.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createRectangle.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param rectangle\n     * @param position\n     * @param size\n     * @constructor\n     */\n    export function SetRectangle(editor, rectangle, position, size) {\n\n        EditAction.call(this, editor, 'SET-RECTANGLE', rectangle.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: rectangle.position.x, y: rectangle.position.y};\n        this.oldSize = {x: rectangle.size.x, y: rectangle.size.y};\n    }\n\n    SetRectangle.prototype = Object.create(EditAction.prototype);\n    SetRectangle.prototype.constructor = SetRectangle;\n\n    var proto = SetRectangle.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newPosition, this.newSize);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, position, size) {\n\n        var rectangle = this.editor.getMarkup(targetId);\n        if(!rectangle) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(rectangle.position.x - position.x) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon ||\n            Math.abs(rectangle.position.y - position.y) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon) {\n\n            rectangle.set(position, size);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return(\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newSize.x === this.oldSize.x &&\n            this.newSize.y === this.oldSize.y);\n    };\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeleteRectangle } from '../edit-actions/DeleteRectangle';\nimport { CreateRectangle } from '../edit-actions/CreateRectangle';\nimport { SetRectangle } from '../edit-actions/SetRectangle';\nimport * as MarkupTypes from '../MarkupTypes';\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeRectangle(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_RECTANGLE, styleAttributes);\n    }\n\n    EditModeRectangle.prototype = Object.create(EditMode.prototype);\n    EditModeRectangle.prototype.constructor = EditModeRectangle;\n\n    var proto = EditModeRectangle.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteRectangle = new DeleteRectangle(this.editor, markup);\n            deleteRectangle.addToHistory = !cantUndo;\n            deleteRectangle.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        var pos = this.getFinalMouseDraggingPosition();\n        var final = editor.clientToMarkups(pos.x, pos.y);\n        var position = {x: (this.firstCorner.x + final.x) / 2, y: (this.firstCorner.y + final.y) / 2};\n\n        var width, height;\n        // Snap to parallel/perpendicular of underlying vectors\n        if (editor.snapper && this.lineSnapped) {\n            var start = editor.project(this.lineSnapped.vertices[0]);\n            var end = editor.project(this.lineSnapped.vertices[1]);\n\n            var startZ = start.z;\n\n            start = editor.clientToMarkups(start.x, start.y);\n            end = editor.clientToMarkups(end.x, end.y);\n\n            start = new THREE.Vector3(start.x, start.y, startZ);\n            end = new THREE.Vector3(end.x, end.y, startZ);\n\n            var p = new THREE.Vector3(final.x, final.y, startZ);\n\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\n            height = p.distanceTo(parallel);\n\n            // select an arbitrary point on the perpendicular line\n            var k = -(start.x - end.x) / (start.y - end.y);\n            var b = this.firstCorner.y - k * this.firstCorner.x;\n            var x = this.firstCorner.x + 1;\n            var y = k * x + b;\n            var pEnd = new THREE.Vector3(x, y, startZ);\n\n            var pStart = new THREE.Vector3(this.firstCorner.x, this.firstCorner.y, startZ);\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\n            width = p.distanceTo(perpendicular);\n        }\n        else {\n            width = final.x - this.firstCorner.x;\n            height = final.y - this.firstCorner.y;\n        }\n\n        var size = this.size = {x: Math.abs(width), y: Math.abs(height)};\n\n        var setRectangle = new SetRectangle(\n            editor,\n            selectedMarkup,\n            position,\n            size);\n\n        setRectangle.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        // Calculate center and size.\n        var position = this.firstCorner = editor.clientToMarkups(this.initialX, this.initialY);\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Calculate rotation\n        var rotation = 0;\n        this.lineSnapped = null;\n        if (editor.snapper) {\n            // Snap to parallel/perpendicular of underlying vectors\n            var geomType = editor.snapper.getGeometryType();\n            if (geomType === MeasureCommon.SnapType.SNAP_EDGE) {\n                this.lineSnapped = editor.snapper.getEdge();\n                var start = editor.project(this.lineSnapped.vertices[0]);\n                var end = editor.project(this.lineSnapped.vertices[1]);\n                var dx = end.x - start.x;\n                var dy = end.y - start.y;\n                rotation = this.rotation = Math.atan2(dy, dx);\n            }\n        }\n\n        // Create rectangle.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreateRectangle(\n            editor,\n            markupId,\n            position,\n            size,\n            rotation,\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { createMarkupPathSvg, composeRGBAString, createRectanglePath,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils';\nimport { cloneStyle } from './StyleUtils';\nimport { EditModeRectangle } from './edit-modes/EditModeRectangle';\n\n    /**\n     * Rectangle markup.\n     *\n     * Implements a Rectangle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific markup type. Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.Markup\n     *\n     * @param {number} id\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     * @constructor\n     */\n    export function MarkupRectangle(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // Bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_RECTANGLE;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupRectangle.prototype = Object.create(Markup.prototype);\n    MarkupRectangle.prototype.constructor = MarkupRectangle;\n\n    var proto = MarkupRectangle.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeRectangle(this.editor);\n    };\n\n    /**\n     * Sets position and size in markup space coordinates\n     * @param {Object} position\n     * @param {Object} size\n     */\n    proto.set = function(position, size) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = size.x;\n        this.size.y = size.y;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var strokeWidth = this.style['stroke-width'];\n\n        var w = this.size.x - strokeWidth;\n        var h = this.size.y - strokeWidth;\n        var x =-w * 0.5;\n        var y =-h * 0.5;\n\n        var path = [];\n        createRectanglePath(x, y, w, h, false, path);\n\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupRectangle } from '../MarkupRectangle';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param style\n     * @constructor\n     */\n    export function CreateRectangle(editor, id, position, size, rotation, style) {\n\n        EditAction.call(this, editor, 'CREATE-RECTANGLE', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n    }\n\n    CreateRectangle.prototype = Object.create(EditAction.prototype);\n    CreateRectangle.prototype.constructor = CreateRectangle;\n\n    var proto = CreateRectangle.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var rectangle = new MarkupRectangle(this.targetId, editor);\n\n        editor.addMarkup(rectangle);\n\n        rectangle.set(this.position, this.size);\n        rectangle.setRotation(this.rotation);\n        rectangle.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateText } from './CreateText';\n\n    /**\n     *\n     * @param editor\n     * @param text\n     * @constructor\n     */\n    export function DeleteText(editor, text) {\n\n        EditAction.call(this, editor, 'DELETE-TEXT', text.id);\n\n        var position = {x: text.position.x, y: text.position.y};\n        var size = {x: text.size.x, y: text.size.y};\n\n        this.createText = new CreateText(\n            editor,\n            text.id,\n            position,\n            size,\n            text.getText(),\n            text.getStyle());\n    }\n\n    DeleteText.prototype = Object.create(EditAction.prototype);\n    DeleteText.prototype.constructor = DeleteText;\n\n    var proto = DeleteText.prototype;\n\n    proto.redo = function() {\n\n        this.createText.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createText.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param position\n     * @param size\n     * @param text\n     * @constructor\n     */\n    export function SetCallout(editor, markup, position, size, text, isFrameUsed) {\n\n        EditAction.call(this, editor, 'SET-CALLOUT', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\n        this.newText = text;\n        this.oldText = markup.getText();\n        this.newIsFrameUsed = isFrameUsed;\n        this.oldIsFrameUsed = markup.isFrameUsed;\n    }\n\n    SetCallout.prototype = Object.create(EditAction.prototype);\n    SetCallout.prototype.constructor = SetCallout;\n\n    var proto = SetCallout.prototype;\n\n    proto.redo = function() {\n\n        var callout = this.editor.getMarkup(this.targetId);\n        callout && callout.set(this.newPosition, this.newSize, this.newText, this.newIsFrameUsed);\n    };\n\n    proto.undo = function() {\n\n        var callout = this.editor.getMarkup(this.targetId);\n        callout && callout.set(this.oldPosition, this.oldSize, this.oldText, this.oldIsFrameUsed);\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param position\n     * @param width\n     * @param height\n     * @constructor\n     */\n    export function SetSize(editor, markup, position, width, height) {\n\n        EditAction.call(this, editor, 'SET-SIZE', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n        this.newWidth = width;\n        this.oldWidth = markup.size.x;\n        this.newHeight = height;\n        this.oldHeight = markup.size.y;\n    }\n\n    SetSize.prototype = Object.create(EditAction.prototype);\n    SetSize.prototype.constructor = SetSize;\n\n    var proto = SetSize.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setSize(this.newPosition, this.newWidth, this.newHeight);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setSize(this.oldPosition, this.oldWidth, this.oldHeight);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newWidth = action.newWidth;\n            this.newHeight = action.newHeight;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        var identity =\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newWidth === this.oldWidth &&\n            this.newHeight === this.oldHeight;\n\n        return identity;\n    };\n","\n'use strict';\n\n/*!\n    Based on Autosize 4.0.0\n    license: MIT\n    http://www.jacklmoore.com/autosize\n*/\nvar map = typeof Map === \"function\" ? new Map() : (function () {\n    var keys = [];\n    var values = [];\n\n    return {\n        has: function has(key) {\n            return keys.indexOf(key) > -1;\n        },\n        get: function get(key) {\n            return values[keys.indexOf(key)];\n        },\n        set: function set(key, value) {\n            if (keys.indexOf(key) === -1) {\n                keys.push(key);\n                values.push(value);\n            }\n        },\n        'delete': function _delete(key) {\n            var index = keys.indexOf(key);\n            if (index > -1) {\n                keys.splice(index, 1);\n                values.splice(index, 1);\n            }\n        }\n    };\n})();\n\nvar createEvent = function createEvent(name) {\n    return new Event(name, { bubbles: true });\n};\n\nfunction assign(ta) {\n    if (!ta || !ta.nodeName || ta.nodeName !== 'TEXTAREA' || map.has(ta)) return;\n\n    var heightOffset = null;\n    var clientWidth = ta.clientWidth;\n    var cachedHeight = null;\n\n    const self = this;\n    function init() {\n        const _window = self.getWindow();\n        var style = _window.getComputedStyle(ta, null);\n\n        if (style.resize === 'vertical') {\n            ta.style.resize = 'none';\n        } else if (style.resize === 'both') {\n            ta.style.resize = 'horizontal';\n        }\n\n        if (style.boxSizing === 'content-box') {\n            heightOffset = -(parseFloat(style.paddingTop) + parseFloat(style.paddingBottom));\n        } else {\n            heightOffset = parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);\n        }\n        // Fix when a textarea is not on document body and heightOffset is Not a Number\n        if (isNaN(heightOffset)) {\n            heightOffset = 0;\n        }\n\n        update();\n    }\n\n    function changeOverflow(value) {\n        {\n            // Chrome/Safari-specific fix:\n            // When the textarea y-overflow is hidden, Chrome/Safari do not reflow the text to account for the space\n            // made available by removing the scrollbar. The following forces the necessary text reflow.\n            var width = ta.style.width;\n            ta.style.width = '0px';\n            // Force reflow:\n            /* jshint ignore:start */\n            ta.offsetWidth;\n            /* jshint ignore:end */\n            ta.style.width = width;\n        }\n\n        ta.style.overflow = value;\n    }\n\n    function getParentOverflows(el) {\n        var arr = [];\n\n        while (el && el.parentNode && el.parentNode instanceof Element) {\n            if (el.parentNode.scrollTop) {\n                arr.push({\n                    node: el.parentNode,\n                    scrollTop: el.parentNode.scrollTop\n                });\n            }\n            el = el.parentNode;\n        }\n\n        return arr;\n    }\n\n    function resize() {\n        var originalHeight = ta.style.height;\n        var overflows = getParentOverflows(ta);\n        const _document = self.getDocument();\n        var docTop = _document.documentElement && _document.documentElement.scrollTop; // Needed for Mobile IE (ticket #240)\n\n        ta.style.height = '';\n\n        var endHeight = ta.scrollHeight + heightOffset;\n\n        if (ta.scrollHeight === 0) {\n            // If the scrollHeight is 0, then the element probably has display:none or is detached from the DOM.\n            ta.style.height = originalHeight;\n            return;\n        }\n\n        ta.style.height = endHeight + 'px';\n\n        // used to check if an update is actually necessary on window.resize\n        clientWidth = ta.clientWidth;\n\n        // prevents scroll-position jumping\n        overflows.forEach(function (el) {\n            // This condition is necessary for iOS 11, where you can't assign value to body.scrollTop\n            if (el.node.scrollTop !== el.scrollTop) {\n                el.node.scrollTop = el.scrollTop;\n            }\n        });\n\n        if (docTop) {\n            _document.documentElement.scrollTop = docTop;\n        }\n    }\n\n    function update() {\n        resize();\n\n        const _window = self.getWindow();\n        var styleHeight = Math.round(parseFloat(ta.style.height));\n        var computed = _window.getComputedStyle(ta, null);\n\n        // Using offsetHeight as a replacement for computed.height in IE, because IE does not account use of border-box\n        var actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(computed.height)) : ta.offsetHeight;\n\n        // The actual height not matching the style height (set via the resize method) indicates that\n        // the max-height has been exceeded, in which case the overflow should be allowed.\n        if (actualHeight !== styleHeight) {\n            if (computed.overflow === 'hidden') {\n                changeOverflow('scroll');\n                resize();\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\n            }\n        } else {\n            // Normally keep overflow set to hidden, to avoid flash of scrollbar as the textarea expands.\n            if (computed.overflow !== 'hidden') {\n                changeOverflow('hidden');\n                resize();\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\n            }\n        }\n\n        if (cachedHeight !== actualHeight) {\n            cachedHeight = actualHeight;\n            var evt = createEvent('autosize:resized');\n            try {\n                ta.dispatchEvent(evt);\n            } catch (err) {\n                // Firefox will throw an error on dispatchEvent for a detached element\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=889376\n            }\n        }\n    }\n\n    var pageResize = function pageResize() {\n        if (ta.clientWidth !== clientWidth) {\n            update();\n        }\n    };\n\n    var destroy = (function (style) {\n        self.removeWindowEventListener('resize', pageResize, false);\n        ta.removeEventListener('input', update, false);\n        ta.removeEventListener('keyup', update, false);\n        ta.removeEventListener('autosize:destroy', destroy, false);\n        ta.removeEventListener('autosize:update', update, false);\n\n        Object.keys(style).forEach(function (key) {\n            ta.style[key] = style[key];\n        });\n\n        map['delete'](ta);\n    }).bind(ta, {\n        height: ta.style.height,\n        resize: ta.style.resize,\n        overflow: ta.style.overflow,\n        overflowX: ta.style.overflowX,\n        wordWrap: ta.style.wordWrap\n    });\n\n    ta.addEventListener('autosize:destroy', destroy, false);\n\n    // IE9 does not fire onpropertychange or oninput for deletions,\n    // so binding to onkeyup to catch most of those events.\n    // There is no way that I know of to detect something like 'cut' in IE9.\n    if ('onpropertychange' in ta && 'oninput' in ta) {\n        ta.addEventListener('keyup', update, false);\n    }\n\n    self.addWindowEventListener('resize', pageResize, false);\n    ta.addEventListener('input', update, false);\n    ta.addEventListener('autosize:update', update, false);\n    ta.style.overflowX = 'hidden';\n    ta.style.wordWrap = 'break-word';\n\n    map.set(ta, {\n        destroy: destroy,\n        update: update\n    });\n\n    init();\n}\n\nfunction destroy(ta) {\n    var methods = map.get(ta);\n    if (methods) {\n        methods.destroy();\n    }\n}\n\nfunction update(ta) {\n    var methods = map.get(ta);\n    if (methods) {\n        methods.update();\n    }\n}\n\nfunction isRuntimeSupported() {\n    // Don't support Node.js and IE8 (or lower)\n    if (typeof window === 'undefined' || typeof window.getComputedStyle !== 'function')\n        return false;\n    return true;\n}\n\nconst RUNTIME_SUPPORTED = isRuntimeSupported();\n\n\nexport var autosize = function(el, options) {\n    const self = this;\n    if (RUNTIME_SUPPORTED && el) {\n        Array.prototype.forEach.call(el.length ? el : [el], function (x) {\n            return assign.bind(self)(x, options);\n        });\n    }\n    return el;\n};\n\nautosize.destroy = function(el) {\n    if (RUNTIME_SUPPORTED && el) {\n        Array.prototype.forEach.call(el.length ? el : [el], destroy);\n    }\n    return el;\n};\n\nautosize.update = function(el) {\n    if (RUNTIME_SUPPORTED && el) {\n        Array.prototype.forEach.call(el.length ? el : [el], update);\n    }\n    return el;\n};\n","'use strict';\n\n    /**\n     * Curring object which generate a string that can be used\n     * as a Dom element's 'style' value.\n     *\n     * @constructor\n     */\n    export function DomElementStyle() {\n\n        this.reset();\n    }\n\n    /*\n     * Constants\n     */\n    var BROWSER_PREFIXES = ['-ms-', '-webkit-', '-moz-', '-o-'];\n\n    var proto = DomElementStyle.prototype;\n\n    proto.reset = function() {\n\n        this.attributes = {};\n        this.dirty = false;\n        this.styleString = '';\n\n        return this;\n    };\n\n    /**\n     *\n     * @param {String} key\n     * @param {*} value\n     * @param {Object} [options]\n     * @param {Boolean} [options.allBrowsers] - Whether to add browser prefix to key\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomeElemStyle}\n     */\n    proto.setAttribute = function(key, value, options) {\n\n        this.attributes[key] = value;\n\n        if (options && options.allBrowsers) {\n            var that = this;\n            BROWSER_PREFIXES.forEach(function(prefix){\n                that.attributes[(prefix+key)] = value;\n            });\n        }\n        this.dirty = true; // Could be optimized\n        return this;\n    };\n\n    /**\n     * Removes one or more attributes\n     * @param {String|Array} key - Key or Keys to be removed\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle} this\n     */\n    proto.removeAttribute = function(key) {\n\n        if (!Array.isArray(key)) {\n            key = [key];\n        }\n\n        var self = this;\n        key.forEach(function(k) {\n            if (k in self.attributes) {\n                delete self.attributes[k];\n                self.dirty = true;\n            }\n        });\n        return this;\n    };\n\n    /**\n     * Gets the String representation of this style object\n     * @returns {string}\n     */\n    proto.getStyleString = function() {\n\n        if (this.dirty) {\n            this.styleString = generateStyle(this.attributes);\n            this.dirty = false;\n        }\n        return this.styleString;\n    };\n\n    /**\n     * Clones the current Object\n     *\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle}\n     */\n    proto.clone = function() {\n\n        var clone = new DomElementStyle();\n        var attributes = this.attributes;\n\n        for (var key in attributes) {\n            clone.setAttribute(key, attributes[key]);\n        }\n        return clone;\n    };\n\n    /**\n     * Generates the style value string. Non mutable function.\n     *\n     * @param {Object} attributes\n     * @private\n     */\n    function generateStyle(attributes) {\n\n        var elements = [];\n        for (var key in attributes) {\n            var val = attributes[key];\n            elements.push(key);\n            elements.push(':');\n            elements.push(val);\n            elements.push('; ');\n        }\n        return elements.join('');\n    }\n","'use strict';\n\nimport { autosize } from './EditorTextAutosize';\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils';\nimport { cloneStyle } from '../StyleUtils';\nimport { DomElementStyle } from '../DomElementStyle';\n\nconst av = Autodesk.Viewing;\n\n    /**\n     * Auxiliary class that handles all input for the Label Markup (MarkupText.js)\n     * It instantiates a TEXTAREA where the user can input text. When user input is\n     * disabled, the textarea gets hidden and further rendering is delegated to\n     * MarkupText.js\n     *\n     * @param {HTMLElement} parentDiv\n     * @param {Object} editor - Core Extension\n     * @constructor\n     */\n    export function EditorTextInput(parentDiv, editor, singleLine, defaultText, maxLength) {\n\n        this.parentDiv = parentDiv;\n        this.editor = editor;\n        this.setGlobalManager(editor.viewer.globalManager);\n\n        // Constants\n        this.EVENT_TEXT_CHANGE = 'EVENT_CO2_TEXT_CHANGE';\n        this.EVENT_TEXT_SET_ACTIVE = 'EVENT_CO2_TEXT_SET_ACTIVE';\n        this.EVENT_TEXT_SET_INACTIVE = 'EVENT_CO2_TEXT_SET_INACTIVE';\n\n        const _document = this.getDocument();\n        // The actual TextArea input\n        if (singleLine) {\n            this.textArea = _document.createElement('input');\n            this.textArea.setAttribute('type', 'text');\n        }\n        else {\n            this.textArea = _document.createElement('textarea');\n            this.textArea.rows = '1';\n            this.textArea.dir = 'auto';\n        }\n\n        this.firstEdit = true;\n        this.defaultText = defaultText;\n        this.textArea.setAttribute('maxlength', maxLength); // TODO: Make constant? Change value?\n        this.textArea.setAttribute('data-i18n', defaultText);\n        this.startingHeight = 0;\n\n        autosize.bind(this)(this.textArea);\n\n        var ro = new ResizeObserver(function(entries, observer) {\n            this.setEditFrame();\n        }.bind(this));\n\n        ro.observe(this.textArea);\n\n        this.styleTextArea = new DomElementStyle(); // TODO: Move this to EditMode.\n        this.styleTextArea\n                .setAttribute('position', 'absolute')\n                .setAttribute('resize', 'none')\n                .setAttribute('box-sizing', 'border-box')\n                .setAttribute('-moz-box-sizing', 'border-box')\n                .setAttribute('-webkit-box-sizing', 'border-box')\n                .setAttribute('overflow', 'hidden')\n                .setAttribute('outline', 'none')\n                .setAttribute('border', 'none')\n                .setAttribute('z-index', '1')\n                .setAttribute('padding', '10px');\n\n        // Helper div to measure text width\n        this.measureDiv = _document.createElement('div');\n\n        // Become an event dispatcher\n        addTraitEventDispatcher(this);\n    }\n\n    av.GlobalManagerMixin.call(EditorTextInput.prototype);\n    var proto = EditorTextInput.prototype;\n\n    proto.destroy = function() {\n\n        this.setInactive();\n    };\n\n    /**\n     * Initializes itself given an Label Markup (textMarkup)\n     * @param {Object} textMarkup\n     * @param {Boolean} firstEdit - Whether the markup is being edited for the first time.\n     */\n    proto.setActive = function(textMarkup, firstEdit) {\n\n        if (this.textMarkup === textMarkup) {\n            return;\n        }\n\n        var placeholderText = Autodesk.Viewing.i18n.translate(this.defaultText);\n        this.textArea.setAttribute('placeholder', placeholderText);\n\n        this.setInactive();\n        this.parentDiv.appendChild(this.textArea);\n        this.textMarkup = textMarkup;\n        this.firstEdit = firstEdit || false;\n\n        this.constrainToCanvas = firstEdit;\n\n        this.initFromMarkup();\n\n        this.constrainToCanvas = false;\n\n        // On iOS this doesn't work quite well, the keyboard will dismiss after call focus programatically.\n        // http://stackoverflow.com/questions/32407185/wkwebview-cant-open-keyboard-for-input-field\n        if (!Autodesk.Viewing.isIOSDevice()) {\n          // Focus on next frame\n          var txtArea = this.textArea;\n          const _window = this.getWindow();\n          _window.requestAnimationFrame(function(){\n              txtArea.focus();\n          });\n        }\n\n        var dataBag = {\n            markup: this.textMarkup,\n            firstEdit: this.firstEdit,\n            isActive: true\n        };\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_ACTIVE, data: dataBag });\n    };\n\n    /**\n     * Closes the editor text input and goes back into normal markup edition mode.\n     */\n    proto.setInactive = function() {\n        var dataBag = {\n            markup: this.textMarkup,\n            isActive: false\n        };\n\n        // In iOS10, the keyboard always show on screen after tap screen out of text\n        // area or save markup to end text edit, call blur to make sure keyboard dismiss.\n        if (Autodesk.Viewing.isIOSDevice())\n        {\n            this.textArea.blur();\n        }\n\n        this.removeWindowEventListener('resize', this.onResizeBinded);\n\n        if (this.textMarkup) {\n            this.textMarkup = null;\n            this.parentDiv.removeChild(this.textArea);\n        }\n        this.style = null;\n\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_INACTIVE, data: dataBag });\n    };\n\n    proto.isActive = function() {\n\n        return !!this.textMarkup;\n    };\n\n    proto.setEditFrame = function() {\n        if (this.editor.editFrame.markup && this.textMarkup && this.editor.editFrame.markup === this.textMarkup) {\n            var frameWidth = parseFloat(this.textArea.style.width);\n            var frameHeight = parseFloat(this.textArea.style.height);\n\n            var position = this.textMarkup.getClientPosition();\n            var rotation = this.textMarkup.getRotation();\n\n            var xPos = position.x - (frameWidth / 2);\n            var yPos = position.y - (this.startingHeight / 2);\n\n            this.editor.editFrame.setSelection(xPos, yPos, frameWidth, frameHeight, rotation);\n        }\n    };\n\n    /**\n     * Applies Markup styles to TextArea used for editing.\n     * It also saves a copy of the style object.\n     * @private\n     */\n    proto.initFromMarkup = function(updateStyleFirst) {\n\n        var markup = this.textMarkup;\n        var position = markup.getClientPosition();\n        var size = markup.getClientSize();\n\n        // Text area padding is relative to the current font size\n        var padding = markup.getClientFontSize() / 2;\n\n        this.startingHeight = size.y;\n\n        var left = position.x - size.x * 0.5;\n        var top = position.y - size.y * 0.5;\n\n        var lineHeightPercentage = markup.lineHeight + \"%\";\n        this.styleTextArea.setAttribute('line-height', lineHeightPercentage);\n        this.styleTextArea.setAttribute('padding', padding + 'px');\n\n        this.setPosAndSize(left, top, size.x, size.y);\n        if (updateStyleFirst) {\n            this.setStyle(markup.getStyle());\n            this.textArea.value = markup.getText();\n        } else {\n            this.textArea.value = markup.getText();\n            this.setStyle(markup.getStyle());\n        }\n    };\n\n    proto.setPosAndSize = function(left, top, width, height) {\n        if (this.constrainToCanvas) {\n            // Check that it doesn't overflow out of the canvas\n            if (left + width >= this.editor.viewer.container.clientWidth) {\n                left = this.editor.viewer.container.clientWidth - (width + 10);\n            }\n            if (top + height >= this.editor.viewer.container.clientHeight) {\n                top = this.editor.viewer.container.clientHeight - (height + 10);\n            }\n\n            // Make sure text input left side always in the canvas area.\n            // Especially on iPhone6 & iPhone7\n            if (left < 5) {\n                left = 5;\n                width = this.editor.viewer.container.clientWidth - 10;\n            }\n        }\n\n        this.styleTextArea\n            // Size and position\n            .setAttribute('left', left + 'px')\n            .setAttribute('top', top + 'px')\n            .setAttribute('width', width + 'px')\n            .setAttribute('height', height + 'px');\n    };\n\n    proto.setStyle = function(style) {\n\n        if (this.style) {\n            // An already present style means that the user\n            // has changed the style using the UI buttons.\n            // We need to account for the user having changed the\n            // width/height of the TextArea. Since there is no event\n            // we can detect for it, we do it here.\n            var temp = {};\n            this.injectSizeValues(temp);\n            this.setPosAndSize(\n                temp.newPos.x - temp.width * 0.5,\n                temp.newPos.y - temp.height * 0.5,\n                temp.width, temp.height);\n        }\n        var fontHeight = this.editor.sizeFromMarkupsToClient(0, style['font-size']).y;\n        var strokeWidth = this.editor.sizeFromMarkupsToClient(0, style['stroke-width']).y;\n        var textAreaStyle = this.styleTextArea\n            // Visuals\n            .setAttribute('color', style['stroke-color'])\n            .setAttribute('outline', strokeWidth + 'px solid ' + style['stroke-color'])\n            .setAttribute('font-family', style['font-family'])\n            .setAttribute('font-size', fontHeight + 'px')\n            .setAttribute('font-weight', style['font-weight'])\n            .setAttribute('font-style', style['font-style'])\n            .getStyleString();\n        this.textArea.setAttribute('style', textAreaStyle);\n        this.style = cloneStyle(style);\n        autosize.update(this.textArea);\n    };\n\n    /**\n     * Helper function that, for a given markup with some text in it\n     * returns an Array of lines in it.\n     * @param {Object} markup\n     * @returns {{text, lines}|{text: String, lines: Array.<String>}}\n     */\n    proto.getTextValuesForMarkup = function(markup, sizeUpdateRequired) {\n        var active = this.isActive();\n        var activeMarkup = this.textMarkup;\n        var activeFirstEdit = this.firstEdit;\n\n        this.setActive(markup, false);\n        var textValues = this.getTextValues();\n\n        var dataBag = {\n            markup: markup,\n            textValues: textValues\n        };\n\n        if (active) {\n            this.setActive(activeMarkup, activeFirstEdit);\n        } else {\n            if (sizeUpdateRequired) {\n                this.injectSizeValues(dataBag);\n            }\n\n            this.setInactive();\n        }\n\n        return dataBag;\n    };\n\n    /**\n     * Returns the current text as one string and an array of lines\n     * of how the text is being rendered (1 string per line)\n     * @returns {{text: String, lines: Array.<String>}}\n     */\n    proto.getTextValues = function() {\n\n        var newText = this.textArea.value;\n        if (newText === this.defaultText) {\n            newText = '';\n        }\n        return {\n            text: newText,\n            lines: this.generateLines()\n        };\n    };\n\n    /**\n     * Function called by UI\n     */\n    proto.acceptAndExit = function() {\n\n        // If placeholder text, then remove.\n        var textValues = this.getTextValues();\n        var textMarkup = this.textMarkup;\n\n        var dataBag = {\n            markup: this.textMarkup,\n            style: this.style,\n            firstEdit: this.firstEdit,\n            newText: textValues.text,\n            newLines: textValues.lines\n        };\n        this.injectSizeValues(dataBag);\n\n        this.dispatchEvent({ type: this.EVENT_TEXT_CHANGE, data: dataBag });\n        this.setInactive();\n        textMarkup.updateStyle(true); // Hack: LMV-3628\n    };\n\n    /**\n     * Injects position, width and height of the textarea rect\n     * @param {Object} dataBag\n     * @private\n     */\n    proto.injectSizeValues = function(dataBag) {\n\n        // Explicit usage of parseFloat to remove the 'px' suffix.\n        var width = parseFloat(this.textArea.style.width);\n        var height = parseFloat(this.textArea.style.height);\n        var ox = parseFloat(this.textArea.style.left);\n        var oy = parseFloat(this.textArea.style.top);\n\n        dataBag.width = width;\n        dataBag.height = height;\n        dataBag.newPos = {\n            x: ox + (width * 0.5),\n            y: oy + (height * 0.5)\n        };\n    };\n\n    /**\n     * Handler for when the camera moves\n     * @param {Object} event - Camera moves event\n     * @private\n     */\n    proto.onCameraChanged = function(event) {\n        var str = this.textArea.value;\n        this.textMarkup.style = cloneStyle(this.style);\n        this.style = null; // TODO: Revisit this code because style changes are lost by doing this.\n        this.initFromMarkup(true);\n        this.textArea.value = str;\n        this.setEditFrame();\n    };\n\n    /**\n     * Grabs the text content of the textarea and returns\n     * an Array of lines.  Wrapped lines are returned as 2 lines.\n     */\n    proto.generateLines = function() {\n\n        // First, get lines separated by line breaks:\n        var textContent = this.textArea.value;\n        var linesBreaks = textContent.split(/\\r*\\n/);\n\n        var styleMeasureStr = this.styleTextArea.clone()\n            .removeAttribute(['top', 'left', 'width', 'height'])\n            .setAttribute('position','absolute')\n            .setAttribute('white-space','nowrap')\n            .setAttribute('float','left')\n            .setAttribute('visibility','hidden')\n            .getStyleString();\n        this.measureDiv.setAttribute('style', styleMeasureStr);\n        this.parentDiv.appendChild(this.measureDiv);\n\n        var maxLineLength = this.textArea.clientWidth - (2 * parseFloat(this.textArea.style.padding));\n\n        // Now check whether the lines are wrapped.\n        // If so, subdivide into other lines.\n        var linesOutput = [];\n\n        for (var i= 0, len = linesBreaks.length; i<len; ++i) {\n            var line = trimRight(linesBreaks[i]);\n\n            // Add a space in an empty line so it appears in the lines output\n            line = (line === '') ? ' ' : line;\n            this.splitLine(line, maxLineLength, linesOutput);\n        }\n\n        this.parentDiv.removeChild(this.measureDiv);\n        return linesOutput;\n    };\n\n    /**\n     * Given a String that represents one line of text that is\n     * longer than the max length a line is allowed, this method\n     * cuts text into several ones that are no longer than the max\n     * length.\n     *\n     * @param {String} text\n     * @param {Number} maxLength\n     * @param {Array} output\n     * @private\n     */\n    proto.splitLine = function(text, maxLength, output) {\n\n        // End condition\n        if (text === '') {\n            return;\n        }\n\n        var remaining = '';\n        var done = false;\n\n        while (!done){\n            this.measureDiv.innerText = text;\n            var lineLen = this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\n            if (lineLen <= maxLength) {\n                output.push(text);\n                this.splitLine(trimLeft(remaining), maxLength, output);\n                done = true;\n            } else {\n                // Need to try with a shorter word!\n                var parts = this.getShorterLine(text);\n                if (parts.length === 1) {\n                    // text is only one word that is way too long.\n                    this.splitWord(text, remaining, maxLength, output);\n                    done = true;\n                } else {\n                    text = parts[0];\n                    remaining = parts[1] + remaining;\n                }\n            }\n        }\n    };\n\n    /**\n     * Given a line of text such as \"hi there programmer\", it returns\n     * an array with 2 parts: [\"hi there\", \" programmer\"].\n     *\n     * It accounts for special cases with multi-spaces, such as for\n     * \"hi there  two-spaces\" returns [\"hi there\", \"  two-spaces\"]\n     *\n     * When there is only one word, it returns the whole word:\n     * \"JustOneWord\" returns [\"JustOneWord\"] (an array of 1 element)\n     *\n     * @param {String} line\n     * @returns {Array}\n     */\n    proto.getShorterLine = function(line) {\n\n        // TODO: Account for TABs\n        // Will probably never do unless a bug is reported.\n\n        var iLastSpace = line.lastIndexOf(' ');\n        if (iLastSpace === -1) {\n            return [line]; // This is a single word\n        }\n\n        // Else\n        // Iterate back removing additional spaces (multi spaces)\n        while (line.charAt(iLastSpace-1) === ' ') {\n            iLastSpace--;\n        }\n\n        var trailingWord = line.substr(iLastSpace); // Contains the spaces\n        var shorterLine = line.substr(0,iLastSpace);\n        return [shorterLine, trailingWord];\n    };\n\n    /**\n     * Given a single word, splits it into multiple lines that fits in maxWidth\n     * @param {String} word\n     * @param {String} remaining\n     * @param {Number} maxLength\n     * @param {Array} output\n     */\n    proto.splitWord = function(word, remaining, maxLength, output) {\n\n        var lenSoFar = 1;\n        var fits = true;\n        while (fits) {\n\n            var part = word.substr(0,lenSoFar);\n            this.measureDiv.innerText = part;\n            var lineLen =  this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\n\n            if (lineLen > maxLength) {\n\n                if (lenSoFar === 1) {\n                    // we can't split 1 character any longer.\n                    output.push(part);\n                    this.splitWord(word.substr(1), remaining, maxLength, output);\n                    return;\n                }\n\n                // It was fine until one less char //\n                var okayWord = word.substr(0,lenSoFar-1);\n                output.push(okayWord);\n                var extraWord = word.substr(lenSoFar-1);\n                this.splitLine(extraWord + remaining, maxLength, output);\n                return;\n            }\n\n            // Try one more character\n            lenSoFar++;\n\n            // Check if we are done with all characters\n            if (lenSoFar > word.length) {\n                // Okay it fits\n                output.push(word);\n                return;\n            }\n        }\n    };\n\n    function trimRight(text) {\n        if (text.length === 0) {\n            return \"\";\n        }\n        var lastNonSpace = text.length-1;\n        for (var i=lastNonSpace; i>=0; --i) {\n            if (text.charAt(i) !== ' ') {\n                lastNonSpace = i;\n                break;\n            }\n        }\n        return text.substr(0, lastNonSpace+1);\n    }\n\n    function trimLeft(text) {\n        if (text.length === 0) {\n            return \"\";\n        }\n        var firstNonSpace = 0;\n        for (var i=0; i<text.length; ++i) {\n            if (text.charAt(i) !== ' ') {\n                firstNonSpace = i;\n                break;\n            }\n        }\n        return text.substr(firstNonSpace);\n    }\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeleteCallout } from '../edit-actions/DeleteCallout';\nimport { CreateCallout } from '../edit-actions/CreateCallout';\nimport { SetCallout } from '../edit-actions/SetCallout';\nimport { SetStyle } from '../edit-actions/SetStyle';\nimport { SetSize } from '../edit-actions/SetSize';\nimport * as MarkupTypes from '../MarkupTypes';\nimport * as MarkupEvents from '../MarkupEvents';\nimport { EditorTextInput } from './EditorTextInput';\n\n\n    var STARTING_WIDTH_FACTOR = 6;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeCallout(editor) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-width',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CALLOUT, styleAttributes);\n\n        this.style['fill-opacity'] = 1.0;\n        this.style['fill-color'] = '#ffffff';\n\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 360);\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\n\n        this.textInputHelper = helper;\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\n        this.minSize = 0; // No need to size it initially\n        this.creationMethod = this.CREATION_METHOD_CLICK;\n    }\n\n    EditModeCallout.prototype = Object.create(EditMode.prototype);\n    EditModeCallout.prototype.constructor = EditModeCallout;\n\n    var proto = EditModeCallout.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type === this.type) {\n            var deleteCallout = new DeleteCallout(this.editor, markup);\n            deleteCallout.addToHistory = !cantUndo;\n            deleteCallout.execute();\n            return true;\n        }\n        return false;\n    };\n\n    proto.setStyle = function(style) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n\n            this.textInputHelper.setStyle(style);\n        } else {\n            EditMode.prototype.setStyle.call(this, style);\n        }\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n        }\n    };\n\n    proto.destroy = function() {\n\n        if (this.textInputHelper) {\n            if (this.textInputHelper.isActive()) {\n                this.textInputHelper.acceptAndExit();\n            }\n            this.textInputHelper.destroy();\n            this.textInputHelper = null;\n        }\n        EditMode.prototype.destroy.call(this);\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     */\n    proto.onMouseDown = function() {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n            return;\n        }\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n        var initialWidth = clientFontSize * STARTING_WIDTH_FACTOR; // Find better way to initialize size.\n        var initialHeight = clientFontSize * 1;\n\n        // Center position.\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\n        var position = editor.positionFromClientToMarkups(\n            mousePosition.x + (initialWidth * 0.5),\n            mousePosition.y + (initialHeight * 0.5));\n\n        this.creationBegin();\n        editor.beginActionGroup();\n\n        // Given the initial width and font size, we assume that the text fits in one line.\n        var createCallout = new CreateCallout(\n            editor,\n            editor.getId(),\n            position,\n            size,\n            '',\n            this.style,\n            true);\n\n        createCallout.execute();\n        this.creationEnd();\n\n        this.selectedMarkup = editor.getMarkup(createCallout.targetId);\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n    };\n\n    proto.onMouseUp = function(event) {\n\n    };\n\n    proto.onMouseDoubleClick = function(markup) {\n\n        if (markup === this.selectedMarkup) {\n            this.editor.selectMarkup(markup);\n            this.editor.editFrame.setMarkup(markup);\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\n        }\n    };\n\n    proto.onHelperSetActive = function(event) {\n        var databag = event.data;\n        var markup = databag.markup;\n        if (markup) {\n            markup.setIsHelperTextActive(databag.isActive);\n            markup.setIsShapeVisible(!databag.isActive);\n        }\n    };\n\n    proto.onHelperTextChange = function(event) {\n\n        var dataBag = event.data;\n        var textMarkup = dataBag.markup;\n        var textStyle = dataBag.style;\n        var curSelection = this.selectedMarkup;\n\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n\n        // Deal with edge case first: Creating a Label without text\n        if (dataBag.newText === '') {\n            this.editor.cancelActionGroup();\n\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\n            deleteCallout.execute();\n\n            if (textMarkup !== curSelection) {\n                this.editor.selectMarkup(curSelection);\n            }\n\n            return;\n        }\n\n        // When the text is created for the first time, an action group\n        // is already created and it includes the CreateCallout action.\n        // Thus, no need to begin another action group.\n        if (!dataBag.firstEdit) {\n            this.editor.beginActionGroup();\n        }\n\n        // Size change action //\n        var position = this.editor.positionFromClientToMarkups(\n            dataBag.newPos.x, dataBag.newPos.y\n        );\n        var size = this.editor.sizeFromClientToMarkups(\n            dataBag.width, dataBag.height\n        );\n        var setSize = new SetSize(\n            this.editor,\n            textMarkup,\n            position,\n            size.x,\n            size.y);\n        setSize.execute();\n\n        // Text change action //\n        var setCallout = new SetCallout(\n            this.editor,\n            textMarkup,\n            textMarkup.position,\n            textMarkup.size,\n            dataBag.newText,\n            textMarkup.isFrameUsed);\n        setCallout.execute();\n\n        var setStyle = new SetStyle(\n            this.editor,\n            textMarkup,\n            textStyle\n        );\n        setStyle.execute();\n\n        // However, we do need to close the action group at this point. For both cases.\n        this.editor.closeActionGroup();\n        this.editor.selectMarkup(curSelection);\n    };\n\n    /**\n     * We want to make sure that the Input Helper gets removed from the screen\n     * whenever the user attempts to perform an undo or redo action.\n     * @param {Event} event\n     * @private\n     */\n    proto.onHistoryChange = function(event) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n        }\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        EditMode.prototype.onSave.call(this);\n\n        // Close input helper if it's open.\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            var firstEdit = this.textInputHelper.firstEdit;\n\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n\n            // Close action group if open (first edit).\n            if (firstEdit) {\n                this.editor.cancelActionGroup();\n            }\n\n            this.editor.selectMarkup(null);\n            this.selectedMarkup = null;\n        }\n    };\n\n    proto.updateTextBoxStyle = function() {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.onCameraChanged();\n        }\n    };\n","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { createMarkupTextSvg, createMarkupPathSvg, createMarkupGroupSvg,\n    composeRGBAString, setAttributeToMarkupSvg, setMarkupTextSvgTransform,\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, updateMarkupPathSvgHitarea,\n    createSvgElement, addMarkupMetadata, radiansToDegrees, createRectanglePath,\n    EDIT_FRAME_DEFAULT_MARGIN } from './MarkupsCoreUtils';\nimport { cloneStyle, copyStyle, isStyleEqual } from './StyleUtils';\nimport { EditModeCallout } from './edit-modes/EditModeCallout';\n\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\n    var FONT_SIZE_SCALE = 100;\n\n    var STARTING_WIDTH_FACTOR = 6;\n\n    /**\n     * Callout Markup.\n     * @constructor\n     */\n    export function MarkupCallout(id, editor, size) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-width',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n        this.createSvgElement = createSvgElement.bind(this);\n\n\n        this.type = MarkupTypes.MARKUP_TYPE_CALLOUT;\n        this.textShape = createMarkupTextSvg();\n        this.rectShape = createMarkupPathSvg();\n        this.shape = createMarkupGroupSvg([this.rectShape, this.textShape]);\n        this.isFrameUsed = true;\n        this.constraintRotation = true;\n        this.constraintHeight = true;\n        this.constraintWidth = false;\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.currentText = \"\";\n        this.currentTextLines = [\"\"];\n        this.prevHighlight = false;\n        this.isHelperTextActive = false;\n\n        // Note: We could have this property be a style property.\n        // However, there is no need for this property to be exposed to the user for alteration\n        // This value is a percentage of the font size used to offset vertically 2 text lines\n        // of the same paragraph.\n        // Notice that this value is used by EditorTextInput.js\n        this.lineHeight = 130;\n\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\n\n        this.bindDomEvents();\n    }\n\n    MarkupCallout.prototype = Object.create(Markup.prototype);\n    MarkupCallout.prototype.constructor = MarkupCallout;\n\n    var proto = MarkupCallout.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeCallout(this.editor);\n    };\n\n    /**\n     *\n     * @param {Object} position\n     * @param {Object} size\n     * @param {String} textString\n     */\n    proto.set = function(position, size, textString, isFrameUsed) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.setIsFilledFrameUsed(isFrameUsed);\n        this.setText(textString);\n    };\n\n    proto.setSize = function(position, width, height) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n        this.size.y = height;\n\n        var sizeUpdateRequired = true;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle(sizeUpdateRequired);\n        }\n    };\n\n    proto.setPosition = function(x, y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle();\n        }\n    };\n\n    proto.setStyle = function(style) {\n        var stylesEqual = isStyleEqual(style, this.style);\n\n        if (!stylesEqual) {\n            copyStyle(style, this.style);\n        }\n\n        this.updateStyle(!stylesEqual);\n    };\n\n    proto.setText = function(text) {\n\n        this.currentText = text;\n    };\n\n    /**\n     * Returns the raw string value\n     * @returns {String}\n     */\n    proto.getText = function() {\n\n        return this.currentText;\n    };\n\n    /**\n     * Returns a shallow copy of the text lines used for rendering SVG text\n     * @returns {Array.<String>}\n     */\n    proto.getTextLines = function() {\n\n        return this.currentTextLines.concat();\n    };\n\n    proto.highlightChanged = function() {\n\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\n            var rect = this.rectShape;\n            var text = this.textShape;\n            var strokeColor = this.highlightColor;\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\n\n            if (this.isFrameUsed) {\n                setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\n            }\n\n            this.prevHighlight = true;\n            return false;\n        }\n\n        return true;\n    };\n\n    proto.updateTextBoxStyle = function() {\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n        }\n\n        editMode.updateTextBoxStyle();\n    };\n\n    proto.setIsHelperTextActive = function(isActive) {\n        this.isHelperTextActive = isActive;\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function(sizeUpdateRequired) {\n\n        if (this.highlightChanged()) {\n            this.prevHighlight = false;\n            var style = this.style;\n            var rect = this.rectShape;\n            var text = this.textShape;\n            var fontSize = this.style['font-size'];\n            var fontFamily = this.style['font-family'];\n            var fontWeight = this.style['font-weight'];\n            var fontStyle =  this.style['font-style'];\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            var strokeWidth = this.style['stroke-width'];\n\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\n\n            this.rebuildTextSvg(sizeUpdateRequired);\n\n            var editor = this.editor;\n            var textContainerTransform = this.getTextContainerTransform();\n            var textTransform = this.getTextTransform();\n\n            setAttributeToMarkupSvg(text, 'font-family', fontFamily);\n            setAttributeToMarkupSvg(text, 'font-size', fontSize * FONT_SIZE_SCALE);\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\n            setAttributeToMarkupSvg(text, 'font-weight', fontWeight);\n            setAttributeToMarkupSvg(text, 'font-style', fontStyle);\n\n            setMarkupTextSvgTransform(text, textContainerTransform, textTransform);\n            updateMarkupTextSvgClipper(text, this.size.x, this.size.y);\n            updateMarkupTextSvgHitarea(text, this.size.x, this.size.y, editor);\n\n            var path = this.getPath().join(' ');\n            var transform = this.getTransform();\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n\n            setAttributeToMarkupSvg(rect, 'd', path);\n            setAttributeToMarkupSvg(rect, 'stroke-width', strokeWidth);\n            setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\n            setAttributeToMarkupSvg(rect, 'transform', transform);\n            setAttributeToMarkupSvg(rect, 'fill', fillColor);\n            updateMarkupPathSvgHitarea(rect, editor);\n        }\n    };\n\n    /**\n     * Re-creates SVG tags that render SVG text.\n     * Each line is placed around tspan tags which are vertically offset to each other.\n     */\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\n\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\n        // editMode needs to be set to load markups in view mode\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n            editMode.textInputHelper.textArea.value = this.currentText;\n            editMode.textInputHelper.setStyle(this.style);\n        }\n\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\n            return;\n        }\n\n        var style = cloneStyle(editMode.textInputHelper.style);\n        var text = editMode.textInputHelper.textArea.value;\n\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\n\n        this.currentTextLines = textHelperValues.textValues.lines;\n\n        if (textHelperValues.newPos) {\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\n\n            this.position.x = position.x;\n            this.position.y = position.y;\n            this.size.x = size.x;\n            this.size.y = size.y;\n        }\n\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\n            editMode.textInputHelper.textArea.value = text;\n            editMode.textInputHelper.setStyle(style);\n        }\n\n        var markup = this.createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n        markup.setAttribute('alignment-baseline', 'middle');\n\n        this.textShape.childNodes[0].removeChild(this.textShape.markup);\n        this.textShape.childNodes[0].appendChild(markup);\n        this.textShape.markup = markup;\n\n        // For each line, create a tspan, add as child and offset it vertically.\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\n\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\n        var dx = padding;\n        var dy = padding;\n\n        this.currentTextLines.forEach(function(line){\n\n            var tspan = this.createSvgElement('tspan');\n\n            tspan.setAttribute('x', dx);\n            tspan.setAttribute('y', dy);\n            tspan.textContent = line;\n\n            markup.appendChild(tspan);\n            dy += yOffset;\n        }.bind(this));\n    };\n\n    proto.setIsFilledFrameUsed = function(isFrameUsed) {\n\n        this.isFrameUsed = isFrameUsed;\n\n        var hasRectShape = this.rectShape.parentNode === this.shape;\n        if (isFrameUsed && !hasRectShape) {\n            this.shape.insertBefore(this.rectShape, this.shape.firstChild);\n        } else if (!isFrameUsed && hasRectShape) {\n            this.shape.removeChild(this.rectShape);\n        }\n    };\n\n    proto.setIsFilledFrameVisible = function(isVisible) {\n\n        this.rectShape.markup.style.display = (isVisible && this.isFrameUsed) ? 'block' : 'none';\n    };\n\n    proto.setIsShapeVisible = function(isVisible) {\n\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\n    };\n\n    proto.setMetadata = function() {\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.text = String(this.currentText);\n        metadata.isframeused = this.isFrameUsed ? 1 : 0;\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    /**\n     * Helper method that returns the font size in client space coords.\n     * @returns {Number}\n     */\n    proto.getClientFontSize = function() {\n\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n    };\n\n    proto.getLineHeight = function() {\n        return this.style['font-size'];\n    };\n\n    proto.getTextContainerTransform = function() {\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(1,-1)'\n        ].join(' ');\n    };\n\n    proto.getTextTransform = function() {\n\n        var lineHeight = this.getLineHeight();\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\n        ].join(' ');\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.textShape = createMarkupTextSvg();\n        clone.rectShape = createMarkupPathSvg();\n        clone.shape = createMarkupGroupSvg([clone.rectShape, clone.textShape]);\n        clone.bindDomEvents();\n    };\n\n    proto.getPath = function() {\n        var strokeWidth = this.style['stroke-width'];\n\n        var w = this.size.x + strokeWidth;\n        var h = this.size.y + strokeWidth;\n        var x = -w * 0.5;\n        var y = -h * 0.5;\n\n        var path = [];\n        createRectanglePath(x, y, w, h, false, path);\n\n        return path;\n    };\n\n    proto.getBoundingRect = function() {\n\n        var pos = this.getClientPosition();\n        var size = this.getClientSize();\n        var strokeWidth = this.style['stroke-width'];\n        var width = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\n        var margin = width + EDIT_FRAME_DEFAULT_MARGIN;\n\n        return {\n            x: pos.x - size.x / 2,\n            y: pos.y - size.y / 2,\n            width: size.x,\n            height: size.y,\n            margin: margin\n        };\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupCallout } from '../MarkupCallout';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param text\n     * @param style\n     * @constructor\n     */\n    export function CreateCallout(editor, id, position, size, text, style, isFrameUsed) {\n\n        EditAction.call(this, editor, 'CREATE-CALLOUT', id);\n\n        this.text = text;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.style = cloneStyle(style);\n        this.isFrameUsed = isFrameUsed;\n    }\n\n    CreateCallout.prototype = Object.create(EditAction.prototype);\n    CreateCallout.prototype.constructor = CreateCallout;\n\n    var proto = CreateCallout.prototype;\n\n    proto.redo = function () {\n\n        var editor = this.editor;\n        var position = this.position;\n        var size = this.size;\n\n        var callout = new MarkupCallout(this.targetId, editor, size);\n\n        editor.addMarkup(callout);\n\n        callout.setIsFilledFrameUsed(this.isFrameUsed);\n        callout.setText(this.text);\n        callout.setSize(position, size.x, size.y);\n        callout.setStyle(this.style);\n    };\n\n    proto.undo = function () {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        if (markup) {\n            this.editor.removeMarkup(markup);\n            markup.destroy();\n        }\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateCallout } from './CreateCallout';\n\n    /**\n     *\n     * @param editor\n     * @param text\n     * @constructor\n     */\n    export function DeleteCallout(editor, callout) {\n\n        EditAction.call(this, editor, 'DELETE-CALLOUT', callout.id);\n\n        var position = {x: callout.position.x, y: callout.position.y};\n        var size = {x: callout.size.x, y: callout.size.y};\n\n        this.createCallout = new CreateCallout(\n            editor,\n            callout.id,\n            position,\n            size,\n            callout.getText(),\n            callout.getStyle(),\n            callout.isFrameUsed);\n    }\n\n    DeleteCallout.prototype = Object.create(EditAction.prototype);\n    DeleteCallout.prototype.constructor = DeleteCallout;\n\n    var proto = DeleteCallout.prototype;\n\n    proto.redo = function() {\n\n        this.createCallout.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createCallout.redo();\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param position\n     * @param size\n     * @param text\n     * @constructor\n     */\n    export function SetText(editor, markup, position, size, text) {\n\n        EditAction.call(this, editor, 'SET-TEXT', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\n        this.newText = text;\n        this.oldText = markup.getText();\n    }\n\n    SetText.prototype = Object.create(EditAction.prototype);\n    SetText.prototype.constructor = SetText;\n\n    var proto = SetText.prototype;\n\n    proto.redo = function() {\n\n        var text = this.editor.getMarkup(this.targetId);\n        text && text.set(this.newPosition, this.newSize, this.newText);\n    };\n\n    proto.undo = function() {\n\n        var text = this.editor.getMarkup(this.targetId);\n        text && text.set(this.oldPosition, this.oldSize, this.oldText);\n    };\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeleteText } from '../edit-actions/DeleteText';\nimport { DeleteCallout } from '../edit-actions/DeleteCallout';\nimport { CreateText } from '../edit-actions/CreateText';\nimport { SetText } from '../edit-actions/SetText';\nimport { SetSize } from '../edit-actions/SetSize';\nimport { SetStyle } from '../edit-actions/SetStyle';\nimport * as MarkupTypes from '../MarkupTypes';\nimport * as MarkupEvents from '../MarkupEvents';\nimport { EditorTextInput } from './EditorTextInput';\n\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeText(editor) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_TEXT, styleAttributes);\n\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 260);\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\n\n        this.textInputHelper = helper;\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\n        this.minSize = 0; // No need to size it initially\n        this.creationMethod = this.CREATION_METHOD_CLICK;\n    }\n\n    EditModeText.prototype = Object.create(EditMode.prototype);\n    EditModeText.prototype.constructor = EditModeText;\n\n    var proto = EditModeText.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteText = new DeleteText(this.editor, markup);\n            deleteText.addToHistory = !cantUndo;\n            deleteText.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @param style\n     */\n    proto.setStyle = function(style) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n\n            this.textInputHelper.setStyle(style);\n        } else {\n            EditMode.prototype.setStyle.call(this, style);\n        }\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n        }\n    };\n\n    proto.destroy = function() {\n\n        if (this.textInputHelper) {\n            if (this.textInputHelper.isActive()) {\n                this.textInputHelper.acceptAndExit();\n            }\n            this.textInputHelper.destroy();\n            this.textInputHelper = null;\n        }\n        EditMode.prototype.destroy.call(this);\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     */\n    proto.onMouseDown = function() {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n            return;\n        }\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n        var initialWidth = clientFontSize * 15; // Find better way to initialize size.\n        var initialHeight = clientFontSize * 1;\n\n        // Center position.\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\n        var position = editor.positionFromClientToMarkups(\n            mousePosition.x + (initialWidth * 0.5),\n            mousePosition.y + (initialHeight * 0.5));\n\n        this.creationBegin();\n        editor.beginActionGroup();\n\n        // Given the initial width and font size, we assume that the text fits in one line.\n        var createText = new CreateText(\n            editor,\n            editor.getId(),\n            position,\n            size,\n            '',\n            this.style);\n\n        createText.execute();\n        this.creationEnd();\n\n        this.selectedMarkup = editor.getMarkup(createText.targetId);\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n    };\n\n    proto.updateTextBoxStyle = function() {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.onCameraChanged();\n        }\n    };\n\n    proto.onMouseUp = function(event) {\n\n    };\n\n    proto.onMouseDoubleClick = function(markup) {\n\n        if (markup === this.selectedMarkup) {\n            this.editor.selectMarkup(markup);\n            this.editor.editFrame.setMarkup(markup);\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\n        }\n    };\n\n    proto.onHelperSetActive = function(event) {\n        var databag = event.data;\n        var markup = databag.markup;\n        if (markup) {\n            markup.setIsHelperTextActive(databag.isActive);\n            markup.setIsShapeVisible(!databag.isActive);\n        }\n    };\n\n    proto.onHelperTextChange = function(event) {\n\n        var dataBag = event.data;\n        var textMarkup = dataBag.markup;\n        var textStyle = dataBag.style;\n        var curSelection = this.selectedMarkup;\n\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n\n        // Deal with edge case first: Creating a Label without text\n        if (dataBag.newText === '') {\n            this.editor.cancelActionGroup();\n\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\n            deleteCallout.execute();\n\n            if (textMarkup !== curSelection) {\n                this.editor.selectMarkup(curSelection);\n            }\n\n            return;\n        }\n\n        // When the text is created for the first time, an action group\n        // is already created and it includes the CreateText action.\n        // Thus, no need to begin another action group.\n        if (!dataBag.firstEdit) {\n            this.editor.beginActionGroup();\n        }\n\n        // Size change action //\n        var position = this.editor.positionFromClientToMarkups(\n            dataBag.newPos.x, dataBag.newPos.y\n        );\n        var size = this.editor.sizeFromClientToMarkups(\n            dataBag.width, dataBag.height\n        );\n        var setSize = new SetSize(\n            this.editor,\n            textMarkup,\n            position,\n            size.x,\n            size.y);\n        setSize.execute();\n\n        // Text change action //\n        var setText = new SetText(\n            this.editor,\n            textMarkup,\n            textMarkup.position,\n            textMarkup.size,\n            dataBag.newText);\n        setText.execute();\n\n        var setStyle = new SetStyle(\n            this.editor,\n            textMarkup,\n            textStyle\n        );\n        setStyle.execute();\n\n        // However, we do need to close the action group at this point. For both cases.\n        this.editor.closeActionGroup();\n        this.editor.selectMarkup(curSelection);\n    };\n\n    /**\n     * We want to make sure that the Input Helper gets removed from the screen\n     * whenever the user attempts to perform an undo or redo action.\n     * @param {Event} event\n     * @private\n     */\n    proto.onHistoryChange = function(event) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n        }\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        EditMode.prototype.onSave.call(this);\n\n        // Close input helper if it's open.\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            var firstEdit = this.textInputHelper.firstEdit;\n\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n\n            // Close action group if open (first edit).s\n            if (firstEdit) {\n                this.editor.cancelActionGroup();\n            }\n\n            this.editor.selectMarkup(null);\n            this.selectedMarkup = null;\n        }\n    };\n\n    proto.updateTextBoxStyle = function() {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.onCameraChanged();\n        }\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { composeRGBAString, setAttributeToMarkupSvg, addMarkupMetadata, radiansToDegrees,\n    createMarkupTextSvg, setMarkupTextSvgTransform, updateMarkupTextSvgBackground,\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, createSvgElement } from './MarkupsCoreUtils';\nimport { cloneStyle, isStyleEqual, copyStyle } from './StyleUtils';\nimport { EditModeText } from './edit-modes/EditModeText';\n\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\n    var FONT_SIZE_SCALE = 100;\n\n    var STARTING_WIDTH_FACTOR = 6;\n\n    /**\n     * Text Markup.\n     * @constructor\n     */\n    export function MarkupText(id, editor, size) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n\n        Markup.call(this, id, editor, styleAttributes);\n\n        // Bind to this to pass globalManager\n        this.createSvgElement = createSvgElement.bind(this);\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_TEXT;\n        this.shape = createMarkupTextSvg();\n        this.constraintRotation = true;\n        this.constraintHeight = true;\n        this.constraintWidth = false;\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.currentText = \"\";\n        this.currentTextLines = [\"\"];\n        this.textDirty = true;\n        this.textSize = {x: 0, y: 0};\n        this.prevHighlight = false;\n        this.isHelperTextActive = false;\n\n        // Note: We could have this property be a style property.\n        // However, there is no need for this property to be exposed to the user for alteration\n        // This value is a percentage of the font size used to offset vertically 2 text lines\n        // of the same paragraph.\n        // Notice that this value is used by EditorTextInput.js\n        this.lineHeight = 130;\n\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\n\n        this.bindDomEvents();\n    }\n\n    MarkupText.prototype = Object.create(Markup.prototype);\n    MarkupText.prototype.constructor = MarkupText;\n\n    var proto = MarkupText.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeText(this.editor);\n    };\n\n    /**\n     *\n     * @param {String} position\n     * @param {String} size\n     * @param {String} textString\n     */\n    proto.set = function(position, size, textString) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = size.x;\n        this.size.y = size.y;\n\n        this.setText(textString);\n    };\n\n    proto.setSize = function(position, width, height) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n        this.size.y = height;\n\n        var sizeUpdateRequired = true;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle(sizeUpdateRequired);\n        }\n    };\n\n    proto.setPosition = function(x, y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle();\n        }\n    };\n\n    proto.setStyle = function(style) {\n\n        var stylesEqual = isStyleEqual(style, this.style);\n\n        if (!stylesEqual) {\n            copyStyle(style, this.style);\n        }\n\n        this.updateStyle(!stylesEqual);\n    };\n\n    /**\n     *\n     * @param {String} text\n     */\n    proto.setText = function(text) {\n\n        this.currentText = text;\n    };\n\n    /**\n     * Returns the raw string value\n     * @returns {String}\n     */\n    proto.getText = function() {\n\n        return this.currentText;\n    };\n\n    /**\n     * Returns a shallow copy of the text lines used for rendering SVG text\n     * @returns {Array.<String>}\n     */\n    proto.getTextLines = function() {\n\n        return this.currentTextLines.concat();\n    };\n\n    proto.highlightChanged = function() {\n\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\n            var shape = this.shape;\n            var strokeColor = this.highlightColor;\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n\n            this.prevHighlight = true;\n            return false;\n        }\n\n        return true;\n    };\n\n    proto.updateTextBoxStyle = function() {\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n        }\n\n        editMode.updateTextBoxStyle();\n    };\n\n    proto.setIsHelperTextActive = function(isActive) {\n        this.isHelperTextActive = isActive;\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function(sizeUpdateRequired) {\n\n        if (this.highlightChanged()) {\n            this.prevHighlight = false;\n            var style = this.style;\n            var shape = this.shape;\n            var fontSize = this.style['font-size'];\n            var fontFamily = this.style['font-family'];\n            var fontWeight = this.style['font-weight'];\n            var fontStyle = this.style['font-style'];\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\n\n            this.rebuildTextSvg(sizeUpdateRequired);\n\n            setAttributeToMarkupSvg(shape, 'font-family', fontFamily);\n            setAttributeToMarkupSvg(shape, 'font-size', fontSize * FONT_SIZE_SCALE);\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n            setAttributeToMarkupSvg(shape, 'font-weight', fontWeight);\n            setAttributeToMarkupSvg(shape, 'font-style', fontStyle);\n\n            var editor = this.editor;\n            var transform = this.getTransform();\n            var textTransform = this.getTextTransform();\n\n            setMarkupTextSvgTransform(shape, transform, textTransform);\n            updateMarkupTextSvgBackground(shape, this.size.x, this.size.y, fillColor);\n            updateMarkupTextSvgClipper(shape, this.size.x, this.size.y);\n            updateMarkupTextSvgHitarea(shape, this.size.x, this.size.y, editor);\n        }\n    };\n\n    /**\n     * Re-creates SVG tags that render SVG text.\n     * Each line is placed around tspan tags which are vertically offset to each other.\n     */\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\n\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\n        // editMode needs to be set to load markups in view mode\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n            editMode.textInputHelper.textArea.value = this.currentText;\n            editMode.textInputHelper.setStyle(this.style);\n        }\n\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\n            return;\n        }\n\n        var style = cloneStyle(editMode.textInputHelper.style);\n        var text = editMode.textInputHelper.textArea.value;\n\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\n\n        this.currentTextLines = textHelperValues.textValues.lines;\n\n        if (textHelperValues.newPos) {\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\n\n            this.position.x = position.x;\n            this.position.y = position.y;\n            this.size.x = size.x;\n            this.size.y = size.y;\n        }\n\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\n            editMode.textInputHelper.textArea.value = text;\n            editMode.textInputHelper.setStyle(style);\n        }\n\n        var markup = this.createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n        markup.setAttribute('alignment-baseline', 'middle');\n\n        this.shape.childNodes[0].removeChild(this.shape.markup);\n        this.shape.childNodes[0].appendChild(markup);\n        this.shape.markup = markup;\n\n        // For each line, create a tspan, add as child and offset it vertically.\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\n\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\n        var dx = padding;\n        var dy = padding;\n\n        this.currentTextLines.forEach(function(line){\n\n            var tspan = this.createSvgElement('tspan');\n\n            tspan.setAttribute('x', dx);\n            tspan.setAttribute('y', dy);\n            tspan.textContent = line;\n\n            markup.appendChild(tspan);\n            dy += yOffset;\n        }.bind(this));\n    };\n\n    proto.setIsShapeVisible = function(isVisible) {\n\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.text = String(this.currentText);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    /**\n     * Helper method that returns the font size in client space coords.\n     * @returns {Number}\n     */\n    proto.getClientFontSize = function() {\n\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n    };\n\n    proto.getLineHeight = function() {\n\n        return this.style['font-size'];\n    };\n\n    proto.getTransform = function() {\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(1,-1)'\n        ].join(' ');\n    };\n\n    proto.getTextTransform = function() {\n\n        var lineHeight = this.getLineHeight();\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\n        ].join(' ');\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.shape = createMarkupTextSvg();\n        clone.bindDomEvents();\n    };\n\n    proto.getBoundingRect = function() {\n        var pos = this.getClientPosition();\n        var size = this.getClientSize();\n        return {\n            x: pos.x - size.x / 2,\n            y: pos.y - size.y / 2,\n            width: size.x,\n            height: size.y\n        };\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupText } from '../MarkupText';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param text\n     * @param style\n     * @constructor\n     */\n    export function CreateText(editor, id, position, size, text, style ) {\n\n        EditAction.call(this, editor, 'CREATE-TEXT', id);\n\n        this.text = text;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.style = cloneStyle(style);\n    }\n\n    CreateText.prototype = Object.create(EditAction.prototype);\n    CreateText.prototype.constructor = CreateText;\n\n    var proto = CreateText.prototype;\n\n    proto.redo = function () {\n\n        var editor = this.editor;\n        var position = this.position;\n        var size = this.size;\n\n        var text = new MarkupText(this.targetId, editor, size);\n\n        editor.addMarkup(text);\n\n        text.set(position, size, this.text);\n        text.setStyle(this.style);\n    };\n\n    proto.undo = function () {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        if (markup) {\n            this.editor.removeMarkup(markup);\n            markup.destroy();\n        }\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateCircle } from './CreateCircle';\n\n    /**\n     * Markup delete circle action.\n     *\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\n     * for deleting a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific EditAction that deals with Markup deletion.\n     * Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\n     *\n     * @param editor\n     * @param circle\n     */\n    export function DeleteCircle(editor, circle) {\n\n        EditAction.call(this, editor, 'DELETE-CIRCLE', circle.id);\n        this.createCircle = new CreateCircle(\n            editor,\n            circle.id,\n            circle.position,\n            circle.size,\n            circle.rotation,\n            circle.getStyle());\n    }\n\n    DeleteCircle.prototype = Object.create(EditAction.prototype);\n    DeleteCircle.prototype.constructor = DeleteCircle;\n\n    var proto = DeleteCircle.prototype;\n\n    proto.redo = function() {\n\n        this.createCircle.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createCircle.redo();\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     * Markup set circle action.\n     *\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\n     * for editing properties of a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific EditAction that deals with Markup edition.\n     * Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\n     *\n     * @param editor\n     * @param circle\n     * @param position\n     * @param size\n     */\n    export function SetCircle(editor, circle, position, size) {\n\n        EditAction.call(this, editor, 'SET-CIRCLE', circle.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: circle.position.x, y: circle.position.y};\n        this.oldSize = {x: circle.size.x, y: circle.size.y};\n    }\n\n    SetCircle.prototype = Object.create(EditAction.prototype);\n    SetCircle.prototype.constructor = SetCircle;\n\n    var proto = SetCircle.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newPosition, this.newSize);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, position, size) {\n\n        var circle = this.editor.getMarkup(targetId);\n        if(!circle) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(circle.position.x - position.x) > epsilon || Math.abs(circle.size.y - size.y) > epsilon ||\n            Math.abs(circle.position.y - position.y) > epsilon || Math.abs(circle.size.y - size.y) > epsilon) {\n\n            circle.set(position, size);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return (\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newSize.x === this.oldSize.x &&\n            this.newSize.y === this.oldSize.y);\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeleteCircle } from '../edit-actions/DeleteCircle';\nimport { CreateCircle } from '../edit-actions/CreateCircle';\nimport { SetCircle } from '../edit-actions/SetCircle';\nimport * as MarkupTypes from '../MarkupTypes';\n\n    /**\n     * Markup circle edit mode.\n     *\n     * Implements a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode|EditMode}.\n     * Included in documentation as an example of how to create\n     * an EditMode for a specific markup type. Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditMode\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     */\n    export function EditModeCircle(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CIRCLE, styleAttributes);\n    }\n\n    EditModeCircle.prototype = Object.create(EditMode.prototype);\n    EditModeCircle.prototype.constructor = EditModeCircle;\n\n    var proto = EditModeCircle.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteCircle = new DeleteCircle(this.editor, markup);\n            deleteCircle.addToHistory = !cantUndo;\n            deleteCircle.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        var final = this.getFinalMouseDraggingPosition();\n        final = editor.clientToMarkups(final.x, final.y);\n\n        var sizeX = Math.abs(this.firstPosition.x - final.x);\n        var sizeY = Math.abs(this.firstPosition.y - final.y);\n\n        var position = {x: (this.firstPosition.x + final.x) * 0.5, y: (this.firstPosition.y + final.y) * 0.5};\n        var size = this.size = {x: sizeX, y: sizeY};\n\n        var setCircle = new SetCircle(\n            editor,\n            selectedMarkup,\n            position,\n            size);\n\n        setCircle.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        // Calculate center and size.\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Create circle.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreateCircle(\n            editor,\n            markupId,\n            position,\n            size,\n            0,\n            this.style);\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n        updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils';\nimport { cloneStyle } from './StyleUtils';\nimport { EditModeCircle } from './edit-modes/EditModeCircle';\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupCircle(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_CIRCLE;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupCircle.prototype = Object.create(Markup.prototype);\n    MarkupCircle.prototype.constructor = MarkupCircle;\n\n    var proto = MarkupCircle.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeCircle(this.editor);\n    };\n\n    proto.set = function(position, size) {\n\n        this.setSize(position, size.x, size.y);\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var size = this.size;\n        if (size.x === 1 || size.y === 1) {\n            return [''];\n        }\n\n        var strokeWidth = this.style['stroke-width'];\n\n        var ellipseW = size.x - strokeWidth;\n        var ellipseH = size.y - strokeWidth;\n\n        var ellipseX = -0.5*ellipseW;\n        var ellipseY = 0;\n\n        var path = [];\n        createEllipsePath(ellipseX, ellipseY, ellipseW, ellipseH, false, path);\n\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupCircle } from '../MarkupCircle';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     * Markup create circle action.\n     *\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\n     * for creating a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific EditAction that deals with Markup creation.\n     * Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param style\n     */\n    export function CreateCircle(editor, id, position, size, rotation, style) {\n\n        EditAction.call(this, editor, 'CREATE-CIRCLE', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n    }\n\n    CreateCircle.prototype = Object.create(EditAction.prototype);\n    CreateCircle.prototype.constructor = CreateCircle;\n\n    var proto = CreateCircle.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var circle = new MarkupCircle(this.targetId, editor);\n\n        editor.addMarkup(circle);\n\n        circle.setSize(this.position, this.size.x, this.size.y);\n        circle.setRotation(this.rotation);\n        circle.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateCloud } from './CreateCloud';\n\n    /**\n     *\n     * @param editor\n     * @param cloud\n     * @constructor\n     */\n    export function DeleteCloud(editor, cloud) {\n\n        EditAction.call(this, editor, 'DELETE-CLOUD', cloud.id);\n        this.createCloud = new CreateCloud(\n            editor,\n            cloud.id,\n            cloud.position,\n            cloud.size,\n            cloud.rotation,\n            cloud.getStyle());\n    }\n\n    DeleteCloud.prototype = Object.create(EditAction.prototype);\n    DeleteCloud.prototype.constructor = DeleteCloud;\n\n    var proto = DeleteCloud.prototype;\n\n    proto.redo = function() {\n\n        this.createCloud.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createCloud.redo();\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param cloud\n     * @param position\n     * @param size\n     * @constructor\n     */\n    export function SetCloud(editor, cloud, position, size) {\n\n        EditAction.call(this, editor, 'SET-CLOUD', cloud.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: cloud.position.x, y: cloud.position.y};\n        this.oldSize = {x: cloud.size.x, y: cloud.size.y};\n    }\n\n    SetCloud.prototype = Object.create(EditAction.prototype);\n    SetCloud.prototype.constructor = SetCloud;\n\n    var proto = SetCloud.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newPosition, this.newSize, this.newStrokeWidth, this.newColor);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldPosition, this.oldSize, this.oldStrokeWidth, this.oldColor);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, position, size) {\n\n        var cloud = this.editor.getMarkup(targetId);\n        if(!cloud) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(cloud.position.x - position.x) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon ||\n            Math.abs(cloud.position.y - position.y) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon) {\n\n            cloud.set(position, size);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return (\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newSize.x === this.oldSize.x &&\n            this.newSize.y === this.oldSize.y);\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeleteCloud } from '../edit-actions/DeleteCloud';\nimport { CreateCloud } from '../edit-actions/CreateCloud';\nimport { SetCloud } from '../edit-actions/SetCloud';\nimport * as MarkupTypes from '../MarkupTypes';\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeCloud(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CLOUD, styleAttributes);\n    }\n\n    EditModeCloud.prototype = Object.create(EditMode.prototype);\n    EditModeCloud.prototype.constructor = EditModeCloud;\n\n    var proto = EditModeCloud.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteCloud = new DeleteCloud(this.editor, markup);\n            deleteCloud.addToHistory = !cantUndo;\n            deleteCloud.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        var pos = this.getFinalMouseDraggingPosition();\n        var final = editor.clientToMarkups(pos.x, pos.y);\n        var position = { x: (this.firstPosition.x + final.x) / 2, y: (this.firstPosition.y + final.y) / 2 };\n        var size = this.size = { x: Math.abs(final.x - this.firstPosition.x), y: Math.abs(final.y - this.firstPosition.y) };\n        var setCloud = new SetCloud(\n            editor,\n            selectedMarkup,\n            position,\n            size);\n\n        setCloud.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        // Calculate center and size.\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Create Cloud.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreateCloud(\n            editor,\n            markupId,\n            position,\n            size,\n            0,\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n    updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils';\nimport { cloneStyle } from './StyleUtils';\nimport { EditModeCloud } from './edit-modes/EditModeCloud';\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupCloud(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-linejoin', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_CLOUD;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupCloud.prototype = Object.create(Markup.prototype);\n    MarkupCloud.prototype.constructor = MarkupCloud;\n\n    var proto = MarkupCloud.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeCloud(this.editor);\n    };\n\n    /**\n     * Sets position and size in markup space coordinates.\n     * @param {Object} position\n     * @param {Object} size\n     */\n    proto.set = function(position, size) {\n\n        this.setSize(position, size.x, size.y);\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    /**\n     * Helper function that creates intermediate points given the\n     * current position and size.\n     * @returns {Array}\n     */\n    proto.getPath = function() {\n\n        var position = this.position;\n        var size = this.size;\n        var strokeWidth = this.style['stroke-width'];\n        var radius = strokeWidth * 2;\n\n        function createArcTo(x, y, xRadius, yRadius, path) {\n\n            path.push('a');\n            path.push(xRadius);\n            path.push(yRadius);\n            path.push(0);\n            path.push(1);\n            path.push(1);\n            path.push(x);\n            path.push(y);\n\n            return path;\n        }\n\n        function createCorner(corner, xRadius, yRadius, strokeWidth, path) {\n\n            switch(corner) {\n\n                case 'LT':\n                    return createArcTo( xRadius,-yRadius, xRadius, yRadius, path);\n\n                case 'RT':\n                    return createArcTo( xRadius, yRadius, xRadius, yRadius, path);\n\n                case 'RB':\n                    return createArcTo(-xRadius, yRadius, xRadius, yRadius, path);\n\n                case 'LB':\n                    return createArcTo(-xRadius,-yRadius, xRadius, yRadius, path);\n            }\n        }\n\n        function getSideParameters(x1, x2, radius, strokeWidth) {\n\n            var diameter = radius * 2;\n            var length = Math.abs(x2 - x1 - strokeWidth);\n            var count = Math.round(length / diameter);\n\n            diameter += (length - diameter * count) / count;\n            radius = diameter * 0.5;\n\n            var xValueInset = diameter * 0.05;\n            var yValueOffset = radius * 3.5 / 3.0;\n\n            return {\n                count: count,\n                radius: radius,\n                diameter: diameter,\n                p1: {x: xValueInset, y: -yValueOffset },\n                p2: {x: diameter - xValueInset, y: -yValueOffset},\n                p3: {x: diameter, y: 0}\n            };\n        }\n\n        function createTSide(hSidesParameters, path){\n\n            var sp = hSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n\n                path.push('c');\n                path.push(sp.p1.x);\n                path.push(sp.p1.y);\n                path.push(sp.p2.x);\n                path.push(sp.p2.y);\n                path.push(sp.p3.x);\n                path.push(sp.p3.y);\n            }\n\n            return path;\n        }\n\n        function createRSide(vSidesParameters, path){\n\n            var sp = vSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n                path.push('c');\n                path.push(-sp.p1.y);\n                path.push(sp.p1.x);\n                path.push(-sp.p2.y);\n                path.push(sp.p2.x);\n                path.push(-sp.p3.y);\n                path.push(sp.p3.x);\n            }\n\n            return path;\n        }\n\n        function createBSide(hSidesParameters, path){\n\n            var sp = hSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n                path.push('c');\n                path.push(-sp.p1.x);\n                path.push(-sp.p1.y);\n                path.push(-sp.p2.x);\n                path.push(-sp.p2.y);\n                path.push(-sp.p3.x);\n                path.push(-sp.p3.y);\n            }\n\n            return path;\n        }\n\n        function createLSide(vSidesParameters, path){\n\n            var sp = vSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n                path.push('c');\n                path.push(sp.p1.y);\n                path.push(-sp.p1.x);\n                path.push(sp.p2.y);\n                path.push(-sp.p2.x);\n                path.push(sp.p3.y);\n                path.push(-sp.p3.x);\n            }\n\n            return path;\n        }\n\n        var l = position.x;\n        var t = position.y;\n        var r = position.x + size.x;\n        var b = position.y + size.y;\n\n        var minSize = radius * 5;\n        var path = [];\n\n        if (size.x < minSize || size.y < minSize) {\n\n            var w = size.x - strokeWidth;\n            var h = size.y - strokeWidth;\n            var x = -w * 0.5;\n            var y = 0;\n\n            createEllipsePath(x, y, w, h, false, path);\n        } else {\n\n            var hSidesParameters = getSideParameters(l, r, radius, strokeWidth);\n            var vSidesParameters = getSideParameters(t, b, radius, strokeWidth);\n\n            var cornerSizeX = hSidesParameters.diameter;\n            var cornerSizeY = vSidesParameters.diameter;\n            var cornerRadiusX = hSidesParameters.radius;\n            var cornerRadiusY = vSidesParameters.radius;\n\n            hSidesParameters = getSideParameters(l + cornerSizeX, r - cornerSizeX, radius, strokeWidth);\n            vSidesParameters = getSideParameters(t + cornerSizeY, b - cornerSizeY, radius, strokeWidth);\n\n            var halfStrokeWidth = strokeWidth * 0.5;\n            let x =-size.x * 0.5 + halfStrokeWidth + cornerRadiusX;\n            let y =-size.y * 0.5 + halfStrokeWidth + cornerRadiusY * 2;\n\n            path.push('M');\n            path.push(x);\n            path.push(y);\n\n            createCorner('LT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createTSide(hSidesParameters, path);\n            createCorner('RT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createRSide(vSidesParameters, path);\n            createCorner('RB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createBSide(hSidesParameters, path);\n            createCorner('LB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createLSide(vSidesParameters, path);\n        }\n\n        path.push('z');\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupCloud } from '../MarkupCloud';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param style\n     * @constructor\n     */\n    export function CreateCloud(editor, id, position, size, rotation, style) {\n\n        EditAction.call(this, editor, 'CREATE-CLOUD', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n    }\n\n    CreateCloud.prototype = Object.create(EditAction.prototype);\n    CreateCloud.prototype.constructor = CreateCloud;\n\n    var proto = CreateCloud.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var cloud = new MarkupCloud(this.targetId, editor);\n\n        editor.addMarkup(cloud);\n\n        cloud.set(this.position, this.size);\n        cloud.setRotation(this.rotation);\n        cloud.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n","'use strict';\n\nimport { Markup } from './Markup';\nimport { createMarkupPathSvg, setAttributeToMarkupSvg, updateMarkupPathSvgHitarea,\n    composeRGBAString, addMarkupMetadata } from './MarkupsCoreUtils';\nimport { cloneStyle } from './StyleUtils';\n\n    /**\n     * Base class for Pen Markup rendering (currently freehand and highlighter)\n     *\n     * Derived classes must implement getEditMode()\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupPen(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupPen.prototype = Object.create(Markup.prototype);\n    MarkupPen.prototype.constructor = MarkupPen;\n\n    var proto = MarkupPen.prototype;\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     *\n     * @param position\n     * @param size\n     * @param locations\n     */\n    proto.set = function(position, size, locations, isAbsoluteCoords) {\n\n        this.rotation = 0; // Reset angle //\n        this.isAbsoluteCoords = isAbsoluteCoords;\n        if (this.isAbsoluteCoords) {\n            this.updatePath(locations);\n        } else {\n            this.locations = locations.slice(0);\n\n            this.size.x = (size.x === 0) ? 1 : size.x;\n            this.size.y = (size.y === 0) ? 1 : size.y;\n\n            this.setSize(position, size.x, size.y);\n            this.updateStyle();\n        }\n    };\n\n    proto.setPosition = function(x,y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        var shape = this.shape;\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = 'none';\n\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke-linejoin', 'round');\n        setAttributeToMarkupSvg(shape, 'stroke-linecap', 'round');\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n\n        this.updatePath(path);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.updatePath = function(path) {\n        var shape = this.shape;\n        var transform = this.isAbsoluteCoords ? 'scale(1)' : this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        setAttributeToMarkupSvg(shape, 'd', path);\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        width = (width === 0 ? 1 : width);\n        height = (height === 0 ? 1 : height);\n\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        var scaleX = width / this.size.x;\n        var scaleY = height / this.size.y;\n\n        for(var i = 0; i < locationsCount; ++i) {\n\n            var point = locations[i];\n\n            point.x *= scaleX;\n            point.y *= scaleY;\n        }\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n        metadata.locations = this.locations.map(function(point){\n            return [point.x, point.y].join(\" \");\n        }).join(\" \");\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var path = [];\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        if (locationsCount > 1) {\n\n            path.push('M');\n            path.push(+(locations[0].x).toFixed(6));\n            path.push(+(locations[0].y).toFixed(6));\n\n            for (var i = 1; i < locationsCount; ++i) {\n\n                var locationA = locations[i - 1];\n                var locationB = locations[i];\n\n                path.push('l');\n                path.push(+(locationB.x - locationA.x).toFixed(6));\n                path.push(+(locationB.y - locationA.y).toFixed(6));\n            }\n        }\n\n        return path;\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { simplify } from '../MarkupsCoreUtils';\n\n    /**\n     * Base class for editing Pen tools (currently freehand and highlighter)\n     *\n     * Any class extending EditModePen should contain at least the following methods:\n     * - createPen()\n     * - deletePen()\n     * - setPen()\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModePen(editor, type, styleAttributes) {\n        EditMode.call(this, editor, type, styleAttributes);\n\n        this.smoothen = true;\n        this.bufferSize = 8;\n    }\n\n    EditModePen.prototype = Object.create(EditMode.prototype);\n\n    var proto = EditModePen.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type === this.type) {\n            var deleteMarkup = this.deletePen(markup);\n            deleteMarkup.addToHistory = !cantUndo;\n            deleteMarkup.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var movements = this.movements;\n\n        var location = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n        if (this.smoothen) {\n            this.appendToBuffer(location);\n            this.amendPath();\n        } else {\n            var dx = this.lastX - mousePosition.x;\n            var dy = this.lastY - mousePosition.y;\n            var moveTol = 25; // 5^2, compare to square to avoid using square root of distance\n\n            if (movements.length > 1 && (dx*dx + dy*dy) < moveTol) {\n                movements[movements.length - 1] = location;\n                this.removeFromAbsolutePath(1);\n            } else {\n                movements.push(location);\n                this.lastX = mousePosition.x;\n                this.lastY = mousePosition.y;\n            }\n\n            this.addToAbsolutePath([location]);\n        }\n\n        var setPen = this.setPen(this.position, this.size, this.absolutePath, true);\n        setPen.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n\n        editor.snapper && editor.snapper.clearSnapped();\n        var mousePosition = editor.getMousePosition();\n\n        this.lastX = this.initialX = mousePosition.x;\n        this.lastY = this.initialY = mousePosition.y;\n\n        //set the starting point\n        var position = this.position = editor.clientToMarkups(this.initialX, this.initialY);\n        this.movements = [position];\n        if (this.smoothen) {\n            this.buffer = []; // Reset buffer\n            this.movementsLastIndex = null;\n            this.appendToBuffer(position);\n        }\n\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Create pen.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = this.createPen(markupId, position, size, 0, [{x: 0, y: 0 }]);\n\n        create.execute();\n\n        this.createAbsolutePath(position);\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n    proto.onMouseUp = function() {\n\n        if (!this.creating) {\n            EditMode.prototype.onMouseUp.call(this);\n            return;\n        }\n\n        var movements = this.movements;\n        var cameraWidth = this.viewer.impl.camera.right - this.viewer.impl.camera.left;\n        var cameraHeight = this.viewer.impl.camera.top - this.viewer.impl.camera.bottom;\n        var cameraDiagSq = cameraWidth*cameraWidth + cameraHeight*cameraHeight;\n\n        movements = simplify(movements, cameraDiagSq * 0.00000001, true);\n\n        var xs = movements.map(function(item) { return item.x; });\n        var ys = movements.map(function(item) { return item.y; });\n\n        var l = Math.min.apply(null, xs);\n        var t = Math.min.apply(null, ys);\n        var r = Math.max.apply(null, xs);\n        var b = Math.max.apply(null, ys);\n\n        var width = r - l;  // Already in markup coords space\n        var height = b - t; // Already in markup coords space\n\n        var position = {\n            x: l + width * 0.5,\n            y: t + height * 0.5\n        };\n        var size = this.size = {x: width, y: height};\n\n        // Adjust points to relate from the shape's center\n        var locations = movements.map(function(point){\n            return {\n                x: point.x - position.x,\n                y: point.y - position.y\n            };\n        });\n\n        var setPen = this.setPen(position, size, locations, false);\n        setPen.execute();\n\n        EditMode.prototype.onMouseUp.call(this);\n    };\n\n    proto.createPen = function() {\n        console.error('createPen not implemented');\n    };\n\n    proto.deletePen = function() {\n        console.error('deletePen not implemented');\n    };\n\n    proto.setPen = function() {\n        console.error('setPen not implemented');\n    };\n\n    proto.useWithSnapping = function () {\n        return false;\n    };\n\n    proto.createAbsolutePath = function(point) {\n\n        this.absolutePath = 'M' + +(point.x).toFixed(6) + ' ' + +(point.y).toFixed(6);\n        this.absolutePathIndexes = [0];\n    };\n\n    proto.removeFromAbsolutePath = function(numToRemove) {\n\n        numToRemove = Math.min(numToRemove, this.absolutePathIndexes.length);\n        if (numToRemove > 0) {\n            this.absolutePath = this.absolutePath.slice(0, this.absolutePathIndexes[this.absolutePathIndexes.length - numToRemove]);\n            this.absolutePathIndexes.splice(this.absolutePathIndexes.length - numToRemove);\n        }\n    };\n\n    proto.addToAbsolutePath = function(points) {\n\n       for (var i = 0; i < points.length; i++) {\n            this.absolutePathIndexes.push(this.absolutePath.length);\n            this.absolutePath += ' L' + +(points[i].x).toFixed(6) + ' ' + +(points[i].y).toFixed(6);\n        }\n    };\n\n    proto.appendToBuffer = function(point) {\n\n        this.buffer.push(point);\n        while (this.buffer.length > this.bufferSize) {\n            this.buffer.shift();\n        }\n    };\n\n    proto.amendPath = function() {\n\n        var point = this.getAveragePoint(0);\n        if (point) {\n            if (this.movementsLastIndex) {\n                this.removeFromAbsolutePath(this.movements.length - this.movementsLastIndex);\n                this.movements.splice(this.movementsLastIndex);\n            }\n\n            // Add the smoothed part of the path that will not change\n            var tmpBuffer = [point];\n            this.movementsLastIndex = this.movements.length + 1;\n\n            // Get the last part of the path (close to the current mouse position)\n            // This part will change if the mouse moves again\n            for (var offset = 2; offset < this.buffer.length; offset += 2) {\n                var pt = this.getAveragePoint(offset);\n                tmpBuffer.push(pt);\n            }\n\n            this.addToAbsolutePath(tmpBuffer);\n\n            // Set the complete current path coordinates\n            this.movements.push.apply(this.movements, tmpBuffer);\n\n        }\n    };\n\n    // Calculate the average point, starting at offset in the buffer\n    proto.getAveragePoint = function(offset) {\n\n        var len = this.buffer.length;\n        if (len % 2 === 1 || len >= this.bufferSize) {\n            var totalX = 0;\n            var totalY = 0;\n            var pt;\n            var count = 0;\n            for (var i = offset; i < len; i++) {\n                count++;\n                pt = this.buffer[i];\n                totalX += pt.x;\n                totalY += pt.y;\n            }\n            return {\n                x: totalX / count,\n                y: totalY / count\n            };\n        }\n        return null;\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateFreehand } from './CreateFreehand';\n\n    /**\n     *\n     * @param editor\n     * @param freehand\n     * @constructor\n     */\n    export function DeleteFreehand(editor, freehand) {\n        EditAction.call(this, editor, 'DELETE-FREEHAND', freehand.id);\n        this.createFreehand = new CreateFreehand(\n            editor,\n            freehand.id,\n            freehand.position,\n            freehand.size,\n            freehand.rotation,\n            freehand.locations,\n            freehand.getStyle());\n    }\n\n    DeleteFreehand.prototype = Object.create(EditAction.prototype);\n    DeleteFreehand.prototype.constructor = DeleteFreehand;\n\n    var proto = DeleteFreehand.prototype;\n\n    proto.redo = function() {\n\n        this.createFreehand.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createFreehand.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param freehand\n     * @param position\n     * @param size\n     * @param locations\n     * @constructor\n     */\n    export function SetFreehand(editor, freehand, position, size, locations, isAbsoluteCoords) {\n\n        EditAction.call(this, editor, 'SET-FREEHAND', freehand.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\n        this.isAbsoluteCoords = isAbsoluteCoords;\n\n        // No need to save old data\n    }\n\n    SetFreehand.prototype = Object.create(EditAction.prototype);\n    SetFreehand.prototype.constructor = SetFreehand;\n\n    var proto = SetFreehand.prototype;\n\n    proto.redo = function() {\n\n        var freehand = this.editor.getMarkup(this.targetId);\n        if (!freehand) {\n            return;\n        }\n\n        freehand.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\n            this.position = action.position;\n            this.size = action.size;\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n","'use strict';\n\nimport { EditModePen } from './EditModePen';\nimport { DeleteFreehand } from '../edit-actions/DeleteFreehand';\nimport { CreateFreehand } from '../edit-actions/CreateFreehand';\nimport { SetFreehand } from '../edit-actions/SetFreehand';\nimport * as MarkupTypes from '../MarkupTypes';\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeFreehand(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_FREEHAND, styleAttributes);\n    }\n\n    EditModeFreehand.prototype = Object.create(EditModePen.prototype);\n    EditModeFreehand.prototype.constructor = EditModeFreehand;\n\n    var proto = EditModeFreehand.prototype;\n\n    proto.createPen = function(markupId, position, size, rotation, locations) {\n        return new CreateFreehand(this.editor,\n            markupId,\n            position,\n            size,\n            rotation,\n            locations,\n            this.style);\n    };\n\n    proto.deletePen = function(markup) {\n        return new DeleteFreehand(this.editor, markup);\n    };\n\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\n        return new SetFreehand(this.editor,\n            this.selectedMarkup,\n            position,\n            size,\n            locations,\n            isAbsoluteCoords);\n    };\n\n","'use strict';\n\nimport { MarkupPen } from './MarkupPen';\nimport * as MarkupTypes from './MarkupTypes';\nimport { EditModeFreehand } from './edit-modes/EditModeFreehand';\n\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupFreehand(id, editor) {\n\n        MarkupPen.call(this, id, editor);\n        this.type = MarkupTypes.MARKUP_TYPE_FREEHAND;\n    }\n\n    MarkupFreehand.prototype = Object.create(MarkupPen.prototype);\n    MarkupFreehand.prototype.constructor = MarkupFreehand;\n\n    var proto = MarkupFreehand.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeFreehand(this.editor);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupFreehand } from '../MarkupFreehand';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param style\n     * @constructor\n     */\n    export function CreateFreehand(editor, id, position, size, rotation, locations, style) {\n\n        EditAction.call(this, editor, 'CREATE-FREEHAND', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.slice(0);\n        this.style = cloneStyle(style);\n    }\n\n    CreateFreehand.prototype = Object.create(EditAction.prototype);\n    CreateFreehand.prototype.constructor = CreateFreehand;\n\n    var proto = CreateFreehand.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var freehand = new MarkupFreehand(this.targetId, editor);\n\n        editor.addMarkup(freehand);\n\n        freehand.set(this.position, this.size, this.movements, false);\n        freehand.setRotation(this.rotation);\n        freehand.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreatePolyline } from './CreatePolyline';\n\n    /**\n     *\n     * @param editor\n     * @param polyline\n     * @constructor\n     */\n    export function DeletePolyline(editor, polyline) {\n\n        EditAction.call(this, editor, 'DELETE-POLYLINE', polyline.id);\n        this.createPolyline = new CreatePolyline(\n            editor,\n            polyline.id,\n            polyline.position,\n            polyline.size,\n            polyline.rotation,\n            polyline.locations,\n            polyline.getStyle(),\n            polyline.closed);\n    }\n\n    DeletePolyline.prototype = Object.create(EditAction.prototype);\n    DeletePolyline.prototype.constructor = DeletePolyline;\n\n    var proto =  DeletePolyline.prototype;\n\n    proto.redo = function() {\n\n        this.createPolyline.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createPolyline.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param polyline\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     * @constructor\n     */\n    export function SetPolyline(editor, polyline, position, size, locations, closed) {\n\n        EditAction.call(this, editor, 'SET-POLYLINE', polyline.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = locations.concat();\n        this.closed = closed;\n\n        // No need to save old data\n    }\n\n    SetPolyline.prototype = Object.create(EditAction.prototype);\n    SetPolyline.prototype.constructor = SetPolyline;\n\n    var proto = SetPolyline.prototype;\n\n    proto.redo = function() {\n\n        var polyline = this.editor.getMarkup(this.targetId);\n        if(!polyline) {\n            return;\n        }\n\n        polyline.set(this.position, this.size, this.locations, this.closed);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.locations.concat();\n            this.position = action.position;\n            this.size = action.size;\n            this.closed = action.closed;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeletePolyline } from '../edit-actions/DeletePolyline';\nimport { CreatePolyline } from '../edit-actions/CreatePolyline';\nimport { SetPolyline } from '../edit-actions/SetPolyline';\nimport * as MarkupTypes from '../MarkupTypes';\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils';\n\n    var SNAP_RANGE = 25;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModePolyline(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYLINE, styleAttributes);\n\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\n        this.movements = [];\n    }\n\n    EditModePolyline.prototype = Object.create(EditMode.prototype);\n    EditModePolyline.prototype.constructor = EditModePolyline;\n\n    var proto = EditModePolyline.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var movements = this.movements;\n            if (this.creating && movements.length >= 2) {\n                movements.pop();\n                movements.pop();\n                var lastIndex = movements.length - 1;\n                if (lastIndex >= 0) {\n                    // duplicate last location\n                    var lastMove = movements[lastIndex];\n                    movements.push(lastMove);\n                    var locations = setPositionAndSize(movements, this);\n                    var setPolyline = new SetPolyline(\n                        this.editor,\n                        markup,\n                        this.position,\n                        this.size,\n                        locations);\n\n                    setPolyline.execute();\n                }\n            }\n            else {\n                var deletePolyline = new DeletePolyline(this.editor, markup);\n                deletePolyline.addToHistory = !cantUndo;\n                deletePolyline.execute();\n                this.creationEnd();\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        this.dragging = true;\n\n        var movements = this.movements;\n        movements.splice(movements.length-1, 1);\n\n        var mousePosition = editor.getMousePosition();\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        // Close polyline if user clicks close to initial point.\n        if (movements.length >= 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n        }\n\n        movements.push(mousePosition);\n\n        var locations = setPositionAndSize(movements, this);\n        var setPolyline = new SetPolyline(\n            editor,\n            selectedMarkup,\n            this.position,\n            this.size,\n            locations);\n\n        setPolyline.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function(event) {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        // User selected an already created markup.\n        if (this.selectedMarkup && !this.creating) {\n            return;\n        }\n\n        if (this.creating) {\n            return;\n        }\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n        this.movements = [mousePosition, mousePosition];\n\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreatePolyline(\n            editor,\n            markupId,\n            mousePosition,\n            size,\n            0,\n            [{x:0, y:0}],\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseUp = function() {\n\n        EditMode.prototype.onMouseUp.call(this);\n\n        if(!this.creating) {\n            return;\n        }\n\n        this.dragging = false;\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var movements = this.movements;\n        var closed = false;\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        if (movements.length > 1 &&\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\n            return;\n        }\n\n        // Close polyline if user clicks close to initial point.\n        if (movements.length > 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n            closed = true;\n        }\n\n        movements.splice(movements.length-1, 1);\n\n        if (!closed) {\n            movements.push(mousePosition);\n            movements.push(mousePosition);\n        }\n\n        var polyline = this.selectedMarkup;\n        var locations = setPositionAndSize(movements, polyline);\n        var setPolyline = new SetPolyline(\n            editor,\n            polyline,\n            polyline.position,\n            polyline.size,\n            locations,\n            closed);\n\n        setPolyline.execute();\n\n        if (closed) {\n            this.creationEnd();\n        }\n    };\n\n    proto.destroy = function() {\n        this.onMouseDoubleClick();\n        EditMode.prototype.creationEnd.call(this);\n        EditMode.prototype.destroy.call(this);\n    };\n\n    proto.creationEnd = function() {\n\n        // To pass isMinSizeValid,\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\n        if (this.selectedMarkup) {\n            this.size.x = this.selectedMarkup.size.x;\n            this.size.y = this.selectedMarkup.size.y;\n        }\n\n        EditMode.prototype.creationEnd.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n    proto.creationCancel = function() {\n\n        EditMode.prototype.creationCancel.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if(!this.creating) {\n           return;\n        }\n\n        var movements = this.movements;\n        movements.splice(Math.max(0, movements.length-1));\n\n        if (movements.length < 2 ) {\n\n            this.creationCancel();\n        } else {\n\n            var polyline = this.selectedMarkup;\n            var locations = setPositionAndSize(movements, polyline);\n            var setPolyline = new SetPolyline(\n                this.editor,\n                polyline,\n                polyline.position,\n                polyline.size,\n                locations,\n                this.closed);\n\n            setPolyline.execute();\n            this.creationEnd();\n        }\n    };\n\n    function setPositionAndSize(locations, markup) {\n\n        // determine the position of the top-left and bottom-right points\n        var minFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.min.apply(null, targets);\n        };\n\n        var maxFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.max.apply(null, targets);\n        };\n\n        var l = minFn(locations, 'x');\n        var t = minFn(locations, 'y');\n        var r = maxFn(locations, 'x');\n        var b = maxFn(locations, 'y');\n        var w = r - l;\n        var h = b - t;\n\n        markup.size = {x: w, y: h};\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\n\n        // Adjust points to relate from the shape's center\n        var position = markup.position;\n        return locations.map(function(point){\n            return {\n                x: point.x - position.x,\n                y: point.y - position.y\n            };\n        });\n    }\n\n","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { createMarkupPathSvg, composeRGBAString,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils';\nimport { cloneStyle } from './StyleUtils';\nimport { EditModePolyline } from './edit-modes/EditModePolyline';\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupPolyline(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_POLYLINE;\n        this.shape = createMarkupPathSvg('path');\n\n        this.bindDomEvents();\n    }\n\n    MarkupPolyline.prototype = Object.create(Markup.prototype);\n    MarkupPolyline.prototype.constructor = MarkupPolyline;\n\n    var proto = MarkupPolyline.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModePolyline(this.editor);\n    };\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     *\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     */\n    proto.set = function(position, size, locations, closed) {\n\n        this.rotation = 0; // Reset angle //\n        this.locations = locations.concat();\n\n        this.size.x = (size.x === 0) ? 1 : size.x;\n        this.size.y = (size.y === 0) ? 1 : size.y;\n\n        this.closed = closed;\n\n        this.setSize(position, size.x, size.y);\n        this.updateStyle();\n    };\n\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd',  this.getPath().join(' '));\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        width = (width === 0 ? 1 : width);\n        height = (height === 0 ? 1 : height);\n\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        var scaleX = width / this.size.x;\n        var scaleY = height / this.size.y;\n\n        for(var i = 0; i < locationsCount; ++i) {\n\n            var point = locations[i];\n\n            point.x *= scaleX;\n            point.y *= scaleY;\n        }\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n        metadata.locations = this.locations.map(function(point){\n            return [point.x, point.y].join(\" \");\n        }).join(\" \");\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var path = [];\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        if (locationsCount === 0) {\n            return ' ';\n        }\n\n        path.push('M');\n        path.push(locations[0].x);\n        path.push(locations[0].y);\n\n        for (var i = 1; i < locationsCount; ++i) {\n\n            var locationA = locations[i - 1];\n            var locationB = locations[i];\n\n            path.push('l');\n            path.push(locationB.x - locationA.x);\n            path.push(locationB.y - locationA.y);\n        }\n\n        this.closed && path.push('z');\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupPolyline } from '../MarkupPolyLine';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param closed\n     * @param style\n     * @constructor\n     */\n    export function CreatePolyline(editor, id, position, size, rotation, locations, style, closed) {\n\n        EditAction.call(this, editor, 'CREATE-POLYLINE', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.concat();\n        this.closed = closed;\n        this.style = cloneStyle(style);\n    }\n\n    CreatePolyline.prototype = Object.create(EditAction.prototype);\n    CreatePolyline.prototype.constructor = CreatePolyline;\n\n    var proto = CreatePolyline.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var polyline = new MarkupPolyline(this.targetId, editor);\n\n        editor.addMarkup(polyline);\n\n        polyline.set(this.position, this.size, this.movements, this.closed);\n        polyline.setRotation(this.rotation);\n        polyline.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreatePolycloud } from './CreatePolycloud';\n\n    /**\n     *\n     * @param editor\n     * @param polycloud\n     * @constructor\n     */\n    export function DeletePolycloud(editor, polycloud) {\n\n        EditAction.call(this, editor, 'DELETE-POLYCLOUD', polycloud.id);\n        this.createPolycloud = new CreatePolycloud(\n            editor,\n            polycloud.id,\n            polycloud.position,\n            polycloud.size,\n            polycloud.rotation,\n            polycloud.locations,\n            polycloud.getStyle(),\n            polycloud.closed);\n    }\n\n    DeletePolycloud.prototype = Object.create(EditAction.prototype);\n    DeletePolycloud.prototype.constructor = DeletePolycloud;\n\n    var proto =  DeletePolycloud.prototype;\n\n    proto.redo = function() {\n\n        this.createPolycloud.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createPolycloud.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param polycloud\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     * @constructor\n     */\n    export function SetPolycloud(editor, polycloud, position, size, locations, closed) {\n\n        EditAction.call(this, editor, 'SET-POLYCLOUD', polycloud.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = locations.concat();\n        this.closed = closed;\n\n        // No need to save old data\n    }\n\n    SetPolycloud.prototype = Object.create(EditAction.prototype);\n    SetPolycloud.prototype.constructor = SetPolycloud;\n\n    var proto = SetPolycloud.prototype;\n\n    proto.redo = function() {\n\n        var polycloud = this.editor.getMarkup(this.targetId);\n        if(!polycloud) {\n            return;\n        }\n\n        polycloud.set(this.position, this.size, this.locations, this.closed);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.locations.concat();\n            this.position = action.position;\n            this.size = action.size;\n            this.closed = action.closed;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeletePolycloud } from '../edit-actions/DeletePolycloud';\nimport { CreatePolycloud } from '../edit-actions/CreatePolycloud';\nimport { SetPolycloud } from '../edit-actions/SetPolycloud';\nimport * as MarkupTypes from '../MarkupTypes';\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils';\n\n    var SNAP_RANGE = 25;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModePolycloud(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYCLOUD, styleAttributes);\n\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\n        this.movements = [];\n    }\n\n    EditModePolycloud.prototype = Object.create(EditMode.prototype);\n    EditModePolycloud.prototype.constructor = EditModePolycloud;\n\n    var proto = EditModePolycloud.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var movements = this.movements;\n            if (this.creating && movements.length >= 2) {\n                movements.pop();\n                movements.pop();\n                var lastIndex = movements.length - 1;\n                if (lastIndex >= 0) {\n                    // duplicate last location\n                    var lastMove = movements[lastIndex];\n                    movements.push(lastMove);\n                    var locations = setPositionAndSize(movements, this);\n                    var setPolycloud = new SetPolycloud(\n                        this.editor,\n                        markup,\n                        this.position,\n                        this.size,\n                        locations);\n\n                    setPolycloud.execute();\n                }\n            }\n            else {\n                var deletePolycloud = new DeletePolycloud(this.editor, markup);\n                deletePolycloud.addToHistory = !cantUndo;\n                deletePolycloud.execute();\n                this.creationEnd();\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        this.dragging = true;\n\n        var movements = this.movements;\n        movements.splice(movements.length-1, 1);\n\n        var mousePosition = editor.getMousePosition();\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        // Close polycloud if user clicks close to initial point.\n        if (movements.length >= 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n        }\n\n        movements.push(mousePosition);\n\n        var locations = setPositionAndSize(movements, this);\n        var setPolycloud = new SetPolycloud(\n            editor,\n            selectedMarkup,\n            this.position,\n            this.size,\n            locations);\n\n        setPolycloud.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        // User selected an already created markup.\n        if (this.selectedMarkup && !this.creating) {\n            return;\n        }\n\n        if (this.creating) {\n            return;\n        }\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n        this.movements = [mousePosition, mousePosition];\n\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreatePolycloud(\n            editor,\n            markupId,\n            mousePosition,\n            size,\n            0,\n            [{x: 0, y: 0 }],\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseUp = function(event) {\n\n        EditMode.prototype.onMouseUp.call(this);\n\n        if(!this.creating) {\n            return;\n        }\n\n        this.dragging = false;\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var movements = this.movements;\n        var closed = false;\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        if (movements.length > 1 &&\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\n            return;\n        }\n\n        // Close polycloud if user clicks close to initial point.\n        if (movements.length > 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n            closed = true;\n        }\n\n        movements.splice(movements.length-1, 1);\n\n        if (!closed) {\n            movements.push(mousePosition);\n            movements.push(mousePosition);\n        }\n\n        var polycloud = this.selectedMarkup;\n        var locations = setPositionAndSize(movements, polycloud);\n        var setPolycloud = new SetPolycloud(\n            editor,\n            polycloud,\n            polycloud.position,\n            polycloud.size,\n            locations,\n            closed);\n\n        setPolycloud.execute();\n\n        if (closed) {\n            this.creationEnd();\n        }\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if(!this.creating) {\n            return;\n        }\n\n        var movements = this.movements;\n        movements.splice(Math.max(0, movements.length-1));\n\n        if (movements.length < 2 ) {\n\n            this.creationCancel();\n        } else {\n\n            var polycloud = this.selectedMarkup;\n            var locations = setPositionAndSize(movements, polycloud);\n            var setPolycloud = new SetPolycloud(\n                this.editor,\n                polycloud,\n                polycloud.position,\n                polycloud.size,\n                locations,\n                true);\n\n            setPolycloud.execute();\n            this.creationEnd();\n        }\n    };\n\n    proto.destroy = function() {\n        this.onMouseDoubleClick();\n        EditMode.prototype.creationEnd.call(this);\n        EditMode.prototype.destroy.call(this);\n    };\n\n    proto.creationEnd = function() {\n\n        // To pass isMinSizeValid,\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\n        if (this.selectedMarkup) {\n            this.size.x = this.selectedMarkup.size.x;\n            this.size.y = this.selectedMarkup.size.y;\n        }\n\n        EditMode.prototype.creationEnd.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n    proto.creationCancel = function() {\n\n        EditMode.prototype.creationCancel.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n    function setPositionAndSize(locations, markup) {\n\n        // determine the position of the top-left and bottom-right points\n        var minFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.min.apply(null, targets);\n        };\n\n        var maxFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.max.apply(null, targets);\n        };\n\n        var strokeWidth = markup.style['stroke-width'];\n        var radius = strokeWidth * 2 + strokeWidth * 0.5;\n\n        var l = minFn(locations, 'x') - radius;\n        var t = minFn(locations, 'y') - radius;\n        var r = maxFn(locations, 'x') + radius;\n        var b = maxFn(locations, 'y') + radius;\n        var w = r - l;\n        var h = b - t;\n\n        markup.size = {x: w, y: h};\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\n\n        // Adjust points to relate from the shape's center\n        var position = markup.position;\n        return locations.map(function(point){\n            return {\n                x: point.x - position.x,\n                y: point.y - position.y\n            };\n        });\n    }\n","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n    updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils';\nimport { cloneStyle } from './StyleUtils';\nimport { EditModePolycloud } from './edit-modes/EditModePolycloud';\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupPolycloud(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_POLYCLOUD;\n        this.locations = [];\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupPolycloud.prototype = Object.create(Markup.prototype);\n    MarkupPolycloud.prototype.constructor = MarkupPolycloud;\n\n    var proto = MarkupPolycloud.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModePolycloud(this.editor);\n    };\n\n    /**\n     *\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     */\n    proto.set = function(position, size, locations, closed) {\n\n        this.rotation = 0; // Reset angle //\n        this.locations = locations.concat();\n\n        this.size.x = (size.x === 0) ? 1 : size.x;\n        this.size.y = (size.y === 0) ? 1 : size.y;\n\n        this.closed = closed;\n\n        this.setSize(position, size.x, size.y);\n        this.updateStyle();\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        width = (width === 0 ? 1 : width);\n        height = (height === 0 ? 1 : height);\n\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        var scaleX = width / this.size.x;\n        var scaleY = height / this.size.y;\n\n        for(var i = 0; i < locationsCount; ++i) {\n\n            var point = locations[i];\n\n            point.x *= scaleX;\n            point.y *= scaleY;\n        }\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n        metadata.locations = this.locations.map(function(point){\n            return [point.x, point.y].join(\" \");\n        }).join(\" \");\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        function getOrientation(locations) {\n\n            switch (locations.length) {\n\n                case 0:\n                case 1:\n                    return 1;\n                case 2:\n\n                    var fstPoint = locations[0];\n                    var sndPoint = locations[1];\n\n                    return fstPoint.y > sndPoint.y ? 1 : -1;\n                default:\n\n                    var pointA = locations[0];\n                    var pointB = locations[1];\n                    var pointC = locations[2];\n\n                    var orientation =\n                        (pointB.x - pointA.x) * (pointB.y + pointA.y) +\n                        (pointC.x - pointB.x) * (pointC.y + pointB.y);\n\n                    return orientation < 0 ? 1 : -1;\n            }\n        }\n\n        function getSides(locations, closed) {\n\n            var locationsCount = locations.length;\n\n            var sides = [];\n            var sidesCount = locationsCount - (closed ? 0 : 1);\n\n            for(var i = 0; i < sidesCount; ++i) {\n\n                var locationA = locations[i];\n                var locationB = locations[(i+1)%locationsCount];\n\n                var dx = locationB.x - locationA.x;\n                var dy = locationB.y - locationA.y;\n\n                var length = Math.sqrt(dx * dx + dy * dy);\n\n                sides.push({\n                    index: i,\n                    pointA: new THREE.Vector3(locationA.x, locationA.y, 0),\n                    pointB: new THREE.Vector3(locationB.x, locationB.y, 0),\n                    vecAB:  new THREE.Vector3(dx / length, dy / length, 0),\n                    vecBA:  new THREE.Vector3(-dx / length, -dy / length, 0),\n                    length: length\n                });\n            }\n\n            return sides;\n        }\n\n        function updateCorners(side, cornerA, cornerB, orientation) {\n            var rA = cornerA.radius;\n            var rB = cornerB.radius;\n            var D = side.length;\n\n            if (rA > 0 && rB > 0 && rA + rB > D && Math.abs(rA - rB) < D) {\n                // Corner arcs overlap, so correct them by finding the circle-circle intersection\n                var a = side.pointA.x;\n                var b = side.pointA.y;\n                var c = side.pointB.x;\n                var d = side.pointB.y;\n\n                var delta = 0.25 * Math.sqrt((D + rA + rB) * (D + rA - rB) * (D - rA + rB) * (-D + rA + rB));\n                var xS = (a + c) / 2 + (c - a) * (rA*rA - rB*rB) / (2*D*D);\n                var xT = 2*(b - d) / (D*D) * delta;\n                var yS = (b + d) / 2 + (d - b) * (rA*rA - rB*rB) / (2*D*D);\n                var yT = 2*(a - c) / (D*D) * delta;\n                var x1 = xS + xT;\n                var x2 = xS - xT;\n                var y1 = yS - yT;\n                var y2 = yS + yT;\n                var testPointOnCircle = Math.abs((x1 - a) * (x1 - a) + (y1 - b) * (y1 - b) - rA * rA);\n                if (testPointOnCircle > 0.0000001) {\n                    var tmp = y1;\n                    y1 = y2;\n                    y2 = tmp;\n                }\n\n                var intersec = new THREE.Vector3(x1, y1, 0);\n                var intersecSide = Math.sign(intersec.clone().sub(side.pointA).cross(side.vecAB).z);\n                if (intersecSide !== orientation) {\n                    intersec.set(x2, y2, 0);\n                }\n\n                cornerA.pointB = intersec.clone();\n                cornerB.pointA = intersec.clone();\n\n                return true;\n            }\n\n            return false;\n        }\n\n        function updateSides(sides, corners, radius, orientation) {\n\n            var diameter = radius * 2;\n            var sidesCount = sides.length;\n\n            for(var i = 0; i < sidesCount; ++i) {\n\n                var side = sides[i];\n                var cornerA = corners[i];\n                var cornerB = corners[(i+1)%sidesCount];\n\n                side.bodyA = side.vecAB.clone().multiplyScalar(cornerA.radius).add(side.pointA);\n                side.bodyB = side.vecBA.clone().multiplyScalar(cornerB.radius).add(side.pointB);\n\n                if (updateCorners(side, cornerA, cornerB, orientation)) {\n                    side.body = 0;\n                    side.bodyDiameter = side.bodyCount = 0;\n                } else {\n                    side.body = side.bodyB.clone().sub(side.bodyA).length();\n                    side.bodyCount = Math.round(side.body / diameter);\n                    if (side.bodyCount === 0 && side.body > 0.5*radius) {\n                        side.bodyCount = 1;\n                    }\n                    side.bodyDiameter = diameter + (side.body - diameter * side.bodyCount) / side.bodyCount;\n                }\n\n                side.bodyRadius = side.bodyDiameter * 0.5;\n            }\n        }\n\n        function getCorners(sides, radius, closed) {\n\n            var corners = [];\n            var sidesCount = sides.length;\n\n            for(var i = 0; i < sidesCount; ++i) {\n\n                var sideA = sides[i !== 0 ? i-1 : sidesCount-1];\n                var sideB = sides[i];\n                var large = sideA.vecBA.clone().cross(sideB.vecAB).z < 0;\n\n                var sidesTooShort = sideA.length < radius || sideB.length < radius;\n                if (sidesTooShort || (i === 0 && !closed)) {\n\n                    corners.push({\n                        pointA: sideB.pointA.clone(),\n                        pointB: sideB.pointA.clone(),\n                        radius: 0,\n                        large: false\n                    });\n                } else {\n\n                    corners.push({\n                        pointA: sideB.pointA.clone().add(sideA.vecBA.clone().multiplyScalar(radius)),\n                        pointB: sideB.pointA.clone().add(sideB.vecAB.clone().multiplyScalar(radius)),\n                        radius: radius,\n                        large: large\n                    });\n                }\n            }\n\n            return corners;\n        }\n\n        function createSidePath(side, orientation, path) {\n\n            var count = side.bodyCount;\n            if (count === 0) {\n                return;\n            }\n\n            var radius = side.bodyRadius;\n            var diameter = side.bodyDiameter;\n\n            var xValueInset = diameter * 0.05;\n            var yValueOffset = radius * 3.5 / 3.0;\n\n            var p1 = new THREE.Vector3(xValueInset, orientation * -yValueOffset);\n            var p2 = new THREE.Vector3(diameter - xValueInset, orientation * -yValueOffset);\n            var p3 = new THREE.Vector3(diameter, 0);\n\n            var angle = Math.acos(side.vecAB.x) * (side.vecAB.y < 0 ? -1 : 1);\n            var rotation = new THREE.Matrix4().makeRotationZ(angle);\n\n            p1.applyMatrix4(rotation);\n            p2.applyMatrix4(rotation);\n            p3.applyMatrix4(rotation);\n\n            for (var i = 0; i < count; ++i) {\n\n                path.push('c');\n                path.push(p1.x);\n                path.push(p1.y);\n                path.push(p2.x);\n                path.push(p2.y);\n                path.push(p3.x);\n                path.push(p3.y);\n            }\n        }\n\n        function createCornerPath(corner, first, orientation, path) {\n\n            if (first) {\n\n                path.push('M');\n                path.push(corner.pointA.x);\n                path.push(corner.pointA.y);\n            }\n\n            var large = orientation === 1 ? corner.large : !corner.large;\n\n            if (corner.radius !== 0) {\n\n                path.push('a');\n                path.push(corner.radius);\n                path.push(corner.radius);\n                path.push(0);\n                path.push(large ? 1 : 0);\n                path.push(orientation === 1 ? 1 : 0);\n                path.push(corner.pointB.x - corner.pointA.x);\n                path.push(corner.pointB.y - corner.pointA.y);\n            }\n            return path;\n        }\n\n\n        var strokeWidth = this.style['stroke-width'];\n        var radius = strokeWidth * 2;\n        var orientation = getOrientation(this.locations);\n        var closed = this.closed;\n        var path = [];\n\n        var sides = getSides(this.locations, closed);\n        var corners = getCorners(sides, radius, closed);\n        var cornersCount = corners.length;\n\n        updateSides(sides, corners, radius, orientation);\n\n        for(var i = 0; i < cornersCount; ++i) {\n\n            createCornerPath(corners[i], i === 0, orientation, path);\n            createSidePath(sides[i], orientation, path);\n        }\n\n        closed && path.push('z');\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupPolycloud } from '../MarkupPolycloud';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param closed\n     * @param style\n     * @constructor\n     */\n    export function CreatePolycloud(editor, id, position, size, rotation, locations, style, closed) {\n\n        EditAction.call(this, editor, 'CREATE-POLYCLOUD', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.concat();\n        this.style = cloneStyle(style);\n        this.closed = closed;\n    }\n\n    CreatePolycloud.prototype = Object.create(EditAction.prototype);\n    CreatePolycloud.prototype.constructor = CreatePolycloud;\n\n    var proto = CreatePolycloud.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var polyline = new MarkupPolycloud(this.targetId, editor);\n\n        editor.addMarkup(polyline);\n\n        polyline.set(this.position, this.size, this.movements, this.closed);\n        polyline.setRotation(this.rotation);\n        polyline.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateHighlight } from './CreateHighlight';\n\n    /**\n     *\n     * @param editor\n     * @param highlight\n     * @constructor\n     */\n    export function DeleteHighlight(editor, highlight) {\n        EditAction.call(this, editor, 'DELETE-HIGHLIGHT', highlight.id);\n        this.createHighlight = new CreateHighlight(\n            editor,\n            highlight.id,\n            highlight.position,\n            highlight.size,\n            highlight.rotation,\n            highlight.locations,\n            highlight.getStyle());\n    }\n\n    DeleteHighlight.prototype = Object.create(EditAction.prototype);\n    DeleteHighlight.prototype.constructor = DeleteHighlight;\n\n    var proto = DeleteHighlight.prototype;\n\n    proto.redo = function() {\n\n        this.createHighlight.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createHighlight.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param highlight\n     * @param position\n     * @param size\n     * @param locations\n     * @constructor\n     */\n    export function SetHighlight(editor, highlight, position, size, locations, isAbsoluteCoords) {\n\n        EditAction.call(this, editor, 'SET-HIGHLIGHT', highlight.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\n        this.isAbsoluteCoords = isAbsoluteCoords;\n\n        // No need to save old data\n    }\n\n    SetHighlight.prototype = Object.create(EditAction.prototype);\n    SetHighlight.prototype.constructor = SetHighlight;\n\n    var proto = SetHighlight.prototype;\n\n    proto.redo = function() {\n\n        var highlight = this.editor.getMarkup(this.targetId);\n        if (!highlight) {\n            return;\n        }\n\n        highlight.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\n            this.position = action.position;\n            this.size = action.size;\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n\n","'use strict';\n\nimport { EditModePen } from './EditModePen';\nimport { DeleteHighlight } from '../edit-actions/DeleteHighlight';\nimport { CreateHighlight } from '../edit-actions/CreateHighlight';\nimport { SetHighlight } from '../edit-actions/SetHighlight';\nimport * as MarkupTypes from '../MarkupTypes';\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeHighlight(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_HIGHLIGHT, styleAttributes);\n\n        var normaStrokeWidth = editor.getStrokeWidth();\n        this.style['stroke-opacity'] = 0.50;\n        this.style['stroke-color'] = '#ffff00';\n        this.style['stroke-width'] = 4 * normaStrokeWidth; // Very Thick\n    }\n\n    EditModeHighlight.prototype = Object.create(EditModePen.prototype);\n    EditModeHighlight.prototype.constructor = EditModeHighlight;\n\n    var proto = EditModeHighlight.prototype;\n\n    proto.createPen = function(markupId, position, size, rotation, locations) {\n        return new CreateHighlight(this.editor,\n            markupId,\n            position,\n            size,\n            rotation,\n            locations,\n            this.style);\n    };\n\n    proto.deletePen = function(markup) {\n        return new DeleteHighlight(this.editor, markup);\n    };\n\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\n        return new SetHighlight(this.editor,\n            this.selectedMarkup,\n            position,\n            size,\n            locations,\n            isAbsoluteCoords);\n    };\n\n","'use strict';\n\nimport { MarkupPen } from './MarkupPen';\nimport * as MarkupTypes from './MarkupTypes';\nimport { EditModeHighlight } from './edit-modes/EditModeHighlight';\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupHighlight(id, editor) {\n\n        MarkupPen.call(this, id, editor);\n        this.type = MarkupTypes.MARKUP_TYPE_HIGHLIGHT;\n    }\n\n    MarkupHighlight.prototype = Object.create(MarkupPen.prototype);\n    MarkupHighlight.prototype.constructor = MarkupHighlight;\n\n    var proto = MarkupHighlight.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeHighlight(this.editor);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupHighlight } from '../MarkupHighlight';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param style\n     * @constructor\n     */\n    export function CreateHighlight(editor, id, position, size, rotation, locations, style) {\n\n        EditAction.call(this, editor, 'CREATE-HIGHLIGHT', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.slice(0);\n        this.style = cloneStyle(style);\n    }\n\n    CreateHighlight.prototype = Object.create(EditAction.prototype);\n    CreateHighlight.prototype.constructor = CreateHighlight;\n\n    var proto = CreateHighlight.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var highlight = new MarkupHighlight(this.targetId, editor);\n\n        editor.addMarkup(highlight);\n\n        highlight.set(this.position, this.size, this.movements, false);\n        highlight.setRotation(this.rotation);\n        highlight.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateDimension } from './CreateDimension';\n\n    /**\n     *\n     * @param editor\n     * @param dimension\n     * @constructor\n     */\n    export function DeleteDimension(editor, dimension) {\n\n        // Confusing naming here. Dimension.secondAnchor is the starting point of the dimension,\n        // and dimension.firstAnchor is the final point. In CreateDimension the firstAnchor argument\n        // is the first point of the dimension and the secondAnchor argument is the second\n        // point of the argument. So construct CreateDimension with the secondAnchor before\n        // the firstAnchor.\n        EditAction.call(this, editor, 'DELETE-DIMENSION', dimension.id);\n        this.createDimension = new CreateDimension(\n            editor,\n            dimension.id,\n            dimension.secondAnchor,\n            dimension.firstAnchor,\n            dimension.currentText,\n            dimension.getStyle());\n    }\n\n    DeleteDimension.prototype = Object.create(EditAction.prototype);\n    DeleteDimension.prototype.constructor = DeleteDimension;\n\n    var proto = DeleteDimension.prototype;\n\n    proto.redo = function() {\n\n        this.createDimension.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createDimension.redo();\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param dimension\n     * @param firstAnchor\n     * @param secondAnchor\n     * @constructor\n     */\n    export function SetDimension(editor, dimension, firstAnchor, secondAnchor, text) {\n\n        EditAction.call(this, editor, 'SET-DIMENSION', dimension.id);\n\n        this.newFirstAnchor = {x: firstAnchor.x, y: firstAnchor.y};\n        this.newSecondAnchor = {x: secondAnchor.x, y: secondAnchor.y};\n        this.oldFirstAnchor = {x: dimension.firstAnchor.x, y: dimension.firstAnchor.y};\n        this.oldSecondAnchor = {x: dimension.secondAnchor.x, y: dimension.secondAnchor.y};\n        this.newText = text;\n        this.oldText = dimension.currentText;\n    }\n\n    SetDimension.prototype = Object.create(EditAction.prototype);\n    SetDimension.prototype.constructor = SetDimension;\n\n    var proto = SetDimension.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.newFirstAnchor, this.newSecondAnchor, this.newText);\n\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.oldFirstAnchor, this.oldSecondAnchor, this.oldText);\n\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newFirstAnchor = action.newFirstAnchor;\n            this.newSecondAnchor = action.newSecondAnchor;\n            this.newText = action.newText;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(firstAnchor, secondAnchor, text) {\n\n        var dimension = this.editor.getMarkup(this.targetId);\n\n        if(!dimension) {\n            return;\n        }\n\n        dimension.set(firstAnchor.x, firstAnchor.y, secondAnchor.x, secondAnchor.y, text);\n\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return ((this.newText === this.oldText) && (\n            !this.newFirstAnchor || !this.newSecondAnchor ||\n            this.newFirstAnchor.x === this.oldFirstAnchor.x &&\n            this.newFirstAnchor.y === this.oldFirstAnchor.y &&\n            this.newSecondAnchor.x === this.oldSecondAnchor.x &&\n            this.newSecondAnchor.y === this.oldSecondAnchor.y));\n    };\n","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeleteDimension } from '../edit-actions/DeleteDimension';\nimport { CreateDimension } from '../edit-actions/CreateDimension';\nimport { SetDimension } from '../edit-actions/SetDimension';\nimport { SetStyle } from '../edit-actions/SetStyle';\nimport * as MarkupTypes from '../MarkupTypes';\nimport * as MarkupEvents from '../MarkupEvents';\nimport { EditorTextInput } from './EditorTextInput';\nimport { measureTextLines, radiansToDegrees } from '../MarkupsCoreUtils';\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\n    var MAX_LETTERS = 15;\n    var SPACE = '\\u00A0'; // Non-breaking space\n    var _cursorPosition;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeDimension(editor) {\n\n        var self = this;\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_DIMENSION, styleAttributes);\n\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\n\n        this.measurement = new MeasureCommon.Measurement(MeasureCommon.MeasurementTypes.MEASUREMENT_DISTANCE);\n        var viewer = this.viewer;\n        var measureExt = viewer.getExtension('Autodesk.Measure');\n\n        function abortDimensionMarkup() {\n            self.cancelEditModeChange = true;\n            editor.enterEditMode(); // Selects default edit mode.\n        }\n\n        if (!measureExt) {\n            console.error('Demension markup cant work without measure extension. Please load measure extension first');\n            abortDimensionMarkup();\n        }\n\n        this.sharedMeasureConfig = measureExt.sharedMeasureConfig;\n\n        // If PDF, force calibration\n        if ((measureExt.forceCalibrate || viewer.model.isLeaflet() || viewer.model.isPdf(true)) && !measureExt.calibrationTool.isCalibrated()) {\n            measureExt.openCalibrationRequiredDialog('dimension');\n            abortDimensionMarkup();\n        }\n    }\n\n    EditModeDimension.prototype = Object.create(EditMode.prototype);\n    EditModeDimension.prototype.constructor = EditModeDimension;\n\n    var proto = EditModeDimension.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteDimension = new DeleteDimension(this.editor, markup);\n            deleteDimension.addToHistory = !cantUndo;\n            deleteDimension.execute();\n            this.creating = false;\n            this.dragging = false;\n            return true;\n        }\n        return false;\n    };\n\n    proto.updateTextBoxStyle = function(style) {\n        if (this.isTextInputHelperActive()) {\n            if (!style) {\n                style = this.textInputHelper.textMarkup.getStyle();\n            }\n\n            this.textInputHelper.setStyle(style);\n            this.updateTextBox(this.textInputHelper.textMarkup);\n        }\n    };\n\n    proto.setStyle = function(style) {\n\n        EditMode.prototype.setStyle.call(this, style);\n        this.updateTextBoxStyle(style);\n\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n        if (allows && this.isTextInputHelperActive()) {\n            this.textInputHelper.acceptAndExit();\n        }\n    };\n\n    proto.creationBegin = function() {\n        EditMode.prototype.creationBegin.call(this);\n    };\n\n    proto.creationEnd = function() {\n\n        this.dragging = false;\n        EditMode.prototype.creationEnd.call(this);\n    };\n\n    proto.isMinSizeValid = function() {\n\n        if (this.minSize !== 0) {\n            var tmp = this.editor.sizeFromMarkupsToClient(this.selectedMarkup.size.x, this.selectedMarkup.size.y);\n            return (tmp.x*tmp.x) >= (this.minSize * this.minSize);\n        }\n\n        return true;\n    };\n\n    proto.creationCancel = function() {\n\n        EditMode.prototype.creationCancel.call(this);\n\n        this.creating = false;\n        this.dragging = false;\n\n    };\n\n    proto.destroy = function() {\n\n        if (this.textInputHelper) {\n\n            if (this.textInputHelper.isActive()) {\n                this.textInputHelper.acceptAndExit();\n            }\n\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n\n            this.textInputHelper.destroy();\n            this.textInputHelper = null;\n        }\n\n        this.updateViewportId();\n\n        EditMode.prototype.destroy.call(this);\n    };\n\n    proto.getDistance = function() {\n\n        var distance = null;\n\n        this.measurement.computeResult(this.measurement.picks, this.viewer);\n\n        if (this.viewer.model && this.measurement.distanceXYZ) {\n            var d = Autodesk.Viewing.Private.convertUnits(this.viewer.model.getUnitString(), this.sharedMeasureConfig.units, this.sharedMeasureConfig.calibrationFactor, this.measurement.distanceXYZ);\n            return Autodesk.Viewing.Private.formatValueWithUnits(d, this.sharedMeasureConfig.units, 3, this.sharedMeasureConfig.precision);\n        }\n\n        return distance;\n    };\n\n    proto.updateMeasurement = function(measurementNumber) {\n        var editor = this.editor;\n\n        var pick = this.measurement.getPick(measurementNumber);\n\n        if (_cursorPosition) {\n            pick.geomType = MeasureCommon.SnapType.SNAP_VERTEX;\n            pick.geomVertex = _cursorPosition;\n            pick.intersectPoint = _cursorPosition;\n        } else {\n            editor.snapper.copyResults(pick);\n        }\n\n        return pick;\n    };\n\n    proto.updateViewportId = function(viewportId) {\n        if (this.viewer.model && this.viewer.model.is2d()) {\n            if (!viewportId) {\n                this.viewer.impl.updateViewportId(0);\n                this.editor.snapper.setViewportId(null);\n            }\n            else {\n                // Pass viewport Id to LineShader to make all other geometries with different viewport transparent\n                this.viewer.impl.updateViewportId(viewportId);\n                this.editor.snapper.setViewportId(viewportId);\n\n            }\n        }\n    };\n\n    proto.pickFirstAnchor = function() {\n        var editor = this.editor;\n        this.measurement.clearAllPicks();\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        this.firstAnchor = editor.positionFromClientToMarkups(this.initialX, this.initialY);\n\n        editor.beginActionGroup();\n\n        var dimensionId = editor.getId();\n        var create = new CreateDimension(editor, dimensionId, this.firstAnchor, null, this.currentText, this.style);\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(dimensionId);\n        this.creationBegin();\n\n        var pick = this.updateMeasurement(1);\n        this.updateViewportId(pick.viewportIndex2d);\n    };\n\n    proto.pickSecondAnchor = function(mouseDown) {\n\n        var editor = this.editor;\n        var selectedMarkup = this.selectedMarkup;\n\n        this.secondAnchor = this.getFinalMouseDraggingPosition();\n\n        this.updateMeasurement(2);\n\n        // Correct Perpendicular\n        if (MeasureCommon.correctPerpendicularPicks(this.measurement.getPick(1), this.measurement.getPick(2), this.viewer, editor.snapper)){\n            var newPos = MeasureCommon.getSnapResultPosition(this.measurement.getPick(2), this.viewer);\n            this.secondAnchor = editor.project(newPos);\n            editor.snapper.indicator.render();\n        }\n\n        var secondAnchor = editor.positionFromClientToMarkups(this.secondAnchor.x, this.secondAnchor.y);\n\n        this.size.x = selectedMarkup.size.x;\n        this.size.y = selectedMarkup.size.y;\n\n        selectedMarkup.currentText = this.getDistance();\n\n        var setDimension = new SetDimension(editor, selectedMarkup, this.firstAnchor, secondAnchor, selectedMarkup.currentText);\n        setDimension.execute();\n\n        var setStyle = new SetStyle(editor, selectedMarkup, this.style);\n        setStyle.execute();\n\n        // Open 'Add Length' textbox if no measurement has being taken.\n        if (mouseDown && !selectedMarkup.currentText && this.isMinSizeValid()) {\n            selectedMarkup.currentText = '';\n            this.editor.selectMarkup(null);\n            this.updateTextBox(selectedMarkup);\n        }\n    };\n\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function(event) {\n\n        // Right click - do nothing.\n        if (Autodesk.Viewing.Private.isRightClick(event, this.viewer.navigation)) {\n            return;\n        }\n\n        _cursorPosition = null;\n\n        // Textbox is open.\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.acceptAndExit();\n            return;\n        }\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        // User selected an already created markup.\n        if (this.selectedMarkup && !this.creating) {\n            return;\n        }\n\n        var isSnapped = this.editor.snapper.isSnapped();\n\n        // Picked first point.\n        if (!this.selectedMarkup && !this.creating && isSnapped) {\n            this.pickFirstAnchor();\n        }\n\n        // Picked second point.\n        else if (this.selectedMarkup && this.creating) {\n\n            if (isSnapped) {\n                this.pickSecondAnchor(true);\n            } else {\n                this.deleteMarkup(this.selectedMarkup, true);\n                this.creating = true;\n            }\n\n            this.updateViewportId();\n            this.creationEnd();\n        }\n    };\n\n    proto.onMouseUp = function(event) {\n\n        if (this.dragging) {\n            this.onMouseDown(event);\n            this.dragging = false;\n        }\n    };\n\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        _cursorPosition = null;\n\n        if(!this.selectedMarkup || !this.creating) {\n            return;\n        }\n\n        this.dragging = true;\n        this.pickSecondAnchor(false);\n    };\n\n    proto.getFinalMouseDraggingPosition = function() {\n\n        var editor = this.editor;\n        var bounds = editor.getBounds();\n        var mousePosition = editor.getMousePosition();\n\n        if (!editor.snapper.isSnapped()) {\n            if (editor.viewer.model && editor.viewer.model.is2d()) {\n                _cursorPosition = MeasureCommon.inverseProject(mousePosition, editor.viewer);\n            }\n        }\n\n        var initialX = this.initialX;\n        var initialY = this.initialY;\n\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\n\n        if (finalX == initialX &&\n            finalY == initialY) {\n            finalX++;\n            finalY++;\n        }\n\n        // Make straight line when shift key is down.\n        if (editor.input.constrainAxis && editor.viewer.model.is2d()) {\n            var dx = Math.abs(finalX - initialX);\n            var dy = Math.abs(finalY - initialY);\n\n            if (dx > dy) {\n                finalY = initialY;\n            }\n            else {\n                finalX = initialX;\n            }\n\n            editor.snapper.onMouseMove({ x:finalX, y:finalY });\n\n            if (editor.snapper.isSnapped()) {\n                editor.snapper.copyResults(this.measurement.getPick(2));\n                _cursorPosition = null;\n            } else {\n                _cursorPosition = MeasureCommon.inverseProject({ x:finalX, y:finalY }, editor.viewer);\n            }\n        }\n\n        return { x:finalX, y:finalY };\n    };\n\n    proto.isVisibleChar = function(keyCode) {\n\n    return  ((keyCode > 47 && keyCode < 58)  || // number keys\n            (keyCode == 32)                  || // spacebar\n            (keyCode > 64 && keyCode < 91)   || // letter keys\n            (keyCode > 95 && keyCode < 112)  || // numpad keys\n            (keyCode > 185 && keyCode < 193) || // ;=,-./` (in order)\n            (keyCode > 218 && keyCode < 223));   // [\\]' (in order)\n    };\n\n    proto.measureTextLine = function(text, markup, editor) {\n\n        text = text.replace(new RegExp(' ', 'g'), SPACE);\n        text = text.length === 0 ? markup.initialText : text;\n        return measureTextLines([text + '|'], this.style, editor)[0];\n\n    };\n\n    proto.handleKeyDown = function (e) {\n        var textInputHelper = this.textInputHelper;\n\n        if (e.keyCode === Autodesk.Viewing.KeyCode.ENTER) {\n            return;\n        }\n\n        var markup = textInputHelper.textMarkup;\n        var text = textInputHelper.textArea.value;\n\n        if (e.keyCode === Autodesk.Viewing.KeyCode.BACKSPACE) {\n            text = text.substring(0, text.length-1);\n        }\n\n        if (text.length < MAX_LETTERS && this.isVisibleChar(e.keyCode)) {\n            text = text + e.key;\n        }\n\n        var size = this.measureTextLine(text, markup, this.editor);\n\n        this.updateTextBox(markup, size);\n    };\n\n    proto.updateTextBox = function(markup, size) {\n\n        if (!this.textInputHelper) {\n            this.textInputHelper = new EditorTextInput(this.viewer.container, this.editor, true, markup.initialText, MAX_LETTERS);\n            this.textInputHelper.addEventListener(this.textInputHelper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\n            this.handleKeyDownBinded = this.handleKeyDown.bind(this);\n        }\n\n        markup.text.style.display = 'none';\n\n        if (!size) {\n            size = this.measureTextLine(this.textInputHelper.textArea.value, markup, this.editor);\n        }\n\n        var transform = this.getTextAreaTransform(markup, size);\n\n        this.textInputHelper.styleTextArea.setAttribute('text-align', 'center');\n\n        this.textInputHelper.setActive(markup, false);\n\n\n        // Override textArea attributes\n        this.textInputHelper.textArea.style.position = 'static';\n        this.textInputHelper.textArea.style.padding = '0';\n        this.textInputHelper.textArea.style.width = size.width + 'px';\n        this.textInputHelper.textArea.style.height = size.height + 'px';\n        this.textInputHelper.textArea.style.transform = transform; // Maybe need to add 'allBrowsers' support\n\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n        this.textInputHelper.textArea.removeEventListener('keydown', this.handleKeyDownBinded);\n        this.textInputHelper.textArea.addEventListener('keydown', this.handleKeyDownBinded);\n\n    };\n\n    proto.getTextAreaTransform = function(markup, size) {\n\n        var position = markup.getClientPosition();\n        var rotation = radiansToDegrees(markup.rotation) % 360;\n\n        if (rotation > 90 && rotation <= 270 && markup.shouldFlip()) {\n            rotation = 180 + rotation;\n        }\n\n        return [\n            'translate(', (position.x - (size.width/2)) + 'px,',(position.y - this.viewer.container.clientHeight - size.height) + 'px)',\n            'rotate(', rotation + 'deg)',\n            'translate(0px,', size.height +'px)'\n        ].join(' ');\n    };\n\n    proto.onMouseDoubleClick = function(markup) {\n\n        if (markup === this.selectedMarkup) {\n            this.editor.selectMarkup(null);\n            this.updateTextBox(markup);\n        }\n    };\n\n    proto.onHelperTextChange = function(event) {\n\n        var dataBag = event.data;\n        var markup = dataBag.markup;\n        var textStyle = dataBag.style;\n        var editor = this.editor;\n\n        markup.text.style.display = 'block';\n\n        if (dataBag.newText === '') {\n            dataBag.newText = markup.initialText;\n        }\n\n        // When the text is created for the first time, an action group\n        // is already created and it includes the CreateText action.\n        // Thus, no need to begin another action group.\n        if (!dataBag.firstEdit) {\n            editor.beginActionGroup();\n        }\n\n        var setStyle = new SetStyle(editor, markup, textStyle);\n        setStyle.execute();\n\n        var setDimension = new SetDimension(editor, markup, markup.firstAnchor, markup.secondAnchor, dataBag.newText);\n        setDimension.execute();\n\n        editor.closeActionGroup();\n        editor.selectMarkup(null);\n    };\n\n    /**\n     * We want to make sure that the Input Helper gets removed from the screen\n     * whenever the user attempts to perform an undo or redo action.\n     * @param {Event} event\n     * @private\n     */\n    proto.onHistoryChange = function(event) {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.textMarkup.text.style.display = 'block';\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n        }\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        EditMode.prototype.onSave.call(this);\n\n        // Close input helper if it's open.\n        if (this.isTextInputHelperActive()) {\n            var editor = this.editor;\n            editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            var markup = this.textInputHelper.textMarkup;\n            this.textInputHelper.acceptAndExit();\n            markup.text.style.display = 'block';\n        }\n    };\n\n    proto.useWithSnapping = function () {\n        return true;\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { createMarkupPathSvg, createMarkupTextSvg, composeRGBAString, addMarkupMetadata,\n    radiansToDegrees, degreesToRadians, measureTextLines, setMarkupTextSvgTransform,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, createSvgElement, checkLineSegment,\n    updateMarkupTextSvgBackground, updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea\n} from './MarkupsCoreUtils';\nimport { cloneStyle } from './StyleUtils';\nimport { EditModeDimension } from './edit-modes/EditModeDimension';\n\n    var DIMENSION_MARKUP_HEIGHT = 10;\n    var TEXT_OFFSET = 2;\n    var DEFAULT_TEXT = 'Add Length';\n    var BACKGROUND_COLOR = 'none';//'#ffffff';\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupDimension(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_DIMENSION;\n        this.constraintHeight = true;\n        this.constraintWidth = true;\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n        this.createSvgElement = createSvgElement.bind(this);\n        this.checkLineSegment = checkLineSegment.bind(this);\n        this.measureTextLines = measureTextLines.bind(this);\n\n\n        this.firstAnchor = new THREE.Vector3();\n        this.secondAnchor = new THREE.Vector3();\n        this.shape = createMarkupPathSvg();\n        this.text = createMarkupTextSvg();\n        this.shape.appendChild(this.text);\n        this.textSize = {x: 0, y: 0};\n        this.initialText = DEFAULT_TEXT;\n        this.currentText = ' ';\n\n        if (!this.viewer.model.is2d()) {\n            this.preventReposition = true;\n            this.constraintRotation = true;\n        }\n\n        this.bindDomEvents();\n    }\n\n    MarkupDimension.prototype = Object.create(Markup.prototype);\n    MarkupDimension.prototype.constructor = MarkupDimension;\n\n    var proto = MarkupDimension.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeDimension(this.editor);\n    };\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     * Notice that for the Dimension, the top left is the \"secondAnchor\" of the Dimension and\n     * the bottom right is the \"firstAnchor\" of it.\n     *\n     * @param {Number} xO - secondAnchor\n     * @param {Number} yO - secondAnchor\n     * @param {Number} xF - firstAnchor\n     * @param {Number} yF - firstAnchor\n     */\n    proto.set = function(xO, yO, xF, yF, text) {\n\n        var vO = new THREE.Vector2(xO, yO);\n        var vF = new THREE.Vector2(xF, yF);\n        var vDir = vF.clone().sub(vO).normalize();\n\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\n\n        var firstAnchor = this.firstAnchor;\n        var secondAnchor = this.secondAnchor;\n\n        firstAnchor.set(xF, yF, 0);\n        secondAnchor.set(xO, yO, 0);\n\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\n\n        this.currentText = text;\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the rotation of the markup to the given angle.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\n     *\n     * @param {Number} angle\n     */\n    proto.setRotation = function(angle) {\n\n        if (radiansToDegrees(angle) === 90) {\n            angle = degreesToRadians(-90);\n        }\n\n        this.rotation = angle;\n\n        var xF = Math.cos(-angle);\n        var yF = Math.sin(-angle);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(this.size.x*0.5);\n\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.firstAnchor.set(vF.x, vF.y, 0);\n        this.secondAnchor.set(vO.x, vO.y, 0);\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the namespace.SetSize edit action\n     * @param {{x: Number, y: Number}} position - Dimension's center\n     * @param {Number} width - Dimension's length\n     * @param {Number} height - We ignore this one because we use the Dimension's stroke width instead\n     */\n    proto.setSize = function(position, width, height) {\n\n        var xF = Math.cos(-this.rotation);\n        var yF = Math.sin(-this.rotation);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(width*0.5);\n\n        var vCenter = new THREE.Vector2(position.x, position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.firstAnchor.set(vF.x, vF.y, 0);\n        this.secondAnchor.set(vO.x, vO.y, 0);\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Helper method that returns the font size in client space coords.\n     * @returns {Number}\n     */\n    proto.getClientFontSize = function() {\n\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n    };\n\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var strokeWidth = style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var transform = this.getTransform();\n\n        this.rebuildTextSvg(this.currentText);\n\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth / 2);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.rebuildTextSvg = function(value) {\n        var style = this.style;\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var strokeWidth = style['stroke-width'];\n        var backgroundColor = (value === ' ') ? 'none' : BACKGROUND_COLOR;\n\n        var markup = this.createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n        markup.setAttribute('alignment-baseline', 'middle');\n\n        var text = this.text;\n        var editor = this.editor;\n\n        text.childNodes[0].removeChild(text.markup);\n        text.childNodes[0].appendChild(markup);\n        text.markup = markup;\n\n        var tspan = this.createSvgElement('tspan');\n        tspan.textContent = value;\n        markup.appendChild(tspan);\n\n        var lineSize = this.measureTextLines([value], style, editor)[0]; // Only one line for measurement\n        var textSize = this.textSize = editor.sizeFromClientToMarkups(lineSize.width, lineSize.height);\n\n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2;\n        var textOffset = TEXT_OFFSET * strokeWidth / 2;\n        var offset = (textSize.x + (2 * strokeWidth) >= this.size.x) ? textOffset + edgeH / 2 : textOffset; // If the line is too short for the given text, put it under.\n\n        this.size.y = edgeH + textSize.y + offset;\n\n        var textTransform = this.getTextTransform((4/5 * textSize.y) +  offset, true); // Text height is Always 4/5 of the entire label height.\n        var backgroundTransform = this.getTextTransform(textSize.y + offset, false);\n\n        setAttributeToMarkupSvg(text, 'font-family', style['font-family']);\n        setAttributeToMarkupSvg(text, 'font-size', style['font-size']);\n        setAttributeToMarkupSvg(text, 'font-weight', style['font-weight']);\n        setAttributeToMarkupSvg(text, 'font-style', style['font-style']);\n        setAttributeToMarkupSvg(text, 'text-rendering', 'auto');\n        setAttributeToMarkupSvg(text, 'fill', strokeColor);\n        setMarkupTextSvgTransform(text, backgroundTransform, textTransform);\n        updateMarkupTextSvgBackground(text, textSize.x, textSize.y, backgroundColor);\n        updateMarkupTextSvgClipper(text, textSize.x, textSize.y);\n        updateMarkupTextSvgHitarea(text, textSize.x, textSize.y, editor);\n    };\n\n    proto.shouldFlip = function(){\n        return (this.firstAnchor.x < this.secondAnchor.x);\n    };\n\n    proto.getTextTransform = function(offset, inverse) {\n\n        var flip = this.shouldFlip() ? -1 : 1;\n\n        inverse = inverse ? -1 : 1;\n\n        if (radiansToDegrees(this.rotation) === 90) {\n            this.rotation = degreesToRadians(-90);\n        }\n\n        return [\n            'translate(', this.position.x , ',', this.position.y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'translate(', -flip * this.textSize.x / 2, ',', -flip*offset, ')',\n            'scale(' + flip + ',' + flip*inverse + ')'\n        ].join(' ');\n    };\n\n    /**\n     * Used by the EditFrame to move the markup in Client Space coordinates\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\n     */\n    proto.setPosition = function (x, y) {\n\n        var firstAnchor = this.firstAnchor;\n        var secondAnchor = this.secondAnchor;\n\n        var dx = firstAnchor.x - secondAnchor.x;\n        var dy = firstAnchor.y - secondAnchor.y;\n\n        var xo = x + dx * 0.5;\n        var yo = y + dy * 0.5;\n\n        firstAnchor.x = xo;\n        firstAnchor.y = yo;\n\n        secondAnchor.x = xo - dx;\n        secondAnchor.y = yo - dy;\n\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\n\n        this.updateStyle();\n    };\n\n    proto.generatePoint3d = function(idTarget) {\n\n        var firstAnchor = this.editor.positionFromMarkupsToClient(this.firstAnchor.x, this.firstAnchor.y);\n        var secondAnchor = this.editor.positionFromMarkupsToClient(this.secondAnchor.x, this.secondAnchor.y);\n\n        var direction = firstAnchor.clone().sub(secondAnchor).normalize();\n\n        var point2d = this.checkLineSegment(firstAnchor.x, firstAnchor.y, firstAnchor.x + direction.x * 200, firstAnchor.y + direction.y * 200, idTarget);\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\n\n        return point3d && point3d.point;\n    };\n\n    proto.setMetadata = function() {\n\n        this.text.setAttribute('pointer-events', 'none');\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.firstAnchor = [this.firstAnchor.x, this.firstAnchor.y].join(\" \");\n        metadata.secondAnchor = [this.secondAnchor.x, this.secondAnchor.y].join(\" \");\n        metadata.text = String(this.currentText);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n\n    /**\n     * Returns the raw string value\n     * @returns {String}\n     */\n    proto.getText = function() {\n\n        // if the current text is 'Add Length', you want the textbox will be empty when the user open it.\n        return (this.currentText === this.initialText) ? '' : this.currentText;\n    };\n\n    proto.getPath = function() {\n\n        //   1_                            _4\n        //   | |                          | |\n        //   | |2                        3| |\n        //  0|  --------------------------  |\n        //   |  --------------------------  |\n        //   | |7                       6 | |\n        //   |_|          TEXT            |_|\n        //   8                             5\n\n        var strokeWidth = this.style['stroke-width'];\n        var segmentLength = this.size.x - strokeWidth / 2; // segment length (p2 to p3 length)\n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2; // Edge height (p1 to p8 length)\n\n        return [\n            'M', -segmentLength * 0.5           ,    0              ,   // 0\n            'l', 0                              ,    edgeH / 2      ,   // 1\n            'l', 0                              ,    -edgeH / 2     ,   // 2\n            'l', segmentLength                  ,    0              ,   // 3\n            'l', 0                              ,    edgeH / 2      ,   // 4\n            'l', 0                              ,    -edgeH         ,   // 5\n            'l', 0                              ,    edgeH / 2      ,   // 6\n            'l', -segmentLength                 ,    0              ,   // 7\n            'l', 0                              ,    -edgeH / 2     ,   // 8\n            'z'\n        ];\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.shape = createMarkupPathSvg();\n        clone.text = createMarkupTextSvg();\n        clone.shape.appendChild(clone.text);\n        clone.bindDomEvents();\n    };\n\n    proto.getBoundingRect = function() {\n        var pos = this.getClientPosition();\n        var size = this.getClientSize();\n        return {\n            x: pos.x - size.x / 2,\n            y: pos.y - size.y / 2,\n            width: size.x,\n            height: size.y\n        };\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupDimension } from '../MarkupDimension';\nimport { cloneStyle } from '../StyleUtils';\n\n    /**\n     * @constructor\n     */\n    export function CreateDimension(editor, id, firstAnchor, secondAnchor, text, style) {\n\n        EditAction.call(this, editor, 'CREATE-DIMENSION', id);\n\n        this.selectOnExecution = false;\n        this.secondAnchor = secondAnchor;\n        this.firstAnchor = firstAnchor;\n        this.text = text;\n        this.style = cloneStyle(style);\n    }\n\n    CreateDimension.prototype = Object.create(EditAction.prototype);\n    CreateDimension.prototype.constructor = CreateDimension;\n\n    var proto = CreateDimension.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var dimension = new MarkupDimension(this.targetId, editor);\n\n        editor.addMarkup(dimension);\n\n        // Don't display the dimension markup when there is only one Anchor (First click, before mouse move).\n        if (this.secondAnchor) {\n            dimension.set(this.firstAnchor.x, this.firstAnchor.y, this.secondAnchor.x, this.secondAnchor.y, this.text);\n            dimension.setStyle(this.style);\n        }\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { CreateStamp } from './CreateStamp';\n\nexport { DeleteStamp };\n\nclass DeleteStamp extends EditAction {\n     constructor(editor, stamp) {\n        super(editor, 'DELETE-STAMP', stamp.id);\n\n        this.createStamp = new CreateStamp(\n            editor,\n            stamp.id,\n            stamp.position,\n            stamp.size,\n            stamp.rotation,\n            stamp.getStyle()\n        );\n    }\n\n    redo() {\n        this.createStamp.undo();\n    }\n\n    undo() {\n        this.createStamp.redo();\n    }\n}","'use strict';\n\nimport { EditAction } from './EditAction';\n\nexport { SetStamp };\n\nclass SetStamp extends EditAction {\n    constructor(editor, stamp, position, size) {\n        super(editor, 'SET-STAMP', stamp.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: stamp.position.x, y: stamp.position.y};\n        this.oldSize = {x: stamp.size.x, y: stamp.size.y};\n    }\n\n    redo() {\n        this.applyState(this.targetId, this.newPosition, this.newSize);\n    }\n\n    undo() {\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\n    }\n\n    merge(action) {\n        if (this.targetId === action.targetId && this.type === action.type) {\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n\n        return false;\n    }\n\n    applyState(targetId, position, size) {\n        const stamp = this.editor.getMarkup(targetId);\n        if (!stamp) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        const epsilon = 0.0001;\n        if (\n            Math.abs(stamp.position.x - position.x) > epsilon\n            || Math.abs(stamp.position.y - position.y) > epsilon\n            || Math.abs(stamp.size.x - size.x) > epsilon\n            || Math.abs(stamp.size.y - size.y) > epsilon\n        ) {\n            stamp.set(position, size);\n        }\n    }\n\n    isIdentity() {\n        return (\n            this.newPosition.x === this.oldPosition.x\n            && this.newPosition.y === this.oldPosition.y\n            && this.newSize.x === this.oldSize.x\n            && this.newSize.y === this.newSize.y\n        );\n    }\n}","'use strict';\n\nimport { EditMode } from './EditMode';\nimport { DeleteStamp } from '../edit-actions/DeleteStamp';\nimport { CreateStamp } from '../edit-actions/CreateStamp';\nimport { SetStamp } from '../edit-actions/SetStamp';\nimport * as MarkupTypes from '../MarkupTypes';\n\nexport { EditModeStamp };\n\nclass EditModeStamp extends EditMode {\n    constructor(editor, svgData) {\n        var styleAttributes = [\n            'text-data'\n        ];\n        super(editor, MarkupTypes.MARKUP_TYPE_STAMP, styleAttributes);\n        this.svgData = svgData;\n    }\n\n    deleteMarkup(markup, cantUndo) {\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteStamp = new DeleteStamp(this.editor, markup);\n            deleteStamp.addToHistory = !cantUndo;\n            deleteStamp.execute();\n            return true;\n        }\n        return false;\n    }\n\n    onMouseMove(event) {\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        const { selectedMarkup, editor } = this;\n\n        let final = this.getFinalMouseDraggingPosition();\n        final = editor.clientToMarkups(final.x, final.y);\n        let position = {\n            x: (this.firstPosition.x + final.x) / 2,\n            y: (this.firstPosition.y + final.y) / 2\n        };\n        let size = this.size = {\n            x: Math.abs(final.x - this.firstPosition.x),\n            y: Math.abs(final.y - this.firstPosition.y)\n        };\n\n        const action = new SetStamp(editor, selectedMarkup, position, size);\n        action.execute();\n        return true;\n    }\n\n    onMouseDown() {\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        const editor = this.editor;\n        let mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n        this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\n        this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        editor.beginActionGroup();\n        const markupId = editor.getId();\n        const action = new CreateStamp(editor, markupId, this.firstPosition, this.size, 0, this.style, this.svgData);\n        action.execute();\n\n        // maybe this isn't being called right, that would explain it\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    }\n}\n","'use strict';\n\nimport { Markup } from './Markup';\nimport * as MarkupTypes from './MarkupTypes';\nimport { composeRGBAString, addMarkupMetadata,\n    stringToSvgNode, createSvgElement} from './MarkupsCoreUtils';\nimport { cloneStyle, copyStyle, isStyleEqual } from './StyleUtils';\nimport { EditModeStamp } from './edit-modes/EditModeStamp';\n\nexport { MarkupStamp };\n\nclass MarkupStamp extends Markup {\n    /**\n     * @param {number} id\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     */\n    constructor(id, editor, svgData) {\n        const styleAttributes = [\n            'text-data'\n        ];\n        super(id, editor, styleAttributes);\n        this.type = MarkupTypes.MARKUP_TYPE_STAMP;\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.createShapeGroup();\n\n        this.scriptSvgData = svgData;\n        this.loadSvgData();\n\n        this.bindDomEvents();\n    }\n\n    createShapeGroup() {\n        /*\n        * shape\n        *    group\n        *      customSvg\n        *    hitarea (aka markup)\n        */\n        this.shape = createSvgElement('g');\n        this.shape.group = createSvgElement('g');\n        this.shape.appendChild(this.shape.group);\n\n        let hitarea = createSvgElement('path');\n        hitarea.setAttribute('id', \"hitarea\");\n        hitarea.setAttribute('fill', \"none\");\n        this.shape.appendChild(hitarea);\n\n        this.shape.hitarea = hitarea;\n        this.shape.markup = hitarea;\n    }\n\n    loadSvgData() {\n        let svgString = this.scriptSvgData || this.style['text-data'];\n        let svgNode = stringToSvgNode(svgString);\n\n        // null if parsing fails, so exit\n        if (svgNode === null) {\n            console.warn(\"SVG data \" + svgString + \" is invalid, skipping shape update\");\n            return;\n        }\n\n        let [width, height] = this.getDimensions(svgNode);\n\n        // update the bounding box when the SVG is changed\n        let path = `M 0 0 l ${width} 0 l 0 ${height} l ${-width} 0 z`;\n        this.shape.hitarea.setAttribute('d', path);\n\n        this.shape.group.innerHTML = svgNode.innerHTML;\n\n        // This is to standardize things:\n        // width and height are 1 unit\n        // position is in the centre\n        // have to flip things because of y axis going upwards\n        this.shape.group.setAttribute('transform', `translate( -0.5 , 0.5 ) scale( ${1/width} , ${-1/height} )`);\n        // then copy to the hitarea because it's outside the SVG\n        this.shape.hitarea.setAttribute('transform', this.shape.group.getAttribute('transform'));\n    }\n\n    getEditMode() {\n        return new EditModeStamp(this.editor);\n    }\n\n    set(position, size) {\n        this.setSize(position, size.x, size.y);\n        this.updateStyle();\n    }\n\n    updateStyle(styleChanged) {\n        const strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(this.style['stroke-color'], this.style['stroke-opacity']);\n        this.shape.hitarea.setAttribute('stroke', strokeColor);\n\n        // This only provides translation and rotation, not scale\n        const transform = this.getTransform() + ` scale( ${this.size.x} , ${this.size.y} )`;\n        this.shape.setAttribute('transform', transform);\n\n        if (styleChanged) {\n            this.loadSvgData();\n        }\n    }\n\n    getDimensions(customSvg) {\n        let vb = customSvg.getAttribute('viewBox');\n        if (!vb) {\n            // if no viewbox is specified, check for width and height\n            let width = customSvg.getAttribute('width') || 100;\n            let height = customSvg.getAttribute('height') || 100;\n            return [width, height];\n        }\n        let strings = vb.split(' ');\n        let width = parseInt(strings[2]);\n        let height = parseInt(strings[3]);\n\n        return [width, height];\n    }\n\n    setMetadata() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    }\n\n    setStyle(style) {\n        let stylesEqual = isStyleEqual(style, this.style);\n        if (!stylesEqual) {\n            copyStyle(style, this.style);\n        }\n\n        this.updateStyle(!stylesEqual);\n    }\n}\n","'use strict';\n\nimport { EditAction } from './EditAction';\nimport { MarkupStamp } from '../MarkupStamp';\nimport { cloneStyle } from '../StyleUtils';\n\nexport { CreateStamp };\n\n    /**\n     * @constructor\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param style\n     * @param {string} svg\n     */\n\nclass CreateStamp extends EditAction {\n    constructor(editor, id, position, size, rotation, style, svgData) {\n        super(editor, 'CREATE-STAMP', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n        this.svgData = svgData;\n    }\n\n    redo() {\n        const stamp = new MarkupStamp(this.targetId, this.editor, this.svgData);\n\n        this.editor.addMarkup(stamp);\n\n        stamp.setSize(this.position, this.size.x, this.size.y);\n        stamp.setRotation(this.rotation);\n        stamp.setStyle(this.style);\n    }\n\n    undo() {\n        const markup = this.editor.getMarkup(this.targetId);\n        this.editor.removeMarkup(markup);\n    }\n}\n\n","import * as MarkupType from '../core/MarkupTypes';\nimport { CreateArrow } from './edit-actions/CreateArrow';\nimport { CreateRectangle } from './edit-actions/CreateRectangle';\nimport { CreateText } from './edit-actions/CreateText';\nimport { CreateCallout } from './edit-actions/CreateCallout';\nimport { CreateCircle } from './edit-actions/CreateCircle';\nimport { CreateCloud } from './edit-actions/CreateCloud';\nimport { CreateFreehand } from './edit-actions/CreateFreehand';\nimport { CreatePolyline } from './edit-actions/CreatePolyline';\nimport { CreatePolycloud } from './edit-actions/CreatePolycloud';\nimport { CreateHighlight } from './edit-actions/CreateHighlight';\nimport { CreateDimension } from './edit-actions/CreateDimension';\nimport { DomElementStyle } from './DomElementStyle';\nimport { CreateStamp } from './edit-actions/CreateStamp';\n\n\n    var av = Autodesk.Viewing;\n    var avp = Autodesk.Viewing.Private;\n\n    const _gWindow = av.getGlobal();\n    const _gDocument = _gWindow.document;\n\n    // Change these constants to alter the default sizes in pixels of strokes and fonts.\n    export var MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS = 1;\n    export var MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS = 10;\n    export var MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS = 15;\n    export var EDIT_FRAME_DEFAULT_MARGIN = 7;\n\n    /**\n     * // isTouchDevice is an LMV function. Hammer is included by LMV as well\n     * @returns {boolean}\n     */\n    export var isTouchDevice = function() {\n        // isTouchDevice() is an LMV function.\n        // Hammer (a touch detection lib) is packaged with LMV as well\n        if (av.isTouchDevice && typeof Hammer === \"function\") {\n            return av.isTouchDevice();\n        }\n        return false;\n    };\n\n    //// SVG  //////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param type\n     * @returns {Element}\n     */\n    export var createSvgElement = function(type) {\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n        // See https://developer.mozilla.org/en-US/docs/Web/API/Document/createElementNS\n        var namespace = 'http://www.w3.org/2000/svg';\n        return  _document.createElementNS(namespace, type);\n    };\n\n    /**\n     *\n     * @param {Element} svg - an SVGElement\n     * @returns {Element} svg param is returned back\n     */\n    export var setSvgParentAttributes = function(svg) {\n\n        // See: https://developer.mozilla.org/en-US/docs/Web/SVG/Namespaces_Crash_Course\n        svg.setAttribute('version', '1.1'); // Notice that this is the SVG version, not the \"MARKUP DATA VERSION\"!\n        svg.setAttribute('baseProfile', 'full');\n        svg.setAttribute('layer-order-id', 'markups-svg');\n        return svg;\n    };\n\n    export var createMarkupGroupSvg = function(children) {\n        children = children || [];\n        var svg = createSvgElement('g');\n        svg.setAttribute('cursor', 'default');\n        svg.setAttribute('pointer-events', 'none');\n\n        for (var i = 0; i < children.length; i++) {\n            svg.appendChild(children[i]);\n        }\n\n        return svg;\n    };\n\n    export var createMarkupPathSvg = function() {\n\n        var svg = createSvgElement('g');\n        svg.setAttribute('cursor', 'inherit');\n        svg.setAttribute('pointer-events', 'none');\n\n        var markup = createSvgElement('path');\n        markup.setAttribute('id', 'markup');\n\n        var hitarea = createSvgElement('path');\n        hitarea.setAttribute('id', 'hitarea');\n        hitarea.setAttribute('fill', 'transparent');\n        hitarea.setAttribute('stroke', 'transparent');\n\n        svg.markup = markup;\n        svg.hitarea = hitarea;\n\n        svg.appendChild(markup);\n        svg.appendChild(hitarea);\n\n        return svg;\n    };\n\n    export var setAttributeToMarkupSvg = function(svg, attribute, value) {\n\n        svg.markup.setAttribute(attribute, value);\n    };\n\n    export var updateMarkupPathSvgHitarea = function(svg, editor) {\n\n        var markup = svg.markup;\n        var hitarea = svg.hitarea;\n\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\n        hitareaMargin += parseFloat(markup.getAttribute('stroke-width')) + hitareaMargin;\n\n        var markupFill = markup.getAttribute('fill');\n        var markupStroke = markup.getAttribute('stroke');\n        var strokeEnabled = markupStroke !== '' && markupStroke !== 'none';\n        var fillEnabled = markupFill !== '' && markupFill !== 'none';\n\n        hitarea.setAttribute('d', markup.getAttribute('d'));\n        hitarea.setAttribute('stroke-width', hitareaMargin);\n        hitarea.setAttribute('transform', markup.getAttribute('transform'));\n\n        if (editor.duringEditMode && !editor.navigating) {\n            if (strokeEnabled && fillEnabled) {\n                svg.setAttribute('pointer-events', 'painted');\n                return;\n            }\n\n            if (strokeEnabled) {\n                svg.setAttribute('pointer-events', 'stroke');\n                return;\n            }\n\n            if (fillEnabled) {\n                svg.setAttribute('pointer-events', 'fill');\n                return;\n            }\n        }\n\n        svg.setAttribute('pointer-events', 'none');\n    };\n\n    export var createMarkupTextSvg = function() {\n\n        var svg = createSvgElement('g');\n        svg.setAttribute('cursor', 'default');\n\n        var clipperId = 'markup-clipper-' + getUniqueID();\n        var clipperUrl = 'url(#' + clipperId + ')';\n\n        var clipper = createSvgElement('clipPath');\n        clipper.setAttribute('id', clipperId);\n        clipper.removeAttribute('pointer-events');\n        clipper.rect = createSvgElement('rect');\n        clipper.appendChild(clipper.rect);\n\n        var background = createSvgElement('rect');\n        background.setAttribute('id', 'markup-background');\n        background.removeAttribute('pointer-events');\n\n        var markup = createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n\n        var hitarea = createSvgElement('rect');\n        hitarea.setAttribute('id', 'hitarea');\n        hitarea.setAttribute('fill', 'transparent');\n        hitarea.setAttribute('stroke', 'none');\n        hitarea.setAttribute('stroke-width', '0');\n\n        var clippedArea = createSvgElement('g');\n        clippedArea.setAttribute('clip-path', clipperUrl);\n        clippedArea.appendChild(clipper);\n        clippedArea.appendChild(background);\n        clippedArea.appendChild(markup);\n\n        svg.appendChild(clippedArea);\n        svg.appendChild(hitarea);\n\n        svg.clipper = clipper;\n        svg.background = background;\n        svg.markup = markup;\n        svg.hitarea = hitarea;\n\n        return svg;\n    };\n\n    export var setMarkupTextSvgTransform = function(svg, transform, textTransform) {\n\n        svg.clipper.rect.setAttribute('transform', transform);\n        svg.background.setAttribute('transform', transform);\n        svg.markup.setAttribute('transform', textTransform);\n        svg.hitarea.setAttribute('transform', transform);\n    };\n\n    export var updateMarkupTextSvgHitarea = function(svg, w, h, editor) {\n\n        var hitarea = svg.hitarea;\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\n\n        hitarea.setAttribute('x', -hitareaMargin);\n        hitarea.setAttribute('y', -hitareaMargin);\n        hitarea.setAttribute('width', w + hitareaMargin * 2);\n        hitarea.setAttribute('height', h + hitareaMargin * 2);\n        svg.setAttribute(\"pointer-events\", editor.navigating ? \"none\" : \"painted\");\n    };\n\n    export var updateMarkupTextSvgBackground = function(svg, w, h, color) {\n\n        var background = svg.background;\n\n        background.setAttribute('x', 0);\n        background.setAttribute('y', 0);\n        background.setAttribute('width', w);\n        background.setAttribute('height', h);\n        background.setAttribute('fill', color);\n    };\n\n    export var updateMarkupTextSvgClipper = function(svg, w, h) {\n\n        var clipper = svg.clipper;\n\n        clipper.rect.setAttribute('x', 0);\n        clipper.rect.setAttribute('y', 0);\n        clipper.rect.setAttribute('width', w);\n        clipper.rect.setAttribute('height', h);\n    };\n\n    /**\n     * Helper function that injects metadata for the whole Markup document.\n     * Metadata includes: version.\n     * @param {Element} svg - an SVGElement\n     * @param {Object} metadata - Dictionary with attributes\n     */\n    export var addSvgMetadata = function(svg ,metadata) {\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n\n        var metadataNode = _document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\n        var dataVersionNode = _document.createElement('markup_document');\n\n        metadataNode.appendChild(dataVersionNode);\n\n        // NOTE: We could iterate over the properties, but we don't because these are the only ones supported\n        dataVersionNode.setAttribute(\"data-model-version\", metadata[\"data-model-version\"]); // Version. For example: \"1\"\n\n        svg.insertBefore(metadataNode, svg.firstChild);\n        return metadataNode;\n    };\n\n    /**\n     * Helper function that injects metadata for specific markup svg nodes.\n     * @param {Element} markupNode - an SVGElement for the markup\n     * @param {Object} metadata - Dictionary where all key/value pairs are added as metadata entries.\n     * @returns {Element}\n     */\n    export var addMarkupMetadata = function(markupNode, metadata) {\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n\n        var metadataNode = _document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\n        var dataVersionNode = _document.createElement('markup_element');\n\n        metadataNode.appendChild(dataVersionNode);\n        for (var key in metadata) {\n            if (Object.prototype.hasOwnProperty.call(metadata, key)) {\n                dataVersionNode.setAttribute(key, metadata[key]);\n            }\n        }\n\n        markupNode.insertBefore(metadataNode, markupNode.firstChild);\n        return metadataNode;\n    };\n\n    /**\n     * Removes al metadata nodes from an Svg node structure.\n     * Method will remove all metadata nodes from children nodes as well.\n     * @param svgNode\n     */\n    export var removeAllMetadata = function(svgNode) {\n\n        if (svgNode.getElementsByTagName) {\n            var nodes = svgNode.getElementsByTagName(\"metadata\");\n            for (var i=0; i<nodes.length; ++i) {\n                var metadataNode = nodes[i];\n                metadataNode.parentNode && metadataNode.parentNode.removeChild(metadataNode);\n            }\n        }\n\n        // Transverse children nodes\n        var svgChildren = svgNode.children || svgNode.childNodes;\n        if (svgChildren) {\n            for (i=0; i<svgChildren.length; ++i) {\n                removeAllMetadata(svgChildren[i]);\n            }\n        }\n    };\n\n    /**\n     * Utility function that transfers children from an Html/Svg node into another one.\n     * @param nodeFrom - The node instance from where children will be taken.\n     * @param nodeInto - The node that's going to parent the transferred children.\n     */\n    export var transferChildNodes = function(nodeFrom, nodeInto) {\n\n        var svgChildren = nodeFrom.children || nodeFrom.childNodes;\n        var tmpArray = [];\n        for (var i=0; i<svgChildren.length; ++i){\n            tmpArray.push(svgChildren[i]); // Avoid appendChild\n        }\n        tmpArray.forEach(function(node){\n            nodeInto.appendChild(node);\n        });\n    };\n\n    /**\n     * Generate a unique id.\n     * @returns {string}\n     */\n    export var getUniqueID = function() {\n        return THREE.Math.generateUUID();\n    };\n\n\n    /**\n     * Serializes an SVG node into a String.\n     * @param domNode\n     * @returns {string}\n     */\n    export var svgNodeToString = function(domNode){\n\n        function removeHitareas(svg, hitareas) {\n\n            var hitarea = svg.hitarea;\n            var hitareaParent = hitarea && hitarea.parentNode;\n\n            if (hitareaParent) {\n\n                hitareas.push({hitarea: hitarea, parent: hitareaParent});\n                hitareaParent.removeChild(hitarea);\n            }\n\n            var children = svg.childNodes;\n            var childrenCount = children.length;\n\n            for(var i = 0; i < childrenCount; ++i) {\n                removeHitareas(children.item(i), hitareas);\n            }\n        }\n\n        function addHitareas(hitareas) {\n\n            var hitareasCount = hitareas.length;\n            for(var i = 0; i < hitareasCount; ++i) {\n\n                var hitarea = hitareas[i];\n                hitarea.parent.appendChild(hitarea.hitarea);\n            }\n        }\n\n        var result;\n        try {\n            var hitareas = [];\n            removeHitareas(domNode, hitareas);\n\n            var xmlSerializer = new XMLSerializer();\n            result = xmlSerializer.serializeToString(domNode);\n\n            addHitareas(hitareas);\n\n        } catch (err) {\n            result = '';\n            console.warn('svgNodeToString failed to generate string representation of domNode.');\n        }\n        return result;\n    };\n\n    export var stringToSvgNode = function(stringNode){\n\n        var node = null;\n        try {\n            var domParser = new DOMParser();\n            var doc = domParser.parseFromString(stringNode, \"text/xml\");\n            node = doc.firstChild; // We should only be getting 1 child anyway.\n        } catch (err) {\n            node = null;\n            console.warn('stringToSvgNode failed to generate an HTMLElement from its string representation.');\n        }\n        return node;\n    };\n\n    /**\n     * Injects functions and members to a client object which will\n     * receive the ability to dispatch events.\n     * Mechanism is the same as in Autodesk.Viewing.Viewer.\n     *\n     * Note: All of the code here comes from Autodesk.Viewing.Viewer\n     *\n     * @param {Object} client - Object that will become an event dispatcher.\n     */\n    export var addTraitEventDispatcher = function(client) {\n\n        // Inject member variable\n        client.listeners = {};\n\n        // Inject functions\n        client.addEventListener = function(type, listener) {\n            if (typeof this.listeners[type] == \"undefined\"){\n                this.listeners[type] = [];\n            }\n            this.listeners[type].push(listener);\n        };\n        client.hasEventListener = function (type, listener) {\n            if (this.listeners === undefined) return false;\n            var listeners = this.listeners;\n            if (listeners[ type ] !== undefined && listeners[ type ].indexOf(listener) !== -1) {\n                return true;\n            }\n            return false;\n        };\n        client.removeEventListener = function(type, listener) {\n            if (this.listeners[type] instanceof Array){\n                var li = this.listeners[type];\n                for (var i=0, len=li.length; i < len; i++){\n                    if (li[i] === listener){\n                        li.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n        };\n        client.dispatchEvent = function(event) {\n            if (typeof event == \"string\"){\n                event = { type: event };\n            }\n            if (!event.target){\n                event.target = this;\n            }\n\n            if (!event.type){\n                throw new Error(\"event type unknown.\");\n            }\n\n            if (this.listeners[event.type] instanceof Array) {\n                var typeListeners = this.listeners[event.type].slice();\n                for (var i=0; i < typeListeners.length; i++) {\n                    typeListeners[i].call(this, event);\n                }\n            }\n        };\n    };\n\n    /**\n     * Removes the EventDispatcher trait\n     *\n     * @param {Object} client\n     */\n    export var removeTraitEventDispatcher = function(client) {\n\n        try {\n            delete client.listeners;\n            delete client.addEventListener;\n            delete client.hasEventListener;\n            delete client.removeEventListener;\n            delete client.dispatchEvent;\n        } catch (e) {\n            // nothing\n        }\n    };\n\n    //// Math  /////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     * Calculates the pixel position in client space coordinates of a point in world space.\n     * @param {THREE.Vector3} point Point in world space coordinates.\n     * @param viewer\n     * @param snap Round values to closest pixel center.\n     * @returns {THREE.Vector3} Point transformed and projected into client space coordinates.\n     */\n    export var worldToClient = function(point, viewer, snap) {\n\n        var p = worldToViewport(point, viewer);\n        var result = viewportToClient(p.x, p.y, viewer);\n        result.z = 0;\n\n        // snap to the center of the\n        if (snap) {\n            result.x = Math.floor(result.x) + 0.5;\n            result.y = Math.floor(result.y) + 0.5;\n        }\n\n        return result;\n    };\n\n    export var clientToWorld = function(clientX, clientY, depth, viewer) {\n\n        var point = clientToViewport(clientX, clientY, viewer);\n        point.z = depth;\n\n        point.unproject(viewer.impl.camera);\n        return point;\n    };\n\n    export var clientToViewport = function(clientX, clientY, viewer) {\n\n        return viewer.impl.clientToViewport(clientX, clientY);\n    };\n\n    export var viewportToClient = function(viewportX, viewportY, viewer) {\n\n        return viewer.impl.viewportToClient(viewportX, viewportY);\n    };\n\n    /**\n     * Calculates the world position of a point in client space coordinates.\n     * @param {Object} point - { x:Number, y:Number, z:Number }\n     * @param {Object} viewer - LMV instance\n     * @returns {THREE.Vector3}\n     */\n    export var worldToViewport = function(point, viewer) {\n\n        var p = new THREE.Vector3();\n\n        p.x = point.x;\n        p.y = point.y;\n        p.z = point.z;\n\n        p.project(viewer.impl.camera);\n        return p;\n    };\n\n    export var metersToModel = function(meters, viewer) {\n\n        var modelToMeter = viewer.model.getUnitScale();\n        var meterToModel = 1 / modelToMeter;\n\n        return meterToModel * meters;\n    };\n\n    export var radiansToDegrees = function (radians) {\n\n        return radians * (180 / Math.PI);\n    };\n\n    export var degreesToRadians = function(degrees) {\n\n        return degrees * (Math.PI / 180);\n    };\n\n    /**\n     *\n     * @param value\n     * @returns {number}\n     */\n    export var sign = function (value) {\n\n        return (value >= 0) ? 1 : -1;\n    };\n\n    /**\n     *\n     * @param pointA\n     * @param pointB\n     * @param range\n     * @param editor\n     * @returns {boolean}\n     */\n    export var areMarkupsPointsInClientRange = function(pointA, pointB, range, editor){\n\n        range = editor.sizeFromClientToMarkups(0, range).y;\n\n        var dx = pointA.x - pointB.x;\n        var dy = pointA.y - pointB.y;\n\n        return range * range >= dx * dx + dy * dy;\n    };\n\n    //// LMV ui ////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    export var hideLmvUi = function(viewer) {\n\n        // If the viewer is no gui, then there is nothing to hide\n        if(!viewer.toolbar) {\n            return;\n        }\n\n        // Exit other tools and hide HudMessages.\n        viewer.setActiveNavigationTool();\n\n        dismissLmvHudMessage();\n        hideLmvPanels(true, viewer);\n        hideLmvToolsAndPanels(viewer);\n    };\n\n    export var restoreLmvUi = function(viewer) {\n\n        // If the viewer is no gui, then there is nothing to hide\n        if(!viewer.toolbar) {\n            return;\n        }\n\n        dismissLmvHudMessage();\n        hideLmvPanels(false, viewer);\n        showLmvToolsAndPanels(viewer);\n    };\n\n    /**\n     *\n     * @param hide\n     * @param viewer\n     */\n    export var hideLmvPanels = function(hide, viewer) {\n\n        var dockingPanels = viewer.dockingPanels;\n\n        // Panels may not be present when dealing with an instance of Viewer3D.js\n        // (as opposed to an instance of GuiViewer3D.js)\n        if (!dockingPanels) return;\n\n        for (var i = 0; i < dockingPanels.length; ++i) {\n\n            var panel = dockingPanels[i];\n            var panelContainer = panel.container;\n\n            if (panelContainer.classList.contains(\"dockingPanelVisible\")) {\n                panelContainer.style.display = hide ? \"none\" : \"block\";\n\n                // Call the visibility changed notification if any additional\n                // stuff needs to be done (update the date i.e. PropertyPanel, etc).\n                panel.visibilityChanged();\n            }\n        }\n    };\n\n    /**\n     * Shows panels and tools in the viewer.\n     * @param viewer\n     */\n    export var showLmvToolsAndPanels = function(viewer) {\n\n        // Restore view cube.\n        if(viewer && viewer.model && !viewer.model.is2d()) {\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\n                ext.displayViewCube(true, false);\n                ext.displayHomeButton(true);\n            });\n        }\n\n        // TODO: Find or ask for a better way to restore this buttons.\n        const _document = viewer.getDocument();\n        var anim = _document.getElementsByClassName('toolbar-animation-subtoolbar');\n\n        if (anim.length > 0) {\n            anim[0].style.display = '';\n        }\n\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\n        if (viewer.toolbar) {\n            var viewerContainer = viewer.toolbar.container;\n            var viewerContainerChildrenCount = viewerContainer.children.length;\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\n                viewerContainer.children[i].style.display = \"\";\n            }\n        }\n    };\n\n    /**\n     * Hides panels and tools in the viewer.\n     * @param viewer\n     */\n    export var hideLmvToolsAndPanels = function(viewer) {\n\n        // Hide Panels and tools.\n        if (viewer && viewer.model && !viewer.model.is2d()) {\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\n                ext.displayViewCube(false, false);\n                ext.displayHomeButton(false);\n            });\n\n        }\n\n        const _document = viewer.getDocument();\n        // TODO: Find or ask for a better way to hide this buttons.\n        var anim = _document.getElementsByClassName('toolbar-animation-subtoolbar');\n\n        if (anim.length > 0) {\n            anim[0].style.display = 'none';\n\n            var animator = viewer.impl.keyFrameAnimator;\n            if (animator && !animator.isPaused) {\n                animator.pauseCameraAnimations();\n                animator.pause();\n\n                var playButton = viewer.modelTools.getControl('toolbar-animationPlay');\n                if (playButton) {\n                    playButton.setIcon('toolbar-animation-pause-icon');\n                    playButton.setToolTip('Pause');\n                }\n            }\n        }\n\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\n        if (viewer.toolbar) {\n            var viewerContainer = viewer.toolbar.container;\n            var viewerContainerChildrenCount = viewerContainer.children.length;\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\n                viewerContainer.children[i].style.display = \"none\";\n            }\n        }\n    };\n\n    /**\n     * Dismisses all LMV HudMessages\n     */\n    export var dismissLmvHudMessage = function() {\n\n        // Using try/catch block since we are accessing the Private namespace of LMV.\n        try {\n            var keepDismissing = true;\n            while (keepDismissing) {\n                keepDismissing = Autodesk.Viewing.Private.HudMessage.dismiss();\n            }\n        } catch (ignore) {\n            // Failing to show the message is an okay fallback scenario\n            console.warn(\"[CO2]Failed to dismiss LMV HudMessage\");\n        }\n    };\n\n    //// Styles ////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    export var getStrokeWidth = function(widthInPixels, editor) {\n\n        var size = editor.sizeFromClientToMarkups(0, widthInPixels);\n        return size.y;\n    };\n\n    /**\n     * Creates markups from a parsed svg string child\n     * @param child - child of a parsed SVG string\n     * @param editor - MarkupsCore\n     * @returns {*} Markup Object\n     */\n    export var createMarkupFromSVG = function(child, editor) {\n        // var self = this;\n        if (!child.childNodes[0]) {\n            return null;\n        }\n\n        var meta = child.childNodes[0].childNodes[0] || '';\n\n        var getCurrentStyle = function(editor, metadata) {\n\n            var source = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity',\n                'font-family', 'font-size','font-style','font-weight','stroke-linejoin'];\n            var style = {};\n            for (var i=0; i < source.length; i++) {\n                var value = metadata.getAttribute(source[i]);\n                if(value == null) {\n                    continue;\n                }\n                switch (source[i]) {\n                    case 'font-size':\n                    case 'stroke-width':\n                    case 'stroke-opacity':\n                    case 'fill-opacity':\n                        style[source[i]] = parseFloat(value);\n                        break;\n                    case 'stroke-linejoin':\n                        break;\n                    case 'font-family':\n                    case 'font-style':\n                    case 'font-weight':\n                    case 'stroke-color':\n                    case 'text-data':\n                    case 'fill-color':\n                        style[source[i]] = value;\n                        break;\n                    default:\n                        avp.logger.warn('Style not recognized.');\n                        break;\n                }\n            }\n            return style;\n        };\n\n        var isClosed = function() {\n            var path = child.childNodes[1] || '';\n            var closed = false;\n            if (typeof path !== 'string'){\n                var d = path.getAttribute('d').split(' ');\n                if (d[d.length-1].toLowerCase() === 'z'){\n                    closed = true;\n                }\n            }\n            return closed;\n        };\n\n        var getLocations = function() {\n            var locations = [];\n            var locStr = meta.getAttribute('locations').split(\" \") || '';\n\n            for(var i=0; i< locStr.length; i+=2) {\n                var pointPair = {x:parseFloat(locStr[i]), y:parseFloat(locStr[i+1])};\n                locations.push( pointPair );\n            }\n            return locations;\n        };\n\n        var getAttributeVector = function(attribute) {\n            var posVec = new THREE.Vector3();\n            var value = meta.getAttribute(attribute) || meta.getAttribute(attribute.toLowerCase());\n            var strPos = value.split(\" \");\n            posVec.x = parseFloat(strPos[0]);\n            posVec.y = parseFloat(strPos[1]);\n            return posVec;\n        };\n\n        var getPosition = function() {\n            return getAttributeVector('position');\n        };\n\n        var getSize = function() {\n            return getAttributeVector('size');\n        };\n\n        var getRotation = function() {\n            var strRot = meta.getAttribute('rotation') || '';\n            return parseFloat(strRot);\n        };\n\n        var getText = function() {\n            return meta.getAttribute('text') || '';\n        };\n\n        var getIsFrameUsed = function() {\n            return !!parseInt(meta.getAttribute('isframeused'));\n        };\n\n        if (typeof meta !== 'string') {\n            // get the type of the child\n            var position, size, rotation, locations, tail, head, closed, text, firstAnchor, secondAnchor;\n            var id = editor.getId();\n            var style = getCurrentStyle(editor, meta);\n            var type = meta.getAttribute('type') || '';\n            var createMarkup;\n            switch(type) {\n                case MarkupType.MARKUP_TYPE_ARROW:\n                    tail = getAttributeVector('tail');\n                    head = getAttributeVector('head');\n                    createMarkup = new CreateArrow(editor, id, tail, head, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_RECTANGLE:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateRectangle(editor, id, position, size, rotation, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_TEXT:\n                    position = getPosition();\n                    size = getSize();\n                    text = getText();\n                    createMarkup = new CreateText(editor, id, position, size, text, style );\n                    break;\n\n                case MarkupType.MARKUP_TYPE_CALLOUT:\n                    position = getPosition();\n                    size = getSize();\n                    text = getText();\n                    var isFrameUsed = getIsFrameUsed();\n                    createMarkup = new CreateCallout(editor, id, position, size, text, style, isFrameUsed);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_CIRCLE:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateCircle(editor, id, position, size, rotation, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_CLOUD:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateCloud(editor, id, position, size, rotation, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_FREEHAND:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    createMarkup = new CreateFreehand(editor, id, position, size, rotation, locations, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_POLYLINE:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    closed = isClosed();\n                    createMarkup = new CreatePolyline(editor, id, position, size, rotation, locations, style, closed);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_POLYCLOUD:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    closed = isClosed();\n                    createMarkup = new CreatePolycloud(editor, id, position, size, rotation, locations, style, closed);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_HIGHLIGHT:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    createMarkup = new CreateHighlight(editor, id, position, size, rotation, locations, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_DIMENSION:\n                    firstAnchor = getAttributeVector('firstAnchor');\n                    secondAnchor = getAttributeVector('secondAnchor');\n                    text = getText();\n                    createMarkup = new CreateDimension(editor, id, firstAnchor, secondAnchor, text, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_STAMP:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateStamp(editor, id, position, size, rotation, style, child);\n                    break;\n\n                default:\n                    createMarkup = null;\n                    break;\n            }\n            if (createMarkup){\n                createMarkup.addToHistory = false;\n                createMarkup.execute();\n                var markupList = editor.svgLayersMap[editor.activeLayer].markups;\n\n                for(var i = 0; i < markupList.length; ++i) {\n                    if (markupList[i].id === id) {\n                        return markupList[i];\n                    }\n                }\n            }\n            return null;\n        }\n    };\n\n\n    export var composeRGBAString = function(hexRGBString, opacity) {\n\n        if(!hexRGBString || !opacity || opacity <= 0) {\n            return 'none';\n        }\n\n        return ['rgba(' +\n            parseInt('0x' + hexRGBString.substr(1,2)), ',',\n            parseInt('0x' + hexRGBString.substr(3,2)), ',',\n            parseInt('0x' + hexRGBString.substr(5,2)), ',', opacity, ')'].join('');\n    };\n\n    //// Id Target Collision ///////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param x0\n     * @param y0\n     * @param x1\n     * @param y1\n     * @param idTarget\n     */\n    export var checkLineSegment = function(x0, y0, x1, y1, idTarget) {\n\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\n        var deviceRatio = _window.devicePixelRatio || 1;\n\n        x0 *= deviceRatio;\n        y0 *= deviceRatio;\n        x1 *= deviceRatio;\n        y1 *= deviceRatio;\n\n        var idTargetWidth = idTarget.width;\n        var idTargetHeight = idTarget.height;\n        var idTargetBuffer = idTarget.buffer;\n\n        x0 = Math.round(x0);\n        x1 = Math.round(x1);\n        y0 = Math.round(idTargetHeight - y0);\n        y1 = Math.round(idTargetHeight - y1);\n\n        function point(x, y) {\n\n            x = Math.round(x);\n            y = Math.round(y);\n\n            var dx = 0;\n            var dy = 0;\n\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\n                dy += check(x,y+j) ? j : 0;\n            }\n\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\n                dx += check(x+i,y) ? i : 0;\n            }\n\n            return {\n                x: Math.round(x / deviceRatio + dx),\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\n        }\n\n        function check(x, y) {\n\n            // Probably better to clip line at the beginning.\n            if (x < 0 || x >= idTargetWidth ||\n                y < 0 || y >= idTargetHeight) {\n                return false;\n            }\n\n            var index = (y * idTargetWidth + x) *4;\n            return (\n                idTargetBuffer[index  ] !== 0xFF ||\n                idTargetBuffer[index+1] !== 0xFF ||\n                idTargetBuffer[index+2] !== 0xFF);\n        }\n\n        // DDA Line algorithm\n        var dx = (x1 - x0);\n        var dy = (y1 - y0);\n\n        var m = dx !== 0 ? dy / dx : 1;\n        var x = x0;\n        var y = y0;\n\n        if (dx !== 0 && Math.abs(m) <= 1) {\n\n            if (x0 <= x1) {\n                for (; x <= x1; ++x, y += m) {\n                    if (check(x, Math.round(y))) {\n                        return point(x, y);\n                    }\n                }\n            } else {\n                for (; x >= x1; --x, y -= m) {\n                    if (check(x, Math.round(y))) {\n                        return point(x, y);\n                    }\n                }\n            }\n        } else {\n\n            m = dx !== 0 ? 1/m : 0;\n            if (y0 <= y1) {\n                for (; y <= y1; ++y, x += m) {\n                    if (check(Math.round(x), y)) {\n                        return point(x, y);\n                    }\n                }\n            } else {\n                for (; y >= y1; --y, x -= m) {\n                    if (check(Math.round(x), y)) {\n                        return point(x, y);\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     *\n     * @param polygon\n     * @param idTarget\n     */\n    export var checkPolygon = function(polygon, idTarget) {\n\n        // Return if incorrect parameters.\n        if(!polygon || polygon.verxtexCount < 3 || !idTarget) {\n            return null;\n        }\n\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\n        var deviceRatio = _window.devicePixelRatio || 1;\n\n        var idTargetWidth = idTarget.width;\n        var idTargetHeight = idTarget.height;\n        var idTargetBuffer = idTarget.buffer;\n\n        var vertexCount = polygon.vertexCount;\n        var xVertices = Float32Array.from(polygon.xVertices); // Clone to scale by device pixel ratio and to\n        var yVertices = Float32Array.from(polygon.yVertices); // change y coordinates to OpenGL style.\n\n        function point(x, y) {\n\n            var dx = 0;\n            var dy = 0;\n\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\n                dy += check(x,y+j) ? j : 0;\n            }\n\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\n                dx += check(x+i,y) ? i : 0;\n            }\n\n            return {\n                x: Math.round(x / deviceRatio) + dx,\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\n        }\n\n        function check(x, y) {\n\n            if (x < 0 || x >= idTargetWidth ||\n                y < 0 || y >= idTargetHeight) {\n                return false;\n            }\n\n            var index = (y * idTargetWidth + x) * 4;\n            return (\n                idTargetBuffer[index  ] !== 0xFF ||\n                idTargetBuffer[index+1] !== 0xFF ||\n                idTargetBuffer[index+2] !== 0xFF) && isInsidePolygon(x, y);\n        }\n\n        function isInsidePolygon(x, y) {\n\n            var result = false;\n            var vertexCount = polygon.vertexCount;\n            for(var i = 0, j = vertexCount-1; i < vertexCount; j = i++) {\n\n                if (((yVertices[i] > y) != (yVertices[j] > y)) &&\n                     (x < (xVertices[j] - xVertices[i]) * (y - yVertices[i]) / (yVertices[j] - yVertices[i]) + xVertices[i]) ) {\n                    result = !result;\n                }\n            }\n            return result;\n        }\n\n        // Change coordinates to OpenGL style and calculate polygon's bounding box.\n        var bbX0 = Number.POSITIVE_INFINITY;\n        var bbY0 = Number.POSITIVE_INFINITY;\n        var bbX1 = Number.NEGATIVE_INFINITY;\n        var bbY1 = Number.NEGATIVE_INFINITY;\n\n        for(var i = 0; i < vertexCount; ++i) {\n\n            var bbX = xVertices[i] = xVertices[i] * deviceRatio;\n            var bbY = yVertices[i] = idTargetHeight - yVertices[i] * deviceRatio;\n\n            bbX0 = Math.min(bbX0, bbX);\n            bbY0 = Math.min(bbY0, bbY);\n            bbX1 = Math.max(bbX1, bbX);\n            bbY1 = Math.max(bbY1, bbY);\n        }\n\n        if (bbX1 < 0 || bbX0 > idTargetWidth ||\n            bbY1 < 0 || bbY0 > idTargetHeight) {\n            return null;\n        }\n\n        var bbW = Math.round(bbX1 - bbX0);\n        var bbH = Math.round(bbY1 - bbY0);\n\n        var bbCenterX = Math.round((bbX0 + bbX1)*0.5);\n        var bbCenterY = Math.round((bbY0 + bbY1)*0.5);\n\n        // Check\n        var x = bbCenterX;\n        var y = bbCenterY;\n\n        var w = 1;\n        var h = 1;\n\n        do {\n\n            var endX = x + w;\n            var endY = y + h;\n\n            for(; x < endX; ++x) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n\n            for(; y < endY; ++y) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n\n            if (w < bbW) {\n                endX = x - ++w; ++w;\n            } else {\n                endX = x - w;\n            }\n\n            if (h < bbH) {\n                endY = y - ++h; ++h;\n            } else {\n                endY = y - h;\n            }\n\n            for(; x > endX; --x) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n\n            for(; y > endY; --y) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n        } while(w < bbW || h < bbH);\n     };\n\n    //// CSS ///////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @returns {*}\n     */\n    export var createStyleSheet = function() {\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n        var style = _document.createElement(\"style\");\n\n        // This is WebKit hack.\n        style.appendChild(_document.createTextNode(\"\"));\n        _document.head.appendChild(style);\n\n        return style.sheet;\n    };\n\n    /**\n     *\n     * @param styleSheet\n     * @param selector\n     * @param styles\n     * @param index\n     */\n    export var addRuleToStyleSheet = function(styleSheet, selector, styles, index) {\n\n        if(\"insertRule\" in styleSheet) {\n            styleSheet.insertRule(selector + \"{\" + styles + \"}\", index);\n        }\n        else if(\"addRule\" in styleSheet) {\n            styleSheet.addRule(selector, styles, index);\n        }\n    };\n\n    //// SVG ///////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param lines\n     * @param style\n     * @param editor\n     */\n    export var measureTextLines = function(lines, style, editor) {\n\n        // Measure div style is line style with some custom layout properties.\n        var fontSize = editor.sizeFromMarkupsToClient(0, style['font-size']).y;\n\n        var measureStyle = new DomElementStyle()\n            .setAttribute('font-family', style['font-family'])\n            .setAttribute('font-size', fontSize + 'px')\n            .setAttribute('font-weight', style['font-weight'] ? 'bold' : '')\n            .setAttribute('font-style', style['font-style'] ? 'italic' : '')\n\n            .removeAttribute(['top', 'left', 'width', 'height', 'overflow-y'])\n            .setAttribute('position','absolute')\n            .setAttribute('white-space','nowrap')\n            .setAttribute('float','left')\n            .setAttribute('visibility','hidden')\n            .getStyleString();\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n        // Create measure div.\n        var measure = _document.createElement('div');\n\n        measure.setAttribute('style', measureStyle);\n        editor.viewer.container.appendChild(measure);\n\n        // Measure.\n        var result = [];\n\n        var linesCount = lines.length;\n        for(var i = 0; i < linesCount; ++i) {\n\n            measure.innerText = lines[i];\n            result.push({\n                line: lines[i],\n                width: measure.clientWidth,\n                height: measure.clientHeight\n            });\n        }\n\n        // Remove measure div and return result.\n        editor.viewer.container.removeChild(measure);\n        return result;\n    };\n\n    export var createArcTo = function(x, y, xRadius, yRadius, relative, path) {\n\n        path.push(relative ? 'a' : 'A');\n        path.push(xRadius);\n        path.push(yRadius);\n        path.push(0);\n        path.push(1);\n        path.push(1);\n        path.push(x);\n        path.push(y);\n\n        return path;\n    };\n\n    export var createEllipsePath = function (x, y, w, h, relative, path) {\n\n        var halfW = w * 0.5;\n        var halfH = h * 0.5;\n\n        path.push(relative ? 'm' : 'M');\n        path.push(x);\n        path.push(y);\n\n        createArcTo(w, 0, halfW, halfH, true, path);\n        createArcTo(-w, 0, halfW, halfH, true, path);\n\n        path.push('z');\n    };\n\n    export var createRectanglePath = function (x, y, w, h, relative, path) {\n\n        path.push(relative ? 'm' : 'M');\n        path.push(x);\n        path.push(y);\n        path.push('l');\n        path.push(w);\n        path.push(0);\n        path.push('l');\n        path.push(0);\n        path.push(h);\n        path.push('l');\n        path.push(-w);\n        path.push(0);\n        path.push('z');\n    };\n\n    export var renderToCanvas = function(svg, viewBox, width, height, ctx, callback) {\n\n        const svgMarkup = svg.outerHTML;\n\n        // Apply y-invert due to markups being defined in the LMV coordinate system. CSS is used here due to\n        // poor Safari support: https://bugs.webkit.org/show_bug.cgi?id=201854\n        const style = 'transform: scale(1, -1); transform-origin: center center';\n\n        // Creating a new svg element, that will be drawn into the canvas.\n        const tmpSvg = `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"${viewBox}\" style=\"${style}\">\n          ${svgMarkup}\n        </svg>\n        `;\n\n        const blob = new Blob([tmpSvg], { type: 'image/svg+xml' });\n        const url = URL.createObjectURL(blob);\n\n        const img = new Image();\n\n        img.onload = function() {\n            ctx.drawImage(img, 0, 0);\n            callback();\n        };\n\n        img.src = url;\n    };\n\n    /*\n     Taken from Simplify.js, a high-performance JS polyline simplification library\n     (c) 2013, Vladimir Agafonkin\n     mourner.github.io/simplify-js\n    */\n   export var simplify = function(points, tolerance, highestQuality) {\n\n        if (points.length <= 2) return points;\n\n        // square distance between 2 points\n        function getSqDist(p1, p2) {\n\n            var dx = p1.x - p2.x,\n                dy = p1.y - p2.y;\n\n            return dx * dx + dy * dy;\n        }\n\n        // square distance from a point to a segment\n        function getSqSegDist(p, p1, p2) {\n\n            var x = p1.x,\n                y = p1.y,\n                dx = p2.x - x,\n                dy = p2.y - y;\n\n            if (dx !== 0 || dy !== 0) {\n\n                var t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\n\n                if (t > 1) {\n                    x = p2.x;\n                    y = p2.y;\n\n                } else if (t > 0) {\n                    x += dx * t;\n                    y += dy * t;\n                }\n            }\n\n            dx = p.x - x;\n            dy = p.y - y;\n\n            return dx * dx + dy * dy;\n        }\n        // rest of the code doesn't care about point format\n\n        // basic distance-based simplification\n        function simplifyRadialDist(points, sqTolerance) {\n\n            var prevPoint = points[0],\n                newPoints = [prevPoint],\n                point;\n\n            for (var i = 1, len = points.length; i < len; i++) {\n                point = points[i];\n\n                if (getSqDist(point, prevPoint) > sqTolerance) {\n                    newPoints.push(point);\n                    prevPoint = point;\n                }\n            }\n\n            if (prevPoint !== point) newPoints.push(point);\n\n            return newPoints;\n        }\n\n        function simplifyDPStep(points, first, last, sqTolerance, simplified) {\n            var maxSqDist = sqTolerance,\n                index;\n\n            for (var i = first + 1; i < last; i++) {\n                var sqDist = getSqSegDist(points[i], points[first], points[last]);\n\n                if (sqDist > maxSqDist) {\n                    index = i;\n                    maxSqDist = sqDist;\n                }\n            }\n\n            if (maxSqDist > sqTolerance) {\n                if (index - first > 1) simplifyDPStep(points, first, index, sqTolerance, simplified);\n                simplified.push(points[index]);\n                if (last - index > 1) simplifyDPStep(points, index, last, sqTolerance, simplified);\n            }\n        }\n\n        // simplification using Ramer-Douglas-Peucker algorithm\n        function simplifyDouglasPeucker(points, sqTolerance) {\n            var last = points.length - 1;\n\n            var simplified = [points[0]];\n            simplifyDPStep(points, 0, last, sqTolerance, simplified);\n            simplified.push(points[last]);\n\n            return simplified;\n        }\n\n        // both algorithms combined for awesome performance\n        var sqTolerance = tolerance !== undefined ? tolerance * tolerance : 1;\n\n        points = highestQuality ? points : simplifyRadialDist(points, sqTolerance);\n        points = simplifyDouglasPeucker(points, sqTolerance);\n\n        return points;\n    };\n\n","'use strict';\n\n    /**\n     * This class will group actions edit actions that should be executed as a whole.\n     * When a group is open actions can be added to it, similar actions will be merged into one during this process.\n     * This class is not intended to be used by users, it's a helper class of EditActionManager.\n     * @constructor\n     */\n    export function EditActionGroup() {\n\n        this.actions = [];\n        this.closed = true;\n    }\n\n    var proto = EditActionGroup.prototype;\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.open = function() {\n\n        if(!this.closed) {\n            return false;\n        }\n\n        this.closed = false;\n        return true;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.close = function() {\n\n        if (this.closed) {\n            return false;\n        }\n\n        this.closed = true;\n        return true;\n    };\n\n    /**\n     *\n     * @returns {number} targetId\n     */\n    proto.undo = function() {\n\n        var actions = this.actions;\n        var actionsMaxIndex = actions.length - 1;\n\n        var targetId = -1;\n        for(var i = actionsMaxIndex; i >= 0; --i) {\n\n            var action =  actions[i];\n            action.undo();\n\n            if (action.targetId !== -1) {\n                targetId = action.targetId;\n            }\n        }\n\n        return targetId;\n    };\n\n    /**\n     *\n     * @returns {number} targetId\n     */\n    proto.redo = function() {\n\n        var actions = this.actions;\n        var actionsCount = actions.length;\n\n        var targetId = -1;\n        for(var i = 0; i < actionsCount; ++i) {\n\n            var action =  actions[i];\n            action.redo();\n\n            if (action.targetId !== -1) {\n                targetId = action.targetId;\n            }\n        }\n\n        return targetId;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.isOpen = function() {\n\n        return !this.closed;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.isClosed = function() {\n\n        return this.closed;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.isEmpty = function() {\n\n        return this.actions.length === 0;\n    };\n\n    /**\n     *\n     * @param {EditAction} action\n     */\n    proto.addAction = function(action) {\n\n        if (this.closed) {\n            return false;\n        }\n\n        this.actions.push(action);\n        this.compact();\n\n        return true;\n    };\n\n    /**\n     * @private\n     */\n    proto.compact = function() {\n\n        var actions = this.actions;\n        var actionsCount = actions.length;\n\n        for(var i = 0; i < actionsCount; ++i) {\n\n            // If an action does nothing, remove it.\n            var actionA = actions[i];\n            if (actionA.isIdentity()) {\n                actions.splice(i, 1);\n                --actionsCount;\n                --i;\n                continue;\n            }\n\n            // If an action can be merged, merge it.\n            for (var j = i + 1; j < actionsCount; ++j) {\n\n                var actionB = actions[j];\n                if (actionA.type === actionB.type &&\n                    actionA.merge(actionB)) {\n                    actions.splice(j, 1);\n                    --actionsCount;\n                    --i;\n                    break;\n                }\n            }\n        }\n    };\n\n    proto.getTargetId = function() {\n      var actions = this.actions;\n      var actionsCount = actions.length;\n      var targetId = -1;\n      for(var i = 0; i < actionsCount; ++i) {\n        var action =  actions[i];\n        if (action.targetId !== -1) {\n          targetId = action.targetId;\n        }\n      }\n      return targetId;\n    };","'use strict';\n\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils';\nimport * as MarkupEvents from '../MarkupEvents';\nimport { EditActionGroup } from './EditActionGroup';\n\n    /**\n     *\n     * @param historySize\n     * @constructor\n     */\n    export function EditActionManager(historySize) {\n\n        this.historySize = historySize;\n\n        this.undoStack = [];\n        this.redoStack = [];\n\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = EditActionManager.prototype;\n\n    /**\n     *\n     * @param action\n     */\n    proto.execute = function(action) {\n\n        var redoStack = this.redoStack;\n        var undoStack = this.undoStack;\n\n        redoStack.splice(0, redoStack.length);\n\n        action.redo();\n\n        var group = this.getEditActionGroup();\n        if (group.isOpen()) {\n            group.addAction(action);\n        } else {\n            group.open();\n            group.addAction(action);\n            group.close();\n        }\n\n        if (undoStack.length > this.historySize) {\n            undoStack.splice(0,1);\n        }\n\n        var targetId = action.selectOnExecution ? action.targetId : -1;\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'execute', targetId: targetId}});\n    };\n\n    proto.beginActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n        var group = null;\n\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\n\n            group = this.getEditActionGroup();\n            group.open();\n        } else {\n            console.warn('Markups - Undo/Redo - Action edit group already open.');\n        }\n    };\n\n    proto.closeActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n\n        if (undoStackCount === 0) {\n\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\n            return;\n        }\n\n        var group = undoStack[undoStackCount-1];\n        if(!group.close()) {\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\n        }\n\n        if (group.isEmpty()) {\n            undoStack.pop();\n        }\n    };\n\n    proto.cancelActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n\n        if (undoStackCount === 0) {\n\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\n            return;\n        }\n\n        var group = undoStack[undoStackCount-1];\n        if(!group.close()) {\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\n            return;\n        }\n\n        group.undo();\n        undoStack.pop();\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'cancel', targetId: -1}});\n    };\n\n    proto.undo = function() {\n\n        var undoStack = this.undoStack;\n        var redoStack = this.redoStack;\n\n        if (undoStack.length === 0) {\n            return;\n        }\n\n        var group = undoStack.pop();\n        var targetId = group.undo();\n\n        redoStack.push(group);\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'undo', targetId: targetId}});\n    };\n\n    proto.redo = function() {\n\n        var undoStack = this.undoStack;\n        var redoStack = this.redoStack;\n\n        if (redoStack.length === 0) {\n            return;\n        }\n\n        var group = redoStack.pop();\n        var targetId = group.redo();\n\n        undoStack.push(group);\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'redo', targetId: targetId}});\n    };\n\n    proto.clear = function() {\n\n        this.undoStack.splice(0, this.undoStack.length);\n        this.redoStack.splice(0, this.redoStack.length);\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'clear', targetId: -1}});\n    };\n\n    proto.isUndoStackEmpty = function() {\n\n        return this.undoStack.length === 0;\n    };\n\n    proto.isRedoStackEmpty = function() {\n\n        return this.redoStack.length === 0;\n    };\n\n    proto.getLastElementInUndoStack = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n        return undoStack[undoStackCount-1];\n    };\n\n    /**\n     *\n     * @return action\n     * @private\n     */\n    proto.getEditActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = this.undoStack.length;\n\n        var group = null;\n\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\n            group = new EditActionGroup();\n            undoStack.push(group);\n        } else {\n            group = undoStack[undoStackCount-1];\n        }\n\n        return group;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param markup\n     * @param position\n     * @constructor\n     */\n    export function CloneMarkup(editor, id, markup, position) {\n\n        EditAction.call(this, editor, 'CLONE-MARKUP', id);\n\n        this.clone = markup.clone();\n        this.clone.id = id;\n        this.position = {x: position.x, y: position.y};\n    }\n\n    CloneMarkup.prototype = Object.create(EditAction.prototype);\n    CloneMarkup.prototype.constructor = CloneMarkup;\n\n    var proto = CloneMarkup.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var clone = this.clone;\n        var position = this.position;\n\n        if (editor.getMarkup(this.targetId)) {\n            return;\n        }\n\n        var markup = clone.clone();\n        markup.setPosition(position.x, position.y);\n\n        editor.addMarkup(markup);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n\n","'use strict';\n\nimport { CloneMarkup } from '../edit-actions/CloneMarkup';\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils';\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function Clipboard(editor) {\n\n        this.editor = editor;\n        this.content = null;\n        this.pastePosition = {x:0, y: 0};\n\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = Clipboard.prototype;\n\n    proto.copy = function() {\n\n        var selectedMarkup = this.editor.getSelection();\n        if(!selectedMarkup) {\n            return;\n        }\n\n        this.content = selectedMarkup.clone();\n        this.pastePosition.x = selectedMarkup.position.x;\n        this.pastePosition.y = selectedMarkup.position.y;\n    };\n\n    proto.cut = function() {\n\n        var selectedMarkup = this.editor.getSelection();\n        if(!selectedMarkup) {\n            return;\n        }\n\n        this.copy();\n        this.editor.deleteMarkup(selectedMarkup);\n    };\n\n    proto.paste = function() {\n\n        var content = this.content;\n        if(!content) {\n            return;\n        }\n\n        var editor = this.editor;\n        var position = this.pastePosition;\n        var delta = editor.sizeFromClientToMarkups(20, 20);\n\n        position.x += delta.x;\n        position.y -= delta.y;\n\n        var cloneMarkup = new CloneMarkup(editor, editor.getId(), content, position);\n        cloneMarkup.execute();\n    };\n","'use strict';\n\nimport { isTouchDevice } from '../MarkupsCoreUtils';\n\n    var av = Autodesk.Viewing;\n    var avp = av.Private;\n\n    var _mouseEnabled = false;\n    var _mousePrevValue = false;\n    var _lock = false;\n\n    export function InputHandler() {\n\n        this.editor = null;\n        this.mousePosition = {x:0, y:0};\n        this.makeSameXY = false; // TODO: FIND a better way to name and communicate these.\n        this.snapRotations = false;\n        this.keepAspectRatio = false;\n        this.constrainAxis = false;\n        this.duringEditMode = false;\n\n        this.onWheelBinded = this.onWheel.bind(this);\n        this.onTouchDragBinded = this.onTouchDrag.bind(this);\n        this.onTouchPanBinded = this.onTouchPan.bind(this);\n        this.onTouchPinchBinded = this.onTouchPinch.bind(this);\n        this.onSingleTapBinded = this.onSingleTap.bind(this);\n        this.onDoubleTapBinded = this.onDoubleTap.bind(this);\n        this.onMouseMoveBinded = this.onMouseMove.bind(this);\n        this.onMouseUpBinded = this.onMouseUp.bind(this);\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\n        this.onMouseDoubleClickBinded = this.onMouseDoubleClick.bind(this);\n        this.onHammerInputBinded = this.onHammerInput.bind(this);\n        this.isMouseDown = false;\n    }\n\n    av.GlobalManagerMixin.call(InputHandler.prototype);\n    var proto = InputHandler.prototype;\n\n    proto.attachTo = function(editor) {\n\n        this.editor && this.detachFrom(this.editor);\n        this.editor = editor;\n\n        if (isTouchDevice()) {\n\n            this.hammer = new av.Hammer.Manager(editor.svg, {\n                recognizers: [\n                    av.GestureRecognizers.drag,\n                    av.GestureRecognizers.doubletap,\n                    av.GestureRecognizers.doubletap2,\n                    av.GestureRecognizers.singletap,\n                    av.GestureRecognizers.singletap2,\n                    av.GestureRecognizers.press,\n                    av.GestureRecognizers.pan,\n                    av.GestureRecognizers.pinch\n                ],\n                handlePointerEventMouse: false,\n                inputClass: av.Hammer.TouchInput\n            });\n\n            this.hammer.get('doubletap2').recognizeWith('doubletap');\n            this.hammer.get('singletap2').recognizeWith('singletap');\n            this.hammer.get('singletap').requireFailure('doubletap');\n        }\n    };\n\n    proto.onHammerInput = function(event) {\n\n        this.setMouseDisabledWhenTouching(event);\n    };\n\n    proto.setMouseDisabledWhenTouching = function(event) {\n\n        if (event.isFirst && !_lock) {\n            this.enableMouseButtons(false);\n            _lock = true;\n        } else if (event.isFinal) {\n            var _this = this;\n            setTimeout(function() {\n                _this.enableMouseButtons(_mousePrevValue);\n                _lock = false;\n            }, 10);\n        }\n    };\n\n    proto.enableMouseButtons = function(state) {\n\n        if (state && !_mouseEnabled)\n        {\n            this.editor.svg.addEventListener('mousedown', this.onMouseDownBinded);\n            this.editor.svg.addEventListener('dblclick', this.onMouseDoubleClickBinded);\n            this.editor.svg.addEventListener('wheel', this.onWheelBinded);\n            this.editor.svg.addEventListener('DOMMouseScroll', this.onWheelBinded); // Firefox\n\n            // The mouseup and mousemove listeners are at the document level to handle the case where\n            // mouse was held inside the canvas and released outside.\n            // When this happens, we don't want the editing to be in a hung state and cancel it\n            this.addDocumentEventListener('mousemove', this.onMouseMoveBinded);\n            this.addDocumentEventListener('mouseup', this.onMouseUpBinded);\n        }\n        else if (!state && _mouseEnabled)\n        {\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\n            this.editor.svg.removeEventListener('wheel', this.onWheelBinded);\n            this.editor.svg.removeEventListener('DOMMouseScroll', this.onWheelBinded);\n            this.removeDocumentEventListener('mousemove', this.onMouseMoveBinded);\n            this.removeDocumentEventListener('mouseup', this.onMouseUpBinded);\n\n        }\n\n        _mousePrevValue = _mouseEnabled;\n        _mouseEnabled = state;\n    };\n\n    proto.detachFrom = function(editor) {\n\n        this.hammer && this.hammer.destroy();\n\n        this.removeDocumentEventListener('mousemove', this.onMouseMoveBinded);\n        this.removeDocumentEventListener('mouseup', this.onMouseUpBinded);\n\n        if (this.editor) {\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\n        }\n\n        this.editor = editor;\n    };\n\n    proto.enterEditMode = function() {\n        if (this.duringEditMode) {\n            return;\n        }\n\n        if (this.hammer) {\n            this.hammer.on('dragstart dragmove dragend', this.onTouchDragBinded);\n            this.hammer.on('panstart panmove panend', this.onTouchPanBinded);\n            this.hammer.on('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\n            this.hammer.on('singletap', this.onSingleTapBinded);\n            this.hammer.on('singletap2', this.onSingleTapBinded);\n            this.hammer.on('doubletap', this.onDoubleTapBinded);\n            this.hammer.on('doubletap2', this.onDoubleTapBinded);\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\n\n            this.hammer.get('drag').requireFailure('pinch');\n            this.hammer.get('drag').requireFailure('pan');\n        }\n\n        if (!av.isMobileDevice()) {\n            this.enableMouseButtons(true);\n        }\n\n        this.duringEditMode = true;\n    };\n\n    proto.leaveEditMode = function() {\n        if (!this.duringEditMode) {\n            return;\n        }\n\n        if (this.hammer) {\n            this.hammer.off('dragstart dragmove dragend', this.onTouchDragBinded);\n            this.hammer.off('panstart panmove panend', this.onTouchPanBinded);\n            this.hammer.off('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\n            this.hammer.off('singletap', this.onSingleTapBinded);\n            this.hammer.off('singletap2', this.onSingleTapBinded);\n            this.hammer.off('doubletap', this.onDoubleTapBinded);\n            this.hammer.off('doubletap2', this.onDoubleTapBinded);\n            this.hammer.off('hammer.input', this.onHammerInputBinded);\n        }\n\n        if (!av.isMobileDevice()) {\n            this.enableMouseButtons(false);\n        }\n\n        this.duringEditMode = false;\n    };\n\n    proto.enterViewMode = function() {\n\n    };\n\n    proto.leaveViewMode = function() {\n\n    };\n\n    proto.getMousePosition = function() {\n\n        return {x: this.mousePosition.x, y: this.mousePosition.y};\n    };\n\n    proto.onWheel = function(event) {\n\n        if (!av.isMobileDevice()) {\n            this.editor.viewer.toolController.mousewheel(event);\n        }\n\n        event.preventDefault();\n    };\n\n    proto.onMouseMove = function(event) {\n\n        processMouseEvent(this, event);\n\n        if (!av.isMobileDevice() && this.editor.viewer.container.contains(event.target)) {\n            this.editor.viewer.toolController.mousemove(event);\n        }\n\n        if (this.editor.onMouseMove(event)) {\n            // editor handled the event\n            event.preventDefault();\n        }\n    };\n\n\n    proto.onMouseDownRightClick = function(event) {\n\n        const _document = this.getDocument();\n        _document.activeElement && _document.activeElement.blur && _document.activeElement.blur();\n\n        var controller = this.editor.viewer.toolController;\n        controller.__clientToCanvasCoords(event);\n\n        this.editor.markupTool.handleButtonDown(event, 2);\n    };\n\n    proto.onMouseUpRightClick = function(event) {\n\n        var controller = this.editor.viewer.toolController;\n        controller.__clientToCanvasCoords(event);\n\n        this.editor.markupTool.handleButtonUp(event, 2);\n    };\n\n    proto.onMouseDown = function(event) {\n\n        processMouseEvent(this, event);\n\n        // Panning when right clicking\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\n            this.onMouseDownRightClick(event);\n            return;\n        }\n\n        this.isMouseDown = true;\n        this.editor.onMouseDown(event);\n        event.preventDefault();\n    };\n\n    proto.onMouseUp = function(event) {\n\n        processMouseEvent(this, event);\n\n        if (!av.isMobileDevice() && this.editor.viewer.container.contains(event.target) &&\n             (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))\n           ) {\n            this.onMouseUpRightClick(event);\n            return;\n        }\n\n        this.isMouseDown = false;\n        if (this.editor.onMouseUp(event)) {\n            // editor handled the event\n            event.preventDefault();\n        }\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        processMouseEvent(this, event);\n        this.editor.onMouseDoubleClick(event);\n        event.preventDefault();\n    };\n\n    proto.onTouchDrag = function(event) {\n\n        convertEventHammerToMouse(event);\n        switch (event.type) {\n          case 'dragstart':\n                this.onMouseDown(event);\n                break;\n            case 'dragmove':\n                this.onMouseMove(event);\n                break;\n           case 'dragend':\n                this.onMouseUp(event);\n                break;\n        }\n        event.preventDefault();\n    };\n\n    proto.onTouchPan = function(event) {\n\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        event.preventDefault();\n    };\n\n    proto.onTouchPinch = function(event) {\n\n        processMouseEvent(this, event);\n\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n\n        this.mousePosition.x = this.mousePosition.y = null;\n        this.editor.callSnapperMouseMove();\n\n        event.preventDefault();\n    };\n\n    proto.onSingleTap = function(event) {\n\n        convertEventHammerToMouse(event);\n\n        this.onMouseDown(event);\n        this.onMouseUp(event);\n        event.preventDefault();\n    };\n\n    proto.onDoubleTap = function(event) {\n\n        convertEventHammerToMouse(event);\n        this.onMouseDoubleClick(event);\n        event.preventDefault();\n    };\n\n    function processMouseEvent(input, event) {\n\n        var rect = input.editor.svg.getBoundingClientRect();\n\n        input.makeSameXY = event.shiftKey;\n        input.snapRotations = event.shiftKey;\n        input.keepAspectRatio = event.shiftKey;\n        input.constrainAxis = event.shiftKey;\n\n        input.mousePosition.x = event.clientX - rect.left;\n        input.mousePosition.y = event.clientY - rect.top;\n    }\n\n    function convertEventHammerToMouse(event) {\n\n        // Convert Hammer touch-event X,Y into mouse-event X,Y.\n        event.shiftKey = false;\n        event.clientX = event.pointers[0].clientX;\n        event.clientY = event.pointers[0].clientY;\n    }\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    export function SetPosition(editor, markup, position) {\n\n        EditAction.call(this, editor, 'SET-POSITION', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n    }\n\n    SetPosition.prototype = Object.create(EditAction.prototype);\n    SetPosition.prototype.constructor = SetPosition;\n\n    var proto = SetPosition.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setPosition(this.newPosition.x, this.newPosition.y);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setPosition(this.oldPosition.x, this.oldPosition.y);\n    };\n\n    /**\n     *\n     * @param action\n     * @returns {boolean}\n     */\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        var newPosition = this.newPosition;\n        var oldPosition = this.oldPosition;\n\n        return newPosition.x === oldPosition.x && newPosition.y === oldPosition.y;\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction';\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param angle\n     * @constructor\n     */\n    export function SetRotation(editor, markup, angle) {\n\n        EditAction.call(this, editor, 'SET-ROTATION', markup.id);\n\n        var curAngle = markup.getRotation();\n\n        this.newRotation = {angle: angle};\n        this.oldRotation = {angle: curAngle};\n    }\n\n    SetRotation.prototype = Object.create(EditAction.prototype);\n    SetRotation.prototype.constructor = SetRotation;\n\n    var proto = SetRotation.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setRotation(this.newRotation.angle);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setRotation(this.oldRotation.angle);\n    };\n\n    /**\n     *\n     * @param action\n     * @returns {boolean}\n     */\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newRotation = action.newRotation;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return this.newRotation.angle === this.oldRotation.angle;\n    };\n\n","'use strict';\n\nimport { EDIT_FRAME_DEFAULT_MARGIN,\n         addTraitEventDispatcher, isTouchDevice, degreesToRadians } from './MarkupsCoreUtils';\nimport * as MarkupEvents from './MarkupEvents';\nimport { CloneMarkup } from './edit-actions/CloneMarkup';\nimport { SetPosition } from './edit-actions/SetPosition';\nimport { SetSize } from './edit-actions/SetSize';\nimport { SetRotation } from './edit-actions/SetRotation';\n\n     var av = Autodesk.Viewing;\n     var avp = Autodesk.Viewing.Private;\n\n    /**\n     * A component to handle the selection of markups.\n     *\n     *\n     *      Sample\n     *\n     *      var containingDiv = document.getElementById('containingDiv3d-app-wrapper');\n     *      var selectionComponent = new EditFrame(containingDiv);\n     *      selectionComponent.setSelection(100, 100, 300, 150, 0);\n     *\n     * @param {HTMLElement} containingDiv The container where the selection layer will live.\n     * @param {Object} editor\n     * @constructor\n     */\n    export function EditFrame(containingDiv, editor) {\n\n        this.containingDiv = containingDiv;\n        this.editor = editor;\n        this.setGlobalManager(this.editor.viewer.globalManager);\n        this.selectionLayer = createSelectionLayer.bind(this)();\n\n        this.frameMargin = EDIT_FRAME_DEFAULT_MARGIN;\n\n        this.selection = {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            rotation: 0,\n            element: null,\n            active: false,\n            dragging: false,\n            resizing: false,\n            //a dictionary of all the drag points\n            //the key for each drag point will be its cardinal/ordinal direction\n            handle: {}\n        };\n\n        createSelectorBox.bind(this)();\n\n        if (isTouchDevice()) {\n            this.hammer = new av.Hammer.Manager(this.selectionLayer, {\n                recognizers: [\n                    av.GestureRecognizers.drag,\n                    av.GestureRecognizers.doubletap,\n                    av.GestureRecognizers.doubletap2,\n                    av.GestureRecognizers.pan,\n                    av.GestureRecognizers.pinch\n                ],\n                handlePointerEventMouse: false,\n                inputClass: av.Hammer.TouchInput\n            });\n\n            this.onHammerDragBinded = this.onHammerDrag.bind(this);\n            this.onHammerDoubleTapBinded = this.onHammerDoubleTap.bind(this);\n            this.onTouchPanBinded = this.onTouchPan.bind(this);\n            this.onTouchPinchBinded = this.onTouchPinch.bind(this);\n\n            this.hammer.on(\"dragstart dragmove dragend\", this.onHammerDragBinded);\n            this.hammer.on(\"doubletap\", this.onHammerDoubleTapBinded);\n            this.hammer.on(\"doubletap2\", this.onHammerDoubleTapBinded);\n            this.hammer.on(\"panstart panmove panend\", this.onTouchPanBinded);\n            this.hammer.on(\"pinchstart pinchmove pinchend\", this.onTouchPinchBinded);\n\n            this.hammer.get('drag').requireFailure('pinch');\n            this.hammer.get('drag').requireFailure('pan');\n        }\n\n        handleSelectionBoxDragging.bind(this)();\n        handleSelectionBoxResizing.bind(this)();\n        handleSelectionDoubleClick.bind(this)();\n        handleSelectionBoxRotating.bind(this)();\n\n        //add the selection into the container given to us\n        this.containingDiv.appendChild(this.selectionLayer);\n\n        addTraitEventDispatcher(this);\n    }\n\n    av.GlobalManagerMixin.call(EditFrame.prototype);\n    var proto = EditFrame.prototype;\n\n    proto.unload = function() {\n\n        this.containingDiv.removeChild(this.selectionLayer);\n        this.selectionLayer = null;\n    };\n    /**\n     * Draws a selection box with the given attributes\n     *\n     * @param {number} x - The x coordinate to place the selection box\n     * @param {number} y - The y coordinate to place the selection box\n     * @param {number} width - The width of the selection box\n     * @param {number} height - The height of the selection box\n     * @param {number} rotation - The amount of degrees to rotate the selection box\n     */\n    proto.setSelection = function (x, y, width, height, rotation) {\n\n        var margin = this.frameMargin;\n        var doubleMargin = margin * 2;\n\n        updateSelectorBoxDimensions.bind(this)(width + doubleMargin, height + doubleMargin);\n        updateSelectorBoxPosition.bind(this)(x - margin, y - margin, rotation);\n        updateSelectionBoxState.bind(this)(true); //activate the selection box\n        this.selectionLayer.style.visibility = 'visible';\n    };\n\n    /**\n     * Displays the selection box based on the position, dimension, and rotation of a given markup\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - the markup that should appear as selected\n     */\n    proto.setMarkup = function (markup) {\n\n        this.hammer && this.hammer.set({enable: markup !== null});\n        this.markup = markup;\n\n        updateSelectionBoxState.bind(this)(false);\n\n        if (markup) {\n            var boundingBox = markup.getBoundingRect();\n            var rotation = markup.getRotation();\n            this.frameMargin = boundingBox.margin !== undefined ? boundingBox.margin : EDIT_FRAME_DEFAULT_MARGIN;\n\n            this.setSelection(boundingBox.x, boundingBox.y, boundingBox.width, boundingBox.height, rotation);\n\n            this.enableResizeHandles();\n            this.enableRotationHandle();\n\n            if (markup.preventReposition) {\n                this.selectionLayer.firstChild.style.cursor = '';\n            }\n            else {\n                this.selectionLayer.firstChild.style.cursor = 'move';\n            }\n        }\n    };\n\n    proto.startDrag = function (event) {\n\n        if (this.markup && this.markup.preventReposition) return;\n\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\n        this._onRepositionMouseDown(event, this.editor.getMousePosition());\n    };\n\n     proto.isActive = function() {\n        return this.selection.active;\n     };\n\n    proto.isDragging = function () {\n\n        return this.selection.dragging;\n    };\n\n    proto.isResizing = function () {\n\n        return this.selection.resizing;\n    };\n\n    proto.isRotating = function () {\n\n        return this.selection.rotating;\n    };\n\n    proto.onMouseMove = function (event) {\n\n        //dummy fn\n    };\n\n    proto.onMouseUp = function (event) {\n        //dummy fn\n    };\n\n    proto.onWheel = function (event) {\n        this.editor.viewer.toolController.mousewheel(event);\n    };\n\n    proto.onTouchPan = function(event) {\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        event.preventDefault();\n    };\n\n    proto.onTouchPinch = function(event) {\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        event.preventDefault();\n    };\n\n     proto.onHammerDrag = function(event) {\n\n         function updateEditorInput(input, parent, event) {\n\n             //TODO: Change this when refactoring input in edit frame.\n             var rect = parent.getBoundingClientRect();\n             input.mousePosition.x = event.pageX - rect.left;\n             input.mousePosition.y = event.pageY - rect.top;\n         }\n\n        //console.log('EditFrame drag ' + event.type);\n         convertEventHammerToMouse(event);\n         switch (event.type) {\n             case 'dragstart':\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\n                 this.editor.callSnapperMouseDown();\n                 // Check whether to translate, rotate or resize\n                 if (isRotatePoint(event.target)) {\n                     // Rotate\n                     this._onRotationMouseDown(event);\n                 } else if (isDragPoint(event.target)) {\n                     // Resize\n                     this._onResizeMouseDown(event);\n                 } else {\n                     this.startDrag(event);\n                 }\n                 event.preventDefault();\n                 break;\n             case 'dragmove':\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\n                 this.editor.callSnapperMouseMove();\n                 this.onMouseMove(event);\n                 event.preventDefault();\n                 break;\n             case 'dragend':\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\n                 this.onMouseUp(event);\n                 event.preventDefault();\n                 break;\n         }\n     };\n\n    proto.onHammerDoubleTap = function(event) {\n\n        function updateEditorInput(input, parent, event) {\n\n            //TODO: Change this when refactoring input in edit frame.\n            var rect = parent.getBoundingClientRect();\n            input.mousePosition.x = event.pageX - rect.left;\n            input.mousePosition.y = event.pageY - rect.top;\n        }\n\n        convertEventHammerToMouse(event);\n        updateEditorInput(this.editor.input, this.editor.svg, event);\n\n        this.selection.dragging = false;\n        this.editor.editMode && this.editor.editMode.onMouseDoubleClick(this.markup);\n    };\n\n    proto.enableResizeHandles = function () {\n\n        var markup = this.markup;\n        var handle;\n\n        if (markup.isHeightConstrained() || markup.isWidthConstrained()) {\n            //hide all the handles\n            for (var direction in this.selection.handle) {\n                handle = this.selection.handle[direction];\n                if(handle) handle.style.display = 'none';\n            }\n\n            //show only the resize points that are allowed\n            if (!markup.isHeightConstrained()) {\n                this.selection.handle['n'].style.display = 'block';\n                this.selection.handle['s'].style.display = 'block';\n            }\n            if (!markup.isWidthConstrained()) {\n                this.selection.handle['w'].style.display = 'block';\n                this.selection.handle['e'].style.display = 'block';\n            }\n        } else {\n            //no constraints, show all resize handles\n            for (let direction in this.selection.handle) {\n                handle = this.selection.handle[direction];\n                if(handle) handle.style.display = 'block';\n            }\n        }\n    };\n\n    proto.enableRotationHandle = function () {\n\n        var markup = this.markup;\n        var display = markup.isRotationConstrained() ? 'none' : 'block';\n        this.selection.rotationHandle.style.display = display;\n        this.selection.rotationBridge.style.display = display;\n    };\n\n     function convertEventHammerToMouse(event) {\n         // Convert Hammer touch-event X,Y into mouse-event X,Y.\n         event.pageX = event.pointers[0].clientX;\n         event.pageY = event.pointers[0].clientY;\n     }\n\n    /**\n     * Creates an element spanning the full height and width of its parent.\n     * It serves as our surface to draw the selection box.\n     *\n     * @return {HTMLElement}\n     */\n    function createSelectionLayer() {\n\n        const _document = this.getDocument();\n        var selectionLayer = _document.createElement('div');\n        selectionLayer.style.position = 'absolute';\n        selectionLayer.style.top = 0;\n        selectionLayer.style.bottom = 0;\n        selectionLayer.style.left = 0;\n        selectionLayer.style.right = 0;\n        //don't let the selection box be visible outside the selection layer\n        selectionLayer.style.overflow = 'hidden';\n        selectionLayer.style.visibility = 'hidden';\n        togglePointerEvents(selectionLayer, false);\n        return selectionLayer;\n    }\n\n    /**\n     * Creates a single drag point with the corresponding styles\n     *\n     * @param {number} diameter - The size of the drag point\n     * @param {string} position - The cardinal(n, s, w, e) or ordinal(nw, nw, sw, se) direction of the point\n     * @return {HTMLElement}\n     */\n    function createDragPoint(position) {\n\n        const _document = this.getDocument();\n        var point = _document.createElement('div');\n\n        setResizeCursor(point, position);\n        point.className = 'selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-' + position;\n        point.classList.add('adsk-viewing-viewer');\n        point.setAttribute('data-sdp-handle', position);\n\n        return point;\n    }\n\n    function createRotatePoint () {\n        const _document = this.getDocument();\n        var point = _document.createElement('div');\n        point.classList.add('adsk-viewing-viewer');\n        point.classList.add('selector-rotate-point');\n        point.classList.add('autodesk-markups-extension-core-make-me-bigger');\n        setResizeCursor(point, 'w');\n\n        return point;\n    }\n\n    function createRotationBridge() {\n        const _document = this.getDocument();\n        var rotationBridge = _document.createElement('div');\n        rotationBridge.classList.add('adsk-viewing-viewer');\n        rotationBridge.classList.add('selector-rotate-point');\n        rotationBridge.classList.add('autodesk-markups-extension-core-make-me-bigger');\n        rotationBridge.classList.add('rotation-bridge');\n        setResizeCursor(rotationBridge, 'w');\n\n        return rotationBridge;\n    }\n\n    function setResizeCursor (element, direction) {\n\n        var cursor;\n        switch(direction) {\n            case 'n':\n            case 's':\n                cursor = 'ns-resize';\n                break;\n            case 'w':\n            case 'e':\n                cursor = 'ew-resize';\n                break;\n            case 'ne':\n            case 'sw':\n                cursor = 'nesw-resize';\n                break;\n            case 'nw':\n            case 'se':\n                cursor = 'nwse-resize';\n                break;\n        }\n        element.style.cursor = cursor;\n    }\n\n    /**\n     * Creates the 8 drag points of the selection box.\n     *\n     * @this EditFrame\n     */\n    function createDragPoints(selector) {\n\n        ['n', 's', 'w', 'e', 'nw', 'ne', 'sw', 'se'].forEach(function (direction) {\n            //store the drag point and put it in the DOM\n            this.selection.handle[direction] = createDragPoint.call(this, direction);\n            selector.appendChild(this.selection.handle[direction]);\n        }.bind(this));\n    }\n\n    /**\n     * Determines if an element is a drag point\n     *\n     * @return {boolean}\n     */\n    function isDragPoint(element) {\n\n        return matchesSelectorAux(element, '.selector-drag-point');\n    }\n\n    /**\n     * Determines if an element is a rotate point\n     *\n     * @return {boolean}\n     */\n    function isRotatePoint(element) {\n\n        return matchesSelectorAux(element, '.selector-rotate-point');\n    }\n\n    /**\n     * Creates the element that will be used as the selection box. It also\n     * takes care of adding the drag handles\n     *\n     * @return {HTMLElement} - the selection box\n     * @this EditFrame\n     */\n    function createSelectorBox() {\n\n        const _document = this.getDocument();\n        var selectorBox = _document.createElement('div');\n        togglePointerEvents(selectorBox, true);\n        selectorBox.classList.add('selector-box');\n\n        this.selection.rotationBridge = createRotationBridge.bind(this)();\n        selectorBox.appendChild(this.selection.rotationBridge);\n\n        this.selection.rotationHandle = createRotatePoint.bind(this)();\n        selectorBox.appendChild(this.selection.rotationHandle);\n\n        createDragPoints.bind(this)(selectorBox);\n\n        //store the selector box\n        this.selection.element = selectorBox;\n\n        if (!av.isMobileDevice()) {\n            this.onWheelBinded = this.onWheel.bind(this);\n            this.selection.element.addEventListener('wheel', this.onWheelBinded);\n            this.selection.element.addEventListener('DOMMouseScroll', this.onWheelBinded); // firefox\n        }\n\n        //add the selection box to the selection layer\n        this.selectionLayer.appendChild(this.selection.element);\n\n        //we are just creating the box, start it out hidden\n        updateSelectionBoxState.bind(this)(false);\n\n        return selectorBox;\n    }\n\n    /**\n     * Utility to create the CSS translate3d value from a given 2d point\n     *\n     * @param {number} x - coordinate\n     * @param {number} y - coordinate\n     * @return {string}\n     */\n    function toTranslate3d(x, y) {\n\n        return 'translate3d(' + x + 'px,' + y + 'px,0)';\n    }\n\n\n    /**\n     * Updates the display state of the selection box\n     *\n     * @param {boolean} active - The new state of the the selection box\n     * @this EditFrame\n     */\n    function updateSelectionBoxState(active) {\n\n        this.selection.active = active;\n        this.selection.element.style.display = active ? 'block' : 'none';\n    }\n\n    /**\n     * Updates the position and rotation of the selection box.\n     *\n     * @param {number} x - The x coordinate to place the selection box\n     * @param {number} y - The y coordinate to place the selection box\n     * @param {number} rotation - The amount of degrees to rotate the selection box\n     * @this EditFrame\n     */\n    function updateSelectorBoxPosition(x, y, rotation) {\n\n        this.selection.x = x;\n        this.selection.y = y;\n        this.selection.rotation = rotation;\n        var size = this.markup.getBoundingRect();\n        //TODO: consider DomElementStyle\n\n        size.width += this.frameMargin * 2;\n        size.height += this.frameMargin * 2;\n\n        var transform = toTranslate3d(x, y) + ' rotate(' + rotation + 'rad)';\n        var transformOrigin = (size.width / 2) + 'px ' + (size.height / 2) + 'px';\n\n        this.selection.element.style.msTransform =\n            this.selection.element.style.webkitTransform =\n            this.selection.element.style.transform = transform;\n        this.selection.element.style.msTransformOrigin =\n            this.selection.element.style.webkitTransformOrigin =\n            this.selection.element.style.transformOrigin = transformOrigin;\n    }\n\n    /**\n     * Updates the dimensions of the selection box (width and height).\n     *\n     * @param {number} width - The new width of the selection box\n     * @param {number} height - The new height of the selection box\n     * @this EditFrame\n     */\n    function updateSelectorBoxDimensions(width, height) {\n\n        this.selection.width = width;\n        this.selection.height = height;\n        this.selection.element.style.width = width + 'px';\n        this.selection.element.style.height = height + 'px';\n    }\n\n    /**\n     * Attaches all the necessary listeners to handle a drag action.\n     *\n     * @this EditFrame\n     */\n    function handleSelectionBoxDragging () {\n\n        this.selection.element.addEventListener('mousedown', this._onRepositionMouseDown.bind(this));\n    }\n\n    /**\n     * Handles panning when right clicking down\n     * @param event\n     * @returns {boolean} returns true if the event was handled\n     * @private\n     */\n    proto._handleRightClickDown = function(event) {\n\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\n            this.editor.input.onMouseDownRightClick(event);\n            return true;\n        }\n\n        return false;\n    };\n\n    var ignoreFirstMouseMove = false;\n    proto._onRepositionMouseDown = function (event, cursor) {\n\n        if (this._handleRightClickDown(event))\n            return;\n\n        // Return for markups that are not allowed to be repositioned.\n        if (this.markup && this.markup.preventReposition) return;\n\n        // ignore the first mouse move for the Microsoft Surface\n        ignoreFirstMouseMove = !av.isMobileDevice() && av.isTouchDevice();\n        //a synthetic start means that the event was triggered manually and not as a\n        //result of a mousedown on the edit frame\n        const _window = this.getWindow();\n        var syntheticStart = !(event instanceof _window.MouseEvent);\n\n        //during a real mousedown, ignore events originating from a resizing handle\n        if (!syntheticStart && (isDragPoint(event.target) || isRotatePoint(event.target))) return;\n\n        //get the cursor position\n        cursor = syntheticStart ?  cursor : this.editor.getMousePosition();\n\n        //store the initial cursor and axis constrains\n        this.initialCursor = cursor;\n        this.initialPosition = this.markup.getClientPosition();\n        this.areAxisConstrained = false;\n        this.axisConstrains = new THREE.Vector2(1,1);\n\n        //update the function that will handle the mousemove and mouseup events\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\n\n        if (this.selection.dragging)\n            return;\n\n        this.selection.dragging = true;\n        this.editor.beginActionGroup();\n\n        //if alt down I drop a clone.\n        if (event && event.altKey) {\n            var editor = this.editor;\n            var cloneMarkup = new CloneMarkup(editor, editor.getId(), this.markup, this.markup.position);\n            cloneMarkup.execute();\n        }\n\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Moving around\n    };\n\n    proto._onRepositionMouseMove = function(event) {\n\n        // This check is needed for selecting markups on devices that have touch screen + mouse (eg: Microsoft Surface)\n        if (ignoreFirstMouseMove) {\n            ignoreFirstMouseMove = false;\n            return false;\n        }\n        //ignore mousemove events if the dragging state hasn't been activated\n        if (!this.selection.dragging || !this.markup || this.markup.preventReposition) return false;\n\n        //get the position of the cursor relative to selection layer\n        var cursor = this.editor.getMousePosition();\n\n        //constrain axis if shift key is down.\n        var constrainAxis = this.editor.input.constrainAxis;\n        if (this.areAxisConstrained !== constrainAxis) {\n            this.areAxisConstrained = constrainAxis;\n            this.axisConstrains = constrainAxis ? new THREE.Vector2(0, 0) : new THREE.Vector2(1,1);\n\n            this.initialPosition.x += cursor.x - this.initialCursor.x;\n            this.initialPosition.y += cursor.y - this.initialCursor.y;\n\n            this.initialCursor.x = cursor.x;\n            this.initialCursor.y = cursor.y;\n        }\n\n        //determine how many pixel we have to shift the\n        //selection box to keep the cursor on the drag point\n        var movement = {\n            x: cursor.x - this.initialCursor.x,\n            y: cursor.y - this.initialCursor.y\n        };\n\n        var deadZone = 15;\n        if (this.axisConstrains.x === 0 && this.axisConstrains.y === 0) {\n\n            if (Math.abs(movement.x) > deadZone) {\n                this.axisConstrains.x = 1;\n                movement.x += movement.x < 0 ?  deadZone : -deadZone;\n            } else\n            if (Math.abs(movement.y) > deadZone) {\n                this.axisConstrains.y = 1;\n                movement.y += movement.y < 0 ?  deadZone : -deadZone;\n            }\n        }\n\n        var x = this.initialPosition.x + movement.x * this.axisConstrains.x;\n        var y = this.initialPosition.y + movement.y * this.axisConstrains.y;\n\n        updateSelectorBoxPosition.bind(this)(x, y, this.selection.rotation);\n\n        //tell the markup to start transforming\n        //the markup expects an (x, y) coordinate that\n        //uses an origin at the center, adjust our x, y because\n        //our origin starts at the top left\n        var position = this.editor.positionFromClientToMarkups(x, y);\n        var setPosition = new SetPosition(this.editor, this.markup, position);\n        setPosition.execute();\n        return true;\n    };\n\n    proto._onRepositionMouseUp = function () {\n\n        if (this.markup && this.markup.preventReposition) return;\n\n        this.last = null;\n\n        //this should never be called after the mouse up because we are no longer repositioning\n        this.onMouseMove = function () {/*do nothing*/};\n        this.onMouseUp = function () {/*do nothing*/};\n\n        if(!this.selection.dragging) {\n            return;\n        }\n\n        this.editor.closeActionGroup();\n        this.selection.dragging = false;\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Moving around\n    };\n\n    proto._onResizeMouseDown = function (event) {\n\n        if (this._handleRightClickDown(event))\n            return;\n\n        var target = event.target;\n\n        //is the target where the mousedown occurred a drag point\n        if (!isDragPoint(target)) {\n            return;\n        }\n\n        //keep a reference to the point where the drag started\n        this.selection.handle.resizing = target;\n        //figure out which direction this point should resize\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\n        //set the cursor position for the entire layer\n        this.containingDiv.style.cursor = direction + '-resize';\n\n        var cursor = this.editor.getMousePosition();\n\n        var position = this.markup.getClientPosition();\n        var size = this.markup.getBoundingRect();\n\n        //store the center\n        this.initial = {\n            x: position.x,\n            y: position.y,\n            width: size.width,\n            height: size.height,\n            mouseX: cursor.x,\n            mouseY: cursor.y\n        };\n\n        this.onMouseMove = this._onResizeMouseMove.bind(this);\n        this.onMouseUp = this._onResizeMouseUp.bind(this);\n\n        if (this.selection.resizing) {\n            return;\n        }\n\n        this.selection.resizing = true;\n        this.editor.beginActionGroup();\n\n        setHandleSelected(event.target, true);\n\n        //notify the markup that dragging has started\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Resizing\n    };\n\n    proto._onResizeMouseMove = function (event) {\n\n        if (!this.selection.resizing) return false;\n\n        var cursor = this.editor.getMousePosition();\n        var initial = this.initial;\n\n        var movement = {\n            x: cursor.x - initial.mouseX,\n            y: cursor.y - initial.mouseY\n        };\n\n        // Skip resize if there is no movement\n        if (movement.x === 0 && movement.y === 0) return;\n\n        var vector = new THREE.Vector3(movement.x, movement.y, 0);\n        var undoRotation = new THREE.Matrix4().makeRotationZ(-this.selection.rotation);\n        movement = vector.applyMatrix4(undoRotation);\n\n        var x = initial.x,\n            y = initial.y,\n            width = initial.width,\n            height = initial.height;\n\n        var localSpaceDelta = new THREE.Vector3();\n\n        //get the direction of the arrow being dragged\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\n\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\n        // If shift is pressed, figure aspect ratio is maintained.\n        if (this.editor.input.keepAspectRatio && ['nw', 'ne', 'sw', 'se'].indexOf(direction) !== -1) {\n\n            var delta = new THREE.Vector3(movement.x, movement.y, 0);\n            switch (direction){\n                case 'nw': movement.set(-initial.width,-initial.height, 0); break;\n                case 'ne': movement.set( initial.width,-initial.height, 0); break;\n                case 'sw': movement.set( initial.width,-initial.height, 0); break;\n                case 'se': movement.set( initial.width, initial.height, 0); break;\n            }\n            movement.normalize();\n            movement = delta.projectOnVector(movement);\n        }\n\n        var translations = {\n            n: function () {\n                height -= movement.y;\n                localSpaceDelta.y = movement.y;\n            },\n            s: function () {\n                height += movement.y;\n                localSpaceDelta.y = movement.y;\n            },\n            w: function () {\n                width -= movement.x;\n                localSpaceDelta.x = movement.x;\n            },\n            e: function () {\n                width += movement.x;\n                localSpaceDelta.x = movement.x;\n            },\n            nw: function () {\n                this.n();\n                this.w();\n            },\n            ne: function () {\n                this.n();\n                this.e();\n            },\n            sw: function () {\n                this.s();\n                this.w();\n            },\n            se: function () {\n                this.s();\n                this.e();\n            }\n        };\n\n        translations[direction]();\n\n        // Check if new size is smaller than min width or height\n        if (width <= this.markup.getMinWidth() || height <= this.markup.getMinHeight()) return;\n\n        var redoRotation = new THREE.Matrix4().makeRotationZ(this.selection.rotation);\n        var actualDelta = localSpaceDelta.applyMatrix4(redoRotation);\n\n        var newPos = this.editor.positionFromClientToMarkups(\n            x + (actualDelta.x * 0.5),\n            y + (actualDelta.y * 0.5));\n\n        var newSize = this.editor.sizeFromClientToMarkups(width, height);\n\n        var setSize = new SetSize(this.editor, this.markup, newPos, newSize.x, newSize.y);\n        setSize.execute();\n        return true;\n    };\n\n    function setHandleSelected (handle, isSelected) {\n        if (isSelected) {\n            handle.classList.add('selected');\n        } else {\n            handle.classList.remove('selected');\n        }\n    }\n\n    proto._onResizeMouseUp = function (event) {\n        this.selection.resizing = false;\n        this.selection.handle.resizing = null;\n        this.containingDiv.style.cursor = '';\n\n        for (var direction in this.selection.handle) {\n            if (this.selection.handle[direction]) {\n                setHandleSelected(this.selection.handle[direction], false);\n            }\n        }\n\n\n        this.editor.closeActionGroup();\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Resizing\n\n        //this should never be called after the mouse up because we are no longer resizing\n        this.onMouseMove = function () {/*do nothing*/\n        };\n        this.onMouseUp = function () {/*do nothing*/\n        };\n    };\n\n\n    /**\n     * Attaches all the necessary listeners to handle a resizing action.\n     *\n     * @this EditFrame\n     */\n    function handleSelectionBoxResizing() {\n        this.selectionLayer.addEventListener('mousedown', this._onResizeMouseDown.bind(this));\n    }\n\n    function handleSelectionBoxRotating () {\n\n        this.selection.element.addEventListener('mousedown', this._onRotationMouseDown.bind(this));\n    }\n\n    var initialRotation;\n    var initialHandlePosition;\n\n    proto._onRotationMouseDown = function (event) {\n\n        if (this._handleRightClickDown(event))\n            return;\n\n        //ignore anything not coming from the rotation point\n        if (!isRotatePoint(event.target)) return;\n\n        this.editor.beginActionGroup();\n        this.selection.rotating = true;\n\n        //store the initial cursor\n        initialHandlePosition = this.editor.getMousePosition();\n\n        initialRotation = this.selection.rotation || 0;\n\n        //update the function that will handle the mousemove and mouseup events\n        this.onMouseMove = this._onRotationMouseMove.bind(this);\n        this.onMouseUp = this._onRotationMouseUp.bind(this);\n\n        setHandleSelected(event.target, true);\n\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Rotating\n    };\n\n     proto._onRotationMouseMove = function (event) {\n\n        //ignore mousemove events if the dragging state hasn't been activated\n        if (!this.selection.rotating) return false;\n\n        var cursor = this.editor.getMousePosition();\n        var position = this.markup.getClientPosition();\n\n        var r = getAngleBetweenPoints(position, cursor);\n        var r2 = getAngleBetweenPoints(position, initialHandlePosition);\n        var rotation = r - r2 + initialRotation;\n\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\n        if (this.editor.input.snapRotations) {\n            var snap = degreesToRadians(22.5);\n            rotation = Math.ceil(rotation / snap) * snap;\n        }\n\n         //pass rotation as degrees\n         updateSelectorBoxPosition.bind(this)(this.selection.x, this.selection.y, rotation);\n\n        //convert to radians\n        var setRotation = new SetRotation(this.editor, this.markup, rotation);\n        setRotation.execute();\n        return true;\n    };\n\n    proto._onRotationMouseUp = function (event) {\n\n        this.selection.rotating = false;\n        initialRotation = null;\n        initialHandlePosition = null;\n        setHandleSelected(this.selection.rotationHandle, false);\n        this.editor.closeActionGroup();\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Rotating\n    };\n\n    /**\n     * Attaches double click listener and pass events to markup, markups such as text use it to enter text edit\n     * mode.\n     *\n     * @this EditFrame\n     */\n    function handleSelectionDoubleClick() {\n\n        var doubleClick = function (event) {\n            if (event.defaultPrevented) {\n                return;\n            }\n            this.selection.dragging = false;\n            var editMode = this.editor.editMode;\n            editMode && editMode.onMouseDoubleClick(this.markup);\n        }.bind(this);\n\n        var selectorBoxWrapper = this.selectionLayer;\n        selectorBoxWrapper.addEventListener('dblclick', doubleClick);\n    }\n\n    function togglePointerEvents(element, state) {\n\n        element.style.pointerEvents = state ? 'auto' : 'none';\n    }\n\n    function getAngleBetweenPoints (p1, p2) {\n\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    }\n\n     function matchesSelectorAux(domElem, selector) {\n         if (domElem.matches) return domElem.matches(selector); //Un-prefixed\n         if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\n         if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\n         if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\n         return false;\n     }\n","'use strict';\n\n    var avp = Autodesk.Viewing.Private;\n\n    export function MarkupTool() {\n\n        Autodesk.Viewing.ToolInterface.call(this);\n        this.names = [\"markups.core\"];\n        this.panTool = null;\n        this.allowNav = false;\n        this.is2d = false;\n\n        this.coreExt = null;\n        this.hotkeysEnabled = true;\n\n        var _ctrlDown = false;\n        var _shiftDown = false;\n\n        // Non-ToolInterface methods //\n\n        this.allowNavigation = function(allow) {\n            this.allowNav = allow;\n        };\n        this.setCoreExtension = function(coreExt) {\n            this.coreExt = coreExt;\n        };\n        this.setHotkeysEnabled = function(enabled) {\n            this.hotkeysEnabled = enabled;\n        };\n\n\n        // ToolInterface methods //\n\n        this.activate = function(name, viewerApi) {\n            this.panTool = viewerApi.toolController.getTool(\"pan\");\n            if (this.panTool) {\n                this.panTool.activate(\"pan\"); // TODO: What if we want \"zoom\" here?\n            }\n\n            this.is2d = viewerApi.model.is2d();\n            this.viewer = viewerApi;\n        };\n\n        this.deactivate = function(name) {\n            if (this.panTool) {\n                this.panTool.deactivate(\"pan\");\n            }\n        };\n\n        this.handleKeyDown = function(event, keyCode) {\n\n            if (!this.coreExt.editMode) {\n                return false;\n            }\n\n            if (!this.hotkeysEnabled) {\n                return true; // Consume event\n            }\n\n            // Don't propagate key handling down to tool //\n\n            switch (keyCode) {\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = true; break;\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = true; break;\n\n                case Autodesk.Viewing.KeyCode.x: _ctrlDown && !this.allowNav && this.coreExt.cut(); break;\n                case Autodesk.Viewing.KeyCode.c: _ctrlDown && !this.allowNav && this.coreExt.copy(); break;\n                case Autodesk.Viewing.KeyCode.v: _ctrlDown && !this.allowNav && this.coreExt.paste(); break;\n                case Autodesk.Viewing.KeyCode.d:\n                    if (_ctrlDown && !this.allowNav) {\n                        // Duplicate\n                        this.coreExt.copy();\n                        this.coreExt.paste();\n                    }\n                    break;\n                case Autodesk.Viewing.KeyCode.z:\n                    if (_ctrlDown && !_shiftDown && !this.allowNav) {\n                        this.coreExt.undo();\n                    }\n                    else if (_ctrlDown && _shiftDown && !this.allowNav) {\n                        this.coreExt.redo(); // Also support Ctrl+Y\n                    }\n                    break;\n                case Autodesk.Viewing.KeyCode.y: _ctrlDown && !this.allowNav && this.coreExt.redo(); break; // Also support ctrl+shift+z\n                case Autodesk.Viewing.KeyCode.ESCAPE: this.coreExt.onUserCancel(); break;\n\n                case Autodesk.Viewing.KeyCode.BACKSPACE: // Fall through\n                case Autodesk.Viewing.KeyCode.DELETE:\n                    var selectedMarkup = this.coreExt.getSelection();\n                    if (selectedMarkup) {\n                        this.coreExt.deleteMarkup(selectedMarkup);\n                    }\n                    break;\n                case Autodesk.Viewing.KeyCode.F12:\n                    return false; // To allow opening developer console.\n                default: break;\n            }\n\n            return true; // Consume event\n        };\n        this.handleKeyUp = function(event, keyCode) {\n\n            if (!this.coreExt.editMode) {\n                return false;\n            }\n\n            if (!this.hotkeysEnabled) {\n                return true; // Consume event\n            }\n\n            // Don't propagate key handling down to tool\n\n            switch (keyCode) {\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = false; break;\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = false; break;\n                default: break;\n            }\n\n            return true; // Consume event ONLY\n        };\n\n        this.update = function() {\n            if (this.allowNav && this.panTool && this.panTool.update) {\n                return this.panTool.update();\n            }\n            return false;\n        };\n\n        this.handleSingleClick = function( event, button ) {\n            if (this.allowNav) {\n                // If pan tool won't handle single click, then pass over the event.\n                if (this.panTool && this.panTool.handleSingleClick)\n                    return this.panTool.handleSingleClick(event, button);\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleDoubleClick = function( event, button ) {\n            if (this.allowNav) {\n                // If pan tool won't handle double click, then pass over the event\n                if (this.panTool && this.panTool.handleDoubleClick) {\n                    return this.panTool.handleDoubleClick(event, button);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleSingleTap = function( event ) {\n            if (this.allowNav) {\n                // If pan tool won't handle single tap, then pass over the event\n                if (this.panTool && this.panTool.handleSingleTap) {\n                    return this.panTool.handleSingleTap(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleDoubleTap = function( event ) {\n            if (this.allowNav) {\n                // If pan tool won't handle double tap, then pass over the event\n                if (this.panTool && this.panTool.handleDoubleTap) {\n                    return this.panTool.handleDoubleTap(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleWheelInput = function(delta, event) {\n            if (this.allowNav || this.is2d) {\n                // If pan tool won't handle wheel input, then pass over the event\n                if (this.panTool && this.panTool.handleWheelInput) {\n                    this.coreExt.callSnapperMouseMove();\n                    return this.panTool.handleWheelInput(delta, event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleButtonDown = function(event, button) {\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\n                // If pan tool won't handle button down, then pass over the event\n                if (this.panTool && this.panTool.handleButtonDown) {\n                    return this.panTool.handleButtonDown(event, button);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleButtonUp = function(event, button) {\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\n                // If pan tool won't handle button up, then pass over the event\n                if (this.panTool && this.panTool.handleButtonUp) {\n                    return this.panTool.handleButtonUp(event, button);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleMouseMove = function(event) {\n            if (this.allowNav || this.is2d) {\n                // If pan tool won't handle button move, then pass over the event\n                if (this.panTool && this.panTool.handleMouseMove) {\n                    return this.panTool.handleMouseMove(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleGesture = function(event) {\n            if (this.allowNav || this.is2d) {\n                // If pan tool won't handle gesture, then pass over the event\n                if (this.panTool && this.panTool.handleGesture) {\n                    return this.panTool.handleGesture(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleBlur = function(event) {\n            if (this.allowNav) {\n                // If pan tool won't handle blur, then pass over the event\n                if (this.panTool && this.panTool.handleBlur) {\n                    return this.panTool.handleBlur(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n    }\n","\n// Maps EditMode id (string) into a contructor/class\nvar _editModes = {};\n\nclass EditModeManager {\n    constructor(){\n        // nothing //\n    }\n\n    register(id, clazz) {\n        if (id in _editModes)\n            throw new Error(`EditMode with id (${id}) already registered.`);\n\n            _editModes[id] = clazz;\n    }\n\n    unregister(id) {\n        if (id in _editModes)\n            delete _editModes[id];\n    }\n\n    getClass(id) {\n        return _editModes[id] || null;\n    }\n\n    getRegistered() {\n        var ret = {};\n        for (var id in _editModes) {\n            if (Object.prototype.hasOwnProperty.call(_editModes, id)) {\n                ret[id] = _editModes[id];\n            }\n        }\n        return ret; // shallow copy.\n    }\n}\n\n\nexport var theEditModeManager =  new EditModeManager();","\nimport { theEditModeManager } from '../EditModeManager';\nimport * as MarkupTypes from '../MarkupTypes';\n\nimport { EditModeArrow } from './EditModeArrow';\nimport { EditModeText } from './EditModeText';\nimport { EditModeRectangle } from './EditModeRectangle';\nimport { EditModeCircle } from './EditModeCircle';\nimport { EditModeCloud } from './EditModeCloud';\nimport { EditModeFreehand } from './EditModeFreehand';\nimport { EditModeHighlight } from './EditModeHighlight';\nimport { EditModePolyline } from './EditModePolyline';\nimport { EditModePolycloud } from './EditModePolycloud';\nimport { EditModeCallout } from './EditModeCallout';\nimport { EditModeDimension } from './EditModeDimension';\nimport { EditModeStamp } from './EditModeStamp';\n\n\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_ARROW, EditModeArrow);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_TEXT, EditModeText);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_RECTANGLE, EditModeRectangle);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CIRCLE, EditModeCircle);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CLOUD, EditModeCloud);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_FREEHAND, EditModeFreehand);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_HIGHLIGHT, EditModeHighlight);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYLINE, EditModePolyline);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYCLOUD, EditModePolycloud);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CALLOUT, EditModeCallout);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_DIMENSION, EditModeDimension);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_STAMP, EditModeStamp);\n\n","\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[6].use[2]!../../../node_modules/css-unicode-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./Markups.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[6].use[2]!../../../node_modules/css-unicode-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./Markups.css\";\n       export default content && content.locals ? content.locals : undefined;\n","'use strict';\n\nimport { EditActionManager } from './edit-actions/EditActionManager';\nimport * as MarkupEvents from './MarkupEvents';\nimport * as MarkupTypes from './MarkupTypes';\nimport { addTraitEventDispatcher, createSvgElement, setSvgParentAttributes,\n    MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,\n    hideLmvUi, restoreLmvUi, dismissLmvHudMessage,\n    removeAllMetadata, transferChildNodes, addSvgMetadata,\n    svgNodeToString, checkPolygon, stringToSvgNode, createMarkupFromSVG,\n    worldToClient, clientToWorld } from './MarkupsCoreUtils';\nimport { cloneStyle, copyStyle, createStyle } from './StyleUtils';\nimport { Clipboard } from './edit-clipboard/Clipboard';\nimport { InputHandler } from './edit-input/InputHandler';\nimport { EditFrame } from './EditFrame';\nimport { MarkupTool } from './MarkupTool';\nimport { EditModeArrow } from './edit-modes/EditModeArrow';\n\nimport './edit-modes/BuiltinEditModes'; // IMPORTANT!! HAS SIDE EFFECTS\nimport './Markups.css'; // IMPORTANT!!\n\n\nvar MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\nvar PERSPECTIVE_MODE_SCALE = 1000;\n\n\n/**\n * Extension that allows end users to draw 2D markups on top of 2D and 3D models.\n *\n * @tutorial feature_markup\n * @param {Autodesk.Viewing.Viewer3D} viewer - Viewer instance used to operate on.\n * @param {object} options - Same Dictionary object passed into {@link Autodesk.Viewing.Viewer3D|Viewer3D}'s constructor.\n * @param {boolean} [options.markupDisableHotkeys] - Disables hotkeys for copy, cut, paste, duplicate, undo, redo and deselect.\n * @param {Autodesk.Viewing.ToolInterface} [options.markupToolClass] - Class override for input handling.\n * Use it to override/extend default hotkeys and/or mouse/gesture input.\n * @memberof Autodesk.Viewing.Extensions\n * @alias Autodesk.Viewing.Extensions.MarkupsCore\n * @see {@link Autodesk.Viewing.Extension} for common inherited methods.\n * @class\n */\nexport function MarkupsCore(viewer, options) {\n\n    Autodesk.Viewing.Extension.call(this, viewer, options);\n\n    this.options = this.options || {};\n    this.markups = [];\n    this.styles = {};\n\n    this.activeLayer = '';\n    this.duringViewMode = false;\n    this.duringEditMode = false;\n\n    this.svgLayersMap = {};\n\n    // Add action manager.\n    this.actionManager = new EditActionManager( 50 ); // history of 50 actions.\n    this.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onEditActionHistoryChanged.bind(this));\n\n    this.nextId = 0; // Used to identify markups by id during an edit session.\n\n    // Clipboard.\n    this.clipboard = new Clipboard(this);\n\n    // Default Input handler.\n    this.input = new InputHandler();\n    this.input.setGlobalManager(this.globalManager);\n\n    // Bind functions so they have access to globalManager\n    this.createSvgElement = createSvgElement.bind(this);\n    this.addSvgMetadata = addSvgMetadata.bind(this);\n    this.checkPolygon = checkPolygon.bind(this);\n\n    // Extension will dispatch events.\n    addTraitEventDispatcher(this);\n\n    const initStrokeAndFontWidths = (model) => {\n        // For 2d, set these widths once, and not recalculate again\n        if (model.is2d()) {\n            this.getStrokeWidth();\n            this.getFontWidth();\n        }\n    };\n\n    if (viewer.model) {\n        initStrokeAndFontWidths(viewer.model);\n    } else {\n        // Camera is reset right after a model load\n        // This is the right camera to use for widths initialization\n        viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT, ({ model }) => {\n            viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, () => {\n                initStrokeAndFontWidths(model);\n            }, { once: true });\n        }, { once: true });\n    }\n\n    // Handled events.\n    this.onCameraChangeBinded = this.onCameraChange.bind(this);\n    this.onViewerResizeBinded = function(event) {\n        // This is ugly, but we need to do this twice\n        var self = this;\n        // First usage is to avoid a blinking scenario\n        self.onViewerResize(event);\n        requestAnimationFrame(function(){\n            // Second one is to actually make it work on some resize scenarios.\n            // Check the unlikely scenario that we are no longer in view mode.\n            if (self.duringViewMode) {\n                self.onViewerResize(event);\n            }\n        });\n    }.bind(this);\n\n    this.onMarkupSelectedBinded = this.onMarkupSelected.bind(this);\n    this.onMarkupEnterEditionBinded = this.onMarkupEnterEdition.bind(this);\n    this.onMarkupCancelEditionBinded = this.onMarkupCancelEdition.bind(this);\n    this.onMarkupDeleteEditionBinded = this.onMarkupDeleteEdition.bind(this);\n    this.onToolChangeBinded = this.onToolChange.bind(this);\n    this.onUnitsCalibrationStartsBinded = this.onUnitsCalibrationStarts.bind(this);\n\n    viewer.addEventListener(MeasureCommon.Events.UNITS_CALIBRATION_STARTS_EVENT, this.onUnitsCalibrationStartsBinded);\n}\n\nMarkupsCore.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\nMarkupsCore.prototype.constructor = MarkupsCore;\n\nvar proto = MarkupsCore.prototype;\n\nproto.load = async function () {\n\n    // Add layer where annotations will actually live\n    var svg = this.svg = this.createSvgElement('svg');\n    setSvgParentAttributes(svg);\n\n    // NOTE: Required since LMV renders Y coordinates upwards,\n    // while browser's Y coordinates goes downwards.\n    // SVG has 0 0 as default transform-origin: https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/transform-origin\n    const svgStyle = svg.style;\n    svgStyle.position = 'absolute';\n    svgStyle.left = '0';\n    svgStyle.top = '0';\n    svgStyle.transform = 'scale(1, -1)';\n    svgStyle.transformOrigin = 'center center';\n\n    this.bounds = {x:0, y:0, width:0, height:0};\n\n    this.input.attachTo(this);\n\n    //Instantiate edit frame.\n    this.editFrame = new EditFrame(this.viewer.container, this);\n    this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_START, function(){this.disableMarkupInteractions(true);}.bind(this));\n    this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\n\n    // Register tool\n    var toolClass = this.options.markupToolClass || MarkupTool;\n    this.changeMarkupTool(toolClass, !this.options.markupDisableHotkeys);\n\n    await this.viewer.loadExtension('Autodesk.Snapping');\n\n    this.snapper = new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer, {markupMode:true});\n    this.viewer.toolController.registerTool(this.snapper);\n\n    return true;\n};\n\n/**\n * Change the markup tool's class in order to implement a different behaviour to the UI.\n *\n * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupTool} toolClass - Implementation or extension of MarkupTool's class.\n * @param {boolean} enableHotKeys - Whether to enable markup's hot-keys or not.\n */\nproto.changeMarkupTool = function(toolClass, enableHotKeys) {\n    if (this.markupTool) {\n        this.viewer.toolController.deregisterTool(this.markupTool);\n        this.markupTool = null;\n    }\n\n    this.markupTool = new toolClass();\n    this.markupTool.setCoreExtension(this);\n    this.markupTool.setHotkeysEnabled(enableHotKeys);\n    this.viewer.toolController.registerTool(this.markupTool);\n};\n\nproto.unload = function() {\n\n    this.hide();\n\n    this.input.detachFrom(this);\n\n    this.editFrame.unload();\n\n    if (this.markupTool) {\n        this.viewer.toolController.deregisterTool(this.markupTool);\n        this.markupTool = null;\n    }\n\n    if (this.snapper) {\n        this.viewer.toolController.deregisterTool(this.snapper);\n        this.snapper = null;\n    }\n\n    var svg = this.svg;\n    if (svg && this.onMouseDownBinded) {\n        svg.removeEventListener(\"mousedown\", this.onMouseDownBinded);\n        this.onMouseDownBinded = null;\n    }\n    if (svg.parentNode) {\n        svg.parentNode.removeChild(svg);\n    }\n    this.editModeSvgLayerNode = null;\n    this.svg = null;\n\n    return true;\n};\n\nMarkupsCore.prototype.getStrokeWidth = function() {\n\n    if (!this.initialStrokeWidth || (this.viewer.model && !this.viewer.model.is2d())) {\n        this.initialStrokeWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS).y;\n    }\n\n    return this.initialStrokeWidth;\n};\n\nMarkupsCore.prototype.getFontWidth = function() {\n\n    if (!this.initialFontWidth || (this.viewer.model && !this.viewer.model.is2d())) {\n        this.initialFontWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS).y;\n    }\n\n    return this.initialFontWidth;\n};\n\n/**\n * Toggle in and out of Edit mode. In Edit mode the user is able to draw markups on the canvas.\n *\n * See also\n * {@link Autodesk.Viewing.Extensions.MarkupsCore/#enterEditMode|enterEditMode()} and\n * {@link Autodesk.Viewing.Extensions.MarkupsCore/#leaveEditMode|leaveEditMode()}\n */\nMarkupsCore.prototype.toggleEditMode = function() {\n\n    if (this.duringEditMode) {\n        this.leaveEditMode();\n    } else {\n        this.enterEditMode();\n    }\n};\n\n/**\n * Enables mouse interactions and mobile device gestures over the Viewer canvas to create or draw markups.\n *\n * Exit Edit mode by calling {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#leaveeditmode-1|leaveEditMode()}.\n *\n * See also\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#show|show()}\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#enterEditMode\n * @param {string} layerId - [optional] Identifier for the layer of markups to be edited. Example \"Layer1\".\n * @returns {boolean} Returns true if editMode is active\n */\nMarkupsCore.prototype.enterEditMode = function(layerId) {\n\n    /**\n     * @param layer\n     * @param disable\n     * @private\n     */\n    function disableLayerMarkups(layer, disable){\n        if (layer){\n            var layerMarkups = layer.markups;\n            for (var k = 0; k < layerMarkups.length; k++){\n                var m = layerMarkups[k];\n                m.disableInteractions(disable);\n            }\n        }\n    }\n    if (layerId) {\n        if (!this.svgLayersMap[layerId]) {\n            // if layerId is supplied but it does not exist in the svgLayerMap then create the new layer\n            console.warn(\"No such layer exists.\");\n            return false;\n        }\n    }\n\n    // If not currently shown, then show\n    if (!this.duringViewMode) {\n        if (!this.show()){\n            return false; // Failed to enter view mode.\n        }\n    }\n\n    // Initialize the edit mode layer if it does not exist\n    if(!this.editModeSvgLayerNode) {\n        var parSvg = this.createSvgElement('g');\n        this.editModeSvgLayerNode = {\n            markups: [],\n            svg: parSvg\n        };\n        this.editModeSvgLayerNode.svg.setAttribute('cursor', 'default');\n    }\n\n\n    if ((this.editModeSvgLayerNode.svg.parentNode != this.svg) || !layerId) {\n        this.svg.appendChild(this.editModeSvgLayerNode.svg);\n    }\n    this.svg.setAttribute('cursor', 'crosshair');\n\n\n    if (layerId) {\n        var layer = this.svgLayersMap[layerId];\n        // If the layer exists in the layer map, use the information stored for that specific layer.\n        if (layer) {\n            // Remove the edit layer when entering edit mode of a specific edit mode.\n            var editModeLayerParentNode = this.editModeSvgLayerNode.svg.parentNode;\n            editModeLayerParentNode && editModeLayerParentNode.removeChild(this.editModeSvgLayerNode.svg);\n\n            // disable the markups in the editModeLayer\n            disableLayerMarkups(this.editModeSvgLayerNode, true);\n\n            // Enable interactions for markups in the current edit layer and disable interactions for markups in\n            // the other layers.\n            for (var key in this.svgLayersMap){\n                var markups = this.svgLayersMap[key].markups;\n                for (var i = 0; i < markups.length; i++) {\n                    var markup = markups[i];\n                    if (key !== layerId.toString()){\n                        // disable all not in the current layer.\n                        markup.disableInteractions(true);\n                    } else {\n                        // enable all markups in current layer.\n                        markup.disableInteractions(false);\n                    }\n                }\n            }\n\n            // assign the current layer to the global active layer\n            this.activeLayer = layerId;\n            this.editingLayer = layerId;\n            var svgParent = layer.svg;\n\n            // remove previous svg layer child from svg\n            svgParent.parentNode && this.svg.removeChild(svgParent);\n\n            // reassign the markups in that layer to the global markups list\n            this.markups = layer.markups.slice();\n\n            // re-append svg layer child to svg to make it the top most layer\n            this.svg.appendChild(svgParent);\n        }\n    } else {\n        // disable interactions for the previous markups\n        // Example: enterEditMode(layer) -> enterEditMode()\n        if (this.editingLayer) {\n            for (var k = 0; k < this.markups.length; k++) {\n                var m = this.markups[k];\n                m.disableInteractions(true);\n            }\n            disableLayerMarkups(this.editModeSvgLayerNode, false);\n        }\n        this.editingLayer = '';\n        if (!this.editModeSvgLayerNode) {\n            this.markups = [];\n        }else{\n            this.markups = this.editModeSvgLayerNode.markups.slice();\n        }\n        this.activeLayer = '';\n    }\n\n    this.input.enterEditMode();\n    this.activateTool(true);\n    this.styles = {}; // Clear EditMode styles.\n    this.defaultStyle = null;\n    this.duringEditMode = true;\n    this.changeEditMode(new EditModeArrow(this));\n    this.actionManager.clear();\n    this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_ENTER });\n    this.allowNavigation(false);\n    return true;\n};\n\n/**\n * Exits Edit mode.\n *\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#entereditmode-layerid|enterEditMode()}.\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#leaveEditMode\n *\n * @returns {boolean} Returns true if Edit mode has been deactivated\n */\nMarkupsCore.prototype.leaveEditMode = function() {\n\n    var NOT_IN_EDIT_MODE = true;\n    var WE_ARE_STILL_IN_EDIT_MODE = false;\n\n    if (!this.duringEditMode || !this.duringViewMode) {\n        return NOT_IN_EDIT_MODE;\n    }\n\n    var viewer = this.viewer;\n    if (!viewer) {\n        return WE_ARE_STILL_IN_EDIT_MODE; // something is very wrong...\n    }\n\n    this.editMode.destroy();\n    this.editMode = null;\n    this.duringEditMode = false;\n\n    if (this.snapper) {\n        this.snapper.indicator.clearOverlays();\n        this.snapper.clearSnapped();\n    }\n\n    // Remove the edit layer\n    if (this.editModeSvgLayerNode && this.editModeSvgLayerNode.svg.parentNode){\n        this.svg.removeChild(this.editModeSvgLayerNode.svg);\n    }\n    this.svg.setAttribute('cursor', 'default');\n\n    this.input.leaveEditMode();\n    this.editFrame.setMarkup(null);\n    this.activateTool(true);\n\n    this.allowNavigation(true);\n    this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_LEAVE });\n    return NOT_IN_EDIT_MODE;\n};\n\n/**\n * Toggle between visible markups, i.e., show() and hidden markups, i.e., hide().\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.toggle\n * @method toggle\n */\nMarkupsCore.prototype.toggle = function() {\n\n    if (this.duringViewMode) {\n        this.hide();\n    } else {\n        this.show();\n    }\n};\n\n/**\n * Enables loading of previously saved markups.\n * Exit Edit mode by calling {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#hide|hide()}.\n *\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#entereditmode-layerid|enterEditMode()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#show\n * @method show\n *\n * @returns {boolean} Whether it successfully entered view mode or not.\n */\nMarkupsCore.prototype.show = function() {\n\n    var viewer = this.viewer;\n    if (!viewer || !viewer.model || !this.svg) {\n        return false;\n    }\n\n    // Return if already showing or in edit-mode.\n    // Notice that edit mode requires that we are currently show()-ing.\n    if (this.duringViewMode || this.duringEditMode) {\n        return true;\n    }\n\n    viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\n    viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\n\n    // Add parent svg of all markups.\n    viewer.container.appendChild(this.svg);\n    viewer.reorderElements(this.svg);\n\n    this.input.enterViewMode();\n    hideLmvUi(viewer);\n\n    // TODO: Nasty hack, currently there is no API to disable mouse highlighting in 3d models.\n    // TODO: We nuke rollover function in viewer, for now, public api will be added soon.\n    this.onViewerRolloverObject = viewer.impl.rolloverObject;\n    viewer.impl.rolloverObject = function(){};\n\n    this.activateTool(true);\n    var camera = viewer.impl.camera;\n    this.onViewerResize({ width: camera.clientWidth, height: camera.clientHeight });\n\n    // See function loadMarkups() for when the actual SVG gets added onstage //\n    this.svgLayersMap = {};\n    this.duringViewMode = true;\n    this.allowNavigation(true);\n    return true;\n};\n\n/**\n * Removes any markup currently overlaid on the viewer. It exits Edit mode if it is active.\n *\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#show|show()}\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#hide\n * @method hide\n *\n * @returns {boolean} Whether it successfully left view mode or not.\n */\nMarkupsCore.prototype.hide = function() {\n\n    var RESULT_HIDE_OK = true;\n    var RESULT_HIDE_FAIL = false;\n\n    var viewer = this.viewer;\n    if (!viewer || !this.duringViewMode) {\n        return RESULT_HIDE_OK;\n    }\n\n    if (this.duringEditMode) {\n        if (!this.leaveEditMode()) {\n            return RESULT_HIDE_FAIL;\n        }\n    }\n\n    viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\n    viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\n\n    var svg = this.svg;\n    svg.parentNode && svg.parentNode.removeChild(svg);\n\n    // Remove all Markups and metadata (if any)\n    this.unloadMarkupsAllLayers();\n    removeAllMetadata(svg);\n\n    this.input.leaveViewMode();\n    restoreLmvUi(viewer);\n    this.viewer.impl.rolloverObject = this.onViewerRolloverObject;\n\n    this.activateTool(false);\n    this.duringViewMode = false;\n    return RESULT_HIDE_OK;\n};\n\n/**\n * Removes newly created markups in the current editing layer.\n * Markups that were created in a specific layer will not be removed.\n *\n * Markups should have been added while in\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#entereditmode-layerid|enterEditMode()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.clear\n * @method clear\n */\nMarkupsCore.prototype.clear = function() {\n    // Can only clear specific layers when in the edit mode of that layer.\n    if (!this.duringEditMode) {\n        console.warn(\"Clear only removes markups when in Edit Mode.\");\n        return;\n    }\n    var editModeLayer = this.editingLayer ? this.svgLayersMap[this.editingLayer] : this.editModeSvgLayerNode;\n    if (editModeLayer) {\n        var markups = editModeLayer.markups;\n        var svg = editModeLayer.svg;\n        if (svg && svg.childNodes.length > 0) {\n            while (svg.childNodes.length) {\n                svg.removeChild(svg.childNodes[0]);\n            }\n        }\n        while (markups.length > 0) {\n            var markup = markups[0];\n            this.removeMarkup(markup);\n            markup.destroy();\n        }\n    }\n};\n\n/**\n * Returns an SVG string with the markups created so far.\n * The SVG string can be reloaded using {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#loadmarkups-markupstring-layerid|loadMarkups()}.\n *\n * Markups should have been added while in {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#entereditmode-layerid|enterEditMode()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.generateData\n * @method generateData\n *\n * @returns {string} Returns an SVG element with all of the created markups in a string format.\n */\nMarkupsCore.prototype.generateData = function() {\n\n    var defaultLayer = this.editModeSvgLayerNode.svg;\n\n    if (this.editMode) {\n        this.editMode.onSave();\n    }\n\n    // Sanity check, remove any lingering metadata nodes\n    removeAllMetadata(this.svg);\n\n    if (this.activeLayer){\n        defaultLayer = this.svgLayersMap[this.activeLayer].svg;\n    }\n\n    var tmpNode = this.createSvgElement(\"svg\");\n    transferChildNodes(this.svg, tmpNode); // Transfer includes this.editModeSvgLayerNode\n    transferChildNodes(defaultLayer, this.svg);\n\n    // version 1: first implementation.\n    // version 2: added global offset to markup positions.\n    // version 3: change node structure to include hitareas, hit areas are not exported.\n    // version 4: scale perspective markups space by PERSPECTIVE_MODE_SCALE because bug in firefox. LMV-1150\n    var metadataObject = {\n        \"data-model-version\": \"4\"\n    };\n    var metadataNode = this.addSvgMetadata(this.svg, metadataObject);\n    var metadataNodes = [ metadataNode ];\n\n    // Notify each markup to inject metadata\n    this.markups.forEach(function(markup){\n        var addedNode = markup.setMetadata();\n        if (addedNode) {\n            metadataNodes.push(addedNode);\n        }\n    });\n\n    // Generate the data!\n    var data = svgNodeToString(this.svg);\n\n    // Remove metadataObject before returning\n    metadataNodes.forEach(function(metadataNode){\n        metadataNode.parentNode.removeChild(metadataNode);\n    });\n\n    transferChildNodes(this.svg, defaultLayer);\n    transferChildNodes(tmpNode, this.svg);\n    tmpNode = null; // get rid of it.\n\n    return  data;\n};\n\n/**\n * @private\n */\nMarkupsCore.prototype.generatePoints3d = function() {\n\n    var result = {markups: [], main: null};\n    var markups = this.markups;\n    var markupsCount = markups.length;\n\n    if (markupsCount === 0) {\n        return result;\n    }\n\n    // Gather a 3d point for markup.\n    var idTarget = this.viewer.impl.renderer().readbackTargetId();\n    for(let i = 0; i < markupsCount; ++i) {\n\n        var markup = markups[i];\n        var point = markup.generatePoint3d(idTarget) || null;\n        result.markups.push(\n            {\n                id: markup.id,\n                type: markup.type,\n                point: point || null\n            });\n    }\n\n\n    // If there is 3d point associated with an arrow, we use that as main point.\n    if (markupsCount === 1) {\n\n        var main = result.markups[0].point;\n        result.main = main && main.clone();\n        return result;\n    }\n\n    for(let i = 0; i < markupsCount; ++i) {\n\n        var collision = result.markups[i];\n        if (collision.type === MarkupTypes.MARKUP_TYPE_ARROW && collision.point !== null) {\n\n            result.main = collision.point.clone();\n            return result;\n        }\n    }\n\n    // If there is no arrows, we average bounding boxes and get a 3d point inside it.\n    var bbX0 = Number.POSITIVE_INFINITY;\n    var bbY0 = Number.POSITIVE_INFINITY;\n    var bbX1 = Number.NEGATIVE_INFINITY;\n    var bbY1 = Number.NEGATIVE_INFINITY;\n\n    for(let i = 0; i < markupsCount; ++i) {\n\n        var boundingBox = markups[i].generateBoundingBox();\n\n        bbX0 = Math.min(bbX0, boundingBox.min.x);\n        bbY0 = Math.min(bbY0, boundingBox.min.y);\n        bbX1 = Math.max(bbX1, boundingBox.max.x);\n        bbY1 = Math.max(bbY1, boundingBox.max.y);\n    }\n\n    var polygon = {};\n\n    polygon.vertexCount = 4;\n    polygon.xVertices = new Float32Array([bbX0, bbX1, bbX1, bbX0]);\n    polygon.yVertices = new Float32Array([bbY0, bbY0, bbY1, bbY1]);\n\n    var point2d = this.checkPolygon(polygon, idTarget);\n    var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\n    result.main = point3d && point3d.point;\n\n    return result;\n};\n\n/**\n * Renders the markups onto a 2D canvas context to generate an image.\n *\n * @param {CanvasRenderingContext2D} context - Markups are drawn using the context provided\n * @param callback\n * @param renderAllMarkups\n * @private\n */\nMarkupsCore.prototype.renderToCanvas = function(context, callback, renderAllMarkups) {\n\n    var width = this.bounds.width;\n    var height = this.bounds.height;\n    var viewBox = this.getSvgViewBox(width, height);\n    var numberOfScreenshotsTaken = 0;\n    var markups = [];\n    var layer;\n\n    var onMarkupScreenshotTaken = function () {\n        if (callback && (++numberOfScreenshotsTaken === markups.length)) {\n            callback();\n        }\n    }.bind(this);\n\n    if (renderAllMarkups) {\n        var svgKeys = Object.keys(this.svg.childNodes);\n        var layersKeys = Object.keys(this.svgLayersMap);\n\n        // Append only markups that their parent layer is contained inside the svg main container.\n        for (var i = 0; i < svgKeys.length; i++) {\n            for (var j = 0; j < layersKeys.length; j++) {\n                layer = this.svgLayersMap[layersKeys[j]];\n                if (this.svg.childNodes[svgKeys[i]] === layer.svg) {\n                    markups = markups.concat(layer.markups);\n                }\n            }\n        }\n    } else {\n        layer = this.svgLayersMap[this.activeLayer] || this.editModeSvgLayerNode;\n        markups = layer.markups;\n    }\n\n    if (markups.length === 0) {\n        callback();\n    } else {\n        markups.forEach(function(markup) {\n            markup.renderToCanvas(context, viewBox, width, height, onMarkupScreenshotTaken);\n        });\n    }\n};\n\n/**\n * Changes the active drawing tool. For example, from the Arrow drawing tool to the Rectangle drawing tool.\n * Only applicable while in {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#entereditmode-layerid|Edit Mode}.\n *\n * Supported values are:\n * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeArrow(MarkupsCoreInstance)`\n * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeRectangle(MarkupsCoreInstance)`\n * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle(MarkupsCoreInstance)`\n * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCloud(MarkupsCoreInstance)`\n * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeText(MarkupsCoreInstance)`\n * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeFreehand(MarkupsCoreInstance)`\n * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolyline(MarkupsCoreInstance)`\n * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolycloud(MarkupsCoreInstance)`\n *\n * This function fires event `Autodesk.Viewing.Extensions.MarkupsCore.EVENT_EDITMODE_CHANGED`.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#changeEditMode\n * @method changeEditMode\n *\n * @param {object} editMode - Object instance for the drawing tool\n * @fires Autodesk.Viewing.Extensions.MarkupsCore.EVENT_EDITMODE_CHANGED\n */\nMarkupsCore.prototype.changeEditMode = function(editMode) {\n\n    var oldEditMode = this.editMode;\n    oldEditMode && oldEditMode.destroy();\n\n    editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN, function() {this.disableMarkupInteractions(true);}.bind(this));\n    editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\n    editMode.addEventListener(MarkupEvents.EVENT_MARKUP_DESELECT, function(event){this.dispatchEvent(event);}.bind(this));\n\n    this.editMode = editMode;\n    this.styles[editMode.type] = cloneStyle(editMode.getStyle());\n\n    this.dispatchEvent({type:MarkupEvents.EVENT_EDITMODE_CHANGED, target: editMode});\n};\n\n/**\n * Check whether a user can perform camera navigation operations on the current loaded model.\n * While the extension is active, the user can still draw markups.\n * Panning and zooming are only supported for orthographic cameras.\n *\n * @returns {boolean} Whether {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#allownavigation-allow|allowNavigation()} can succeed.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.isNavigationAllowed\n * @method isNavigationAllowed\n */\nMarkupsCore.prototype.isNavigationAllowed = function() {\n\n    return !this.viewer.impl.camera.isPerspective;\n};\n\n/**\n * Enables click, tap, and swipe behavior to allow camera zoom and panning operations. It is only available in\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#entereditmode-layerid|Edit mode}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.allowNavigation\n * @method allowNavigation\n *\n * @param {boolean} allow - Whether camera navigation interactions are active or not.\n */\nMarkupsCore.prototype.allowNavigation = function(allow) {\n\n    //we will still need to update the markup styles even if in perspective mode\n    var editMode = this.editMode;\n    this.navigating = allow;\n\n    if (allow){\n        this.svg.setAttribute(\"pointer-events\", \"none\");\n        editMode && this.selectMarkup(null);\n    } else {\n        this.svg.setAttribute(\"pointer-events\", \"painted\");\n    }\n\n    // Update pointer events for all markups.\n    var markups = this.markups;\n    var markupsCount = markups.length;\n\n    for(var i = 0; i < markupsCount; ++i) {\n        markups[i].updateStyle();\n    }\n    editMode && editMode.notifyAllowNavigation(allow);\n\n    // Navigation is not allowed while in perspective mode.\n    if (allow && (this.duringEditMode || this.duringViewMode) && !this.isNavigationAllowed()) {\n        return false;\n    }\n\n    // Clear snapper.\n    if (allow && this.snapper) {\n        this.snapper.indicator.clearOverlays();\n        this.snapper.clearSnapped();\n    }\n\n    this.markupTool.allowNavigation(allow);\n\n};\n\n/**\n * Sets mouse interactions and mobile device gestures with markups. Only applicable in\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#entereditmode-layerid|Edit mode}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.disableMarkupInteractions\n * @method disableMarkupInteractions\n *\n * @param {boolean} disable - true to disable interactions with markups; false to enable interactions with markups; default false.\n */\nMarkupsCore.prototype.disableMarkupInteractions = function(disable) {\n\n    if (this.editModeSvgLayerNode) {\n        this.editModeSvgLayerNode.svg.setAttribute('cursor', disable ? 'inherit' : 'default');\n    }\n    this.markups.forEach(function(markup) {markup.disableInteractions(disable);});\n};\n\n/**\n *\n * @param isActive\n * @private\n */\nMarkupsCore.prototype.activateTool = function(isActive) {\n    if (isActive) {\n        if (!this.cachedNavigationTool) {\n            this.cachedNavigationTool = this.viewer.getActiveNavigationTool();\n            this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\n        }\n        this.viewer.setActiveNavigationTool(this.markupTool.getName());\n    } else {\n\n        if (this.cachedNavigationTool) {\n            this.viewer.setActiveNavigationTool(this.cachedNavigationTool);\n            this.cachedNavigationTool = null;\n        } else {\n            var defaultToolName = this.viewer.getDefaultNavigationToolName();\n            this.viewer.setActiveNavigationTool(defaultToolName);\n        }\n\n        this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\n    }\n};\n\n/**\n *\n * @param event\n * @private\n */\nMarkupsCore.prototype.onToolChange = function(event) {\n\n    if (event.toolName !== this.markupTool.getName())\n        return;\n\n    if (event.active) {\n        var navAllowed = this.isNavigationAllowed();\n        this.viewer.setNavigationLockSettings({\n            pan      : navAllowed,\n            zoom     : navAllowed,\n            orbit    : false,\n            roll     : false,\n            fov      : false,\n            walk     : false,\n            gotoview : false\n        });\n    }\n    this.viewer.setNavigationLock(event.active);\n};\n\nMarkupsCore.prototype.onUnitsCalibrationStarts = function() {\n    if (this.duringEditMode) {\n        this.hide();\n    }\n};\n\n//// Input /////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nproto.changeInputHandler = function(inputHandler) {\n\n    this.input.detachFrom(this);\n    inputHandler.attachTo(this);\n    this.input = inputHandler;\n\n    if (this.duringEditMode) {\n        inputHandler.enterEditMode();\n    }\n\n    if (this.duringViewMode) {\n        inputHandler.enterViewMode();\n    }\n};\n\n//// Copy and Paste System /////////////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Standard copy operation. Applies to any selected markup.<br>\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#cut-1|cut()} and\n *{@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#paste-2|paste()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#copy\n * @method copy\n */\nMarkupsCore.prototype.copy = function() {\n\n    this.clipboard.copy();\n};\n\n/**\n * Standard cut operation. Applies to any selected markup, which gets removed from the screen at call time.<br>\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#copy|copy()} and\n *{@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#paste-2|paste()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#cut\n * @method cut\n */\nMarkupsCore.prototype.cut = function() {\n\n    this.clipboard.cut();\n};\n\n/**\n * Standard paste operation. This function will paste any previously copied or cut markup.\n * Can be called repeatedly after a single copy or cut operation.<br>\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#copy|copy()} and\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#cut-1|cut()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#paste\n * @method paste\n */\nMarkupsCore.prototype.paste = function() {\n\n    this.clipboard.paste();\n};\n\n//// Undo and Redo System //////////////////////////////////////////////////////////////////////////////////////////\n/**\n * Will undo the previous operation.<br>\n * The Undo/Redo stacks will track any change done to the existing markups.<br>\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#redo-1|redo()} and\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#isUndoStackEmpty|isUndoStackEmpty()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#undo\n * @method undo\n */\nMarkupsCore.prototype.undo = function() {\n\n    this.actionManager.undo();\n};\n\n/**\n * Will redo any previously undo operation.<br>\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#undo|undo()},\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#isRedoStackEmpty|isRedoStackEmpty()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#redo\n * @method redo\n */\nMarkupsCore.prototype.redo = function() {\n\n    this.actionManager.redo();\n};\n\n/**\n * Returns true when {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#undo|undo()} produces no changes.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#isUndoStackEmpty\n * @method isUndoStackEmpty\n *\n * @returns {boolean} true if there are no changes to undo; false if there are changes to undo.\n */\nMarkupsCore.prototype.isUndoStackEmpty = function() {\n\n    return this.actionManager.isUndoStackEmpty();\n};\n\n/**\n * Returns true when {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#redo-1|redo()} produces no changes.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#isRedoStackEmpty\n * @method isRedoStackEmpty\n *\n * @returns {boolean} true if there are no changes to redo; false if there are changes to redo.\n */\nMarkupsCore.prototype.isRedoStackEmpty = function() {\n\n    return this.actionManager.isRedoStackEmpty();\n};\n\nproto.beginActionGroup = function() {\n\n    this.actionManager.beginActionGroup();\n};\n\nproto.closeActionGroup = function() {\n\n    this.actionManager.closeActionGroup();\n};\n\nproto.cancelActionGroup = function() {\n\n    this.actionManager.cancelActionGroup();\n};\n\n/**\n * Helper function for generating unique markup ids.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#getId\n * @method getId\n *\n * @returns {number}\n */\nproto.getId = function() {\n\n    return ++this.nextId;\n};\n\n/**\n * @param event\n * @private\n */\nproto.onEditActionHistoryChanged = function(event) {\n\n    var data = event.data;\n    if((data.action !== 'undo' && data.targetId !== -1)) {\n\n        // Markup can be null when deleting, that's ok, we unselect in that case.\n        let markup = this.getMarkup(data.targetId);\n        this.selectMarkup(markup);\n    }\n    if(data.action === 'undo' && !this.isUndoStackEmpty()) {\n\n        let markup = this.getMarkup(this.actionManager.getLastElementInUndoStack().getTargetId());\n        this.selectMarkup(markup);\n    }\n\n    this.dispatchEvent(event);\n};\n\n/**\n * Returns a markup with the specified ID. Returns null when not found.\n * The ID can be retrieved from the return value of getSelection(). <br>\n * See also\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#getselection-1|getSelection()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#getMarkup\n * @method getMarkup\n *\n * @param {string} id Markup identifier.\n * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} Returns markup object.\n */\nMarkupsCore.prototype.getMarkup = function(id) {\n\n    var markups = this.markups;\n    var markupsCount = markups.length;\n\n    for(var i = 0; i < markupsCount; ++i) {\n        if (markups[i].id == id) {\n            return markups[i];\n        }\n    }\n\n    return null;\n};\n\n\n/**\n * Selects or deselects a markup. A selected markup gets an overlayed UI that allows you to perform transformations\n * such as resizing, rotations, and translations. To deselect a markup, send a null value. <br>\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#getmarkup-id|getMarkup()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#selectMarkup\n * @method selectMarkup\n *\n * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} markup The markup instance to select. Set the value to null to deselect a markup.\n */\nMarkupsCore.prototype.selectMarkup = function(markup) {\n\n    if (markup) {\n\n        if (this.editMode.type === markup.type) {\n            this.editMode.setSelection(markup);\n        } else {\n\n            var editMode = markup.getEditMode();\n            editMode.setSelection(null);\n\n            this.changeEditMode(editMode);\n            this.setStyle(markup.getStyle());\n            this.editMode.setSelection(markup);\n        }\n    } else {\n        // fix for text markup in view mode\n        if (this.editMode){\n            this.editMode.setSelection(null);\n        }\n    }\n};\n\n/**\n * Returns the currently selected markup. A selected markup has a custom UI overlayed that allows you to perform\n * resizing, rotations and translations.<br>\n * See also\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#selectmarkup-markup|selectMarkup()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#getSelection\n * @method getSelection\n *\n * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} Returns selected markup object; null if no markup is selected.\n */\nMarkupsCore.prototype.getSelection = function() {\n\n    return this.editMode.getSelection();\n};\n\n/**\n * Deletes a markup from the canvas. Only applies while in\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#entereditmode-layerid|Edit mode}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore#deleteMarkup\n * @method deleteMarkup\n *\n * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - Markup object.\n * @param {boolean} [dontAddToHistory] Whether delete action can be {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#undo|undone}.\n */\nMarkupsCore.prototype.deleteMarkup = function(markup, dontAddToHistory) {\n\n    if (!this.editMode || (this.editMode && this.editMode.selectedMarkup.id !== markup.id)) {\n        this.editMode = markup.getEditMode();\n    }\n    this.editMode.deleteMarkup(markup, dontAddToHistory);\n};\n\nproto.addMarkup = function(markup) {\n\n    var markups;\n    var layer = this.activeLayer;\n    var layerObject = this.svgLayersMap[layer] || '';\n\n    if (layerObject) {\n        var svgParent = layerObject.svg;\n        // append markup svg to layer svg\n        markup.setParent(svgParent);\n        // Add markup to layer markups if it does not exist\n        layerObject.markups.push(markup);\n        markups = layerObject.markups.slice();\n    } else {\n        // if layer is undefined create a edit mode svg layer\n        markup.setParent(this.editModeSvgLayerNode.svg);\n        this.editModeSvgLayerNode.markups.push(markup);\n        markups = this.editModeSvgLayerNode.markups.slice();\n    }\n\n    markup.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\n    markup.addEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\n    markup.addEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\n    markup.addEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\n    // Only set the global markups array when in edit mode\n    if (this.duringEditMode) {\n        this.markups = markups;\n    }\n};\n\n/**\n *\n * @param markup\n * @private\n */\nproto.removeMarkup = function(markup) {\n\n    if (!markup){\n        return false;\n    }\n    var self = this;\n\n    /**\n     * Get the layer markups in which the markup exists.\n     * This function will remove the markup if it exists in the corresponding layer markups array.\n     *\n     * @param markup\n     * @returns {number} returns -1 if the markup does not exist in a layer markups array\n     */\n    function removeMarkupIfExists(markup){\n        var markupIndex;\n        var layerMarkups = -1;\n        // check if the markup exists in the edit layer\n        if (self.editModeSvgLayerNode){\n            var editLayerMarkups = self.editModeSvgLayerNode.markups;\n            markupIndex = editLayerMarkups.indexOf(markup);\n            if (markupIndex !== -1) {\n                // remove the markup from the corresponding markup array\n                editLayerMarkups.splice(markupIndex, 1);\n                layerMarkups = editLayerMarkups.slice();\n                // update the global markups array if the markup is in the active layer\n                if (self.activeLayer === ''){\n                    self.markups = layerMarkups;\n                }\n                return layerMarkups;\n            }\n        }\n        // check if the markup exists in a layer\n        if (self.svgLayersMap) {\n            for (var layer in self.svgLayersMap) {\n                var markups = self.svgLayersMap[layer].markups;\n                markupIndex = markups.indexOf(markup);\n                if (markupIndex !== -1) {\n                    // remove the markup from the corresponding markup array\n                    markups.splice(markupIndex, 1);\n                    layerMarkups = markups.slice();\n                    // update the global markups array if the markup is in the active layer\n                    if (self.activeLayer === layer){\n                        self.markups = layerMarkups;\n                    }\n                    return layerMarkups;\n                }\n            }\n        }\n        return layerMarkups;\n    }\n\n    var layerMarkups = removeMarkupIfExists(markup);\n    if (layerMarkups === -1)\n        return false;\n\n    markup.setParent(null);\n\n    markup.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\n    markup.removeEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\n    markup.removeEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\n    markup.removeEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\n\n    var editMode = this.editMode;\n    if (editMode) {\n        var selectedMarkup = editMode.getSelection();\n        if (selectedMarkup === markup) {\n            this.selectMarkup(null);\n        }\n    }\n};\n\n//// Markups style /////////////////////////////////////////////////////////////////////////////////////////////////\n\nMarkupsCore.prototype.setStyle = function(style) {\n\n    var styles = this.styles;\n    var editMode = this.editMode;\n\n    copyStyle(style, styles[editMode.type]);\n    // copyStyle(styles[editMode.type], style);\n    editMode.setStyle(styles[editMode.type]);\n};\n\nMarkupsCore.prototype.getStyle = function() {\n\n    return cloneStyle(this.styles[this.editMode.type]);\n};\n\nMarkupsCore.prototype.getDefaultStyle = function() {\n\n    var defaultStyleAttributes = [\n        'stroke-width',\n        'font-size',\n        'font-family',\n        'font-style',\n        'font-weight',\n        'stroke-color',\n        'stroke-opacity',\n        'fill-color',\n        'text-data',\n        'fill-opacity'];\n    this.defaultStyle = this.defaultStyle || createStyle(defaultStyleAttributes, this);\n\n    return this.defaultStyle;\n};\n\n//// Markups depth order ///////////////////////////////////////////////////////////////////////////////////////////\n\n/**\n *\n * @param markup\n * @private\n */\nproto.bringToFront = function(markup) {\n\n    this.sendMarkupTo(markup, this.markups.length-1);\n};\n\n/**\n *\n * @param markup\n * @private\n */\nproto.sendToBack = function(markup) {\n\n    this.sendMarkupTo(markup, 0);\n};\n\n/**\n *\n * @param markup\n * @private\n */\nproto.bringForward = function(markup) {\n\n    var markupIndex = this.markups.indexOf(markup);\n    this.sendMarkupTo(markup, markupIndex+1);\n};\n\n/**\n *\n * @param markup\n * @private\n */\nproto.bringBackward = function(markup) {\n\n    var markupIndex = this.markups.indexOf(markup);\n    this.sendMarkupTo(markup, markupIndex-1);\n};\n\n/**\n *\n * @param markup\n * @param index\n * @private\n */\nproto.sendMarkupTo = function(markup, index) {\n\n    var markups = this.markups;\n    var markupIndex = markups.indexOf(markup);\n\n    if (markupIndex === -1 || index < 0 || index >= markups.length) {\n        return;\n    }\n\n    markups.splice(markupIndex, 1);\n    index = markupIndex > index ? index -1 : index;\n    markups.splice(index, 0, markup);\n\n    // TODO: Add markup in right position not always at the end.\n    markup.setParent(null);\n    if (this.activeLayer){\n        var parent = this.svgLayersMap[this.activeLayer].svg;\n        markup.setParent(parent);\n    }else {\n        markup.setParent(this.editModeSvgLayerNode.svg);\n    }\n};\n\n\n/**\n * Loads data (SVG string) for all markups in a specified layer (layerId) to the Viewer's canvas.<br>\n *\n * See also\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#unloadmarkups-layerid|unloadMarkups()}, and\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#hidemarkups-layerid|hideMarkups()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.loadMarkups\n * @method loadMarkups\n *\n * @param {string} markupString - SVG string with markups. See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#generatedata|generateData()}.\n * @param {string} layerId - Identifier for the layer where the markup should be loaded to. Example \"Layer1\".\n * @returns {boolean} Whether the markup string was able to be loaded successfully\n */\nMarkupsCore.prototype.loadMarkups = function (markupString, layerId) {\n\n    if (this.duringEditMode) {\n        console.warn(\"Markups will not be loaded during the edit mode\");\n        return false;\n    }\n\n    if (!this.duringViewMode) {\n        return false;\n    }\n\n    if (!layerId) {\n        console.warn(\"loadMarkups failed; missing 2nd argument 'layerId'\");\n        return false;\n    }\n\n    // Can it be parsed into SVG?\n    var parent = stringToSvgNode(markupString);\n    if (!parent) {\n        return false;\n    }\n\n    // If the supplied layerId exists in the svg layers map and there are children in the svg then return false.\n    if (layerId in this.svgLayersMap && this.svg.childNodes.length > 0) {\n        console.warn(\"This layer is already loaded, will not load again.\");\n        return false;\n    }\n    this.activeLayer = layerId;\n    var svgLayerNode = this.svgLayersMap[layerId];\n\n    // if the layer exists, delete it\n    if (svgLayerNode)\n        delete this.svgLayersMap[layerId];\n\n    // create an empty parent svg layer node for layerId\n    // Child markups will get added to th parent svg layer node in the addMarkup function\n    var newSvg = this.createLayerNode();\n\n    svgLayerNode = {\n        markups: [],\n        svgString: markupString,\n        svg: newSvg\n    };\n    this.svgLayersMap[layerId] = svgLayerNode;\n\n    var children = parent.childNodes;\n    for (var i = 0; i < children.length; i++) {\n        var child = children[i];\n        var markup = createMarkupFromSVG(child, this);\n        // Disable markups if already in edit mode and the active layer is different\n        if (markup && this.duringEditMode && this.editingLayer !== this.activeLayer) {\n            markup.disableInteractions(true);\n        }\n\n        if (!markup && child.localName !== \"metadata\") {\n            // Append child removes it from parent and copies it over to the new svg layer node,\n            // so we need to reduce index by 1 to continue proper iteration\n            svgLayerNode.svg.appendChild(child);\n            i--;\n            if (typeof child.setAttribute === 'function') {\n                child.setAttribute(\"pointer-events\", \"none\");\n            }\n        }\n    }\n\n    var svgParentNode = this.svgLayersMap[this.activeLayer].svg;\n\n    this.svg.appendChild(svgParentNode);\n    // If already in an edit mode layer then reassign active layer to edit layer\n    if(this.duringEditMode && this.editingLayer !== this.activeLayer) {\n        this.activeLayer = this.editingLayer;\n        if (this.editingLayer)\n            this.markups = this.svgLayersMap[this.activeLayer].markups.slice();\n    }\n    return true;\n};\n\n/**\n * TODO: Probably this function needs to be moved to MarkupCoreUtils.js\n * Creates a new layer node\n * */\n\nproto.createLayerNode = function() {\n\n    var newSvgLayerNode = this.createSvgElement('g');\n    newSvgLayerNode.setAttribute('cursor', 'default');\n    return newSvgLayerNode;\n};\n\n/**\n * Revert any changes made to the specific layer.\n *\n * See also {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#loadmarkups-markupstring-layerid|loadMarkups()} and\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#entereditmode-layerid|enterEditMode()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.revertLayer\n * @method revertLayer\n *\n * @param {string} layerId - ID of the layer to revert any changes that were made to it.\n * @returns {boolean} true if the layer was unloaded, false if the layer was not unloaded.\n */\nMarkupsCore.prototype.revertLayer = function(layerId){\n    if (!layerId) {\n        console.warn(\"revertLayer failed because no layerId was supplied.\");\n        return false;\n    }\n    var svgLayerNode = this.svgLayersMap[layerId];\n    if (!svgLayerNode){\n        console.warn(\"The supplied layer does not exist.\");\n        return false;\n    }\n    var inEditMode = this.duringEditMode;\n    // Leave editMode to revert a layer\n    if (inEditMode)\n        this.leaveEditMode();\n\n    // keep track of previous global markups.\n    var currentMarkups = this.markups.slice();\n    // Set the global markups to the markups in the current layer. These ones get removed in the unloadMarkups\n    this.markups = svgLayerNode.markups;\n    var layerSvg = svgLayerNode.svgString;\n    this.unloadMarkups(layerId);\n    this.loadMarkups(layerSvg, layerId);\n    // Assign markups\n    if (this.editingLayer){\n        if(this.editingLayer !== layerId) {\n            this.markups = currentMarkups;\n            var layerObject = this.svgLayersMap[this.editingLayer];\n            if (layerObject) {\n                layerObject.markups = currentMarkups;\n            }\n        }\n    }else{\n        if(this.editModeSvgLayerNode){\n            this.editModeSvgLayerNode.markups = currentMarkups;\n        }\n    }\n\n    if(this.editingLayer || this.editingLayer.length === 0){\n        var svg = this.editingLayer.length === 0 ? this.editModeSvgLayerNode.svg : this.svgLayersMap[this.editingLayer].svg;\n        if (svg.parentNode == this.svg) {\n            this.svg.removeChild(svg);\n            this.svg.appendChild(svg);\n        }\n    }\n    return true;\n};\n\n/**\n * Removes markups from the DOM (Document Object Model). This is helpful for freeing up memory.<br>\n *\n * See also\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#loadmarkups-markupstring-layerid|loadMarkups()},\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#unloadmarkupsalllayers-1|unloadMarkupsAllLayers()},\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#clear|clear()},\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#hide-1|hide()}, and\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#hidemarkups-layerid|hideMarkups()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.unloadMarkups\n * @method unloadMarkups\n *\n * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\n * @returns {boolean} Whether the operation succeeded or not.\n */\nMarkupsCore.prototype.unloadMarkups = function(layerId) {\n\n    if (!layerId) {\n        console.warn(\"unloadMarkups failed; No layerId provided.\");\n        return false;\n    }\n\n    var svgLayerNode = this.svgLayersMap[layerId];\n    if (!svgLayerNode) {\n        // TODO: Do we need to log anything here?\n        console.warn('No such layer exists to unload.');\n        return false;\n    }\n\n    var layerMarkups = svgLayerNode.markups.slice();\n    var numMarkups = layerMarkups.length;\n    for (var i = 0; i < numMarkups; i++) {\n        var markup = layerMarkups[i];\n        this.removeMarkup(markup);\n        markup.destroy();\n    }\n\n    // Remove the markups in the layer from the svg canvas\n    if (svgLayerNode.svg.parentNode === this.svg)\n        this.svg.removeChild(svgLayerNode.svg);\n\n    // Delete the layer from the layer map.\n    delete this.svgLayersMap[layerId];\n    // Reset the active layer if the supplied layer id is the same as the active layer\n    if (this.activeLayer.toString() === layerId.toString()) {\n        this.activeLayer = '';\n    }\n    // Leave edit mode and reset the editing layer if the supplied layer is the same as the current editing layer\n    if (this.editingLayer && this.editingLayer.toString() === layerId.toString()){\n        this.editingLayer = '';\n        this.duringEditMode && this.leaveEditMode();\n    }\n\n    return true;\n};\n\n/**\n * Removes all markups loaded so far. Great for freeing up memory.\n *\n * See also\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#loadmarkups-markupstring-layerid|loadMarkups()},\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#unloadmarkups-layerid|unloadMarkups()},\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#clear|clear()},\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#hide-1|hide()}, and\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#hidemarkups-layerid|hideMarkups()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.unloadMarkupsAllLayers\n * @method unloadMarkupsAllLayers\n */\nMarkupsCore.prototype.unloadMarkupsAllLayers = function() {\n    this.activeLayer = '';\n    var self = this;\n\n    //this is specific to the editModeSvgLayerNode, enterEditMode().\n    var unloadSvgLayerNode = function(){\n        if (self.editModeSvgLayerNode){\n            var layerMarkups = self.editModeSvgLayerNode.markups.slice();\n            var numMarkups = layerMarkups.length;\n            for (var i = 0; i < numMarkups; i++) {\n                var markup = layerMarkups[i];\n                self.removeMarkup(markup);\n                markup.destroy();\n            }\n        }\n    };\n\n    // Unload the markups in the editModeSvgLayerNode\n    unloadSvgLayerNode();\n    var layerId;\n    for (layerId in this.svgLayersMap){\n        this.unloadMarkups(layerId);\n    }\n};\n\n/**\n * Hides all markups in a specified layer. Note that hidden markups will not be unloaded.\n * Use the {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#showmarkups-layerid|showMarkups()} method to make\n * them visible again; no additional parsing is required.\n *\n * See also\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#showmarkups-layerid|showMarkups()},\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#unloadmarkups-layerid|unloadMarkups()}, and\n * {@link /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#loadmarkups-markupstring-layerid|loadMarkups()}.\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.hideMarkups\n * @method hideMarkups\n *\n * @param {string} layerId - ID of the layer containing all markups that should be hidden (in the DOM).\n * @returns {boolean} Whether the operation succeeded or not.\n */\nMarkupsCore.prototype.hideMarkups = function(layerId) {\n\n    if (!layerId) {\n        console.warn(\"hideMarkups failed; No layerId provided.\");\n        return false;\n    }\n\n    var svgLayerNode = this.svgLayersMap[layerId];\n    if (!svgLayerNode) {\n        // TODO: Do we need to log anything here?\n        return false;\n    }\n    var layerSvg = svgLayerNode.svg;\n\n    // Return false if the layer svg is not present in the main svg\n    if (layerSvg.parentNode != this.svg) {\n        console.warn(\"Layer is already hidden.\");\n        return false;\n    }\n    // remove the layer svg from the main svg\n    this.svg.removeChild(layerSvg);\n    return true;\n};\n\n/**\n * Unhides a layer of hidden markups\n * ({@link  /en/docs/viewer/v7/reference/Extensions/MarkupsCore/#hidemarkups-layerid|hideMarkups()}).\n *\n * @memberof Autodesk.Viewing.Extensions.MarkupsCore\n * @alias Autodesk.Viewing.Extensions.MarkupsCore.showMarkups\n * @method showMarkups\n *\n * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\n * @returns {boolean} Whether the operation succeeded or not.\n */\nMarkupsCore.prototype.showMarkups = function(layerId) {\n\n    if (!layerId) {\n        console.warn(\"showMarkups failed; No layerId provided.\");\n        return false;\n    }\n\n    var svgLayerNode = this.svgLayersMap[layerId];\n    if (!svgLayerNode) {\n        // TODO: Do we need to log anything here?\n        return false;\n    }\n    // Append the layer svg to the main svg\n    var layerSvg = svgLayerNode.svg;\n    this.svg.appendChild(layerSvg);\n};\n\n//// Client Space <-> Markup Space /////////////////////////////////////////////////////////////////////////////////\n\nproto.positionFromClientToMarkups = function(x, y) {\n\n    return this.clientToMarkups(x, y);\n};\n\nproto.positionFromMarkupsToClient = function(x, y) {\n\n    return this.markupsToClient(x, y);\n};\n\nproto.vectorFromClientToMarkups = function(x, y) {\n\n    var a = this.clientToMarkups(0, 0);\n    var b = this.clientToMarkups(x, y);\n\n    return {x: b.x - a.x, y: b.y - a.y};\n};\n\nproto.vectorFromMarkupsToClient = function(x, y) {\n\n    var a = this.markupsToClient(0, 0);\n    var b = this.markupsToClient(x, y);\n\n    return {x: b.x - a.x, y: b.y - a.y};\n};\n\nproto.sizeFromClientToMarkups = function(w, h) {\n\n    var a = this.clientToMarkups(0, 0);\n    var b = this.clientToMarkups(w, h);\n\n    return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\n};\n\nproto.sizeFromMarkupsToClient = function(w, h) {\n\n    var a = this.markupsToClient(0, 0);\n    var b = this.markupsToClient(w, h);\n\n    return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\n};\n\nproto.markupsToClient = function(x, y) {\n\n    var camera = this.viewer.impl.camera;\n    var point = new THREE.Vector3(x, y, 0);\n\n    if (camera.isPerspective) {\n\n        var bb = this.viewer.impl.getCanvasBoundingClientRect();\n\n        point.x =( point.x / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.width  * 0.5);\n        point.y =(-point.y / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.height * 0.5);\n    } else {\n\n        point.applyMatrix4(camera.matrixWorld);\n        point.sub(camera.position);\n\n        // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\n        // exported markups don't have the offset.\n        var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\n        if (globalOffset) {\n            point.sub(globalOffset);\n        }\n\n        point = worldToClient(point, this.viewer, false);\n        point.z = 0;\n    }\n\n    return point;\n};\n\nproto.clientToMarkups = function(x, y) {\n\n    var camera = this.viewer.impl.camera;\n    var point = new THREE.Vector3(x, y, 0);\n\n    if (camera.isPerspective) {\n\n        var bb = this.viewer.impl.getCanvasBoundingClientRect();\n\n        // Multiply by PERSPECTIVE_MODE_SCALE because Firfox on Windows machines have problems to deal with very small paths.\n        point.x = (point.x - bb.width  * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\n        point.y =-(point.y - bb.height * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\n    } else {\n\n        point = clientToWorld(point.x, point.y, 0, this.viewer);\n\n        // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\n        // exported markups don't have the offset.\n        var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\n        if (globalOffset) {\n            point.add(globalOffset);\n        }\n\n        point.add(camera.position);\n        point.applyMatrix4(camera.matrixWorldInverse);\n        point.z = 0;\n    }\n\n    return point;\n};\n\nproto.getSvgViewBox = function(clientWidth, clientHeight) {\n\n    // Get pan offset.\n    var lt = this.clientToMarkups(0, 0);\n    var rb = this.clientToMarkups(clientWidth, clientHeight);\n\n    var l = Math.min(lt.x, rb.x);\n    var t = Math.min(lt.y, rb.y);\n    var r = Math.max(lt.x, rb.x);\n    var b = Math.max(lt.y, rb.y);\n\n    return [l , t, r-l, b-t].join(' ');\n};\n\nproto.getBounds = function () {\n\n    return this.bounds;\n};\n\nproto.getMousePosition = function() {\n\n    // When snapping, use the snap position instead of the mouse position\n    // as the start point of the markup drawing.\n    // For now only works for 2D.\n    if (this.editMode.useWithSnapping() && this.snapper && this.snapper.isSnapped()) {\n        return this.getSnapPosition();\n    }\n    return this.input.getMousePosition();\n};\n\nproto.getSnapPosition = function() {\n\n    var point = MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(), this.viewer);\n    var p = this.project(point);\n    return {x: p.x, y: p.y};\n};\n\nproto.project = function(position) {\n    var camera = this.viewer.navigation.getCamera();\n    var containerBounds = this.viewer.navigation.getScreenViewport();\n\n    var p = new THREE.Vector3().copy(position);\n    p.project(camera);\n\n    return new THREE.Vector3(Math.round((p.x + 1) / 2 * containerBounds.width),\n        Math.round((-p.y + 1) / 2 * containerBounds.height), p.z);\n};\n\n//// Handled Events ////////////////////////////////////////////////////////////////////////////////////////////////\n\nproto.onCameraChange = function() {\n\n    // Update annotations' parent transform.\n    var viewBox = this.getSvgViewBox(this.bounds.width, this.bounds.height);\n\n    // HACK, for some reason the 2nd frame returns an empty canvas.\n    // The reason why this happens is that the code above calls into the viewer\n    // and a division by zero occurs due to LMV canvas having zero width and height\n    // When we detect this case, avoid setting the viewBox value and rely on one\n    // previously set.\n    if (viewBox === \"NaN NaN NaN NaN\") {\n        return;\n    }\n\n    if (this.svg) {\n        this.svg.setAttribute('viewBox', viewBox);\n    }\n\n\n    var editMode = this.editMode;\n\n    if (editMode) {\n        // Edit frame has to be updated, re-setting the selected markup does the job.\n        if (this.editFrame.isActive()) {\n            var selectedMarkup = editMode.getSelection();\n            this.editFrame.setMarkup(selectedMarkup);\n        }\n\n        if (editMode.updateTextBoxStyle) {\n            editMode.updateTextBoxStyle();\n        }\n\n        if (this.snapper && editMode.useWithSnapping()) {\n            this.snapper.indicator.render();\n        }\n    }\n};\n\nproto.onViewerResize = function(event) {\n\n    this.bounds.x = 0;\n    this.bounds.y = 0;\n    this.bounds.width = event.width;\n    this.bounds.height = event.height;\n\n    if (this.svg) {\n        this.svg.setAttribute('width', this.bounds.width);\n        this.svg.setAttribute('height', this.bounds.height);\n    }\n\n    this.onCameraChange();\n};\n\nproto.callSnapperMouseDown = function() {\n\n    // Disable snapper in freehand mode\n    if (this.editMode && this.editMode.useWithSnapping()){\n        var mousePosition = this.input.getMousePosition();\n        if (this.snapper) {\n            this.snapper.onMouseDown(mousePosition);\n            this.snapper.indicator.render();\n        }\n    }else{\n        // Clear the snapper when selecting a markup that does not allow snapping.\n        if (this.snapper){\n            this.snapper.clearSnapped();\n            this.snapper.indicator.clearOverlays();\n        }\n    }\n};\n\nproto.callSnapperMouseMove = function() {\n\n    if (this.editMode && this.editMode.useWithSnapping()) {\n        var mousePosition = this.input.getMousePosition();\n        if (this.snapper) {\n            this.snapper.onMouseMove(mousePosition);\n            this.snapper.indicator.render();\n        }\n    }\n};\n\n/**\n * Handler to mouse move events, used to create markups.\n *\n * @param event\n * @returns {boolean} - if the event was handed by the editor\n * @private\n */\nproto.onMouseMove = function(event) {\n\n    if (this.navigating) {\n        return false;\n    }\n\n    let eventHandled = false;\n    if (this.editFrame.isActive() && event.type === 'mousemove') {\n        eventHandled = this.editFrame.onMouseMove(event);\n    }\n\n    this.callSnapperMouseMove();\n\n    eventHandled = (this.editMode && this.editMode.onMouseMove(event)) || eventHandled;\n\n    return eventHandled;\n};\n\n/**\n * Handler to mouse down events, used to start creation markups.\n *\n * @param event\n * @private\n */\nproto.onMouseDown = function(event) {\n\n    dismissLmvHudMessage();\n\n    this.callSnapperMouseDown();\n\n    var bounds = this.getBounds();\n    var mousePosition = this.getMousePosition();\n\n    if (mousePosition.x >= bounds.x && mousePosition.x <= bounds.x + bounds.width &&\n        mousePosition.y >= bounds.y && mousePosition.y <= bounds.y + bounds.height) {\n        this.editMode.onMouseDown(event);\n    }\n\n    // TODO: There is a better way to do this, implement when undo/redo group.\n    if(!this.editMode.creating && event.target === this.svg) {\n        this.selectMarkup(null);\n    }\n    this.ignoreNextMouseUp = false;\n};\n\n/**\n *\n * @param {*} event\n * @returns {boolean} - true / false means the editor did / didn't handle the event\n * @private\n */\nproto.onMouseUp = function(event) {\n\n    if (this.navigating) {\n        return false;\n    }\n\n    if (this.editFrame.isActive()) {\n        this.editFrame.onMouseUp(event);\n        return true;\n    }\n\n    if(!this.ignoreNextMouseUp) {\n        return this.editMode.onMouseUp(event);\n    }\n};\n\nproto.onMouseDoubleClick = function(event) {\n\n    if (this.navigating) {\n        return;\n    }\n\n    if (this.editFrame.isActive()) {\n        return;\n    }\n\n    this.editMode.onMouseDoubleClick(event);\n};\n\nproto.onUserCancel = function() {\n    if (!this.editMode) {\n        return;\n    }\n    else if (this.editMode.creating) {\n        this.editMode.creationCancel();\n    } else {\n        this.editMode.unselect();\n    }\n};\n\n/**\n *\n * @param event\n * @private\n */\nproto.onMarkupSelected = function(event) {\n\n    this.selectMarkup(event.markup);\n    this.dispatchEvent(event);\n};\n\nproto.onMarkupEnterEdition = function() {\n\n};\n\nproto.onMarkupCancelEdition = function() {\n\n    this.onUserCancel();\n};\n\nproto.onMarkupDeleteEdition = function(event) {\n\n    this.removeMarkup(event.markup);\n    this.editMode.deleteMarkup();\n};\n\nAutodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsCore', MarkupsCore);\n","\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[6].use[2]!../../../node_modules/css-unicode-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./MarkupsGui.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[6].use[2]!../../../node_modules/css-unicode-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./MarkupsGui.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { getStyleDefaultValues } from '../core/StyleUtils';\nimport * as MarkupEvents from '../core/MarkupEvents';\nimport * as MarkupTypes from '../core/MarkupTypes';\nimport { theEditModeManager } from '../core/EditModeManager';\n\nimport './MarkupsGui.css'; // IMPORTANT!!\n\n    var CORE_EXTENSION = 'Autodesk.Viewing.MarkupsCore';\n\n    export function MarkupsGui(viewer, options) {\n        Autodesk.Viewing.Extension.call(this, viewer, options);\n        this.domEvents = [];\n        this.name = 'markup';\n        this.onEditModeEnter = this.onEditModeEnter.bind(this);\n        this.onEditModeLeave = this.onEditModeLeave.bind(this);\n        this.onEditModeChange = this.onEditModeChange.bind(this);\n        this.onMarkupSelected = this.onMarkupSelected.bind(this);\n    }\n\n    MarkupsGui.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\n    MarkupsGui.prototype.constructor = MarkupsGui;\n    var proto = MarkupsGui.prototype;\n    var av = Autodesk.Viewing;\n    var avp = av.Private;\n\n    proto.load = function () {\n\n        this.viewer.loadExtension(CORE_EXTENSION).then( coreExt => {\n\n            this.core = coreExt;\n\n            // Hook into markup core events\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\n            this.core.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\n        });\n\n        return true;\n    };\n\n    proto.unload = function() {\n\n        this.deactivate(); // not necessary, but leaves the viewer in an unusable state without it\n        this.unhookAllEvents();\n\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\n        this.core.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\n\n        this.destroyToolUi();\n        this.destroyToolbarUI();\n        this.core = null;\n\n        return true;\n    };\n\n    proto.onToolbarCreated = function(toolbar) {\n\n        var self = this;\n\n        this.markupToolButton = new Autodesk.Viewing.UI.Button(\"toolbar-markupTool\");\n        this.markupToolButton.setToolTip(\"Markup\");\n        this.markupToolButton.setIcon(\"adsk-icon-markup\");\n        this.markupToolButton.onClick = function () {\n            // Since the bar will get hidden when closed, there\n            // is no need to track button state (active or not)\n            self.activate();\n        };\n\n        var modelTools = toolbar.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);\n        if (modelTools) {\n            modelTools.addControl(this.markupToolButton, {index:0});\n        }\n    };\n\n    proto.destroyToolbarUI = function() {\n        if (this.markupToolButton) {\n            var toolbar = this.viewer.getToolbar();\n            if (toolbar) {\n                this.markupToolButton.removeFromParent();\n            }\n            this.markupToolButton = null;\n        }\n    };\n\n    proto.onEditModeEnter = function() {\n        avp.logger.log('ENTER edit mode');\n        this.showToolsUi();\n    };\n\n    proto.onEditModeLeave = function() {\n        avp.logger.log('LEAVE edit mode');\n        this.hideToolsUi();\n    };\n\n    proto.onEditModeChange = function(event) {\n        if (!this.domToolSelect || this.ignoreChangeEvent)\n            return;\n        var editMode = this.core.editMode;\n        var optionList = this.domToolSelect.options;\n        for (var i=0, len=optionList.length; i<len; i++) {\n            var option = optionList[i];\n            if (option.value === editMode.type) {\n                this.domToolSelect.selectedIndex = i; // doesn't fire event\n                break;\n            }\n        }\n    };\n\n    proto.onMarkupSelected = function(event) {\n\n        var markup = event.markup;\n        var editMode = this.core.editMode;\n        this.setStylesUi(editMode, markup);\n    };\n\n    proto.showToolsUi = function() {\n        this.createToolsUi();\n\n        // Hide some UI\n        var canNavigate = this.core.isNavigationAllowed();\n        this.setControlVisibility('.lmv-markup-gui-enterNavMode', canNavigate, 'inline-block');\n        this.exitNavigationMode();\n        this.domContent.style.display = 'block'; // remove collapsed state\n\n        // It's okay if we call these many times in a row, no biggie.\n        this.viewer.container.appendChild(this.domRoot);\n    };\n\n    proto.hideToolsUi = function() {\n        if (this.domRoot && this.domRoot.parentNode) {\n            this.domRoot.parentNode.removeChild(this.domRoot);\n        }\n    };\n\n    proto.createToolsUi = function() {\n\n        if (this.domRoot)\n            return;\n\n        function createEditModeOption(locLabel, editModeType) {\n            return [\n                '<option value=\"', editModeType, '\">',\n                    locLabel,\n                '</option>'\n            ].join('');\n        }\n\n        var html = [\n            '<div class=\"lmv-markup-gui-toolbar-content\">',\n\n                '<button class=\"lmv-markup-gui-collapse-btn\">&lt;-&gt;</button>',\n                '<button class=\"lmv-markup-editmode-done\">Exit</button>',\n                '<div class=\"lmv-markup-gui-collapse-content\">',\n                    '<div class=\"lmv-markup-gui-editMode\">',\n                        '<button class=\"lmv-markup-gui-enterNavMode\">Navigate</button>',\n                        '<button class=\"lmv-markup-gui-undo\">&#8617;</button>',\n                        '<button class=\"lmv-markup-gui-redo\">&#8618;</button>',\n                        '<br>',\n                        '<button class=\"lmv-markup-gui-delete\">Delete</button>',\n                        '<button class=\"lmv-markup-gui-duplicate\">Duplicate</button>',\n                        '<br>',\n                        '<button class=\"lmv-markup-gui-cut\">Cut</button>',\n                        '<button class=\"lmv-markup-gui-copy\">Copy</button>',\n                        '<button class=\"lmv-markup-gui-paste\">Paste</button>',\n                        '<br>',\n                        '<span>Markup:</span>', // TODO: Localize\n                        '<select class=\"lmv-markup-tool-select\">',\n                            createEditModeOption('Arrow', MarkupTypes.MARKUP_TYPE_ARROW),\n                            createEditModeOption('Rectangle', MarkupTypes.MARKUP_TYPE_RECTANGLE),\n                            createEditModeOption('Circle', MarkupTypes.MARKUP_TYPE_CIRCLE),\n                            createEditModeOption('Text', MarkupTypes.MARKUP_TYPE_TEXT),\n                            createEditModeOption('Callout', MarkupTypes.MARKUP_TYPE_CALLOUT),\n                            createEditModeOption('Cloud', MarkupTypes.MARKUP_TYPE_CLOUD),\n                            createEditModeOption('PolyLine', MarkupTypes.MARKUP_TYPE_POLYLINE),\n                            createEditModeOption('Polycloud', MarkupTypes.MARKUP_TYPE_POLYCLOUD),\n                            createEditModeOption('Freehand', MarkupTypes.MARKUP_TYPE_FREEHAND),\n                            createEditModeOption('Highlight', MarkupTypes.MARKUP_TYPE_HIGHLIGHT),\n                            createEditModeOption('Dimension', MarkupTypes.MARKUP_TYPE_DIMENSION),\n                            createEditModeOption('SVG Stamp', MarkupTypes.MARKUP_TYPE_STAMP),\n                        '</select>',\n                        '<br>',\n                        '<div class=\"lmv-markup-gui-style-options\"></div>',\n                    '</div>',\n                    '<div class=\"lmv-markup-gui-navMode\" style=\"display:none;\">',\n                        '<button class=\"lmv-markup-gui-exitNavMode\">Back to Markup</button>',\n                    '</div>',\n                '</div>',\n            '</div>'\n        ].join('');\n\n        const _document = this.getDocument();\n        this.domRoot = _document.createElement('div');\n        this.domRoot.className = 'lmv-markup-gui-toolbar';\n        this.domRoot.innerHTML = html;\n\n        this.domContent = this.domRoot.querySelector('.lmv-markup-gui-collapse-content');\n        this.domToolSelect = this.domRoot.querySelector('.lmv-markup-tool-select');\n        this.domStylesRoot = this.domRoot.querySelector('.lmv-markup-gui-style-options');\n\n        // General\n        this.hookEvent('click', '.lmv-markup-gui-collapse-btn', this.onToggleCollapse.bind(this));\n        this.hookEvent('click', '.lmv-markup-editmode-done', this.onEditModeDone.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-enterNavMode', this.enterNavigationMode.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-exitNavMode', this.exitNavigationMode.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-undo', this.onUndoClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-redo', this.onRedoClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-delete', this.onDeleteClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-cut', this.onCutClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-copy', this.onCopyClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-paste', this.onPasteClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-duplicate', this.onDuplicateClick.bind(this));\n        // Tools\n        this.hookEvent('change', '.lmv-markup-tool-select', this.onSelectEditMode.bind(this));\n        this.hookEvent('change', '.lmv-markup-gui-style-select', this.onStyleChange.bind(this));\n        // Text input fields for tools\n        this.hookEvent('input', '.lmv-markup-gui-style-textarea', this.onStyleChange.bind(this));\n        this.hookEvent('propertychange', '.lmv-markup-gui-style-textarea', this.onStyleChange.bind(this));\n\n        this.setStylesUi(this.core.editMode);\n    };\n\n    proto.destroyToolUi = function() {\n        if (this.domRoot) {\n            this.hideToolsUi();\n            this.domRoot = null;\n        }\n    };\n\n    proto.getEditMode = function(editModeType) {\n        var EditModeClass = theEditModeManager.getClass(editModeType);\n        if (!EditModeClass)\n            return null;\n\n        var editMode = new EditModeClass(this.core);\n        return editMode;\n    };\n\n    proto.onToggleCollapse = function() {\n        var curr = this.domContent.style.display;\n        if (curr === 'none')\n            this.domContent.style.display = 'block';\n        else\n            this.domContent.style.display = 'none';\n    };\n\n    proto.onEditModeDone = function() {\n        this.deactivate();\n    };\n\n    proto.enterNavigationMode = function() {\n        this.core.allowNavigation(true);\n        this.setControlVisibility('.lmv-markup-gui-editMode', false);\n        this.setControlVisibility('.lmv-markup-gui-navMode', true);\n    };\n    proto.exitNavigationMode = function() {\n        this.core.allowNavigation(false);\n        this.setControlVisibility('.lmv-markup-gui-editMode', true);\n        this.setControlVisibility('.lmv-markup-gui-navMode', false);\n    };\n\n    proto.onUndoClick = function() {\n        this.core.undo();\n    };\n    proto.onRedoClick = function() {\n        this.core.redo();\n    };\n    proto.onDeleteClick = function() {\n        var markup = this.core.getSelection();\n        if (markup) {\n            this.core.deleteMarkup(markup);\n        }\n    };\n    proto.onCutClick = function() {\n        this.core.cut();\n    };\n    proto.onCopyClick = function() {\n        this.core.copy();\n    };\n    proto.onPasteClick = function() {\n        this.core.paste();\n    };\n    proto.onDuplicateClick = function() {\n        // only when there's a selection\n        var markup = this.core.getSelection();\n        if (markup) {\n            this.core.copy();\n            this.core.paste();\n        }\n    };\n\n    proto.onSelectEditMode = function(event) {\n        var editModeType = event.target.value;\n        var editMode = this.getEditMode(editModeType);\n        if (!editMode) {\n            avp.logger.error('Markup editMode not found for type: ' + editModeType);\n            return;\n        }\n\n        if (editMode.cancelEditModeChange) {\n            avp.logger.warn('There was a problem selecting current editMode');\n            return;\n        }\n\n        this.ignoreChangeEvent = true;\n        this.core.changeEditMode(editMode);\n        this.ignoreChangeEvent = false;\n        this.setStylesUi(editMode);\n        this.domToolSelect.blur(); // remove focus from UI\n    };\n\n    proto.onStyleChange = function(event) {\n        var select = event.target;\n        var styleKey = select.getAttribute('style-key');\n        var valueType = select.getAttribute('value-type');\n\n        var markup = this.core.getSelection();\n        var style = markup ? markup.getStyle() : this.core.getStyle();\n\n        // if it's a string input, just take the raw value\n        if (valueType === 'string') {\n            style[styleKey] = select.value;\n        } else {\n            var option = select.options[select.selectedIndex];\n            style[styleKey] = getTypedValue(option.value, valueType);\n            select.blur(); // remove focus from UI\n        }\n        this.core.setStyle(style);\n\n        function getTypedValue(val, type) {\n            if (type === 'number')\n                return Number(val);\n            if (type === 'boolean')\n                return val === 'true';\n            return val;\n        }\n    };\n\n    proto.setStylesUi = function(editMode, markup) {\n\n        var style = markup ? markup.style : editMode.style;\n        var defaults = getStyleDefaultValues(style, this.core);\n\n        this.domStylesRoot.innerHTML = ''; // flush UI\n        for (var key in defaults) {\n            // Quite inefiient because we are re-creating DOM constantly\n            // Consider optimize if it becomes a problem\n            var domElem = this.getUiForStyleKey(key, defaults[key], style[key]);\n            this.domStylesRoot.appendChild(domElem);\n        }\n    };\n\n    proto.getUiForStyleKey = function(key, defaults, current) {\n\n        var selectionIndex = defaults.default;\n        var options = [];\n        var values = defaults.values;\n        for (var i=0, len=values.length; i<len; ++i) {\n            var optLine = [\n                '<option value=\"', values[i].value,'\">',\n                    values[i].name,\n                '</option>'\n            ].join('');\n            options.push(optLine);\n\n            if (this.valueEquals(values[i].value, current)) {\n                selectionIndex = i;\n            }\n        }\n\n        var valueType = typeof values[0].value;\n\n        // TODO: Build specialized controls for each style-attribute\n        const _document = this.getDocument();\n        var domElem = _document.createElement('div');\n        var html = [];\n        let isText = key.includes('text');\n\n        if (isText) {\n            html = [\n                '<span>',key,'</span>',\n                '<br>',\n                '<textarea class=\"lmv-markup-gui-style-textarea\" style-key=\"', key, '\" value-type=\"', valueType,'\">',\n                (current || ''),\n                '</textarea>'\n            ].join('');\n        } else {\n            html = [\n                '<span>',key,'</span>',\n                '<select class=\"lmv-markup-gui-style-select\" style-key=\"', key, '\" value-type=\"', valueType,'\">',\n                    options.join(''),\n                '</select>'\n            ].join('');\n        }\n\n        domElem.innerHTML = html;\n\n        if (!isText) {\n            // select index\n            var domSelect = domElem.querySelector('select');\n            domSelect.selectedIndex = selectionIndex;\n        }\n\n        return domElem;\n    };\n    proto.valueEquals = function(value1, value2) {\n\n        return value1 === value2;\n    };\n\n    proto.setControlVisibility = function(selector, isVisible, visibleValue) {\n        var elem = this.domRoot.querySelector(selector);\n        if (!visibleValue)\n            visibleValue = 'block';\n        elem.style.display = isVisible ? visibleValue : 'none';\n    };\n\n    proto.hookEvent = function(eventStr, selector, callbackFn) {\n        var handler = function(event){\n            if (this.matchesSelector(event.target, selector)){\n                callbackFn(event);\n            }\n        }.bind(this);\n        this.domRoot.addEventListener(eventStr, handler);\n        this.domEvents.push({str: eventStr, handler: handler });\n    };\n\n    proto.unhookAllEvents = function() {\n        var domRoot = this.domRoot;\n        this.domEvents.forEach(function(event) {\n            domRoot.removeEventListener(event.str, event.handler);\n        });\n        this.domEvents = [];\n    };\n\n    proto.matchesSelector = function(domElem, selector) {\n        if (domElem.matches) return domElem.matches(selector); //Un-prefixed\n        if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\n        if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\n        if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\n        return false;\n    };\n\n    proto.getStyleOptions = function(editMode) {\n        var style = editMode.getStyle();\n        return getStyleDefaultValues(style, this.core);\n    };\n\n    proto.activate = function () {\n        if(!this.activeStatus) {\n            this.core.enterEditMode();\n            this.activeStatus = true;\n        }\n        return true;\n    };\n\n    proto.deactivate = function () {\n        if(this.activeStatus) {\n            this.core.hide();\n            this.activeStatus = false;\n        }\n        return true;\n    };\n\n\n    Autodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsGui', MarkupsGui);\n","'use strict';\n\nimport { MarkupsCore } from './core/MarkupsCore';\nimport { MarkupsGui } from './gui/MarkupsGui';\n\nimport { Clipboard } from './core/edit-clipboard/Clipboard';\nimport { CloneMarkup } from './core/edit-actions/CloneMarkup';\nimport { CreateArrow } from './core/edit-actions/CreateArrow';\nimport { CreateCallout } from './core/edit-actions/CreateCallout';\nimport { CreateCircle } from './core/edit-actions/CreateCircle';\nimport { CreateCloud } from './core/edit-actions/CreateCloud';\nimport { CreateDimension } from './core/edit-actions/CreateDimension';\nimport { CreateFreehand } from './core/edit-actions/CreateFreehand';\nimport { CreateHighlight } from './core/edit-actions/CreateHighlight';\nimport { CreatePolycloud } from './core/edit-actions/CreatePolycloud';\nimport { CreatePolyline } from './core/edit-actions/CreatePolyline';\nimport { CreateRectangle } from './core/edit-actions/CreateRectangle';\nimport { CreateText } from './core/edit-actions/CreateText';\nimport { DeleteArrow } from './core/edit-actions/DeleteArrow';\nimport { DeleteCallout } from './core/edit-actions/DeleteCallout';\nimport { DeleteCircle } from './core/edit-actions/DeleteCircle';\nimport { DeleteCloud } from './core/edit-actions/DeleteCloud';\nimport { DeleteStamp } from './core/edit-actions/DeleteStamp';\nimport { DeleteDimension } from './core/edit-actions/DeleteDimension';\nimport { DeleteFreehand } from './core/edit-actions/DeleteFreehand';\nimport { DeleteHighlight } from './core/edit-actions/DeleteHighlight';\nimport { DeletePolycloud } from './core/edit-actions/DeletePolycloud';\nimport { DeletePolyline } from './core/edit-actions/DeletePolyline';\nimport { DeleteRectangle } from './core/edit-actions/DeleteRectangle';\nimport { DeleteText } from './core/edit-actions/DeleteText';\n\nimport { EditAction } from './core/edit-actions/EditAction';\nimport { EditActionGroup } from './core/edit-actions/EditActionGroup';\nimport { EditActionManager } from './core/edit-actions/EditActionManager';\nimport { EditFrame } from './core/EditFrame';\n\nimport { EditMode } from './core/edit-modes/EditMode';\nimport { EditModeArrow } from './core/edit-modes/EditModeArrow';\nimport { EditModeCallout } from './core/edit-modes/EditModeCallout';\nimport { EditModeCircle } from './core/edit-modes/EditModeCircle';\nimport { EditModeCloud } from './core/edit-modes/EditModeCloud';\nimport { EditModeStamp } from './core/edit-modes/EditModeStamp';\nimport { EditModeDimension } from './core/edit-modes/EditModeDimension';\nimport { EditModeFreehand } from './core/edit-modes/EditModeFreehand';\nimport { EditModeHighlight } from './core/edit-modes/EditModeHighlight';\nimport { EditModePen } from './core/edit-modes/EditModePen';\nimport { EditModePolycloud } from './core/edit-modes/EditModePolycloud';\nimport { EditModePolyline } from './core/edit-modes/EditModePolyline';\nimport { EditModeRectangle } from './core/edit-modes/EditModeRectangle';\nimport { EditModeText } from './core/edit-modes/EditModeText';\nimport { EditorTextInput } from './core/edit-modes/EditorTextInput';\n\n\nimport { Markup } from './core/Markup';\nimport { MarkupArrow } from './core/MarkupArrow';\nimport { MarkupCallout } from './core/MarkupCallout';\nimport { MarkupCircle } from './core/MarkupCircle';\nimport { MarkupCloud } from './core/MarkupCloud';\nimport { MarkupDimension } from './core/MarkupDimension';\nimport { MarkupFreehand } from './core/MarkupFreehand';\nimport { MarkupHighlight } from './core/MarkupHighlight';\nimport { MarkupPen } from './core/MarkupPen';\nimport { MarkupPolycloud } from './core/MarkupPolycloud';\nimport { MarkupPolyline } from './core/MarkupPolyLine';\nimport { MarkupRectangle } from './core/MarkupRectangle';\nimport { MarkupText } from './core/MarkupText';\nimport { MarkupStamp } from './core/MarkupStamp';\nimport { MarkupTool } from './core/MarkupTool';\n\nimport { SetArrow } from './core/edit-actions/SetArrow';\nimport { SetCallout } from './core/edit-actions/SetCallout';\nimport { SetCircle } from './core/edit-actions/SetCircle';\nimport { SetCloud } from './core/edit-actions/SetCloud';\nimport { SetDimension } from './core/edit-actions/SetDimension';\nimport { SetFreehand } from './core/edit-actions/SetFreehand';\nimport { SetHighlight } from './core/edit-actions/SetHighlight';\nimport { SetPolycloud } from './core/edit-actions/SetPolycloud';\nimport { SetPolyline } from './core/edit-actions/SetPolyline';\nimport { SetPosition } from './core/edit-actions/SetPosition';\nimport { SetRectangle } from './core/edit-actions/SetRectangle';\nimport { SetRotation } from './core/edit-actions/SetRotation';\nimport { SetSize } from './core/edit-actions/SetSize';\nimport { SetStyle } from './core/edit-actions/SetStyle';\nimport { SetText } from './core/edit-actions/SetText';\nimport { SetStamp } from './core/edit-actions/SetStamp';\n\n\nimport * as MarkupEvents from './core/MarkupEvents';\nimport * as MarkupTypes from './core/MarkupTypes';\n\nimport * as Utils from './core/MarkupsCoreUtils';\nimport * as StyleUtils from './core/StyleUtils';\n\nimport { theEditModeManager } from './core/EditModeManager';\n\n// All the things\nexport const Core = {\n    Clipboard,\n    CloneMarkup,\n    CreateArrow,\n    CreateCallout,\n    CreateCircle,\n    CreateCloud,\n    CreateDimension,\n    CreateFreehand,\n    CreateHighlight,\n    CreatePolycloud,\n    CreatePolyline,\n    CreateRectangle,\n    CreateText,\n    DeleteArrow,\n    DeleteCallout,\n    DeleteCircle,\n    DeleteCloud,\n    DeleteDimension,\n    DeleteFreehand,\n    DeleteHighlight,\n    DeletePolycloud,\n    DeletePolyline,\n    DeleteRectangle,\n    DeleteText,\n    DeleteStamp,\n\n    EditAction,\n    EditActionGroup,\n    EditActionManager,\n    EditFrame,\n\n    EditMode,\n    EditModeArrow,\n    EditModeCallout,\n    EditModeCircle,\n    EditModeCloud,\n    EditModeDimension,\n    EditModeFreehand,\n    EditModeHighlight,\n    EditModePen,\n    EditModePolycloud,\n    EditModePolyline,\n    EditModeRectangle,\n    EditModeText,\n    EditModeStamp,\n    EditorTextInput,\n\n    Markup,\n    MarkupArrow,\n    MarkupCallout,\n    MarkupCircle,\n    MarkupCloud,\n    MarkupDimension,\n    MarkupFreehand,\n    MarkupHighlight,\n    MarkupPen,\n    MarkupPolycloud,\n    MarkupPolyline,\n    MarkupRectangle,\n    MarkupText,\n    MarkupStamp,\n    MarkupTool,\n\n    MarkupsCore,\n\n    SetArrow,\n    SetCallout,\n    SetCircle,\n    SetCloud,\n    SetDimension,\n    SetFreehand,\n    SetHighlight,\n    SetPolycloud,\n    SetPolyline,\n    SetPosition,\n    SetRectangle,\n    SetRotation,\n    SetSize,\n    SetStyle,\n    SetText,\n    SetStamp,\n\n\n    MarkupEvents,\n    MarkupTypes,\n    theEditModeManager,\n    Utils,\n};\n\n// Spread the markup types to minimize breaking changes (sigh)\nfor (var markupType in MarkupTypes) {\n    Core[markupType] = MarkupTypes[markupType];\n}\n\n// Spread the event ids to minimize breaking changes (sigh)\nfor (var eventType in MarkupEvents) {\n    Core[eventType] = MarkupEvents[eventType];\n}\n\n// Merge StyleUtils with utils (because those methods used to live in Utils)\nfor (var thing in StyleUtils) {\n    if (thing in Core.Utils)\n        throw new Error(`Property ${thing} from StyleUtils already present in MarkupsCoreUtils.`);\n\n    Core.Utils[thing] = StyleUtils[thing];\n}\n\n\nexport const Gui = {\n    MarkupsGui\n};\n\n\n// Also map back to legacy namespace\nAutodesk.Viewing.Extensions.Markups = {\n    Core\n};\n"],"names":["___CSS_LOADER_EXPORT___","push","module","id","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","stylesInDOM","getIndexByIdentifier","identifier","result","modulesToDom","options","idCountMap","identifiers","base","count","indexByIdentifier","obj","css","sourceMap","references","updater","addElementStyle","byIndex","splice","api","domAPI","update","newObj","remove","lastIdentifiers","newList","index","newLastIdentifiers","_i","_index","memo","insert","style","target","styleTarget","document","querySelector","window","HTMLIFrameElement","contentDocument","head","e","getTarget","Error","appendChild","element","createElement","setAttributes","attributes","styleElement","nonce","setAttribute","insertStyleElement","styleTagTransform","apply","parentNode","removeChild","removeStyleElement","styleSheet","cssText","firstChild","createTextNode","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","nc","MARKUP_TYPE_ARROW","MARKUP_TYPE_TEXT","MARKUP_TYPE_RECTANGLE","MARKUP_TYPE_CIRCLE","MARKUP_TYPE_CLOUD","MARKUP_TYPE_FREEHAND","MARKUP_TYPE_HIGHLIGHT","MARKUP_TYPE_POLYLINE","MARKUP_TYPE_POLYCLOUD","MARKUP_TYPE_CALLOUT","MARKUP_TYPE_DIMENSION","MARKUP_TYPE_STAMP","EditAction","editor","type","targetId","addToHistory","selectOnExecution","execute","actionManager","redo","undo","merge","action","isIdentity","createStyle","defaults","getStyleDefaultValues","attribute","values","default","copyStyle","source","destination","isStyleEqual","cloneStyle","clone","getFontSizes","normalWidth","name","getOpacities","defaultTransparent","normaStrokeWidth","getStrokeWidth","normaFontWidth","getFontWidth","EVENT_EDITMODE_CHANGED","EVENT_EDITMODE_ENTER","EVENT_EDITMODE_LEAVE","EVENT_MARKUP_SELECTED","EVENT_MARKUP_DRAGGING","EVENT_MARKUP_ENTER_EDITION","EVENT_MARKUP_CANCEL_EDITION","EVENT_MARKUP_DELETE_EDITION","EVENT_HISTORY_CHANGED","EVENT_EDITMODE_CREATION_BEGIN","EVENT_EDITMODE_CREATION_END","EVENT_MARKUP_DESELECT","EVENT_EDITFRAME_EDITION_START","EVENT_EDITFRAME_EDITION_END","av","Autodesk","Viewing","Markup","styleAttributes","viewer","setGlobalManager","globalManager","position","x","y","size","rotation","getDefaultStyle","highlightColor","constraintWidth","constraintHeight","constraintRotation","minWidth","minHeight","highlighted","selected","checkLineSegment","bind","checkPolygon","renderToCanvasX","renderToCanvas","addTraitEventDispatcher","GlobalManagerMixin","proto","SetStyle","markup","newStyle","oldStyle","getStyle","destroy","unselect","setParent","parent","div","shape","create","__proto__","overrides","getCloneOverrides","member","Function","nodeType","cloneNode","GlobalManager","parse","cloneShape","childNodes","hitarea","bindDomEvents","hammer","listeners","select","updateStyle","dispatchEvent","MarkupEvents","highlight","interactionsDisabled","setStyle","edit","cancel","deleteMarkup","getEditMode","console","warn","getClientPosition","positionFromMarkupsToClient","getClientSize","sizeFromMarkupsToClient","getBoundingRect","setRotation","parentRect","impl","getCanvasBoundingClientRect","boundRect","getBoundingClientRect","top","strokeWidth","offset","left","width","height","angle","getRotation","setPosition","setSize","isWidthConstrained","isHeightConstrained","isRotationConstrained","setMinWidth","setMinHeight","getMinWidth","getMinHeight","disableInteractions","disable","setStrokeWidth","constrainsToBounds","bounds","onMouseDown","event","editFrame","startDrag","generatePoint3d","idTarget","polygon","generateBoundingPolygon","self","checkLineSegmentAux","b","point2d","point3d","clientToWorld","point","xVertices","yVertices","midAB","THREE","Vector2","multiplyScalar","midAC","midDB","midDC","center","add","checkPolygonAux","generateBoundingBox","boundingBox","min","max","vertexCount","bbX0","Number","POSITIVE_INFINITY","bbY0","bbX1","NEGATIVE_INFINITY","bbY1","bbX","bbY","Math","halfSize","lt","Vector3","rt","rb","lb","m1","Matrix4","makeTranslation","m2","makeRotationZ","transform","multiply","applyMatrix4","Float32Array","setMetadata","setMouseDisabledWhenTouching","isFirst","removeEventListener","onMouseDownBinded","isFinal","_this","setTimeout","addEventListener","isTouchDevice","Hammer","Manager","recognizers","GestureRecognizers","singletap","handlePointerEventMouse","inputClass","TouchInput","onSingleTapBinded","onHammerInputBinded","on","onMouseOutBinded","onMouseOverBinded","ctx","viewBox","callback","getPath","getTransform","radiansToDegrees","constructor","getMarkup","EditMode","selectedMarkup","dragging","draggingAnnotationIniPosition","draggingMouseIniPosition","initialX","initialY","minSize","creating","CREATION_METHOD_DRAG","CREATION_METHOD_CLICK","CREATION_METHOD_CLICKS","creationMethod","DeleteArrow","arrow","createArrow","CreateArrow","tail","removeTraitEventDispatcher","fireEv","selectedId","setMarkup","markupId","creationBegin","creationEnd","isCancelling","isMinSizeValid","creationCancel","finishDragging","closeActionGroup","creationCancelled","cancelActionGroup","setSelection","bringToFront","isTextInputHelperActive","textInputHelper","setEditFrame","getSelection","cantUndo","tmp","startDragging","mousePosition","getMousePosition","set","getFinalMouseDraggingPosition","getBounds","finalX","finalY","input","makeSameXY","dx","abs","dy","maxDelta","sign","notifyAllowNavigation","allows","onMouseMove","onMouseUp","onMouseDoubleClick","onSave","getDraggingPosition","isInsideBounds","useWithSnapping","model","is2d","isActive","SetArrow","newHead","newTail","oldHead","oldTail","applyState","epsilon","MeasureCommon","EditModeArrow","MarkupTypes","MarkupArrow","addMarkupMetadata","createMarkupPathSvg","deleteArrow","lineSnapped","snapper","geomType","getGeometryType","SnapType","SNAP_VERTEX","SNAP_EDGE","SNAP_MIDPOINT","SNAP_CIRCLE_CENTER","getEdge","arrowMinSize","positionFromClientToMarkups","cos","PI","sin","constrain","beginActionGroup","arrowVector","lengthSq","normalize","arrowId","getId","final","isSnapped","start","project","vertices","end","p","z","parallel","nearestPointInPointToLine","pEnd","pStart","perpendicular","distanceTo","sizeFromClientToMarkups","xO","yO","xF","yF","vO","vF","vDir","sub","acos","dot","vFDir","vCenter","strokeColor","composeRGBAString","setAttributeToMarkupSvg","updateMarkupPathSvgHitarea","xo","yo","direction","metadata","String","sizeX","sizeY","sizeYOver3","tailW","headW","spikeOffset","addMarkup","removeMarkup","DeleteRectangle","rectangle","createRectangle","CreateRectangle","SetRectangle","newPosition","newSize","oldPosition","oldSize","EditModeRectangle","MarkupRectangle","deleteRectangle","pos","clientToMarkups","firstCorner","startZ","atan2","path","fillColor","w","h","createRectanglePath","DeleteText","text","createText","CreateText","getText","SetCallout","isFrameUsed","newText","oldText","newIsFrameUsed","oldIsFrameUsed","SetSize","newWidth","oldWidth","newHeight","oldHeight","callout","keys","Map","has","indexOf","assign","ta","nodeName","heightOffset","clientWidth","cachedHeight","changeOverflow","offsetWidth","overflow","resize","originalHeight","overflows","el","arr","Element","scrollTop","node","getParentOverflows","_document","getDocument","docTop","documentElement","endHeight","scrollHeight","forEach","_window","getWindow","styleHeight","round","parseFloat","computed","getComputedStyle","actualHeight","boxSizing","offsetHeight","evt","Event","bubbles","err","pageResize","removeWindowEventListener","overflowX","wordWrap","addWindowEventListener","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","isNaN","methods","RUNTIME_SUPPORTED","autosize","Array","DomElementStyle","reset","BROWSER_PREFIXES","dirty","styleString","allBrowsers","that","prefix","removeAttribute","isArray","getStyleString","elements","val","generateStyle","EditorTextInput","parentDiv","singleLine","defaultText","maxLength","EVENT_TEXT_CHANGE","EVENT_TEXT_SET_ACTIVE","EVENT_TEXT_SET_INACTIVE","textArea","rows","dir","firstEdit","startingHeight","ResizeObserver","entries","observer","observe","styleTextArea","measureDiv","trimRight","lastNonSpace","charAt","substr","trimLeft","firstNonSpace","setInactive","setActive","textMarkup","placeholderText","i18n","translate","constrainToCanvas","initFromMarkup","isIOSDevice","txtArea","requestAnimationFrame","focus","dataBag","blur","onResizeBinded","frameWidth","frameHeight","xPos","yPos","updateStyleFirst","padding","getClientFontSize","lineHeightPercentage","lineHeight","setPosAndSize","container","clientHeight","temp","injectSizeValues","newPos","fontHeight","textAreaStyle","getTextValuesForMarkup","sizeUpdateRequired","active","activeMarkup","activeFirstEdit","textValues","getTextValues","lines","generateLines","acceptAndExit","newLines","ox","oy","onCameraChanged","str","linesBreaks","split","styleMeasureStr","maxLineLength","linesOutput","len","line","splitLine","output","remaining","done","innerText","parts","getShorterLine","splitWord","iLastSpace","lastIndexOf","trailingWord","word","lenSoFar","part","okayWord","extraWord","EditModeCallout","helper","onHelperTextChange","onHelperSetActive","onHistoryChangeBinded","onHistoryChange","deleteCallout","DeleteCallout","clientFontSize","initialWidth","initialHeight","createCallout","CreateCallout","selectMarkup","databag","setIsHelperTextActive","setIsShapeVisible","textStyle","curSelection","updateTextBoxStyle","FONT_SIZE_SCALE","MarkupCallout","createSvgElement","textShape","createMarkupTextSvg","rectShape","createMarkupGroupSvg","currentText","currentTextLines","prevHighlight","isHelperTextActive","textString","setIsFilledFrameUsed","setText","stylesEqual","getTextLines","highlightChanged","rect","editMode","duringEditMode","fontSize","fontFamily","fontWeight","fontStyle","rebuildTextSvg","textContainerTransform","getTextContainerTransform","textTransform","getTextTransform","setMarkupTextSvgTransform","updateMarkupTextSvgClipper","updateMarkupTextSvgHitarea","textHelperValues","yOffset","getLineHeight","tspan","textContent","hasRectShape","insertBefore","setIsFilledFrameVisible","isVisible","display","isframeused","margin","EDIT_FRAME_DEFAULT_MARGIN","SetText","EditModeText","deleteText","MarkupText","textDirty","textSize","updateMarkupTextSvgBackground","DeleteCircle","circle","createCircle","CreateCircle","SetCircle","EditModeCircle","MarkupCircle","deleteCircle","firstPosition","ellipseW","ellipseH","createEllipsePath","DeleteCloud","cloud","createCloud","CreateCloud","SetCloud","EditModeCloud","newStrokeWidth","newColor","oldStrokeWidth","oldColor","MarkupCloud","deleteCloud","radius","createArcTo","xRadius","yRadius","createCorner","corner","getSideParameters","x1","x2","diameter","xValueInset","yValueOffset","p1","p2","p3","l","t","hSidesParameters","vSidesParameters","cornerSizeX","cornerSizeY","cornerRadiusX","cornerRadiusY","halfStrokeWidth","sp","createTSide","createRSide","createBSide","createLSide","MarkupPen","EditModePen","smoothen","bufferSize","locations","isAbsoluteCoords","updatePath","slice","locationsCount","scaleX","scaleY","toFixed","locationA","locationB","DeleteFreehand","freehand","createFreehand","CreateFreehand","deletePen","movements","location","appendToBuffer","amendPath","lastX","lastY","removeFromAbsolutePath","addToAbsolutePath","setPen","absolutePath","clearSnapped","buffer","movementsLastIndex","createPen","createAbsolutePath","cameraWidth","camera","right","cameraHeight","bottom","xs","simplify","ys","error","absolutePathIndexes","numToRemove","points","shift","getAveragePoint","tmpBuffer","pt","totalX","totalY","SetFreehand","EditModeFreehand","MarkupFreehand","DeletePolyline","polyline","createPolyline","CreatePolyline","closed","SetPolyline","EditModePolyline","setPositionAndSize","minFn","collection","targets","maxFn","MarkupPolyline","deletePolyline","pop","lastIndex","lastMove","areMarkupsPointsInClientRange","DeletePolycloud","polycloud","createPolycloud","CreatePolycloud","SetPolycloud","EditModePolycloud","MarkupPolycloud","deletePolycloud","updateCorners","side","cornerA","cornerB","orientation","rA","rB","D","pointA","c","pointB","delta","sqrt","xS","xT","yS","yT","y1","y2","intersec","cross","vecAB","createSidePath","bodyCount","bodyRadius","bodyDiameter","createCornerPath","first","large","fstPoint","sndPoint","pointC","getOrientation","sides","sidesCount","vecBA","getSides","corners","sideA","sideB","getCorners","cornersCount","bodyA","bodyB","body","updateSides","DeleteHighlight","createHighlight","CreateHighlight","SetHighlight","EditModeHighlight","MarkupHighlight","DeleteDimension","dimension","createDimension","CreateDimension","secondAnchor","firstAnchor","SetDimension","newFirstAnchor","newSecondAnchor","oldFirstAnchor","oldSecondAnchor","_cursorPosition","EditModeDimension","measurement","Measurement","MeasurementTypes","MEASUREMENT_DISTANCE","measureExt","getExtension","abortDimensionMarkup","cancelEditModeChange","enterEditMode","sharedMeasureConfig","forceCalibrate","isLeaflet","isPdf","calibrationTool","isCalibrated","openCalibrationRequiredDialog","deleteDimension","updateTextBox","updateViewportId","getDistance","computeResult","picks","distanceXYZ","Private","convertUnits","getUnitString","units","calibrationFactor","formatValueWithUnits","precision","updateMeasurement","measurementNumber","pick","getPick","geomVertex","intersectPoint","copyResults","viewportId","setViewportId","pickFirstAnchor","clearAllPicks","dimensionId","viewportIndex2d","pickSecondAnchor","mouseDown","correctPerpendicularPicks","getSnapResultPosition","indicator","render","isRightClick","navigation","inverseProject","constrainAxis","isVisibleChar","keyCode","measureTextLine","replace","RegExp","initialText","measureTextLines","handleKeyDown","KeyCode","ENTER","BACKSPACE","substring","handleKeyDownBinded","getTextAreaTransform","shouldFlip","MarkupDimension","preventReposition","degreesToRadians","lineSize","edgeH","textOffset","backgroundTransform","inverse","flip","segmentLength","DeleteStamp","stamp","super","createStamp","CreateStamp","SetStamp","EditModeStamp","svgData","deleteStamp","MarkupStamp","createShapeGroup","scriptSvgData","loadSvgData","group","svgString","svgNode","stringToSvgNode","getDimensions","innerHTML","getAttribute","styleChanged","customSvg","vb","strings","parseInt","avp","_gWindow","getGlobal","_gDocument","MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS","MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS","MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS","createElementNS","setSvgParentAttributes","svg","children","hitareaMargin","markupFill","markupStroke","strokeEnabled","fillEnabled","navigating","clipperId","getUniqueID","clipperUrl","clipper","background","clippedArea","color","addSvgMetadata","metadataNode","dataVersionNode","markupNode","removeAllMetadata","getElementsByTagName","nodes","svgChildren","transferChildNodes","nodeFrom","nodeInto","tmpArray","generateUUID","svgNodeToString","domNode","hitareas","removeHitareas","hitareaParent","childrenCount","XMLSerializer","serializeToString","hitareasCount","addHitareas","stringNode","DOMParser","parseFromString","client","listener","hasEventListener","li","typeListeners","worldToClient","snap","worldToViewport","viewportToClient","floor","clientX","clientY","depth","clientToViewport","unproject","viewportX","viewportY","metersToModel","meters","getUnitScale","radians","degrees","range","hideLmvUi","toolbar","setActiveNavigationTool","dismissLmvHudMessage","hideLmvPanels","hideLmvToolsAndPanels","restoreLmvUi","showLmvToolsAndPanels","hide","dockingPanels","panel","panelContainer","classList","contains","visibilityChanged","ext","displayViewCube","displayHomeButton","anim","getElementsByClassName","viewerContainer","viewerContainerChildrenCount","animator","keyFrameAnimator","isPaused","pauseCameraAnimations","pause","playButton","modelTools","getControl","setIcon","setToolTip","keepDismissing","HudMessage","dismiss","ignore","widthInPixels","createMarkupFromSVG","child","meta","isClosed","toLowerCase","getLocations","locStr","pointPair","getAttributeVector","posVec","strPos","getPosition","getSize","strRot","createMarkup","logger","getCurrentStyle","MarkupType","markupList","svgLayersMap","activeLayer","markups","hexRGBString","opacity","x0","y0","deviceRatio","devicePixelRatio","idTargetWidth","idTargetHeight","idTargetBuffer","j","check","m","verxtexCount","from","isInsidePolygon","bbW","bbH","endX","endY","createStyleSheet","sheet","addRuleToStyleSheet","selector","styles","insertRule","addRule","measureStyle","measure","linesCount","relative","halfW","halfH","svgMarkup","outerHTML","blob","Blob","url","URL","createObjectURL","img","Image","onload","drawImage","src","tolerance","highestQuality","getSqSegDist","simplifyDPStep","last","sqTolerance","simplified","maxSqDist","sqDist","prevPoint","newPoints","simplifyRadialDist","simplifyDouglasPeucker","EditActionGroup","actions","EditActionManager","historySize","undoStack","redoStack","open","close","actionsCount","isOpen","isEmpty","addAction","compact","actionA","actionB","getTargetId","CloneMarkup","getEditActionGroup","undoStackCount","clear","isUndoStackEmpty","isRedoStackEmpty","getLastElementInUndoStack","Clipboard","pastePosition","copy","cut","paste","_mouseEnabled","_mousePrevValue","_lock","InputHandler","snapRotations","keepAspectRatio","onWheelBinded","onWheel","onTouchDragBinded","onTouchDrag","onTouchPanBinded","onTouchPan","onTouchPinchBinded","onTouchPinch","onSingleTap","onDoubleTapBinded","onDoubleTap","onMouseMoveBinded","onMouseUpBinded","onMouseDoubleClickBinded","onHammerInput","isMouseDown","processMouseEvent","shiftKey","convertEventHammerToMouse","pointers","SetPosition","attachTo","detachFrom","drag","doubletap","doubletap2","singletap2","press","pan","pinch","recognizeWith","requireFailure","enableMouseButtons","state","addDocumentEventListener","removeDocumentEventListener","isMobileDevice","leaveEditMode","off","enterViewMode","leaveViewMode","toolController","mousewheel","preventDefault","mousemove","onMouseDownRightClick","activeElement","__clientToCanvasCoords","markupTool","handleButtonDown","onMouseUpRightClick","handleButtonUp","isMiddleClick","getTool","distributeGesture","callSnapperMouseMove","SetRotation","curAngle","newRotation","oldRotation","EditFrame","containingDiv","selectionLayer","createSelectionLayer","frameMargin","selection","resizing","handle","createSelectorBox","onHammerDragBinded","onHammerDrag","onHammerDoubleTapBinded","onHammerDoubleTap","handleSelectionBoxDragging","handleSelectionBoxResizing","handleSelectionDoubleClick","handleSelectionBoxRotating","pageX","pageY","visibility","togglePointerEvents","createDragPoint","setResizeCursor","className","createRotatePoint","createRotationBridge","rotationBridge","cursor","createDragPoints","isDragPoint","matchesSelectorAux","isRotatePoint","selectorBox","rotationHandle","updateSelectionBoxState","updateSelectorBoxPosition","toTranslate3d","transformOrigin","msTransform","webkitTransform","msTransformOrigin","webkitTransformOrigin","updateSelectorBoxDimensions","_onRepositionMouseDown","unload","doubleMargin","enable","enableResizeHandles","enableRotationHandle","_onRepositionMouseMove","_onRepositionMouseUp","isDragging","isResizing","isRotating","rotating","updateEditorInput","callSnapperMouseDown","_onRotationMouseDown","_onResizeMouseDown","_handleRightClickDown","initialRotation","initialHandlePosition","ignoreFirstMouseMove","setHandleSelected","isSelected","doubleClick","defaultPrevented","pointerEvents","getAngleBetweenPoints","domElem","matches","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","syntheticStart","MouseEvent","initialCursor","initialPosition","areAxisConstrained","axisConstrains","altKey","movement","deadZone","initial","mouseX","mouseY","_onResizeMouseMove","_onResizeMouseUp","vector","undoRotation","localSpaceDelta","projectOnVector","s","nw","ne","sw","se","redoRotation","actualDelta","_onRotationMouseMove","_onRotationMouseUp","ceil","MarkupTool","ToolInterface","names","panTool","allowNav","coreExt","hotkeysEnabled","_ctrlDown","_shiftDown","allowNavigation","allow","setCoreExtension","setHotkeysEnabled","enabled","activate","viewerApi","deactivate","CONTROL","SHIFT","v","ESCAPE","onUserCancel","DELETE","F12","handleKeyUp","handleSingleClick","button","handleDoubleClick","handleSingleTap","handleDoubleTap","handleWheelInput","handleMouseMove","handleGesture","handleBlur","_editModes","theEditModeManager","register","clazz","unregister","getClass","getRegistered","ret","locals","PERSPECTIVE_MODE_SCALE","MarkupsCore","Extension","duringViewMode","onEditActionHistoryChanged","nextId","clipboard","initStrokeAndFontWidths","MODEL_ADDED_EVENT","_ref","CAMERA_CHANGE_EVENT","once","onCameraChangeBinded","onCameraChange","onViewerResizeBinded","onViewerResize","onMarkupSelectedBinded","onMarkupSelected","onMarkupEnterEditionBinded","onMarkupEnterEdition","onMarkupCancelEditionBinded","onMarkupCancelEdition","onMarkupDeleteEditionBinded","onMarkupDeleteEdition","onToolChangeBinded","onToolChange","onUnitsCalibrationStartsBinded","onUnitsCalibrationStarts","Events","UNITS_CALIBRATION_STARTS_EVENT","load","async","svgStyle","disableMarkupInteractions","toolClass","markupToolClass","changeMarkupTool","markupDisableHotkeys","loadExtension","Extensions","Snapping","Snapper","markupMode","registerTool","enableHotKeys","deregisterTool","editModeSvgLayerNode","initialStrokeWidth","initialFontWidth","toggleEditMode","layerId","disableLayerMarkups","layerMarkups","show","parSvg","editModeLayerParentNode","editingLayer","svgParent","activateTool","defaultStyle","changeEditMode","NOT_IN_EDIT_MODE","clearOverlays","toggle","VIEWER_RESIZE_EVENT","reorderElements","onViewerRolloverObject","rolloverObject","RESULT_HIDE_OK","unloadMarkupsAllLayers","editModeLayer","generateData","defaultLayer","tmpNode","metadataNodes","addedNode","generatePoints3d","main","markupsCount","renderer","readbackTargetId","collision","context","renderAllMarkups","getSvgViewBox","numberOfScreenshotsTaken","onMarkupScreenshotTaken","svgKeys","layersKeys","oldEditMode","isNavigationAllowed","isPerspective","cachedNavigationTool","getActiveNavigationTool","TOOL_CHANGE_EVENT","getName","defaultToolName","getDefaultNavigationToolName","toolName","navAllowed","setNavigationLockSettings","zoom","orbit","roll","fov","walk","gotoview","setNavigationLock","changeInputHandler","inputHandler","dontAddToHistory","layerObject","markupIndex","editLayerMarkups","removeMarkupIfExists","sendMarkupTo","sendToBack","bringForward","bringBackward","loadMarkups","markupString","svgLayerNode","createLayerNode","localName","svgParentNode","newSvgLayerNode","revertLayer","currentMarkups","layerSvg","unloadMarkups","numMarkups","unloadSvgLayerNode","hideMarkups","showMarkups","markupsToClient","vectorFromClientToMarkups","vectorFromMarkupsToClient","bb","matrixWorld","globalOffset","getData","matrixWorldInverse","getSnapPosition","getSnapResult","getCamera","containerBounds","getScreenViewport","eventHandled","ignoreNextMouseUp","theExtensionManager","registerExtension","MarkupsGui","domEvents","onEditModeEnter","onEditModeLeave","onEditModeChange","then","core","unhookAllEvents","destroyToolUi","destroyToolbarUI","onToolbarCreated","markupToolButton","UI","Button","onClick","TOOLBAR","MODELTOOLSID","addControl","getToolbar","removeFromParent","log","showToolsUi","hideToolsUi","domToolSelect","ignoreChangeEvent","optionList","selectedIndex","setStylesUi","createToolsUi","canNavigate","setControlVisibility","exitNavigationMode","domContent","domRoot","createEditModeOption","locLabel","editModeType","html","domStylesRoot","hookEvent","onToggleCollapse","onEditModeDone","enterNavigationMode","onUndoClick","onRedoClick","onDeleteClick","onCutClick","onCopyClick","onPasteClick","onDuplicateClick","onSelectEditMode","onStyleChange","EditModeClass","curr","styleKey","valueType","option","getUiForStyleKey","current","selectionIndex","optLine","valueEquals","isText","includes","value1","value2","visibleValue","eventStr","callbackFn","handler","matchesSelector","getStyleOptions","activeStatus","Core","Utils","markupType","eventType","thing","StyleUtils","Gui","Markups"],"sourceRoot":""}